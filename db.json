{"meta":{"version":1,"warehouse":"4.0.0"},"models":{"Asset":[{"_id":"source/CNAME","path":"CNAME","modified":0,"renderable":0},{"_id":"source/apple-touch-icon.png","path":"apple-touch-icon.png","modified":0,"renderable":0},{"_id":"source/bcloud_nginx_gen.conf","path":"bcloud_nginx_gen.conf","modified":0,"renderable":0},{"_id":"source/favicon.ico","path":"favicon.ico","modified":0,"renderable":0},{"_id":"themes/maupassant-hexo-master/source/css/default.css","path":"css/default.css","modified":0,"renderable":1},{"_id":"themes/maupassant-hexo-master/source/css/donate.css","path":"css/donate.css","modified":0,"renderable":1},{"_id":"themes/maupassant-hexo-master/source/css/style.scss","path":"css/style.scss","modified":0,"renderable":1},{"_id":"themes/maupassant-hexo-master/source/donate/index.html","path":"donate/index.html","modified":0,"renderable":1},{"_id":"themes/maupassant-hexo-master/source/img/AL.png","path":"img/AL.png","modified":0,"renderable":1},{"_id":"themes/maupassant-hexo-master/source/img/QQ.png","path":"img/QQ.png","modified":0,"renderable":1},{"_id":"themes/maupassant-hexo-master/source/img/WeChatQR.png","path":"img/WeChatQR.png","modified":0,"renderable":1},{"_id":"themes/maupassant-hexo-master/source/img/alipay.svg","path":"img/alipay.svg","modified":0,"renderable":1},{"_id":"themes/maupassant-hexo-master/source/img/baidu.png","path":"img/baidu.png","modified":0,"renderable":1},{"_id":"themes/maupassant-hexo-master/source/img/bitcoin.svg","path":"img/bitcoin.svg","modified":0,"renderable":1},{"_id":"themes/maupassant-hexo-master/source/img/commentbox.gif","path":"img/commentbox.gif","modified":0,"renderable":1},{"_id":"themes/maupassant-hexo-master/source/img/csdn.ico","path":"img/csdn.ico","modified":0,"renderable":1},{"_id":"themes/maupassant-hexo-master/source/img/gitee.ico","path":"img/gitee.ico","modified":0,"renderable":1},{"_id":"themes/maupassant-hexo-master/source/img/github.svg","path":"img/github.svg","modified":0,"renderable":1},{"_id":"themes/maupassant-hexo-master/source/img/gongzhonghao.jpg","path":"img/gongzhonghao.jpg","modified":0,"renderable":1},{"_id":"themes/maupassant-hexo-master/source/img/liuyankuang.jpg","path":"img/liuyankuang.jpg","modified":0,"renderable":1},{"_id":"themes/maupassant-hexo-master/source/img/notfound.gif","path":"img/notfound.gif","modified":0,"renderable":1},{"_id":"themes/maupassant-hexo-master/source/img/touxiang02.jpg","path":"img/touxiang02.jpg","modified":0,"renderable":1},{"_id":"themes/maupassant-hexo-master/source/img/wechat.svg","path":"img/wechat.svg","modified":0,"renderable":1},{"_id":"themes/maupassant-hexo-master/source/img/weixinPngUrl.jpg","path":"img/weixinPngUrl.jpg","modified":0,"renderable":1},{"_id":"themes/maupassant-hexo-master/source/js/codeblock-resizer.js","path":"js/codeblock-resizer.js","modified":0,"renderable":1},{"_id":"themes/maupassant-hexo-master/source/js/donate.js","path":"js/donate.js","modified":0,"renderable":1},{"_id":"themes/maupassant-hexo-master/source/js/fancybox.js","path":"js/fancybox.js","modified":0,"renderable":1},{"_id":"themes/maupassant-hexo-master/source/js/gitment.browser.js","path":"js/gitment.browser.js","modified":0,"renderable":1},{"_id":"themes/maupassant-hexo-master/source/js/search.js","path":"js/search.js","modified":0,"renderable":1},{"_id":"themes/maupassant-hexo-master/source/js/smartresize.js","path":"js/smartresize.js","modified":0,"renderable":1},{"_id":"themes/maupassant-hexo-master/source/js/totop.js","path":"js/totop.js","modified":0,"renderable":1},{"_id":"themes/maupassant-hexo-master/source/js/zidingyi.js","path":"js/zidingyi.js","modified":0,"renderable":1}],"Cache":[{"_id":"source/CNAME","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1629163058415},{"_id":"source/404.md","hash":"2aefc58a788ad3cf0bb47c85e6b7b03f53f4fc57","modified":1629163058415},{"_id":"source/bcloud_nginx_gen.conf","hash":"01e9b3f9635e2d254f4c89c83234ca1102c79095","modified":1629163058417},{"_id":"source/apple-touch-icon.png","hash":"347b905d1106e3f326e31533a8a56b8bc9e27fc2","modified":1629163058417},{"_id":"source/_posts/SpringBoot一.md","hash":"01a01239f9a23768cad2eb6891651a8399353f24","modified":1624003631183},{"_id":"source/favicon.ico","hash":"7fd4d145758d99f988c9cdad2c93236222baecbe","modified":1629163058419},{"_id":"source/_posts/CA证书服务.md","hash":"a541e8ce77c011d3e7ef2104d4d25dfc2ed182b4","modified":1624003631182},{"_id":"source/_posts/SpringMVC一.md","hash":"2cf56130b9d16ce51705ea99fa255c5eb1857ef7","modified":1624003631183},{"_id":"source/_posts/flume安装.md","hash":"522babee99979fa369a628b816f5e7790f5cb243","modified":1624003631187},{"_id":"source/_posts/flume.md","hash":"74369b98f6d5d10641ba750f03db7501cdb71bdc","modified":1624003631187},{"_id":"source/_posts/gcc升级.md","hash":"5c0c455e769177bec2c51891feb0726d5f54273e","modified":1624003631187},{"_id":"source/_posts/flume案例.md","hash":"437e8a9f0dabe4682f7e4c6f5379fe8c0461dc01","modified":1624003631187},{"_id":"source/_posts/hadoop.md","hash":"96aa6b90c04e3d49b305a1e26aaca5240a791b6d","modified":1624003631188},{"_id":"source/_posts/hello-world.md","hash":"acad91ace80b80295b11a9b7ad4c29a2dcfdd8fb","modified":1624003631188},{"_id":"source/_posts/heox使用.md","hash":"cc5034b0f4f6a1b3aece06d069b5a4a2dd04c615","modified":1624003631188},{"_id":"source/_posts/hexo博客常用插件及教程.md","hash":"1081820259779f81b8256a21dad9104b899726e8","modified":1629163058415},{"_id":"source/_posts/kafaka安装.md","hash":"00e940f3d0651079de09bd02feb8574f74efbe45","modified":1627111866310},{"_id":"source/_posts/openresty编译安装.md","hash":"9834d71ad5572ed87733182eca8db1d964aaf90b","modified":1624003631198},{"_id":"source/_posts/pipenv使用.md","hash":"bd9ca476e0082843adb3d8c29803e4d2a00ea698","modified":1624003631199},{"_id":"source/_posts/proxmox超融合.md","hash":"8dfa0f08454e71a71bab8a144265da3554dca6bf","modified":1624003631201},{"_id":"source/_posts/代码补全.md","hash":"4eb1cc34b426a2522567c911a9ff69830c89e1f6","modified":1624003631205},{"_id":"source/about/index.md","hash":"b95a579c9fff9879c9b0f9cfbc9dee40a355ae21","modified":1629163058416},{"_id":"source/href/index.md","hash":"b7da646452ce8fba4e4d150237af033e97483a98","modified":1632964960210},{"_id":"source/_posts/spark安装.md","hash":"084d1676a27c2a37c4cb37cb02130bb40583135a","modified":1624003631204},{"_id":"source/site/index.md","hash":"6ca56f75c51901012c8e0dbffb19f3ec48c3cbee","modified":1629163058420},{"_id":"source/_posts/证书申请.md","hash":"523297417a2d685a51f486604de3831e844c583d","modified":1627005775044},{"_id":"source/tool/index.md","hash":"e56155d906708bfa52a07720bf233a2cb317c02f","modified":1629163058420},{"_id":"source/_posts/zookeeper安装.md","hash":"6d67c3a40b2d0de9faba1cb923bd33e48fd0a9f4","modified":1624003631205},{"_id":"source/_posts/GO/go.md","hash":"0cd07c46ed1b64a24f61fe675760bf10b3ddded2","modified":1624003631182},{"_id":"source/_posts/GO/error.md","hash":"44a262fe6d34a94634f3bd56abda926ec0337aa9","modified":1624850438221},{"_id":"source/_posts/GO/gomod.md","hash":"afd8f9594c85caada8e8c909edc884ea562c0b90","modified":1624003631183},{"_id":"source/_posts/ansible/Playbook支持任务结果回显.md","hash":"bc79611d940961bff4032b1401c52b9298e3acb6","modified":1624003631184},{"_id":"source/_posts/elasticsearch/skywaking.md","hash":"f7a1620b5554f2aed8b802a9b403301f30e6af6f","modified":1624003631186},{"_id":"source/_posts/cmdb/hosts.md","hash":"00bf3344798969a633855b96c491dd41e715831b","modified":1624003631184},{"_id":"source/_posts/docker/docker代理.md","hash":"220e371408a028c8ac72df15a2d5dbeeddd1cf20","modified":1628847536876},{"_id":"source/_posts/docker/docker日志大小.md","hash":"038d4a680698e2679f3890f4289a79a427690bd1","modified":1632274953787},{"_id":"source/_posts/elasticsearch/部署es7x.md","hash":"b34e336eb601a5f68c52e98bb88ec860ba83f6a0","modified":1627725572473},{"_id":"source/_posts/elk/filebeat案例.md","hash":"f948953720a4b62495917ce1d2c7a820a1906f46","modified":1625477512816},{"_id":"source/_posts/elk/ClickHouse分布式集群搭建指南.md","hash":"b1def443093dbb8849a37ce67f2510cee8d122bc","modified":1624003631187},{"_id":"source/_posts/elk/filebeat.md","hash":"63a8aa1aee1aa015f326ef71bcf7c6e52b6c9ded","modified":1625469914383},{"_id":"source/_posts/flask/flask分页.md","hash":"48f2c34c5b75afc46f4f297fe820d700323e77d5","modified":1624003631187},{"_id":"source/_posts/jenkins/jenkins.md","hash":"33a3cc3e3aa7f5108ed9d908fc397e5be9aa57c6","modified":1624003631194},{"_id":"source/_posts/gorm/gorm简单使用.md","hash":"b8a21178fc96ba5049b8287e219dda49281f4237","modified":1629617068620},{"_id":"source/_posts/jenkins/jenkins插件地址更新.md","hash":"e7f37358e944c06b11f5bfc95ff0aff36af0cce5","modified":1624003631194},{"_id":"source/_posts/jenkins/jenkins共享库使用.md","hash":"8ebabaabb4937b793d0bb34bfbfcddb15706b0b6","modified":1628654225263},{"_id":"source/_posts/install/Centos7升级内核.md","hash":"946e49558054ab6ce537b7e04d0d37b00028e28a","modified":1630213319791},{"_id":"source/_posts/install/centos7优化脚本.md","hash":"d2d4f318f6d22143423da36edbac2124e6b735d1","modified":1624003631189},{"_id":"source/_posts/install/centos7使用clamav.md","hash":"7a757e58ee3243570c7e586804fc3ae4a063ae92","modified":1624003631189},{"_id":"source/_posts/install/centos7关闭透明大页面.md","hash":"ca9db6e1317227e0409d19806f827617daaa245b","modified":1627544607645},{"_id":"source/_posts/install/centos7升级confluence.md","hash":"f3d3e4473358c344dd05f076eb7fedee3be86151","modified":1624003631190},{"_id":"source/_posts/install/centos7安装awx.md","hash":"1dd521a7e9c8617e51dfed5acd953c93849244ab","modified":1624003631190},{"_id":"source/_posts/install/centos7安装bind9.md","hash":"8fe64d1b249a5b3fe592d6cd62d74318d5ea9e70","modified":1631247777185},{"_id":"source/_posts/install/centos7安装confluence612.md","hash":"51859d07fcf8a969e641a97072679a839834a34e","modified":1624003631192},{"_id":"source/_posts/install/centos7安装kafka.md","hash":"0f36423063ba1772663cac7516299ba25d0af8a7","modified":1632449977751},{"_id":"source/_posts/install/centos7安装kafkacenter.md","hash":"72d50a3249510badd2caa86b4a2e27e7baf6c120","modified":1627458245628},{"_id":"source/_posts/install/centos7安装mongodb.md","hash":"7e9b18128dfe9bd16688ba19aa093192575efcdb","modified":1627126528640},{"_id":"source/_posts/install/centos7安装mysql.md","hash":"dd811e454d16c6fa3fc19932ed67e7cf6ae519fb","modified":1627630583977},{"_id":"source/_posts/install/centos7安装mysql57.md","hash":"b8b8cf9e46b79d74fedd01c7f96f3650d52b56c6","modified":1624003631192},{"_id":"source/_posts/install/centos7安装nginx.md","hash":"fa4e38c916d2aebd552d081176fc137233d58862","modified":1632822381333},{"_id":"source/_posts/install/centos7安装python3.md","hash":"e342d7049ffb65e7b5b651038c9750578558a66c","modified":1624003631193},{"_id":"source/_posts/install/centos7安装rabbitmq.md","hash":"f42b1f157342066ae3219726ed8c92c64165cd7f","modified":1627550937873},{"_id":"source/_posts/install/centos7安装redis-cluster.md","hash":"7739c0987fc9622c81a03a52c6343b705412f6b4","modified":1627541699645},{"_id":"source/_posts/install/centos7安装redis5.md","hash":"5cca9749486fd9e3eccd7157f8fdbadf373ab04b","modified":1627526364859},{"_id":"source/_posts/install/centos7安装redismanager.md","hash":"63924be774f47f5c03c8a7d29f217830661df10e","modified":1627457061348},{"_id":"source/_posts/install/centos7安装ruby.md","hash":"6a2ae10d37c76ec4dd353249a301276c7a6506c4","modified":1627544677633},{"_id":"source/_posts/install/centos7安装sentry.md","hash":"864792f786f6fee072ac288ffdc7d66e9cae7d07","modified":1624265132441},{"_id":"source/_posts/install/centos7安装zookeeper.md","hash":"150bc65e685220018ab5a02ae7d213fbf70dca6a","modified":1627113140110},{"_id":"source/_posts/install/centos7安装更新.md","hash":"303c131759ac2ed8ea4a335a9223ac7bd80c3167","modified":1626938807379},{"_id":"source/_posts/install/centos7模板制作.md","hash":"f48691ed98eac30272f39dd496a27e6b94b705d4","modified":1624003631193},{"_id":"source/_posts/k8s/k8s故障.md","hash":"6f38de77d6aed231839e90cf85708c3152dd12c4","modified":1624003631194},{"_id":"source/_posts/ldap/ldap部署.md","hash":"c728143220172a6dfe938616e9cf223393d80b40","modified":1624003631196},{"_id":"source/_posts/linux/centos7双网卡.md","hash":"89c296219c93bf1f8a597eea435591f7cd25ab41","modified":1629106089811},{"_id":"source/_posts/linux/linux非lvm扩容.md","hash":"2cdbb4e53cfd73dd5c746db509de4c0c967dd307","modified":1632908748541},{"_id":"source/_posts/linux/ssh免登陆.md","hash":"fdffc7072acfe3dc2b3bf39a44721c37b500c696","modified":1629341046470},{"_id":"source/_posts/linux/whiptail简单使用.md","hash":"d7540eadb1d6417a18654e88f4ecdaeaa754f000","modified":1632879697401},{"_id":"source/_posts/minio/minio.md","hash":"8280cf1dd0bd21b23b1d7cc754c5a7e14a596f60","modified":1624003631196},{"_id":"source/_posts/minio/minio集群搭建.md","hash":"17c299d7788c7ee2c50201a78c21f572d2b773b8","modified":1624003631197},{"_id":"source/_posts/minio/minio分布式部署.md","hash":"e8e10f85bda454c413401e7ce835bbd46d8b6908","modified":1624003631197},{"_id":"source/_posts/mysql/MySQL审计工具Audit插件使用.md","hash":"7f09d682968630d6d9be7d133b0dd83c59c70583","modified":1624003631198},{"_id":"source/_posts/mysql/init_connect实现mysql审计.md","hash":"2b0f324c30548581a693515643fea3ddc3e71c8d","modified":1624003631198},{"_id":"source/_posts/mongodb/安装monogdb3.2.md","hash":"42ad9d10b796aa2ed97f0881939288186ce7de0b","modified":1624003631197},{"_id":"source/_posts/nginx/nginx禁止ip访问.md","hash":"0cc7e39847594d04b7d58cea967561f33fbbfd45","modified":1628824860475},{"_id":"source/_posts/prometheus/docker的thanos的部暑.md","hash":"76c46c6ca6b35641c81f1baf06bc664ab7a36b80","modified":1631155897767},{"_id":"source/_posts/prometheus/node_exporter安装脚本.md","hash":"d91cd3a8703b8ebe64e8f014ce56c10c7ea76f20","modified":1631094118460},{"_id":"source/_posts/prometheus/prometheus清除数据.md","hash":"47d7bec0bd8fd7997bdaf502bec6e4b3e104d06a","modified":1631094131656},{"_id":"source/_posts/prometheus/node_exporter配置.md","hash":"25c83714bcf8e51de00f95266bb0304ac668ea2e","modified":1631094122967},{"_id":"source/_posts/prometheus/告警规则.md","hash":"b7ec17db060c1dae32ad87473a9b3357c90083d1","modified":1630465526457},{"_id":"source/_posts/prometheus/prom安装.md","hash":"360a561a2d66374519bbf314a3af1f29a3a2ce75","modified":1631171561053},{"_id":"source/_posts/prometheus/钉钉报警.md","hash":"63db430ccaa9001a1089dfa9149ee625f38cc4e1","modified":1630463781470},{"_id":"source/_posts/saltstack/salt-master安装脚本.md","hash":"9813649c6352bf20bc13e2715f8c31b845565bcd","modified":1624003631204},{"_id":"source/_posts/saltstack/salt-minion安装脚本.md","hash":"9f913e2acfb2ffbaf8c8212508f3191646f76234","modified":1624003631204},{"_id":"source/_posts/saltstack/saltstack.md","hash":"fed0709501805b340868ce9e25f6d3dc1b77b532","modified":1624003631204},{"_id":"source/_posts/vue/vue教程一.md","hash":"8a4838e6990de6cf8e3fb5abeac7848dca3c3829","modified":1624003631205},{"_id":"source/_posts/windows/win10系统文件修复.md","hash":"4fee91284f6eb0b3bd0e7c73bf458187f90acb52","modified":1624326416580},{"_id":"source/_posts/vue/vue01.md","hash":"ecb495c5b847d53426f0c3e0411e21d653207c81","modified":1632382365494},{"_id":"source/_posts/kafka-manager部署.md","hash":"3ade68a873709328d5489cc7e3a7ded19e014557","modified":1624003631195},{"_id":"themes/maupassant-hexo-master/.travis.yml","hash":"f8da426b97088e4caa5226cff219a5d95087961f","modified":1629163058421},{"_id":"themes/maupassant-hexo-master/LICENSE","hash":"0663fd3a7ea9fc4f4c634b4d73e2da426b536f86","modified":1629163058421},{"_id":"themes/maupassant-hexo-master/package.json","hash":"5328c4c435cd4a5fe47caae31b9975013cdca5bb","modified":1629163058431},{"_id":"themes/maupassant-hexo-master/languages/de-DE.yml","hash":"25d1d8cd8113045a7603c14af1ea1539fc6456ed","modified":1629163058422},{"_id":"themes/maupassant-hexo-master/README.md","hash":"bb0919e57f409f76a4bcc89d2d827294b363a2ea","modified":1629163058421},{"_id":"themes/maupassant-hexo-master/languages/es-ES.yml","hash":"3cc9312fbdba4a8f8e8254804121e4724c719bcc","modified":1629163058422},{"_id":"themes/maupassant-hexo-master/_config.yml","hash":"67b5e9977c39d55a4d30b85ee300694b2aeadd3a","modified":1629166528550},{"_id":"themes/maupassant-hexo-master/languages/en.yml","hash":"8574e8c36f4c72118f27f7ff7353b2a9ceda2a9b","modified":1629163058422},{"_id":"themes/maupassant-hexo-master/languages/fr-FR.yml","hash":"3a50568f200b9c1258415b53727e42c6b6c7ea0b","modified":1629163058423},{"_id":"themes/maupassant-hexo-master/languages/ru.yml","hash":"36edc014c6aaef367d58929089bf7915375e71a6","modified":1629163058423},{"_id":"themes/maupassant-hexo-master/languages/ko.yml","hash":"a454bcec60113507bc1d593a699849822386c196","modified":1629163058423},{"_id":"themes/maupassant-hexo-master/languages/zh-CN.yml","hash":"3fd2313f6463caad25667f994993b7d90be8495f","modified":1629163058424},{"_id":"themes/maupassant-hexo-master/languages/zh-TW.yml","hash":"34dba7ac67aeb316f629ca73e546fa143cc362d5","modified":1629163058424},{"_id":"themes/maupassant-hexo-master/layout/archive.pug","hash":"48f8e834a2589c1f6a14308de56d489773887e7d","modified":1632911022168},{"_id":"themes/maupassant-hexo-master/layout/base.pug","hash":"156747f49e08908dbaba12784ab06c0dbb7c7d70","modified":1629163058429},{"_id":"themes/maupassant-hexo-master/layout/base-without-sidebar.pug","hash":"5c6ce25930cb0854b18881cb43c323cab30d6e4d","modified":1629163058428},{"_id":"themes/maupassant-hexo-master/layout/links.pug","hash":"7bc7c17cfd498c3e0c3371cef78f08f1dc25db36","modified":1629163058429},{"_id":"themes/maupassant-hexo-master/layout/index.pug","hash":"544caa56966ce5b9693022503f3e37ad0a2f2c60","modified":1629163058429},{"_id":"themes/maupassant-hexo-master/layout/page.pug","hash":"4fb7e499b5f4b9209511d2a432a4bac0b7cd0ea0","modified":1629163058430},{"_id":"themes/maupassant-hexo-master/layout/single-column.pug","hash":"8b4b731cdf86379d526821a1fa950bf15ed61f15","modified":1629163058430},{"_id":"themes/maupassant-hexo-master/layout/post.pug","hash":"4c46458018ff06654b3828283bfcc6cb90f5dcf4","modified":1629163058430},{"_id":"themes/maupassant-hexo-master/layout/search.pug","hash":"32152b308eebfafdf3edfe7b488a47175edeb396","modified":1629163058430},{"_id":"themes/maupassant-hexo-master/layout/timeline.pug","hash":"04f7efdc45acda1faff409d0f80fa5a0dd2309d0","modified":1629163058430},{"_id":"themes/maupassant-hexo-master/layout/_partial/footer-02.pug","hash":"4b53b71f53d8568e19645f867c7bd3b84ced0791","modified":1629163058426},{"_id":"themes/maupassant-hexo-master/layout/_partial/after_footer.pug","hash":"64ba687959ca7d6d16752dc477e7ae6f3b748ee7","modified":1629163058426},{"_id":"themes/maupassant-hexo-master/layout/_partial/comments.pug","hash":"82c66565b318e9935c83db52db9ae76c9046c8d1","modified":1629163058426},{"_id":"themes/maupassant-hexo-master/layout/_partial/helpers.pug","hash":"9e44f6d32f2449b4109c33118f8285fa2fc7b023","modified":1629163058427},{"_id":"themes/maupassant-hexo-master/layout/_partial/footer.pug","hash":"3189a11a9d262824c02fa96ea92cdae0a772a735","modified":1629163058426},{"_id":"themes/maupassant-hexo-master/layout/_partial/mathjax.pug","hash":"87106b5eb64b97d1f2ccb8e863aebc2259f0de09","modified":1629163058427},{"_id":"themes/maupassant-hexo-master/layout/_partial/head.pug","hash":"69f8ece1ddd7d7a8b0aa6feb9113f9af6cdaaebb","modified":1629163058426},{"_id":"themes/maupassant-hexo-master/layout/_partial/mathjax2.pug","hash":"560674eda0fc4c40c41f280a4e4c6d5adba67193","modified":1629163058427},{"_id":"themes/maupassant-hexo-master/layout/_partial/paginator.pug","hash":"03ad0c49ae6f8a999ae35b38d08e25775f51f52a","modified":1629163058427},{"_id":"themes/maupassant-hexo-master/layout/_partial/post_nav.pug","hash":"b11d9e6000449838b17f508429f29ffb60f53096","modified":1629163058428},{"_id":"themes/maupassant-hexo-master/layout/_partial/tag.pug","hash":"6145b483b271bba05ad1db7c039fe352a768215b","modified":1629163058428},{"_id":"themes/maupassant-hexo-master/layout/_partial/totop.pug","hash":"eb91a3baf9411188c7c8130f63a674f541ca9c81","modified":1629163058428},{"_id":"themes/maupassant-hexo-master/source/css/donate.css","hash":"b41342b45a1fabd35c84001f82bc7caf6583152a","modified":1629163058433},{"_id":"themes/maupassant-hexo-master/source/css/default.css","hash":"b41d95120f9e64fd4530ae00ceaef09c7ea20818","modified":1629163058432},{"_id":"themes/maupassant-hexo-master/source/donate/index.html","hash":"d429fbe0ff24a079fb419e454c015eee52107efe","modified":1629163058434},{"_id":"themes/maupassant-hexo-master/source/img/alipay.svg","hash":"292ea040e865c1d0be259703ff850570b3bdfc97","modified":1629163058436},{"_id":"themes/maupassant-hexo-master/source/img/WeChatQR.png","hash":"8c41aca7883e5ff714c56556f5fff8e7e7c38093","modified":1629163058436},{"_id":"themes/maupassant-hexo-master/source/img/baidu.png","hash":"cf5e4c365ecfb807c38d36e9c7a30ced3057ad87","modified":1629163058437},{"_id":"themes/maupassant-hexo-master/source/img/bitcoin.svg","hash":"eeb2ee8cf44ba5c298baeed84bb90866f4814955","modified":1629163058437},{"_id":"themes/maupassant-hexo-master/source/img/csdn.ico","hash":"14b6c35a00f85613e3a9ba9baf781b37de3a1dbd","modified":1629163058438},{"_id":"themes/maupassant-hexo-master/source/img/commentbox.gif","hash":"678e78aebc5a0010802f6e504adf68d41f060c07","modified":1629163058438},{"_id":"themes/maupassant-hexo-master/source/img/github.svg","hash":"90ba9a3b0dc19e70e742a39b014194f801e00f97","modified":1629163058439},{"_id":"themes/maupassant-hexo-master/source/img/gitee.ico","hash":"7f40f1962fe9d08572cd2bc68405df51b8518082","modified":1629163058439},{"_id":"themes/maupassant-hexo-master/source/img/gongzhonghao.jpg","hash":"9a179f9331cdd85736cef2dc9b0bb7ce85e95e76","modified":1629163058439},{"_id":"themes/maupassant-hexo-master/source/img/notfound.gif","hash":"e81b9256b56fb39d2f56024f866b03b7917525a8","modified":1629163058457},{"_id":"themes/maupassant-hexo-master/source/img/wechat.svg","hash":"30418295bed44bcc4b29076eb7deed49cf4d6c1c","modified":1629163058458},{"_id":"themes/maupassant-hexo-master/source/img/touxiang02.jpg","hash":"e6e101bb0a32c6140372abc139651fb0ea382e6b","modified":1629163058458},{"_id":"themes/maupassant-hexo-master/source/js/codeblock-resizer.js","hash":"c77270e684a60babc1abb7353e700ecdc5a66d30","modified":1629163058459},{"_id":"themes/maupassant-hexo-master/source/js/donate.js","hash":"5ba65a68eb78e78e2bfe786f26cfdd7efdf3a030","modified":1629163058459},{"_id":"themes/maupassant-hexo-master/source/js/fancybox.js","hash":"8a993c1c4ad40789d2960b682cb2130382a0f26a","modified":1629163058460},{"_id":"themes/maupassant-hexo-master/source/img/weixinPngUrl.jpg","hash":"00859dda7fd1f6456cec5bcfb881f603a15597f6","modified":1629163058459},{"_id":"themes/maupassant-hexo-master/source/js/totop.js","hash":"15de186b089c245fe60766d509b587919f05ff23","modified":1629163058462},{"_id":"themes/maupassant-hexo-master/source/js/smartresize.js","hash":"150ab1cad40d7ae081b0896b13f7d7cbac4e6338","modified":1629163058461},{"_id":"themes/maupassant-hexo-master/source/js/search.js","hash":"dbda07a03e6edc73f1dc28a068c24a6037b97b56","modified":1629163058461},{"_id":"themes/maupassant-hexo-master/source/js/zidingyi.js","hash":"8048771c7638d0ce95599fc508d83de98863c00d","modified":1629163058462},{"_id":"themes/maupassant-hexo-master/layout/_partial/_footer/gzhao.pug","hash":"d88e59a3c5d617b144edf482c0d52399b61cf519","modified":1629163058425},{"_id":"themes/maupassant-hexo-master/layout/_partial/_footer/links.pug","hash":"18fd2173712b0df4b6f39895627c3e5e95cededc","modified":1629163058425},{"_id":"themes/maupassant-hexo-master/layout/_partial/_footer/xzhao.pug","hash":"b2e234e60a850211d797471a2d7a5d0733dcd246","modified":1629163058425},{"_id":"source/_posts/saltstack/install_salt.sh","hash":"744a790ec668e3f58c0356f97d5d929668c2d652","modified":1624003631203},{"_id":"themes/maupassant-hexo-master/layout/_partial/_footer/gywo.pug","hash":"770b5e0cdef5c27b35505262175784125d792d23","modified":1629163058425},{"_id":"themes/maupassant-hexo-master/source/css/style.scss","hash":"9fb25b0d0b183729750933cbddb20d3dada19f20","modified":1629171903055},{"_id":"themes/maupassant-hexo-master/source/img/AL.png","hash":"45425796b77a047e3a2494b059729d7b065c8015","modified":1629163058435},{"_id":"themes/maupassant-hexo-master/source/img/QQ.png","hash":"9bbf0e24e081455685b6806e4488bf17dd501ced","modified":1629163058435},{"_id":"themes/maupassant-hexo-master/source/js/gitment.browser.js","hash":"b15998a45d5f386d30905cfbfbb1658336acbb5b","modified":1629163058461},{"_id":"themes/maupassant-hexo-master/source/img/liuyankuang.jpg","hash":"a871870c2a15b7bb82716d1341edc7988927bbe2","modified":1629163058456},{"_id":"public/404.html","hash":"41d40d717cf5853ba02a60bd9b7077a724328035","modified":1632965003401},{"_id":"public/search.xml","hash":"0a3cacd94f01061e5ffca489bafa0a63a704b9ff","modified":1632965003401},{"_id":"public/about/index.html","hash":"bc493a3a0173b97ccf854613885cea3336ee090c","modified":1632965090142},{"_id":"public/href/index.html","hash":"e4ccd0863312b13616a75582e1a585c2b9e9f916","modified":1632965090142},{"_id":"public/tool/index.html","hash":"2b5bf5d6ba6801985506cb91460c18a4f5a1112d","modified":1632965090142},{"_id":"public/site/index.html","hash":"9eb57838c3ffcd67e92c1ca8efaf2f0ee4349d8e","modified":1632965090142},{"_id":"public/2021/09/28/install/centos7安装nginx/index.html","hash":"8358477aa20247b08e1ba81fbf1cce40a6921537","modified":1632965090142},{"_id":"public/2021/09/17/linux/linux非lvm扩容/index.html","hash":"b79ffb87ff024919a8a4023589cac2fbe2eaa718","modified":1632965090142},{"_id":"public/2021/09/01/prometheus/告警规则/index.html","hash":"6ff1d25f2d88719aa090e7364617c2d907ed2b03","modified":1632965090142},{"_id":"public/2021/08/19/linux/ssh免登陆/index.html","hash":"41d14b713a771b15dd922d99e797599862a205a3","modified":1632965090142},{"_id":"public/2021/08/17/hello-world/index.html","hash":"f6ebf8b848a9232f60bf94da9b04f23960408edf","modified":1632965090142},{"_id":"public/2021/08/17/elasticsearch/skywaking/index.html","hash":"b13609740fcf905afea4341e402013a618617162","modified":1632965090142},{"_id":"public/2021/08/13/nginx/nginx禁止ip访问/index.html","hash":"59449126153edc67b2b5a93cb8685e3331c1eb96","modified":1632965090142},{"_id":"public/2021/08/11/jenkins/jenkins共享库使用/index.html","hash":"513ca8812918c2d593ab058c7748a273918132d9","modified":1632965090142},{"_id":"public/2021/07/29/install/centos7安装rabbitmq/index.html","hash":"4011571bf48ea0287b293e05f012b80ad88c2194","modified":1632965090142},{"_id":"public/2021/07/29/install/centos7关闭透明大页面/index.html","hash":"daa4bd21f776c8cdb69e2f6f15ff6234d3cd53e9","modified":1632965090142},{"_id":"public/2021/07/29/install/centos7安装ruby/index.html","hash":"d1dc0a7d7c1a39b2aef33bb8357a53b6fe202d2f","modified":1632965090142},{"_id":"public/2021/07/28/install/centos7安装redismanager/index.html","hash":"20f81e2f1d449a224f487ab3e09bdf92dce95172","modified":1632965090142},{"_id":"public/2021/07/24/install/centos7安装mongodb/index.html","hash":"fcb1523721c9ccec8b75634c9024965c192a53ee","modified":1632965090142},{"_id":"public/2021/07/24/install/centos7安装zookeeper/index.html","hash":"b29d248a1da6a395d78b178dc2664cbf647ca7ba","modified":1632965090142},{"_id":"public/2021/07/22/证书申请/index.html","hash":"7e832049230f875c3bef97e875e5a90775ffe8a9","modified":1632965090142},{"_id":"public/2021/06/28/docker/docker日志大小/index.html","hash":"d0b4b1a6fb47714ab8a62dcdb07e9869fffdab4a","modified":1632965090142},{"_id":"public/2021/06/28/GO/error/index.html","hash":"2119b1b21c6b61bd0fab315b4c1d2a2ef2646258","modified":1632965090142},{"_id":"public/2021/06/22/windows/win10系统文件修复/index.html","hash":"9a4f601ce5bf2f165f999d0d260cba9adbb6feba","modified":1632965090142},{"_id":"public/2021/06/21/install/centos7安装sentry/index.html","hash":"15b8619e68f4b245b16afc9e0be25fedaca24e96","modified":1632965090142},{"_id":"public/2021/05/17/prometheus/prometheus清除数据/index.html","hash":"c8cec43e618c31f6149e391f8da47cbc8aa3e912","modified":1632965090142},{"_id":"public/2021/05/08/docker/docker代理/index.html","hash":"f57f627fd753b8941e9614684c2ed9ba8d572016","modified":1632965090142},{"_id":"public/2021/05/08/install/centos7模板制作/index.html","hash":"779d579ee614685c1cc76fdf3ab8accbf7590800","modified":1632965090142},{"_id":"public/2021/05/06/install/centos7安装更新/index.html","hash":"b4ee66549136d577922b9234d017f824443f1ab3","modified":1632965090142},{"_id":"public/2021/03/24/jenkins/jenkins插件地址更新/index.html","hash":"12d6649ddac603f0c46209a4f9fea1c73c7e8cb5","modified":1632965090142},{"_id":"public/2021/03/21/minio/minio集群搭建/index.html","hash":"8e554a43821aa0997691edac383bb8ce0e8c89c5","modified":1632965090142},{"_id":"public/2021/03/17/install/centos7安装awx/index.html","hash":"b58b9a1eb11edd47bca7df8fa7907bfe50667848","modified":1632965090142},{"_id":"public/2021/03/15/install/centos7安装confluence612/index.html","hash":"5c618d0e7ebc19a4db275124b14f26ce61d34bb9","modified":1632965090142},{"_id":"public/2021/03/15/install/centos7安装mysql57/index.html","hash":"513cce011d6f147872b2c27174704089c62605d4","modified":1632965090142},{"_id":"public/2020/10/13/GO/go/index.html","hash":"557cb85392cc4497106cdcb9f2cf4ab492bc46ef","modified":1632965090142},{"_id":"public/2020/10/13/GO/gomod/index.html","hash":"8d679b5e2eb0f3e7e5a2d5330faff0817a4843aa","modified":1632965090142},{"_id":"public/2020/10/13/cmdb/hosts/index.html","hash":"218b9a84f1d65e813ec3c6b55a4d3b75b3df5265","modified":1632965090142},{"_id":"public/2020/09/29/vue/vue教程一/index.html","hash":"06d45746e7f7ca7e270bec8e1251d6235d09fb3a","modified":1632965090142},{"_id":"public/2020/09/21/elasticsearch/部署es7x/index.html","hash":"45b17b0fd037cf8a6a9117dc0b3aaca8fbaca821","modified":1632965090142},{"_id":"public/2020/09/21/saltstack/salt-master安装脚本/index.html","hash":"75d9023a1f675702d85d2f8ea1973babf76f42e9","modified":1632965090142},{"_id":"public/2020/09/21/saltstack/salt-minion安装脚本/index.html","hash":"3b709f703aa9cf9c3b239e55160c2de7dd79fa17","modified":1632965090142},{"_id":"public/2020/09/21/代码补全/index.html","hash":"f1d8fe47e5b43c91f822db4f08c2af1e5717fe70","modified":1632965090142},{"_id":"public/2020/05/11/proxmox超融合/index.html","hash":"5990d977362da9e1fbe36f2c0849b93637587768","modified":1632965090142},{"_id":"public/2020/04/01/install/Centos7升级内核/index.html","hash":"f55953121325a12765e23fc91cfbf182c778fec8","modified":1632965090142},{"_id":"public/2020/01/09/k8s/k8s故障/index.html","hash":"70405d19e45515fb962c1739f157331b9cf1668b","modified":1632965090142},{"_id":"public/2019/12/18/jenkins/jenkins/index.html","hash":"c2af2bc5ee3ec3ac6ed50e768fc82afff0a7e9ab","modified":1632965090142},{"_id":"public/2019/12/13/SpringBoot一/index.html","hash":"68d47dbd7d82c01d966b8639ea628cdfad39a8f9","modified":1632965090142},{"_id":"public/2019/12/13/pipenv使用/index.html","hash":"10554387c1b006db42eacdb232a63c7fd0854716","modified":1632965090142},{"_id":"public/2019/12/13/spark安装/index.html","hash":"27e337bb7a63aac0fb4322c0773e2ba849548575","modified":1632965090142},{"_id":"public/2019/12/13/mysql/init_connect实现mysql审计/index.html","hash":"faba8f3ce28c1bd02279d31aa8b4b75a9a489bac","modified":1632965090142},{"_id":"public/2019/10/09/heox使用/index.html","hash":"9704331f32b108f5f38e4331d17b1289e72a1956","modified":1632965090142},{"_id":"public/2018/07/31/hexo博客常用插件及教程/index.html","hash":"675f9994ce786479bda9db2cd964a23b7dfcae09","modified":1632965090142},{"_id":"public/archives/index.html","hash":"4690d3a2192be0201a6d84bdc685175e0cfa59d7","modified":1632965090142},{"_id":"public/archives/page/2/index.html","hash":"b3576983e018e91509e36cfab6063010e1d12f0c","modified":1632965090142},{"_id":"public/archives/page/3/index.html","hash":"89bd92778ea25163611f0d11617330f6ae56064e","modified":1632965090142},{"_id":"public/archives/page/4/index.html","hash":"2d895d57d9be3e7edbfceb23fdf614c82fb9ebd4","modified":1632965090142},{"_id":"public/archives/page/5/index.html","hash":"e45c41a8974550be7a446a219bbf7e440a6cc5b5","modified":1632965090142},{"_id":"public/archives/page/6/index.html","hash":"6e9373aeb80309fda0cecb31236fa657dde6379d","modified":1632965090142},{"_id":"public/archives/page/7/index.html","hash":"f589e497afe1f1cf4fde6a7c4092fbd4435ce3d1","modified":1632965090142},{"_id":"public/archives/page/8/index.html","hash":"d0a9dc94f9f4bac8fb3795408081bc808382e9e2","modified":1632965090142},{"_id":"public/archives/page/9/index.html","hash":"271a9f51f0976c982008c1762f217aab20234bdc","modified":1632965090142},{"_id":"public/archives/2018/index.html","hash":"f84c3b95c424dacc94f5f04534259b281fbc7cdf","modified":1632965090142},{"_id":"public/archives/2018/07/index.html","hash":"f84c3b95c424dacc94f5f04534259b281fbc7cdf","modified":1632965090142},{"_id":"public/archives/2019/index.html","hash":"8a0a89b14ca7a9625a0d9222a263ccc3b084c3cb","modified":1632965090142},{"_id":"public/archives/2019/page/2/index.html","hash":"c29b17c4518a9193bd62c8046a7623e8c5e36f17","modified":1632965090142},{"_id":"public/archives/2019/10/index.html","hash":"b7161b906c515bfd7aeba7744669d3cb8595bd5e","modified":1632965090142},{"_id":"public/archives/2019/12/index.html","hash":"e1e1e9dc19ca1ce15b304d3ea56d3e2dddd118dc","modified":1632965090142},{"_id":"public/archives/2019/12/page/2/index.html","hash":"e18b39ae800151afb9a32de3e6527b5a291820ef","modified":1632965090142},{"_id":"public/archives/2020/index.html","hash":"d94e44e87b030694614f40e9d35609de1689bc2f","modified":1632965090142},{"_id":"public/archives/2020/page/3/index.html","hash":"6cf8d482e5f93ed7c30f0fcda426b596c3efdf90","modified":1632965090142},{"_id":"public/archives/2020/page/2/index.html","hash":"f849a96a3cdea9f3a30d846c472e83fa052ff840","modified":1632965090142},{"_id":"public/archives/2020/01/index.html","hash":"59ca406c66520b048f9f08bd745ad94c3b972684","modified":1632965090142},{"_id":"public/archives/2020/02/index.html","hash":"8ce29cbee828fec7df2d4f2011881fb2ddd99b78","modified":1632965090142},{"_id":"public/archives/2020/03/index.html","hash":"5f6e4966112f79dc00b2f15e1557799723c38fb7","modified":1632965090142},{"_id":"public/archives/2020/04/index.html","hash":"d281c0bcb5c77ca58c08793b46e7a9fa39c785f3","modified":1632965090142},{"_id":"public/archives/2020/05/index.html","hash":"318e072dd7ba3da7887b2765f01d973880751a34","modified":1632965090142},{"_id":"public/archives/2020/09/index.html","hash":"f26ba13ab993f930204e98d83af6f5dc67078274","modified":1632965090142},{"_id":"public/archives/2020/10/index.html","hash":"8aa70fbe2f5ca1b82bb28a4e05321fbaae3cdb43","modified":1632965090142},{"_id":"public/archives/2020/09/page/2/index.html","hash":"cca1e0f3a5cd6e0a2f32f62f02460dfc6d48ac5b","modified":1632965090142},{"_id":"public/archives/2020/12/index.html","hash":"072bdeceb2728d37037d6271b53e8d55408aad89","modified":1632965090142},{"_id":"public/archives/2021/index.html","hash":"8f86ebf68c2b9c95623aefa16082d8f23b83f62e","modified":1632965090142},{"_id":"public/archives/2021/page/2/index.html","hash":"91255677a6152894526bed47dd2adef12fdbe0a2","modified":1632965090142},{"_id":"public/archives/2021/page/3/index.html","hash":"f3b1e0b07bca2376813f143f10b1dc673caa12ed","modified":1632965090142},{"_id":"public/archives/2021/page/4/index.html","hash":"582acf0575bb0d15d3bffb883e9ab764aa238e1e","modified":1632965090142},{"_id":"public/archives/2021/page/5/index.html","hash":"c37a5578cb51d2d5ba0658dc6aed31892de90630","modified":1632965090142},{"_id":"public/archives/2021/01/index.html","hash":"6fd3ff49bb9b4b56eb41356826c77fe8a872b95f","modified":1632965090142},{"_id":"public/archives/2021/02/index.html","hash":"23c59fa8d3d084524619a7f4a70e424607610c67","modified":1632965090142},{"_id":"public/archives/2021/03/index.html","hash":"d776385f39357eadd5c7d754057a7108ee29fc6e","modified":1632965090142},{"_id":"public/archives/2021/05/index.html","hash":"772072dac9c54236ea83fa92f9170f037351becb","modified":1632965090142},{"_id":"public/archives/2021/06/index.html","hash":"c1d0883cb25e91972600beaaf9d3ba10acf64f57","modified":1632965090142},{"_id":"public/archives/2021/07/index.html","hash":"e828494508b4f73992ea1591c0feb3801b1ef76a","modified":1632965090142},{"_id":"public/archives/2021/07/page/2/index.html","hash":"57bfeb672dca0448767e589eedc00e7cdc08ef60","modified":1632965090142},{"_id":"public/archives/2021/08/index.html","hash":"c60acc7b72af01d724f8a8bb2edbcdb3e610a07d","modified":1632965090142},{"_id":"public/archives/2021/09/index.html","hash":"a247a1f1032c1340b65d4d191e45912b5a250f20","modified":1632965090142},{"_id":"public/categories/java/index.html","hash":"237c035e0ed136ae28442b9cd89e8748fa64772f","modified":1632965090142},{"_id":"public/categories/bigdata/index.html","hash":"6d022a999c8056c32220a9973783eddf9c26e86f","modified":1632965090142},{"_id":"public/categories/gcc/index.html","hash":"30362acd4b2ead557f6e0e49e25a851aa5fff9e6","modified":1632965090142},{"_id":"public/categories/openresty/index.html","hash":"97934a6335e8352ef92497a37f2866b943ffcc71","modified":1632965090142},{"_id":"public/categories/hexo/index.html","hash":"34cdb1a6c1b3fc9fba53cfdfd8c624e67cf81c04","modified":1632965090142},{"_id":"public/categories/python/index.html","hash":"d5dd9daf4fe6819ddc61f90c1a7f7fb7ee5d1cbd","modified":1632965090142},{"_id":"public/categories/linux/index.html","hash":"be9e6db52881d979d4efed70ed296ea095de66ee","modified":1632965090142},{"_id":"public/categories/linux/page/2/index.html","hash":"9d95c9983555a4d78060cc0cf553a8448b240e92","modified":1632965090142},{"_id":"public/categories/ssl/index.html","hash":"6851fb661f6e9a3e9774106265439748f8d8d29b","modified":1632965090142},{"_id":"public/categories/golang/index.html","hash":"301798866fa1fe4b1e6731fccdfce9834a7b557a","modified":1632965090142},{"_id":"public/categories/go/index.html","hash":"d52fc04d11827a832f22be21f81947762e124645","modified":1632965090142},{"_id":"public/categories/ansible/index.html","hash":"704c5f23d4a863c80675d9a5544afb6850739ac6","modified":1632965090142},{"_id":"public/categories/cmdb/index.html","hash":"2e81be841b1fc682025ea12dab4fe0a67b30b58c","modified":1632965090142},{"_id":"public/categories/docker/index.html","hash":"084a972710713d324d7ceb472f16bd0782e96aa8","modified":1632965090142},{"_id":"public/categories/elasticsearch/index.html","hash":"7a6ab6e2e8bee5563c8945b9a8ae651cddca26a0","modified":1632965090142},{"_id":"public/categories/elk/index.html","hash":"826f998f76d13ffca0d69ae0250a9bd75e536a33","modified":1632965090142},{"_id":"public/categories/flask/index.html","hash":"650ba8516894845b5adbac84fd86ed99375e0c83","modified":1632965090142},{"_id":"public/categories/jenkins/index.html","hash":"0a03cfcb5d1564bd5aa549a50a1da5483a9e8a23","modified":1632965090142},{"_id":"public/categories/centos7/index.html","hash":"923479a87d7b82683568a82aa89769cec164c627","modified":1632965090142},{"_id":"public/categories/centos7/page/2/index.html","hash":"a74ce9a938c28e36098b29c2db4265cb9eecea95","modified":1632965090142},{"_id":"public/categories/Linux/index.html","hash":"4927a50323a28e990c9a0b592960ca4c798972df","modified":1632965090142},{"_id":"public/categories/centos/index.html","hash":"f86e4e0699049c3398be81a3a05a5176aef04214","modified":1632965090142},{"_id":"public/categories/k8s/index.html","hash":"239835ed94eddebcc7d4356deebf94cf393b1db3","modified":1632965090142},{"_id":"public/categories/ldap/index.html","hash":"63715efc8848fcc1c5cf91a4e6df93d84dd87a6c","modified":1632965090142},{"_id":"public/categories/minio/index.html","hash":"88273defe5b517c338ed837cd368897e66cdeeab","modified":1632965090142},{"_id":"public/categories/mysql/index.html","hash":"64ca4cc37da2ce838b470b09a00abe537488e0c2","modified":1632965090142},{"_id":"public/categories/mongodb/index.html","hash":"262b14c8fec141e803c984f25b1cef5dc127eea4","modified":1632965090142},{"_id":"public/categories/nginx/index.html","hash":"789d684c465e9425e1d6957cbaf21545d815bc39","modified":1632965090142},{"_id":"public/categories/prometheus/index.html","hash":"652ba6be902629a3e212968ca77bb3cbabd4ecb4","modified":1632965090142},{"_id":"public/categories/salt/index.html","hash":"33e4bb9c8fd9d6dd67c25c74847f8f5838c35ba3","modified":1632965090142},{"_id":"public/categories/vue/index.html","hash":"aa713da60542781db738e649336bc130df6411b3","modified":1632965090142},{"_id":"public/categories/windows/index.html","hash":"9e932a26711a9d09f31f7e2d443f926c01efe826","modified":1632965090142},{"_id":"public/page/3/index.html","hash":"7b7870b433e5004d1fd8c86f439e23d31c3422c7","modified":1632965090142},{"_id":"public/page/8/index.html","hash":"234e3fddc8d40a89ee05d598ba366b657a9e9222","modified":1632965090142},{"_id":"public/page/9/index.html","hash":"e541c9e68f6be4aadcc9e4f086c338e33c8bbd3a","modified":1632965090142},{"_id":"public/tags/SpringBoot/index.html","hash":"0c57097e5ca3e99d07841c74973c77ea5d1ff3c1","modified":1632965090142},{"_id":"public/tags/java/index.html","hash":"237c035e0ed136ae28442b9cd89e8748fa64772f","modified":1632965090142},{"_id":"public/tags/springMVC/index.html","hash":"e706cd86a12cfe62cb259ba1073ce3887556ba70","modified":1632965090142},{"_id":"public/tags/flume/index.html","hash":"d41578ea294bcbc944c5acc49bc6250ace6608f8","modified":1632965090142},{"_id":"public/tags/gcc/index.html","hash":"30362acd4b2ead557f6e0e49e25a851aa5fff9e6","modified":1632965090142},{"_id":"public/tags/linux/index.html","hash":"44c580782a9f7116f586519ee9d99230ee90c9a8","modified":1632965090142},{"_id":"public/tags/hadoop/index.html","hash":"90b0b1c1fd763aedcce853d71b8eea2637497899","modified":1632965090142},{"_id":"public/tags/hexo/index.html","hash":"42069c52f816b34e435d681ad08f7fe5298a0f7e","modified":1632965090142},{"_id":"public/tags/hexo插件/index.html","hash":"89eea05d7323a622d541d7123caa0b6b1eaabb07","modified":1632965090142},{"_id":"public/tags/hexo博客/index.html","hash":"6d9d4b680079bfca3d034985b97c15ce3af011d5","modified":1632965090142},{"_id":"public/tags/hexo教程/index.html","hash":"45610ec727f84eba23ecc66468aceafcc082654a","modified":1632965090142},{"_id":"public/tags/kafka/index.html","hash":"c01e1e238137bd3cca6b8ddf593dc492bf8e9e5e","modified":1632965090142},{"_id":"public/tags/nginx/index.html","hash":"395c2674e82ba65685e81a7acd2bf08283b2a571","modified":1632965090142},{"_id":"public/tags/pipenv/index.html","hash":"784d595769c487825b39df33b1f067ef1328359f","modified":1632965090142},{"_id":"public/tags/python/index.html","hash":"87908d561685792de800d2cf45abb734770a11e8","modified":1632965090142},{"_id":"public/tags/proxmox/index.html","hash":"2cf5ebc9cb20095ca1ceb6612dd0a8aa49c6fe18","modified":1632965090142},{"_id":"public/tags/spark/index.html","hash":"98e81e2d64e39c4a3026eb9169cd00daae13a8bb","modified":1632965090142},{"_id":"public/tags/zookeeper/index.html","hash":"40db0c7003be23d1d3e25c36e2969e8cf1c75ada","modified":1632965090142},{"_id":"public/tags/tag/index.html","hash":"0c2fb1b31856df97f4197ed006d1e4b5eeb7d6fd","modified":1632965090142},{"_id":"public/tags/Kite/index.html","hash":"406ba0374e2cdf5323206efaa67f35b99cafd7d6","modified":1632965090142},{"_id":"public/tags/tabnine/index.html","hash":"9d45a5c8439655cc3e417b98571792684aec0053","modified":1632965090142},{"_id":"public/tags/ssl/index.html","hash":"de2b639fc748d2ad766161b1aaa7ca1194235565","modified":1632965090142},{"_id":"public/tags/ca/index.html","hash":"d164c331455bb956807aa1bded0e968f8365d8aa","modified":1632965090142},{"_id":"public/tags/golang/index.html","hash":"301798866fa1fe4b1e6731fccdfce9834a7b557a","modified":1632965090142},{"_id":"public/tags/go/index.html","hash":"81404dd7a31c7fde2a908cd4b00dc03fce943b9f","modified":1632965090142},{"_id":"public/tags/go-mod/index.html","hash":"29ba9b49faa9330a525c32d92f446ab7378dfbc0","modified":1632965090142},{"_id":"public/tags/ansible/index.html","hash":"704c5f23d4a863c80675d9a5544afb6850739ac6","modified":1632965090142},{"_id":"public/tags/cmdb/index.html","hash":"2e81be841b1fc682025ea12dab4fe0a67b30b58c","modified":1632965090142},{"_id":"public/tags/docker/index.html","hash":"084a972710713d324d7ceb472f16bd0782e96aa8","modified":1632965090142},{"_id":"public/tags/log/index.html","hash":"a956648bfa802f3285f2642e79a9b117728d25cc","modified":1632965090142},{"_id":"public/tags/es/index.html","hash":"dab1e800e509cd18a7b934b464860c472e3fd427","modified":1632965090142},{"_id":"public/tags/elasticsearch/index.html","hash":"7a6ab6e2e8bee5563c8945b9a8ae651cddca26a0","modified":1632965090142},{"_id":"public/tags/clickhouse/index.html","hash":"71d345a00f10c5b8016c23e52f93aef26d35eac7","modified":1632965090142},{"_id":"public/tags/filebeat/index.html","hash":"7d90373b3732cba9147b1553b423710697a82d22","modified":1632965090142},{"_id":"public/tags/elk/index.html","hash":"81b5fc443a3b73dc16004e5c6225d89cb87dff95","modified":1632965090142},{"_id":"public/tags/flask/index.html","hash":"650ba8516894845b5adbac84fd86ed99375e0c83","modified":1632965090142},{"_id":"public/tags/gorm/index.html","hash":"7b9d39c1449c0ed7590b177c62b2148e418918a1","modified":1632965090142},{"_id":"public/tags/jenkins/index.html","hash":"0a03cfcb5d1564bd5aa549a50a1da5483a9e8a23","modified":1632965090142},{"_id":"public/tags/update/index.html","hash":"0b51721b2841767ebc806477a49f7ba69dbef567","modified":1632965090142},{"_id":"public/tags/优化/index.html","hash":"7697a11f5408bb94609b3c5432320ead7ae750cc","modified":1632965090142},{"_id":"public/tags/clamav/index.html","hash":"ce1eba85a154d33df48d189cc7615f4431c5bd73","modified":1632965090142},{"_id":"public/tags/confluence/index.html","hash":"af5a229e7f216c533f2ba21e87ed0c0232493364","modified":1632965090142},{"_id":"public/tags/awx/index.html","hash":"39861db32b2c24167c8bd0420e21a6ab803576fb","modified":1632965090142},{"_id":"public/tags/dns/index.html","hash":"3271324787609bfbfdd35ca10e73f9b2b11b96c7","modified":1632965090142},{"_id":"public/tags/kafkacenter/index.html","hash":"c0fefd0e3c0c1c55f88260ec539bba7a4cd68ef2","modified":1632965090142},{"_id":"public/tags/mongodb/index.html","hash":"bfb26ae7a0d51bd0d73f3c4333b614807e14b0bb","modified":1632965090142},{"_id":"public/tags/mysql/index.html","hash":"1ca479817b99527ad0a6e755223ac5d129d41557","modified":1632965090142},{"_id":"public/tags/rabbitmq/index.html","hash":"36d491f7e636137ab388e458dcc095ece4ce097f","modified":1632965090142},{"_id":"public/tags/redis/index.html","hash":"ad146486b757b37b7fcee6d36eec631610529fcb","modified":1632965090142},{"_id":"public/tags/redis-cluster/index.html","hash":"a89a5c1f9f7623c35085cda499f7d74682672b97","modified":1632965090142},{"_id":"public/tags/ruby/index.html","hash":"4882d3d1ee02913064c6f5c7950b34c3366d68eb","modified":1632965090142},{"_id":"public/tags/sentry/index.html","hash":"48f39a26da56149de082dcba983decd317386325","modified":1632965090142},{"_id":"public/tags/yum/index.html","hash":"3025a770900036917edeeeb8939d95e86aca2733","modified":1632965090142},{"_id":"public/tags/centos7/index.html","hash":"3c7198e10f72feb76011eb8f7944a61e356b75a0","modified":1632965090142},{"_id":"public/tags/ldap/index.html","hash":"63715efc8848fcc1c5cf91a4e6df93d84dd87a6c","modified":1632965090142},{"_id":"public/tags/k8s/index.html","hash":"239835ed94eddebcc7d4356deebf94cf393b1db3","modified":1632965090142},{"_id":"public/tags/network/index.html","hash":"17776f812b81d33cb18e47c5cc467482b2555c94","modified":1632965090142},{"_id":"public/tags/ssh/index.html","hash":"c38bd4f31e4e70490da7cb8d9ae744140e736363","modified":1632965090142},{"_id":"public/tags/whiptail/index.html","hash":"6e3c5fd30c43a47bd3f40314e6c584c7436b9634","modified":1632965090142},{"_id":"public/tags/minio/index.html","hash":"88273defe5b517c338ed837cd368897e66cdeeab","modified":1632965090142},{"_id":"public/tags/auth/index.html","hash":"45aa98034509880edf6e6a41c4c0abef875dc172","modified":1632965090142},{"_id":"public/tags/prome/index.html","hash":"4c5029e8ea39d745e7ee5aa0fcfee9601154fb2b","modified":1632965090142},{"_id":"public/tags/thanos/index.html","hash":"b202ff049eeffef8f33c087f2e9da35fa361cd49","modified":1632965090142},{"_id":"public/tags/node-exporter/index.html","hash":"8cce98539b75c62ad47306db06a5982bad83c3ee","modified":1632965090142},{"_id":"public/tags/dingding/index.html","hash":"1cac89955e17913a1a21f600e831cc01f0775aa6","modified":1632965090142},{"_id":"public/tags/prometheus/index.html","hash":"02da59b27a7c852002f2cc53d446162e19ff90b2","modified":1632965090142},{"_id":"public/tags/salt/index.html","hash":"33e4bb9c8fd9d6dd67c25c74847f8f5838c35ba3","modified":1632965090142},{"_id":"public/tags/vue/index.html","hash":"c94eb8247f8973ba723634f65ac2ecc7589979c4","modified":1632965090142},{"_id":"public/tags/vue3/index.html","hash":"07e0393d5d273c7c134718693e5715a849933e37","modified":1632965090142},{"_id":"public/tags/win10/index.html","hash":"db41b1068a4816847cefcd95a468912c0667ee1f","modified":1632965090142},{"_id":"public/2021/09/29/linux/whiptail简单使用/index.html","hash":"4649f1ff311f7490a145ba2c340432f4ad021b12","modified":1632965090142},{"_id":"public/2021/09/23/vue/vue01/index.html","hash":"5049942e27e9fff60cb98480b855aa6e6ead85ed","modified":1632965090142},{"_id":"public/2021/09/08/prometheus/docker的thanos的部暑/index.html","hash":"5866798b446428ff726b7f0948db8450f1e1cfb3","modified":1632965090142},{"_id":"public/2021/08/16/linux/centos7双网卡/index.html","hash":"98ff56689a6addf00b1de64e07398b980bbe048e","modified":1632965090142},{"_id":"public/2021/07/29/install/centos7安装redis-cluster/index.html","hash":"d5be6affa41a0fb5ce0732d7bdaf33d74fd6aaa7","modified":1632965090142},{"_id":"public/2021/07/28/install/centos7安装mysql/index.html","hash":"6ebf60219f5b29c67c7b6fca6b2708ba7009fefd","modified":1632965090142},{"_id":"public/2021/07/24/install/centos7安装kafkacenter/index.html","hash":"ea71b1753b35b10372db7c8ef4277025da6ee853","modified":1632965090142},{"_id":"public/2021/07/24/install/centos7安装kafka/index.html","hash":"ae1ad326b1c3a895ec68fbdae7dd7d1390bd1089","modified":1632965090142},{"_id":"public/2021/07/21/gorm/gorm简单使用/index.html","hash":"8cd638fe7e9c8c60c2b214aead28b44481262e7e","modified":1632965090142},{"_id":"public/2021/07/05/elk/filebeat案例/index.html","hash":"7d16fd8e96c35b376952ff87379327a12706133c","modified":1632965090142},{"_id":"public/2021/07/05/elk/filebeat/index.html","hash":"36e49c857a650636c807d98c581ddf5abcbdb290","modified":1632965090142},{"_id":"public/2021/05/17/prometheus/prom安装/index.html","hash":"b5410d3feae271ebe0ab7b7ab53dbe6dfa11f3f5","modified":1632965090142},{"_id":"public/2021/03/21/minio/minio分布式部署/index.html","hash":"8ed3709bf2e04a2a0c14d9db26c50ad6b8c4ff59","modified":1632965090142},{"_id":"public/2021/03/20/install/centos7升级confluence/index.html","hash":"9010a1e30fa27321732da0ead7bdf42029e7b812","modified":1632965090142},{"_id":"public/2021/03/12/elk/ClickHouse分布式集群搭建指南/index.html","hash":"ca23d0d990be18386cf4fb578ab7e02a6cb0a003","modified":1632965090142},{"_id":"public/2021/02/01/install/centos7使用clamav/index.html","hash":"e84b30f878aa5241b19811f1f032886306cc76d4","modified":1632965090142},{"_id":"public/2021/01/14/install/centos7安装redis5/index.html","hash":"9e645bd6f31bf7c1c9c6dc6633c085cc327e0d2d","modified":1632965090142},{"_id":"public/2021/02/25/install/centos7安装bind9/index.html","hash":"120337c0b721e56b9bed8b26017475221d977dd6","modified":1632965090142},{"_id":"public/2020/12/12/install/centos7安装python3/index.html","hash":"546c4298cd855c09722f65a8b9e9dd1b7f3a6a97","modified":1632965090142},{"_id":"public/2020/10/09/ansible/Playbook支持任务结果回显/index.html","hash":"29a5fe190ad678b6d74387ed8600537dcfd9e3c7","modified":1632965090142},{"_id":"public/2020/09/28/prometheus/钉钉报警/index.html","hash":"329db2d3b8bf9a17d97f18d40cb1a2e233f675ca","modified":1632965090142},{"_id":"public/2020/09/21/gcc升级/index.html","hash":"196e48b7f9943e875f593ff3dbf558a58ba00e34","modified":1632965090142},{"_id":"public/2020/09/21/prometheus/node_exporter安装脚本/index.html","hash":"f9bbc8851789dff227b0c6457dfde72753e368df","modified":1632965090142},{"_id":"public/2020/09/21/prometheus/node_exporter配置/index.html","hash":"d640eacead451344340a75490186f89cfa014d6d","modified":1632965090142},{"_id":"public/2020/09/21/mongodb/安装monogdb3.2/index.html","hash":"71dc5f5271ea6572045ddb9912578b4a5811262e","modified":1632965090142},{"_id":"public/2020/09/21/saltstack/saltstack/index.html","hash":"6f7a3058cdae716a210179e2183c1df4a7da40e1","modified":1632965090142},{"_id":"public/2020/09/21/install/centos7优化脚本/index.html","hash":"d258482a0251cfde1984958a26966c02fcbcc9d3","modified":1632965090142},{"_id":"public/2020/04/01/openresty编译安装/index.html","hash":"33d480577bd3f418d1ebf8bcfc3078a269988610","modified":1632965090142},{"_id":"public/2020/03/02/ldap/ldap部署/index.html","hash":"388461a925906d19191e14e627fd973b7173665c","modified":1632965090142},{"_id":"public/2020/02/13/flask/flask分页/index.html","hash":"64eddb2f4e4160145eba2303775407c4cb507841","modified":1632965090142},{"_id":"public/2019/12/18/CA证书服务/index.html","hash":"ff178eb82cabebaea217193e9d30f8f0a4fc5fb0","modified":1632965090142},{"_id":"public/2019/12/13/SpringMVC一/index.html","hash":"7f59eab0d24bb22895e2f61fd3286cc5bde67194","modified":1632965090142},{"_id":"public/2019/12/13/flume安装/index.html","hash":"b7dc52b5f98c3729e915dd00e696f335e082ef79","modified":1632965090142},{"_id":"public/2019/12/13/flume/index.html","hash":"1528e53ce3ba4cd1205d20447fec8586fb08e8ac","modified":1632965090142},{"_id":"public/2019/12/13/flume案例/index.html","hash":"6476144c9de26a36c03001d4a7c81faeba00beac","modified":1632965090142},{"_id":"public/2019/12/13/hadoop/index.html","hash":"d6cbad6d4ff69e964574ae66b92f072036088ca6","modified":1632965090142},{"_id":"public/2019/12/13/kafaka安装/index.html","hash":"72fac0aab7c1500e7cd137662deec81c1095de1f","modified":1632965090142},{"_id":"public/2019/12/13/minio/minio/index.html","hash":"3069a00a452a6e5da177a6b32712615ef336c38b","modified":1632965090142},{"_id":"public/2019/12/13/zookeeper安装/index.html","hash":"663a4d4da3e2ccf5ba6847d67cd7737d397a01ce","modified":1632965090142},{"_id":"public/2019/12/13/mysql/MySQL审计工具Audit插件使用/index.html","hash":"c664c8e6ad5553cbdb8323021ec8c378d50eaa64","modified":1632965090142},{"_id":"public/2019/12/13/kafka-manager部署/index.html","hash":"bc0c9c6b5c613ccdf74280f6fe11dd1c7fafe1e4","modified":1632965090142},{"_id":"public/index.html","hash":"fd97ad20d12c42ab1b8feee5e4bfab3def112592","modified":1632965090142},{"_id":"public/page/2/index.html","hash":"ee70ee7edac33d42025a775953b09060a0d91bc4","modified":1632965090142},{"_id":"public/page/4/index.html","hash":"360b639f244a02ef8df5c7622ae81aa8a764c1b6","modified":1632965090142},{"_id":"public/page/5/index.html","hash":"8b1d5ced1c10fe11ab2e9354d4c201f753a5fbdc","modified":1632965090142},{"_id":"public/page/6/index.html","hash":"9803ada4909db99cc93100bb0623a6e8516a6a03","modified":1632965090142},{"_id":"public/page/7/index.html","hash":"c808cd0581968a9a1bac64c73ceff1bfb71859a9","modified":1632965090142},{"_id":"public/CNAME","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1632965003401},{"_id":"public/apple-touch-icon.png","hash":"347b905d1106e3f326e31533a8a56b8bc9e27fc2","modified":1632965003401},{"_id":"public/bcloud_nginx_gen.conf","hash":"01e9b3f9635e2d254f4c89c83234ca1102c79095","modified":1632965003401},{"_id":"public/favicon.ico","hash":"7fd4d145758d99f988c9cdad2c93236222baecbe","modified":1632965003401},{"_id":"public/img/alipay.svg","hash":"292ea040e865c1d0be259703ff850570b3bdfc97","modified":1632965003401},{"_id":"public/img/bitcoin.svg","hash":"eeb2ee8cf44ba5c298baeed84bb90866f4814955","modified":1632965003401},{"_id":"public/img/baidu.png","hash":"cf5e4c365ecfb807c38d36e9c7a30ced3057ad87","modified":1632965003401},{"_id":"public/img/commentbox.gif","hash":"678e78aebc5a0010802f6e504adf68d41f060c07","modified":1632965003401},{"_id":"public/img/WeChatQR.png","hash":"8c41aca7883e5ff714c56556f5fff8e7e7c38093","modified":1632965003401},{"_id":"public/img/csdn.ico","hash":"14b6c35a00f85613e3a9ba9baf781b37de3a1dbd","modified":1632965003401},{"_id":"public/img/gitee.ico","hash":"7f40f1962fe9d08572cd2bc68405df51b8518082","modified":1632965003401},{"_id":"public/img/github.svg","hash":"90ba9a3b0dc19e70e742a39b014194f801e00f97","modified":1632965003401},{"_id":"public/img/gongzhonghao.jpg","hash":"9a179f9331cdd85736cef2dc9b0bb7ce85e95e76","modified":1632965003401},{"_id":"public/img/notfound.gif","hash":"e81b9256b56fb39d2f56024f866b03b7917525a8","modified":1632965003401},{"_id":"public/img/wechat.svg","hash":"30418295bed44bcc4b29076eb7deed49cf4d6c1c","modified":1632965003401},{"_id":"public/img/touxiang02.jpg","hash":"e6e101bb0a32c6140372abc139651fb0ea382e6b","modified":1632965003401},{"_id":"public/img/weixinPngUrl.jpg","hash":"00859dda7fd1f6456cec5bcfb881f603a15597f6","modified":1632965003401},{"_id":"public/assets/js/Meting.min.js","hash":"a0585220b918d78649a7893279e1ec4fb5abe835","modified":1632965003401},{"_id":"public/assets/css/APlayer.min.css","hash":"07372a2ba507388d0fed166d761b1c2c2a659dce","modified":1632965003401},{"_id":"public/assets/js/APlayer.min.js","hash":"22caa28ff6b41a16ff40f15d38f1739e22359478","modified":1632965003401},{"_id":"public/img/AL.png","hash":"45425796b77a047e3a2494b059729d7b065c8015","modified":1632965003401},{"_id":"public/img/QQ.png","hash":"9bbf0e24e081455685b6806e4488bf17dd501ced","modified":1632965003401},{"_id":"public/css/donate.css","hash":"d0079ba8202d925a93ab1cb44f2087b81f476755","modified":1632965003401},{"_id":"public/donate/index.html","hash":"88cc1b52c1d8ce455d7e819c356a50554e6d90bc","modified":1632965003401},{"_id":"public/js/donate.js","hash":"91c2c826f7b66d3051ff144237a39d9098d7b8b7","modified":1632965003401},{"_id":"public/js/codeblock-resizer.js","hash":"5d0b786d60bf225d9eabcc9cece2719ff4d9b6cd","modified":1632965003401},{"_id":"public/js/fancybox.js","hash":"13c4781570339f4fba76a3d7f202e442817dd605","modified":1632965003401},{"_id":"public/js/search.js","hash":"0c0630e2ef213701d393b041f10572e951a27985","modified":1632965003401},{"_id":"public/js/smartresize.js","hash":"3ef157fd877167e3290f42c67a624ea375a46c24","modified":1632965003401},{"_id":"public/js/totop.js","hash":"7dbf8fcf582a4fb6eb9b2c60d6de9f9c2091ec4c","modified":1632965003401},{"_id":"public/js/zidingyi.js","hash":"cf8d172d154642406fe70c3d1cf1b4a64c9fa76a","modified":1632965003401},{"_id":"public/css/default.css","hash":"7fbb18b73b44ed11193739c55fce53a6f173cf68","modified":1632965003401},{"_id":"public/css/style.css","hash":"feeb6c3ef20bec9a0c1da45fb2df7858a1012bcb","modified":1632965003401},{"_id":"public/js/gitment.browser.js","hash":"376446d9c5930576016f97dd63e5e6616c94d8d4","modified":1632965003401},{"_id":"public/img/liuyankuang.jpg","hash":"a871870c2a15b7bb82716d1341edc7988927bbe2","modified":1632965003401}],"Category":[{"name":"java","_id":"cku6979xa000400uhaui1fzyi"},{"name":"bigdata","_id":"cku6979xq000g00uh8d6e8sf4"},{"name":"gcc","_id":"cku6979y2000y00uh2naw29hg"},{"name":"hexo","_id":"cku6979y9001c00uh259u4by4"},{"name":"openresty","_id":"cku6979yi001p00uh575i2c06"},{"name":"python","_id":"cku6979yq001x00uh9zx2anhe"},{"name":"linux","_id":"cku6979yu002400uhbxfl4ki3"},{"name":"ssl","_id":"cku6979yz002e00uh5joxbebr"},{"name":"golang","_id":"cku6979z1002k00uhcu9a29hd"},{"name":"go","_id":"cku6979z4002r00uhakk5ez92"},{"name":"ansible","_id":"cku6979z9003300uh28dh6zac"},{"name":"cmdb","_id":"cku6979zb003b00uh9hkv1lam"},{"name":"docker","_id":"cku6979zd003i00uhfcnod9kv"},{"name":"elasticsearch","_id":"cku6979zj003y00uhgzz3b6p4"},{"name":"elk","_id":"cku6979zn004500uhevft1twd"},{"name":"flask","_id":"cku6979zs004k00uh8isk6aj5"},{"name":"jenkins","_id":"cku6979zw004x00uhcd4xaunp"},{"name":"centos7","_id":"cku697a08005k00uh702778cg"},{"name":"Linux","_id":"cku697a0s006v00uhdjxvftkf"},{"name":"centos","_id":"cku697a0z007d00uh5kambx98"},{"name":"k8s","_id":"cku697a13007r00uh9adhc3d6"},{"name":"ldap","_id":"cku697a14007x00uh3cnf82d2"},{"name":"minio","_id":"cku697a14008100uh0rwl17wg"},{"name":"mysql","_id":"cku697a17008c00uh2ito6zbd"},{"name":"mongodb","_id":"cku697a17008h00uhbw6ucrr4"},{"name":"nginx","_id":"cku697a18008l00uhaf2ia429"},{"name":"prometheus","_id":"cku697a19008p00uhf5k03lyi"},{"name":"salt","_id":"cku697a1j009h00uhf8coaq0l"},{"name":"vue","_id":"cku697a2e00bo00uh4h0z6i7y"},{"name":"windows","_id":"cku697a2g00bx00uh6nxe2zop"}],"Data":[],"Page":[{"title2":404,"date":"2018-05-01T08:49:45.000Z","comments":0,"layout":"false","_content":"<meta content=\"MSHTML 6.00.6000.17117\" name=\"GENERATOR\"></head>\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\">\n<meta name=\"author\" content=\"sucaihuo\">\n<meta name=\"copyright\" content=\"Copyright\">\n<body style=\"text-align: center;\">\n<div class=\"mod-notfound grid-98\">\n<p style=\"FONT-SIZE: 24px; LINE-HEIGHT: 40px\">啊~哦~ 发生错误喽</p>\n<p style=\"MARGIN-BOTTOM: 10px\">点击下方链接返回主页或备用地址</p>\n<p style=\"FONT-SIZE: 22px; LINE-HEIGHT: 20px\"> <a href=\"/.\" style=\"color:red;text-decoration:none;\">首页</a>&emsp; <a  title=\"码云\" href=\"https://iyohei.gitee.io\" target=\"_blank\" style=\"color:red;text-decoration:none;\">备用地址</a>&emsp;</p></div></div></div></section>\n<footer class=\"mod-footer mod-cs-footer\">\n<div class=\"clearfix hidden-box\"></div>\n<div class=\"footer-box\">\n \n<div class=\"copy-box\">©2018&emsp;<a href=\"https://hfanss.com\" style=\"color:red;text-decoration:none;\">hfanss.com</a></div></div>\n</footer>\n\n\n</body>","source":"404.md","raw":"---\ntitle2: 404\ndate: 2018-05-01 16:49:45\ncomments: false\nlayout: false\n---\n<meta content=\"MSHTML 6.00.6000.17117\" name=\"GENERATOR\"></head>\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\">\n<meta name=\"author\" content=\"sucaihuo\">\n<meta name=\"copyright\" content=\"Copyright\">\n<body style=\"text-align: center;\">\n<div class=\"mod-notfound grid-98\">\n<p style=\"FONT-SIZE: 24px; LINE-HEIGHT: 40px\">啊~哦~ 发生错误喽</p>\n<p style=\"MARGIN-BOTTOM: 10px\">点击下方链接返回主页或备用地址</p>\n<p style=\"FONT-SIZE: 22px; LINE-HEIGHT: 20px\"> <a href=\"/.\" style=\"color:red;text-decoration:none;\">首页</a>&emsp; <a  title=\"码云\" href=\"https://iyohei.gitee.io\" target=\"_blank\" style=\"color:red;text-decoration:none;\">备用地址</a>&emsp;</p></div></div></div></section>\n<footer class=\"mod-footer mod-cs-footer\">\n<div class=\"clearfix hidden-box\"></div>\n<div class=\"footer-box\">\n \n<div class=\"copy-box\">©2018&emsp;<a href=\"https://hfanss.com\" style=\"color:red;text-decoration:none;\">hfanss.com</a></div></div>\n</footer>\n\n\n</body>","updated":"2021-08-17T01:17:38.415Z","path":"404.html","title":"","_id":"cku6979wy000000uhhsu15iue","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><meta content=\"MSHTML 6.00.6000.17117\" name=\"GENERATOR\"></head>\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\">\n<meta name=\"author\" content=\"sucaihuo\">\n<meta name=\"copyright\" content=\"Copyright\">\n<body style=\"text-align: center;\">\n<div class=\"mod-notfound grid-98\">\n<p style=\"FONT-SIZE: 24px; LINE-HEIGHT: 40px\">啊~哦~ 发生错误喽</p>\n<p style=\"MARGIN-BOTTOM: 10px\">点击下方链接返回主页或备用地址</p>\n<p style=\"FONT-SIZE: 22px; LINE-HEIGHT: 20px\"> <a href=\"/.\" style=\"color:red;text-decoration:none;\">首页</a>&emsp; <a  title=\"码云\" href=\"https://iyohei.gitee.io\" target=\"_blank\" style=\"color:red;text-decoration:none;\">备用地址</a>&emsp;</p></div></div></div></section>\n<footer class=\"mod-footer mod-cs-footer\">\n<div class=\"clearfix hidden-box\"></div>\n<div class=\"footer-box\">\n \n<div class=\"copy-box\">©2018&emsp;<a href=\"https://hfanss.com\" style=\"color:red;text-decoration:none;\">hfanss.com</a></div></div>\n</footer>\n\n\n</body>","site":{"data":{}},"excerpt":"","more":"<meta content=\"MSHTML 6.00.6000.17117\" name=\"GENERATOR\"></head>\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\">\n<meta name=\"author\" content=\"sucaihuo\">\n<meta name=\"copyright\" content=\"Copyright\">\n<body style=\"text-align: center;\">\n<div class=\"mod-notfound grid-98\">\n<p style=\"FONT-SIZE: 24px; LINE-HEIGHT: 40px\">啊~哦~ 发生错误喽</p>\n<p style=\"MARGIN-BOTTOM: 10px\">点击下方链接返回主页或备用地址</p>\n<p style=\"FONT-SIZE: 22px; LINE-HEIGHT: 20px\"> <a href=\"/.\" style=\"color:red;text-decoration:none;\">首页</a>&emsp; <a  title=\"码云\" href=\"https://iyohei.gitee.io\" target=\"_blank\" style=\"color:red;text-decoration:none;\">备用地址</a>&emsp;</p></div></div></div></section>\n<footer class=\"mod-footer mod-cs-footer\">\n<div class=\"clearfix hidden-box\"></div>\n<div class=\"footer-box\">\n \n<div class=\"copy-box\">©2018&emsp;<a href=\"https://hfanss.com\" style=\"color:red;text-decoration:none;\">hfanss.com</a></div></div>\n</footer>\n\n\n</body>"},{"title":"简历","date":"2018-05-01T08:49:45.000Z","comments":0,"_content":"> ## 简介\n\n\n\n\n> ## 联系我\n\n\n\n\n> ## 其他\n\n\n\n\n<script>$(\".header-02-3 a:first\").addClass('current');</script>\n\n　　\n\n\n","source":"about/index.md","raw":"---\ntitle: 简历\ndate: 2018-05-01 16:49:45\ncomments: false\n---\n> ## 简介\n\n\n\n\n> ## 联系我\n\n\n\n\n> ## 其他\n\n\n\n\n<script>$(\".header-02-3 a:first\").addClass('current');</script>\n\n　　\n\n\n","updated":"2021-08-17T01:17:38.416Z","path":"about/index.html","layout":"page","_id":"cku6979x7000200uhgzwchacx","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><blockquote>\n<h2 id=\"简介\"><a href=\"#简介\" class=\"headerlink\" title=\"简介\"></a>简介</h2></blockquote>\n<blockquote>\n<h2 id=\"联系我\"><a href=\"#联系我\" class=\"headerlink\" title=\"联系我\"></a>联系我</h2></blockquote>\n<blockquote>\n<h2 id=\"其他\"><a href=\"#其他\" class=\"headerlink\" title=\"其他\"></a>其他</h2></blockquote>\n<script>$(\".header-02-3 a:first\").addClass('current');</script>\n\n<p>　　</p>\n","site":{"data":{}},"excerpt":"","more":"<blockquote>\n<h2 id=\"简介\"><a href=\"#简介\" class=\"headerlink\" title=\"简介\"></a>简介</h2></blockquote>\n<blockquote>\n<h2 id=\"联系我\"><a href=\"#联系我\" class=\"headerlink\" title=\"联系我\"></a>联系我</h2></blockquote>\n<blockquote>\n<h2 id=\"其他\"><a href=\"#其他\" class=\"headerlink\" title=\"其他\"></a>其他</h2></blockquote>\n<script>$(\".header-02-3 a:first\").addClass('current');</script>\n\n<p>　　</p>\n"},{"date":"2018-05-01T08:49:45.000Z","comments":0,"title":"友链","_content":"||||\n|:-|-|:--|\n||||\n\n\n<style>\ntable th:nth-of-type(1){\nwidth: 30%;\n}\ntable th:nth-of-type(2){\nwidth: 60%\n;\n}\ntable th:nth-of-type(3){\nwidth: 10%;\n}\n</style>\n<script>$(\".header-02-3 a:first\").addClass('current');</script>\n\n　　\n\n\n","source":"href/index.md","raw":"---\ndate: 2018-05-01 16:49:45\ncomments: false\ntitle: 友链\n---\n||||\n|:-|-|:--|\n||||\n\n\n<style>\ntable th:nth-of-type(1){\nwidth: 30%;\n}\ntable th:nth-of-type(2){\nwidth: 60%\n;\n}\ntable th:nth-of-type(3){\nwidth: 10%;\n}\n</style>\n<script>$(\".header-02-3 a:first\").addClass('current');</script>\n\n　　\n\n\n","updated":"2021-09-30T01:22:40.210Z","path":"href/index.html","layout":"page","_id":"cku6979xh000600uhau9fhz0y","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><table>\n<thead>\n<tr>\n<th align=\"left\"></th>\n<th></th>\n<th align=\"left\"></th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\"></td>\n<td></td>\n<td align=\"left\"></td>\n</tr>\n</tbody></table>\n<style>\ntable th:nth-of-type(1){\nwidth: 30%;\n}\ntable th:nth-of-type(2){\nwidth: 60%\n;\n}\ntable th:nth-of-type(3){\nwidth: 10%;\n}\n</style>\n<script>$(\".header-02-3 a:first\").addClass('current');</script>\n\n<p>　　</p>\n","site":{"data":{}},"excerpt":"","more":"<table>\n<thead>\n<tr>\n<th align=\"left\"></th>\n<th></th>\n<th align=\"left\"></th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\"></td>\n<td></td>\n<td align=\"left\"></td>\n</tr>\n</tbody></table>\n<style>\ntable th:nth-of-type(1){\nwidth: 30%;\n}\ntable th:nth-of-type(2){\nwidth: 60%\n;\n}\ntable th:nth-of-type(3){\nwidth: 10%;\n}\n</style>\n<script>$(\".header-02-3 a:first\").addClass('current');</script>\n\n<p>　　</p>\n"},{"title":"工具","date":"2018-06-30T06:49:29.000Z","comments":0,"_content":"||||\n|:-|-|:--|\n|picdiet|[在线压缩图片,质量损失微乎其微，使用javaScript编写](https://www.picdiet.com/zh-cn)|<a href=\"https://www.picdiet.com/zh-cn\">picdiet.com</a>|\n|kokonoe77|[免费在线图床，不限流量，不限大小，不限时间](https://www.kokonoe77.ink/)|<a href=\"https://www.kokonoe77.ink/\">kokonoe77</a>|\n\n\n<style>\ntable th:nth-of-type(1){\nwidth: 30%;\n}\ntable th:nth-of-type(2){\nwidth: 60%\n;\n}\ntable th:nth-of-type(3){\nwidth: 10%;\n}\n</style>\n　　","source":"tool/index.md","raw":"---\ntitle: 工具\ndate: 2018-06-30 14:49:29\ncomments: false\n---\n||||\n|:-|-|:--|\n|picdiet|[在线压缩图片,质量损失微乎其微，使用javaScript编写](https://www.picdiet.com/zh-cn)|<a href=\"https://www.picdiet.com/zh-cn\">picdiet.com</a>|\n|kokonoe77|[免费在线图床，不限流量，不限大小，不限时间](https://www.kokonoe77.ink/)|<a href=\"https://www.kokonoe77.ink/\">kokonoe77</a>|\n\n\n<style>\ntable th:nth-of-type(1){\nwidth: 30%;\n}\ntable th:nth-of-type(2){\nwidth: 60%\n;\n}\ntable th:nth-of-type(3){\nwidth: 10%;\n}\n</style>\n　　","updated":"2021-08-17T01:17:38.420Z","path":"tool/index.html","layout":"page","_id":"cku6979xi000800uhhfcs49kt","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><table>\n<thead>\n<tr>\n<th align=\"left\"></th>\n<th></th>\n<th align=\"left\"></th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">picdiet</td>\n<td><a href=\"https://www.picdiet.com/zh-cn\">在线压缩图片,质量损失微乎其微，使用javaScript编写</a></td>\n<td align=\"left\"><a href=\"https://www.picdiet.com/zh-cn\">picdiet.com</a></td>\n</tr>\n<tr>\n<td align=\"left\">kokonoe77</td>\n<td><a href=\"https://www.kokonoe77.ink/\">免费在线图床，不限流量，不限大小，不限时间</a></td>\n<td align=\"left\"><a href=\"https://www.kokonoe77.ink/\">kokonoe77</a></td>\n</tr>\n</tbody></table>\n<style>\ntable th:nth-of-type(1){\nwidth: 30%;\n}\ntable th:nth-of-type(2){\nwidth: 60%\n;\n}\ntable th:nth-of-type(3){\nwidth: 10%;\n}\n</style>\n<p>　　</p>\n","site":{"data":{}},"excerpt":"","more":"<table>\n<thead>\n<tr>\n<th align=\"left\"></th>\n<th></th>\n<th align=\"left\"></th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">picdiet</td>\n<td><a href=\"https://www.picdiet.com/zh-cn\">在线压缩图片,质量损失微乎其微，使用javaScript编写</a></td>\n<td align=\"left\"><a href=\"https://www.picdiet.com/zh-cn\">picdiet.com</a></td>\n</tr>\n<tr>\n<td align=\"left\">kokonoe77</td>\n<td><a href=\"https://www.kokonoe77.ink/\">免费在线图床，不限流量，不限大小，不限时间</a></td>\n<td align=\"left\"><a href=\"https://www.kokonoe77.ink/\">kokonoe77</a></td>\n</tr>\n</tbody></table>\n<style>\ntable th:nth-of-type(1){\nwidth: 30%;\n}\ntable th:nth-of-type(2){\nwidth: 60%\n;\n}\ntable th:nth-of-type(3){\nwidth: 10%;\n}\n</style>\n<p>　　</p>\n"},{"date":"2018-07-08T13:28:30.000Z","title":"关于本站","comments":0,"_content":"> ## 建站历程\n\n\n\n\n> ## 个人感想\n\n\n\n\n\n\n> ## 主题\n\n\n\n\n\n> ## 版权声明：本站所有博文均可转载，但请保留署名和原文链接\n\n\n\n\n<script>$(\".header-02-3 a:first\").addClass('current');</script>","source":"site/index.md","raw":"---\ndate: 2018-07-08 21:28:30\ntitle: 关于本站\ncomments: false\n---\n> ## 建站历程\n\n\n\n\n> ## 个人感想\n\n\n\n\n\n\n> ## 主题\n\n\n\n\n\n> ## 版权声明：本站所有博文均可转载，但请保留署名和原文链接\n\n\n\n\n<script>$(\".header-02-3 a:first\").addClass('current');</script>","updated":"2021-08-17T01:17:38.420Z","path":"site/index.html","layout":"page","_id":"cku6979xk000a00uh2kwbe1co","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><blockquote>\n<h2 id=\"建站历程\"><a href=\"#建站历程\" class=\"headerlink\" title=\"建站历程\"></a>建站历程</h2></blockquote>\n<blockquote>\n<h2 id=\"个人感想\"><a href=\"#个人感想\" class=\"headerlink\" title=\"个人感想\"></a>个人感想</h2></blockquote>\n<blockquote>\n<h2 id=\"主题\"><a href=\"#主题\" class=\"headerlink\" title=\"主题\"></a>主题</h2></blockquote>\n<blockquote>\n<h2 id=\"版权声明：本站所有博文均可转载，但请保留署名和原文链接\"><a href=\"#版权声明：本站所有博文均可转载，但请保留署名和原文链接\" class=\"headerlink\" title=\"版权声明：本站所有博文均可转载，但请保留署名和原文链接\"></a>版权声明：本站所有博文均可转载，但请保留署名和原文链接</h2></blockquote>\n<script>$(\".header-02-3 a:first\").addClass('current');</script>","site":{"data":{}},"excerpt":"","more":"<blockquote>\n<h2 id=\"建站历程\"><a href=\"#建站历程\" class=\"headerlink\" title=\"建站历程\"></a>建站历程</h2></blockquote>\n<blockquote>\n<h2 id=\"个人感想\"><a href=\"#个人感想\" class=\"headerlink\" title=\"个人感想\"></a>个人感想</h2></blockquote>\n<blockquote>\n<h2 id=\"主题\"><a href=\"#主题\" class=\"headerlink\" title=\"主题\"></a>主题</h2></blockquote>\n<blockquote>\n<h2 id=\"版权声明：本站所有博文均可转载，但请保留署名和原文链接\"><a href=\"#版权声明：本站所有博文均可转载，但请保留署名和原文链接\" class=\"headerlink\" title=\"版权声明：本站所有博文均可转载，但请保留署名和原文链接\"></a>版权声明：本站所有博文均可转载，但请保留署名和原文链接</h2></blockquote>\n<script>$(\".header-02-3 a:first\").addClass('current');</script>"}],"Post":[{"title":"MVC 概要与环境配置","date":"2019-12-13T06:00:00.000Z","_content":"\n\n\n[TOC]\n\n\n\n## Spring Boot 简介\n\nSpring boot 来简化Spring 应用开发的一个框架\n\n整个Spring技术栈的一个大整合\n\nJ2EE 开发的一站式解决方案\n\n\n\n解决\n\n","source":"_posts/SpringBoot一.md","raw":"---\ntitle: MVC 概要与环境配置\ndate: 2019-12-13 14:00:00\ncategories: \n- java\ntags:\n- SpringBoot\n- java\n---\n\n\n\n[TOC]\n\n\n\n## Spring Boot 简介\n\nSpring boot 来简化Spring 应用开发的一个框架\n\n整个Spring技术栈的一个大整合\n\nJ2EE 开发的一站式解决方案\n\n\n\n解决\n\n","slug":"SpringBoot一","published":1,"updated":"2021-06-18T08:07:11.183Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cku6979x4000100uh1z911s1o","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><p>[TOC]</p>\n<h2 id=\"Spring-Boot-简介\"><a href=\"#Spring-Boot-简介\" class=\"headerlink\" title=\"Spring Boot 简介\"></a>Spring Boot 简介</h2><p>Spring boot 来简化Spring 应用开发的一个框架</p>\n<p>整个Spring技术栈的一个大整合</p>\n<p>J2EE 开发的一站式解决方案</p>\n<p>解决</p>\n","site":{"data":{}},"excerpt":"","more":"<p>[TOC]</p>\n<h2 id=\"Spring-Boot-简介\"><a href=\"#Spring-Boot-简介\" class=\"headerlink\" title=\"Spring Boot 简介\"></a>Spring Boot 简介</h2><p>Spring boot 来简化Spring 应用开发的一个框架</p>\n<p>整个Spring技术栈的一个大整合</p>\n<p>J2EE 开发的一站式解决方案</p>\n<p>解决</p>\n"},{"title":"MVC 概要与环境配置","date":"2019-12-13T06:00:00.000Z","_content":"\n\n\n[TOC]\n\n\n\n## 一、MVC 概要\n\nMVC 是模型(Model)、视图(View)、控制器(Controller)的简写、是一张软件设计的规范，用一种将业务逻辑、数据、显示分离的方法组织代码，MVC主要作用是降低了视图与业务逻辑间的双向耦合。MVC 不是一种设计模式，MVC 是一种架构模式。当然不同的MVC 存在差异。\n\n![image][mvc]\n\n\n\n\n\n## 二、Spring MVC 介绍\n\nSpring MVC是Spring Framework的一部分，是基于Java实现MVC的轻量级Web框架。Spring MVC的特点：\n\n1、 轻量\n2、 高效\n3、 与Spring兼容性好\n4、 功能强大\n  RESTful、数据验证、格式化、绑定机制、本地化、主题等\n5、 简洁灵活\n\n\n\nSpring的web框架围绕DispatcherServlet设计。 DispatcherServlet的作用是将请求分发到不同的处理器。从Spring 2.5开始，使用Java 5或者以上版本的用户可以采用基于注解的controller声明方式。官网上说Spring的web模块提供了大量独特的功能，包括:\n**清晰的角色划分**：控制器（controller）、验证器（validator）、 命令对象（command object）、表单对象（form object）、模型对象（model object）、 Servlet分发器（DispatcherServlet）、 处理器映射（handler mapping）、视图解析器（view resolver）等等。 每一个角色都可以由一个专门的对象来实现。\n\n**强大而直接的配置方式**：将框架类和应用程序类都能作为JavaBean配置，支持跨多个context的引用，例如，在web控制器中对业务对象和验证器（validator）的引用。\n\n**可适配、非侵入**：可以根据不同的应用场景，选择合适的控制器子类 （simple型、command型、form型、wizard型、multi-action型或者自定义），而不是从单一控制器 （比如Action/ActionForm）继承。\n\n**可重用的业务代码**：可以使用现有的业务对象作为命令或表单对象，而不需要去扩展某个特定框架的基类。\n\n**可定制的绑定（binding） 和验证（validation）**：比如将类型不匹配作为应用级的验证错误， 这可以保存错误的值。再比如本地化的日期和数字绑定等等。在其他某些框架中，你只能使用字符串表单对象， 需要手动解析它并转换到业务对象。\n\n**可定制的handler mapping和view resolution**：Spring提供从最简单的URL映射， 到复杂的、专用的定制策略。与某些web MVC框架强制开发人员使用单一特定技术相比，Spring显得更加灵活。\n\n**灵活的model转换**：在Springweb框架中，使用基于Map的 键/值对来达到轻易地与各种视图技术的集成。\n\n**可定制的本地化和主题（theme）解析**：支持在JSP中可选择地使用Spring标签库、支持JSTL、支持Velocity（不需要额外的中间层）等等。\n\n**简单而强大的JSP标签库（Spring Tag Library）**：支持包括诸如数据绑定和主题（theme） 之类的许多功能。它提供在标记方面的最大灵活性。\n\n**JSP表单标签库**：在Spring2.0中引入的表单标签库，使得在JSP中编写 表单更加容易。\n\n**Spring Bean的生命周期可以被限制在当前的HTTP Request或者HTTP Session**。 准确的说，这并非Spring MVC框架本身特性，而应归属于Sping MVC使用的WebApplicationContext容器。\n\n\n\n## 三、创建Spring MVC 项目\n\n\n\n\n\n## 图片\n\n[mvc]:data:image/png;base64,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","source":"_posts/SpringMVC一.md","raw":"---\ntitle: MVC 概要与环境配置\ndate: 2019-12-13 14:00:00\ncategories: \n- java\ntags:\n- springMVC\n- java\n---\n\n\n\n[TOC]\n\n\n\n## 一、MVC 概要\n\nMVC 是模型(Model)、视图(View)、控制器(Controller)的简写、是一张软件设计的规范，用一种将业务逻辑、数据、显示分离的方法组织代码，MVC主要作用是降低了视图与业务逻辑间的双向耦合。MVC 不是一种设计模式，MVC 是一种架构模式。当然不同的MVC 存在差异。\n\n![image][mvc]\n\n\n\n\n\n## 二、Spring MVC 介绍\n\nSpring MVC是Spring Framework的一部分，是基于Java实现MVC的轻量级Web框架。Spring MVC的特点：\n\n1、 轻量\n2、 高效\n3、 与Spring兼容性好\n4、 功能强大\n  RESTful、数据验证、格式化、绑定机制、本地化、主题等\n5、 简洁灵活\n\n\n\nSpring的web框架围绕DispatcherServlet设计。 DispatcherServlet的作用是将请求分发到不同的处理器。从Spring 2.5开始，使用Java 5或者以上版本的用户可以采用基于注解的controller声明方式。官网上说Spring的web模块提供了大量独特的功能，包括:\n**清晰的角色划分**：控制器（controller）、验证器（validator）、 命令对象（command object）、表单对象（form object）、模型对象（model object）、 Servlet分发器（DispatcherServlet）、 处理器映射（handler mapping）、视图解析器（view resolver）等等。 每一个角色都可以由一个专门的对象来实现。\n\n**强大而直接的配置方式**：将框架类和应用程序类都能作为JavaBean配置，支持跨多个context的引用，例如，在web控制器中对业务对象和验证器（validator）的引用。\n\n**可适配、非侵入**：可以根据不同的应用场景，选择合适的控制器子类 （simple型、command型、form型、wizard型、multi-action型或者自定义），而不是从单一控制器 （比如Action/ActionForm）继承。\n\n**可重用的业务代码**：可以使用现有的业务对象作为命令或表单对象，而不需要去扩展某个特定框架的基类。\n\n**可定制的绑定（binding） 和验证（validation）**：比如将类型不匹配作为应用级的验证错误， 这可以保存错误的值。再比如本地化的日期和数字绑定等等。在其他某些框架中，你只能使用字符串表单对象， 需要手动解析它并转换到业务对象。\n\n**可定制的handler mapping和view resolution**：Spring提供从最简单的URL映射， 到复杂的、专用的定制策略。与某些web MVC框架强制开发人员使用单一特定技术相比，Spring显得更加灵活。\n\n**灵活的model转换**：在Springweb框架中，使用基于Map的 键/值对来达到轻易地与各种视图技术的集成。\n\n**可定制的本地化和主题（theme）解析**：支持在JSP中可选择地使用Spring标签库、支持JSTL、支持Velocity（不需要额外的中间层）等等。\n\n**简单而强大的JSP标签库（Spring Tag Library）**：支持包括诸如数据绑定和主题（theme） 之类的许多功能。它提供在标记方面的最大灵活性。\n\n**JSP表单标签库**：在Spring2.0中引入的表单标签库，使得在JSP中编写 表单更加容易。\n\n**Spring Bean的生命周期可以被限制在当前的HTTP Request或者HTTP Session**。 准确的说，这并非Spring MVC框架本身特性，而应归属于Sping MVC使用的WebApplicationContext容器。\n\n\n\n## 三、创建Spring MVC 项目\n\n\n\n\n\n## 图片\n\n[mvc]:data:image/png;base64,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","slug":"SpringMVC一","published":1,"updated":"2021-06-18T08:07:11.183Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cku6979x8000300uh7n9sa6t8","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><p>[TOC]</p>\n<h2 id=\"一、MVC-概要\"><a href=\"#一、MVC-概要\" class=\"headerlink\" title=\"一、MVC 概要\"></a>一、MVC 概要</h2><p>MVC 是模型(Model)、视图(View)、控制器(Controller)的简写、是一张软件设计的规范，用一种将业务逻辑、数据、显示分离的方法组织代码，MVC主要作用是降低了视图与业务逻辑间的双向耦合。MVC 不是一种设计模式，MVC 是一种架构模式。当然不同的MVC 存在差异。</p>\n<p><img src=\"data:image/png;base64,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\" alt=\"image\"></p>\n<h2 id=\"二、Spring-MVC-介绍\"><a href=\"#二、Spring-MVC-介绍\" class=\"headerlink\" title=\"二、Spring MVC 介绍\"></a>二、Spring MVC 介绍</h2><p>Spring MVC是Spring Framework的一部分，是基于Java实现MVC的轻量级Web框架。Spring MVC的特点：</p>\n<p>1、 轻量<br>2、 高效<br>3、 与Spring兼容性好<br>4、 功能强大<br>  RESTful、数据验证、格式化、绑定机制、本地化、主题等<br>5、 简洁灵活</p>\n<p>Spring的web框架围绕DispatcherServlet设计。 DispatcherServlet的作用是将请求分发到不同的处理器。从Spring 2.5开始，使用Java 5或者以上版本的用户可以采用基于注解的controller声明方式。官网上说Spring的web模块提供了大量独特的功能，包括:<br><strong>清晰的角色划分</strong>：控制器（controller）、验证器（validator）、 命令对象（command object）、表单对象（form object）、模型对象（model object）、 Servlet分发器（DispatcherServlet）、 处理器映射（handler mapping）、视图解析器（view resolver）等等。 每一个角色都可以由一个专门的对象来实现。</p>\n<p><strong>强大而直接的配置方式</strong>：将框架类和应用程序类都能作为JavaBean配置，支持跨多个context的引用，例如，在web控制器中对业务对象和验证器（validator）的引用。</p>\n<p><strong>可适配、非侵入</strong>：可以根据不同的应用场景，选择合适的控制器子类 （simple型、command型、form型、wizard型、multi-action型或者自定义），而不是从单一控制器 （比如Action/ActionForm）继承。</p>\n<p><strong>可重用的业务代码</strong>：可以使用现有的业务对象作为命令或表单对象，而不需要去扩展某个特定框架的基类。</p>\n<p><strong>可定制的绑定（binding） 和验证（validation）</strong>：比如将类型不匹配作为应用级的验证错误， 这可以保存错误的值。再比如本地化的日期和数字绑定等等。在其他某些框架中，你只能使用字符串表单对象， 需要手动解析它并转换到业务对象。</p>\n<p><strong>可定制的handler mapping和view resolution</strong>：Spring提供从最简单的URL映射， 到复杂的、专用的定制策略。与某些web MVC框架强制开发人员使用单一特定技术相比，Spring显得更加灵活。</p>\n<p><strong>灵活的model转换</strong>：在Springweb框架中，使用基于Map的 键/值对来达到轻易地与各种视图技术的集成。</p>\n<p><strong>可定制的本地化和主题（theme）解析</strong>：支持在JSP中可选择地使用Spring标签库、支持JSTL、支持Velocity（不需要额外的中间层）等等。</p>\n<p><strong>简单而强大的JSP标签库（Spring Tag Library）</strong>：支持包括诸如数据绑定和主题（theme） 之类的许多功能。它提供在标记方面的最大灵活性。</p>\n<p><strong>JSP表单标签库</strong>：在Spring2.0中引入的表单标签库，使得在JSP中编写 表单更加容易。</p>\n<p><strong>Spring Bean的生命周期可以被限制在当前的HTTP Request或者HTTP Session</strong>。 准确的说，这并非Spring MVC框架本身特性，而应归属于Sping MVC使用的WebApplicationContext容器。</p>\n<h2 id=\"三、创建Spring-MVC-项目\"><a href=\"#三、创建Spring-MVC-项目\" class=\"headerlink\" title=\"三、创建Spring MVC 项目\"></a>三、创建Spring MVC 项目</h2><h2 id=\"图片\"><a href=\"#图片\" class=\"headerlink\" title=\"图片\"></a>图片</h2>","site":{"data":{}},"excerpt":"","more":"<p>[TOC]</p>\n<h2 id=\"一、MVC-概要\"><a href=\"#一、MVC-概要\" class=\"headerlink\" title=\"一、MVC 概要\"></a>一、MVC 概要</h2><p>MVC 是模型(Model)、视图(View)、控制器(Controller)的简写、是一张软件设计的规范，用一种将业务逻辑、数据、显示分离的方法组织代码，MVC主要作用是降低了视图与业务逻辑间的双向耦合。MVC 不是一种设计模式，MVC 是一种架构模式。当然不同的MVC 存在差异。</p>\n<p><img src=\"data:image/png;base64,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\" alt=\"image\"></p>\n<h2 id=\"二、Spring-MVC-介绍\"><a href=\"#二、Spring-MVC-介绍\" class=\"headerlink\" title=\"二、Spring MVC 介绍\"></a>二、Spring MVC 介绍</h2><p>Spring MVC是Spring Framework的一部分，是基于Java实现MVC的轻量级Web框架。Spring MVC的特点：</p>\n<p>1、 轻量<br>2、 高效<br>3、 与Spring兼容性好<br>4、 功能强大<br>  RESTful、数据验证、格式化、绑定机制、本地化、主题等<br>5、 简洁灵活</p>\n<p>Spring的web框架围绕DispatcherServlet设计。 DispatcherServlet的作用是将请求分发到不同的处理器。从Spring 2.5开始，使用Java 5或者以上版本的用户可以采用基于注解的controller声明方式。官网上说Spring的web模块提供了大量独特的功能，包括:<br><strong>清晰的角色划分</strong>：控制器（controller）、验证器（validator）、 命令对象（command object）、表单对象（form object）、模型对象（model object）、 Servlet分发器（DispatcherServlet）、 处理器映射（handler mapping）、视图解析器（view resolver）等等。 每一个角色都可以由一个专门的对象来实现。</p>\n<p><strong>强大而直接的配置方式</strong>：将框架类和应用程序类都能作为JavaBean配置，支持跨多个context的引用，例如，在web控制器中对业务对象和验证器（validator）的引用。</p>\n<p><strong>可适配、非侵入</strong>：可以根据不同的应用场景，选择合适的控制器子类 （simple型、command型、form型、wizard型、multi-action型或者自定义），而不是从单一控制器 （比如Action/ActionForm）继承。</p>\n<p><strong>可重用的业务代码</strong>：可以使用现有的业务对象作为命令或表单对象，而不需要去扩展某个特定框架的基类。</p>\n<p><strong>可定制的绑定（binding） 和验证（validation）</strong>：比如将类型不匹配作为应用级的验证错误， 这可以保存错误的值。再比如本地化的日期和数字绑定等等。在其他某些框架中，你只能使用字符串表单对象， 需要手动解析它并转换到业务对象。</p>\n<p><strong>可定制的handler mapping和view resolution</strong>：Spring提供从最简单的URL映射， 到复杂的、专用的定制策略。与某些web MVC框架强制开发人员使用单一特定技术相比，Spring显得更加灵活。</p>\n<p><strong>灵活的model转换</strong>：在Springweb框架中，使用基于Map的 键/值对来达到轻易地与各种视图技术的集成。</p>\n<p><strong>可定制的本地化和主题（theme）解析</strong>：支持在JSP中可选择地使用Spring标签库、支持JSTL、支持Velocity（不需要额外的中间层）等等。</p>\n<p><strong>简单而强大的JSP标签库（Spring Tag Library）</strong>：支持包括诸如数据绑定和主题（theme） 之类的许多功能。它提供在标记方面的最大灵活性。</p>\n<p><strong>JSP表单标签库</strong>：在Spring2.0中引入的表单标签库，使得在JSP中编写 表单更加容易。</p>\n<p><strong>Spring Bean的生命周期可以被限制在当前的HTTP Request或者HTTP Session</strong>。 准确的说，这并非Spring MVC框架本身特性，而应归属于Sping MVC使用的WebApplicationContext容器。</p>\n<h2 id=\"三、创建Spring-MVC-项目\"><a href=\"#三、创建Spring-MVC-项目\" class=\"headerlink\" title=\"三、创建Spring MVC 项目\"></a>三、创建Spring MVC 项目</h2><h2 id=\"图片\"><a href=\"#图片\" class=\"headerlink\" title=\"图片\"></a>图片</h2>"},{"title":"Flume安装","date":"2019-12-13T06:00:00.000Z","_content":"### 准备 flume\n\n安装jdk\n\n官方文档\n\n`http://flume.apache.org/FlumeUserGuide.html`\n\n下载地址\n\n```\nhttp://mirrors.tuna.tsinghua.edu.cn/apache/flume/1.8.0/apache-flume-1.8.0-bin.tar.gz\n\nhttp://mirrors.hust.edu.cn/apache/flume/1.8.0/apache-flume-1.8.0-bin.tar.gz \n\nhttp://mirrors.shu.edu.cn/apache/flume/1.8.0/apache-flume-1.8.0-bin.tar.gz \n\nhttp://mirrors.tuna.tsinghua.edu.cn/apache/flume/1.8.0/apache-flume-1.8.0-bin.tar.gz \n```\n\n修改hosts\n\n`vim /etc/hots`\n\n```\n192.168.1.12 node1\n192.168.1.12 node2\n192.168.1.12 node3\n```\n\n\n\n准备目录\n\n```\nmkdir -p /data/{aboutyunlog,flume_data/{checkpoint,data,log}}\n```\n\n\n\n### 安装flume\n\n```\ncd /usr/local/\ntar xf  apache-flume-1.8.0-bin.tar.gz \ncd  apache-flume-1.8.0-bin\n```\n\n### 修改配置文件\n\n```\n# set source\na1.sources.source1.type = spooldir\na1.sources.source1.spoolDir=/data/aboutyunlog\na1sources.source1.fileHeader = flase\n\n# set sink\na1.sinks.sink1.channel = channel1\na1.sinks.sink1.type = org.apache.flume.sink.kafka.KafkaSink\na1.sinks.sink1.kafka.topic = aboutyunlog\na1.sinks.sink1.kafka.bootstrap.servers = 192.168.1.12:9091,192.168.1.12:9092,192.168.1.12:9093\na1.sinks.sink1.kafka.flumeBatchSize = 20\na1.sinks.sink1.kafka.producer.acks = 1\na1.sinks.sink1.kafka.producer.linger.ms = 1\na1.sinks.sink1.kafka.producer.compression.type = snappy\n\n# set channel\na1.channels.channel1.type = file\na1.channels.channel1.checkpointDir = /data/flume_data/checkpoint\na1.channels.channel1.dataDirs= /data/flume_data/data\n\n# bind\na1.sources.source1.channels = channel1\na1.sinks.sink1.channel = channel1\n```\n\n### 启动 fulme\n\n```\nflume-ng agent --conf-file /usr/local/apache-flume-1.8.0-bin/conf/single_agent.conf --name a1 -Dflume.root.logger=INFO,console\n```\n\n### 测试\n\n在kafka上创建名为aboutyunlog的topic\n\n```\nkafka-topics.sh --zookeeper master:2181,slave1:2181,slave2:2181 --create --topic aboutyunlog --replication-factor 1 --partitions 3\n```\n\n启动flume\n\n```\nflume-ng agent --conf-file /usr/local/apache-flume-1.8.0-bin/conf/single_agent.conf --name a1 -Dflume.root.logger=INFO,console\n```\n\n创建一个kafka的consumer\n\nflume启动其实是启动了产生着，所以这里创建一个消费者。那么这个消费者创建到什么地方。\n\n我这里创建在node1 上。\n\n```\n/usr/local/kafka/kafka03/bin/kafka-console-consumer.sh --zookeeper node1:2181 --topic aboutyunlog --from-beginning\n```\n\n添加文件到flume source目录\n\n```\necho -e \"this is a test file! \\nhttp://www.aboutyun.com\\n20170710\">log.1\nmv log.1 /data/aboutyunlog/\n```\n\n在node1 上收到\n\n```\nthis is a test file! 666 \nhttp://www.aboutyun.com\n20170710\n\n```\n\n\n\n### supervisor 管理flume\n\n```\n[program:flume]  \ncommand=/usr/local/apache-flume-1.8.0-bin/bin/flume-ng agent --conf /usr/local/apache-flume-1.8.0-bin/conf --conf-file /usr/local/apache-flume-1.8.0-bin/conf/single_agent.conf  --name a1 -Dflume.root.logger=INFO,console   \ndirectory=/usr/local/apache-flume-1.8.0-bin  \nautostart = false\nautorestart = false\nredirect_stderr=true\nstdout_logfile=/data/flume_data/log/flume_dir.log\nstdout_logfile_maxbytes=100MB  \nstdout_logfile_backups=10  \n\n```\n\n主要参数说明:\n\n```\ncommand：启动程序使用的命令，可以是绝对路径或者相对路径\nprocess_name：一个python字符串表达式，用来表示supervisor进程启动的这个的名称，默认值是%(program_name)s\nnumprocs：Supervisor启动这个程序的多个实例，如果numprocs>1，则process_name的表达式必须包含%(process_num)s，默认是1\nnumprocs_start：一个int偏移值，当启动实例的时候用来计算numprocs的值\npriority：权重，可以控制程序启动和关闭时的顺序，权重越低：越早启动，越晚关闭。默认值是999\nautostart：如果设置为true，当supervisord启动的时候，进程会自动重启。\nautorestart：值可以是false、true、unexpected。false：进程不会自动重启，unexpected：当程序退出时的退出码不是exitcodes中定义的时，进程会重启，true：进程会无条件重启当退出的时候。\nstartsecs：程序启动后等待多长时间后才认为程序启动成功\nstartretries：supervisord尝试启动一个程序时尝试的次数。默认是3\nexitcodes：一个预期的退出返回码，默认是0,2。\nstopsignal：当收到stop请求的时候，发送信号给程序，默认是TERM信号，也可以是 HUP, INT, QUIT, KILL, USR1, or USR2。\nstopwaitsecs：在操作系统给supervisord发送SIGCHILD信号时等待的时间\nstopasgroup：如果设置为true，则会使supervisor发送停止信号到整个进程组\nkillasgroup：如果设置为true，则在给程序发送SIGKILL信号的时候，会发送到整个进程组，它的子进程也会受到影响。\nuser：如果supervisord以root运行，则会使用这个设置用户启动子程序\nredirect_stderr：如果设置为true，进程则会把标准错误输出到supervisord后台的标准输出文件描述符。\nstdout_logfile：把进程的标准输出写入文件中，如果stdout_logfile没有设置或者设置为AUTO，则supervisor会自动选择一个文件位置。\nstdout_logfile_maxbytes：标准输出log文件达到多少后自动进行轮转，单位是KB、MB、GB。如果设置为0则表示不限制日志文件大小\nstdout_logfile_backups：标准输出日志轮转备份的数量，默认是10，如果设置为0，则不备份\nstdout_capture_maxbytes：当进程处于stderr capture mode模式的时候，写入FIFO队列的最大bytes值，单位可以是KB、MB、GB\nstdout_events_enabled：如果设置为true，当进程在写它的stderr到文件描述符的时候，PROCESS_LOG_STDERR事件会被触发\nstderr_logfile：把进程的错误日志输出一个文件中，除非redirect_stderr参数被设置为true\nstderr_logfile_maxbytes：错误log文件达到多少后自动进行轮转，单位是KB、MB、GB。如果设置为0则表示不限制日志文件大小\nstderr_logfile_backups：错误日志轮转备份的数量，默认是10，如果设置为0，则不备份\nstderr_capture_maxbytes：当进程处于stderr capture mode模式的时候，写入FIFO队列的最大bytes值，单位可以是KB、MB、GB\nstderr_events_enabled：如果设置为true，当进程在写它的stderr到文件描述符的时候，PROCESS_LOG_STDERR事件会被触发\nenvironment：一个k/v对的list列表\ndirectory：supervisord在生成子进程的时候会切换到该目录\numask：设置进程的umask\nserverurl：是否允许子进程和内部的HTTP服务通讯，如果设置为AUTO，supervisor会自动的构造一个url\n```\n\n\n\n","source":"_posts/flume安装.md","raw":"---\ntitle: Flume安装\ndate: 2019-12-13 14:00:00\ncategories: \n- bigdata\ntags:\n- flume\n---\n### 准备 flume\n\n安装jdk\n\n官方文档\n\n`http://flume.apache.org/FlumeUserGuide.html`\n\n下载地址\n\n```\nhttp://mirrors.tuna.tsinghua.edu.cn/apache/flume/1.8.0/apache-flume-1.8.0-bin.tar.gz\n\nhttp://mirrors.hust.edu.cn/apache/flume/1.8.0/apache-flume-1.8.0-bin.tar.gz \n\nhttp://mirrors.shu.edu.cn/apache/flume/1.8.0/apache-flume-1.8.0-bin.tar.gz \n\nhttp://mirrors.tuna.tsinghua.edu.cn/apache/flume/1.8.0/apache-flume-1.8.0-bin.tar.gz \n```\n\n修改hosts\n\n`vim /etc/hots`\n\n```\n192.168.1.12 node1\n192.168.1.12 node2\n192.168.1.12 node3\n```\n\n\n\n准备目录\n\n```\nmkdir -p /data/{aboutyunlog,flume_data/{checkpoint,data,log}}\n```\n\n\n\n### 安装flume\n\n```\ncd /usr/local/\ntar xf  apache-flume-1.8.0-bin.tar.gz \ncd  apache-flume-1.8.0-bin\n```\n\n### 修改配置文件\n\n```\n# set source\na1.sources.source1.type = spooldir\na1.sources.source1.spoolDir=/data/aboutyunlog\na1sources.source1.fileHeader = flase\n\n# set sink\na1.sinks.sink1.channel = channel1\na1.sinks.sink1.type = org.apache.flume.sink.kafka.KafkaSink\na1.sinks.sink1.kafka.topic = aboutyunlog\na1.sinks.sink1.kafka.bootstrap.servers = 192.168.1.12:9091,192.168.1.12:9092,192.168.1.12:9093\na1.sinks.sink1.kafka.flumeBatchSize = 20\na1.sinks.sink1.kafka.producer.acks = 1\na1.sinks.sink1.kafka.producer.linger.ms = 1\na1.sinks.sink1.kafka.producer.compression.type = snappy\n\n# set channel\na1.channels.channel1.type = file\na1.channels.channel1.checkpointDir = /data/flume_data/checkpoint\na1.channels.channel1.dataDirs= /data/flume_data/data\n\n# bind\na1.sources.source1.channels = channel1\na1.sinks.sink1.channel = channel1\n```\n\n### 启动 fulme\n\n```\nflume-ng agent --conf-file /usr/local/apache-flume-1.8.0-bin/conf/single_agent.conf --name a1 -Dflume.root.logger=INFO,console\n```\n\n### 测试\n\n在kafka上创建名为aboutyunlog的topic\n\n```\nkafka-topics.sh --zookeeper master:2181,slave1:2181,slave2:2181 --create --topic aboutyunlog --replication-factor 1 --partitions 3\n```\n\n启动flume\n\n```\nflume-ng agent --conf-file /usr/local/apache-flume-1.8.0-bin/conf/single_agent.conf --name a1 -Dflume.root.logger=INFO,console\n```\n\n创建一个kafka的consumer\n\nflume启动其实是启动了产生着，所以这里创建一个消费者。那么这个消费者创建到什么地方。\n\n我这里创建在node1 上。\n\n```\n/usr/local/kafka/kafka03/bin/kafka-console-consumer.sh --zookeeper node1:2181 --topic aboutyunlog --from-beginning\n```\n\n添加文件到flume source目录\n\n```\necho -e \"this is a test file! \\nhttp://www.aboutyun.com\\n20170710\">log.1\nmv log.1 /data/aboutyunlog/\n```\n\n在node1 上收到\n\n```\nthis is a test file! 666 \nhttp://www.aboutyun.com\n20170710\n\n```\n\n\n\n### supervisor 管理flume\n\n```\n[program:flume]  \ncommand=/usr/local/apache-flume-1.8.0-bin/bin/flume-ng agent --conf /usr/local/apache-flume-1.8.0-bin/conf --conf-file /usr/local/apache-flume-1.8.0-bin/conf/single_agent.conf  --name a1 -Dflume.root.logger=INFO,console   \ndirectory=/usr/local/apache-flume-1.8.0-bin  \nautostart = false\nautorestart = false\nredirect_stderr=true\nstdout_logfile=/data/flume_data/log/flume_dir.log\nstdout_logfile_maxbytes=100MB  \nstdout_logfile_backups=10  \n\n```\n\n主要参数说明:\n\n```\ncommand：启动程序使用的命令，可以是绝对路径或者相对路径\nprocess_name：一个python字符串表达式，用来表示supervisor进程启动的这个的名称，默认值是%(program_name)s\nnumprocs：Supervisor启动这个程序的多个实例，如果numprocs>1，则process_name的表达式必须包含%(process_num)s，默认是1\nnumprocs_start：一个int偏移值，当启动实例的时候用来计算numprocs的值\npriority：权重，可以控制程序启动和关闭时的顺序，权重越低：越早启动，越晚关闭。默认值是999\nautostart：如果设置为true，当supervisord启动的时候，进程会自动重启。\nautorestart：值可以是false、true、unexpected。false：进程不会自动重启，unexpected：当程序退出时的退出码不是exitcodes中定义的时，进程会重启，true：进程会无条件重启当退出的时候。\nstartsecs：程序启动后等待多长时间后才认为程序启动成功\nstartretries：supervisord尝试启动一个程序时尝试的次数。默认是3\nexitcodes：一个预期的退出返回码，默认是0,2。\nstopsignal：当收到stop请求的时候，发送信号给程序，默认是TERM信号，也可以是 HUP, INT, QUIT, KILL, USR1, or USR2。\nstopwaitsecs：在操作系统给supervisord发送SIGCHILD信号时等待的时间\nstopasgroup：如果设置为true，则会使supervisor发送停止信号到整个进程组\nkillasgroup：如果设置为true，则在给程序发送SIGKILL信号的时候，会发送到整个进程组，它的子进程也会受到影响。\nuser：如果supervisord以root运行，则会使用这个设置用户启动子程序\nredirect_stderr：如果设置为true，进程则会把标准错误输出到supervisord后台的标准输出文件描述符。\nstdout_logfile：把进程的标准输出写入文件中，如果stdout_logfile没有设置或者设置为AUTO，则supervisor会自动选择一个文件位置。\nstdout_logfile_maxbytes：标准输出log文件达到多少后自动进行轮转，单位是KB、MB、GB。如果设置为0则表示不限制日志文件大小\nstdout_logfile_backups：标准输出日志轮转备份的数量，默认是10，如果设置为0，则不备份\nstdout_capture_maxbytes：当进程处于stderr capture mode模式的时候，写入FIFO队列的最大bytes值，单位可以是KB、MB、GB\nstdout_events_enabled：如果设置为true，当进程在写它的stderr到文件描述符的时候，PROCESS_LOG_STDERR事件会被触发\nstderr_logfile：把进程的错误日志输出一个文件中，除非redirect_stderr参数被设置为true\nstderr_logfile_maxbytes：错误log文件达到多少后自动进行轮转，单位是KB、MB、GB。如果设置为0则表示不限制日志文件大小\nstderr_logfile_backups：错误日志轮转备份的数量，默认是10，如果设置为0，则不备份\nstderr_capture_maxbytes：当进程处于stderr capture mode模式的时候，写入FIFO队列的最大bytes值，单位可以是KB、MB、GB\nstderr_events_enabled：如果设置为true，当进程在写它的stderr到文件描述符的时候，PROCESS_LOG_STDERR事件会被触发\nenvironment：一个k/v对的list列表\ndirectory：supervisord在生成子进程的时候会切换到该目录\numask：设置进程的umask\nserverurl：是否允许子进程和内部的HTTP服务通讯，如果设置为AUTO，supervisor会自动的构造一个url\n```\n\n\n\n","slug":"flume安装","published":1,"updated":"2021-06-18T08:07:11.187Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cku6979xh000700uh0o04diki","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><h3 id=\"准备-flume\"><a href=\"#准备-flume\" class=\"headerlink\" title=\"准备 flume\"></a>准备 flume</h3><p>安装jdk</p>\n<p>官方文档</p>\n<p><code>http://flume.apache.org/FlumeUserGuide.html</code></p>\n<p>下载地址</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">http:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;apache&#x2F;flume&#x2F;1.8.0&#x2F;apache-flume-1.8.0-bin.tar.gz</span><br><span class=\"line\"></span><br><span class=\"line\">http:&#x2F;&#x2F;mirrors.hust.edu.cn&#x2F;apache&#x2F;flume&#x2F;1.8.0&#x2F;apache-flume-1.8.0-bin.tar.gz </span><br><span class=\"line\"></span><br><span class=\"line\">http:&#x2F;&#x2F;mirrors.shu.edu.cn&#x2F;apache&#x2F;flume&#x2F;1.8.0&#x2F;apache-flume-1.8.0-bin.tar.gz </span><br><span class=\"line\"></span><br><span class=\"line\">http:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;apache&#x2F;flume&#x2F;1.8.0&#x2F;apache-flume-1.8.0-bin.tar.gz </span><br></pre></td></tr></table></figure>\n\n<p>修改hosts</p>\n<p><code>vim /etc/hots</code></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">192.168.1.12 node1</span><br><span class=\"line\">192.168.1.12 node2</span><br><span class=\"line\">192.168.1.12 node3</span><br></pre></td></tr></table></figure>\n\n\n\n<p>准备目录</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir -p &#x2F;data&#x2F;&#123;aboutyunlog,flume_data&#x2F;&#123;checkpoint,data,log&#125;&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"安装flume\"><a href=\"#安装flume\" class=\"headerlink\" title=\"安装flume\"></a>安装flume</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd &#x2F;usr&#x2F;local&#x2F;</span><br><span class=\"line\">tar xf  apache-flume-1.8.0-bin.tar.gz </span><br><span class=\"line\">cd  apache-flume-1.8.0-bin</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"修改配置文件\"><a href=\"#修改配置文件\" class=\"headerlink\" title=\"修改配置文件\"></a>修改配置文件</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># set source</span><br><span class=\"line\">a1.sources.source1.type &#x3D; spooldir</span><br><span class=\"line\">a1.sources.source1.spoolDir&#x3D;&#x2F;data&#x2F;aboutyunlog</span><br><span class=\"line\">a1sources.source1.fileHeader &#x3D; flase</span><br><span class=\"line\"></span><br><span class=\"line\"># set sink</span><br><span class=\"line\">a1.sinks.sink1.channel &#x3D; channel1</span><br><span class=\"line\">a1.sinks.sink1.type &#x3D; org.apache.flume.sink.kafka.KafkaSink</span><br><span class=\"line\">a1.sinks.sink1.kafka.topic &#x3D; aboutyunlog</span><br><span class=\"line\">a1.sinks.sink1.kafka.bootstrap.servers &#x3D; 192.168.1.12:9091,192.168.1.12:9092,192.168.1.12:9093</span><br><span class=\"line\">a1.sinks.sink1.kafka.flumeBatchSize &#x3D; 20</span><br><span class=\"line\">a1.sinks.sink1.kafka.producer.acks &#x3D; 1</span><br><span class=\"line\">a1.sinks.sink1.kafka.producer.linger.ms &#x3D; 1</span><br><span class=\"line\">a1.sinks.sink1.kafka.producer.compression.type &#x3D; snappy</span><br><span class=\"line\"></span><br><span class=\"line\"># set channel</span><br><span class=\"line\">a1.channels.channel1.type &#x3D; file</span><br><span class=\"line\">a1.channels.channel1.checkpointDir &#x3D; &#x2F;data&#x2F;flume_data&#x2F;checkpoint</span><br><span class=\"line\">a1.channels.channel1.dataDirs&#x3D; &#x2F;data&#x2F;flume_data&#x2F;data</span><br><span class=\"line\"></span><br><span class=\"line\"># bind</span><br><span class=\"line\">a1.sources.source1.channels &#x3D; channel1</span><br><span class=\"line\">a1.sinks.sink1.channel &#x3D; channel1</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"启动-fulme\"><a href=\"#启动-fulme\" class=\"headerlink\" title=\"启动 fulme\"></a>启动 fulme</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">flume-ng agent --conf-file &#x2F;usr&#x2F;local&#x2F;apache-flume-1.8.0-bin&#x2F;conf&#x2F;single_agent.conf --name a1 -Dflume.root.logger&#x3D;INFO,console</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"测试\"><a href=\"#测试\" class=\"headerlink\" title=\"测试\"></a>测试</h3><p>在kafka上创建名为aboutyunlog的topic</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kafka-topics.sh --zookeeper master:2181,slave1:2181,slave2:2181 --create --topic aboutyunlog --replication-factor 1 --partitions 3</span><br></pre></td></tr></table></figure>\n\n<p>启动flume</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">flume-ng agent --conf-file &#x2F;usr&#x2F;local&#x2F;apache-flume-1.8.0-bin&#x2F;conf&#x2F;single_agent.conf --name a1 -Dflume.root.logger&#x3D;INFO,console</span><br></pre></td></tr></table></figure>\n\n<p>创建一个kafka的consumer</p>\n<p>flume启动其实是启动了产生着，所以这里创建一个消费者。那么这个消费者创建到什么地方。</p>\n<p>我这里创建在node1 上。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;usr&#x2F;local&#x2F;kafka&#x2F;kafka03&#x2F;bin&#x2F;kafka-console-consumer.sh --zookeeper node1:2181 --topic aboutyunlog --from-beginning</span><br></pre></td></tr></table></figure>\n\n<p>添加文件到flume source目录</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">echo -e &quot;this is a test file! \\nhttp:&#x2F;&#x2F;www.aboutyun.com\\n20170710&quot;&gt;log.1</span><br><span class=\"line\">mv log.1 &#x2F;data&#x2F;aboutyunlog&#x2F;</span><br></pre></td></tr></table></figure>\n\n<p>在node1 上收到</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">this is a test file! 666 </span><br><span class=\"line\">http:&#x2F;&#x2F;www.aboutyun.com</span><br><span class=\"line\">20170710</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"supervisor-管理flume\"><a href=\"#supervisor-管理flume\" class=\"headerlink\" title=\"supervisor 管理flume\"></a>supervisor 管理flume</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[program:flume]  </span><br><span class=\"line\">command&#x3D;&#x2F;usr&#x2F;local&#x2F;apache-flume-1.8.0-bin&#x2F;bin&#x2F;flume-ng agent --conf &#x2F;usr&#x2F;local&#x2F;apache-flume-1.8.0-bin&#x2F;conf --conf-file &#x2F;usr&#x2F;local&#x2F;apache-flume-1.8.0-bin&#x2F;conf&#x2F;single_agent.conf  --name a1 -Dflume.root.logger&#x3D;INFO,console   </span><br><span class=\"line\">directory&#x3D;&#x2F;usr&#x2F;local&#x2F;apache-flume-1.8.0-bin  </span><br><span class=\"line\">autostart &#x3D; false</span><br><span class=\"line\">autorestart &#x3D; false</span><br><span class=\"line\">redirect_stderr&#x3D;true</span><br><span class=\"line\">stdout_logfile&#x3D;&#x2F;data&#x2F;flume_data&#x2F;log&#x2F;flume_dir.log</span><br><span class=\"line\">stdout_logfile_maxbytes&#x3D;100MB  </span><br><span class=\"line\">stdout_logfile_backups&#x3D;10  </span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>主要参数说明:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">command：启动程序使用的命令，可以是绝对路径或者相对路径</span><br><span class=\"line\">process_name：一个python字符串表达式，用来表示supervisor进程启动的这个的名称，默认值是%(program_name)s</span><br><span class=\"line\">numprocs：Supervisor启动这个程序的多个实例，如果numprocs&gt;1，则process_name的表达式必须包含%(process_num)s，默认是1</span><br><span class=\"line\">numprocs_start：一个int偏移值，当启动实例的时候用来计算numprocs的值</span><br><span class=\"line\">priority：权重，可以控制程序启动和关闭时的顺序，权重越低：越早启动，越晚关闭。默认值是999</span><br><span class=\"line\">autostart：如果设置为true，当supervisord启动的时候，进程会自动重启。</span><br><span class=\"line\">autorestart：值可以是false、true、unexpected。false：进程不会自动重启，unexpected：当程序退出时的退出码不是exitcodes中定义的时，进程会重启，true：进程会无条件重启当退出的时候。</span><br><span class=\"line\">startsecs：程序启动后等待多长时间后才认为程序启动成功</span><br><span class=\"line\">startretries：supervisord尝试启动一个程序时尝试的次数。默认是3</span><br><span class=\"line\">exitcodes：一个预期的退出返回码，默认是0,2。</span><br><span class=\"line\">stopsignal：当收到stop请求的时候，发送信号给程序，默认是TERM信号，也可以是 HUP, INT, QUIT, KILL, USR1, or USR2。</span><br><span class=\"line\">stopwaitsecs：在操作系统给supervisord发送SIGCHILD信号时等待的时间</span><br><span class=\"line\">stopasgroup：如果设置为true，则会使supervisor发送停止信号到整个进程组</span><br><span class=\"line\">killasgroup：如果设置为true，则在给程序发送SIGKILL信号的时候，会发送到整个进程组，它的子进程也会受到影响。</span><br><span class=\"line\">user：如果supervisord以root运行，则会使用这个设置用户启动子程序</span><br><span class=\"line\">redirect_stderr：如果设置为true，进程则会把标准错误输出到supervisord后台的标准输出文件描述符。</span><br><span class=\"line\">stdout_logfile：把进程的标准输出写入文件中，如果stdout_logfile没有设置或者设置为AUTO，则supervisor会自动选择一个文件位置。</span><br><span class=\"line\">stdout_logfile_maxbytes：标准输出log文件达到多少后自动进行轮转，单位是KB、MB、GB。如果设置为0则表示不限制日志文件大小</span><br><span class=\"line\">stdout_logfile_backups：标准输出日志轮转备份的数量，默认是10，如果设置为0，则不备份</span><br><span class=\"line\">stdout_capture_maxbytes：当进程处于stderr capture mode模式的时候，写入FIFO队列的最大bytes值，单位可以是KB、MB、GB</span><br><span class=\"line\">stdout_events_enabled：如果设置为true，当进程在写它的stderr到文件描述符的时候，PROCESS_LOG_STDERR事件会被触发</span><br><span class=\"line\">stderr_logfile：把进程的错误日志输出一个文件中，除非redirect_stderr参数被设置为true</span><br><span class=\"line\">stderr_logfile_maxbytes：错误log文件达到多少后自动进行轮转，单位是KB、MB、GB。如果设置为0则表示不限制日志文件大小</span><br><span class=\"line\">stderr_logfile_backups：错误日志轮转备份的数量，默认是10，如果设置为0，则不备份</span><br><span class=\"line\">stderr_capture_maxbytes：当进程处于stderr capture mode模式的时候，写入FIFO队列的最大bytes值，单位可以是KB、MB、GB</span><br><span class=\"line\">stderr_events_enabled：如果设置为true，当进程在写它的stderr到文件描述符的时候，PROCESS_LOG_STDERR事件会被触发</span><br><span class=\"line\">environment：一个k&#x2F;v对的list列表</span><br><span class=\"line\">directory：supervisord在生成子进程的时候会切换到该目录</span><br><span class=\"line\">umask：设置进程的umask</span><br><span class=\"line\">serverurl：是否允许子进程和内部的HTTP服务通讯，如果设置为AUTO，supervisor会自动的构造一个url</span><br></pre></td></tr></table></figure>\n\n\n\n","site":{"data":{}},"excerpt":"","more":"<h3 id=\"准备-flume\"><a href=\"#准备-flume\" class=\"headerlink\" title=\"准备 flume\"></a>准备 flume</h3><p>安装jdk</p>\n<p>官方文档</p>\n<p><code>http://flume.apache.org/FlumeUserGuide.html</code></p>\n<p>下载地址</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">http:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;apache&#x2F;flume&#x2F;1.8.0&#x2F;apache-flume-1.8.0-bin.tar.gz</span><br><span class=\"line\"></span><br><span class=\"line\">http:&#x2F;&#x2F;mirrors.hust.edu.cn&#x2F;apache&#x2F;flume&#x2F;1.8.0&#x2F;apache-flume-1.8.0-bin.tar.gz </span><br><span class=\"line\"></span><br><span class=\"line\">http:&#x2F;&#x2F;mirrors.shu.edu.cn&#x2F;apache&#x2F;flume&#x2F;1.8.0&#x2F;apache-flume-1.8.0-bin.tar.gz </span><br><span class=\"line\"></span><br><span class=\"line\">http:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;apache&#x2F;flume&#x2F;1.8.0&#x2F;apache-flume-1.8.0-bin.tar.gz </span><br></pre></td></tr></table></figure>\n\n<p>修改hosts</p>\n<p><code>vim /etc/hots</code></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">192.168.1.12 node1</span><br><span class=\"line\">192.168.1.12 node2</span><br><span class=\"line\">192.168.1.12 node3</span><br></pre></td></tr></table></figure>\n\n\n\n<p>准备目录</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir -p &#x2F;data&#x2F;&#123;aboutyunlog,flume_data&#x2F;&#123;checkpoint,data,log&#125;&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"安装flume\"><a href=\"#安装flume\" class=\"headerlink\" title=\"安装flume\"></a>安装flume</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd &#x2F;usr&#x2F;local&#x2F;</span><br><span class=\"line\">tar xf  apache-flume-1.8.0-bin.tar.gz </span><br><span class=\"line\">cd  apache-flume-1.8.0-bin</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"修改配置文件\"><a href=\"#修改配置文件\" class=\"headerlink\" title=\"修改配置文件\"></a>修改配置文件</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># set source</span><br><span class=\"line\">a1.sources.source1.type &#x3D; spooldir</span><br><span class=\"line\">a1.sources.source1.spoolDir&#x3D;&#x2F;data&#x2F;aboutyunlog</span><br><span class=\"line\">a1sources.source1.fileHeader &#x3D; flase</span><br><span class=\"line\"></span><br><span class=\"line\"># set sink</span><br><span class=\"line\">a1.sinks.sink1.channel &#x3D; channel1</span><br><span class=\"line\">a1.sinks.sink1.type &#x3D; org.apache.flume.sink.kafka.KafkaSink</span><br><span class=\"line\">a1.sinks.sink1.kafka.topic &#x3D; aboutyunlog</span><br><span class=\"line\">a1.sinks.sink1.kafka.bootstrap.servers &#x3D; 192.168.1.12:9091,192.168.1.12:9092,192.168.1.12:9093</span><br><span class=\"line\">a1.sinks.sink1.kafka.flumeBatchSize &#x3D; 20</span><br><span class=\"line\">a1.sinks.sink1.kafka.producer.acks &#x3D; 1</span><br><span class=\"line\">a1.sinks.sink1.kafka.producer.linger.ms &#x3D; 1</span><br><span class=\"line\">a1.sinks.sink1.kafka.producer.compression.type &#x3D; snappy</span><br><span class=\"line\"></span><br><span class=\"line\"># set channel</span><br><span class=\"line\">a1.channels.channel1.type &#x3D; file</span><br><span class=\"line\">a1.channels.channel1.checkpointDir &#x3D; &#x2F;data&#x2F;flume_data&#x2F;checkpoint</span><br><span class=\"line\">a1.channels.channel1.dataDirs&#x3D; &#x2F;data&#x2F;flume_data&#x2F;data</span><br><span class=\"line\"></span><br><span class=\"line\"># bind</span><br><span class=\"line\">a1.sources.source1.channels &#x3D; channel1</span><br><span class=\"line\">a1.sinks.sink1.channel &#x3D; channel1</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"启动-fulme\"><a href=\"#启动-fulme\" class=\"headerlink\" title=\"启动 fulme\"></a>启动 fulme</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">flume-ng agent --conf-file &#x2F;usr&#x2F;local&#x2F;apache-flume-1.8.0-bin&#x2F;conf&#x2F;single_agent.conf --name a1 -Dflume.root.logger&#x3D;INFO,console</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"测试\"><a href=\"#测试\" class=\"headerlink\" title=\"测试\"></a>测试</h3><p>在kafka上创建名为aboutyunlog的topic</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kafka-topics.sh --zookeeper master:2181,slave1:2181,slave2:2181 --create --topic aboutyunlog --replication-factor 1 --partitions 3</span><br></pre></td></tr></table></figure>\n\n<p>启动flume</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">flume-ng agent --conf-file &#x2F;usr&#x2F;local&#x2F;apache-flume-1.8.0-bin&#x2F;conf&#x2F;single_agent.conf --name a1 -Dflume.root.logger&#x3D;INFO,console</span><br></pre></td></tr></table></figure>\n\n<p>创建一个kafka的consumer</p>\n<p>flume启动其实是启动了产生着，所以这里创建一个消费者。那么这个消费者创建到什么地方。</p>\n<p>我这里创建在node1 上。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;usr&#x2F;local&#x2F;kafka&#x2F;kafka03&#x2F;bin&#x2F;kafka-console-consumer.sh --zookeeper node1:2181 --topic aboutyunlog --from-beginning</span><br></pre></td></tr></table></figure>\n\n<p>添加文件到flume source目录</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">echo -e &quot;this is a test file! \\nhttp:&#x2F;&#x2F;www.aboutyun.com\\n20170710&quot;&gt;log.1</span><br><span class=\"line\">mv log.1 &#x2F;data&#x2F;aboutyunlog&#x2F;</span><br></pre></td></tr></table></figure>\n\n<p>在node1 上收到</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">this is a test file! 666 </span><br><span class=\"line\">http:&#x2F;&#x2F;www.aboutyun.com</span><br><span class=\"line\">20170710</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"supervisor-管理flume\"><a href=\"#supervisor-管理flume\" class=\"headerlink\" title=\"supervisor 管理flume\"></a>supervisor 管理flume</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[program:flume]  </span><br><span class=\"line\">command&#x3D;&#x2F;usr&#x2F;local&#x2F;apache-flume-1.8.0-bin&#x2F;bin&#x2F;flume-ng agent --conf &#x2F;usr&#x2F;local&#x2F;apache-flume-1.8.0-bin&#x2F;conf --conf-file &#x2F;usr&#x2F;local&#x2F;apache-flume-1.8.0-bin&#x2F;conf&#x2F;single_agent.conf  --name a1 -Dflume.root.logger&#x3D;INFO,console   </span><br><span class=\"line\">directory&#x3D;&#x2F;usr&#x2F;local&#x2F;apache-flume-1.8.0-bin  </span><br><span class=\"line\">autostart &#x3D; false</span><br><span class=\"line\">autorestart &#x3D; false</span><br><span class=\"line\">redirect_stderr&#x3D;true</span><br><span class=\"line\">stdout_logfile&#x3D;&#x2F;data&#x2F;flume_data&#x2F;log&#x2F;flume_dir.log</span><br><span class=\"line\">stdout_logfile_maxbytes&#x3D;100MB  </span><br><span class=\"line\">stdout_logfile_backups&#x3D;10  </span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>主要参数说明:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">command：启动程序使用的命令，可以是绝对路径或者相对路径</span><br><span class=\"line\">process_name：一个python字符串表达式，用来表示supervisor进程启动的这个的名称，默认值是%(program_name)s</span><br><span class=\"line\">numprocs：Supervisor启动这个程序的多个实例，如果numprocs&gt;1，则process_name的表达式必须包含%(process_num)s，默认是1</span><br><span class=\"line\">numprocs_start：一个int偏移值，当启动实例的时候用来计算numprocs的值</span><br><span class=\"line\">priority：权重，可以控制程序启动和关闭时的顺序，权重越低：越早启动，越晚关闭。默认值是999</span><br><span class=\"line\">autostart：如果设置为true，当supervisord启动的时候，进程会自动重启。</span><br><span class=\"line\">autorestart：值可以是false、true、unexpected。false：进程不会自动重启，unexpected：当程序退出时的退出码不是exitcodes中定义的时，进程会重启，true：进程会无条件重启当退出的时候。</span><br><span class=\"line\">startsecs：程序启动后等待多长时间后才认为程序启动成功</span><br><span class=\"line\">startretries：supervisord尝试启动一个程序时尝试的次数。默认是3</span><br><span class=\"line\">exitcodes：一个预期的退出返回码，默认是0,2。</span><br><span class=\"line\">stopsignal：当收到stop请求的时候，发送信号给程序，默认是TERM信号，也可以是 HUP, INT, QUIT, KILL, USR1, or USR2。</span><br><span class=\"line\">stopwaitsecs：在操作系统给supervisord发送SIGCHILD信号时等待的时间</span><br><span class=\"line\">stopasgroup：如果设置为true，则会使supervisor发送停止信号到整个进程组</span><br><span class=\"line\">killasgroup：如果设置为true，则在给程序发送SIGKILL信号的时候，会发送到整个进程组，它的子进程也会受到影响。</span><br><span class=\"line\">user：如果supervisord以root运行，则会使用这个设置用户启动子程序</span><br><span class=\"line\">redirect_stderr：如果设置为true，进程则会把标准错误输出到supervisord后台的标准输出文件描述符。</span><br><span class=\"line\">stdout_logfile：把进程的标准输出写入文件中，如果stdout_logfile没有设置或者设置为AUTO，则supervisor会自动选择一个文件位置。</span><br><span class=\"line\">stdout_logfile_maxbytes：标准输出log文件达到多少后自动进行轮转，单位是KB、MB、GB。如果设置为0则表示不限制日志文件大小</span><br><span class=\"line\">stdout_logfile_backups：标准输出日志轮转备份的数量，默认是10，如果设置为0，则不备份</span><br><span class=\"line\">stdout_capture_maxbytes：当进程处于stderr capture mode模式的时候，写入FIFO队列的最大bytes值，单位可以是KB、MB、GB</span><br><span class=\"line\">stdout_events_enabled：如果设置为true，当进程在写它的stderr到文件描述符的时候，PROCESS_LOG_STDERR事件会被触发</span><br><span class=\"line\">stderr_logfile：把进程的错误日志输出一个文件中，除非redirect_stderr参数被设置为true</span><br><span class=\"line\">stderr_logfile_maxbytes：错误log文件达到多少后自动进行轮转，单位是KB、MB、GB。如果设置为0则表示不限制日志文件大小</span><br><span class=\"line\">stderr_logfile_backups：错误日志轮转备份的数量，默认是10，如果设置为0，则不备份</span><br><span class=\"line\">stderr_capture_maxbytes：当进程处于stderr capture mode模式的时候，写入FIFO队列的最大bytes值，单位可以是KB、MB、GB</span><br><span class=\"line\">stderr_events_enabled：如果设置为true，当进程在写它的stderr到文件描述符的时候，PROCESS_LOG_STDERR事件会被触发</span><br><span class=\"line\">environment：一个k&#x2F;v对的list列表</span><br><span class=\"line\">directory：supervisord在生成子进程的时候会切换到该目录</span><br><span class=\"line\">umask：设置进程的umask</span><br><span class=\"line\">serverurl：是否允许子进程和内部的HTTP服务通讯，如果设置为AUTO，supervisor会自动的构造一个url</span><br></pre></td></tr></table></figure>\n\n\n\n"},{"title":"Flume配置文件说明","date":"2019-12-13T06:00:00.000Z","_content":"\nFlume目录结构\n\n| 文件夹 | 描述                    |\n| ------ | ----------------------- |\n| bin    | 存放了启动脚本          |\n| lib    | 启动所需的所有组件jar包 |\n| conf   | 提供了几个测试配置文件  |\n| docs   | 文档                    |\n\n### Flume Agent组件\n\nFlume内部有一个或者多个Agent,然而对于每一个Agent来说,它就是一共独立的守护进程(JVM),它从客户端哪儿接收收集,或者从其他的 Agent哪儿接收,然后迅速的将获取的数据传给下一个目的节点sink,或者agent\n\n#### Source\n\nsource 负责数据的产生或搜集，一般是对接一些RPC的程序或者是其他的flume节点的sink，从数据发生器接收数据,并将接收的数据以Flume的event格式传递给一个或者多个通道Channel,Flume提供多种数据接收的方式,比如包括avro、thrift、exec、jms、spooling directory、netcat、sequence generator、syslog、http、legacy、自定义\n\n| **类型**           | **描述**                                                  |\n| ------------------ | --------------------------------------------------------- |\n| Avro               | 监听Avro端口并接收Avro Client的流数据                     |\n| Thrift             | 监听Thrift端口并接收Thrift Client的流数据                 |\n| Exec               | 基于Unix的command在标准输出上生产数据                     |\n| JMS                | 从JMS（Java消息服务）采集数据                             |\n| Spooling Directory | 监听指定目录                                              |\n| Twitter 1%         | 通过API持续下载Twitter数据（实验阶段）                    |\n| Kafka              | 采集Kafka topic中的message                                |\n| NetCat             | 监听端口（要求所提供的数据是换行符分隔的文本）            |\n| Sequence Generator | 序列产生器，连续不断产生event，用于测试                   |\n| Syslog             | 采集syslog日志消息，支持单端口TCP、多端口TCP和UDP日志采集 |\n| HTTP               | 接收HTTP POST和GET数据                                    |\n| Stress             | 用于source压力测试                                        |\n| Legacy             | 向下兼容，接收低版本Flume的数据                           |\n| Custom             | 自定义source的接口                                        |\n| Scribe             | 从facebook Scribe采集数据                                 |\n\n### channel\n\nChannel 是一种短暂的存储容器,负责数据的存储持久化，可以持久化到jdbc,file,memory，将从source处接收到的event格式的数据缓存起来,直到它们被sinks消费掉,可以把channel看成是一个队列，队列的优点是先进先出，放好后尾部一个个event出来，Flume比较看重数据的传输，因此几乎没有数据的解析预处理。仅仅是数据的产生，封装成event然后传输。数据只有存储在下一个存储位置（可能是最终的存储位置，如HDFS；也可能是下一个Flume节点的channel），数据才会从当前的channel中删除。这个过程是通过事务来控制的，这样就保证了数据的可靠性。\n\n不过flume的持久化也是有容量限制的，比如内存如果超过一定的量，不够分配，也一样会爆掉。\n\n| **类型**                   | **描述**                                                     |\n| -------------------------- | ------------------------------------------------------------ |\n| Memory                     | Event数据存储在内存中                                        |\n| JDBC                       | Event数据存储在持久化存储中，当前Flume Channel内置支持Derby  |\n| Kafka                      | Event存储在kafka集群                                         |\n| File Channel               | Event数据存储在磁盘文件中                                    |\n| Spillable Memory Channel   | Event数据存储在内存中和磁盘上，当内存队列满了，会持久化到磁盘文件（当前试验性的，不建议生产环境使用） |\n| Pseudo Transaction Channel | 测试用途                                                     |\n| Custom Channel             | 自定义Channel实现                                            |\n\n### sink\n\nsink 负责数据的转发，将数据存储到集中存储器比如Hbase和HDFS,它从channel消费数据(events)并将其传递给目标地。目标地可能是另一个sink,也可能是hdfs、logger、avro、thrift、ipc、file、null、Hbase、solr、自定义等\n\n| **类型**       | **描述**                                            |\n| -------------- | --------------------------------------------------- |\n| HDFS           | 数据写入HDFS                                        |\n| HIVE           | 数据导入到HIVE中                                    |\n| Logger         | 数据写入日志文件                                    |\n| Avro           | 数据被转换成Avro Event，然后发送到配置的RPC端口上   |\n| Thrift         | 数据被转换成Thrift Event，然后发送到配置的RPC端口上 |\n| IRC            | 数据在IRC上进行回放                                 |\n| File Roll      | 存储数据到本地文件系统                              |\n| Null           | 丢弃到所有数据                                      |\n| Hive           | 数据写入Hive                                        |\n| HBase          | 数据写入HBase数据库                                 |\n| Morphline Solr | 数据发送到Solr搜索服务器（集群）                    |\n| ElasticSearch  | 数据发送到Elastic Search搜索服务器（集群）          |\n| Kite Dataset   | 写数据到Kite Dataset，试验性质的                    |\n| Kafka          | 数据写到Kafka Topic                                 |\n| Custom         | 自定义Sink实现                                      |\n\n**Flume有哪些优缺点**\n\n####优点\n\n- Flume可以将应用产生的数据存储到任何集中存储器中，比如HDFS,HBase\n\n- 当收集数据的速度超过将写入数据的时候，也就是当收集信息遇到峰值时，这时候收集的信息非常大，甚至超过了系统的写入数据能力，这时候，Flume会在数据生产者和数据收容器间做出调整，保证其能够在两者之间提供一共平稳的数据.\n\n- 提供上下文路由特征\n- Flume的管道是基于事务，保证了数据在传送和接收时的一致性.\n- Flume是可靠的，容错性高的，可升级的，易管理的,并且可定制的。\n- 实时性，Flume有一个好处可以实时的将分析数据并将数据保存在数据库或者其他系统中\n\n#### 缺点\n\nFlume的配置很繁琐，source，channel，sink的关系在配置文件里面交织在一起，不便于管理\n\n\n\n### Flume启动参数\n\n```\nUsage: ./flume-ng <command> [options]...  \n  \ncommands:  \n  help                  display this help text  \n  agent                 run a Flume agent  \n  avro-client           run an avro Flume client  \n  version               show Flume version info  \n  \nglobal options:  \n  --conf,-c <conf>      use configs in <conf> directory  \n  --classpath,-C <cp>   append to the classpath  \n  --dryrun,-d           do not actually start Flume, just print the command  \n  --plugins-path <dirs> colon-separated list of plugins.d directories. See the  \n                        plugins.d section in the user guide for more details.  \n                        Default: $FLUME_HOME/plugins.d  \n  -Dproperty=value      sets a Java system property value  \n  -Xproperty=value      sets a Java -X option  \n  \nagent options:  \n  --conf-file,-f <file> specify a config file (required)  \n  --name,-n <name>      the name of this agent (required)  \n  --help,-h             display help text  \n  \navro-client options:  \n  --rpcProps,-P <file>   RPC client properties file with server connection params  \n  --host,-H <host>       hostname to which events will be sent  \n  --port,-p <port>       port of the avro source  \n  --dirname <dir>        directory to stream to avro source  \n  --filename,-F <file>   text file to stream to avro source (default: std input)  \n  --headerFile,-R <file> File containing event headers as key/value pairs on each new line  \n  --help,-h              display help text  \n  \n  Either --rpcProps or both --host and --port must be specified.  \n  \nNote that if <conf> directory is specified, then it is always included first  \nin the classpath. \n```\n\n#### 命令\n\n| 参数        | 描述                      |\n| ----------- | ------------------------- |\n| help        | 打印帮助信息              |\n| agent       | 运行一个Flume Agent       |\n| avro-client | 运行一个Avro Flume 客户端 |\n| version     | 显示Flume版本。           |\n\n#### 全局选项\n\n| 参数                  | 描述                                               |\n| --------------------- | -------------------------------------------------- |\n| --conf,-c <conf>      | 在<conf>目录使用配置文件。指定配置文件放在什么目录 |\n| --classpath,-C <cp>   | 追加一个classpath     |\n| --dryrun,-d           | 不真正运行Agent，而只是打印命令一些信息。          |\n| --plugins-path <dirs> | 插件目录列表。默认：$FLUME_HOME/plugins.d          |\n| -Dproperty=value      | 设置一个JAVA系统属性值。        |\n| -Xproperty=value      | 设置一个JAVA -X的选项。     |\n\n#### Agent选项\n\n| 参数                  | 描述                                                         |\n| --------------------- | ------------------------------------------------------------ |\n| --conf-file,-f <file> | 指定配置文件，这个配置文件必须在**全局选项**的--conf参数定义的目录下。（必填） |\n| --name,-n <name>      | Agent的名称（必填）             |\n| --help,-h             | 帮助                |\n\n#### Avro客户端选项\n\n| 参数                   | 描述                        |\n| ---------------------- | --------------------------- |\n| --rpcProps,-P <file>   | 连接参数的配置文件。        |\n| --host,-H <host>       | Event所要发送到的Hostname。 |\n| --port,-p <port>       | Avro Source的端口。         |\n| --dirname <dir>        | Avro Source流到达的目录。   |\n| --filename,-F <file>   | Avro Source流到达的文件名。 |\n| --headerFile,-R <file> | 设置一个JAVA -X的选项。     |\n\n启动Avro客户端要么指定--rpcProps，要么指定--host和--port。\n\n\n\n### 启动脚本\n\n```\n#!/bin/bash\nif [ ! -d \"/data/\" ];then\nmkdir /var/log/flume/\nfi\nname=$2\nconf=$1\ndir=`find / -name \"flume\" | awk -F \"docs\" 'NR==1{print $1\"conf\"}'`\nconfdir=$dir\"conf\"\ncmd=$dir\"bin/flume-ng\"\nnohup $cmd agent --conf $confdir -f conf/$conf -Dflume.root.logger=DEBUG,console -n $name  > /var/log/flume/flume.out 2>&1 &\n```\n\n### 停止脚本\n\n```\n#!/bin/bash\nkill -9 $(lsof -i:12306 | awk '{print $2}' | tail -n 1)\n```\n\n### 报错\n\n#### 文件名相同，导致flume停止\n\n```\nFile name has been re-used with different files. Spooling assumptions violated for /data/yfanglog/host-manager.2018-04-17.log.COMPLETED\n```\n\n这种情况下后进来的 host-manager.2018-04-17.log，在flume读取完成后会对其进行重命名，但是该文件名已经被占用了，flume就会抛出如下的异常信息,停止处理该监控目录下的其他文件。\n\n跟踪抛出异常的源码，SpoolDirectorySource 会启动一个线程轮询监控目录下的目标文件，当读取完该文件(readEvents)之后会对该文件进行重名(rollCurrentFile)，当重命名失败时会抛出IllegalStateException，被SpoolDirectoryRunnable catch重新抛出RuntimeException，导致当前线程退出，从源码看SpoolDirectoryRunnable 是单线程执行的，因此线程结束后，监控目录下其他文件不再被处理\n\n现在基本清楚了异常栈的调用逻辑，那么和前面自定义解析器一样，我们可以重写ReliableSpoolingFileEventReader以及SpoolDirectorySource的相关实现,也就是自定义一个spooling source，在rollCurrentFile()重命名失败时，做些处理措施，比如将该文件重新命名为access_2015_10_01_16_30.log(2).COMPLETED(此时文件内容已经读取完毕了)继续处理(注意要是.COMPLETED结尾，不然flume会再次读取该文件)。","source":"_posts/flume.md","raw":"---\ntitle: Flume配置文件说明\ndate: 2019-12-13 14:00:00\ncategories: \n- bigdata\ntags:\n- flume\n---\n\nFlume目录结构\n\n| 文件夹 | 描述                    |\n| ------ | ----------------------- |\n| bin    | 存放了启动脚本          |\n| lib    | 启动所需的所有组件jar包 |\n| conf   | 提供了几个测试配置文件  |\n| docs   | 文档                    |\n\n### Flume Agent组件\n\nFlume内部有一个或者多个Agent,然而对于每一个Agent来说,它就是一共独立的守护进程(JVM),它从客户端哪儿接收收集,或者从其他的 Agent哪儿接收,然后迅速的将获取的数据传给下一个目的节点sink,或者agent\n\n#### Source\n\nsource 负责数据的产生或搜集，一般是对接一些RPC的程序或者是其他的flume节点的sink，从数据发生器接收数据,并将接收的数据以Flume的event格式传递给一个或者多个通道Channel,Flume提供多种数据接收的方式,比如包括avro、thrift、exec、jms、spooling directory、netcat、sequence generator、syslog、http、legacy、自定义\n\n| **类型**           | **描述**                                                  |\n| ------------------ | --------------------------------------------------------- |\n| Avro               | 监听Avro端口并接收Avro Client的流数据                     |\n| Thrift             | 监听Thrift端口并接收Thrift Client的流数据                 |\n| Exec               | 基于Unix的command在标准输出上生产数据                     |\n| JMS                | 从JMS（Java消息服务）采集数据                             |\n| Spooling Directory | 监听指定目录                                              |\n| Twitter 1%         | 通过API持续下载Twitter数据（实验阶段）                    |\n| Kafka              | 采集Kafka topic中的message                                |\n| NetCat             | 监听端口（要求所提供的数据是换行符分隔的文本）            |\n| Sequence Generator | 序列产生器，连续不断产生event，用于测试                   |\n| Syslog             | 采集syslog日志消息，支持单端口TCP、多端口TCP和UDP日志采集 |\n| HTTP               | 接收HTTP POST和GET数据                                    |\n| Stress             | 用于source压力测试                                        |\n| Legacy             | 向下兼容，接收低版本Flume的数据                           |\n| Custom             | 自定义source的接口                                        |\n| Scribe             | 从facebook Scribe采集数据                                 |\n\n### channel\n\nChannel 是一种短暂的存储容器,负责数据的存储持久化，可以持久化到jdbc,file,memory，将从source处接收到的event格式的数据缓存起来,直到它们被sinks消费掉,可以把channel看成是一个队列，队列的优点是先进先出，放好后尾部一个个event出来，Flume比较看重数据的传输，因此几乎没有数据的解析预处理。仅仅是数据的产生，封装成event然后传输。数据只有存储在下一个存储位置（可能是最终的存储位置，如HDFS；也可能是下一个Flume节点的channel），数据才会从当前的channel中删除。这个过程是通过事务来控制的，这样就保证了数据的可靠性。\n\n不过flume的持久化也是有容量限制的，比如内存如果超过一定的量，不够分配，也一样会爆掉。\n\n| **类型**                   | **描述**                                                     |\n| -------------------------- | ------------------------------------------------------------ |\n| Memory                     | Event数据存储在内存中                                        |\n| JDBC                       | Event数据存储在持久化存储中，当前Flume Channel内置支持Derby  |\n| Kafka                      | Event存储在kafka集群                                         |\n| File Channel               | Event数据存储在磁盘文件中                                    |\n| Spillable Memory Channel   | Event数据存储在内存中和磁盘上，当内存队列满了，会持久化到磁盘文件（当前试验性的，不建议生产环境使用） |\n| Pseudo Transaction Channel | 测试用途                                                     |\n| Custom Channel             | 自定义Channel实现                                            |\n\n### sink\n\nsink 负责数据的转发，将数据存储到集中存储器比如Hbase和HDFS,它从channel消费数据(events)并将其传递给目标地。目标地可能是另一个sink,也可能是hdfs、logger、avro、thrift、ipc、file、null、Hbase、solr、自定义等\n\n| **类型**       | **描述**                                            |\n| -------------- | --------------------------------------------------- |\n| HDFS           | 数据写入HDFS                                        |\n| HIVE           | 数据导入到HIVE中                                    |\n| Logger         | 数据写入日志文件                                    |\n| Avro           | 数据被转换成Avro Event，然后发送到配置的RPC端口上   |\n| Thrift         | 数据被转换成Thrift Event，然后发送到配置的RPC端口上 |\n| IRC            | 数据在IRC上进行回放                                 |\n| File Roll      | 存储数据到本地文件系统                              |\n| Null           | 丢弃到所有数据                                      |\n| Hive           | 数据写入Hive                                        |\n| HBase          | 数据写入HBase数据库                                 |\n| Morphline Solr | 数据发送到Solr搜索服务器（集群）                    |\n| ElasticSearch  | 数据发送到Elastic Search搜索服务器（集群）          |\n| Kite Dataset   | 写数据到Kite Dataset，试验性质的                    |\n| Kafka          | 数据写到Kafka Topic                                 |\n| Custom         | 自定义Sink实现                                      |\n\n**Flume有哪些优缺点**\n\n####优点\n\n- Flume可以将应用产生的数据存储到任何集中存储器中，比如HDFS,HBase\n\n- 当收集数据的速度超过将写入数据的时候，也就是当收集信息遇到峰值时，这时候收集的信息非常大，甚至超过了系统的写入数据能力，这时候，Flume会在数据生产者和数据收容器间做出调整，保证其能够在两者之间提供一共平稳的数据.\n\n- 提供上下文路由特征\n- Flume的管道是基于事务，保证了数据在传送和接收时的一致性.\n- Flume是可靠的，容错性高的，可升级的，易管理的,并且可定制的。\n- 实时性，Flume有一个好处可以实时的将分析数据并将数据保存在数据库或者其他系统中\n\n#### 缺点\n\nFlume的配置很繁琐，source，channel，sink的关系在配置文件里面交织在一起，不便于管理\n\n\n\n### Flume启动参数\n\n```\nUsage: ./flume-ng <command> [options]...  \n  \ncommands:  \n  help                  display this help text  \n  agent                 run a Flume agent  \n  avro-client           run an avro Flume client  \n  version               show Flume version info  \n  \nglobal options:  \n  --conf,-c <conf>      use configs in <conf> directory  \n  --classpath,-C <cp>   append to the classpath  \n  --dryrun,-d           do not actually start Flume, just print the command  \n  --plugins-path <dirs> colon-separated list of plugins.d directories. See the  \n                        plugins.d section in the user guide for more details.  \n                        Default: $FLUME_HOME/plugins.d  \n  -Dproperty=value      sets a Java system property value  \n  -Xproperty=value      sets a Java -X option  \n  \nagent options:  \n  --conf-file,-f <file> specify a config file (required)  \n  --name,-n <name>      the name of this agent (required)  \n  --help,-h             display help text  \n  \navro-client options:  \n  --rpcProps,-P <file>   RPC client properties file with server connection params  \n  --host,-H <host>       hostname to which events will be sent  \n  --port,-p <port>       port of the avro source  \n  --dirname <dir>        directory to stream to avro source  \n  --filename,-F <file>   text file to stream to avro source (default: std input)  \n  --headerFile,-R <file> File containing event headers as key/value pairs on each new line  \n  --help,-h              display help text  \n  \n  Either --rpcProps or both --host and --port must be specified.  \n  \nNote that if <conf> directory is specified, then it is always included first  \nin the classpath. \n```\n\n#### 命令\n\n| 参数        | 描述                      |\n| ----------- | ------------------------- |\n| help        | 打印帮助信息              |\n| agent       | 运行一个Flume Agent       |\n| avro-client | 运行一个Avro Flume 客户端 |\n| version     | 显示Flume版本。           |\n\n#### 全局选项\n\n| 参数                  | 描述                                               |\n| --------------------- | -------------------------------------------------- |\n| --conf,-c <conf>      | 在<conf>目录使用配置文件。指定配置文件放在什么目录 |\n| --classpath,-C <cp>   | 追加一个classpath     |\n| --dryrun,-d           | 不真正运行Agent，而只是打印命令一些信息。          |\n| --plugins-path <dirs> | 插件目录列表。默认：$FLUME_HOME/plugins.d          |\n| -Dproperty=value      | 设置一个JAVA系统属性值。        |\n| -Xproperty=value      | 设置一个JAVA -X的选项。     |\n\n#### Agent选项\n\n| 参数                  | 描述                                                         |\n| --------------------- | ------------------------------------------------------------ |\n| --conf-file,-f <file> | 指定配置文件，这个配置文件必须在**全局选项**的--conf参数定义的目录下。（必填） |\n| --name,-n <name>      | Agent的名称（必填）             |\n| --help,-h             | 帮助                |\n\n#### Avro客户端选项\n\n| 参数                   | 描述                        |\n| ---------------------- | --------------------------- |\n| --rpcProps,-P <file>   | 连接参数的配置文件。        |\n| --host,-H <host>       | Event所要发送到的Hostname。 |\n| --port,-p <port>       | Avro Source的端口。         |\n| --dirname <dir>        | Avro Source流到达的目录。   |\n| --filename,-F <file>   | Avro Source流到达的文件名。 |\n| --headerFile,-R <file> | 设置一个JAVA -X的选项。     |\n\n启动Avro客户端要么指定--rpcProps，要么指定--host和--port。\n\n\n\n### 启动脚本\n\n```\n#!/bin/bash\nif [ ! -d \"/data/\" ];then\nmkdir /var/log/flume/\nfi\nname=$2\nconf=$1\ndir=`find / -name \"flume\" | awk -F \"docs\" 'NR==1{print $1\"conf\"}'`\nconfdir=$dir\"conf\"\ncmd=$dir\"bin/flume-ng\"\nnohup $cmd agent --conf $confdir -f conf/$conf -Dflume.root.logger=DEBUG,console -n $name  > /var/log/flume/flume.out 2>&1 &\n```\n\n### 停止脚本\n\n```\n#!/bin/bash\nkill -9 $(lsof -i:12306 | awk '{print $2}' | tail -n 1)\n```\n\n### 报错\n\n#### 文件名相同，导致flume停止\n\n```\nFile name has been re-used with different files. Spooling assumptions violated for /data/yfanglog/host-manager.2018-04-17.log.COMPLETED\n```\n\n这种情况下后进来的 host-manager.2018-04-17.log，在flume读取完成后会对其进行重命名，但是该文件名已经被占用了，flume就会抛出如下的异常信息,停止处理该监控目录下的其他文件。\n\n跟踪抛出异常的源码，SpoolDirectorySource 会启动一个线程轮询监控目录下的目标文件，当读取完该文件(readEvents)之后会对该文件进行重名(rollCurrentFile)，当重命名失败时会抛出IllegalStateException，被SpoolDirectoryRunnable catch重新抛出RuntimeException，导致当前线程退出，从源码看SpoolDirectoryRunnable 是单线程执行的，因此线程结束后，监控目录下其他文件不再被处理\n\n现在基本清楚了异常栈的调用逻辑，那么和前面自定义解析器一样，我们可以重写ReliableSpoolingFileEventReader以及SpoolDirectorySource的相关实现,也就是自定义一个spooling source，在rollCurrentFile()重命名失败时，做些处理措施，比如将该文件重新命名为access_2015_10_01_16_30.log(2).COMPLETED(此时文件内容已经读取完毕了)继续处理(注意要是.COMPLETED结尾，不然flume会再次读取该文件)。","slug":"flume","published":1,"updated":"2021-06-18T08:07:11.187Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cku6979xj000900uhf9u5a1zh","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><p>Flume目录结构</p>\n<table>\n<thead>\n<tr>\n<th>文件夹</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>bin</td>\n<td>存放了启动脚本</td>\n</tr>\n<tr>\n<td>lib</td>\n<td>启动所需的所有组件jar包</td>\n</tr>\n<tr>\n<td>conf</td>\n<td>提供了几个测试配置文件</td>\n</tr>\n<tr>\n<td>docs</td>\n<td>文档</td>\n</tr>\n</tbody></table>\n<h3 id=\"Flume-Agent组件\"><a href=\"#Flume-Agent组件\" class=\"headerlink\" title=\"Flume Agent组件\"></a>Flume Agent组件</h3><p>Flume内部有一个或者多个Agent,然而对于每一个Agent来说,它就是一共独立的守护进程(JVM),它从客户端哪儿接收收集,或者从其他的 Agent哪儿接收,然后迅速的将获取的数据传给下一个目的节点sink,或者agent</p>\n<h4 id=\"Source\"><a href=\"#Source\" class=\"headerlink\" title=\"Source\"></a>Source</h4><p>source 负责数据的产生或搜集，一般是对接一些RPC的程序或者是其他的flume节点的sink，从数据发生器接收数据,并将接收的数据以Flume的event格式传递给一个或者多个通道Channel,Flume提供多种数据接收的方式,比如包括avro、thrift、exec、jms、spooling directory、netcat、sequence generator、syslog、http、legacy、自定义</p>\n<table>\n<thead>\n<tr>\n<th><strong>类型</strong></th>\n<th><strong>描述</strong></th>\n</tr>\n</thead>\n<tbody><tr>\n<td>Avro</td>\n<td>监听Avro端口并接收Avro Client的流数据</td>\n</tr>\n<tr>\n<td>Thrift</td>\n<td>监听Thrift端口并接收Thrift Client的流数据</td>\n</tr>\n<tr>\n<td>Exec</td>\n<td>基于Unix的command在标准输出上生产数据</td>\n</tr>\n<tr>\n<td>JMS</td>\n<td>从JMS（Java消息服务）采集数据</td>\n</tr>\n<tr>\n<td>Spooling Directory</td>\n<td>监听指定目录</td>\n</tr>\n<tr>\n<td>Twitter 1%</td>\n<td>通过API持续下载Twitter数据（实验阶段）</td>\n</tr>\n<tr>\n<td>Kafka</td>\n<td>采集Kafka topic中的message</td>\n</tr>\n<tr>\n<td>NetCat</td>\n<td>监听端口（要求所提供的数据是换行符分隔的文本）</td>\n</tr>\n<tr>\n<td>Sequence Generator</td>\n<td>序列产生器，连续不断产生event，用于测试</td>\n</tr>\n<tr>\n<td>Syslog</td>\n<td>采集syslog日志消息，支持单端口TCP、多端口TCP和UDP日志采集</td>\n</tr>\n<tr>\n<td>HTTP</td>\n<td>接收HTTP POST和GET数据</td>\n</tr>\n<tr>\n<td>Stress</td>\n<td>用于source压力测试</td>\n</tr>\n<tr>\n<td>Legacy</td>\n<td>向下兼容，接收低版本Flume的数据</td>\n</tr>\n<tr>\n<td>Custom</td>\n<td>自定义source的接口</td>\n</tr>\n<tr>\n<td>Scribe</td>\n<td>从facebook Scribe采集数据</td>\n</tr>\n</tbody></table>\n<h3 id=\"channel\"><a href=\"#channel\" class=\"headerlink\" title=\"channel\"></a>channel</h3><p>Channel 是一种短暂的存储容器,负责数据的存储持久化，可以持久化到jdbc,file,memory，将从source处接收到的event格式的数据缓存起来,直到它们被sinks消费掉,可以把channel看成是一个队列，队列的优点是先进先出，放好后尾部一个个event出来，Flume比较看重数据的传输，因此几乎没有数据的解析预处理。仅仅是数据的产生，封装成event然后传输。数据只有存储在下一个存储位置（可能是最终的存储位置，如HDFS；也可能是下一个Flume节点的channel），数据才会从当前的channel中删除。这个过程是通过事务来控制的，这样就保证了数据的可靠性。</p>\n<p>不过flume的持久化也是有容量限制的，比如内存如果超过一定的量，不够分配，也一样会爆掉。</p>\n<table>\n<thead>\n<tr>\n<th><strong>类型</strong></th>\n<th><strong>描述</strong></th>\n</tr>\n</thead>\n<tbody><tr>\n<td>Memory</td>\n<td>Event数据存储在内存中</td>\n</tr>\n<tr>\n<td>JDBC</td>\n<td>Event数据存储在持久化存储中，当前Flume Channel内置支持Derby</td>\n</tr>\n<tr>\n<td>Kafka</td>\n<td>Event存储在kafka集群</td>\n</tr>\n<tr>\n<td>File Channel</td>\n<td>Event数据存储在磁盘文件中</td>\n</tr>\n<tr>\n<td>Spillable Memory Channel</td>\n<td>Event数据存储在内存中和磁盘上，当内存队列满了，会持久化到磁盘文件（当前试验性的，不建议生产环境使用）</td>\n</tr>\n<tr>\n<td>Pseudo Transaction Channel</td>\n<td>测试用途</td>\n</tr>\n<tr>\n<td>Custom Channel</td>\n<td>自定义Channel实现</td>\n</tr>\n</tbody></table>\n<h3 id=\"sink\"><a href=\"#sink\" class=\"headerlink\" title=\"sink\"></a>sink</h3><p>sink 负责数据的转发，将数据存储到集中存储器比如Hbase和HDFS,它从channel消费数据(events)并将其传递给目标地。目标地可能是另一个sink,也可能是hdfs、logger、avro、thrift、ipc、file、null、Hbase、solr、自定义等</p>\n<table>\n<thead>\n<tr>\n<th><strong>类型</strong></th>\n<th><strong>描述</strong></th>\n</tr>\n</thead>\n<tbody><tr>\n<td>HDFS</td>\n<td>数据写入HDFS</td>\n</tr>\n<tr>\n<td>HIVE</td>\n<td>数据导入到HIVE中</td>\n</tr>\n<tr>\n<td>Logger</td>\n<td>数据写入日志文件</td>\n</tr>\n<tr>\n<td>Avro</td>\n<td>数据被转换成Avro Event，然后发送到配置的RPC端口上</td>\n</tr>\n<tr>\n<td>Thrift</td>\n<td>数据被转换成Thrift Event，然后发送到配置的RPC端口上</td>\n</tr>\n<tr>\n<td>IRC</td>\n<td>数据在IRC上进行回放</td>\n</tr>\n<tr>\n<td>File Roll</td>\n<td>存储数据到本地文件系统</td>\n</tr>\n<tr>\n<td>Null</td>\n<td>丢弃到所有数据</td>\n</tr>\n<tr>\n<td>Hive</td>\n<td>数据写入Hive</td>\n</tr>\n<tr>\n<td>HBase</td>\n<td>数据写入HBase数据库</td>\n</tr>\n<tr>\n<td>Morphline Solr</td>\n<td>数据发送到Solr搜索服务器（集群）</td>\n</tr>\n<tr>\n<td>ElasticSearch</td>\n<td>数据发送到Elastic Search搜索服务器（集群）</td>\n</tr>\n<tr>\n<td>Kite Dataset</td>\n<td>写数据到Kite Dataset，试验性质的</td>\n</tr>\n<tr>\n<td>Kafka</td>\n<td>数据写到Kafka Topic</td>\n</tr>\n<tr>\n<td>Custom</td>\n<td>自定义Sink实现</td>\n</tr>\n</tbody></table>\n<p><strong>Flume有哪些优缺点</strong></p>\n<p>####优点</p>\n<ul>\n<li><p>Flume可以将应用产生的数据存储到任何集中存储器中，比如HDFS,HBase</p>\n</li>\n<li><p>当收集数据的速度超过将写入数据的时候，也就是当收集信息遇到峰值时，这时候收集的信息非常大，甚至超过了系统的写入数据能力，这时候，Flume会在数据生产者和数据收容器间做出调整，保证其能够在两者之间提供一共平稳的数据.</p>\n</li>\n<li><p>提供上下文路由特征</p>\n</li>\n<li><p>Flume的管道是基于事务，保证了数据在传送和接收时的一致性.</p>\n</li>\n<li><p>Flume是可靠的，容错性高的，可升级的，易管理的,并且可定制的。</p>\n</li>\n<li><p>实时性，Flume有一个好处可以实时的将分析数据并将数据保存在数据库或者其他系统中</p>\n</li>\n</ul>\n<h4 id=\"缺点\"><a href=\"#缺点\" class=\"headerlink\" title=\"缺点\"></a>缺点</h4><p>Flume的配置很繁琐，source，channel，sink的关系在配置文件里面交织在一起，不便于管理</p>\n<h3 id=\"Flume启动参数\"><a href=\"#Flume启动参数\" class=\"headerlink\" title=\"Flume启动参数\"></a>Flume启动参数</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Usage: .&#x2F;flume-ng &lt;command&gt; [options]...  </span><br><span class=\"line\">  </span><br><span class=\"line\">commands:  </span><br><span class=\"line\">  help                  display this help text  </span><br><span class=\"line\">  agent                 run a Flume agent  </span><br><span class=\"line\">  avro-client           run an avro Flume client  </span><br><span class=\"line\">  version               show Flume version info  </span><br><span class=\"line\">  </span><br><span class=\"line\">global options:  </span><br><span class=\"line\">  --conf,-c &lt;conf&gt;      use configs in &lt;conf&gt; directory  </span><br><span class=\"line\">  --classpath,-C &lt;cp&gt;   append to the classpath  </span><br><span class=\"line\">  --dryrun,-d           do not actually start Flume, just print the command  </span><br><span class=\"line\">  --plugins-path &lt;dirs&gt; colon-separated list of plugins.d directories. See the  </span><br><span class=\"line\">                        plugins.d section in the user guide for more details.  </span><br><span class=\"line\">                        Default: $FLUME_HOME&#x2F;plugins.d  </span><br><span class=\"line\">  -Dproperty&#x3D;value      sets a Java system property value  </span><br><span class=\"line\">  -Xproperty&#x3D;value      sets a Java -X option  </span><br><span class=\"line\">  </span><br><span class=\"line\">agent options:  </span><br><span class=\"line\">  --conf-file,-f &lt;file&gt; specify a config file (required)  </span><br><span class=\"line\">  --name,-n &lt;name&gt;      the name of this agent (required)  </span><br><span class=\"line\">  --help,-h             display help text  </span><br><span class=\"line\">  </span><br><span class=\"line\">avro-client options:  </span><br><span class=\"line\">  --rpcProps,-P &lt;file&gt;   RPC client properties file with server connection params  </span><br><span class=\"line\">  --host,-H &lt;host&gt;       hostname to which events will be sent  </span><br><span class=\"line\">  --port,-p &lt;port&gt;       port of the avro source  </span><br><span class=\"line\">  --dirname &lt;dir&gt;        directory to stream to avro source  </span><br><span class=\"line\">  --filename,-F &lt;file&gt;   text file to stream to avro source (default: std input)  </span><br><span class=\"line\">  --headerFile,-R &lt;file&gt; File containing event headers as key&#x2F;value pairs on each new line  </span><br><span class=\"line\">  --help,-h              display help text  </span><br><span class=\"line\">  </span><br><span class=\"line\">  Either --rpcProps or both --host and --port must be specified.  </span><br><span class=\"line\">  </span><br><span class=\"line\">Note that if &lt;conf&gt; directory is specified, then it is always included first  </span><br><span class=\"line\">in the classpath. </span><br></pre></td></tr></table></figure>\n\n<h4 id=\"命令\"><a href=\"#命令\" class=\"headerlink\" title=\"命令\"></a>命令</h4><table>\n<thead>\n<tr>\n<th>参数</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>help</td>\n<td>打印帮助信息</td>\n</tr>\n<tr>\n<td>agent</td>\n<td>运行一个Flume Agent</td>\n</tr>\n<tr>\n<td>avro-client</td>\n<td>运行一个Avro Flume 客户端</td>\n</tr>\n<tr>\n<td>version</td>\n<td>显示Flume版本。</td>\n</tr>\n</tbody></table>\n<h4 id=\"全局选项\"><a href=\"#全局选项\" class=\"headerlink\" title=\"全局选项\"></a>全局选项</h4><table>\n<thead>\n<tr>\n<th>参数</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>–conf,-c <conf></td>\n<td>在<conf>目录使用配置文件。指定配置文件放在什么目录</td>\n</tr>\n<tr>\n<td>–classpath,-C <cp></td>\n<td>追加一个classpath</td>\n</tr>\n<tr>\n<td>–dryrun,-d</td>\n<td>不真正运行Agent，而只是打印命令一些信息。</td>\n</tr>\n<tr>\n<td>–plugins-path <dirs></td>\n<td>插件目录列表。默认：$FLUME_HOME/plugins.d</td>\n</tr>\n<tr>\n<td>-Dproperty=value</td>\n<td>设置一个JAVA系统属性值。</td>\n</tr>\n<tr>\n<td>-Xproperty=value</td>\n<td>设置一个JAVA -X的选项。</td>\n</tr>\n</tbody></table>\n<h4 id=\"Agent选项\"><a href=\"#Agent选项\" class=\"headerlink\" title=\"Agent选项\"></a>Agent选项</h4><table>\n<thead>\n<tr>\n<th>参数</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>–conf-file,-f <file></td>\n<td>指定配置文件，这个配置文件必须在<strong>全局选项</strong>的–conf参数定义的目录下。（必填）</td>\n</tr>\n<tr>\n<td>–name,-n <name></td>\n<td>Agent的名称（必填）</td>\n</tr>\n<tr>\n<td>–help,-h</td>\n<td>帮助</td>\n</tr>\n</tbody></table>\n<h4 id=\"Avro客户端选项\"><a href=\"#Avro客户端选项\" class=\"headerlink\" title=\"Avro客户端选项\"></a>Avro客户端选项</h4><table>\n<thead>\n<tr>\n<th>参数</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>–rpcProps,-P <file></td>\n<td>连接参数的配置文件。</td>\n</tr>\n<tr>\n<td>–host,-H <host></td>\n<td>Event所要发送到的Hostname。</td>\n</tr>\n<tr>\n<td>–port,-p <port></td>\n<td>Avro Source的端口。</td>\n</tr>\n<tr>\n<td>–dirname <dir></td>\n<td>Avro Source流到达的目录。</td>\n</tr>\n<tr>\n<td>–filename,-F <file></td>\n<td>Avro Source流到达的文件名。</td>\n</tr>\n<tr>\n<td>–headerFile,-R <file></td>\n<td>设置一个JAVA -X的选项。</td>\n</tr>\n</tbody></table>\n<p>启动Avro客户端要么指定–rpcProps，要么指定–host和–port。</p>\n<h3 id=\"启动脚本\"><a href=\"#启动脚本\" class=\"headerlink\" title=\"启动脚本\"></a>启动脚本</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#!&#x2F;bin&#x2F;bash</span><br><span class=\"line\">if [ ! -d &quot;&#x2F;data&#x2F;&quot; ];then</span><br><span class=\"line\">mkdir &#x2F;var&#x2F;log&#x2F;flume&#x2F;</span><br><span class=\"line\">fi</span><br><span class=\"line\">name&#x3D;$2</span><br><span class=\"line\">conf&#x3D;$1</span><br><span class=\"line\">dir&#x3D;&#96;find &#x2F; -name &quot;flume&quot; | awk -F &quot;docs&quot; &#39;NR&#x3D;&#x3D;1&#123;print $1&quot;conf&quot;&#125;&#39;&#96;</span><br><span class=\"line\">confdir&#x3D;$dir&quot;conf&quot;</span><br><span class=\"line\">cmd&#x3D;$dir&quot;bin&#x2F;flume-ng&quot;</span><br><span class=\"line\">nohup $cmd agent --conf $confdir -f conf&#x2F;$conf -Dflume.root.logger&#x3D;DEBUG,console -n $name  &gt; &#x2F;var&#x2F;log&#x2F;flume&#x2F;flume.out 2&gt;&amp;1 &amp;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"停止脚本\"><a href=\"#停止脚本\" class=\"headerlink\" title=\"停止脚本\"></a>停止脚本</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#!&#x2F;bin&#x2F;bash</span><br><span class=\"line\">kill -9 $(lsof -i:12306 | awk &#39;&#123;print $2&#125;&#39; | tail -n 1)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"报错\"><a href=\"#报错\" class=\"headerlink\" title=\"报错\"></a>报错</h3><h4 id=\"文件名相同，导致flume停止\"><a href=\"#文件名相同，导致flume停止\" class=\"headerlink\" title=\"文件名相同，导致flume停止\"></a>文件名相同，导致flume停止</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">File name has been re-used with different files. Spooling assumptions violated for &#x2F;data&#x2F;yfanglog&#x2F;host-manager.2018-04-17.log.COMPLETED</span><br></pre></td></tr></table></figure>\n\n<p>这种情况下后进来的 host-manager.2018-04-17.log，在flume读取完成后会对其进行重命名，但是该文件名已经被占用了，flume就会抛出如下的异常信息,停止处理该监控目录下的其他文件。</p>\n<p>跟踪抛出异常的源码，SpoolDirectorySource 会启动一个线程轮询监控目录下的目标文件，当读取完该文件(readEvents)之后会对该文件进行重名(rollCurrentFile)，当重命名失败时会抛出IllegalStateException，被SpoolDirectoryRunnable catch重新抛出RuntimeException，导致当前线程退出，从源码看SpoolDirectoryRunnable 是单线程执行的，因此线程结束后，监控目录下其他文件不再被处理</p>\n<p>现在基本清楚了异常栈的调用逻辑，那么和前面自定义解析器一样，我们可以重写ReliableSpoolingFileEventReader以及SpoolDirectorySource的相关实现,也就是自定义一个spooling source，在rollCurrentFile()重命名失败时，做些处理措施，比如将该文件重新命名为access_2015_10_01_16_30.log(2).COMPLETED(此时文件内容已经读取完毕了)继续处理(注意要是.COMPLETED结尾，不然flume会再次读取该文件)。</p>\n","site":{"data":{}},"excerpt":"","more":"<p>Flume目录结构</p>\n<table>\n<thead>\n<tr>\n<th>文件夹</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>bin</td>\n<td>存放了启动脚本</td>\n</tr>\n<tr>\n<td>lib</td>\n<td>启动所需的所有组件jar包</td>\n</tr>\n<tr>\n<td>conf</td>\n<td>提供了几个测试配置文件</td>\n</tr>\n<tr>\n<td>docs</td>\n<td>文档</td>\n</tr>\n</tbody></table>\n<h3 id=\"Flume-Agent组件\"><a href=\"#Flume-Agent组件\" class=\"headerlink\" title=\"Flume Agent组件\"></a>Flume Agent组件</h3><p>Flume内部有一个或者多个Agent,然而对于每一个Agent来说,它就是一共独立的守护进程(JVM),它从客户端哪儿接收收集,或者从其他的 Agent哪儿接收,然后迅速的将获取的数据传给下一个目的节点sink,或者agent</p>\n<h4 id=\"Source\"><a href=\"#Source\" class=\"headerlink\" title=\"Source\"></a>Source</h4><p>source 负责数据的产生或搜集，一般是对接一些RPC的程序或者是其他的flume节点的sink，从数据发生器接收数据,并将接收的数据以Flume的event格式传递给一个或者多个通道Channel,Flume提供多种数据接收的方式,比如包括avro、thrift、exec、jms、spooling directory、netcat、sequence generator、syslog、http、legacy、自定义</p>\n<table>\n<thead>\n<tr>\n<th><strong>类型</strong></th>\n<th><strong>描述</strong></th>\n</tr>\n</thead>\n<tbody><tr>\n<td>Avro</td>\n<td>监听Avro端口并接收Avro Client的流数据</td>\n</tr>\n<tr>\n<td>Thrift</td>\n<td>监听Thrift端口并接收Thrift Client的流数据</td>\n</tr>\n<tr>\n<td>Exec</td>\n<td>基于Unix的command在标准输出上生产数据</td>\n</tr>\n<tr>\n<td>JMS</td>\n<td>从JMS（Java消息服务）采集数据</td>\n</tr>\n<tr>\n<td>Spooling Directory</td>\n<td>监听指定目录</td>\n</tr>\n<tr>\n<td>Twitter 1%</td>\n<td>通过API持续下载Twitter数据（实验阶段）</td>\n</tr>\n<tr>\n<td>Kafka</td>\n<td>采集Kafka topic中的message</td>\n</tr>\n<tr>\n<td>NetCat</td>\n<td>监听端口（要求所提供的数据是换行符分隔的文本）</td>\n</tr>\n<tr>\n<td>Sequence Generator</td>\n<td>序列产生器，连续不断产生event，用于测试</td>\n</tr>\n<tr>\n<td>Syslog</td>\n<td>采集syslog日志消息，支持单端口TCP、多端口TCP和UDP日志采集</td>\n</tr>\n<tr>\n<td>HTTP</td>\n<td>接收HTTP POST和GET数据</td>\n</tr>\n<tr>\n<td>Stress</td>\n<td>用于source压力测试</td>\n</tr>\n<tr>\n<td>Legacy</td>\n<td>向下兼容，接收低版本Flume的数据</td>\n</tr>\n<tr>\n<td>Custom</td>\n<td>自定义source的接口</td>\n</tr>\n<tr>\n<td>Scribe</td>\n<td>从facebook Scribe采集数据</td>\n</tr>\n</tbody></table>\n<h3 id=\"channel\"><a href=\"#channel\" class=\"headerlink\" title=\"channel\"></a>channel</h3><p>Channel 是一种短暂的存储容器,负责数据的存储持久化，可以持久化到jdbc,file,memory，将从source处接收到的event格式的数据缓存起来,直到它们被sinks消费掉,可以把channel看成是一个队列，队列的优点是先进先出，放好后尾部一个个event出来，Flume比较看重数据的传输，因此几乎没有数据的解析预处理。仅仅是数据的产生，封装成event然后传输。数据只有存储在下一个存储位置（可能是最终的存储位置，如HDFS；也可能是下一个Flume节点的channel），数据才会从当前的channel中删除。这个过程是通过事务来控制的，这样就保证了数据的可靠性。</p>\n<p>不过flume的持久化也是有容量限制的，比如内存如果超过一定的量，不够分配，也一样会爆掉。</p>\n<table>\n<thead>\n<tr>\n<th><strong>类型</strong></th>\n<th><strong>描述</strong></th>\n</tr>\n</thead>\n<tbody><tr>\n<td>Memory</td>\n<td>Event数据存储在内存中</td>\n</tr>\n<tr>\n<td>JDBC</td>\n<td>Event数据存储在持久化存储中，当前Flume Channel内置支持Derby</td>\n</tr>\n<tr>\n<td>Kafka</td>\n<td>Event存储在kafka集群</td>\n</tr>\n<tr>\n<td>File Channel</td>\n<td>Event数据存储在磁盘文件中</td>\n</tr>\n<tr>\n<td>Spillable Memory Channel</td>\n<td>Event数据存储在内存中和磁盘上，当内存队列满了，会持久化到磁盘文件（当前试验性的，不建议生产环境使用）</td>\n</tr>\n<tr>\n<td>Pseudo Transaction Channel</td>\n<td>测试用途</td>\n</tr>\n<tr>\n<td>Custom Channel</td>\n<td>自定义Channel实现</td>\n</tr>\n</tbody></table>\n<h3 id=\"sink\"><a href=\"#sink\" class=\"headerlink\" title=\"sink\"></a>sink</h3><p>sink 负责数据的转发，将数据存储到集中存储器比如Hbase和HDFS,它从channel消费数据(events)并将其传递给目标地。目标地可能是另一个sink,也可能是hdfs、logger、avro、thrift、ipc、file、null、Hbase、solr、自定义等</p>\n<table>\n<thead>\n<tr>\n<th><strong>类型</strong></th>\n<th><strong>描述</strong></th>\n</tr>\n</thead>\n<tbody><tr>\n<td>HDFS</td>\n<td>数据写入HDFS</td>\n</tr>\n<tr>\n<td>HIVE</td>\n<td>数据导入到HIVE中</td>\n</tr>\n<tr>\n<td>Logger</td>\n<td>数据写入日志文件</td>\n</tr>\n<tr>\n<td>Avro</td>\n<td>数据被转换成Avro Event，然后发送到配置的RPC端口上</td>\n</tr>\n<tr>\n<td>Thrift</td>\n<td>数据被转换成Thrift Event，然后发送到配置的RPC端口上</td>\n</tr>\n<tr>\n<td>IRC</td>\n<td>数据在IRC上进行回放</td>\n</tr>\n<tr>\n<td>File Roll</td>\n<td>存储数据到本地文件系统</td>\n</tr>\n<tr>\n<td>Null</td>\n<td>丢弃到所有数据</td>\n</tr>\n<tr>\n<td>Hive</td>\n<td>数据写入Hive</td>\n</tr>\n<tr>\n<td>HBase</td>\n<td>数据写入HBase数据库</td>\n</tr>\n<tr>\n<td>Morphline Solr</td>\n<td>数据发送到Solr搜索服务器（集群）</td>\n</tr>\n<tr>\n<td>ElasticSearch</td>\n<td>数据发送到Elastic Search搜索服务器（集群）</td>\n</tr>\n<tr>\n<td>Kite Dataset</td>\n<td>写数据到Kite Dataset，试验性质的</td>\n</tr>\n<tr>\n<td>Kafka</td>\n<td>数据写到Kafka Topic</td>\n</tr>\n<tr>\n<td>Custom</td>\n<td>自定义Sink实现</td>\n</tr>\n</tbody></table>\n<p><strong>Flume有哪些优缺点</strong></p>\n<p>####优点</p>\n<ul>\n<li><p>Flume可以将应用产生的数据存储到任何集中存储器中，比如HDFS,HBase</p>\n</li>\n<li><p>当收集数据的速度超过将写入数据的时候，也就是当收集信息遇到峰值时，这时候收集的信息非常大，甚至超过了系统的写入数据能力，这时候，Flume会在数据生产者和数据收容器间做出调整，保证其能够在两者之间提供一共平稳的数据.</p>\n</li>\n<li><p>提供上下文路由特征</p>\n</li>\n<li><p>Flume的管道是基于事务，保证了数据在传送和接收时的一致性.</p>\n</li>\n<li><p>Flume是可靠的，容错性高的，可升级的，易管理的,并且可定制的。</p>\n</li>\n<li><p>实时性，Flume有一个好处可以实时的将分析数据并将数据保存在数据库或者其他系统中</p>\n</li>\n</ul>\n<h4 id=\"缺点\"><a href=\"#缺点\" class=\"headerlink\" title=\"缺点\"></a>缺点</h4><p>Flume的配置很繁琐，source，channel，sink的关系在配置文件里面交织在一起，不便于管理</p>\n<h3 id=\"Flume启动参数\"><a href=\"#Flume启动参数\" class=\"headerlink\" title=\"Flume启动参数\"></a>Flume启动参数</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Usage: .&#x2F;flume-ng &lt;command&gt; [options]...  </span><br><span class=\"line\">  </span><br><span class=\"line\">commands:  </span><br><span class=\"line\">  help                  display this help text  </span><br><span class=\"line\">  agent                 run a Flume agent  </span><br><span class=\"line\">  avro-client           run an avro Flume client  </span><br><span class=\"line\">  version               show Flume version info  </span><br><span class=\"line\">  </span><br><span class=\"line\">global options:  </span><br><span class=\"line\">  --conf,-c &lt;conf&gt;      use configs in &lt;conf&gt; directory  </span><br><span class=\"line\">  --classpath,-C &lt;cp&gt;   append to the classpath  </span><br><span class=\"line\">  --dryrun,-d           do not actually start Flume, just print the command  </span><br><span class=\"line\">  --plugins-path &lt;dirs&gt; colon-separated list of plugins.d directories. See the  </span><br><span class=\"line\">                        plugins.d section in the user guide for more details.  </span><br><span class=\"line\">                        Default: $FLUME_HOME&#x2F;plugins.d  </span><br><span class=\"line\">  -Dproperty&#x3D;value      sets a Java system property value  </span><br><span class=\"line\">  -Xproperty&#x3D;value      sets a Java -X option  </span><br><span class=\"line\">  </span><br><span class=\"line\">agent options:  </span><br><span class=\"line\">  --conf-file,-f &lt;file&gt; specify a config file (required)  </span><br><span class=\"line\">  --name,-n &lt;name&gt;      the name of this agent (required)  </span><br><span class=\"line\">  --help,-h             display help text  </span><br><span class=\"line\">  </span><br><span class=\"line\">avro-client options:  </span><br><span class=\"line\">  --rpcProps,-P &lt;file&gt;   RPC client properties file with server connection params  </span><br><span class=\"line\">  --host,-H &lt;host&gt;       hostname to which events will be sent  </span><br><span class=\"line\">  --port,-p &lt;port&gt;       port of the avro source  </span><br><span class=\"line\">  --dirname &lt;dir&gt;        directory to stream to avro source  </span><br><span class=\"line\">  --filename,-F &lt;file&gt;   text file to stream to avro source (default: std input)  </span><br><span class=\"line\">  --headerFile,-R &lt;file&gt; File containing event headers as key&#x2F;value pairs on each new line  </span><br><span class=\"line\">  --help,-h              display help text  </span><br><span class=\"line\">  </span><br><span class=\"line\">  Either --rpcProps or both --host and --port must be specified.  </span><br><span class=\"line\">  </span><br><span class=\"line\">Note that if &lt;conf&gt; directory is specified, then it is always included first  </span><br><span class=\"line\">in the classpath. </span><br></pre></td></tr></table></figure>\n\n<h4 id=\"命令\"><a href=\"#命令\" class=\"headerlink\" title=\"命令\"></a>命令</h4><table>\n<thead>\n<tr>\n<th>参数</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>help</td>\n<td>打印帮助信息</td>\n</tr>\n<tr>\n<td>agent</td>\n<td>运行一个Flume Agent</td>\n</tr>\n<tr>\n<td>avro-client</td>\n<td>运行一个Avro Flume 客户端</td>\n</tr>\n<tr>\n<td>version</td>\n<td>显示Flume版本。</td>\n</tr>\n</tbody></table>\n<h4 id=\"全局选项\"><a href=\"#全局选项\" class=\"headerlink\" title=\"全局选项\"></a>全局选项</h4><table>\n<thead>\n<tr>\n<th>参数</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>–conf,-c <conf></td>\n<td>在<conf>目录使用配置文件。指定配置文件放在什么目录</td>\n</tr>\n<tr>\n<td>–classpath,-C <cp></td>\n<td>追加一个classpath</td>\n</tr>\n<tr>\n<td>–dryrun,-d</td>\n<td>不真正运行Agent，而只是打印命令一些信息。</td>\n</tr>\n<tr>\n<td>–plugins-path <dirs></td>\n<td>插件目录列表。默认：$FLUME_HOME/plugins.d</td>\n</tr>\n<tr>\n<td>-Dproperty=value</td>\n<td>设置一个JAVA系统属性值。</td>\n</tr>\n<tr>\n<td>-Xproperty=value</td>\n<td>设置一个JAVA -X的选项。</td>\n</tr>\n</tbody></table>\n<h4 id=\"Agent选项\"><a href=\"#Agent选项\" class=\"headerlink\" title=\"Agent选项\"></a>Agent选项</h4><table>\n<thead>\n<tr>\n<th>参数</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>–conf-file,-f <file></td>\n<td>指定配置文件，这个配置文件必须在<strong>全局选项</strong>的–conf参数定义的目录下。（必填）</td>\n</tr>\n<tr>\n<td>–name,-n <name></td>\n<td>Agent的名称（必填）</td>\n</tr>\n<tr>\n<td>–help,-h</td>\n<td>帮助</td>\n</tr>\n</tbody></table>\n<h4 id=\"Avro客户端选项\"><a href=\"#Avro客户端选项\" class=\"headerlink\" title=\"Avro客户端选项\"></a>Avro客户端选项</h4><table>\n<thead>\n<tr>\n<th>参数</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>–rpcProps,-P <file></td>\n<td>连接参数的配置文件。</td>\n</tr>\n<tr>\n<td>–host,-H <host></td>\n<td>Event所要发送到的Hostname。</td>\n</tr>\n<tr>\n<td>–port,-p <port></td>\n<td>Avro Source的端口。</td>\n</tr>\n<tr>\n<td>–dirname <dir></td>\n<td>Avro Source流到达的目录。</td>\n</tr>\n<tr>\n<td>–filename,-F <file></td>\n<td>Avro Source流到达的文件名。</td>\n</tr>\n<tr>\n<td>–headerFile,-R <file></td>\n<td>设置一个JAVA -X的选项。</td>\n</tr>\n</tbody></table>\n<p>启动Avro客户端要么指定–rpcProps，要么指定–host和–port。</p>\n<h3 id=\"启动脚本\"><a href=\"#启动脚本\" class=\"headerlink\" title=\"启动脚本\"></a>启动脚本</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#!&#x2F;bin&#x2F;bash</span><br><span class=\"line\">if [ ! -d &quot;&#x2F;data&#x2F;&quot; ];then</span><br><span class=\"line\">mkdir &#x2F;var&#x2F;log&#x2F;flume&#x2F;</span><br><span class=\"line\">fi</span><br><span class=\"line\">name&#x3D;$2</span><br><span class=\"line\">conf&#x3D;$1</span><br><span class=\"line\">dir&#x3D;&#96;find &#x2F; -name &quot;flume&quot; | awk -F &quot;docs&quot; &#39;NR&#x3D;&#x3D;1&#123;print $1&quot;conf&quot;&#125;&#39;&#96;</span><br><span class=\"line\">confdir&#x3D;$dir&quot;conf&quot;</span><br><span class=\"line\">cmd&#x3D;$dir&quot;bin&#x2F;flume-ng&quot;</span><br><span class=\"line\">nohup $cmd agent --conf $confdir -f conf&#x2F;$conf -Dflume.root.logger&#x3D;DEBUG,console -n $name  &gt; &#x2F;var&#x2F;log&#x2F;flume&#x2F;flume.out 2&gt;&amp;1 &amp;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"停止脚本\"><a href=\"#停止脚本\" class=\"headerlink\" title=\"停止脚本\"></a>停止脚本</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#!&#x2F;bin&#x2F;bash</span><br><span class=\"line\">kill -9 $(lsof -i:12306 | awk &#39;&#123;print $2&#125;&#39; | tail -n 1)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"报错\"><a href=\"#报错\" class=\"headerlink\" title=\"报错\"></a>报错</h3><h4 id=\"文件名相同，导致flume停止\"><a href=\"#文件名相同，导致flume停止\" class=\"headerlink\" title=\"文件名相同，导致flume停止\"></a>文件名相同，导致flume停止</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">File name has been re-used with different files. Spooling assumptions violated for &#x2F;data&#x2F;yfanglog&#x2F;host-manager.2018-04-17.log.COMPLETED</span><br></pre></td></tr></table></figure>\n\n<p>这种情况下后进来的 host-manager.2018-04-17.log，在flume读取完成后会对其进行重命名，但是该文件名已经被占用了，flume就会抛出如下的异常信息,停止处理该监控目录下的其他文件。</p>\n<p>跟踪抛出异常的源码，SpoolDirectorySource 会启动一个线程轮询监控目录下的目标文件，当读取完该文件(readEvents)之后会对该文件进行重名(rollCurrentFile)，当重命名失败时会抛出IllegalStateException，被SpoolDirectoryRunnable catch重新抛出RuntimeException，导致当前线程退出，从源码看SpoolDirectoryRunnable 是单线程执行的，因此线程结束后，监控目录下其他文件不再被处理</p>\n<p>现在基本清楚了异常栈的调用逻辑，那么和前面自定义解析器一样，我们可以重写ReliableSpoolingFileEventReader以及SpoolDirectorySource的相关实现,也就是自定义一个spooling source，在rollCurrentFile()重命名失败时，做些处理措施，比如将该文件重新命名为access_2015_10_01_16_30.log(2).COMPLETED(此时文件内容已经读取完毕了)继续处理(注意要是.COMPLETED结尾，不然flume会再次读取该文件)。</p>\n"},{"title":"Flume 案例","date":"2019-12-13T06:00:00.000Z","_content":"\nSpool监测配置的目录下新增的文件，并将文件中的数据读取出来。需要注意两点：\n\n- 拷贝到 spool 目录下的文件不可以再打开编辑。\n- spool 目录下不可包含相应的子目录。\n\n在 `/opt` 创建 agent 的配置文件 spool.conf。\n\n```\nhadoop@907b3dc56edb:/opt$ sudo vi apache-flume-1.6.0-bin/conf/spool.conf\n# 添加如下内容\n```\n\n```\n# Describe the agent\na1.sources = r1\na1.sinks = k1\na1.channels = c1\n\n# Describe/configure the source\na1.sources.r1.type = spooldir\na1.sources.r1.channels = c1\na1.sources.r1.spoolDir = /opt/apache-flume-1.6.0-bin/logs\na1.sources.r1.fileHeader = true\n\n# Describe the sink\na1.sinks.k1.type = logger\n\n# Use a channel which buffers events in memory\na1.channels.c1.type = memory\na1.channels.c1.capacity = 1000\na1.channels.c1.transactionCapacity = 100\n\n# Bind the source and sink to the channel\na1.sources.r1.channels = c1\na1.sinks.k1.channel = c1\n```\n\n启动 Flume 代理。\n\n```\nhadoop@907b3dc56edb:/opt/apache-flume-1.6.0-bin$ bin/flume-ng agent -c conf -f conf/spool.conf -n a1 -Dflume.root.logger=INFO,console\n```\n\n另外开启一个终端，追加文件到 apache-flume-1.6.0-bin/logs 目录。\n\n```\nhadoop@907b3dc56edb:/opt$ echo \"Hello World\" > apache-flume-1.6.0-bin/logs/spool.log\n```\n\n### 案例二之 ExecEXEC \n\n执行一个给定的命令获得输出的源。\n\n在 `/opt` 创建 agent 的配置文件 exec.conf。\n\n```\nhadoop@907b3dc56edb:/opt$ sudo vi apache-flume-1.6.0-bin/conf/exec.conf\n# 添加如下内容\n```\n\n```\n# Describe the agent\na1.sources = r1\na1.sinks = k1\na1.channels = c1\n\n# Describe the source\na1.sources.r1.type = exec\na1.sources.r1.channels = c1\na1.sources.r1.command = tail -F /opt/apache-flume-1.6.0-bin/logs/log_exec_tail\n\n# Describe the sink\na1.sinks.k1.type = logger\n\n# Use a channel which buffers events in memory\na1.channels.c1.type = memory\na1.channels.c1.capacity = 1000\na1.channels.c1.transactionCapacity = 100\n\n# Bind the source and sink to the channel\na1.sources.r1.channels = c1\na1.sinks.k1.channel = c1\n```\n\n启动 Flume 代理。\n\n```\nhadoop@907b3dc56edb:/opt/apache-flume-1.6.0-bin$ bin/flume-ng agent -c conf -f conf/exec.conf -n a1 -Dflume.root.logger=INFO,console\n```\n\n\n\n另外开启一个终端，用脚本输出信息到 /opt/apache-flume-1.6.0-bin/log_exec_tail\n\n```\nfor i in {1..1000}\ndo\necho \"exec tail$i\" >> /opt/apache-flume-1.6.0-bin/logs/log_exec_tail\ndone\n```\n\n\n\n### 案例三之 JSONHandler\n\n从远程客户端接收数据。\n\n在 `/opt` 创建 agent 的配置文件 json.conf。\n\n```\nhadoop@907b3dc56edb:/opt$ sudo vi apache-flume-1.6.0-bin/conf/json.conf\n# 添加如下内容\n```\n\n```\n# Describe the agent\na1.sources = r1\na1.sinks = k1\na1.channels = c1\n\n# Describe the source\na1.sources.r1.type = org.apache.flume.source.http.HTTPSource\na1.sources.r1.port = 8888\na1.sources.r1.channels = c1\n\n\n# Describe the sink\na1.sinks.k1.type = logger\n\n# Use a channel which buffers events in memory\na1.channels.c1.type = memory\na1.channels.c1.capacity = 1000\na1.channels.c1.transactionCapacity = 100\n\n\n# Bind the source and sink to the channel\na1.sources.r1.channels = c1\na1.sinks.k1.channel = c1\n```\n\n启动 Flume 代理。\n\n```\nhadoop@907b3dc56edb:/opt/apache-flume-1.6.0-bin$ bin/flume-ng agent -c conf -f conf/json.conf -n a1 -Dflume.root.logger=INFO,console\n```\n\n生成 JSON 格式的POST request。\n\n```\nhadoop@907b3dc56edb:/opt/apache-flume-1.6.0-bin$  curl -X POST -d '[{ \"headers\" :{\"a\" : \"a1\",\"b\" : \"b1\"},\"body\" : \"shiyanlou.org_body\"}]' http://localhost:8888\n```\n\n### 案例四之 Syslogtcp\n\n接下来，我们将要介绍如何把数据写入HDFS。\n\n在 `/opt` 创建 agent 配置文件 syslogtcp.conf。\n\n```\nhadoop@907b3dc56edb:/opt$ sudo vi apache-flume-1.6.0-bin/conf/syslogtcp.conf\n# 添加如下内容\n```\n\n```\na1.sources = r1\na1.sinks = k1\na1.channels = c1\n\n# Describe/configure the source\na1.sources.r1.type = syslogtcp\na1.sources.r1.port = 4444\na1.sources.r1.host = localhost\na1.sources.r1.channels = c1\n\n# Describe the sink\na1.sinks.k1.type = hdfs\na1.sinks.k1.channel = c1\na1.sinks.k1.hdfs.path = hdfs://localhost:9000/user/hadoop/syslogtcp\na1.sinks.k1.hdfs.filePrefix = Syslog\na1.sinks.k1.hdfs.round = true\na1.sinks.k1.hdfs.roundValue = 10\na1.sinks.k1.hdfs.roundUnit = minute\n\n# Use a channel which buffers events in memory\na1.channels.c1.type = memory\na1.channels.c1.capacity = 1000\na1.channels.c1.transactionCapacity = 100\n\n# Bind the source and sink to the channel\na1.sources.r1.channels = c1\na1.sinks.k1.channel = c1\n```\n\n启动 Flume 代理。\n\n```\nhadoop@907b3dc56edb:/opt/apache-flume-1.6.0-bin$ bin/flume-ng agent -c conf -f conf/syslogtcp.conf -n a1 -Dflume.root.logger=INFO,console\n```\n\n测试产生 syslog。\n\n```\nhadoop@907b3dc56edb:/opt/apache-flume-1.6.0-bin$  echo \"hello  flume\" | nc localhost 4444\n```\n\n再次打开一个 Xfce 终端，检查 hdfs 上是否生成文件。\n\n\n\n### 案例五之 File Roll Sink\n\n接下来，我们将要介绍写入稍微复杂的文件数据，把动态生成的时间戳和数据一同写入 HDFS。\n\n在 `/opt` 创建 agent 的配置文件 file_roll.conf。\n\n```\nhadoop@907b3dc56edb:/opt$ sudo vi apache-flume-1.6.0-bin/conf/file_roll.conf\n# 添加如下内容\n```\n\n```\na1.sources = r1\na1.sinks = k1\na1.channels = c1\n\n# Describe/configure the source\na1.sources.r1.type = syslogtcp\na1.sources.r1.port = 5555\na1.sources.r1.host = localhost\na1.sources.r1.channels = c1\n\n# Describe the sinkmior\n\na1.sinks.k1.type = file_roll\na1.sinks.k1.sink.directory = /opt/apache-flume-1.6.0-bin/logs\n\n# Use a channel which buffers events in memory\na1.channels.c1.type = memory\na1.channels.c1.capacity = 1000\na1.channels.c1.transactionCapacity = 100\n\n# Bind the source and sink to the channel\na1.sources.r1.channels = c1\na1.sinks.k1.channel = c1\n```\n\n启动 Flume 代理。\n\n```\nhadoop@907b3dc56edb:/opt/apache-flume-1.6.0-bin$ bin/flume-ng agent -c conf -f conf/file_roll.conf -n a1 -Dflume.root.logger=INFO,console\n```\n\n另外开启一个 Xfce 终端中，测试产生 log。\n\n```\nhadoop@907b3dc56edb:/opt/apache-flume-1.6.0-bin$ echo \"Hello world!\"|nc localhost 5555\n```\n\n再次打开一个 Xfce 终端，查看 /opt/apache-flume-1.6.0-bin/logs 下是否生成文件，默认每30秒生成一个新文件。","source":"_posts/flume案例.md","raw":"---\ntitle: Flume 案例\ndate: 2019-12-13 14:00:00\ncategories: \n- bigdata\ntags:\n- flume\n---\n\nSpool监测配置的目录下新增的文件，并将文件中的数据读取出来。需要注意两点：\n\n- 拷贝到 spool 目录下的文件不可以再打开编辑。\n- spool 目录下不可包含相应的子目录。\n\n在 `/opt` 创建 agent 的配置文件 spool.conf。\n\n```\nhadoop@907b3dc56edb:/opt$ sudo vi apache-flume-1.6.0-bin/conf/spool.conf\n# 添加如下内容\n```\n\n```\n# Describe the agent\na1.sources = r1\na1.sinks = k1\na1.channels = c1\n\n# Describe/configure the source\na1.sources.r1.type = spooldir\na1.sources.r1.channels = c1\na1.sources.r1.spoolDir = /opt/apache-flume-1.6.0-bin/logs\na1.sources.r1.fileHeader = true\n\n# Describe the sink\na1.sinks.k1.type = logger\n\n# Use a channel which buffers events in memory\na1.channels.c1.type = memory\na1.channels.c1.capacity = 1000\na1.channels.c1.transactionCapacity = 100\n\n# Bind the source and sink to the channel\na1.sources.r1.channels = c1\na1.sinks.k1.channel = c1\n```\n\n启动 Flume 代理。\n\n```\nhadoop@907b3dc56edb:/opt/apache-flume-1.6.0-bin$ bin/flume-ng agent -c conf -f conf/spool.conf -n a1 -Dflume.root.logger=INFO,console\n```\n\n另外开启一个终端，追加文件到 apache-flume-1.6.0-bin/logs 目录。\n\n```\nhadoop@907b3dc56edb:/opt$ echo \"Hello World\" > apache-flume-1.6.0-bin/logs/spool.log\n```\n\n### 案例二之 ExecEXEC \n\n执行一个给定的命令获得输出的源。\n\n在 `/opt` 创建 agent 的配置文件 exec.conf。\n\n```\nhadoop@907b3dc56edb:/opt$ sudo vi apache-flume-1.6.0-bin/conf/exec.conf\n# 添加如下内容\n```\n\n```\n# Describe the agent\na1.sources = r1\na1.sinks = k1\na1.channels = c1\n\n# Describe the source\na1.sources.r1.type = exec\na1.sources.r1.channels = c1\na1.sources.r1.command = tail -F /opt/apache-flume-1.6.0-bin/logs/log_exec_tail\n\n# Describe the sink\na1.sinks.k1.type = logger\n\n# Use a channel which buffers events in memory\na1.channels.c1.type = memory\na1.channels.c1.capacity = 1000\na1.channels.c1.transactionCapacity = 100\n\n# Bind the source and sink to the channel\na1.sources.r1.channels = c1\na1.sinks.k1.channel = c1\n```\n\n启动 Flume 代理。\n\n```\nhadoop@907b3dc56edb:/opt/apache-flume-1.6.0-bin$ bin/flume-ng agent -c conf -f conf/exec.conf -n a1 -Dflume.root.logger=INFO,console\n```\n\n\n\n另外开启一个终端，用脚本输出信息到 /opt/apache-flume-1.6.0-bin/log_exec_tail\n\n```\nfor i in {1..1000}\ndo\necho \"exec tail$i\" >> /opt/apache-flume-1.6.0-bin/logs/log_exec_tail\ndone\n```\n\n\n\n### 案例三之 JSONHandler\n\n从远程客户端接收数据。\n\n在 `/opt` 创建 agent 的配置文件 json.conf。\n\n```\nhadoop@907b3dc56edb:/opt$ sudo vi apache-flume-1.6.0-bin/conf/json.conf\n# 添加如下内容\n```\n\n```\n# Describe the agent\na1.sources = r1\na1.sinks = k1\na1.channels = c1\n\n# Describe the source\na1.sources.r1.type = org.apache.flume.source.http.HTTPSource\na1.sources.r1.port = 8888\na1.sources.r1.channels = c1\n\n\n# Describe the sink\na1.sinks.k1.type = logger\n\n# Use a channel which buffers events in memory\na1.channels.c1.type = memory\na1.channels.c1.capacity = 1000\na1.channels.c1.transactionCapacity = 100\n\n\n# Bind the source and sink to the channel\na1.sources.r1.channels = c1\na1.sinks.k1.channel = c1\n```\n\n启动 Flume 代理。\n\n```\nhadoop@907b3dc56edb:/opt/apache-flume-1.6.0-bin$ bin/flume-ng agent -c conf -f conf/json.conf -n a1 -Dflume.root.logger=INFO,console\n```\n\n生成 JSON 格式的POST request。\n\n```\nhadoop@907b3dc56edb:/opt/apache-flume-1.6.0-bin$  curl -X POST -d '[{ \"headers\" :{\"a\" : \"a1\",\"b\" : \"b1\"},\"body\" : \"shiyanlou.org_body\"}]' http://localhost:8888\n```\n\n### 案例四之 Syslogtcp\n\n接下来，我们将要介绍如何把数据写入HDFS。\n\n在 `/opt` 创建 agent 配置文件 syslogtcp.conf。\n\n```\nhadoop@907b3dc56edb:/opt$ sudo vi apache-flume-1.6.0-bin/conf/syslogtcp.conf\n# 添加如下内容\n```\n\n```\na1.sources = r1\na1.sinks = k1\na1.channels = c1\n\n# Describe/configure the source\na1.sources.r1.type = syslogtcp\na1.sources.r1.port = 4444\na1.sources.r1.host = localhost\na1.sources.r1.channels = c1\n\n# Describe the sink\na1.sinks.k1.type = hdfs\na1.sinks.k1.channel = c1\na1.sinks.k1.hdfs.path = hdfs://localhost:9000/user/hadoop/syslogtcp\na1.sinks.k1.hdfs.filePrefix = Syslog\na1.sinks.k1.hdfs.round = true\na1.sinks.k1.hdfs.roundValue = 10\na1.sinks.k1.hdfs.roundUnit = minute\n\n# Use a channel which buffers events in memory\na1.channels.c1.type = memory\na1.channels.c1.capacity = 1000\na1.channels.c1.transactionCapacity = 100\n\n# Bind the source and sink to the channel\na1.sources.r1.channels = c1\na1.sinks.k1.channel = c1\n```\n\n启动 Flume 代理。\n\n```\nhadoop@907b3dc56edb:/opt/apache-flume-1.6.0-bin$ bin/flume-ng agent -c conf -f conf/syslogtcp.conf -n a1 -Dflume.root.logger=INFO,console\n```\n\n测试产生 syslog。\n\n```\nhadoop@907b3dc56edb:/opt/apache-flume-1.6.0-bin$  echo \"hello  flume\" | nc localhost 4444\n```\n\n再次打开一个 Xfce 终端，检查 hdfs 上是否生成文件。\n\n\n\n### 案例五之 File Roll Sink\n\n接下来，我们将要介绍写入稍微复杂的文件数据，把动态生成的时间戳和数据一同写入 HDFS。\n\n在 `/opt` 创建 agent 的配置文件 file_roll.conf。\n\n```\nhadoop@907b3dc56edb:/opt$ sudo vi apache-flume-1.6.0-bin/conf/file_roll.conf\n# 添加如下内容\n```\n\n```\na1.sources = r1\na1.sinks = k1\na1.channels = c1\n\n# Describe/configure the source\na1.sources.r1.type = syslogtcp\na1.sources.r1.port = 5555\na1.sources.r1.host = localhost\na1.sources.r1.channels = c1\n\n# Describe the sinkmior\n\na1.sinks.k1.type = file_roll\na1.sinks.k1.sink.directory = /opt/apache-flume-1.6.0-bin/logs\n\n# Use a channel which buffers events in memory\na1.channels.c1.type = memory\na1.channels.c1.capacity = 1000\na1.channels.c1.transactionCapacity = 100\n\n# Bind the source and sink to the channel\na1.sources.r1.channels = c1\na1.sinks.k1.channel = c1\n```\n\n启动 Flume 代理。\n\n```\nhadoop@907b3dc56edb:/opt/apache-flume-1.6.0-bin$ bin/flume-ng agent -c conf -f conf/file_roll.conf -n a1 -Dflume.root.logger=INFO,console\n```\n\n另外开启一个 Xfce 终端中，测试产生 log。\n\n```\nhadoop@907b3dc56edb:/opt/apache-flume-1.6.0-bin$ echo \"Hello world!\"|nc localhost 5555\n```\n\n再次打开一个 Xfce 终端，查看 /opt/apache-flume-1.6.0-bin/logs 下是否生成文件，默认每30秒生成一个新文件。","slug":"flume案例","published":1,"updated":"2021-06-18T08:07:11.187Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cku6979xk000b00uh7mk1au3m","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><p>Spool监测配置的目录下新增的文件，并将文件中的数据读取出来。需要注意两点：</p>\n<ul>\n<li>拷贝到 spool 目录下的文件不可以再打开编辑。</li>\n<li>spool 目录下不可包含相应的子目录。</li>\n</ul>\n<p>在 <code>/opt</code> 创建 agent 的配置文件 spool.conf。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hadoop@907b3dc56edb:&#x2F;opt$ sudo vi apache-flume-1.6.0-bin&#x2F;conf&#x2F;spool.conf</span><br><span class=\"line\"># 添加如下内容</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># Describe the agent</span><br><span class=\"line\">a1.sources &#x3D; r1</span><br><span class=\"line\">a1.sinks &#x3D; k1</span><br><span class=\"line\">a1.channels &#x3D; c1</span><br><span class=\"line\"></span><br><span class=\"line\"># Describe&#x2F;configure the source</span><br><span class=\"line\">a1.sources.r1.type &#x3D; spooldir</span><br><span class=\"line\">a1.sources.r1.channels &#x3D; c1</span><br><span class=\"line\">a1.sources.r1.spoolDir &#x3D; &#x2F;opt&#x2F;apache-flume-1.6.0-bin&#x2F;logs</span><br><span class=\"line\">a1.sources.r1.fileHeader &#x3D; true</span><br><span class=\"line\"></span><br><span class=\"line\"># Describe the sink</span><br><span class=\"line\">a1.sinks.k1.type &#x3D; logger</span><br><span class=\"line\"></span><br><span class=\"line\"># Use a channel which buffers events in memory</span><br><span class=\"line\">a1.channels.c1.type &#x3D; memory</span><br><span class=\"line\">a1.channels.c1.capacity &#x3D; 1000</span><br><span class=\"line\">a1.channels.c1.transactionCapacity &#x3D; 100</span><br><span class=\"line\"></span><br><span class=\"line\"># Bind the source and sink to the channel</span><br><span class=\"line\">a1.sources.r1.channels &#x3D; c1</span><br><span class=\"line\">a1.sinks.k1.channel &#x3D; c1</span><br></pre></td></tr></table></figure>\n\n<p>启动 Flume 代理。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hadoop@907b3dc56edb:&#x2F;opt&#x2F;apache-flume-1.6.0-bin$ bin&#x2F;flume-ng agent -c conf -f conf&#x2F;spool.conf -n a1 -Dflume.root.logger&#x3D;INFO,console</span><br></pre></td></tr></table></figure>\n\n<p>另外开启一个终端，追加文件到 apache-flume-1.6.0-bin/logs 目录。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hadoop@907b3dc56edb:&#x2F;opt$ echo &quot;Hello World&quot; &gt; apache-flume-1.6.0-bin&#x2F;logs&#x2F;spool.log</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"案例二之-ExecEXEC\"><a href=\"#案例二之-ExecEXEC\" class=\"headerlink\" title=\"案例二之 ExecEXEC\"></a>案例二之 ExecEXEC</h3><p>执行一个给定的命令获得输出的源。</p>\n<p>在 <code>/opt</code> 创建 agent 的配置文件 exec.conf。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hadoop@907b3dc56edb:&#x2F;opt$ sudo vi apache-flume-1.6.0-bin&#x2F;conf&#x2F;exec.conf</span><br><span class=\"line\"># 添加如下内容</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># Describe the agent</span><br><span class=\"line\">a1.sources &#x3D; r1</span><br><span class=\"line\">a1.sinks &#x3D; k1</span><br><span class=\"line\">a1.channels &#x3D; c1</span><br><span class=\"line\"></span><br><span class=\"line\"># Describe the source</span><br><span class=\"line\">a1.sources.r1.type &#x3D; exec</span><br><span class=\"line\">a1.sources.r1.channels &#x3D; c1</span><br><span class=\"line\">a1.sources.r1.command &#x3D; tail -F &#x2F;opt&#x2F;apache-flume-1.6.0-bin&#x2F;logs&#x2F;log_exec_tail</span><br><span class=\"line\"></span><br><span class=\"line\"># Describe the sink</span><br><span class=\"line\">a1.sinks.k1.type &#x3D; logger</span><br><span class=\"line\"></span><br><span class=\"line\"># Use a channel which buffers events in memory</span><br><span class=\"line\">a1.channels.c1.type &#x3D; memory</span><br><span class=\"line\">a1.channels.c1.capacity &#x3D; 1000</span><br><span class=\"line\">a1.channels.c1.transactionCapacity &#x3D; 100</span><br><span class=\"line\"></span><br><span class=\"line\"># Bind the source and sink to the channel</span><br><span class=\"line\">a1.sources.r1.channels &#x3D; c1</span><br><span class=\"line\">a1.sinks.k1.channel &#x3D; c1</span><br></pre></td></tr></table></figure>\n\n<p>启动 Flume 代理。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hadoop@907b3dc56edb:&#x2F;opt&#x2F;apache-flume-1.6.0-bin$ bin&#x2F;flume-ng agent -c conf -f conf&#x2F;exec.conf -n a1 -Dflume.root.logger&#x3D;INFO,console</span><br></pre></td></tr></table></figure>\n\n\n\n<p>另外开启一个终端，用脚本输出信息到 /opt/apache-flume-1.6.0-bin/log_exec_tail</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">for i in &#123;1..1000&#125;</span><br><span class=\"line\">do</span><br><span class=\"line\">echo &quot;exec tail$i&quot; &gt;&gt; &#x2F;opt&#x2F;apache-flume-1.6.0-bin&#x2F;logs&#x2F;log_exec_tail</span><br><span class=\"line\">done</span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"案例三之-JSONHandler\"><a href=\"#案例三之-JSONHandler\" class=\"headerlink\" title=\"案例三之 JSONHandler\"></a>案例三之 JSONHandler</h3><p>从远程客户端接收数据。</p>\n<p>在 <code>/opt</code> 创建 agent 的配置文件 json.conf。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hadoop@907b3dc56edb:&#x2F;opt$ sudo vi apache-flume-1.6.0-bin&#x2F;conf&#x2F;json.conf</span><br><span class=\"line\"># 添加如下内容</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># Describe the agent</span><br><span class=\"line\">a1.sources &#x3D; r1</span><br><span class=\"line\">a1.sinks &#x3D; k1</span><br><span class=\"line\">a1.channels &#x3D; c1</span><br><span class=\"line\"></span><br><span class=\"line\"># Describe the source</span><br><span class=\"line\">a1.sources.r1.type &#x3D; org.apache.flume.source.http.HTTPSource</span><br><span class=\"line\">a1.sources.r1.port &#x3D; 8888</span><br><span class=\"line\">a1.sources.r1.channels &#x3D; c1</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># Describe the sink</span><br><span class=\"line\">a1.sinks.k1.type &#x3D; logger</span><br><span class=\"line\"></span><br><span class=\"line\"># Use a channel which buffers events in memory</span><br><span class=\"line\">a1.channels.c1.type &#x3D; memory</span><br><span class=\"line\">a1.channels.c1.capacity &#x3D; 1000</span><br><span class=\"line\">a1.channels.c1.transactionCapacity &#x3D; 100</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># Bind the source and sink to the channel</span><br><span class=\"line\">a1.sources.r1.channels &#x3D; c1</span><br><span class=\"line\">a1.sinks.k1.channel &#x3D; c1</span><br></pre></td></tr></table></figure>\n\n<p>启动 Flume 代理。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hadoop@907b3dc56edb:&#x2F;opt&#x2F;apache-flume-1.6.0-bin$ bin&#x2F;flume-ng agent -c conf -f conf&#x2F;json.conf -n a1 -Dflume.root.logger&#x3D;INFO,console</span><br></pre></td></tr></table></figure>\n\n<p>生成 JSON 格式的POST request。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hadoop@907b3dc56edb:&#x2F;opt&#x2F;apache-flume-1.6.0-bin$  curl -X POST -d &#39;[&#123; &quot;headers&quot; :&#123;&quot;a&quot; : &quot;a1&quot;,&quot;b&quot; : &quot;b1&quot;&#125;,&quot;body&quot; : &quot;shiyanlou.org_body&quot;&#125;]&#39; http:&#x2F;&#x2F;localhost:8888</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"案例四之-Syslogtcp\"><a href=\"#案例四之-Syslogtcp\" class=\"headerlink\" title=\"案例四之 Syslogtcp\"></a>案例四之 Syslogtcp</h3><p>接下来，我们将要介绍如何把数据写入HDFS。</p>\n<p>在 <code>/opt</code> 创建 agent 配置文件 syslogtcp.conf。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hadoop@907b3dc56edb:&#x2F;opt$ sudo vi apache-flume-1.6.0-bin&#x2F;conf&#x2F;syslogtcp.conf</span><br><span class=\"line\"># 添加如下内容</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">a1.sources &#x3D; r1</span><br><span class=\"line\">a1.sinks &#x3D; k1</span><br><span class=\"line\">a1.channels &#x3D; c1</span><br><span class=\"line\"></span><br><span class=\"line\"># Describe&#x2F;configure the source</span><br><span class=\"line\">a1.sources.r1.type &#x3D; syslogtcp</span><br><span class=\"line\">a1.sources.r1.port &#x3D; 4444</span><br><span class=\"line\">a1.sources.r1.host &#x3D; localhost</span><br><span class=\"line\">a1.sources.r1.channels &#x3D; c1</span><br><span class=\"line\"></span><br><span class=\"line\"># Describe the sink</span><br><span class=\"line\">a1.sinks.k1.type &#x3D; hdfs</span><br><span class=\"line\">a1.sinks.k1.channel &#x3D; c1</span><br><span class=\"line\">a1.sinks.k1.hdfs.path &#x3D; hdfs:&#x2F;&#x2F;localhost:9000&#x2F;user&#x2F;hadoop&#x2F;syslogtcp</span><br><span class=\"line\">a1.sinks.k1.hdfs.filePrefix &#x3D; Syslog</span><br><span class=\"line\">a1.sinks.k1.hdfs.round &#x3D; true</span><br><span class=\"line\">a1.sinks.k1.hdfs.roundValue &#x3D; 10</span><br><span class=\"line\">a1.sinks.k1.hdfs.roundUnit &#x3D; minute</span><br><span class=\"line\"></span><br><span class=\"line\"># Use a channel which buffers events in memory</span><br><span class=\"line\">a1.channels.c1.type &#x3D; memory</span><br><span class=\"line\">a1.channels.c1.capacity &#x3D; 1000</span><br><span class=\"line\">a1.channels.c1.transactionCapacity &#x3D; 100</span><br><span class=\"line\"></span><br><span class=\"line\"># Bind the source and sink to the channel</span><br><span class=\"line\">a1.sources.r1.channels &#x3D; c1</span><br><span class=\"line\">a1.sinks.k1.channel &#x3D; c1</span><br></pre></td></tr></table></figure>\n\n<p>启动 Flume 代理。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hadoop@907b3dc56edb:&#x2F;opt&#x2F;apache-flume-1.6.0-bin$ bin&#x2F;flume-ng agent -c conf -f conf&#x2F;syslogtcp.conf -n a1 -Dflume.root.logger&#x3D;INFO,console</span><br></pre></td></tr></table></figure>\n\n<p>测试产生 syslog。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hadoop@907b3dc56edb:&#x2F;opt&#x2F;apache-flume-1.6.0-bin$  echo &quot;hello  flume&quot; | nc localhost 4444</span><br></pre></td></tr></table></figure>\n\n<p>再次打开一个 Xfce 终端，检查 hdfs 上是否生成文件。</p>\n<h3 id=\"案例五之-File-Roll-Sink\"><a href=\"#案例五之-File-Roll-Sink\" class=\"headerlink\" title=\"案例五之 File Roll Sink\"></a>案例五之 File Roll Sink</h3><p>接下来，我们将要介绍写入稍微复杂的文件数据，把动态生成的时间戳和数据一同写入 HDFS。</p>\n<p>在 <code>/opt</code> 创建 agent 的配置文件 file_roll.conf。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hadoop@907b3dc56edb:&#x2F;opt$ sudo vi apache-flume-1.6.0-bin&#x2F;conf&#x2F;file_roll.conf</span><br><span class=\"line\"># 添加如下内容</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">a1.sources &#x3D; r1</span><br><span class=\"line\">a1.sinks &#x3D; k1</span><br><span class=\"line\">a1.channels &#x3D; c1</span><br><span class=\"line\"></span><br><span class=\"line\"># Describe&#x2F;configure the source</span><br><span class=\"line\">a1.sources.r1.type &#x3D; syslogtcp</span><br><span class=\"line\">a1.sources.r1.port &#x3D; 5555</span><br><span class=\"line\">a1.sources.r1.host &#x3D; localhost</span><br><span class=\"line\">a1.sources.r1.channels &#x3D; c1</span><br><span class=\"line\"></span><br><span class=\"line\"># Describe the sinkmior</span><br><span class=\"line\"></span><br><span class=\"line\">a1.sinks.k1.type &#x3D; file_roll</span><br><span class=\"line\">a1.sinks.k1.sink.directory &#x3D; &#x2F;opt&#x2F;apache-flume-1.6.0-bin&#x2F;logs</span><br><span class=\"line\"></span><br><span class=\"line\"># Use a channel which buffers events in memory</span><br><span class=\"line\">a1.channels.c1.type &#x3D; memory</span><br><span class=\"line\">a1.channels.c1.capacity &#x3D; 1000</span><br><span class=\"line\">a1.channels.c1.transactionCapacity &#x3D; 100</span><br><span class=\"line\"></span><br><span class=\"line\"># Bind the source and sink to the channel</span><br><span class=\"line\">a1.sources.r1.channels &#x3D; c1</span><br><span class=\"line\">a1.sinks.k1.channel &#x3D; c1</span><br></pre></td></tr></table></figure>\n\n<p>启动 Flume 代理。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hadoop@907b3dc56edb:&#x2F;opt&#x2F;apache-flume-1.6.0-bin$ bin&#x2F;flume-ng agent -c conf -f conf&#x2F;file_roll.conf -n a1 -Dflume.root.logger&#x3D;INFO,console</span><br></pre></td></tr></table></figure>\n\n<p>另外开启一个 Xfce 终端中，测试产生 log。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hadoop@907b3dc56edb:&#x2F;opt&#x2F;apache-flume-1.6.0-bin$ echo &quot;Hello world!&quot;|nc localhost 5555</span><br></pre></td></tr></table></figure>\n\n<p>再次打开一个 Xfce 终端，查看 /opt/apache-flume-1.6.0-bin/logs 下是否生成文件，默认每30秒生成一个新文件。</p>\n","site":{"data":{}},"excerpt":"","more":"<p>Spool监测配置的目录下新增的文件，并将文件中的数据读取出来。需要注意两点：</p>\n<ul>\n<li>拷贝到 spool 目录下的文件不可以再打开编辑。</li>\n<li>spool 目录下不可包含相应的子目录。</li>\n</ul>\n<p>在 <code>/opt</code> 创建 agent 的配置文件 spool.conf。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hadoop@907b3dc56edb:&#x2F;opt$ sudo vi apache-flume-1.6.0-bin&#x2F;conf&#x2F;spool.conf</span><br><span class=\"line\"># 添加如下内容</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># Describe the agent</span><br><span class=\"line\">a1.sources &#x3D; r1</span><br><span class=\"line\">a1.sinks &#x3D; k1</span><br><span class=\"line\">a1.channels &#x3D; c1</span><br><span class=\"line\"></span><br><span class=\"line\"># Describe&#x2F;configure the source</span><br><span class=\"line\">a1.sources.r1.type &#x3D; spooldir</span><br><span class=\"line\">a1.sources.r1.channels &#x3D; c1</span><br><span class=\"line\">a1.sources.r1.spoolDir &#x3D; &#x2F;opt&#x2F;apache-flume-1.6.0-bin&#x2F;logs</span><br><span class=\"line\">a1.sources.r1.fileHeader &#x3D; true</span><br><span class=\"line\"></span><br><span class=\"line\"># Describe the sink</span><br><span class=\"line\">a1.sinks.k1.type &#x3D; logger</span><br><span class=\"line\"></span><br><span class=\"line\"># Use a channel which buffers events in memory</span><br><span class=\"line\">a1.channels.c1.type &#x3D; memory</span><br><span class=\"line\">a1.channels.c1.capacity &#x3D; 1000</span><br><span class=\"line\">a1.channels.c1.transactionCapacity &#x3D; 100</span><br><span class=\"line\"></span><br><span class=\"line\"># Bind the source and sink to the channel</span><br><span class=\"line\">a1.sources.r1.channels &#x3D; c1</span><br><span class=\"line\">a1.sinks.k1.channel &#x3D; c1</span><br></pre></td></tr></table></figure>\n\n<p>启动 Flume 代理。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hadoop@907b3dc56edb:&#x2F;opt&#x2F;apache-flume-1.6.0-bin$ bin&#x2F;flume-ng agent -c conf -f conf&#x2F;spool.conf -n a1 -Dflume.root.logger&#x3D;INFO,console</span><br></pre></td></tr></table></figure>\n\n<p>另外开启一个终端，追加文件到 apache-flume-1.6.0-bin/logs 目录。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hadoop@907b3dc56edb:&#x2F;opt$ echo &quot;Hello World&quot; &gt; apache-flume-1.6.0-bin&#x2F;logs&#x2F;spool.log</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"案例二之-ExecEXEC\"><a href=\"#案例二之-ExecEXEC\" class=\"headerlink\" title=\"案例二之 ExecEXEC\"></a>案例二之 ExecEXEC</h3><p>执行一个给定的命令获得输出的源。</p>\n<p>在 <code>/opt</code> 创建 agent 的配置文件 exec.conf。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hadoop@907b3dc56edb:&#x2F;opt$ sudo vi apache-flume-1.6.0-bin&#x2F;conf&#x2F;exec.conf</span><br><span class=\"line\"># 添加如下内容</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># Describe the agent</span><br><span class=\"line\">a1.sources &#x3D; r1</span><br><span class=\"line\">a1.sinks &#x3D; k1</span><br><span class=\"line\">a1.channels &#x3D; c1</span><br><span class=\"line\"></span><br><span class=\"line\"># Describe the source</span><br><span class=\"line\">a1.sources.r1.type &#x3D; exec</span><br><span class=\"line\">a1.sources.r1.channels &#x3D; c1</span><br><span class=\"line\">a1.sources.r1.command &#x3D; tail -F &#x2F;opt&#x2F;apache-flume-1.6.0-bin&#x2F;logs&#x2F;log_exec_tail</span><br><span class=\"line\"></span><br><span class=\"line\"># Describe the sink</span><br><span class=\"line\">a1.sinks.k1.type &#x3D; logger</span><br><span class=\"line\"></span><br><span class=\"line\"># Use a channel which buffers events in memory</span><br><span class=\"line\">a1.channels.c1.type &#x3D; memory</span><br><span class=\"line\">a1.channels.c1.capacity &#x3D; 1000</span><br><span class=\"line\">a1.channels.c1.transactionCapacity &#x3D; 100</span><br><span class=\"line\"></span><br><span class=\"line\"># Bind the source and sink to the channel</span><br><span class=\"line\">a1.sources.r1.channels &#x3D; c1</span><br><span class=\"line\">a1.sinks.k1.channel &#x3D; c1</span><br></pre></td></tr></table></figure>\n\n<p>启动 Flume 代理。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hadoop@907b3dc56edb:&#x2F;opt&#x2F;apache-flume-1.6.0-bin$ bin&#x2F;flume-ng agent -c conf -f conf&#x2F;exec.conf -n a1 -Dflume.root.logger&#x3D;INFO,console</span><br></pre></td></tr></table></figure>\n\n\n\n<p>另外开启一个终端，用脚本输出信息到 /opt/apache-flume-1.6.0-bin/log_exec_tail</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">for i in &#123;1..1000&#125;</span><br><span class=\"line\">do</span><br><span class=\"line\">echo &quot;exec tail$i&quot; &gt;&gt; &#x2F;opt&#x2F;apache-flume-1.6.0-bin&#x2F;logs&#x2F;log_exec_tail</span><br><span class=\"line\">done</span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"案例三之-JSONHandler\"><a href=\"#案例三之-JSONHandler\" class=\"headerlink\" title=\"案例三之 JSONHandler\"></a>案例三之 JSONHandler</h3><p>从远程客户端接收数据。</p>\n<p>在 <code>/opt</code> 创建 agent 的配置文件 json.conf。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hadoop@907b3dc56edb:&#x2F;opt$ sudo vi apache-flume-1.6.0-bin&#x2F;conf&#x2F;json.conf</span><br><span class=\"line\"># 添加如下内容</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># Describe the agent</span><br><span class=\"line\">a1.sources &#x3D; r1</span><br><span class=\"line\">a1.sinks &#x3D; k1</span><br><span class=\"line\">a1.channels &#x3D; c1</span><br><span class=\"line\"></span><br><span class=\"line\"># Describe the source</span><br><span class=\"line\">a1.sources.r1.type &#x3D; org.apache.flume.source.http.HTTPSource</span><br><span class=\"line\">a1.sources.r1.port &#x3D; 8888</span><br><span class=\"line\">a1.sources.r1.channels &#x3D; c1</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># Describe the sink</span><br><span class=\"line\">a1.sinks.k1.type &#x3D; logger</span><br><span class=\"line\"></span><br><span class=\"line\"># Use a channel which buffers events in memory</span><br><span class=\"line\">a1.channels.c1.type &#x3D; memory</span><br><span class=\"line\">a1.channels.c1.capacity &#x3D; 1000</span><br><span class=\"line\">a1.channels.c1.transactionCapacity &#x3D; 100</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># Bind the source and sink to the channel</span><br><span class=\"line\">a1.sources.r1.channels &#x3D; c1</span><br><span class=\"line\">a1.sinks.k1.channel &#x3D; c1</span><br></pre></td></tr></table></figure>\n\n<p>启动 Flume 代理。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hadoop@907b3dc56edb:&#x2F;opt&#x2F;apache-flume-1.6.0-bin$ bin&#x2F;flume-ng agent -c conf -f conf&#x2F;json.conf -n a1 -Dflume.root.logger&#x3D;INFO,console</span><br></pre></td></tr></table></figure>\n\n<p>生成 JSON 格式的POST request。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hadoop@907b3dc56edb:&#x2F;opt&#x2F;apache-flume-1.6.0-bin$  curl -X POST -d &#39;[&#123; &quot;headers&quot; :&#123;&quot;a&quot; : &quot;a1&quot;,&quot;b&quot; : &quot;b1&quot;&#125;,&quot;body&quot; : &quot;shiyanlou.org_body&quot;&#125;]&#39; http:&#x2F;&#x2F;localhost:8888</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"案例四之-Syslogtcp\"><a href=\"#案例四之-Syslogtcp\" class=\"headerlink\" title=\"案例四之 Syslogtcp\"></a>案例四之 Syslogtcp</h3><p>接下来，我们将要介绍如何把数据写入HDFS。</p>\n<p>在 <code>/opt</code> 创建 agent 配置文件 syslogtcp.conf。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hadoop@907b3dc56edb:&#x2F;opt$ sudo vi apache-flume-1.6.0-bin&#x2F;conf&#x2F;syslogtcp.conf</span><br><span class=\"line\"># 添加如下内容</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">a1.sources &#x3D; r1</span><br><span class=\"line\">a1.sinks &#x3D; k1</span><br><span class=\"line\">a1.channels &#x3D; c1</span><br><span class=\"line\"></span><br><span class=\"line\"># Describe&#x2F;configure the source</span><br><span class=\"line\">a1.sources.r1.type &#x3D; syslogtcp</span><br><span class=\"line\">a1.sources.r1.port &#x3D; 4444</span><br><span class=\"line\">a1.sources.r1.host &#x3D; localhost</span><br><span class=\"line\">a1.sources.r1.channels &#x3D; c1</span><br><span class=\"line\"></span><br><span class=\"line\"># Describe the sink</span><br><span class=\"line\">a1.sinks.k1.type &#x3D; hdfs</span><br><span class=\"line\">a1.sinks.k1.channel &#x3D; c1</span><br><span class=\"line\">a1.sinks.k1.hdfs.path &#x3D; hdfs:&#x2F;&#x2F;localhost:9000&#x2F;user&#x2F;hadoop&#x2F;syslogtcp</span><br><span class=\"line\">a1.sinks.k1.hdfs.filePrefix &#x3D; Syslog</span><br><span class=\"line\">a1.sinks.k1.hdfs.round &#x3D; true</span><br><span class=\"line\">a1.sinks.k1.hdfs.roundValue &#x3D; 10</span><br><span class=\"line\">a1.sinks.k1.hdfs.roundUnit &#x3D; minute</span><br><span class=\"line\"></span><br><span class=\"line\"># Use a channel which buffers events in memory</span><br><span class=\"line\">a1.channels.c1.type &#x3D; memory</span><br><span class=\"line\">a1.channels.c1.capacity &#x3D; 1000</span><br><span class=\"line\">a1.channels.c1.transactionCapacity &#x3D; 100</span><br><span class=\"line\"></span><br><span class=\"line\"># Bind the source and sink to the channel</span><br><span class=\"line\">a1.sources.r1.channels &#x3D; c1</span><br><span class=\"line\">a1.sinks.k1.channel &#x3D; c1</span><br></pre></td></tr></table></figure>\n\n<p>启动 Flume 代理。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hadoop@907b3dc56edb:&#x2F;opt&#x2F;apache-flume-1.6.0-bin$ bin&#x2F;flume-ng agent -c conf -f conf&#x2F;syslogtcp.conf -n a1 -Dflume.root.logger&#x3D;INFO,console</span><br></pre></td></tr></table></figure>\n\n<p>测试产生 syslog。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hadoop@907b3dc56edb:&#x2F;opt&#x2F;apache-flume-1.6.0-bin$  echo &quot;hello  flume&quot; | nc localhost 4444</span><br></pre></td></tr></table></figure>\n\n<p>再次打开一个 Xfce 终端，检查 hdfs 上是否生成文件。</p>\n<h3 id=\"案例五之-File-Roll-Sink\"><a href=\"#案例五之-File-Roll-Sink\" class=\"headerlink\" title=\"案例五之 File Roll Sink\"></a>案例五之 File Roll Sink</h3><p>接下来，我们将要介绍写入稍微复杂的文件数据，把动态生成的时间戳和数据一同写入 HDFS。</p>\n<p>在 <code>/opt</code> 创建 agent 的配置文件 file_roll.conf。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hadoop@907b3dc56edb:&#x2F;opt$ sudo vi apache-flume-1.6.0-bin&#x2F;conf&#x2F;file_roll.conf</span><br><span class=\"line\"># 添加如下内容</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">a1.sources &#x3D; r1</span><br><span class=\"line\">a1.sinks &#x3D; k1</span><br><span class=\"line\">a1.channels &#x3D; c1</span><br><span class=\"line\"></span><br><span class=\"line\"># Describe&#x2F;configure the source</span><br><span class=\"line\">a1.sources.r1.type &#x3D; syslogtcp</span><br><span class=\"line\">a1.sources.r1.port &#x3D; 5555</span><br><span class=\"line\">a1.sources.r1.host &#x3D; localhost</span><br><span class=\"line\">a1.sources.r1.channels &#x3D; c1</span><br><span class=\"line\"></span><br><span class=\"line\"># Describe the sinkmior</span><br><span class=\"line\"></span><br><span class=\"line\">a1.sinks.k1.type &#x3D; file_roll</span><br><span class=\"line\">a1.sinks.k1.sink.directory &#x3D; &#x2F;opt&#x2F;apache-flume-1.6.0-bin&#x2F;logs</span><br><span class=\"line\"></span><br><span class=\"line\"># Use a channel which buffers events in memory</span><br><span class=\"line\">a1.channels.c1.type &#x3D; memory</span><br><span class=\"line\">a1.channels.c1.capacity &#x3D; 1000</span><br><span class=\"line\">a1.channels.c1.transactionCapacity &#x3D; 100</span><br><span class=\"line\"></span><br><span class=\"line\"># Bind the source and sink to the channel</span><br><span class=\"line\">a1.sources.r1.channels &#x3D; c1</span><br><span class=\"line\">a1.sinks.k1.channel &#x3D; c1</span><br></pre></td></tr></table></figure>\n\n<p>启动 Flume 代理。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hadoop@907b3dc56edb:&#x2F;opt&#x2F;apache-flume-1.6.0-bin$ bin&#x2F;flume-ng agent -c conf -f conf&#x2F;file_roll.conf -n a1 -Dflume.root.logger&#x3D;INFO,console</span><br></pre></td></tr></table></figure>\n\n<p>另外开启一个 Xfce 终端中，测试产生 log。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hadoop@907b3dc56edb:&#x2F;opt&#x2F;apache-flume-1.6.0-bin$ echo &quot;Hello world!&quot;|nc localhost 5555</span><br></pre></td></tr></table></figure>\n\n<p>再次打开一个 Xfce 终端，查看 /opt/apache-flume-1.6.0-bin/logs 下是否生成文件，默认每30秒生成一个新文件。</p>\n"},{"title":"gcc 升级","date":"2020-09-21T08:34:00.000Z","_content":"\n```\ngcc -v\n\n使用内建 specs。\nCOLLECT_GCC=gcc\nCOLLECT_LTO_WRAPPER=/usr/libexec/gcc/x86_64-redhat-linux/4.8.5/lto-wrapper\n目标：x86_64-redhat-linux\n配置为：../configure --prefix=/usr --mandir=/usr/share/man --infodir=/usr/share/info --with-bugurl=http://bugzilla.redhat.com/bugzilla --enable-bootstrap --enable-shared --enable-threads=posix --enable-checking=release --with-system-zlib --enable-__cxa_atexit --disable-libunwind-exceptions --enable-gnu-unique-object --enable-linker-build-id --with-linker-hash-style=gnu --enable-languages=c,c++,objc,obj-c++,java,fortran,ada,go,lto --enable-plugin --enable-initfini-array --disable-libgcj --with-isl=/builddir/build/BUILD/gcc-4.8.5-20150702/obj-x86_64-redhat-linux/isl-install --with-cloog=/builddir/build/BUILD/gcc-4.8.5-20150702/obj-x86_64-redhat-linux/cloog-install --enable-gnu-indirect-function --with-tune=generic --with-arch_32=x86-64 --build=x86_64-redhat-linux\n线程模型：posix\ngcc 版本 4.8.5 20150623 (Red Hat 4.8.5-39) (GCC)\n```\n\n**安装\\**RHEL/C\\*\\*entos\\*\\*7\\**默认的开发工具，包含gcc，g++,make等等一系列工具**\n\n```\nyum groupinstall \"Development Tools\"\n```\n\n**查看默认动态库：** \n\n```\nstrings /usr/lib64/libstdc++.so.6 | grep GLIBC\n\nGLIBCXX_3.4\nGLIBCXX_3.4.1\nGLIBCXX_3.4.2\nGLIBCXX_3.4.3\nGLIBCXX_3.4.4\nGLIBCXX_3.4.5\nGLIBCXX_3.4.6\nGLIBCXX_3.4.7\nGLIBCXX_3.4.8\nGLIBCXX_3.4.9\nGLIBCXX_3.4.10\nGLIBCXX_3.4.11\nGLIBCXX_3.4.12\nGLIBCXX_3.4.13\nGLIBCXX_3.4.14\nGLIBCXX_3.4.15\nGLIBCXX_3.4.16\nGLIBCXX_3.4.17\nGLIBCXX_3.4.18\nGLIBCXX_3.4.19\nGLIBC_2.3\nGLIBC_2.2.5\nGLIBC_2.14\nGLIBC_2.4\nGLIBC_2.3.2\nGLIBCXX_DEBUG_MESSAGE_LENGTH\n\n```\n\n**获取安装包并解压：**\n\n```\nhttp://ftp.gnu.org/gnu/gcc/\n```\n\n**安装gcc的依赖软件，gcc的软件包内提供了自动下载需要软件的脚本\\**./contrib/download_prerequisites\\****   这个过程会持续很久，根据网络情况\n\n网络差可以将离线包放在gcc-9.3.0目录下即可 \n```\n./contrib/download_prerequisites\n\n\n2020-05-15 10:48:52 URL: ftp://gcc.gnu.org/pub/gcc/infrastructure/gmp-6.1.0.tar.bz2 [2383840] -> \"./gmp-6.1.0.tar.bz2\" [1]\n2020-05-15 10:50:14 URL: ftp://gcc.gnu.org/pub/gcc/infrastructure/mpfr-3.1.4.tar.bz2 [1279284] -> \"./mpfr-3.1.4.tar.bz2\" [1]\n2020-05-15 10:50:52 URL: ftp://gcc.gnu.org/pub/gcc/infrastructure/mpc-1.0.3.tar.gz [669925] -> \"./mpc-1.0.3.tar.gz\" [1]\n2020-05-15 10:53:09 URL: ftp://gcc.gnu.org/pub/gcc/infrastructure/isl-0.18.tar.bz2 [1658291] -> \"./isl-0.18.tar.bz2\" [1]\ngmp-6.1.0.tar.bz2: 确定\nmpfr-3.1.4.tar.bz2: 确定\nmpc-1.0.3.tar.gz: 确定\nisl-0.18.tar.bz2: 确定\nAll prerequisites downloaded successfully.\n\n```\n\n\n**生成Makefile文件**\n\n```\n./configure --prefix=/usr/local -enable-checking=release -enable-languages=c,c++ -disable-multilib\n\n```\n\n**编译gcc**\n\n```\nmake -j4    #多核电脑可以添加 “-j4” ：make对多核处理器的优化选项，此步骤非常耗时\n\nls /usr/local/bin | grep gcc\n```\n\n**安装gcc**\n\n```\n make install\n```\n\n**配置gcc**\n\n```\ncd ~\nfind /usr/local/src/gcc-9.2.0/ -name \"libstdc++.so*\"\n\n/usr/local/src/gcc-9.2.0/stage1-x86_64-pc-linux-gnu/libstdc++-v3/src/.libs/libstdc++.so.6.0.24\n/usr/local/src/gcc-9.2.0/stage1-x86_64-pc-linux-gnu/libstdc++-v3/src/.libs/libstdc++.so.6\n/usr/local/src/gcc-9.2.0/stage1-x86_64-pc-linux-gnu/libstdc++-v3/src/.libs/libstdc++.so\n/usr/local/src/gcc-9.2.0/prev-x86_64-pc-linux-gnu/libstdc++-v3/src/.libs/libstdc++.so.6.0.24\n/usr/local/src/gcc-9.2.0/prev-x86_64-pc-linux-gnu/libstdc++-v3/src/.libs/libstdc++.so.6\n/usr/local/src/gcc-9.2.0/prev-x86_64-pc-linux-gnu/libstdc++-v3/src/.libs/libstdc++.so\n/usr/local/src/gcc-9.2.0/x86_64-pc-linux-gnu/libstdc++-v3/src/.libs/libstdc++.so.6.0.24\n/usr/local/src/gcc-9.2.0/x86_64-pc-linux-gnu/libstdc++-v3/src/.libs/libstdc++.so.6\n/usr/local/src/gcc-9.2.0/x86_64-pc-linux-gnu/libstdc++-v3/src/.libs/libstdc++.so\n\ncd /usr/lib64\ncp /usr/local/src/gcc-9.2.0/stage1-x86_64-pc-linux-gnu/libstdc++-v3/src/.libs/libstdc++.so.6.0.27 .\nmv libstdc++.so.6 libstdc++.so.6.old\nln -sv libstdc++.so.6.0.27 libstdc++.so.6\n\"libstdc++.so.6\" -> \"libstdc++.so.6.0.27\"\n```\n\n\n\n重启系统\n\n```\nreboot\n\n\n\ngcc -v\n\n```\n\n\n\n## cmake 安装\n\n### 获取\n```\nhttps://cmake.org/download/\n\nwget https://github.com/Kitware/CMake/releases/download/v3.20.0/cmake-3.20.0.tar.gz\n```\n\n\n### 编译\n```\ncd /usr/local/src\ntar xf cmake-3.20.0.tar.gz\ncd cmake-3.20.0\n./configure --prefix=/usr/local/cmake\nmake && make install\n```\n\n### 软连接\n```\nln -s /usr/local/cmake/bin/cmake /usr/bin/cmake\n```\n### 验证\n```\ncmake -version\n```\n```\ncmake version 3.20.0\n\nCMake suite maintained and supported by Kitware (kitware.com/cmake).\n```","source":"_posts/gcc升级.md","raw":"---\ntitle: gcc 升级\ndate: 2020-09-21 16:34\ncategories:\n- gcc\ntags:\n- gcc\n- linux\n---\n\n```\ngcc -v\n\n使用内建 specs。\nCOLLECT_GCC=gcc\nCOLLECT_LTO_WRAPPER=/usr/libexec/gcc/x86_64-redhat-linux/4.8.5/lto-wrapper\n目标：x86_64-redhat-linux\n配置为：../configure --prefix=/usr --mandir=/usr/share/man --infodir=/usr/share/info --with-bugurl=http://bugzilla.redhat.com/bugzilla --enable-bootstrap --enable-shared --enable-threads=posix --enable-checking=release --with-system-zlib --enable-__cxa_atexit --disable-libunwind-exceptions --enable-gnu-unique-object --enable-linker-build-id --with-linker-hash-style=gnu --enable-languages=c,c++,objc,obj-c++,java,fortran,ada,go,lto --enable-plugin --enable-initfini-array --disable-libgcj --with-isl=/builddir/build/BUILD/gcc-4.8.5-20150702/obj-x86_64-redhat-linux/isl-install --with-cloog=/builddir/build/BUILD/gcc-4.8.5-20150702/obj-x86_64-redhat-linux/cloog-install --enable-gnu-indirect-function --with-tune=generic --with-arch_32=x86-64 --build=x86_64-redhat-linux\n线程模型：posix\ngcc 版本 4.8.5 20150623 (Red Hat 4.8.5-39) (GCC)\n```\n\n**安装\\**RHEL/C\\*\\*entos\\*\\*7\\**默认的开发工具，包含gcc，g++,make等等一系列工具**\n\n```\nyum groupinstall \"Development Tools\"\n```\n\n**查看默认动态库：** \n\n```\nstrings /usr/lib64/libstdc++.so.6 | grep GLIBC\n\nGLIBCXX_3.4\nGLIBCXX_3.4.1\nGLIBCXX_3.4.2\nGLIBCXX_3.4.3\nGLIBCXX_3.4.4\nGLIBCXX_3.4.5\nGLIBCXX_3.4.6\nGLIBCXX_3.4.7\nGLIBCXX_3.4.8\nGLIBCXX_3.4.9\nGLIBCXX_3.4.10\nGLIBCXX_3.4.11\nGLIBCXX_3.4.12\nGLIBCXX_3.4.13\nGLIBCXX_3.4.14\nGLIBCXX_3.4.15\nGLIBCXX_3.4.16\nGLIBCXX_3.4.17\nGLIBCXX_3.4.18\nGLIBCXX_3.4.19\nGLIBC_2.3\nGLIBC_2.2.5\nGLIBC_2.14\nGLIBC_2.4\nGLIBC_2.3.2\nGLIBCXX_DEBUG_MESSAGE_LENGTH\n\n```\n\n**获取安装包并解压：**\n\n```\nhttp://ftp.gnu.org/gnu/gcc/\n```\n\n**安装gcc的依赖软件，gcc的软件包内提供了自动下载需要软件的脚本\\**./contrib/download_prerequisites\\****   这个过程会持续很久，根据网络情况\n\n网络差可以将离线包放在gcc-9.3.0目录下即可 \n```\n./contrib/download_prerequisites\n\n\n2020-05-15 10:48:52 URL: ftp://gcc.gnu.org/pub/gcc/infrastructure/gmp-6.1.0.tar.bz2 [2383840] -> \"./gmp-6.1.0.tar.bz2\" [1]\n2020-05-15 10:50:14 URL: ftp://gcc.gnu.org/pub/gcc/infrastructure/mpfr-3.1.4.tar.bz2 [1279284] -> \"./mpfr-3.1.4.tar.bz2\" [1]\n2020-05-15 10:50:52 URL: ftp://gcc.gnu.org/pub/gcc/infrastructure/mpc-1.0.3.tar.gz [669925] -> \"./mpc-1.0.3.tar.gz\" [1]\n2020-05-15 10:53:09 URL: ftp://gcc.gnu.org/pub/gcc/infrastructure/isl-0.18.tar.bz2 [1658291] -> \"./isl-0.18.tar.bz2\" [1]\ngmp-6.1.0.tar.bz2: 确定\nmpfr-3.1.4.tar.bz2: 确定\nmpc-1.0.3.tar.gz: 确定\nisl-0.18.tar.bz2: 确定\nAll prerequisites downloaded successfully.\n\n```\n\n\n**生成Makefile文件**\n\n```\n./configure --prefix=/usr/local -enable-checking=release -enable-languages=c,c++ -disable-multilib\n\n```\n\n**编译gcc**\n\n```\nmake -j4    #多核电脑可以添加 “-j4” ：make对多核处理器的优化选项，此步骤非常耗时\n\nls /usr/local/bin | grep gcc\n```\n\n**安装gcc**\n\n```\n make install\n```\n\n**配置gcc**\n\n```\ncd ~\nfind /usr/local/src/gcc-9.2.0/ -name \"libstdc++.so*\"\n\n/usr/local/src/gcc-9.2.0/stage1-x86_64-pc-linux-gnu/libstdc++-v3/src/.libs/libstdc++.so.6.0.24\n/usr/local/src/gcc-9.2.0/stage1-x86_64-pc-linux-gnu/libstdc++-v3/src/.libs/libstdc++.so.6\n/usr/local/src/gcc-9.2.0/stage1-x86_64-pc-linux-gnu/libstdc++-v3/src/.libs/libstdc++.so\n/usr/local/src/gcc-9.2.0/prev-x86_64-pc-linux-gnu/libstdc++-v3/src/.libs/libstdc++.so.6.0.24\n/usr/local/src/gcc-9.2.0/prev-x86_64-pc-linux-gnu/libstdc++-v3/src/.libs/libstdc++.so.6\n/usr/local/src/gcc-9.2.0/prev-x86_64-pc-linux-gnu/libstdc++-v3/src/.libs/libstdc++.so\n/usr/local/src/gcc-9.2.0/x86_64-pc-linux-gnu/libstdc++-v3/src/.libs/libstdc++.so.6.0.24\n/usr/local/src/gcc-9.2.0/x86_64-pc-linux-gnu/libstdc++-v3/src/.libs/libstdc++.so.6\n/usr/local/src/gcc-9.2.0/x86_64-pc-linux-gnu/libstdc++-v3/src/.libs/libstdc++.so\n\ncd /usr/lib64\ncp /usr/local/src/gcc-9.2.0/stage1-x86_64-pc-linux-gnu/libstdc++-v3/src/.libs/libstdc++.so.6.0.27 .\nmv libstdc++.so.6 libstdc++.so.6.old\nln -sv libstdc++.so.6.0.27 libstdc++.so.6\n\"libstdc++.so.6\" -> \"libstdc++.so.6.0.27\"\n```\n\n\n\n重启系统\n\n```\nreboot\n\n\n\ngcc -v\n\n```\n\n\n\n## cmake 安装\n\n### 获取\n```\nhttps://cmake.org/download/\n\nwget https://github.com/Kitware/CMake/releases/download/v3.20.0/cmake-3.20.0.tar.gz\n```\n\n\n### 编译\n```\ncd /usr/local/src\ntar xf cmake-3.20.0.tar.gz\ncd cmake-3.20.0\n./configure --prefix=/usr/local/cmake\nmake && make install\n```\n\n### 软连接\n```\nln -s /usr/local/cmake/bin/cmake /usr/bin/cmake\n```\n### 验证\n```\ncmake -version\n```\n```\ncmake version 3.20.0\n\nCMake suite maintained and supported by Kitware (kitware.com/cmake).\n```","slug":"gcc升级","published":1,"updated":"2021-06-18T08:07:11.187Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cku6979xn000e00uhcmp872w5","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">gcc -v</span><br><span class=\"line\"></span><br><span class=\"line\">使用内建 specs。</span><br><span class=\"line\">COLLECT_GCC&#x3D;gcc</span><br><span class=\"line\">COLLECT_LTO_WRAPPER&#x3D;&#x2F;usr&#x2F;libexec&#x2F;gcc&#x2F;x86_64-redhat-linux&#x2F;4.8.5&#x2F;lto-wrapper</span><br><span class=\"line\">目标：x86_64-redhat-linux</span><br><span class=\"line\">配置为：..&#x2F;configure --prefix&#x3D;&#x2F;usr --mandir&#x3D;&#x2F;usr&#x2F;share&#x2F;man --infodir&#x3D;&#x2F;usr&#x2F;share&#x2F;info --with-bugurl&#x3D;http:&#x2F;&#x2F;bugzilla.redhat.com&#x2F;bugzilla --enable-bootstrap --enable-shared --enable-threads&#x3D;posix --enable-checking&#x3D;release --with-system-zlib --enable-__cxa_atexit --disable-libunwind-exceptions --enable-gnu-unique-object --enable-linker-build-id --with-linker-hash-style&#x3D;gnu --enable-languages&#x3D;c,c++,objc,obj-c++,java,fortran,ada,go,lto --enable-plugin --enable-initfini-array --disable-libgcj --with-isl&#x3D;&#x2F;builddir&#x2F;build&#x2F;BUILD&#x2F;gcc-4.8.5-20150702&#x2F;obj-x86_64-redhat-linux&#x2F;isl-install --with-cloog&#x3D;&#x2F;builddir&#x2F;build&#x2F;BUILD&#x2F;gcc-4.8.5-20150702&#x2F;obj-x86_64-redhat-linux&#x2F;cloog-install --enable-gnu-indirect-function --with-tune&#x3D;generic --with-arch_32&#x3D;x86-64 --build&#x3D;x86_64-redhat-linux</span><br><span class=\"line\">线程模型：posix</span><br><span class=\"line\">gcc 版本 4.8.5 20150623 (Red Hat 4.8.5-39) (GCC)</span><br></pre></td></tr></table></figure>\n\n<p><strong>安装\\</strong>RHEL/C**entos**7**默认的开发工具，包含gcc，g++,make等等一系列工具**</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum groupinstall &quot;Development Tools&quot;</span><br></pre></td></tr></table></figure>\n\n<p><strong>查看默认动态库：</strong> </p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">strings &#x2F;usr&#x2F;lib64&#x2F;libstdc++.so.6 | grep GLIBC</span><br><span class=\"line\"></span><br><span class=\"line\">GLIBCXX_3.4</span><br><span class=\"line\">GLIBCXX_3.4.1</span><br><span class=\"line\">GLIBCXX_3.4.2</span><br><span class=\"line\">GLIBCXX_3.4.3</span><br><span class=\"line\">GLIBCXX_3.4.4</span><br><span class=\"line\">GLIBCXX_3.4.5</span><br><span class=\"line\">GLIBCXX_3.4.6</span><br><span class=\"line\">GLIBCXX_3.4.7</span><br><span class=\"line\">GLIBCXX_3.4.8</span><br><span class=\"line\">GLIBCXX_3.4.9</span><br><span class=\"line\">GLIBCXX_3.4.10</span><br><span class=\"line\">GLIBCXX_3.4.11</span><br><span class=\"line\">GLIBCXX_3.4.12</span><br><span class=\"line\">GLIBCXX_3.4.13</span><br><span class=\"line\">GLIBCXX_3.4.14</span><br><span class=\"line\">GLIBCXX_3.4.15</span><br><span class=\"line\">GLIBCXX_3.4.16</span><br><span class=\"line\">GLIBCXX_3.4.17</span><br><span class=\"line\">GLIBCXX_3.4.18</span><br><span class=\"line\">GLIBCXX_3.4.19</span><br><span class=\"line\">GLIBC_2.3</span><br><span class=\"line\">GLIBC_2.2.5</span><br><span class=\"line\">GLIBC_2.14</span><br><span class=\"line\">GLIBC_2.4</span><br><span class=\"line\">GLIBC_2.3.2</span><br><span class=\"line\">GLIBCXX_DEBUG_MESSAGE_LENGTH</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p><strong>获取安装包并解压：</strong></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">http:&#x2F;&#x2F;ftp.gnu.org&#x2F;gnu&#x2F;gcc&#x2F;</span><br></pre></td></tr></table></figure>\n\n<p><strong>安装gcc的依赖软件，gcc的软件包内提供了自动下载需要软件的脚本\\</strong>./contrib/download_prerequisites****   这个过程会持续很久，根据网络情况</p>\n<p>网络差可以将离线包放在gcc-9.3.0目录下即可 </p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">.&#x2F;contrib&#x2F;download_prerequisites</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">2020-05-15 10:48:52 URL: ftp:&#x2F;&#x2F;gcc.gnu.org&#x2F;pub&#x2F;gcc&#x2F;infrastructure&#x2F;gmp-6.1.0.tar.bz2 [2383840] -&gt; &quot;.&#x2F;gmp-6.1.0.tar.bz2&quot; [1]</span><br><span class=\"line\">2020-05-15 10:50:14 URL: ftp:&#x2F;&#x2F;gcc.gnu.org&#x2F;pub&#x2F;gcc&#x2F;infrastructure&#x2F;mpfr-3.1.4.tar.bz2 [1279284] -&gt; &quot;.&#x2F;mpfr-3.1.4.tar.bz2&quot; [1]</span><br><span class=\"line\">2020-05-15 10:50:52 URL: ftp:&#x2F;&#x2F;gcc.gnu.org&#x2F;pub&#x2F;gcc&#x2F;infrastructure&#x2F;mpc-1.0.3.tar.gz [669925] -&gt; &quot;.&#x2F;mpc-1.0.3.tar.gz&quot; [1]</span><br><span class=\"line\">2020-05-15 10:53:09 URL: ftp:&#x2F;&#x2F;gcc.gnu.org&#x2F;pub&#x2F;gcc&#x2F;infrastructure&#x2F;isl-0.18.tar.bz2 [1658291] -&gt; &quot;.&#x2F;isl-0.18.tar.bz2&quot; [1]</span><br><span class=\"line\">gmp-6.1.0.tar.bz2: 确定</span><br><span class=\"line\">mpfr-3.1.4.tar.bz2: 确定</span><br><span class=\"line\">mpc-1.0.3.tar.gz: 确定</span><br><span class=\"line\">isl-0.18.tar.bz2: 确定</span><br><span class=\"line\">All prerequisites downloaded successfully.</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n<p><strong>生成Makefile文件</strong></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">.&#x2F;configure --prefix&#x3D;&#x2F;usr&#x2F;local -enable-checking&#x3D;release -enable-languages&#x3D;c,c++ -disable-multilib</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p><strong>编译gcc</strong></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">make -j4    #多核电脑可以添加 “-j4” ：make对多核处理器的优化选项，此步骤非常耗时</span><br><span class=\"line\"></span><br><span class=\"line\">ls &#x2F;usr&#x2F;local&#x2F;bin | grep gcc</span><br></pre></td></tr></table></figure>\n\n<p><strong>安装gcc</strong></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">make install</span><br></pre></td></tr></table></figure>\n\n<p><strong>配置gcc</strong></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd ~</span><br><span class=\"line\">find &#x2F;usr&#x2F;local&#x2F;src&#x2F;gcc-9.2.0&#x2F; -name &quot;libstdc++.so*&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">&#x2F;usr&#x2F;local&#x2F;src&#x2F;gcc-9.2.0&#x2F;stage1-x86_64-pc-linux-gnu&#x2F;libstdc++-v3&#x2F;src&#x2F;.libs&#x2F;libstdc++.so.6.0.24</span><br><span class=\"line\">&#x2F;usr&#x2F;local&#x2F;src&#x2F;gcc-9.2.0&#x2F;stage1-x86_64-pc-linux-gnu&#x2F;libstdc++-v3&#x2F;src&#x2F;.libs&#x2F;libstdc++.so.6</span><br><span class=\"line\">&#x2F;usr&#x2F;local&#x2F;src&#x2F;gcc-9.2.0&#x2F;stage1-x86_64-pc-linux-gnu&#x2F;libstdc++-v3&#x2F;src&#x2F;.libs&#x2F;libstdc++.so</span><br><span class=\"line\">&#x2F;usr&#x2F;local&#x2F;src&#x2F;gcc-9.2.0&#x2F;prev-x86_64-pc-linux-gnu&#x2F;libstdc++-v3&#x2F;src&#x2F;.libs&#x2F;libstdc++.so.6.0.24</span><br><span class=\"line\">&#x2F;usr&#x2F;local&#x2F;src&#x2F;gcc-9.2.0&#x2F;prev-x86_64-pc-linux-gnu&#x2F;libstdc++-v3&#x2F;src&#x2F;.libs&#x2F;libstdc++.so.6</span><br><span class=\"line\">&#x2F;usr&#x2F;local&#x2F;src&#x2F;gcc-9.2.0&#x2F;prev-x86_64-pc-linux-gnu&#x2F;libstdc++-v3&#x2F;src&#x2F;.libs&#x2F;libstdc++.so</span><br><span class=\"line\">&#x2F;usr&#x2F;local&#x2F;src&#x2F;gcc-9.2.0&#x2F;x86_64-pc-linux-gnu&#x2F;libstdc++-v3&#x2F;src&#x2F;.libs&#x2F;libstdc++.so.6.0.24</span><br><span class=\"line\">&#x2F;usr&#x2F;local&#x2F;src&#x2F;gcc-9.2.0&#x2F;x86_64-pc-linux-gnu&#x2F;libstdc++-v3&#x2F;src&#x2F;.libs&#x2F;libstdc++.so.6</span><br><span class=\"line\">&#x2F;usr&#x2F;local&#x2F;src&#x2F;gcc-9.2.0&#x2F;x86_64-pc-linux-gnu&#x2F;libstdc++-v3&#x2F;src&#x2F;.libs&#x2F;libstdc++.so</span><br><span class=\"line\"></span><br><span class=\"line\">cd &#x2F;usr&#x2F;lib64</span><br><span class=\"line\">cp &#x2F;usr&#x2F;local&#x2F;src&#x2F;gcc-9.2.0&#x2F;stage1-x86_64-pc-linux-gnu&#x2F;libstdc++-v3&#x2F;src&#x2F;.libs&#x2F;libstdc++.so.6.0.27 .</span><br><span class=\"line\">mv libstdc++.so.6 libstdc++.so.6.old</span><br><span class=\"line\">ln -sv libstdc++.so.6.0.27 libstdc++.so.6</span><br><span class=\"line\">&quot;libstdc++.so.6&quot; -&gt; &quot;libstdc++.so.6.0.27&quot;</span><br></pre></td></tr></table></figure>\n\n\n\n<p>重启系统</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">reboot</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">gcc -v</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"cmake-安装\"><a href=\"#cmake-安装\" class=\"headerlink\" title=\"cmake 安装\"></a>cmake 安装</h2><h3 id=\"获取\"><a href=\"#获取\" class=\"headerlink\" title=\"获取\"></a>获取</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">https:&#x2F;&#x2F;cmake.org&#x2F;download&#x2F;</span><br><span class=\"line\"></span><br><span class=\"line\">wget https:&#x2F;&#x2F;github.com&#x2F;Kitware&#x2F;CMake&#x2F;releases&#x2F;download&#x2F;v3.20.0&#x2F;cmake-3.20.0.tar.gz</span><br></pre></td></tr></table></figure>\n\n\n<h3 id=\"编译\"><a href=\"#编译\" class=\"headerlink\" title=\"编译\"></a>编译</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd &#x2F;usr&#x2F;local&#x2F;src</span><br><span class=\"line\">tar xf cmake-3.20.0.tar.gz</span><br><span class=\"line\">cd cmake-3.20.0</span><br><span class=\"line\">.&#x2F;configure --prefix&#x3D;&#x2F;usr&#x2F;local&#x2F;cmake</span><br><span class=\"line\">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"软连接\"><a href=\"#软连接\" class=\"headerlink\" title=\"软连接\"></a>软连接</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ln -s &#x2F;usr&#x2F;local&#x2F;cmake&#x2F;bin&#x2F;cmake &#x2F;usr&#x2F;bin&#x2F;cmake</span><br></pre></td></tr></table></figure>\n<h3 id=\"验证\"><a href=\"#验证\" class=\"headerlink\" title=\"验证\"></a>验证</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cmake -version</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cmake version 3.20.0</span><br><span class=\"line\"></span><br><span class=\"line\">CMake suite maintained and supported by Kitware (kitware.com&#x2F;cmake).</span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"","more":"<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">gcc -v</span><br><span class=\"line\"></span><br><span class=\"line\">使用内建 specs。</span><br><span class=\"line\">COLLECT_GCC&#x3D;gcc</span><br><span class=\"line\">COLLECT_LTO_WRAPPER&#x3D;&#x2F;usr&#x2F;libexec&#x2F;gcc&#x2F;x86_64-redhat-linux&#x2F;4.8.5&#x2F;lto-wrapper</span><br><span class=\"line\">目标：x86_64-redhat-linux</span><br><span class=\"line\">配置为：..&#x2F;configure --prefix&#x3D;&#x2F;usr --mandir&#x3D;&#x2F;usr&#x2F;share&#x2F;man --infodir&#x3D;&#x2F;usr&#x2F;share&#x2F;info --with-bugurl&#x3D;http:&#x2F;&#x2F;bugzilla.redhat.com&#x2F;bugzilla --enable-bootstrap --enable-shared --enable-threads&#x3D;posix --enable-checking&#x3D;release --with-system-zlib --enable-__cxa_atexit --disable-libunwind-exceptions --enable-gnu-unique-object --enable-linker-build-id --with-linker-hash-style&#x3D;gnu --enable-languages&#x3D;c,c++,objc,obj-c++,java,fortran,ada,go,lto --enable-plugin --enable-initfini-array --disable-libgcj --with-isl&#x3D;&#x2F;builddir&#x2F;build&#x2F;BUILD&#x2F;gcc-4.8.5-20150702&#x2F;obj-x86_64-redhat-linux&#x2F;isl-install --with-cloog&#x3D;&#x2F;builddir&#x2F;build&#x2F;BUILD&#x2F;gcc-4.8.5-20150702&#x2F;obj-x86_64-redhat-linux&#x2F;cloog-install --enable-gnu-indirect-function --with-tune&#x3D;generic --with-arch_32&#x3D;x86-64 --build&#x3D;x86_64-redhat-linux</span><br><span class=\"line\">线程模型：posix</span><br><span class=\"line\">gcc 版本 4.8.5 20150623 (Red Hat 4.8.5-39) (GCC)</span><br></pre></td></tr></table></figure>\n\n<p><strong>安装\\</strong>RHEL/C**entos**7**默认的开发工具，包含gcc，g++,make等等一系列工具**</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum groupinstall &quot;Development Tools&quot;</span><br></pre></td></tr></table></figure>\n\n<p><strong>查看默认动态库：</strong> </p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">strings &#x2F;usr&#x2F;lib64&#x2F;libstdc++.so.6 | grep GLIBC</span><br><span class=\"line\"></span><br><span class=\"line\">GLIBCXX_3.4</span><br><span class=\"line\">GLIBCXX_3.4.1</span><br><span class=\"line\">GLIBCXX_3.4.2</span><br><span class=\"line\">GLIBCXX_3.4.3</span><br><span class=\"line\">GLIBCXX_3.4.4</span><br><span class=\"line\">GLIBCXX_3.4.5</span><br><span class=\"line\">GLIBCXX_3.4.6</span><br><span class=\"line\">GLIBCXX_3.4.7</span><br><span class=\"line\">GLIBCXX_3.4.8</span><br><span class=\"line\">GLIBCXX_3.4.9</span><br><span class=\"line\">GLIBCXX_3.4.10</span><br><span class=\"line\">GLIBCXX_3.4.11</span><br><span class=\"line\">GLIBCXX_3.4.12</span><br><span class=\"line\">GLIBCXX_3.4.13</span><br><span class=\"line\">GLIBCXX_3.4.14</span><br><span class=\"line\">GLIBCXX_3.4.15</span><br><span class=\"line\">GLIBCXX_3.4.16</span><br><span class=\"line\">GLIBCXX_3.4.17</span><br><span class=\"line\">GLIBCXX_3.4.18</span><br><span class=\"line\">GLIBCXX_3.4.19</span><br><span class=\"line\">GLIBC_2.3</span><br><span class=\"line\">GLIBC_2.2.5</span><br><span class=\"line\">GLIBC_2.14</span><br><span class=\"line\">GLIBC_2.4</span><br><span class=\"line\">GLIBC_2.3.2</span><br><span class=\"line\">GLIBCXX_DEBUG_MESSAGE_LENGTH</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p><strong>获取安装包并解压：</strong></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">http:&#x2F;&#x2F;ftp.gnu.org&#x2F;gnu&#x2F;gcc&#x2F;</span><br></pre></td></tr></table></figure>\n\n<p><strong>安装gcc的依赖软件，gcc的软件包内提供了自动下载需要软件的脚本\\</strong>./contrib/download_prerequisites****   这个过程会持续很久，根据网络情况</p>\n<p>网络差可以将离线包放在gcc-9.3.0目录下即可 </p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">.&#x2F;contrib&#x2F;download_prerequisites</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">2020-05-15 10:48:52 URL: ftp:&#x2F;&#x2F;gcc.gnu.org&#x2F;pub&#x2F;gcc&#x2F;infrastructure&#x2F;gmp-6.1.0.tar.bz2 [2383840] -&gt; &quot;.&#x2F;gmp-6.1.0.tar.bz2&quot; [1]</span><br><span class=\"line\">2020-05-15 10:50:14 URL: ftp:&#x2F;&#x2F;gcc.gnu.org&#x2F;pub&#x2F;gcc&#x2F;infrastructure&#x2F;mpfr-3.1.4.tar.bz2 [1279284] -&gt; &quot;.&#x2F;mpfr-3.1.4.tar.bz2&quot; [1]</span><br><span class=\"line\">2020-05-15 10:50:52 URL: ftp:&#x2F;&#x2F;gcc.gnu.org&#x2F;pub&#x2F;gcc&#x2F;infrastructure&#x2F;mpc-1.0.3.tar.gz [669925] -&gt; &quot;.&#x2F;mpc-1.0.3.tar.gz&quot; [1]</span><br><span class=\"line\">2020-05-15 10:53:09 URL: ftp:&#x2F;&#x2F;gcc.gnu.org&#x2F;pub&#x2F;gcc&#x2F;infrastructure&#x2F;isl-0.18.tar.bz2 [1658291] -&gt; &quot;.&#x2F;isl-0.18.tar.bz2&quot; [1]</span><br><span class=\"line\">gmp-6.1.0.tar.bz2: 确定</span><br><span class=\"line\">mpfr-3.1.4.tar.bz2: 确定</span><br><span class=\"line\">mpc-1.0.3.tar.gz: 确定</span><br><span class=\"line\">isl-0.18.tar.bz2: 确定</span><br><span class=\"line\">All prerequisites downloaded successfully.</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n<p><strong>生成Makefile文件</strong></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">.&#x2F;configure --prefix&#x3D;&#x2F;usr&#x2F;local -enable-checking&#x3D;release -enable-languages&#x3D;c,c++ -disable-multilib</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p><strong>编译gcc</strong></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">make -j4    #多核电脑可以添加 “-j4” ：make对多核处理器的优化选项，此步骤非常耗时</span><br><span class=\"line\"></span><br><span class=\"line\">ls &#x2F;usr&#x2F;local&#x2F;bin | grep gcc</span><br></pre></td></tr></table></figure>\n\n<p><strong>安装gcc</strong></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">make install</span><br></pre></td></tr></table></figure>\n\n<p><strong>配置gcc</strong></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd ~</span><br><span class=\"line\">find &#x2F;usr&#x2F;local&#x2F;src&#x2F;gcc-9.2.0&#x2F; -name &quot;libstdc++.so*&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">&#x2F;usr&#x2F;local&#x2F;src&#x2F;gcc-9.2.0&#x2F;stage1-x86_64-pc-linux-gnu&#x2F;libstdc++-v3&#x2F;src&#x2F;.libs&#x2F;libstdc++.so.6.0.24</span><br><span class=\"line\">&#x2F;usr&#x2F;local&#x2F;src&#x2F;gcc-9.2.0&#x2F;stage1-x86_64-pc-linux-gnu&#x2F;libstdc++-v3&#x2F;src&#x2F;.libs&#x2F;libstdc++.so.6</span><br><span class=\"line\">&#x2F;usr&#x2F;local&#x2F;src&#x2F;gcc-9.2.0&#x2F;stage1-x86_64-pc-linux-gnu&#x2F;libstdc++-v3&#x2F;src&#x2F;.libs&#x2F;libstdc++.so</span><br><span class=\"line\">&#x2F;usr&#x2F;local&#x2F;src&#x2F;gcc-9.2.0&#x2F;prev-x86_64-pc-linux-gnu&#x2F;libstdc++-v3&#x2F;src&#x2F;.libs&#x2F;libstdc++.so.6.0.24</span><br><span class=\"line\">&#x2F;usr&#x2F;local&#x2F;src&#x2F;gcc-9.2.0&#x2F;prev-x86_64-pc-linux-gnu&#x2F;libstdc++-v3&#x2F;src&#x2F;.libs&#x2F;libstdc++.so.6</span><br><span class=\"line\">&#x2F;usr&#x2F;local&#x2F;src&#x2F;gcc-9.2.0&#x2F;prev-x86_64-pc-linux-gnu&#x2F;libstdc++-v3&#x2F;src&#x2F;.libs&#x2F;libstdc++.so</span><br><span class=\"line\">&#x2F;usr&#x2F;local&#x2F;src&#x2F;gcc-9.2.0&#x2F;x86_64-pc-linux-gnu&#x2F;libstdc++-v3&#x2F;src&#x2F;.libs&#x2F;libstdc++.so.6.0.24</span><br><span class=\"line\">&#x2F;usr&#x2F;local&#x2F;src&#x2F;gcc-9.2.0&#x2F;x86_64-pc-linux-gnu&#x2F;libstdc++-v3&#x2F;src&#x2F;.libs&#x2F;libstdc++.so.6</span><br><span class=\"line\">&#x2F;usr&#x2F;local&#x2F;src&#x2F;gcc-9.2.0&#x2F;x86_64-pc-linux-gnu&#x2F;libstdc++-v3&#x2F;src&#x2F;.libs&#x2F;libstdc++.so</span><br><span class=\"line\"></span><br><span class=\"line\">cd &#x2F;usr&#x2F;lib64</span><br><span class=\"line\">cp &#x2F;usr&#x2F;local&#x2F;src&#x2F;gcc-9.2.0&#x2F;stage1-x86_64-pc-linux-gnu&#x2F;libstdc++-v3&#x2F;src&#x2F;.libs&#x2F;libstdc++.so.6.0.27 .</span><br><span class=\"line\">mv libstdc++.so.6 libstdc++.so.6.old</span><br><span class=\"line\">ln -sv libstdc++.so.6.0.27 libstdc++.so.6</span><br><span class=\"line\">&quot;libstdc++.so.6&quot; -&gt; &quot;libstdc++.so.6.0.27&quot;</span><br></pre></td></tr></table></figure>\n\n\n\n<p>重启系统</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">reboot</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">gcc -v</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"cmake-安装\"><a href=\"#cmake-安装\" class=\"headerlink\" title=\"cmake 安装\"></a>cmake 安装</h2><h3 id=\"获取\"><a href=\"#获取\" class=\"headerlink\" title=\"获取\"></a>获取</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">https:&#x2F;&#x2F;cmake.org&#x2F;download&#x2F;</span><br><span class=\"line\"></span><br><span class=\"line\">wget https:&#x2F;&#x2F;github.com&#x2F;Kitware&#x2F;CMake&#x2F;releases&#x2F;download&#x2F;v3.20.0&#x2F;cmake-3.20.0.tar.gz</span><br></pre></td></tr></table></figure>\n\n\n<h3 id=\"编译\"><a href=\"#编译\" class=\"headerlink\" title=\"编译\"></a>编译</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd &#x2F;usr&#x2F;local&#x2F;src</span><br><span class=\"line\">tar xf cmake-3.20.0.tar.gz</span><br><span class=\"line\">cd cmake-3.20.0</span><br><span class=\"line\">.&#x2F;configure --prefix&#x3D;&#x2F;usr&#x2F;local&#x2F;cmake</span><br><span class=\"line\">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"软连接\"><a href=\"#软连接\" class=\"headerlink\" title=\"软连接\"></a>软连接</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ln -s &#x2F;usr&#x2F;local&#x2F;cmake&#x2F;bin&#x2F;cmake &#x2F;usr&#x2F;bin&#x2F;cmake</span><br></pre></td></tr></table></figure>\n<h3 id=\"验证\"><a href=\"#验证\" class=\"headerlink\" title=\"验证\"></a>验证</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cmake -version</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cmake version 3.20.0</span><br><span class=\"line\"></span><br><span class=\"line\">CMake suite maintained and supported by Kitware (kitware.com&#x2F;cmake).</span><br></pre></td></tr></table></figure>"},{"title":"hadoop 安装","date":"2019-12-13T06:00:00.000Z","_content":"\n##hadoop 安装\n\n官方文档`http://hadoop.apache.org/docs/current/`\n\n```\n我们建议您下载以下镜像站点：\n\nhttp://mirrors.tuna.tsinghua.edu.cn/apache/hadoop/common/hadoop-3.0.1/hadoop-3.0.1.tar.gz\n\n其他镜像站点如下所示。\nhttp://mirrors.hust.edu.cn/apache/hadoop/common/hadoop-3.0.1/hadoop-3.0.1.tar.gz \n\nhttp://mirrors.shu.edu.cn/apache/hadoop/common/hadoop-3.0.1/hadoop-3.0.1.tar.gz \n\nhttp://mirrors.tuna.tsinghua.edu.cn/apache/hadoop/common/hadoop-3.0.1/hadoop-3.0.1.tar.gz \n\n```\n\n### 下载\n\n```\n下载地址：https://archive.apache.org/dist/hadoop/common/hadoop-3.0.0-alpha4/  这里找\n\n我们建议您下载以下镜像站点：\nhttp://mirrors.tuna.tsinghua.edu.cn/apache/hadoop/common/hadoop-3.0.1/hadoop-3.0.1.tar.gz\n其他镜像站点如下所示。\nhttp://mirrors.hust.edu.cn/apache/hadoop/common/hadoop-3.0.1/hadoop-3.0.1.tar.gz \nhttp://mirrors.shu.edu.cn/apache/hadoop/common/hadoop-3.0.1/hadoop-3.0.1.tar.gz \nhttp://mirrors.tuna.tsinghua.edu.cn/apache/hadoop/common/hadoop-3.0.1/hadoop-3.0.1.tar.gz \n```\n\n### 关闭防火墙和色linux\n\n```\n\n```\n\n\n\n###环境要求\n\n安装jdk,并且Java版本不低于Hadoop要求，并配置环境变量\n\n### 修改hosts\n\n```\n192.168.1.12 node1\n192.168.1.12 node2\n192.168.1.12 node3\n```\n\n创建ssh 秘钥，并发送到其他节点\n\n```\nssh-keygen -t rsa\nssh-copy-id node1\n```\n\n### 创建目录\n\n在/usr/hadoop/目录下，建立tmp、hdfs/name、hdfs/data目录，执行如下命令 \n\n```\nmkdir -p /mnt/hadoop/{tmp,hdfs/{data,name}}\n```\n\n\n\n###安装\n\n在网站hadoop.apache.org下载稳定版本的Hadoop包\n\n解压压缩包\n\n```\ntar xf hadoop-3.0.1.tar.gz\nmv hadoop-3.0.1 /usr/local/hadoop\n```\n\n### 添加hadoop环境变量\n\n```\n设置环境变量，  vim /etc/profile \n\n# set hadoop path\nexport HADOOP_HOME=/usr/local/hadoop/\nexport PATH=$PATH:$HADOOP_HOME/bin\n```\n\n###检查Hadoop是否可用\n\n```\nhadoop version\n\nHadoop 3.0.1\nSource code repository Unknown -r 496dc57cc2e4f4da117f7a8e3840aaeac0c1d2d0\nCompiled by lei on 2018-03-16T23:00Z\nCompiled with protoc 2.5.0\nFrom source with checksum 504d49cc3bcf4e2b56e2fd44ced8572\nThis command was run using /root/hadoop-3.0.1/share/hadoop/common/hadoop-common-3.0.1.jar\n```\n\n### 修改配置文件\n\n##### 配置hadoop-env.sh\n\n`vim /usr/local/hadoop/etc/hadoop/hadoop-env.sh `  hadoop配置环境\n\n```\n#第27行\nexport JAVA_HOME=/usr/local/java\n```\n\n##### 配置yarn-env.sh\n\n`vim /usr/local/hadoop/etc/hadoop/yarn-env.sh`\n\n```\nexport JAVA_HOME=/usr/local/java\n```\n\nHadoop配置以.xml文件形式存在\n\n##### 配置core-site.xml  \n\n`/usr/local/hadoop/etc/hadoop/core-site.xml`   hadoop 核心配置文件\n\n`http://hadoop.apache.org/docs/current/hadoop-project-dist/hadoop-common/core-default.xml`\n\n```\n<configuration>\n        <property>\n        <!-- 指定hadoop运行时产生文件的存储目录 -->\n                <name>hadoop.tmp.dir</name>\n                <value>/mnt/hadoop/tmp</value>\n        </property>\n        <property>\n        <!-- 指定HADOOP所使用的文件系统schema（URI），HDFS的老大（NameNode）的地址 -->\n                <name>fs.default.name</name>\n                <value>hdfs://node1:9000</value>\n        </property>\n</configuration>\n```\n\n##### 配置hdfs-site.xml\n\n `/usr/local/hadoop/etc/hadoop/hdfs-site.xml`   hdfs服务的 –> 会起进程\n\n`http://hadoop.apache.org/docs/current/hadoop-project-dist/hadoop-hdfs/hdfs-default.xml`\n\n```\n<configuration>\n        <property>\n        <!-- datanode上数据块的物理存储位置 -->\n                <name>dfs.datanode.data.dir</name>\n                <value>/mnt/hadoop/hdfs/data</value>\n        </property>\n        <property>\n        <!-- namenode上存储hdfs名字空间元数据  -->\n                <name>dfs.namenode.name.dir</name>\n                <value>/mnt/hadoop/hdfs/name</value>\n        </property>\n        <property>\n        <!-- hdfs web 管理界面 -->\n                <name>dfs.http.address</name>\n                <value>0.0.0.0:8100</value>\n        </property>\n        <property>\n        <!-- 副本个数，配置默认是3,应小于datanode机器数量 -->\n                <name>dfs.replication</name>\n                <value>1</value>\n        </property>\n</configuration>\n```\n\n##### 配置mapred-site.xml\n\n（注：若没有mapred-site.xml，则需要将mapred-site.xml.template改为mapred-site.xml，并设置hadoop为属主属组）\n\n`/usr/local/hadoop/etc/hadoop/mapred-site.xml`   mapred计算所需要的配置文件] 只当在jar计算时才有\n\n`http://hadoop.apache.org/docs/current/hadoop-mapreduce-client/hadoop-mapreduce-client-core/mapred-default.xml`\n\n```\n<configuration>  \n<property>  \n        <name>mapreduce.framework.name</name>  \n        <value>yarn</value>  \n</property>  \n<property>\n  <name>mapred.job.tracker.http.address</name>\n  <value>0.0.0.0:50030</value>\n</property>\n<property>\n  <name>mapred.task.tracker.http.address</name>\n  <value>0.0.0.0:50060</value>\n</property>\n</configuration> \n```\n\n##### 配置yarn-site.xml\n\n`/usr/local/hadoop/etc/hadoop/yarn-site.xml`  yarn服务的 –> 会起进程\n\n`http://hadoop.apache.org/docs/current/hadoop-yarn/hadoop-yarn-common/yarn-default.xml`\n\n```\n<configuration>  \n<property>  \n        <name>yarn.nodemanager.aux-services</name>  \n        <value>mapreduce_shuffle</value>  \n</property>  \n<property>  \n        <name>yarn.resourcemanager.webapp.address</name>  \n        <value>192.168.1.12:8099</value>  \n        <description>这个地址是mr管理界面的</description>  \n</property>  \n</configuration>  \n```\n\n### 格式化namenode\n\n```\nhdfs namenode -format\n\n成功的话，会看到 \"successfully formatted\" 和 \"Exitting with status 0\" 的提示，若为 \"Exitting with status 1\" 则是出错\n```\n\n### 启动\n\n启动NameNode 和 DataNode 守护进程及secondary namenodes\n\n```\nsbin/start-dfs.sh\n```\n\n启动ResourceManager 和 NodeManager 守护进程\n\n```\nsbin/start-yarn.sh\n```\n\n\n\n```\n#! /bin/sh    \nrm -rf  /mnt/hadoop/hdfs/data/*  \nrm -rf  /mnt/hadoop/hdfs/name/*  \n#启动NameNode 和 DataNode 守护进程及secondary namenodes  \nsh /usr/local/hadoop/sbin/start-dfs.sh  \n#启动ResourceManager 和 NodeManager 守护进程  \nsh /usr/local/hadoop/sbin/sbin/start-yarn.sh \n```\n\n\n\n\n\n###HDFS的使用\n\nHDFS的命令执行格式：hadoop fs -cmd，其中cmd是类shell的命令\n\n```\nhadoop fs -ls /                //查看hdfs根目录的文件树\nhadoop fs -mkdir /test         //创建test文件夹\nhadoop fs -cp 文件 文件        //拷贝文件\nhadoop fs -help <cmd>          //#查看帮助\nhadoop fs -cat <hdfs上的路径>    //查看文件内容\nhadoop fs -put <linux上文件> <hdfs上的路径>   //上传\nhadoop fs -get <hdfs上的路径> <linux上文件>   //下载文件\n\n//上传文件到hdfs文件系统上\n例如： hadoop fs -put /root/install.log hdfs://localhost:9000/\n//删除hdfs系统文件  \n例如： hadoop fs -rm hdfs://localhost:9000/install.log  \n```\n\n### 测试yarn\n\n**上传一个文件到HDFS**\n\n```\nhadoop fs -put  words.txt  hdfs://localhost:9000/\n```\n\n让Yarn来统计一下文件信息\n\n```\ncd  /$HADOOP_HOME/share/hadoop/mapreduce/\n```\n\n测试命令\n\n```\nhadoop jar /usr/hadoop/hadoop-3.0.0/share/hadoop/mapreduce/hadoop-mapreduce-examples-3.0.0.jar wordcount /ha.txt /myorder/  \n```\n\n\n\n### 问题\n\nnamenode格式化的时候遇到JAVA_HOME环境变量问题\n\n```\n解决办法：hadoop/etc/hadoop/hadoop-env.xml文件中有变量的设置，但是不能满足要求，还要修改一下hadoop/libexec/hadoop-config.sh   文件中大概160行，新增：\n\nexport JAVA_HOME=/usr/local/java/\n```\n\ndatanode无法启动\n\n出现该问题的原因：在第一次格式化dfs后，启动并使用了hadoop，后来又重新执行了格式化命令（hdfs namenode -format)，这时namenode的clusterID会重新生成，而datanode的clusterID 保持不变。\n\n```\n解决办法：将hadoop/name/current下的VERSION中的clusterID复制到hadoop/data/current下的VERSION中，覆盖掉原来的clusterID，让两个保持一致然后重启，启动后执行jps，查看进程\n```\n\n##### 启动报错\n\n如果运行脚本报如下错误,\n\nERROR: Attempting to launch hdfs namenode as root\nERROR: but there is no HDFS_NAMENODE_USER defined. Aborting launch.\nStarting datanodes\nERROR: Attempting to launch hdfs datanode as root\nERROR: but there is no HDFS_DATANODE_USER defined. Aborting launch.\nStarting secondary namenodes [localhost.localdomain]\nERROR: Attempting to launch hdfs secondarynamenode as root\nERROR: but there is no HDFS_SECONDARYNAMENODE_USER defined. Aborting launch.\n\n`解决方案`\n\n（缺少用户定义而造成的）因此编辑启动和关闭\n\n```\nvim sbin/start-dfs.sh\nvim sbin/stop-dfs.sh\n```\n\n顶部空白处\n\n```\nHDFS_DATANODE_USER=root\nHADOOP_SECURE_DN_USER=hdfs\nHDFS_NAMENODE_USER=root\nHDFS_SECONDARYNAMENODE_USER=root\n```\n\n\n\n**如果启动时报如下错误，**\n\n**Starting resourcemanagerERROR: Attempting to launch yarn resourcemanager as rootERROR: but there is no YARN_RESOURCEMANAGER_USER defined. Aborting launch.**\n\n\n\n**解决方案**\n\n（也是由于缺少用户定义）\n\n是因为缺少用户定义造成的，所以分别编辑开始和关闭脚本 \n\n```\nvim sbin/start-yarn.sh\nvim sbin/stop-yarn.sh \n```\n\n```\nYARN_RESOURCEMANAGER_USER=root  \nHADOOP_SECURE_DN_USER=yarn  \nYARN_NODEMANAGER_USER=root \n```","source":"_posts/hadoop.md","raw":"---\ntitle: hadoop 安装\ndate: 2019-12-13 14:00:00\ncategories: \n- bigdata\ntags:\n- hadoop\n---\n\n##hadoop 安装\n\n官方文档`http://hadoop.apache.org/docs/current/`\n\n```\n我们建议您下载以下镜像站点：\n\nhttp://mirrors.tuna.tsinghua.edu.cn/apache/hadoop/common/hadoop-3.0.1/hadoop-3.0.1.tar.gz\n\n其他镜像站点如下所示。\nhttp://mirrors.hust.edu.cn/apache/hadoop/common/hadoop-3.0.1/hadoop-3.0.1.tar.gz \n\nhttp://mirrors.shu.edu.cn/apache/hadoop/common/hadoop-3.0.1/hadoop-3.0.1.tar.gz \n\nhttp://mirrors.tuna.tsinghua.edu.cn/apache/hadoop/common/hadoop-3.0.1/hadoop-3.0.1.tar.gz \n\n```\n\n### 下载\n\n```\n下载地址：https://archive.apache.org/dist/hadoop/common/hadoop-3.0.0-alpha4/  这里找\n\n我们建议您下载以下镜像站点：\nhttp://mirrors.tuna.tsinghua.edu.cn/apache/hadoop/common/hadoop-3.0.1/hadoop-3.0.1.tar.gz\n其他镜像站点如下所示。\nhttp://mirrors.hust.edu.cn/apache/hadoop/common/hadoop-3.0.1/hadoop-3.0.1.tar.gz \nhttp://mirrors.shu.edu.cn/apache/hadoop/common/hadoop-3.0.1/hadoop-3.0.1.tar.gz \nhttp://mirrors.tuna.tsinghua.edu.cn/apache/hadoop/common/hadoop-3.0.1/hadoop-3.0.1.tar.gz \n```\n\n### 关闭防火墙和色linux\n\n```\n\n```\n\n\n\n###环境要求\n\n安装jdk,并且Java版本不低于Hadoop要求，并配置环境变量\n\n### 修改hosts\n\n```\n192.168.1.12 node1\n192.168.1.12 node2\n192.168.1.12 node3\n```\n\n创建ssh 秘钥，并发送到其他节点\n\n```\nssh-keygen -t rsa\nssh-copy-id node1\n```\n\n### 创建目录\n\n在/usr/hadoop/目录下，建立tmp、hdfs/name、hdfs/data目录，执行如下命令 \n\n```\nmkdir -p /mnt/hadoop/{tmp,hdfs/{data,name}}\n```\n\n\n\n###安装\n\n在网站hadoop.apache.org下载稳定版本的Hadoop包\n\n解压压缩包\n\n```\ntar xf hadoop-3.0.1.tar.gz\nmv hadoop-3.0.1 /usr/local/hadoop\n```\n\n### 添加hadoop环境变量\n\n```\n设置环境变量，  vim /etc/profile \n\n# set hadoop path\nexport HADOOP_HOME=/usr/local/hadoop/\nexport PATH=$PATH:$HADOOP_HOME/bin\n```\n\n###检查Hadoop是否可用\n\n```\nhadoop version\n\nHadoop 3.0.1\nSource code repository Unknown -r 496dc57cc2e4f4da117f7a8e3840aaeac0c1d2d0\nCompiled by lei on 2018-03-16T23:00Z\nCompiled with protoc 2.5.0\nFrom source with checksum 504d49cc3bcf4e2b56e2fd44ced8572\nThis command was run using /root/hadoop-3.0.1/share/hadoop/common/hadoop-common-3.0.1.jar\n```\n\n### 修改配置文件\n\n##### 配置hadoop-env.sh\n\n`vim /usr/local/hadoop/etc/hadoop/hadoop-env.sh `  hadoop配置环境\n\n```\n#第27行\nexport JAVA_HOME=/usr/local/java\n```\n\n##### 配置yarn-env.sh\n\n`vim /usr/local/hadoop/etc/hadoop/yarn-env.sh`\n\n```\nexport JAVA_HOME=/usr/local/java\n```\n\nHadoop配置以.xml文件形式存在\n\n##### 配置core-site.xml  \n\n`/usr/local/hadoop/etc/hadoop/core-site.xml`   hadoop 核心配置文件\n\n`http://hadoop.apache.org/docs/current/hadoop-project-dist/hadoop-common/core-default.xml`\n\n```\n<configuration>\n        <property>\n        <!-- 指定hadoop运行时产生文件的存储目录 -->\n                <name>hadoop.tmp.dir</name>\n                <value>/mnt/hadoop/tmp</value>\n        </property>\n        <property>\n        <!-- 指定HADOOP所使用的文件系统schema（URI），HDFS的老大（NameNode）的地址 -->\n                <name>fs.default.name</name>\n                <value>hdfs://node1:9000</value>\n        </property>\n</configuration>\n```\n\n##### 配置hdfs-site.xml\n\n `/usr/local/hadoop/etc/hadoop/hdfs-site.xml`   hdfs服务的 –> 会起进程\n\n`http://hadoop.apache.org/docs/current/hadoop-project-dist/hadoop-hdfs/hdfs-default.xml`\n\n```\n<configuration>\n        <property>\n        <!-- datanode上数据块的物理存储位置 -->\n                <name>dfs.datanode.data.dir</name>\n                <value>/mnt/hadoop/hdfs/data</value>\n        </property>\n        <property>\n        <!-- namenode上存储hdfs名字空间元数据  -->\n                <name>dfs.namenode.name.dir</name>\n                <value>/mnt/hadoop/hdfs/name</value>\n        </property>\n        <property>\n        <!-- hdfs web 管理界面 -->\n                <name>dfs.http.address</name>\n                <value>0.0.0.0:8100</value>\n        </property>\n        <property>\n        <!-- 副本个数，配置默认是3,应小于datanode机器数量 -->\n                <name>dfs.replication</name>\n                <value>1</value>\n        </property>\n</configuration>\n```\n\n##### 配置mapred-site.xml\n\n（注：若没有mapred-site.xml，则需要将mapred-site.xml.template改为mapred-site.xml，并设置hadoop为属主属组）\n\n`/usr/local/hadoop/etc/hadoop/mapred-site.xml`   mapred计算所需要的配置文件] 只当在jar计算时才有\n\n`http://hadoop.apache.org/docs/current/hadoop-mapreduce-client/hadoop-mapreduce-client-core/mapred-default.xml`\n\n```\n<configuration>  \n<property>  \n        <name>mapreduce.framework.name</name>  \n        <value>yarn</value>  \n</property>  \n<property>\n  <name>mapred.job.tracker.http.address</name>\n  <value>0.0.0.0:50030</value>\n</property>\n<property>\n  <name>mapred.task.tracker.http.address</name>\n  <value>0.0.0.0:50060</value>\n</property>\n</configuration> \n```\n\n##### 配置yarn-site.xml\n\n`/usr/local/hadoop/etc/hadoop/yarn-site.xml`  yarn服务的 –> 会起进程\n\n`http://hadoop.apache.org/docs/current/hadoop-yarn/hadoop-yarn-common/yarn-default.xml`\n\n```\n<configuration>  \n<property>  \n        <name>yarn.nodemanager.aux-services</name>  \n        <value>mapreduce_shuffle</value>  \n</property>  \n<property>  \n        <name>yarn.resourcemanager.webapp.address</name>  \n        <value>192.168.1.12:8099</value>  \n        <description>这个地址是mr管理界面的</description>  \n</property>  \n</configuration>  \n```\n\n### 格式化namenode\n\n```\nhdfs namenode -format\n\n成功的话，会看到 \"successfully formatted\" 和 \"Exitting with status 0\" 的提示，若为 \"Exitting with status 1\" 则是出错\n```\n\n### 启动\n\n启动NameNode 和 DataNode 守护进程及secondary namenodes\n\n```\nsbin/start-dfs.sh\n```\n\n启动ResourceManager 和 NodeManager 守护进程\n\n```\nsbin/start-yarn.sh\n```\n\n\n\n```\n#! /bin/sh    \nrm -rf  /mnt/hadoop/hdfs/data/*  \nrm -rf  /mnt/hadoop/hdfs/name/*  \n#启动NameNode 和 DataNode 守护进程及secondary namenodes  \nsh /usr/local/hadoop/sbin/start-dfs.sh  \n#启动ResourceManager 和 NodeManager 守护进程  \nsh /usr/local/hadoop/sbin/sbin/start-yarn.sh \n```\n\n\n\n\n\n###HDFS的使用\n\nHDFS的命令执行格式：hadoop fs -cmd，其中cmd是类shell的命令\n\n```\nhadoop fs -ls /                //查看hdfs根目录的文件树\nhadoop fs -mkdir /test         //创建test文件夹\nhadoop fs -cp 文件 文件        //拷贝文件\nhadoop fs -help <cmd>          //#查看帮助\nhadoop fs -cat <hdfs上的路径>    //查看文件内容\nhadoop fs -put <linux上文件> <hdfs上的路径>   //上传\nhadoop fs -get <hdfs上的路径> <linux上文件>   //下载文件\n\n//上传文件到hdfs文件系统上\n例如： hadoop fs -put /root/install.log hdfs://localhost:9000/\n//删除hdfs系统文件  \n例如： hadoop fs -rm hdfs://localhost:9000/install.log  \n```\n\n### 测试yarn\n\n**上传一个文件到HDFS**\n\n```\nhadoop fs -put  words.txt  hdfs://localhost:9000/\n```\n\n让Yarn来统计一下文件信息\n\n```\ncd  /$HADOOP_HOME/share/hadoop/mapreduce/\n```\n\n测试命令\n\n```\nhadoop jar /usr/hadoop/hadoop-3.0.0/share/hadoop/mapreduce/hadoop-mapreduce-examples-3.0.0.jar wordcount /ha.txt /myorder/  \n```\n\n\n\n### 问题\n\nnamenode格式化的时候遇到JAVA_HOME环境变量问题\n\n```\n解决办法：hadoop/etc/hadoop/hadoop-env.xml文件中有变量的设置，但是不能满足要求，还要修改一下hadoop/libexec/hadoop-config.sh   文件中大概160行，新增：\n\nexport JAVA_HOME=/usr/local/java/\n```\n\ndatanode无法启动\n\n出现该问题的原因：在第一次格式化dfs后，启动并使用了hadoop，后来又重新执行了格式化命令（hdfs namenode -format)，这时namenode的clusterID会重新生成，而datanode的clusterID 保持不变。\n\n```\n解决办法：将hadoop/name/current下的VERSION中的clusterID复制到hadoop/data/current下的VERSION中，覆盖掉原来的clusterID，让两个保持一致然后重启，启动后执行jps，查看进程\n```\n\n##### 启动报错\n\n如果运行脚本报如下错误,\n\nERROR: Attempting to launch hdfs namenode as root\nERROR: but there is no HDFS_NAMENODE_USER defined. Aborting launch.\nStarting datanodes\nERROR: Attempting to launch hdfs datanode as root\nERROR: but there is no HDFS_DATANODE_USER defined. Aborting launch.\nStarting secondary namenodes [localhost.localdomain]\nERROR: Attempting to launch hdfs secondarynamenode as root\nERROR: but there is no HDFS_SECONDARYNAMENODE_USER defined. Aborting launch.\n\n`解决方案`\n\n（缺少用户定义而造成的）因此编辑启动和关闭\n\n```\nvim sbin/start-dfs.sh\nvim sbin/stop-dfs.sh\n```\n\n顶部空白处\n\n```\nHDFS_DATANODE_USER=root\nHADOOP_SECURE_DN_USER=hdfs\nHDFS_NAMENODE_USER=root\nHDFS_SECONDARYNAMENODE_USER=root\n```\n\n\n\n**如果启动时报如下错误，**\n\n**Starting resourcemanagerERROR: Attempting to launch yarn resourcemanager as rootERROR: but there is no YARN_RESOURCEMANAGER_USER defined. Aborting launch.**\n\n\n\n**解决方案**\n\n（也是由于缺少用户定义）\n\n是因为缺少用户定义造成的，所以分别编辑开始和关闭脚本 \n\n```\nvim sbin/start-yarn.sh\nvim sbin/stop-yarn.sh \n```\n\n```\nYARN_RESOURCEMANAGER_USER=root  \nHADOOP_SECURE_DN_USER=yarn  \nYARN_NODEMANAGER_USER=root \n```","slug":"hadoop","published":1,"updated":"2021-06-18T08:07:11.188Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cku6979xo000f00uhdgz3hpn8","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><p>##hadoop 安装</p>\n<p>官方文档<code>http://hadoop.apache.org/docs/current/</code></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">我们建议您下载以下镜像站点：</span><br><span class=\"line\"></span><br><span class=\"line\">http:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;apache&#x2F;hadoop&#x2F;common&#x2F;hadoop-3.0.1&#x2F;hadoop-3.0.1.tar.gz</span><br><span class=\"line\"></span><br><span class=\"line\">其他镜像站点如下所示。</span><br><span class=\"line\">http:&#x2F;&#x2F;mirrors.hust.edu.cn&#x2F;apache&#x2F;hadoop&#x2F;common&#x2F;hadoop-3.0.1&#x2F;hadoop-3.0.1.tar.gz </span><br><span class=\"line\"></span><br><span class=\"line\">http:&#x2F;&#x2F;mirrors.shu.edu.cn&#x2F;apache&#x2F;hadoop&#x2F;common&#x2F;hadoop-3.0.1&#x2F;hadoop-3.0.1.tar.gz </span><br><span class=\"line\"></span><br><span class=\"line\">http:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;apache&#x2F;hadoop&#x2F;common&#x2F;hadoop-3.0.1&#x2F;hadoop-3.0.1.tar.gz </span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"下载\"><a href=\"#下载\" class=\"headerlink\" title=\"下载\"></a>下载</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">下载地址：https:&#x2F;&#x2F;archive.apache.org&#x2F;dist&#x2F;hadoop&#x2F;common&#x2F;hadoop-3.0.0-alpha4&#x2F;  这里找</span><br><span class=\"line\"></span><br><span class=\"line\">我们建议您下载以下镜像站点：</span><br><span class=\"line\">http:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;apache&#x2F;hadoop&#x2F;common&#x2F;hadoop-3.0.1&#x2F;hadoop-3.0.1.tar.gz</span><br><span class=\"line\">其他镜像站点如下所示。</span><br><span class=\"line\">http:&#x2F;&#x2F;mirrors.hust.edu.cn&#x2F;apache&#x2F;hadoop&#x2F;common&#x2F;hadoop-3.0.1&#x2F;hadoop-3.0.1.tar.gz </span><br><span class=\"line\">http:&#x2F;&#x2F;mirrors.shu.edu.cn&#x2F;apache&#x2F;hadoop&#x2F;common&#x2F;hadoop-3.0.1&#x2F;hadoop-3.0.1.tar.gz </span><br><span class=\"line\">http:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;apache&#x2F;hadoop&#x2F;common&#x2F;hadoop-3.0.1&#x2F;hadoop-3.0.1.tar.gz </span><br></pre></td></tr></table></figure>\n\n<h3 id=\"关闭防火墙和色linux\"><a href=\"#关闭防火墙和色linux\" class=\"headerlink\" title=\"关闭防火墙和色linux\"></a>关闭防火墙和色linux</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<p>###环境要求</p>\n<p>安装jdk,并且Java版本不低于Hadoop要求，并配置环境变量</p>\n<h3 id=\"修改hosts\"><a href=\"#修改hosts\" class=\"headerlink\" title=\"修改hosts\"></a>修改hosts</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">192.168.1.12 node1</span><br><span class=\"line\">192.168.1.12 node2</span><br><span class=\"line\">192.168.1.12 node3</span><br></pre></td></tr></table></figure>\n\n<p>创建ssh 秘钥，并发送到其他节点</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ssh-keygen -t rsa</span><br><span class=\"line\">ssh-copy-id node1</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"创建目录\"><a href=\"#创建目录\" class=\"headerlink\" title=\"创建目录\"></a>创建目录</h3><p>在/usr/hadoop/目录下，建立tmp、hdfs/name、hdfs/data目录，执行如下命令 </p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir -p &#x2F;mnt&#x2F;hadoop&#x2F;&#123;tmp,hdfs&#x2F;&#123;data,name&#125;&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<p>###安装</p>\n<p>在网站hadoop.apache.org下载稳定版本的Hadoop包</p>\n<p>解压压缩包</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tar xf hadoop-3.0.1.tar.gz</span><br><span class=\"line\">mv hadoop-3.0.1 &#x2F;usr&#x2F;local&#x2F;hadoop</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"添加hadoop环境变量\"><a href=\"#添加hadoop环境变量\" class=\"headerlink\" title=\"添加hadoop环境变量\"></a>添加hadoop环境变量</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">设置环境变量，  vim &#x2F;etc&#x2F;profile </span><br><span class=\"line\"></span><br><span class=\"line\"># set hadoop path</span><br><span class=\"line\">export HADOOP_HOME&#x3D;&#x2F;usr&#x2F;local&#x2F;hadoop&#x2F;</span><br><span class=\"line\">export PATH&#x3D;$PATH:$HADOOP_HOME&#x2F;bin</span><br></pre></td></tr></table></figure>\n\n<p>###检查Hadoop是否可用</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hadoop version</span><br><span class=\"line\"></span><br><span class=\"line\">Hadoop 3.0.1</span><br><span class=\"line\">Source code repository Unknown -r 496dc57cc2e4f4da117f7a8e3840aaeac0c1d2d0</span><br><span class=\"line\">Compiled by lei on 2018-03-16T23:00Z</span><br><span class=\"line\">Compiled with protoc 2.5.0</span><br><span class=\"line\">From source with checksum 504d49cc3bcf4e2b56e2fd44ced8572</span><br><span class=\"line\">This command was run using &#x2F;root&#x2F;hadoop-3.0.1&#x2F;share&#x2F;hadoop&#x2F;common&#x2F;hadoop-common-3.0.1.jar</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"修改配置文件\"><a href=\"#修改配置文件\" class=\"headerlink\" title=\"修改配置文件\"></a>修改配置文件</h3><h5 id=\"配置hadoop-env-sh\"><a href=\"#配置hadoop-env-sh\" class=\"headerlink\" title=\"配置hadoop-env.sh\"></a>配置hadoop-env.sh</h5><p><code>vim /usr/local/hadoop/etc/hadoop/hadoop-env.sh </code>  hadoop配置环境</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#第27行</span><br><span class=\"line\">export JAVA_HOME&#x3D;&#x2F;usr&#x2F;local&#x2F;java</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"配置yarn-env-sh\"><a href=\"#配置yarn-env-sh\" class=\"headerlink\" title=\"配置yarn-env.sh\"></a>配置yarn-env.sh</h5><p><code>vim /usr/local/hadoop/etc/hadoop/yarn-env.sh</code></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">export JAVA_HOME&#x3D;&#x2F;usr&#x2F;local&#x2F;java</span><br></pre></td></tr></table></figure>\n\n<p>Hadoop配置以.xml文件形式存在</p>\n<h5 id=\"配置core-site-xml\"><a href=\"#配置core-site-xml\" class=\"headerlink\" title=\"配置core-site.xml\"></a>配置core-site.xml</h5><p><code>/usr/local/hadoop/etc/hadoop/core-site.xml</code>   hadoop 核心配置文件</p>\n<p><code>http://hadoop.apache.org/docs/current/hadoop-project-dist/hadoop-common/core-default.xml</code></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;configuration&gt;</span><br><span class=\"line\">        &lt;property&gt;</span><br><span class=\"line\">        &lt;!-- 指定hadoop运行时产生文件的存储目录 --&gt;</span><br><span class=\"line\">                &lt;name&gt;hadoop.tmp.dir&lt;&#x2F;name&gt;</span><br><span class=\"line\">                &lt;value&gt;&#x2F;mnt&#x2F;hadoop&#x2F;tmp&lt;&#x2F;value&gt;</span><br><span class=\"line\">        &lt;&#x2F;property&gt;</span><br><span class=\"line\">        &lt;property&gt;</span><br><span class=\"line\">        &lt;!-- 指定HADOOP所使用的文件系统schema（URI），HDFS的老大（NameNode）的地址 --&gt;</span><br><span class=\"line\">                &lt;name&gt;fs.default.name&lt;&#x2F;name&gt;</span><br><span class=\"line\">                &lt;value&gt;hdfs:&#x2F;&#x2F;node1:9000&lt;&#x2F;value&gt;</span><br><span class=\"line\">        &lt;&#x2F;property&gt;</span><br><span class=\"line\">&lt;&#x2F;configuration&gt;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"配置hdfs-site-xml\"><a href=\"#配置hdfs-site-xml\" class=\"headerlink\" title=\"配置hdfs-site.xml\"></a>配置hdfs-site.xml</h5><p> <code>/usr/local/hadoop/etc/hadoop/hdfs-site.xml</code>   hdfs服务的 –&gt; 会起进程</p>\n<p><code>http://hadoop.apache.org/docs/current/hadoop-project-dist/hadoop-hdfs/hdfs-default.xml</code></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;configuration&gt;</span><br><span class=\"line\">        &lt;property&gt;</span><br><span class=\"line\">        &lt;!-- datanode上数据块的物理存储位置 --&gt;</span><br><span class=\"line\">                &lt;name&gt;dfs.datanode.data.dir&lt;&#x2F;name&gt;</span><br><span class=\"line\">                &lt;value&gt;&#x2F;mnt&#x2F;hadoop&#x2F;hdfs&#x2F;data&lt;&#x2F;value&gt;</span><br><span class=\"line\">        &lt;&#x2F;property&gt;</span><br><span class=\"line\">        &lt;property&gt;</span><br><span class=\"line\">        &lt;!-- namenode上存储hdfs名字空间元数据  --&gt;</span><br><span class=\"line\">                &lt;name&gt;dfs.namenode.name.dir&lt;&#x2F;name&gt;</span><br><span class=\"line\">                &lt;value&gt;&#x2F;mnt&#x2F;hadoop&#x2F;hdfs&#x2F;name&lt;&#x2F;value&gt;</span><br><span class=\"line\">        &lt;&#x2F;property&gt;</span><br><span class=\"line\">        &lt;property&gt;</span><br><span class=\"line\">        &lt;!-- hdfs web 管理界面 --&gt;</span><br><span class=\"line\">                &lt;name&gt;dfs.http.address&lt;&#x2F;name&gt;</span><br><span class=\"line\">                &lt;value&gt;0.0.0.0:8100&lt;&#x2F;value&gt;</span><br><span class=\"line\">        &lt;&#x2F;property&gt;</span><br><span class=\"line\">        &lt;property&gt;</span><br><span class=\"line\">        &lt;!-- 副本个数，配置默认是3,应小于datanode机器数量 --&gt;</span><br><span class=\"line\">                &lt;name&gt;dfs.replication&lt;&#x2F;name&gt;</span><br><span class=\"line\">                &lt;value&gt;1&lt;&#x2F;value&gt;</span><br><span class=\"line\">        &lt;&#x2F;property&gt;</span><br><span class=\"line\">&lt;&#x2F;configuration&gt;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"配置mapred-site-xml\"><a href=\"#配置mapred-site-xml\" class=\"headerlink\" title=\"配置mapred-site.xml\"></a>配置mapred-site.xml</h5><p>（注：若没有mapred-site.xml，则需要将mapred-site.xml.template改为mapred-site.xml，并设置hadoop为属主属组）</p>\n<p><code>/usr/local/hadoop/etc/hadoop/mapred-site.xml</code>   mapred计算所需要的配置文件] 只当在jar计算时才有</p>\n<p><code>http://hadoop.apache.org/docs/current/hadoop-mapreduce-client/hadoop-mapreduce-client-core/mapred-default.xml</code></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;configuration&gt;  </span><br><span class=\"line\">&lt;property&gt;  </span><br><span class=\"line\">        &lt;name&gt;mapreduce.framework.name&lt;&#x2F;name&gt;  </span><br><span class=\"line\">        &lt;value&gt;yarn&lt;&#x2F;value&gt;  </span><br><span class=\"line\">&lt;&#x2F;property&gt;  </span><br><span class=\"line\">&lt;property&gt;</span><br><span class=\"line\">  &lt;name&gt;mapred.job.tracker.http.address&lt;&#x2F;name&gt;</span><br><span class=\"line\">  &lt;value&gt;0.0.0.0:50030&lt;&#x2F;value&gt;</span><br><span class=\"line\">&lt;&#x2F;property&gt;</span><br><span class=\"line\">&lt;property&gt;</span><br><span class=\"line\">  &lt;name&gt;mapred.task.tracker.http.address&lt;&#x2F;name&gt;</span><br><span class=\"line\">  &lt;value&gt;0.0.0.0:50060&lt;&#x2F;value&gt;</span><br><span class=\"line\">&lt;&#x2F;property&gt;</span><br><span class=\"line\">&lt;&#x2F;configuration&gt; </span><br></pre></td></tr></table></figure>\n\n<h5 id=\"配置yarn-site-xml\"><a href=\"#配置yarn-site-xml\" class=\"headerlink\" title=\"配置yarn-site.xml\"></a>配置yarn-site.xml</h5><p><code>/usr/local/hadoop/etc/hadoop/yarn-site.xml</code>  yarn服务的 –&gt; 会起进程</p>\n<p><code>http://hadoop.apache.org/docs/current/hadoop-yarn/hadoop-yarn-common/yarn-default.xml</code></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;configuration&gt;  </span><br><span class=\"line\">&lt;property&gt;  </span><br><span class=\"line\">        &lt;name&gt;yarn.nodemanager.aux-services&lt;&#x2F;name&gt;  </span><br><span class=\"line\">        &lt;value&gt;mapreduce_shuffle&lt;&#x2F;value&gt;  </span><br><span class=\"line\">&lt;&#x2F;property&gt;  </span><br><span class=\"line\">&lt;property&gt;  </span><br><span class=\"line\">        &lt;name&gt;yarn.resourcemanager.webapp.address&lt;&#x2F;name&gt;  </span><br><span class=\"line\">        &lt;value&gt;192.168.1.12:8099&lt;&#x2F;value&gt;  </span><br><span class=\"line\">        &lt;description&gt;这个地址是mr管理界面的&lt;&#x2F;description&gt;  </span><br><span class=\"line\">&lt;&#x2F;property&gt;  </span><br><span class=\"line\">&lt;&#x2F;configuration&gt;  </span><br></pre></td></tr></table></figure>\n\n<h3 id=\"格式化namenode\"><a href=\"#格式化namenode\" class=\"headerlink\" title=\"格式化namenode\"></a>格式化namenode</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hdfs namenode -format</span><br><span class=\"line\"></span><br><span class=\"line\">成功的话，会看到 &quot;successfully formatted&quot; 和 &quot;Exitting with status 0&quot; 的提示，若为 &quot;Exitting with status 1&quot; 则是出错</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"启动\"><a href=\"#启动\" class=\"headerlink\" title=\"启动\"></a>启动</h3><p>启动NameNode 和 DataNode 守护进程及secondary namenodes</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sbin&#x2F;start-dfs.sh</span><br></pre></td></tr></table></figure>\n\n<p>启动ResourceManager 和 NodeManager 守护进程</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sbin&#x2F;start-yarn.sh</span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#! &#x2F;bin&#x2F;sh    </span><br><span class=\"line\">rm -rf  &#x2F;mnt&#x2F;hadoop&#x2F;hdfs&#x2F;data&#x2F;*  </span><br><span class=\"line\">rm -rf  &#x2F;mnt&#x2F;hadoop&#x2F;hdfs&#x2F;name&#x2F;*  </span><br><span class=\"line\">#启动NameNode 和 DataNode 守护进程及secondary namenodes  </span><br><span class=\"line\">sh &#x2F;usr&#x2F;local&#x2F;hadoop&#x2F;sbin&#x2F;start-dfs.sh  </span><br><span class=\"line\">#启动ResourceManager 和 NodeManager 守护进程  </span><br><span class=\"line\">sh &#x2F;usr&#x2F;local&#x2F;hadoop&#x2F;sbin&#x2F;sbin&#x2F;start-yarn.sh </span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<p>###HDFS的使用</p>\n<p>HDFS的命令执行格式：hadoop fs -cmd，其中cmd是类shell的命令</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hadoop fs -ls &#x2F;                &#x2F;&#x2F;查看hdfs根目录的文件树</span><br><span class=\"line\">hadoop fs -mkdir &#x2F;test         &#x2F;&#x2F;创建test文件夹</span><br><span class=\"line\">hadoop fs -cp 文件 文件        &#x2F;&#x2F;拷贝文件</span><br><span class=\"line\">hadoop fs -help &lt;cmd&gt;          &#x2F;&#x2F;#查看帮助</span><br><span class=\"line\">hadoop fs -cat &lt;hdfs上的路径&gt;    &#x2F;&#x2F;查看文件内容</span><br><span class=\"line\">hadoop fs -put &lt;linux上文件&gt; &lt;hdfs上的路径&gt;   &#x2F;&#x2F;上传</span><br><span class=\"line\">hadoop fs -get &lt;hdfs上的路径&gt; &lt;linux上文件&gt;   &#x2F;&#x2F;下载文件</span><br><span class=\"line\"></span><br><span class=\"line\">&#x2F;&#x2F;上传文件到hdfs文件系统上</span><br><span class=\"line\">例如： hadoop fs -put &#x2F;root&#x2F;install.log hdfs:&#x2F;&#x2F;localhost:9000&#x2F;</span><br><span class=\"line\">&#x2F;&#x2F;删除hdfs系统文件  </span><br><span class=\"line\">例如： hadoop fs -rm hdfs:&#x2F;&#x2F;localhost:9000&#x2F;install.log  </span><br></pre></td></tr></table></figure>\n\n<h3 id=\"测试yarn\"><a href=\"#测试yarn\" class=\"headerlink\" title=\"测试yarn\"></a>测试yarn</h3><p><strong>上传一个文件到HDFS</strong></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hadoop fs -put  words.txt  hdfs:&#x2F;&#x2F;localhost:9000&#x2F;</span><br></pre></td></tr></table></figure>\n\n<p>让Yarn来统计一下文件信息</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd  &#x2F;$HADOOP_HOME&#x2F;share&#x2F;hadoop&#x2F;mapreduce&#x2F;</span><br></pre></td></tr></table></figure>\n\n<p>测试命令</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hadoop jar &#x2F;usr&#x2F;hadoop&#x2F;hadoop-3.0.0&#x2F;share&#x2F;hadoop&#x2F;mapreduce&#x2F;hadoop-mapreduce-examples-3.0.0.jar wordcount &#x2F;ha.txt &#x2F;myorder&#x2F;  </span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"问题\"><a href=\"#问题\" class=\"headerlink\" title=\"问题\"></a>问题</h3><p>namenode格式化的时候遇到JAVA_HOME环境变量问题</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">解决办法：hadoop&#x2F;etc&#x2F;hadoop&#x2F;hadoop-env.xml文件中有变量的设置，但是不能满足要求，还要修改一下hadoop&#x2F;libexec&#x2F;hadoop-config.sh   文件中大概160行，新增：</span><br><span class=\"line\"></span><br><span class=\"line\">export JAVA_HOME&#x3D;&#x2F;usr&#x2F;local&#x2F;java&#x2F;</span><br></pre></td></tr></table></figure>\n\n<p>datanode无法启动</p>\n<p>出现该问题的原因：在第一次格式化dfs后，启动并使用了hadoop，后来又重新执行了格式化命令（hdfs namenode -format)，这时namenode的clusterID会重新生成，而datanode的clusterID 保持不变。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">解决办法：将hadoop&#x2F;name&#x2F;current下的VERSION中的clusterID复制到hadoop&#x2F;data&#x2F;current下的VERSION中，覆盖掉原来的clusterID，让两个保持一致然后重启，启动后执行jps，查看进程</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"启动报错\"><a href=\"#启动报错\" class=\"headerlink\" title=\"启动报错\"></a>启动报错</h5><p>如果运行脚本报如下错误,</p>\n<p>ERROR: Attempting to launch hdfs namenode as root<br>ERROR: but there is no HDFS_NAMENODE_USER defined. Aborting launch.<br>Starting datanodes<br>ERROR: Attempting to launch hdfs datanode as root<br>ERROR: but there is no HDFS_DATANODE_USER defined. Aborting launch.<br>Starting secondary namenodes [localhost.localdomain]<br>ERROR: Attempting to launch hdfs secondarynamenode as root<br>ERROR: but there is no HDFS_SECONDARYNAMENODE_USER defined. Aborting launch.</p>\n<p><code>解决方案</code></p>\n<p>（缺少用户定义而造成的）因此编辑启动和关闭</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim sbin&#x2F;start-dfs.sh</span><br><span class=\"line\">vim sbin&#x2F;stop-dfs.sh</span><br></pre></td></tr></table></figure>\n\n<p>顶部空白处</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">HDFS_DATANODE_USER&#x3D;root</span><br><span class=\"line\">HADOOP_SECURE_DN_USER&#x3D;hdfs</span><br><span class=\"line\">HDFS_NAMENODE_USER&#x3D;root</span><br><span class=\"line\">HDFS_SECONDARYNAMENODE_USER&#x3D;root</span><br></pre></td></tr></table></figure>\n\n\n\n<p><strong>如果启动时报如下错误，</strong></p>\n<p><strong>Starting resourcemanagerERROR: Attempting to launch yarn resourcemanager as rootERROR: but there is no YARN_RESOURCEMANAGER_USER defined. Aborting launch.</strong></p>\n<p><strong>解决方案</strong></p>\n<p>（也是由于缺少用户定义）</p>\n<p>是因为缺少用户定义造成的，所以分别编辑开始和关闭脚本 </p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim sbin&#x2F;start-yarn.sh</span><br><span class=\"line\">vim sbin&#x2F;stop-yarn.sh </span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">YARN_RESOURCEMANAGER_USER&#x3D;root  </span><br><span class=\"line\">HADOOP_SECURE_DN_USER&#x3D;yarn  </span><br><span class=\"line\">YARN_NODEMANAGER_USER&#x3D;root </span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"","more":"<p>##hadoop 安装</p>\n<p>官方文档<code>http://hadoop.apache.org/docs/current/</code></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">我们建议您下载以下镜像站点：</span><br><span class=\"line\"></span><br><span class=\"line\">http:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;apache&#x2F;hadoop&#x2F;common&#x2F;hadoop-3.0.1&#x2F;hadoop-3.0.1.tar.gz</span><br><span class=\"line\"></span><br><span class=\"line\">其他镜像站点如下所示。</span><br><span class=\"line\">http:&#x2F;&#x2F;mirrors.hust.edu.cn&#x2F;apache&#x2F;hadoop&#x2F;common&#x2F;hadoop-3.0.1&#x2F;hadoop-3.0.1.tar.gz </span><br><span class=\"line\"></span><br><span class=\"line\">http:&#x2F;&#x2F;mirrors.shu.edu.cn&#x2F;apache&#x2F;hadoop&#x2F;common&#x2F;hadoop-3.0.1&#x2F;hadoop-3.0.1.tar.gz </span><br><span class=\"line\"></span><br><span class=\"line\">http:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;apache&#x2F;hadoop&#x2F;common&#x2F;hadoop-3.0.1&#x2F;hadoop-3.0.1.tar.gz </span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"下载\"><a href=\"#下载\" class=\"headerlink\" title=\"下载\"></a>下载</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">下载地址：https:&#x2F;&#x2F;archive.apache.org&#x2F;dist&#x2F;hadoop&#x2F;common&#x2F;hadoop-3.0.0-alpha4&#x2F;  这里找</span><br><span class=\"line\"></span><br><span class=\"line\">我们建议您下载以下镜像站点：</span><br><span class=\"line\">http:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;apache&#x2F;hadoop&#x2F;common&#x2F;hadoop-3.0.1&#x2F;hadoop-3.0.1.tar.gz</span><br><span class=\"line\">其他镜像站点如下所示。</span><br><span class=\"line\">http:&#x2F;&#x2F;mirrors.hust.edu.cn&#x2F;apache&#x2F;hadoop&#x2F;common&#x2F;hadoop-3.0.1&#x2F;hadoop-3.0.1.tar.gz </span><br><span class=\"line\">http:&#x2F;&#x2F;mirrors.shu.edu.cn&#x2F;apache&#x2F;hadoop&#x2F;common&#x2F;hadoop-3.0.1&#x2F;hadoop-3.0.1.tar.gz </span><br><span class=\"line\">http:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;apache&#x2F;hadoop&#x2F;common&#x2F;hadoop-3.0.1&#x2F;hadoop-3.0.1.tar.gz </span><br></pre></td></tr></table></figure>\n\n<h3 id=\"关闭防火墙和色linux\"><a href=\"#关闭防火墙和色linux\" class=\"headerlink\" title=\"关闭防火墙和色linux\"></a>关闭防火墙和色linux</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<p>###环境要求</p>\n<p>安装jdk,并且Java版本不低于Hadoop要求，并配置环境变量</p>\n<h3 id=\"修改hosts\"><a href=\"#修改hosts\" class=\"headerlink\" title=\"修改hosts\"></a>修改hosts</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">192.168.1.12 node1</span><br><span class=\"line\">192.168.1.12 node2</span><br><span class=\"line\">192.168.1.12 node3</span><br></pre></td></tr></table></figure>\n\n<p>创建ssh 秘钥，并发送到其他节点</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ssh-keygen -t rsa</span><br><span class=\"line\">ssh-copy-id node1</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"创建目录\"><a href=\"#创建目录\" class=\"headerlink\" title=\"创建目录\"></a>创建目录</h3><p>在/usr/hadoop/目录下，建立tmp、hdfs/name、hdfs/data目录，执行如下命令 </p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir -p &#x2F;mnt&#x2F;hadoop&#x2F;&#123;tmp,hdfs&#x2F;&#123;data,name&#125;&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<p>###安装</p>\n<p>在网站hadoop.apache.org下载稳定版本的Hadoop包</p>\n<p>解压压缩包</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tar xf hadoop-3.0.1.tar.gz</span><br><span class=\"line\">mv hadoop-3.0.1 &#x2F;usr&#x2F;local&#x2F;hadoop</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"添加hadoop环境变量\"><a href=\"#添加hadoop环境变量\" class=\"headerlink\" title=\"添加hadoop环境变量\"></a>添加hadoop环境变量</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">设置环境变量，  vim &#x2F;etc&#x2F;profile </span><br><span class=\"line\"></span><br><span class=\"line\"># set hadoop path</span><br><span class=\"line\">export HADOOP_HOME&#x3D;&#x2F;usr&#x2F;local&#x2F;hadoop&#x2F;</span><br><span class=\"line\">export PATH&#x3D;$PATH:$HADOOP_HOME&#x2F;bin</span><br></pre></td></tr></table></figure>\n\n<p>###检查Hadoop是否可用</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hadoop version</span><br><span class=\"line\"></span><br><span class=\"line\">Hadoop 3.0.1</span><br><span class=\"line\">Source code repository Unknown -r 496dc57cc2e4f4da117f7a8e3840aaeac0c1d2d0</span><br><span class=\"line\">Compiled by lei on 2018-03-16T23:00Z</span><br><span class=\"line\">Compiled with protoc 2.5.0</span><br><span class=\"line\">From source with checksum 504d49cc3bcf4e2b56e2fd44ced8572</span><br><span class=\"line\">This command was run using &#x2F;root&#x2F;hadoop-3.0.1&#x2F;share&#x2F;hadoop&#x2F;common&#x2F;hadoop-common-3.0.1.jar</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"修改配置文件\"><a href=\"#修改配置文件\" class=\"headerlink\" title=\"修改配置文件\"></a>修改配置文件</h3><h5 id=\"配置hadoop-env-sh\"><a href=\"#配置hadoop-env-sh\" class=\"headerlink\" title=\"配置hadoop-env.sh\"></a>配置hadoop-env.sh</h5><p><code>vim /usr/local/hadoop/etc/hadoop/hadoop-env.sh </code>  hadoop配置环境</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#第27行</span><br><span class=\"line\">export JAVA_HOME&#x3D;&#x2F;usr&#x2F;local&#x2F;java</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"配置yarn-env-sh\"><a href=\"#配置yarn-env-sh\" class=\"headerlink\" title=\"配置yarn-env.sh\"></a>配置yarn-env.sh</h5><p><code>vim /usr/local/hadoop/etc/hadoop/yarn-env.sh</code></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">export JAVA_HOME&#x3D;&#x2F;usr&#x2F;local&#x2F;java</span><br></pre></td></tr></table></figure>\n\n<p>Hadoop配置以.xml文件形式存在</p>\n<h5 id=\"配置core-site-xml\"><a href=\"#配置core-site-xml\" class=\"headerlink\" title=\"配置core-site.xml\"></a>配置core-site.xml</h5><p><code>/usr/local/hadoop/etc/hadoop/core-site.xml</code>   hadoop 核心配置文件</p>\n<p><code>http://hadoop.apache.org/docs/current/hadoop-project-dist/hadoop-common/core-default.xml</code></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;configuration&gt;</span><br><span class=\"line\">        &lt;property&gt;</span><br><span class=\"line\">        &lt;!-- 指定hadoop运行时产生文件的存储目录 --&gt;</span><br><span class=\"line\">                &lt;name&gt;hadoop.tmp.dir&lt;&#x2F;name&gt;</span><br><span class=\"line\">                &lt;value&gt;&#x2F;mnt&#x2F;hadoop&#x2F;tmp&lt;&#x2F;value&gt;</span><br><span class=\"line\">        &lt;&#x2F;property&gt;</span><br><span class=\"line\">        &lt;property&gt;</span><br><span class=\"line\">        &lt;!-- 指定HADOOP所使用的文件系统schema（URI），HDFS的老大（NameNode）的地址 --&gt;</span><br><span class=\"line\">                &lt;name&gt;fs.default.name&lt;&#x2F;name&gt;</span><br><span class=\"line\">                &lt;value&gt;hdfs:&#x2F;&#x2F;node1:9000&lt;&#x2F;value&gt;</span><br><span class=\"line\">        &lt;&#x2F;property&gt;</span><br><span class=\"line\">&lt;&#x2F;configuration&gt;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"配置hdfs-site-xml\"><a href=\"#配置hdfs-site-xml\" class=\"headerlink\" title=\"配置hdfs-site.xml\"></a>配置hdfs-site.xml</h5><p> <code>/usr/local/hadoop/etc/hadoop/hdfs-site.xml</code>   hdfs服务的 –&gt; 会起进程</p>\n<p><code>http://hadoop.apache.org/docs/current/hadoop-project-dist/hadoop-hdfs/hdfs-default.xml</code></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;configuration&gt;</span><br><span class=\"line\">        &lt;property&gt;</span><br><span class=\"line\">        &lt;!-- datanode上数据块的物理存储位置 --&gt;</span><br><span class=\"line\">                &lt;name&gt;dfs.datanode.data.dir&lt;&#x2F;name&gt;</span><br><span class=\"line\">                &lt;value&gt;&#x2F;mnt&#x2F;hadoop&#x2F;hdfs&#x2F;data&lt;&#x2F;value&gt;</span><br><span class=\"line\">        &lt;&#x2F;property&gt;</span><br><span class=\"line\">        &lt;property&gt;</span><br><span class=\"line\">        &lt;!-- namenode上存储hdfs名字空间元数据  --&gt;</span><br><span class=\"line\">                &lt;name&gt;dfs.namenode.name.dir&lt;&#x2F;name&gt;</span><br><span class=\"line\">                &lt;value&gt;&#x2F;mnt&#x2F;hadoop&#x2F;hdfs&#x2F;name&lt;&#x2F;value&gt;</span><br><span class=\"line\">        &lt;&#x2F;property&gt;</span><br><span class=\"line\">        &lt;property&gt;</span><br><span class=\"line\">        &lt;!-- hdfs web 管理界面 --&gt;</span><br><span class=\"line\">                &lt;name&gt;dfs.http.address&lt;&#x2F;name&gt;</span><br><span class=\"line\">                &lt;value&gt;0.0.0.0:8100&lt;&#x2F;value&gt;</span><br><span class=\"line\">        &lt;&#x2F;property&gt;</span><br><span class=\"line\">        &lt;property&gt;</span><br><span class=\"line\">        &lt;!-- 副本个数，配置默认是3,应小于datanode机器数量 --&gt;</span><br><span class=\"line\">                &lt;name&gt;dfs.replication&lt;&#x2F;name&gt;</span><br><span class=\"line\">                &lt;value&gt;1&lt;&#x2F;value&gt;</span><br><span class=\"line\">        &lt;&#x2F;property&gt;</span><br><span class=\"line\">&lt;&#x2F;configuration&gt;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"配置mapred-site-xml\"><a href=\"#配置mapred-site-xml\" class=\"headerlink\" title=\"配置mapred-site.xml\"></a>配置mapred-site.xml</h5><p>（注：若没有mapred-site.xml，则需要将mapred-site.xml.template改为mapred-site.xml，并设置hadoop为属主属组）</p>\n<p><code>/usr/local/hadoop/etc/hadoop/mapred-site.xml</code>   mapred计算所需要的配置文件] 只当在jar计算时才有</p>\n<p><code>http://hadoop.apache.org/docs/current/hadoop-mapreduce-client/hadoop-mapreduce-client-core/mapred-default.xml</code></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;configuration&gt;  </span><br><span class=\"line\">&lt;property&gt;  </span><br><span class=\"line\">        &lt;name&gt;mapreduce.framework.name&lt;&#x2F;name&gt;  </span><br><span class=\"line\">        &lt;value&gt;yarn&lt;&#x2F;value&gt;  </span><br><span class=\"line\">&lt;&#x2F;property&gt;  </span><br><span class=\"line\">&lt;property&gt;</span><br><span class=\"line\">  &lt;name&gt;mapred.job.tracker.http.address&lt;&#x2F;name&gt;</span><br><span class=\"line\">  &lt;value&gt;0.0.0.0:50030&lt;&#x2F;value&gt;</span><br><span class=\"line\">&lt;&#x2F;property&gt;</span><br><span class=\"line\">&lt;property&gt;</span><br><span class=\"line\">  &lt;name&gt;mapred.task.tracker.http.address&lt;&#x2F;name&gt;</span><br><span class=\"line\">  &lt;value&gt;0.0.0.0:50060&lt;&#x2F;value&gt;</span><br><span class=\"line\">&lt;&#x2F;property&gt;</span><br><span class=\"line\">&lt;&#x2F;configuration&gt; </span><br></pre></td></tr></table></figure>\n\n<h5 id=\"配置yarn-site-xml\"><a href=\"#配置yarn-site-xml\" class=\"headerlink\" title=\"配置yarn-site.xml\"></a>配置yarn-site.xml</h5><p><code>/usr/local/hadoop/etc/hadoop/yarn-site.xml</code>  yarn服务的 –&gt; 会起进程</p>\n<p><code>http://hadoop.apache.org/docs/current/hadoop-yarn/hadoop-yarn-common/yarn-default.xml</code></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;configuration&gt;  </span><br><span class=\"line\">&lt;property&gt;  </span><br><span class=\"line\">        &lt;name&gt;yarn.nodemanager.aux-services&lt;&#x2F;name&gt;  </span><br><span class=\"line\">        &lt;value&gt;mapreduce_shuffle&lt;&#x2F;value&gt;  </span><br><span class=\"line\">&lt;&#x2F;property&gt;  </span><br><span class=\"line\">&lt;property&gt;  </span><br><span class=\"line\">        &lt;name&gt;yarn.resourcemanager.webapp.address&lt;&#x2F;name&gt;  </span><br><span class=\"line\">        &lt;value&gt;192.168.1.12:8099&lt;&#x2F;value&gt;  </span><br><span class=\"line\">        &lt;description&gt;这个地址是mr管理界面的&lt;&#x2F;description&gt;  </span><br><span class=\"line\">&lt;&#x2F;property&gt;  </span><br><span class=\"line\">&lt;&#x2F;configuration&gt;  </span><br></pre></td></tr></table></figure>\n\n<h3 id=\"格式化namenode\"><a href=\"#格式化namenode\" class=\"headerlink\" title=\"格式化namenode\"></a>格式化namenode</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hdfs namenode -format</span><br><span class=\"line\"></span><br><span class=\"line\">成功的话，会看到 &quot;successfully formatted&quot; 和 &quot;Exitting with status 0&quot; 的提示，若为 &quot;Exitting with status 1&quot; 则是出错</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"启动\"><a href=\"#启动\" class=\"headerlink\" title=\"启动\"></a>启动</h3><p>启动NameNode 和 DataNode 守护进程及secondary namenodes</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sbin&#x2F;start-dfs.sh</span><br></pre></td></tr></table></figure>\n\n<p>启动ResourceManager 和 NodeManager 守护进程</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sbin&#x2F;start-yarn.sh</span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#! &#x2F;bin&#x2F;sh    </span><br><span class=\"line\">rm -rf  &#x2F;mnt&#x2F;hadoop&#x2F;hdfs&#x2F;data&#x2F;*  </span><br><span class=\"line\">rm -rf  &#x2F;mnt&#x2F;hadoop&#x2F;hdfs&#x2F;name&#x2F;*  </span><br><span class=\"line\">#启动NameNode 和 DataNode 守护进程及secondary namenodes  </span><br><span class=\"line\">sh &#x2F;usr&#x2F;local&#x2F;hadoop&#x2F;sbin&#x2F;start-dfs.sh  </span><br><span class=\"line\">#启动ResourceManager 和 NodeManager 守护进程  </span><br><span class=\"line\">sh &#x2F;usr&#x2F;local&#x2F;hadoop&#x2F;sbin&#x2F;sbin&#x2F;start-yarn.sh </span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<p>###HDFS的使用</p>\n<p>HDFS的命令执行格式：hadoop fs -cmd，其中cmd是类shell的命令</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hadoop fs -ls &#x2F;                &#x2F;&#x2F;查看hdfs根目录的文件树</span><br><span class=\"line\">hadoop fs -mkdir &#x2F;test         &#x2F;&#x2F;创建test文件夹</span><br><span class=\"line\">hadoop fs -cp 文件 文件        &#x2F;&#x2F;拷贝文件</span><br><span class=\"line\">hadoop fs -help &lt;cmd&gt;          &#x2F;&#x2F;#查看帮助</span><br><span class=\"line\">hadoop fs -cat &lt;hdfs上的路径&gt;    &#x2F;&#x2F;查看文件内容</span><br><span class=\"line\">hadoop fs -put &lt;linux上文件&gt; &lt;hdfs上的路径&gt;   &#x2F;&#x2F;上传</span><br><span class=\"line\">hadoop fs -get &lt;hdfs上的路径&gt; &lt;linux上文件&gt;   &#x2F;&#x2F;下载文件</span><br><span class=\"line\"></span><br><span class=\"line\">&#x2F;&#x2F;上传文件到hdfs文件系统上</span><br><span class=\"line\">例如： hadoop fs -put &#x2F;root&#x2F;install.log hdfs:&#x2F;&#x2F;localhost:9000&#x2F;</span><br><span class=\"line\">&#x2F;&#x2F;删除hdfs系统文件  </span><br><span class=\"line\">例如： hadoop fs -rm hdfs:&#x2F;&#x2F;localhost:9000&#x2F;install.log  </span><br></pre></td></tr></table></figure>\n\n<h3 id=\"测试yarn\"><a href=\"#测试yarn\" class=\"headerlink\" title=\"测试yarn\"></a>测试yarn</h3><p><strong>上传一个文件到HDFS</strong></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hadoop fs -put  words.txt  hdfs:&#x2F;&#x2F;localhost:9000&#x2F;</span><br></pre></td></tr></table></figure>\n\n<p>让Yarn来统计一下文件信息</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd  &#x2F;$HADOOP_HOME&#x2F;share&#x2F;hadoop&#x2F;mapreduce&#x2F;</span><br></pre></td></tr></table></figure>\n\n<p>测试命令</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hadoop jar &#x2F;usr&#x2F;hadoop&#x2F;hadoop-3.0.0&#x2F;share&#x2F;hadoop&#x2F;mapreduce&#x2F;hadoop-mapreduce-examples-3.0.0.jar wordcount &#x2F;ha.txt &#x2F;myorder&#x2F;  </span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"问题\"><a href=\"#问题\" class=\"headerlink\" title=\"问题\"></a>问题</h3><p>namenode格式化的时候遇到JAVA_HOME环境变量问题</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">解决办法：hadoop&#x2F;etc&#x2F;hadoop&#x2F;hadoop-env.xml文件中有变量的设置，但是不能满足要求，还要修改一下hadoop&#x2F;libexec&#x2F;hadoop-config.sh   文件中大概160行，新增：</span><br><span class=\"line\"></span><br><span class=\"line\">export JAVA_HOME&#x3D;&#x2F;usr&#x2F;local&#x2F;java&#x2F;</span><br></pre></td></tr></table></figure>\n\n<p>datanode无法启动</p>\n<p>出现该问题的原因：在第一次格式化dfs后，启动并使用了hadoop，后来又重新执行了格式化命令（hdfs namenode -format)，这时namenode的clusterID会重新生成，而datanode的clusterID 保持不变。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">解决办法：将hadoop&#x2F;name&#x2F;current下的VERSION中的clusterID复制到hadoop&#x2F;data&#x2F;current下的VERSION中，覆盖掉原来的clusterID，让两个保持一致然后重启，启动后执行jps，查看进程</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"启动报错\"><a href=\"#启动报错\" class=\"headerlink\" title=\"启动报错\"></a>启动报错</h5><p>如果运行脚本报如下错误,</p>\n<p>ERROR: Attempting to launch hdfs namenode as root<br>ERROR: but there is no HDFS_NAMENODE_USER defined. Aborting launch.<br>Starting datanodes<br>ERROR: Attempting to launch hdfs datanode as root<br>ERROR: but there is no HDFS_DATANODE_USER defined. Aborting launch.<br>Starting secondary namenodes [localhost.localdomain]<br>ERROR: Attempting to launch hdfs secondarynamenode as root<br>ERROR: but there is no HDFS_SECONDARYNAMENODE_USER defined. Aborting launch.</p>\n<p><code>解决方案</code></p>\n<p>（缺少用户定义而造成的）因此编辑启动和关闭</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim sbin&#x2F;start-dfs.sh</span><br><span class=\"line\">vim sbin&#x2F;stop-dfs.sh</span><br></pre></td></tr></table></figure>\n\n<p>顶部空白处</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">HDFS_DATANODE_USER&#x3D;root</span><br><span class=\"line\">HADOOP_SECURE_DN_USER&#x3D;hdfs</span><br><span class=\"line\">HDFS_NAMENODE_USER&#x3D;root</span><br><span class=\"line\">HDFS_SECONDARYNAMENODE_USER&#x3D;root</span><br></pre></td></tr></table></figure>\n\n\n\n<p><strong>如果启动时报如下错误，</strong></p>\n<p><strong>Starting resourcemanagerERROR: Attempting to launch yarn resourcemanager as rootERROR: but there is no YARN_RESOURCEMANAGER_USER defined. Aborting launch.</strong></p>\n<p><strong>解决方案</strong></p>\n<p>（也是由于缺少用户定义）</p>\n<p>是因为缺少用户定义造成的，所以分别编辑开始和关闭脚本 </p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim sbin&#x2F;start-yarn.sh</span><br><span class=\"line\">vim sbin&#x2F;stop-yarn.sh </span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">YARN_RESOURCEMANAGER_USER&#x3D;root  </span><br><span class=\"line\">HADOOP_SECURE_DN_USER&#x3D;yarn  </span><br><span class=\"line\">YARN_NODEMANAGER_USER&#x3D;root </span><br></pre></td></tr></table></figure>"},{"title":"Hello World","_content":"Welcome to [Hexo](https://hexo.io/)! This is your very first post. Check [documentation](https://hexo.io/docs/) for more info. If you get any problems when using Hexo, you can find the answer in [troubleshooting](https://hexo.io/docs/troubleshooting.html) or you can ask me on [GitHub](https://github.com/hexojs/hexo/issues).\n\n## Quick Start\n\n### Create a new post\n\n``` bash\n$ hexo new \"My New Post\"\n```\n\nMore info: [Writing](https://hexo.io/docs/writing.html)\n\n### Run server\n\n``` bash\n$ hexo server\n```\n\nMore info: [Server](https://hexo.io/docs/server.html)\n\n### Generate static files\n\n``` bash\n$ hexo generate\n```\n\nMore info: [Generating](https://hexo.io/docs/generating.html)\n\n### Deploy to remote sites\n\n``` bash\n$ hexo deploy\n```\n\nMore info: [Deployment](https://hexo.io/docs/one-command-deployment.html)\n","source":"_posts/hello-world.md","raw":"---\ntitle: Hello World\n---\nWelcome to [Hexo](https://hexo.io/)! This is your very first post. Check [documentation](https://hexo.io/docs/) for more info. If you get any problems when using Hexo, you can find the answer in [troubleshooting](https://hexo.io/docs/troubleshooting.html) or you can ask me on [GitHub](https://github.com/hexojs/hexo/issues).\n\n## Quick Start\n\n### Create a new post\n\n``` bash\n$ hexo new \"My New Post\"\n```\n\nMore info: [Writing](https://hexo.io/docs/writing.html)\n\n### Run server\n\n``` bash\n$ hexo server\n```\n\nMore info: [Server](https://hexo.io/docs/server.html)\n\n### Generate static files\n\n``` bash\n$ hexo generate\n```\n\nMore info: [Generating](https://hexo.io/docs/generating.html)\n\n### Deploy to remote sites\n\n``` bash\n$ hexo deploy\n```\n\nMore info: [Deployment](https://hexo.io/docs/one-command-deployment.html)\n","slug":"hello-world","published":1,"date":"2021-08-17T02:18:12.610Z","updated":"2021-06-18T08:07:11.188Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cku6979xr000j00uhgzhe6ddl","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><p>Welcome to <a href=\"https://hexo.io/\">Hexo</a>! This is your very first post. Check <a href=\"https://hexo.io/docs/\">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href=\"https://hexo.io/docs/troubleshooting.html\">troubleshooting</a> or you can ask me on <a href=\"https://github.com/hexojs/hexo/issues\">GitHub</a>.</p>\n<h2 id=\"Quick-Start\"><a href=\"#Quick-Start\" class=\"headerlink\" title=\"Quick Start\"></a>Quick Start</h2><h3 id=\"Create-a-new-post\"><a href=\"#Create-a-new-post\" class=\"headerlink\" title=\"Create a new post\"></a>Create a new post</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo new <span class=\"string\">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/writing.html\">Writing</a></p>\n<h3 id=\"Run-server\"><a href=\"#Run-server\" class=\"headerlink\" title=\"Run server\"></a>Run server</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo server</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/server.html\">Server</a></p>\n<h3 id=\"Generate-static-files\"><a href=\"#Generate-static-files\" class=\"headerlink\" title=\"Generate static files\"></a>Generate static files</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo generate</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/generating.html\">Generating</a></p>\n<h3 id=\"Deploy-to-remote-sites\"><a href=\"#Deploy-to-remote-sites\" class=\"headerlink\" title=\"Deploy to remote sites\"></a>Deploy to remote sites</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo deploy</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/one-command-deployment.html\">Deployment</a></p>\n","site":{"data":{}},"excerpt":"","more":"<p>Welcome to <a href=\"https://hexo.io/\">Hexo</a>! This is your very first post. Check <a href=\"https://hexo.io/docs/\">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href=\"https://hexo.io/docs/troubleshooting.html\">troubleshooting</a> or you can ask me on <a href=\"https://github.com/hexojs/hexo/issues\">GitHub</a>.</p>\n<h2 id=\"Quick-Start\"><a href=\"#Quick-Start\" class=\"headerlink\" title=\"Quick Start\"></a>Quick Start</h2><h3 id=\"Create-a-new-post\"><a href=\"#Create-a-new-post\" class=\"headerlink\" title=\"Create a new post\"></a>Create a new post</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo new <span class=\"string\">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/writing.html\">Writing</a></p>\n<h3 id=\"Run-server\"><a href=\"#Run-server\" class=\"headerlink\" title=\"Run server\"></a>Run server</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo server</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/server.html\">Server</a></p>\n<h3 id=\"Generate-static-files\"><a href=\"#Generate-static-files\" class=\"headerlink\" title=\"Generate static files\"></a>Generate static files</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo generate</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/generating.html\">Generating</a></p>\n<h3 id=\"Deploy-to-remote-sites\"><a href=\"#Deploy-to-remote-sites\" class=\"headerlink\" title=\"Deploy to remote sites\"></a>Deploy to remote sites</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo deploy</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/one-command-deployment.html\">Deployment</a></p>\n"},{"title":"hexo 使用","date":"2019-10-09T03:00:00.000Z","_content":"\n## hexo 使用\n\n## 安装nodeJS\n\n安装后\n\n```bash\nnode -v\nnpm -v\n```\n\n\n\n## 安装 hexo\n\n```bash\nnpm install -g hexo-cli\n\nhexo -v    #查看一下版本\n```\n\n\n\n初始化hexo\n\n```\n始化hexo\n----------------------\nhexo init myblog\n\n这个myblog可以自己取什么名字都行，然后\n----------------------\ncd myblog\nnpm install\n\n```\n\n\n\n命令\n\n```bash\nhexo new \"postName\"     #新建文章\nhexo new page \"pageName\"    #新建页面\nhexo generate      #生成静态页面至public目录\nhexo server      #开启预览访问端口（默认端口4000，'ctrl + c'关闭server）\nhexo deploy      #将.deploy目录部署到指定空间\nhexo help        # 查看帮助\nhexo version     #查看Hexo的版本\n```\n\n## 简写指令\n\n```bash\nhexo n \"我的第一篇文章\"  等价于 hexo new \"我的第一篇文章\"   还等价于   hexo new post \"我的第一篇文章\"\nhexo p     等价于   hexo publish\nhexo g     等价于   hexo generate\nhexo s     等价于   hexo server\nhexo d     等价于   hexo deploy\nhexo deploy -g     等价于    hexo deploy --generate\nhexo generate -d   等价于    hexo generate --deploy\n```\n\n","source":"_posts/heox使用.md","raw":"---\ntitle:  hexo 使用\ndate: 2019-10-09 11:00:00\ncategories: \n- hexo\ntags:\n- hexo\n---\n\n## hexo 使用\n\n## 安装nodeJS\n\n安装后\n\n```bash\nnode -v\nnpm -v\n```\n\n\n\n## 安装 hexo\n\n```bash\nnpm install -g hexo-cli\n\nhexo -v    #查看一下版本\n```\n\n\n\n初始化hexo\n\n```\n始化hexo\n----------------------\nhexo init myblog\n\n这个myblog可以自己取什么名字都行，然后\n----------------------\ncd myblog\nnpm install\n\n```\n\n\n\n命令\n\n```bash\nhexo new \"postName\"     #新建文章\nhexo new page \"pageName\"    #新建页面\nhexo generate      #生成静态页面至public目录\nhexo server      #开启预览访问端口（默认端口4000，'ctrl + c'关闭server）\nhexo deploy      #将.deploy目录部署到指定空间\nhexo help        # 查看帮助\nhexo version     #查看Hexo的版本\n```\n\n## 简写指令\n\n```bash\nhexo n \"我的第一篇文章\"  等价于 hexo new \"我的第一篇文章\"   还等价于   hexo new post \"我的第一篇文章\"\nhexo p     等价于   hexo publish\nhexo g     等价于   hexo generate\nhexo s     等价于   hexo server\nhexo d     等价于   hexo deploy\nhexo deploy -g     等价于    hexo deploy --generate\nhexo generate -d   等价于    hexo generate --deploy\n```\n\n","slug":"heox使用","published":1,"updated":"2021-06-18T08:07:11.188Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cku6979xs000l00uh7wiz04hq","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><h2 id=\"hexo-使用\"><a href=\"#hexo-使用\" class=\"headerlink\" title=\"hexo 使用\"></a>hexo 使用</h2><h2 id=\"安装nodeJS\"><a href=\"#安装nodeJS\" class=\"headerlink\" title=\"安装nodeJS\"></a>安装nodeJS</h2><p>安装后</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">node -v</span><br><span class=\"line\">npm -v</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"安装-hexo\"><a href=\"#安装-hexo\" class=\"headerlink\" title=\"安装 hexo\"></a>安装 hexo</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install -g hexo-cli</span><br><span class=\"line\"></span><br><span class=\"line\">hexo -v    <span class=\"comment\">#查看一下版本</span></span><br></pre></td></tr></table></figure>\n\n\n\n<p>初始化hexo</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">始化hexo</span><br><span class=\"line\">----------------------</span><br><span class=\"line\">hexo init myblog</span><br><span class=\"line\"></span><br><span class=\"line\">这个myblog可以自己取什么名字都行，然后</span><br><span class=\"line\">----------------------</span><br><span class=\"line\">cd myblog</span><br><span class=\"line\">npm install</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<p>命令</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hexo new <span class=\"string\">&quot;postName&quot;</span>     <span class=\"comment\">#新建文章</span></span><br><span class=\"line\">hexo new page <span class=\"string\">&quot;pageName&quot;</span>    <span class=\"comment\">#新建页面</span></span><br><span class=\"line\">hexo generate      <span class=\"comment\">#生成静态页面至public目录</span></span><br><span class=\"line\">hexo server      <span class=\"comment\">#开启预览访问端口（默认端口4000，&#x27;ctrl + c&#x27;关闭server）</span></span><br><span class=\"line\">hexo deploy      <span class=\"comment\">#将.deploy目录部署到指定空间</span></span><br><span class=\"line\">hexo <span class=\"built_in\">help</span>        <span class=\"comment\"># 查看帮助</span></span><br><span class=\"line\">hexo version     <span class=\"comment\">#查看Hexo的版本</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"简写指令\"><a href=\"#简写指令\" class=\"headerlink\" title=\"简写指令\"></a>简写指令</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hexo n <span class=\"string\">&quot;我的第一篇文章&quot;</span>  等价于 hexo new <span class=\"string\">&quot;我的第一篇文章&quot;</span>   还等价于   hexo new post <span class=\"string\">&quot;我的第一篇文章&quot;</span></span><br><span class=\"line\">hexo p     等价于   hexo publish</span><br><span class=\"line\">hexo g     等价于   hexo generate</span><br><span class=\"line\">hexo s     等价于   hexo server</span><br><span class=\"line\">hexo d     等价于   hexo deploy</span><br><span class=\"line\">hexo deploy -g     等价于    hexo deploy --generate</span><br><span class=\"line\">hexo generate -d   等价于    hexo generate --deploy</span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"hexo-使用\"><a href=\"#hexo-使用\" class=\"headerlink\" title=\"hexo 使用\"></a>hexo 使用</h2><h2 id=\"安装nodeJS\"><a href=\"#安装nodeJS\" class=\"headerlink\" title=\"安装nodeJS\"></a>安装nodeJS</h2><p>安装后</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">node -v</span><br><span class=\"line\">npm -v</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"安装-hexo\"><a href=\"#安装-hexo\" class=\"headerlink\" title=\"安装 hexo\"></a>安装 hexo</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install -g hexo-cli</span><br><span class=\"line\"></span><br><span class=\"line\">hexo -v    <span class=\"comment\">#查看一下版本</span></span><br></pre></td></tr></table></figure>\n\n\n\n<p>初始化hexo</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">始化hexo</span><br><span class=\"line\">----------------------</span><br><span class=\"line\">hexo init myblog</span><br><span class=\"line\"></span><br><span class=\"line\">这个myblog可以自己取什么名字都行，然后</span><br><span class=\"line\">----------------------</span><br><span class=\"line\">cd myblog</span><br><span class=\"line\">npm install</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<p>命令</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hexo new <span class=\"string\">&quot;postName&quot;</span>     <span class=\"comment\">#新建文章</span></span><br><span class=\"line\">hexo new page <span class=\"string\">&quot;pageName&quot;</span>    <span class=\"comment\">#新建页面</span></span><br><span class=\"line\">hexo generate      <span class=\"comment\">#生成静态页面至public目录</span></span><br><span class=\"line\">hexo server      <span class=\"comment\">#开启预览访问端口（默认端口4000，&#x27;ctrl + c&#x27;关闭server）</span></span><br><span class=\"line\">hexo deploy      <span class=\"comment\">#将.deploy目录部署到指定空间</span></span><br><span class=\"line\">hexo <span class=\"built_in\">help</span>        <span class=\"comment\"># 查看帮助</span></span><br><span class=\"line\">hexo version     <span class=\"comment\">#查看Hexo的版本</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"简写指令\"><a href=\"#简写指令\" class=\"headerlink\" title=\"简写指令\"></a>简写指令</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hexo n <span class=\"string\">&quot;我的第一篇文章&quot;</span>  等价于 hexo new <span class=\"string\">&quot;我的第一篇文章&quot;</span>   还等价于   hexo new post <span class=\"string\">&quot;我的第一篇文章&quot;</span></span><br><span class=\"line\">hexo p     等价于   hexo publish</span><br><span class=\"line\">hexo g     等价于   hexo generate</span><br><span class=\"line\">hexo s     等价于   hexo server</span><br><span class=\"line\">hexo d     等价于   hexo deploy</span><br><span class=\"line\">hexo deploy -g     等价于    hexo deploy --generate</span><br><span class=\"line\">hexo generate -d   等价于    hexo generate --deploy</span><br></pre></td></tr></table></figure>\n\n"},{"title":"hexo博客常用插件及教程","date":"2018-07-31T12:29:38.000Z","comments":1,"toc":false,"top":true,"yuanchuang":true,"_content":"> 为大家总结下hexo常用的插件与教程\n>\n> 合理的使用插件能够提高hexo的效率\n\n<!--more-->\n\n|                             命令                             |         功能          |                             文档                             |\n| :----------------------------------------------------------: | :-------------------: | :----------------------------------------------------------: |\n| npm install hexo-generator-index-pin-top --save<br />npm uninstall hexo-generator-index --save |     文章置顶插件      | [点我](https://blog.csdn.net/qwerty200696/article/details/79010629) |\n|                 npm i --save hexo-wordcount                  | 文章字数+阅读时长统计 | [点我](https://blog.csdn.net/ganzhilin520/article/details/79048036) |\n|           npm install hexo-baidu-url-submit --save           |   百度链接主动推送    | [点我](https://hui-wang.info/2016/10/23/Hexo%E6%8F%92%E4%BB%B6%E4%B9%8B%E7%99%BE%E5%BA%A6%E4%B8%BB%E5%8A%A8%E6%8F%90%E4%BA%A4%E9%93%BE%E6%8E%A5/) |\n|           npm install hexo-deployer-ftpsync --save           |  hexo上传至FTP服务器  |  [点我](https://hexo.io/zh-cn/docs/deployment.html#FTPSync)  |\n|             npm install hexo-deployer-cos --save             |  hexo上传至腾讯云COS  | [点我](https://github.com/sdlzhd/hexo-deployer-cos#user-content-options) |\n|           npm install hexo-deployer-aliyun --save            |   hexo上传至阿里云    |   [点我](https://github.com/yedaodao/hexo-deployer-aliyun)   |\n|                npm install --save hexo-admin                 |     hexo管理插件      |        [点我](https://github.com/jaredly/hexo-admin)         |\n|                 hexo-blog-encrypt(请看文档)                  |    hexo文章加密码     | [点我](https://github.com/MikeCoder/hexo-blog-encrypt/blob/master/ReadMe.zh.md) |\n|                       卜算子ip计数统计                       |      IP计数统计       |        [点我](https://www.jianshu.com/p/8a8f880f40c0)        |\n|             npm install leancloud-storage --save             |      Valine评论       |      [点我](https://valine.js.org/quickstart.html#npm)       |\n|                      Valine评论邮件通知                      |    Valine评论提醒     |       [点我](http://www.zhaojun.im/hexo-valine-admin/)       |\n\n> 有需要的却找不到的，或者有优化方面的问题，都可以在下方留言，博主都会帮你解答","source":"_posts/hexo博客常用插件及教程.md","raw":"---\ntitle: hexo博客常用插件及教程\ndate: 2018-07-31 20:29:38\ncomments: true\ntags: [hexo插件,hexo博客,hexo教程] #文章标签\ncategories: hexo #文章分类\ntoc: false\ntop: true\nyuanchuang: true\n---\n> 为大家总结下hexo常用的插件与教程\n>\n> 合理的使用插件能够提高hexo的效率\n\n<!--more-->\n\n|                             命令                             |         功能          |                             文档                             |\n| :----------------------------------------------------------: | :-------------------: | :----------------------------------------------------------: |\n| npm install hexo-generator-index-pin-top --save<br />npm uninstall hexo-generator-index --save |     文章置顶插件      | [点我](https://blog.csdn.net/qwerty200696/article/details/79010629) |\n|                 npm i --save hexo-wordcount                  | 文章字数+阅读时长统计 | [点我](https://blog.csdn.net/ganzhilin520/article/details/79048036) |\n|           npm install hexo-baidu-url-submit --save           |   百度链接主动推送    | [点我](https://hui-wang.info/2016/10/23/Hexo%E6%8F%92%E4%BB%B6%E4%B9%8B%E7%99%BE%E5%BA%A6%E4%B8%BB%E5%8A%A8%E6%8F%90%E4%BA%A4%E9%93%BE%E6%8E%A5/) |\n|           npm install hexo-deployer-ftpsync --save           |  hexo上传至FTP服务器  |  [点我](https://hexo.io/zh-cn/docs/deployment.html#FTPSync)  |\n|             npm install hexo-deployer-cos --save             |  hexo上传至腾讯云COS  | [点我](https://github.com/sdlzhd/hexo-deployer-cos#user-content-options) |\n|           npm install hexo-deployer-aliyun --save            |   hexo上传至阿里云    |   [点我](https://github.com/yedaodao/hexo-deployer-aliyun)   |\n|                npm install --save hexo-admin                 |     hexo管理插件      |        [点我](https://github.com/jaredly/hexo-admin)         |\n|                 hexo-blog-encrypt(请看文档)                  |    hexo文章加密码     | [点我](https://github.com/MikeCoder/hexo-blog-encrypt/blob/master/ReadMe.zh.md) |\n|                       卜算子ip计数统计                       |      IP计数统计       |        [点我](https://www.jianshu.com/p/8a8f880f40c0)        |\n|             npm install leancloud-storage --save             |      Valine评论       |      [点我](https://valine.js.org/quickstart.html#npm)       |\n|                      Valine评论邮件通知                      |    Valine评论提醒     |       [点我](http://www.zhaojun.im/hexo-valine-admin/)       |\n\n> 有需要的却找不到的，或者有优化方面的问题，都可以在下方留言，博主都会帮你解答","slug":"hexo博客常用插件及教程","published":1,"updated":"2021-08-17T01:17:38.415Z","layout":"post","photos":[],"link":"","_id":"cku6979xw000q00uh5c6tciyz","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><blockquote>\n<p>为大家总结下hexo常用的插件与教程</p>\n<p>合理的使用插件能够提高hexo的效率</p>\n</blockquote>\n<span id=\"more\"></span>\n\n<table>\n<thead>\n<tr>\n<th align=\"center\">命令</th>\n<th align=\"center\">功能</th>\n<th align=\"center\">文档</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">npm install hexo-generator-index-pin-top –save<br />npm uninstall hexo-generator-index –save</td>\n<td align=\"center\">文章置顶插件</td>\n<td align=\"center\"><a href=\"https://blog.csdn.net/qwerty200696/article/details/79010629\">点我</a></td>\n</tr>\n<tr>\n<td align=\"center\">npm i –save hexo-wordcount</td>\n<td align=\"center\">文章字数+阅读时长统计</td>\n<td align=\"center\"><a href=\"https://blog.csdn.net/ganzhilin520/article/details/79048036\">点我</a></td>\n</tr>\n<tr>\n<td align=\"center\">npm install hexo-baidu-url-submit –save</td>\n<td align=\"center\">百度链接主动推送</td>\n<td align=\"center\"><a href=\"https://hui-wang.info/2016/10/23/Hexo%E6%8F%92%E4%BB%B6%E4%B9%8B%E7%99%BE%E5%BA%A6%E4%B8%BB%E5%8A%A8%E6%8F%90%E4%BA%A4%E9%93%BE%E6%8E%A5/\">点我</a></td>\n</tr>\n<tr>\n<td align=\"center\">npm install hexo-deployer-ftpsync –save</td>\n<td align=\"center\">hexo上传至FTP服务器</td>\n<td align=\"center\"><a href=\"https://hexo.io/zh-cn/docs/deployment.html#FTPSync\">点我</a></td>\n</tr>\n<tr>\n<td align=\"center\">npm install hexo-deployer-cos –save</td>\n<td align=\"center\">hexo上传至腾讯云COS</td>\n<td align=\"center\"><a href=\"https://github.com/sdlzhd/hexo-deployer-cos#user-content-options\">点我</a></td>\n</tr>\n<tr>\n<td align=\"center\">npm install hexo-deployer-aliyun –save</td>\n<td align=\"center\">hexo上传至阿里云</td>\n<td align=\"center\"><a href=\"https://github.com/yedaodao/hexo-deployer-aliyun\">点我</a></td>\n</tr>\n<tr>\n<td align=\"center\">npm install –save hexo-admin</td>\n<td align=\"center\">hexo管理插件</td>\n<td align=\"center\"><a href=\"https://github.com/jaredly/hexo-admin\">点我</a></td>\n</tr>\n<tr>\n<td align=\"center\">hexo-blog-encrypt(请看文档)</td>\n<td align=\"center\">hexo文章加密码</td>\n<td align=\"center\"><a href=\"https://github.com/MikeCoder/hexo-blog-encrypt/blob/master/ReadMe.zh.md\">点我</a></td>\n</tr>\n<tr>\n<td align=\"center\">卜算子ip计数统计</td>\n<td align=\"center\">IP计数统计</td>\n<td align=\"center\"><a href=\"https://www.jianshu.com/p/8a8f880f40c0\">点我</a></td>\n</tr>\n<tr>\n<td align=\"center\">npm install leancloud-storage –save</td>\n<td align=\"center\">Valine评论</td>\n<td align=\"center\"><a href=\"https://valine.js.org/quickstart.html#npm\">点我</a></td>\n</tr>\n<tr>\n<td align=\"center\">Valine评论邮件通知</td>\n<td align=\"center\">Valine评论提醒</td>\n<td align=\"center\"><a href=\"http://www.zhaojun.im/hexo-valine-admin/\">点我</a></td>\n</tr>\n</tbody></table>\n<blockquote>\n<p>有需要的却找不到的，或者有优化方面的问题，都可以在下方留言，博主都会帮你解答</p>\n</blockquote>\n","site":{"data":{}},"excerpt":"<blockquote>\n<p>为大家总结下hexo常用的插件与教程</p>\n<p>合理的使用插件能够提高hexo的效率</p>\n</blockquote>","more":"<table>\n<thead>\n<tr>\n<th align=\"center\">命令</th>\n<th align=\"center\">功能</th>\n<th align=\"center\">文档</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">npm install hexo-generator-index-pin-top –save<br />npm uninstall hexo-generator-index –save</td>\n<td align=\"center\">文章置顶插件</td>\n<td align=\"center\"><a href=\"https://blog.csdn.net/qwerty200696/article/details/79010629\">点我</a></td>\n</tr>\n<tr>\n<td align=\"center\">npm i –save hexo-wordcount</td>\n<td align=\"center\">文章字数+阅读时长统计</td>\n<td align=\"center\"><a href=\"https://blog.csdn.net/ganzhilin520/article/details/79048036\">点我</a></td>\n</tr>\n<tr>\n<td align=\"center\">npm install hexo-baidu-url-submit –save</td>\n<td align=\"center\">百度链接主动推送</td>\n<td align=\"center\"><a href=\"https://hui-wang.info/2016/10/23/Hexo%E6%8F%92%E4%BB%B6%E4%B9%8B%E7%99%BE%E5%BA%A6%E4%B8%BB%E5%8A%A8%E6%8F%90%E4%BA%A4%E9%93%BE%E6%8E%A5/\">点我</a></td>\n</tr>\n<tr>\n<td align=\"center\">npm install hexo-deployer-ftpsync –save</td>\n<td align=\"center\">hexo上传至FTP服务器</td>\n<td align=\"center\"><a href=\"https://hexo.io/zh-cn/docs/deployment.html#FTPSync\">点我</a></td>\n</tr>\n<tr>\n<td align=\"center\">npm install hexo-deployer-cos –save</td>\n<td align=\"center\">hexo上传至腾讯云COS</td>\n<td align=\"center\"><a href=\"https://github.com/sdlzhd/hexo-deployer-cos#user-content-options\">点我</a></td>\n</tr>\n<tr>\n<td align=\"center\">npm install hexo-deployer-aliyun –save</td>\n<td align=\"center\">hexo上传至阿里云</td>\n<td align=\"center\"><a href=\"https://github.com/yedaodao/hexo-deployer-aliyun\">点我</a></td>\n</tr>\n<tr>\n<td align=\"center\">npm install –save hexo-admin</td>\n<td align=\"center\">hexo管理插件</td>\n<td align=\"center\"><a href=\"https://github.com/jaredly/hexo-admin\">点我</a></td>\n</tr>\n<tr>\n<td align=\"center\">hexo-blog-encrypt(请看文档)</td>\n<td align=\"center\">hexo文章加密码</td>\n<td align=\"center\"><a href=\"https://github.com/MikeCoder/hexo-blog-encrypt/blob/master/ReadMe.zh.md\">点我</a></td>\n</tr>\n<tr>\n<td align=\"center\">卜算子ip计数统计</td>\n<td align=\"center\">IP计数统计</td>\n<td align=\"center\"><a href=\"https://www.jianshu.com/p/8a8f880f40c0\">点我</a></td>\n</tr>\n<tr>\n<td align=\"center\">npm install leancloud-storage –save</td>\n<td align=\"center\">Valine评论</td>\n<td align=\"center\"><a href=\"https://valine.js.org/quickstart.html#npm\">点我</a></td>\n</tr>\n<tr>\n<td align=\"center\">Valine评论邮件通知</td>\n<td align=\"center\">Valine评论提醒</td>\n<td align=\"center\"><a href=\"http://www.zhaojun.im/hexo-valine-admin/\">点我</a></td>\n</tr>\n</tbody></table>\n<blockquote>\n<p>有需要的却找不到的，或者有优化方面的问题，都可以在下方留言，博主都会帮你解答</p>\n</blockquote>"},{"title":"kafka 安装","date":"2019-12-13T06:00:00.000Z","_content":"## 环境准备\n\n- 安装 jdk\n- 安装 Zookeeper\n- kafaka安装包 http://kafka.apache.org/downloads.html\n\n### 修改host 文件\n\n`vim /etc/hots`\n\n```\n192.168.1.12 node1\n192.168.1.12 node2\n192.168.1.12 node3\n```\n\n### 下载安装包\n\n```\nwget \"http://mirrors.shu.edu.cn/apache/kafka/1.1.0/kafka_2.12-1.1.0.tgz\"\ntar -xzvf kafka_2.11-1.1.0.tgz\nmv kafka_2.11-1.1.0 /mnt/\n```\n### 配置环境变量\n\n将 `kafka_2.11-1.1.0/bin` 添加到`path`，以方便访问\n```\nvi /etc/profile\n```\n在末尾添加：\n```\nKAFKA_HOME=/mnt/kafka_2.11-1.1.0\nPATH=$PATH:$KAFKA_HOME/bin\n```\n\n<hr>\n\n## 单机模式\n\n### 启动单机模式\n\n### 修改配置文件\n```\ncd /mnt/kafka_2.11-1.1.0/config\nvi server.properties\n```\n修改配置文件中的以下内容：\n```\nbroker.id=1  \nport=9091\nhost.name=192.168.1.12\nnum.network.threads=3\nnum.io.threads=8\nsocket.send.buffer.bytes=102400\nsocket.receive.buffer.bytes=102400\nsocket.request.max.bytes=104857600\nlog.dirs=/mnt/kafka/kafka01/\nnum.partitions=1\nnum.recovery.threads.per.data.dir=1\nlog.retention.hours=168\nlog.segment.bytes=1073741824\nlog.retention.check.interval.ms=300000\nlog.cleaner.enable=false\nzookeeper.connect=192.168.1.12:2181,192.168.1.12:2182,192.168.1.12:2183\nzookeeper.connection.timeout.ms=6000\n```\n### 启动程序\n先要确保zookeeper已启动，然后在Kafka目录执行\n```\nnohup bin/kafka-server-start.sh config/server.properties &\n```\n如果无报错则说明启动成功。nohup &  是实现在后台启动。\n\n### 简单测试\n打开2个终端，分别在Kafka目录执行以下命令 \n启动producer\n```\nbin/kafka-console-producer.sh --broker-list localhost:9092 --topic test\n```\n### 启动consumer\n```\nbin/kafka-console-consumer.sh --zookeeper localhost:2181 --topic test --from-beginning\n```\n在producer的命令行输入任意字符，观察consumer是否能正确接收。\n\n## 常见错误\n###  启动Kafka时出现\n```\nJava HotSpot(TM) Server VM warning: INFO: os::commit_memory(0x67e00000, 1073741824, 0) failed; error='Cannot allocate memory' (errno=12)\n#\n# There is insufficient memory for the Java Runtime Environment to continue.\n# Native memory allocation (mmap) failed to map 1073741824 bytes for committing reserved memory.\n# An error report file with more information is saved as:\n# /opt/kafka_2.11-0.9.0.1/hs_err_pid2249.log\n```\n### 错误原因： \nKafka默认使用 `-Xmx1G -Xms1G` 的JVM内存配置，如果机器内存较小，需要调整启动配置。 \n打开 `/config/kafka-server-start.sh` ，修改 \n```\nexport KAFKA_HEAP_OPTS=\"-Xmx1G -Xms1G\" \n```\n为适合当前服务器的配置，例如\n```\nexport KAFKA_HEAP_OPTS=\"-Xmx256M -Xms128M\"\n```\n\n\n\n## 集群模式\n\n### 配置hosts\n\n### 准备缓存目录\n\n````\nmkdir -p /mnt/kafka/kafka0{1,2,3}\n````\n\n### 安装软件\n\n```\nls /usr/local/kafka/\nkafka01  kafka02  kafka03\n```\n\n### 修改kafka01 配置文件\n\n```\nvim /usr/local/kafka/kafka01/conf/server.properties\n\nbroker.id=1\nport=9091\nhost.name=192.168.1.12\nnum.network.threads=3\nnum.io.threads=8\nsocket.send.buffer.bytes=102400\nsocket.receive.buffer.bytes=102400\nsocket.request.max.bytes=104857600\nlog.dirs=/mnt/kafka/kafka01/\nnum.partitions=1\nnum.recovery.threads.per.data.dir=1\nlog.retention.hours=168\nlog.segment.bytes=1073741824\nlog.retention.check.interval.ms=300000\nlog.cleaner.enable=false\nzookeeper.connect=192.168.1.12:2181,192.168.1.12:2182,192.168.1.12:2183\nzookeeper.connection.timeout.ms=6000\n\n```\n\n### 修改kafka02 配置文件\n\n```\nvim /usr/local/kafka/kafka01/conf/server.properties\n\nbroker.id=2\nport=9092\nhost.name=192.168.1.12\nnum.network.threads=3\nnum.io.threads=8\nsocket.send.buffer.bytes=102400\nsocket.receive.buffer.bytes=102400\nsocket.request.max.bytes=104857600\nlog.dirs=/mnt/kafka/kafka02/\nnum.partitions=1\nnum.recovery.threads.per.data.dir=1\nlog.retention.hours=168\nlog.segment.bytes=1073741824\nlog.retention.check.interval.ms=300000\nlog.cleaner.enable=false\nzookeeper.connect=192.168.1.12:2181,192.168.1.12:2182,192.168.1.12:2183\nzookeeper.connection.timeout.ms=6000\n\n```\n\n\n\n### 修改kafka03 配置文件\n\n```\nvim /usr/local/kafka/kafka03/conf/server.properties\n\nbroker.id=3\nport=9093\nhost.name=192.168.1.12\nnum.network.threads=3\nnum.io.threads=8\nsocket.send.buffer.bytes=102400\nsocket.receive.buffer.bytes=102400\nsocket.request.max.bytes=104857600\nlog.dirs=/mnt/kafka/kafka03/\nnum.partitions=1\nnum.recovery.threads.per.data.dir=1\nlog.retention.hours=168\nlog.segment.bytes=1073741824\nlog.retention.check.interval.ms=300000\nlog.cleaner.enable=false\nzookeeper.connect=192.168.1.12:2181,192.168.1.12:2182,192.168.1.12:2183\nzookeeper.connection.timeout.ms=6000\n\n```\n\n\n\n### 启动kafka\n\n先要确保zookeeper已启动，然后在启动Kafka\n\n```\nnohup /usr/local/kafka/kafka01/bin/kafka-server-start.sh /usr/local/kafka/kafka01/config/server.properties > /var/log/kafka01.out 2>&1 &\nnohup /usr/local/kafka/kafka02/bin/kafka-server-start.sh /usr/local/kafka/kafka02/config/server.properties > /var/log/kafka02.out 2>&1 &\nnohup /usr/local/kafka/kafka03/bin/kafka-server-start.sh /usr/local/kafka/kafka03/config/server.properties > /var/log/kafka03.out 2>&1 &\n```\n\n查看kafka进程\n\n```\njps\n\n14343 Kafka\n14345 Kafka\n16941 Jps\n14350 Kafka\n```\n\n\n\n### 测试\n\n#### 创建 topic,3个分片，3个副本\n\n```\n/usr/local/kafka/kafka03/bin/kafka-topics.sh –create –zookeeper localhost:2181 –replication-factor 3 –partitions 3 –topic test_topic\n```\n\n#### 启动一个生产者\n\n```\n/usr/local/kafka/kafka03/bin/kafka-console-producer.sh –broker-list node1:9091,node2:9092,node3:9093 –topic test_topic \n```\n\n#### 启动一个消费者\n\n```\n/usr/local/kafka/kafka03/bin/kafka-console-consumer.sh –zookeeper localhost:2181 –topic test_topic \n```\n\n####zookeeper查看topic\n\n```\nbin/zkCli.sh -server 192.168.1.12:2182\n\n[zk: 192.168.1.12:2182(CONNECTED) 2] get /brokers/topics/test_topic\n{\"version\":1,\"partitions\":{\"2\":[3,1,2],\"1\":[2,3,1],\"0\":[1,2,3]}}\n```\n\n### 配置文件说明\n\n```\nbroker.id=1  #当前机器在集群中的唯一标识，和zookeeper的myid性质一样,\n\n每一个broker在集群中的唯一表示，要求是正数。当该服务器的IP地址发生改变时，broker.id没有变化，则不会影响consumers的消息情况\n\nport=9092  #当前kafka对外提供服务的端口默认是9092\n\nhost.name=192.168.1.172 #broker的主机地址，若是设置了，那么会绑定到这个地址上，若是没有，会绑定到所有的接口上，并将其中之一发送到ZK，一般不设置\n\nnum.network.threads=3 #broker处理消息的最大线程数，一般情况下数量为cpu核数\n\nnum.io.threads=8 #broker处理磁盘IO的线程数，数值为cpu核数2倍\n\nsocket.send.buffer.bytes=102400 #发送缓冲区buffer大小，数据不是一下子就发送的，先回存储到缓冲区了到达一定的大小后在发送，能提高性能\n\nsocket.receive.buffer.bytes=102400 #kafka接收缓冲区大小，当数据到达一定大小后在序列化到磁盘\n\nsocket.request.max.bytes=104857600 #这个参数是向kafka请求消息或者向kafka发送消息的请请求的最大数，这个值不能超过java的堆栈大小\n\nlog.dirs=/tmp/kafka-logs_1      #kafka数据的存放地址，多个地址的话用逗号分割,多个目录分布在不同磁盘上可以提高读写性能  /data/kafka-logs-1，/data/kafka-logs-2\n\nnum.partitions=3 #每个topic的分区个数，若是在topic创建时候没有指定的话会被topic创建时的指定参数覆盖\n\nnum.recovery.threads.per.data.dir=1 #用于在启动时,用于日志恢复的线程个数,默认是1.\n\nlog.retention.hours=168 #默认消息的最大持久化时间，168小时，7天\n\nlog.segment.bytes=1073741824    #topic的分区是以一堆segment文件存储的，这个控制每个segment的大小，会被topic创建时的指定参数覆盖\n\nlog.retention.check.interval.ms=300000 #每隔300000毫秒去检查上面配置的log失效时间（log.retention.hours=168 ），到目录查看是否有过期的消息如果有，删除\n\nzookeeper.connect=localhost:2181,localhost:2182,localhost:2183\n\nzookeeper.connection.timeout.ms=6000 #ZooKeeper的连接超时时间\n\n```\n\n### supervisor管理kafka\n\n`vim bin/kafka-run-class.sh`   在最上面增加环境路径\n\n```\nJAVA_HOME=/usr/local/java\nexport JAVA_HOME\n```\n\n`vim /etc/supervisor/kafka.conf`\n\n```\n[program:kafka]\ncommand=/usr/local/kafka/kafka01/bin/kafka-server-start.sh /usr/local/kafka/kafka01/config/server.properties\nuser=root\nautostart=true\nautorestart=true\nstartsecs=10\nstdout_logfile=/var/log/kafka.log\nstdout_logfile_maxbytes=1MB\nstdout_logfile_backups=10\nstdout_capture_maxbytes=1MB\nstderr_logfile=/var/log/kafka.log\nstderr_logfile_maxbytes=1MB\nstderr_logfile_backups=10\nstderr_capture_maxbytes=1MB\n```","source":"_posts/kafaka安装.md","raw":"---\ntitle: kafka 安装\ndate: 2019-12-13 14:00:00\ncategories: \n- bigdata\ntags:\n- kafka\n---\n## 环境准备\n\n- 安装 jdk\n- 安装 Zookeeper\n- kafaka安装包 http://kafka.apache.org/downloads.html\n\n### 修改host 文件\n\n`vim /etc/hots`\n\n```\n192.168.1.12 node1\n192.168.1.12 node2\n192.168.1.12 node3\n```\n\n### 下载安装包\n\n```\nwget \"http://mirrors.shu.edu.cn/apache/kafka/1.1.0/kafka_2.12-1.1.0.tgz\"\ntar -xzvf kafka_2.11-1.1.0.tgz\nmv kafka_2.11-1.1.0 /mnt/\n```\n### 配置环境变量\n\n将 `kafka_2.11-1.1.0/bin` 添加到`path`，以方便访问\n```\nvi /etc/profile\n```\n在末尾添加：\n```\nKAFKA_HOME=/mnt/kafka_2.11-1.1.0\nPATH=$PATH:$KAFKA_HOME/bin\n```\n\n<hr>\n\n## 单机模式\n\n### 启动单机模式\n\n### 修改配置文件\n```\ncd /mnt/kafka_2.11-1.1.0/config\nvi server.properties\n```\n修改配置文件中的以下内容：\n```\nbroker.id=1  \nport=9091\nhost.name=192.168.1.12\nnum.network.threads=3\nnum.io.threads=8\nsocket.send.buffer.bytes=102400\nsocket.receive.buffer.bytes=102400\nsocket.request.max.bytes=104857600\nlog.dirs=/mnt/kafka/kafka01/\nnum.partitions=1\nnum.recovery.threads.per.data.dir=1\nlog.retention.hours=168\nlog.segment.bytes=1073741824\nlog.retention.check.interval.ms=300000\nlog.cleaner.enable=false\nzookeeper.connect=192.168.1.12:2181,192.168.1.12:2182,192.168.1.12:2183\nzookeeper.connection.timeout.ms=6000\n```\n### 启动程序\n先要确保zookeeper已启动，然后在Kafka目录执行\n```\nnohup bin/kafka-server-start.sh config/server.properties &\n```\n如果无报错则说明启动成功。nohup &  是实现在后台启动。\n\n### 简单测试\n打开2个终端，分别在Kafka目录执行以下命令 \n启动producer\n```\nbin/kafka-console-producer.sh --broker-list localhost:9092 --topic test\n```\n### 启动consumer\n```\nbin/kafka-console-consumer.sh --zookeeper localhost:2181 --topic test --from-beginning\n```\n在producer的命令行输入任意字符，观察consumer是否能正确接收。\n\n## 常见错误\n###  启动Kafka时出现\n```\nJava HotSpot(TM) Server VM warning: INFO: os::commit_memory(0x67e00000, 1073741824, 0) failed; error='Cannot allocate memory' (errno=12)\n#\n# There is insufficient memory for the Java Runtime Environment to continue.\n# Native memory allocation (mmap) failed to map 1073741824 bytes for committing reserved memory.\n# An error report file with more information is saved as:\n# /opt/kafka_2.11-0.9.0.1/hs_err_pid2249.log\n```\n### 错误原因： \nKafka默认使用 `-Xmx1G -Xms1G` 的JVM内存配置，如果机器内存较小，需要调整启动配置。 \n打开 `/config/kafka-server-start.sh` ，修改 \n```\nexport KAFKA_HEAP_OPTS=\"-Xmx1G -Xms1G\" \n```\n为适合当前服务器的配置，例如\n```\nexport KAFKA_HEAP_OPTS=\"-Xmx256M -Xms128M\"\n```\n\n\n\n## 集群模式\n\n### 配置hosts\n\n### 准备缓存目录\n\n````\nmkdir -p /mnt/kafka/kafka0{1,2,3}\n````\n\n### 安装软件\n\n```\nls /usr/local/kafka/\nkafka01  kafka02  kafka03\n```\n\n### 修改kafka01 配置文件\n\n```\nvim /usr/local/kafka/kafka01/conf/server.properties\n\nbroker.id=1\nport=9091\nhost.name=192.168.1.12\nnum.network.threads=3\nnum.io.threads=8\nsocket.send.buffer.bytes=102400\nsocket.receive.buffer.bytes=102400\nsocket.request.max.bytes=104857600\nlog.dirs=/mnt/kafka/kafka01/\nnum.partitions=1\nnum.recovery.threads.per.data.dir=1\nlog.retention.hours=168\nlog.segment.bytes=1073741824\nlog.retention.check.interval.ms=300000\nlog.cleaner.enable=false\nzookeeper.connect=192.168.1.12:2181,192.168.1.12:2182,192.168.1.12:2183\nzookeeper.connection.timeout.ms=6000\n\n```\n\n### 修改kafka02 配置文件\n\n```\nvim /usr/local/kafka/kafka01/conf/server.properties\n\nbroker.id=2\nport=9092\nhost.name=192.168.1.12\nnum.network.threads=3\nnum.io.threads=8\nsocket.send.buffer.bytes=102400\nsocket.receive.buffer.bytes=102400\nsocket.request.max.bytes=104857600\nlog.dirs=/mnt/kafka/kafka02/\nnum.partitions=1\nnum.recovery.threads.per.data.dir=1\nlog.retention.hours=168\nlog.segment.bytes=1073741824\nlog.retention.check.interval.ms=300000\nlog.cleaner.enable=false\nzookeeper.connect=192.168.1.12:2181,192.168.1.12:2182,192.168.1.12:2183\nzookeeper.connection.timeout.ms=6000\n\n```\n\n\n\n### 修改kafka03 配置文件\n\n```\nvim /usr/local/kafka/kafka03/conf/server.properties\n\nbroker.id=3\nport=9093\nhost.name=192.168.1.12\nnum.network.threads=3\nnum.io.threads=8\nsocket.send.buffer.bytes=102400\nsocket.receive.buffer.bytes=102400\nsocket.request.max.bytes=104857600\nlog.dirs=/mnt/kafka/kafka03/\nnum.partitions=1\nnum.recovery.threads.per.data.dir=1\nlog.retention.hours=168\nlog.segment.bytes=1073741824\nlog.retention.check.interval.ms=300000\nlog.cleaner.enable=false\nzookeeper.connect=192.168.1.12:2181,192.168.1.12:2182,192.168.1.12:2183\nzookeeper.connection.timeout.ms=6000\n\n```\n\n\n\n### 启动kafka\n\n先要确保zookeeper已启动，然后在启动Kafka\n\n```\nnohup /usr/local/kafka/kafka01/bin/kafka-server-start.sh /usr/local/kafka/kafka01/config/server.properties > /var/log/kafka01.out 2>&1 &\nnohup /usr/local/kafka/kafka02/bin/kafka-server-start.sh /usr/local/kafka/kafka02/config/server.properties > /var/log/kafka02.out 2>&1 &\nnohup /usr/local/kafka/kafka03/bin/kafka-server-start.sh /usr/local/kafka/kafka03/config/server.properties > /var/log/kafka03.out 2>&1 &\n```\n\n查看kafka进程\n\n```\njps\n\n14343 Kafka\n14345 Kafka\n16941 Jps\n14350 Kafka\n```\n\n\n\n### 测试\n\n#### 创建 topic,3个分片，3个副本\n\n```\n/usr/local/kafka/kafka03/bin/kafka-topics.sh –create –zookeeper localhost:2181 –replication-factor 3 –partitions 3 –topic test_topic\n```\n\n#### 启动一个生产者\n\n```\n/usr/local/kafka/kafka03/bin/kafka-console-producer.sh –broker-list node1:9091,node2:9092,node3:9093 –topic test_topic \n```\n\n#### 启动一个消费者\n\n```\n/usr/local/kafka/kafka03/bin/kafka-console-consumer.sh –zookeeper localhost:2181 –topic test_topic \n```\n\n####zookeeper查看topic\n\n```\nbin/zkCli.sh -server 192.168.1.12:2182\n\n[zk: 192.168.1.12:2182(CONNECTED) 2] get /brokers/topics/test_topic\n{\"version\":1,\"partitions\":{\"2\":[3,1,2],\"1\":[2,3,1],\"0\":[1,2,3]}}\n```\n\n### 配置文件说明\n\n```\nbroker.id=1  #当前机器在集群中的唯一标识，和zookeeper的myid性质一样,\n\n每一个broker在集群中的唯一表示，要求是正数。当该服务器的IP地址发生改变时，broker.id没有变化，则不会影响consumers的消息情况\n\nport=9092  #当前kafka对外提供服务的端口默认是9092\n\nhost.name=192.168.1.172 #broker的主机地址，若是设置了，那么会绑定到这个地址上，若是没有，会绑定到所有的接口上，并将其中之一发送到ZK，一般不设置\n\nnum.network.threads=3 #broker处理消息的最大线程数，一般情况下数量为cpu核数\n\nnum.io.threads=8 #broker处理磁盘IO的线程数，数值为cpu核数2倍\n\nsocket.send.buffer.bytes=102400 #发送缓冲区buffer大小，数据不是一下子就发送的，先回存储到缓冲区了到达一定的大小后在发送，能提高性能\n\nsocket.receive.buffer.bytes=102400 #kafka接收缓冲区大小，当数据到达一定大小后在序列化到磁盘\n\nsocket.request.max.bytes=104857600 #这个参数是向kafka请求消息或者向kafka发送消息的请请求的最大数，这个值不能超过java的堆栈大小\n\nlog.dirs=/tmp/kafka-logs_1      #kafka数据的存放地址，多个地址的话用逗号分割,多个目录分布在不同磁盘上可以提高读写性能  /data/kafka-logs-1，/data/kafka-logs-2\n\nnum.partitions=3 #每个topic的分区个数，若是在topic创建时候没有指定的话会被topic创建时的指定参数覆盖\n\nnum.recovery.threads.per.data.dir=1 #用于在启动时,用于日志恢复的线程个数,默认是1.\n\nlog.retention.hours=168 #默认消息的最大持久化时间，168小时，7天\n\nlog.segment.bytes=1073741824    #topic的分区是以一堆segment文件存储的，这个控制每个segment的大小，会被topic创建时的指定参数覆盖\n\nlog.retention.check.interval.ms=300000 #每隔300000毫秒去检查上面配置的log失效时间（log.retention.hours=168 ），到目录查看是否有过期的消息如果有，删除\n\nzookeeper.connect=localhost:2181,localhost:2182,localhost:2183\n\nzookeeper.connection.timeout.ms=6000 #ZooKeeper的连接超时时间\n\n```\n\n### supervisor管理kafka\n\n`vim bin/kafka-run-class.sh`   在最上面增加环境路径\n\n```\nJAVA_HOME=/usr/local/java\nexport JAVA_HOME\n```\n\n`vim /etc/supervisor/kafka.conf`\n\n```\n[program:kafka]\ncommand=/usr/local/kafka/kafka01/bin/kafka-server-start.sh /usr/local/kafka/kafka01/config/server.properties\nuser=root\nautostart=true\nautorestart=true\nstartsecs=10\nstdout_logfile=/var/log/kafka.log\nstdout_logfile_maxbytes=1MB\nstdout_logfile_backups=10\nstdout_capture_maxbytes=1MB\nstderr_logfile=/var/log/kafka.log\nstderr_logfile_maxbytes=1MB\nstderr_logfile_backups=10\nstderr_capture_maxbytes=1MB\n```","slug":"kafaka安装","published":1,"updated":"2021-07-24T07:31:06.310Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cku6979xy000r00uh57ofdywp","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><h2 id=\"环境准备\"><a href=\"#环境准备\" class=\"headerlink\" title=\"环境准备\"></a>环境准备</h2><ul>\n<li>安装 jdk</li>\n<li>安装 Zookeeper</li>\n<li>kafaka安装包 <a href=\"http://kafka.apache.org/downloads.html\">http://kafka.apache.org/downloads.html</a></li>\n</ul>\n<h3 id=\"修改host-文件\"><a href=\"#修改host-文件\" class=\"headerlink\" title=\"修改host 文件\"></a>修改host 文件</h3><p><code>vim /etc/hots</code></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">192.168.1.12 node1</span><br><span class=\"line\">192.168.1.12 node2</span><br><span class=\"line\">192.168.1.12 node3</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"下载安装包\"><a href=\"#下载安装包\" class=\"headerlink\" title=\"下载安装包\"></a>下载安装包</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget &quot;http:&#x2F;&#x2F;mirrors.shu.edu.cn&#x2F;apache&#x2F;kafka&#x2F;1.1.0&#x2F;kafka_2.12-1.1.0.tgz&quot;</span><br><span class=\"line\">tar -xzvf kafka_2.11-1.1.0.tgz</span><br><span class=\"line\">mv kafka_2.11-1.1.0 &#x2F;mnt&#x2F;</span><br></pre></td></tr></table></figure>\n<h3 id=\"配置环境变量\"><a href=\"#配置环境变量\" class=\"headerlink\" title=\"配置环境变量\"></a>配置环境变量</h3><p>将 <code>kafka_2.11-1.1.0/bin</code> 添加到<code>path</code>，以方便访问</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vi &#x2F;etc&#x2F;profile</span><br></pre></td></tr></table></figure>\n<p>在末尾添加：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">KAFKA_HOME&#x3D;&#x2F;mnt&#x2F;kafka_2.11-1.1.0</span><br><span class=\"line\">PATH&#x3D;$PATH:$KAFKA_HOME&#x2F;bin</span><br></pre></td></tr></table></figure>\n\n<hr>\n\n<h2 id=\"单机模式\"><a href=\"#单机模式\" class=\"headerlink\" title=\"单机模式\"></a>单机模式</h2><h3 id=\"启动单机模式\"><a href=\"#启动单机模式\" class=\"headerlink\" title=\"启动单机模式\"></a>启动单机模式</h3><h3 id=\"修改配置文件\"><a href=\"#修改配置文件\" class=\"headerlink\" title=\"修改配置文件\"></a>修改配置文件</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd &#x2F;mnt&#x2F;kafka_2.11-1.1.0&#x2F;config</span><br><span class=\"line\">vi server.properties</span><br></pre></td></tr></table></figure>\n<p>修改配置文件中的以下内容：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">broker.id&#x3D;1  </span><br><span class=\"line\">port&#x3D;9091</span><br><span class=\"line\">host.name&#x3D;192.168.1.12</span><br><span class=\"line\">num.network.threads&#x3D;3</span><br><span class=\"line\">num.io.threads&#x3D;8</span><br><span class=\"line\">socket.send.buffer.bytes&#x3D;102400</span><br><span class=\"line\">socket.receive.buffer.bytes&#x3D;102400</span><br><span class=\"line\">socket.request.max.bytes&#x3D;104857600</span><br><span class=\"line\">log.dirs&#x3D;&#x2F;mnt&#x2F;kafka&#x2F;kafka01&#x2F;</span><br><span class=\"line\">num.partitions&#x3D;1</span><br><span class=\"line\">num.recovery.threads.per.data.dir&#x3D;1</span><br><span class=\"line\">log.retention.hours&#x3D;168</span><br><span class=\"line\">log.segment.bytes&#x3D;1073741824</span><br><span class=\"line\">log.retention.check.interval.ms&#x3D;300000</span><br><span class=\"line\">log.cleaner.enable&#x3D;false</span><br><span class=\"line\">zookeeper.connect&#x3D;192.168.1.12:2181,192.168.1.12:2182,192.168.1.12:2183</span><br><span class=\"line\">zookeeper.connection.timeout.ms&#x3D;6000</span><br></pre></td></tr></table></figure>\n<h3 id=\"启动程序\"><a href=\"#启动程序\" class=\"headerlink\" title=\"启动程序\"></a>启动程序</h3><p>先要确保zookeeper已启动，然后在Kafka目录执行</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nohup bin&#x2F;kafka-server-start.sh config&#x2F;server.properties &amp;</span><br></pre></td></tr></table></figure>\n<p>如果无报错则说明启动成功。nohup &amp;  是实现在后台启动。</p>\n<h3 id=\"简单测试\"><a href=\"#简单测试\" class=\"headerlink\" title=\"简单测试\"></a>简单测试</h3><p>打开2个终端，分别在Kafka目录执行以下命令<br>启动producer</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">bin&#x2F;kafka-console-producer.sh --broker-list localhost:9092 --topic test</span><br></pre></td></tr></table></figure>\n<h3 id=\"启动consumer\"><a href=\"#启动consumer\" class=\"headerlink\" title=\"启动consumer\"></a>启动consumer</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">bin&#x2F;kafka-console-consumer.sh --zookeeper localhost:2181 --topic test --from-beginning</span><br></pre></td></tr></table></figure>\n<p>在producer的命令行输入任意字符，观察consumer是否能正确接收。</p>\n<h2 id=\"常见错误\"><a href=\"#常见错误\" class=\"headerlink\" title=\"常见错误\"></a>常见错误</h2><h3 id=\"启动Kafka时出现\"><a href=\"#启动Kafka时出现\" class=\"headerlink\" title=\"启动Kafka时出现\"></a>启动Kafka时出现</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Java HotSpot(TM) Server VM warning: INFO: os::commit_memory(0x67e00000, 1073741824, 0) failed; error&#x3D;&#39;Cannot allocate memory&#39; (errno&#x3D;12)</span><br><span class=\"line\">#</span><br><span class=\"line\"># There is insufficient memory for the Java Runtime Environment to continue.</span><br><span class=\"line\"># Native memory allocation (mmap) failed to map 1073741824 bytes for committing reserved memory.</span><br><span class=\"line\"># An error report file with more information is saved as:</span><br><span class=\"line\"># &#x2F;opt&#x2F;kafka_2.11-0.9.0.1&#x2F;hs_err_pid2249.log</span><br></pre></td></tr></table></figure>\n<h3 id=\"错误原因：\"><a href=\"#错误原因：\" class=\"headerlink\" title=\"错误原因：\"></a>错误原因：</h3><p>Kafka默认使用 <code>-Xmx1G -Xms1G</code> 的JVM内存配置，如果机器内存较小，需要调整启动配置。<br>打开 <code>/config/kafka-server-start.sh</code> ，修改 </p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">export KAFKA_HEAP_OPTS&#x3D;&quot;-Xmx1G -Xms1G&quot; </span><br></pre></td></tr></table></figure>\n<p>为适合当前服务器的配置，例如</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">export KAFKA_HEAP_OPTS&#x3D;&quot;-Xmx256M -Xms128M&quot;</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"集群模式\"><a href=\"#集群模式\" class=\"headerlink\" title=\"集群模式\"></a>集群模式</h2><h3 id=\"配置hosts\"><a href=\"#配置hosts\" class=\"headerlink\" title=\"配置hosts\"></a>配置hosts</h3><h3 id=\"准备缓存目录\"><a href=\"#准备缓存目录\" class=\"headerlink\" title=\"准备缓存目录\"></a>准备缓存目录</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir -p &#x2F;mnt&#x2F;kafka&#x2F;kafka0&#123;1,2,3&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"安装软件\"><a href=\"#安装软件\" class=\"headerlink\" title=\"安装软件\"></a>安装软件</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ls &#x2F;usr&#x2F;local&#x2F;kafka&#x2F;</span><br><span class=\"line\">kafka01  kafka02  kafka03</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"修改kafka01-配置文件\"><a href=\"#修改kafka01-配置文件\" class=\"headerlink\" title=\"修改kafka01 配置文件\"></a>修改kafka01 配置文件</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim &#x2F;usr&#x2F;local&#x2F;kafka&#x2F;kafka01&#x2F;conf&#x2F;server.properties</span><br><span class=\"line\"></span><br><span class=\"line\">broker.id&#x3D;1</span><br><span class=\"line\">port&#x3D;9091</span><br><span class=\"line\">host.name&#x3D;192.168.1.12</span><br><span class=\"line\">num.network.threads&#x3D;3</span><br><span class=\"line\">num.io.threads&#x3D;8</span><br><span class=\"line\">socket.send.buffer.bytes&#x3D;102400</span><br><span class=\"line\">socket.receive.buffer.bytes&#x3D;102400</span><br><span class=\"line\">socket.request.max.bytes&#x3D;104857600</span><br><span class=\"line\">log.dirs&#x3D;&#x2F;mnt&#x2F;kafka&#x2F;kafka01&#x2F;</span><br><span class=\"line\">num.partitions&#x3D;1</span><br><span class=\"line\">num.recovery.threads.per.data.dir&#x3D;1</span><br><span class=\"line\">log.retention.hours&#x3D;168</span><br><span class=\"line\">log.segment.bytes&#x3D;1073741824</span><br><span class=\"line\">log.retention.check.interval.ms&#x3D;300000</span><br><span class=\"line\">log.cleaner.enable&#x3D;false</span><br><span class=\"line\">zookeeper.connect&#x3D;192.168.1.12:2181,192.168.1.12:2182,192.168.1.12:2183</span><br><span class=\"line\">zookeeper.connection.timeout.ms&#x3D;6000</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"修改kafka02-配置文件\"><a href=\"#修改kafka02-配置文件\" class=\"headerlink\" title=\"修改kafka02 配置文件\"></a>修改kafka02 配置文件</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim &#x2F;usr&#x2F;local&#x2F;kafka&#x2F;kafka01&#x2F;conf&#x2F;server.properties</span><br><span class=\"line\"></span><br><span class=\"line\">broker.id&#x3D;2</span><br><span class=\"line\">port&#x3D;9092</span><br><span class=\"line\">host.name&#x3D;192.168.1.12</span><br><span class=\"line\">num.network.threads&#x3D;3</span><br><span class=\"line\">num.io.threads&#x3D;8</span><br><span class=\"line\">socket.send.buffer.bytes&#x3D;102400</span><br><span class=\"line\">socket.receive.buffer.bytes&#x3D;102400</span><br><span class=\"line\">socket.request.max.bytes&#x3D;104857600</span><br><span class=\"line\">log.dirs&#x3D;&#x2F;mnt&#x2F;kafka&#x2F;kafka02&#x2F;</span><br><span class=\"line\">num.partitions&#x3D;1</span><br><span class=\"line\">num.recovery.threads.per.data.dir&#x3D;1</span><br><span class=\"line\">log.retention.hours&#x3D;168</span><br><span class=\"line\">log.segment.bytes&#x3D;1073741824</span><br><span class=\"line\">log.retention.check.interval.ms&#x3D;300000</span><br><span class=\"line\">log.cleaner.enable&#x3D;false</span><br><span class=\"line\">zookeeper.connect&#x3D;192.168.1.12:2181,192.168.1.12:2182,192.168.1.12:2183</span><br><span class=\"line\">zookeeper.connection.timeout.ms&#x3D;6000</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"修改kafka03-配置文件\"><a href=\"#修改kafka03-配置文件\" class=\"headerlink\" title=\"修改kafka03 配置文件\"></a>修改kafka03 配置文件</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim &#x2F;usr&#x2F;local&#x2F;kafka&#x2F;kafka03&#x2F;conf&#x2F;server.properties</span><br><span class=\"line\"></span><br><span class=\"line\">broker.id&#x3D;3</span><br><span class=\"line\">port&#x3D;9093</span><br><span class=\"line\">host.name&#x3D;192.168.1.12</span><br><span class=\"line\">num.network.threads&#x3D;3</span><br><span class=\"line\">num.io.threads&#x3D;8</span><br><span class=\"line\">socket.send.buffer.bytes&#x3D;102400</span><br><span class=\"line\">socket.receive.buffer.bytes&#x3D;102400</span><br><span class=\"line\">socket.request.max.bytes&#x3D;104857600</span><br><span class=\"line\">log.dirs&#x3D;&#x2F;mnt&#x2F;kafka&#x2F;kafka03&#x2F;</span><br><span class=\"line\">num.partitions&#x3D;1</span><br><span class=\"line\">num.recovery.threads.per.data.dir&#x3D;1</span><br><span class=\"line\">log.retention.hours&#x3D;168</span><br><span class=\"line\">log.segment.bytes&#x3D;1073741824</span><br><span class=\"line\">log.retention.check.interval.ms&#x3D;300000</span><br><span class=\"line\">log.cleaner.enable&#x3D;false</span><br><span class=\"line\">zookeeper.connect&#x3D;192.168.1.12:2181,192.168.1.12:2182,192.168.1.12:2183</span><br><span class=\"line\">zookeeper.connection.timeout.ms&#x3D;6000</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"启动kafka\"><a href=\"#启动kafka\" class=\"headerlink\" title=\"启动kafka\"></a>启动kafka</h3><p>先要确保zookeeper已启动，然后在启动Kafka</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nohup &#x2F;usr&#x2F;local&#x2F;kafka&#x2F;kafka01&#x2F;bin&#x2F;kafka-server-start.sh &#x2F;usr&#x2F;local&#x2F;kafka&#x2F;kafka01&#x2F;config&#x2F;server.properties &gt; &#x2F;var&#x2F;log&#x2F;kafka01.out 2&gt;&amp;1 &amp;</span><br><span class=\"line\">nohup &#x2F;usr&#x2F;local&#x2F;kafka&#x2F;kafka02&#x2F;bin&#x2F;kafka-server-start.sh &#x2F;usr&#x2F;local&#x2F;kafka&#x2F;kafka02&#x2F;config&#x2F;server.properties &gt; &#x2F;var&#x2F;log&#x2F;kafka02.out 2&gt;&amp;1 &amp;</span><br><span class=\"line\">nohup &#x2F;usr&#x2F;local&#x2F;kafka&#x2F;kafka03&#x2F;bin&#x2F;kafka-server-start.sh &#x2F;usr&#x2F;local&#x2F;kafka&#x2F;kafka03&#x2F;config&#x2F;server.properties &gt; &#x2F;var&#x2F;log&#x2F;kafka03.out 2&gt;&amp;1 &amp;</span><br></pre></td></tr></table></figure>\n\n<p>查看kafka进程</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">jps</span><br><span class=\"line\"></span><br><span class=\"line\">14343 Kafka</span><br><span class=\"line\">14345 Kafka</span><br><span class=\"line\">16941 Jps</span><br><span class=\"line\">14350 Kafka</span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"测试\"><a href=\"#测试\" class=\"headerlink\" title=\"测试\"></a>测试</h3><h4 id=\"创建-topic-3个分片，3个副本\"><a href=\"#创建-topic-3个分片，3个副本\" class=\"headerlink\" title=\"创建 topic,3个分片，3个副本\"></a>创建 topic,3个分片，3个副本</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;usr&#x2F;local&#x2F;kafka&#x2F;kafka03&#x2F;bin&#x2F;kafka-topics.sh –create –zookeeper localhost:2181 –replication-factor 3 –partitions 3 –topic test_topic</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"启动一个生产者\"><a href=\"#启动一个生产者\" class=\"headerlink\" title=\"启动一个生产者\"></a>启动一个生产者</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;usr&#x2F;local&#x2F;kafka&#x2F;kafka03&#x2F;bin&#x2F;kafka-console-producer.sh –broker-list node1:9091,node2:9092,node3:9093 –topic test_topic </span><br></pre></td></tr></table></figure>\n\n<h4 id=\"启动一个消费者\"><a href=\"#启动一个消费者\" class=\"headerlink\" title=\"启动一个消费者\"></a>启动一个消费者</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;usr&#x2F;local&#x2F;kafka&#x2F;kafka03&#x2F;bin&#x2F;kafka-console-consumer.sh –zookeeper localhost:2181 –topic test_topic </span><br></pre></td></tr></table></figure>\n\n<p>####zookeeper查看topic</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">bin&#x2F;zkCli.sh -server 192.168.1.12:2182</span><br><span class=\"line\"></span><br><span class=\"line\">[zk: 192.168.1.12:2182(CONNECTED) 2] get &#x2F;brokers&#x2F;topics&#x2F;test_topic</span><br><span class=\"line\">&#123;&quot;version&quot;:1,&quot;partitions&quot;:&#123;&quot;2&quot;:[3,1,2],&quot;1&quot;:[2,3,1],&quot;0&quot;:[1,2,3]&#125;&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"配置文件说明\"><a href=\"#配置文件说明\" class=\"headerlink\" title=\"配置文件说明\"></a>配置文件说明</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">broker.id&#x3D;1  #当前机器在集群中的唯一标识，和zookeeper的myid性质一样,</span><br><span class=\"line\"></span><br><span class=\"line\">每一个broker在集群中的唯一表示，要求是正数。当该服务器的IP地址发生改变时，broker.id没有变化，则不会影响consumers的消息情况</span><br><span class=\"line\"></span><br><span class=\"line\">port&#x3D;9092  #当前kafka对外提供服务的端口默认是9092</span><br><span class=\"line\"></span><br><span class=\"line\">host.name&#x3D;192.168.1.172 #broker的主机地址，若是设置了，那么会绑定到这个地址上，若是没有，会绑定到所有的接口上，并将其中之一发送到ZK，一般不设置</span><br><span class=\"line\"></span><br><span class=\"line\">num.network.threads&#x3D;3 #broker处理消息的最大线程数，一般情况下数量为cpu核数</span><br><span class=\"line\"></span><br><span class=\"line\">num.io.threads&#x3D;8 #broker处理磁盘IO的线程数，数值为cpu核数2倍</span><br><span class=\"line\"></span><br><span class=\"line\">socket.send.buffer.bytes&#x3D;102400 #发送缓冲区buffer大小，数据不是一下子就发送的，先回存储到缓冲区了到达一定的大小后在发送，能提高性能</span><br><span class=\"line\"></span><br><span class=\"line\">socket.receive.buffer.bytes&#x3D;102400 #kafka接收缓冲区大小，当数据到达一定大小后在序列化到磁盘</span><br><span class=\"line\"></span><br><span class=\"line\">socket.request.max.bytes&#x3D;104857600 #这个参数是向kafka请求消息或者向kafka发送消息的请请求的最大数，这个值不能超过java的堆栈大小</span><br><span class=\"line\"></span><br><span class=\"line\">log.dirs&#x3D;&#x2F;tmp&#x2F;kafka-logs_1      #kafka数据的存放地址，多个地址的话用逗号分割,多个目录分布在不同磁盘上可以提高读写性能  &#x2F;data&#x2F;kafka-logs-1，&#x2F;data&#x2F;kafka-logs-2</span><br><span class=\"line\"></span><br><span class=\"line\">num.partitions&#x3D;3 #每个topic的分区个数，若是在topic创建时候没有指定的话会被topic创建时的指定参数覆盖</span><br><span class=\"line\"></span><br><span class=\"line\">num.recovery.threads.per.data.dir&#x3D;1 #用于在启动时,用于日志恢复的线程个数,默认是1.</span><br><span class=\"line\"></span><br><span class=\"line\">log.retention.hours&#x3D;168 #默认消息的最大持久化时间，168小时，7天</span><br><span class=\"line\"></span><br><span class=\"line\">log.segment.bytes&#x3D;1073741824    #topic的分区是以一堆segment文件存储的，这个控制每个segment的大小，会被topic创建时的指定参数覆盖</span><br><span class=\"line\"></span><br><span class=\"line\">log.retention.check.interval.ms&#x3D;300000 #每隔300000毫秒去检查上面配置的log失效时间（log.retention.hours&#x3D;168 ），到目录查看是否有过期的消息如果有，删除</span><br><span class=\"line\"></span><br><span class=\"line\">zookeeper.connect&#x3D;localhost:2181,localhost:2182,localhost:2183</span><br><span class=\"line\"></span><br><span class=\"line\">zookeeper.connection.timeout.ms&#x3D;6000 #ZooKeeper的连接超时时间</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"supervisor管理kafka\"><a href=\"#supervisor管理kafka\" class=\"headerlink\" title=\"supervisor管理kafka\"></a>supervisor管理kafka</h3><p><code>vim bin/kafka-run-class.sh</code>   在最上面增加环境路径</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">JAVA_HOME&#x3D;&#x2F;usr&#x2F;local&#x2F;java</span><br><span class=\"line\">export JAVA_HOME</span><br></pre></td></tr></table></figure>\n\n<p><code>vim /etc/supervisor/kafka.conf</code></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[program:kafka]</span><br><span class=\"line\">command&#x3D;&#x2F;usr&#x2F;local&#x2F;kafka&#x2F;kafka01&#x2F;bin&#x2F;kafka-server-start.sh &#x2F;usr&#x2F;local&#x2F;kafka&#x2F;kafka01&#x2F;config&#x2F;server.properties</span><br><span class=\"line\">user&#x3D;root</span><br><span class=\"line\">autostart&#x3D;true</span><br><span class=\"line\">autorestart&#x3D;true</span><br><span class=\"line\">startsecs&#x3D;10</span><br><span class=\"line\">stdout_logfile&#x3D;&#x2F;var&#x2F;log&#x2F;kafka.log</span><br><span class=\"line\">stdout_logfile_maxbytes&#x3D;1MB</span><br><span class=\"line\">stdout_logfile_backups&#x3D;10</span><br><span class=\"line\">stdout_capture_maxbytes&#x3D;1MB</span><br><span class=\"line\">stderr_logfile&#x3D;&#x2F;var&#x2F;log&#x2F;kafka.log</span><br><span class=\"line\">stderr_logfile_maxbytes&#x3D;1MB</span><br><span class=\"line\">stderr_logfile_backups&#x3D;10</span><br><span class=\"line\">stderr_capture_maxbytes&#x3D;1MB</span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"","more":"<h2 id=\"环境准备\"><a href=\"#环境准备\" class=\"headerlink\" title=\"环境准备\"></a>环境准备</h2><ul>\n<li>安装 jdk</li>\n<li>安装 Zookeeper</li>\n<li>kafaka安装包 <a href=\"http://kafka.apache.org/downloads.html\">http://kafka.apache.org/downloads.html</a></li>\n</ul>\n<h3 id=\"修改host-文件\"><a href=\"#修改host-文件\" class=\"headerlink\" title=\"修改host 文件\"></a>修改host 文件</h3><p><code>vim /etc/hots</code></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">192.168.1.12 node1</span><br><span class=\"line\">192.168.1.12 node2</span><br><span class=\"line\">192.168.1.12 node3</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"下载安装包\"><a href=\"#下载安装包\" class=\"headerlink\" title=\"下载安装包\"></a>下载安装包</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget &quot;http:&#x2F;&#x2F;mirrors.shu.edu.cn&#x2F;apache&#x2F;kafka&#x2F;1.1.0&#x2F;kafka_2.12-1.1.0.tgz&quot;</span><br><span class=\"line\">tar -xzvf kafka_2.11-1.1.0.tgz</span><br><span class=\"line\">mv kafka_2.11-1.1.0 &#x2F;mnt&#x2F;</span><br></pre></td></tr></table></figure>\n<h3 id=\"配置环境变量\"><a href=\"#配置环境变量\" class=\"headerlink\" title=\"配置环境变量\"></a>配置环境变量</h3><p>将 <code>kafka_2.11-1.1.0/bin</code> 添加到<code>path</code>，以方便访问</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vi &#x2F;etc&#x2F;profile</span><br></pre></td></tr></table></figure>\n<p>在末尾添加：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">KAFKA_HOME&#x3D;&#x2F;mnt&#x2F;kafka_2.11-1.1.0</span><br><span class=\"line\">PATH&#x3D;$PATH:$KAFKA_HOME&#x2F;bin</span><br></pre></td></tr></table></figure>\n\n<hr>\n\n<h2 id=\"单机模式\"><a href=\"#单机模式\" class=\"headerlink\" title=\"单机模式\"></a>单机模式</h2><h3 id=\"启动单机模式\"><a href=\"#启动单机模式\" class=\"headerlink\" title=\"启动单机模式\"></a>启动单机模式</h3><h3 id=\"修改配置文件\"><a href=\"#修改配置文件\" class=\"headerlink\" title=\"修改配置文件\"></a>修改配置文件</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd &#x2F;mnt&#x2F;kafka_2.11-1.1.0&#x2F;config</span><br><span class=\"line\">vi server.properties</span><br></pre></td></tr></table></figure>\n<p>修改配置文件中的以下内容：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">broker.id&#x3D;1  </span><br><span class=\"line\">port&#x3D;9091</span><br><span class=\"line\">host.name&#x3D;192.168.1.12</span><br><span class=\"line\">num.network.threads&#x3D;3</span><br><span class=\"line\">num.io.threads&#x3D;8</span><br><span class=\"line\">socket.send.buffer.bytes&#x3D;102400</span><br><span class=\"line\">socket.receive.buffer.bytes&#x3D;102400</span><br><span class=\"line\">socket.request.max.bytes&#x3D;104857600</span><br><span class=\"line\">log.dirs&#x3D;&#x2F;mnt&#x2F;kafka&#x2F;kafka01&#x2F;</span><br><span class=\"line\">num.partitions&#x3D;1</span><br><span class=\"line\">num.recovery.threads.per.data.dir&#x3D;1</span><br><span class=\"line\">log.retention.hours&#x3D;168</span><br><span class=\"line\">log.segment.bytes&#x3D;1073741824</span><br><span class=\"line\">log.retention.check.interval.ms&#x3D;300000</span><br><span class=\"line\">log.cleaner.enable&#x3D;false</span><br><span class=\"line\">zookeeper.connect&#x3D;192.168.1.12:2181,192.168.1.12:2182,192.168.1.12:2183</span><br><span class=\"line\">zookeeper.connection.timeout.ms&#x3D;6000</span><br></pre></td></tr></table></figure>\n<h3 id=\"启动程序\"><a href=\"#启动程序\" class=\"headerlink\" title=\"启动程序\"></a>启动程序</h3><p>先要确保zookeeper已启动，然后在Kafka目录执行</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nohup bin&#x2F;kafka-server-start.sh config&#x2F;server.properties &amp;</span><br></pre></td></tr></table></figure>\n<p>如果无报错则说明启动成功。nohup &amp;  是实现在后台启动。</p>\n<h3 id=\"简单测试\"><a href=\"#简单测试\" class=\"headerlink\" title=\"简单测试\"></a>简单测试</h3><p>打开2个终端，分别在Kafka目录执行以下命令<br>启动producer</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">bin&#x2F;kafka-console-producer.sh --broker-list localhost:9092 --topic test</span><br></pre></td></tr></table></figure>\n<h3 id=\"启动consumer\"><a href=\"#启动consumer\" class=\"headerlink\" title=\"启动consumer\"></a>启动consumer</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">bin&#x2F;kafka-console-consumer.sh --zookeeper localhost:2181 --topic test --from-beginning</span><br></pre></td></tr></table></figure>\n<p>在producer的命令行输入任意字符，观察consumer是否能正确接收。</p>\n<h2 id=\"常见错误\"><a href=\"#常见错误\" class=\"headerlink\" title=\"常见错误\"></a>常见错误</h2><h3 id=\"启动Kafka时出现\"><a href=\"#启动Kafka时出现\" class=\"headerlink\" title=\"启动Kafka时出现\"></a>启动Kafka时出现</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Java HotSpot(TM) Server VM warning: INFO: os::commit_memory(0x67e00000, 1073741824, 0) failed; error&#x3D;&#39;Cannot allocate memory&#39; (errno&#x3D;12)</span><br><span class=\"line\">#</span><br><span class=\"line\"># There is insufficient memory for the Java Runtime Environment to continue.</span><br><span class=\"line\"># Native memory allocation (mmap) failed to map 1073741824 bytes for committing reserved memory.</span><br><span class=\"line\"># An error report file with more information is saved as:</span><br><span class=\"line\"># &#x2F;opt&#x2F;kafka_2.11-0.9.0.1&#x2F;hs_err_pid2249.log</span><br></pre></td></tr></table></figure>\n<h3 id=\"错误原因：\"><a href=\"#错误原因：\" class=\"headerlink\" title=\"错误原因：\"></a>错误原因：</h3><p>Kafka默认使用 <code>-Xmx1G -Xms1G</code> 的JVM内存配置，如果机器内存较小，需要调整启动配置。<br>打开 <code>/config/kafka-server-start.sh</code> ，修改 </p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">export KAFKA_HEAP_OPTS&#x3D;&quot;-Xmx1G -Xms1G&quot; </span><br></pre></td></tr></table></figure>\n<p>为适合当前服务器的配置，例如</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">export KAFKA_HEAP_OPTS&#x3D;&quot;-Xmx256M -Xms128M&quot;</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"集群模式\"><a href=\"#集群模式\" class=\"headerlink\" title=\"集群模式\"></a>集群模式</h2><h3 id=\"配置hosts\"><a href=\"#配置hosts\" class=\"headerlink\" title=\"配置hosts\"></a>配置hosts</h3><h3 id=\"准备缓存目录\"><a href=\"#准备缓存目录\" class=\"headerlink\" title=\"准备缓存目录\"></a>准备缓存目录</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir -p &#x2F;mnt&#x2F;kafka&#x2F;kafka0&#123;1,2,3&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"安装软件\"><a href=\"#安装软件\" class=\"headerlink\" title=\"安装软件\"></a>安装软件</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ls &#x2F;usr&#x2F;local&#x2F;kafka&#x2F;</span><br><span class=\"line\">kafka01  kafka02  kafka03</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"修改kafka01-配置文件\"><a href=\"#修改kafka01-配置文件\" class=\"headerlink\" title=\"修改kafka01 配置文件\"></a>修改kafka01 配置文件</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim &#x2F;usr&#x2F;local&#x2F;kafka&#x2F;kafka01&#x2F;conf&#x2F;server.properties</span><br><span class=\"line\"></span><br><span class=\"line\">broker.id&#x3D;1</span><br><span class=\"line\">port&#x3D;9091</span><br><span class=\"line\">host.name&#x3D;192.168.1.12</span><br><span class=\"line\">num.network.threads&#x3D;3</span><br><span class=\"line\">num.io.threads&#x3D;8</span><br><span class=\"line\">socket.send.buffer.bytes&#x3D;102400</span><br><span class=\"line\">socket.receive.buffer.bytes&#x3D;102400</span><br><span class=\"line\">socket.request.max.bytes&#x3D;104857600</span><br><span class=\"line\">log.dirs&#x3D;&#x2F;mnt&#x2F;kafka&#x2F;kafka01&#x2F;</span><br><span class=\"line\">num.partitions&#x3D;1</span><br><span class=\"line\">num.recovery.threads.per.data.dir&#x3D;1</span><br><span class=\"line\">log.retention.hours&#x3D;168</span><br><span class=\"line\">log.segment.bytes&#x3D;1073741824</span><br><span class=\"line\">log.retention.check.interval.ms&#x3D;300000</span><br><span class=\"line\">log.cleaner.enable&#x3D;false</span><br><span class=\"line\">zookeeper.connect&#x3D;192.168.1.12:2181,192.168.1.12:2182,192.168.1.12:2183</span><br><span class=\"line\">zookeeper.connection.timeout.ms&#x3D;6000</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"修改kafka02-配置文件\"><a href=\"#修改kafka02-配置文件\" class=\"headerlink\" title=\"修改kafka02 配置文件\"></a>修改kafka02 配置文件</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim &#x2F;usr&#x2F;local&#x2F;kafka&#x2F;kafka01&#x2F;conf&#x2F;server.properties</span><br><span class=\"line\"></span><br><span class=\"line\">broker.id&#x3D;2</span><br><span class=\"line\">port&#x3D;9092</span><br><span class=\"line\">host.name&#x3D;192.168.1.12</span><br><span class=\"line\">num.network.threads&#x3D;3</span><br><span class=\"line\">num.io.threads&#x3D;8</span><br><span class=\"line\">socket.send.buffer.bytes&#x3D;102400</span><br><span class=\"line\">socket.receive.buffer.bytes&#x3D;102400</span><br><span class=\"line\">socket.request.max.bytes&#x3D;104857600</span><br><span class=\"line\">log.dirs&#x3D;&#x2F;mnt&#x2F;kafka&#x2F;kafka02&#x2F;</span><br><span class=\"line\">num.partitions&#x3D;1</span><br><span class=\"line\">num.recovery.threads.per.data.dir&#x3D;1</span><br><span class=\"line\">log.retention.hours&#x3D;168</span><br><span class=\"line\">log.segment.bytes&#x3D;1073741824</span><br><span class=\"line\">log.retention.check.interval.ms&#x3D;300000</span><br><span class=\"line\">log.cleaner.enable&#x3D;false</span><br><span class=\"line\">zookeeper.connect&#x3D;192.168.1.12:2181,192.168.1.12:2182,192.168.1.12:2183</span><br><span class=\"line\">zookeeper.connection.timeout.ms&#x3D;6000</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"修改kafka03-配置文件\"><a href=\"#修改kafka03-配置文件\" class=\"headerlink\" title=\"修改kafka03 配置文件\"></a>修改kafka03 配置文件</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim &#x2F;usr&#x2F;local&#x2F;kafka&#x2F;kafka03&#x2F;conf&#x2F;server.properties</span><br><span class=\"line\"></span><br><span class=\"line\">broker.id&#x3D;3</span><br><span class=\"line\">port&#x3D;9093</span><br><span class=\"line\">host.name&#x3D;192.168.1.12</span><br><span class=\"line\">num.network.threads&#x3D;3</span><br><span class=\"line\">num.io.threads&#x3D;8</span><br><span class=\"line\">socket.send.buffer.bytes&#x3D;102400</span><br><span class=\"line\">socket.receive.buffer.bytes&#x3D;102400</span><br><span class=\"line\">socket.request.max.bytes&#x3D;104857600</span><br><span class=\"line\">log.dirs&#x3D;&#x2F;mnt&#x2F;kafka&#x2F;kafka03&#x2F;</span><br><span class=\"line\">num.partitions&#x3D;1</span><br><span class=\"line\">num.recovery.threads.per.data.dir&#x3D;1</span><br><span class=\"line\">log.retention.hours&#x3D;168</span><br><span class=\"line\">log.segment.bytes&#x3D;1073741824</span><br><span class=\"line\">log.retention.check.interval.ms&#x3D;300000</span><br><span class=\"line\">log.cleaner.enable&#x3D;false</span><br><span class=\"line\">zookeeper.connect&#x3D;192.168.1.12:2181,192.168.1.12:2182,192.168.1.12:2183</span><br><span class=\"line\">zookeeper.connection.timeout.ms&#x3D;6000</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"启动kafka\"><a href=\"#启动kafka\" class=\"headerlink\" title=\"启动kafka\"></a>启动kafka</h3><p>先要确保zookeeper已启动，然后在启动Kafka</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nohup &#x2F;usr&#x2F;local&#x2F;kafka&#x2F;kafka01&#x2F;bin&#x2F;kafka-server-start.sh &#x2F;usr&#x2F;local&#x2F;kafka&#x2F;kafka01&#x2F;config&#x2F;server.properties &gt; &#x2F;var&#x2F;log&#x2F;kafka01.out 2&gt;&amp;1 &amp;</span><br><span class=\"line\">nohup &#x2F;usr&#x2F;local&#x2F;kafka&#x2F;kafka02&#x2F;bin&#x2F;kafka-server-start.sh &#x2F;usr&#x2F;local&#x2F;kafka&#x2F;kafka02&#x2F;config&#x2F;server.properties &gt; &#x2F;var&#x2F;log&#x2F;kafka02.out 2&gt;&amp;1 &amp;</span><br><span class=\"line\">nohup &#x2F;usr&#x2F;local&#x2F;kafka&#x2F;kafka03&#x2F;bin&#x2F;kafka-server-start.sh &#x2F;usr&#x2F;local&#x2F;kafka&#x2F;kafka03&#x2F;config&#x2F;server.properties &gt; &#x2F;var&#x2F;log&#x2F;kafka03.out 2&gt;&amp;1 &amp;</span><br></pre></td></tr></table></figure>\n\n<p>查看kafka进程</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">jps</span><br><span class=\"line\"></span><br><span class=\"line\">14343 Kafka</span><br><span class=\"line\">14345 Kafka</span><br><span class=\"line\">16941 Jps</span><br><span class=\"line\">14350 Kafka</span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"测试\"><a href=\"#测试\" class=\"headerlink\" title=\"测试\"></a>测试</h3><h4 id=\"创建-topic-3个分片，3个副本\"><a href=\"#创建-topic-3个分片，3个副本\" class=\"headerlink\" title=\"创建 topic,3个分片，3个副本\"></a>创建 topic,3个分片，3个副本</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;usr&#x2F;local&#x2F;kafka&#x2F;kafka03&#x2F;bin&#x2F;kafka-topics.sh –create –zookeeper localhost:2181 –replication-factor 3 –partitions 3 –topic test_topic</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"启动一个生产者\"><a href=\"#启动一个生产者\" class=\"headerlink\" title=\"启动一个生产者\"></a>启动一个生产者</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;usr&#x2F;local&#x2F;kafka&#x2F;kafka03&#x2F;bin&#x2F;kafka-console-producer.sh –broker-list node1:9091,node2:9092,node3:9093 –topic test_topic </span><br></pre></td></tr></table></figure>\n\n<h4 id=\"启动一个消费者\"><a href=\"#启动一个消费者\" class=\"headerlink\" title=\"启动一个消费者\"></a>启动一个消费者</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;usr&#x2F;local&#x2F;kafka&#x2F;kafka03&#x2F;bin&#x2F;kafka-console-consumer.sh –zookeeper localhost:2181 –topic test_topic </span><br></pre></td></tr></table></figure>\n\n<p>####zookeeper查看topic</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">bin&#x2F;zkCli.sh -server 192.168.1.12:2182</span><br><span class=\"line\"></span><br><span class=\"line\">[zk: 192.168.1.12:2182(CONNECTED) 2] get &#x2F;brokers&#x2F;topics&#x2F;test_topic</span><br><span class=\"line\">&#123;&quot;version&quot;:1,&quot;partitions&quot;:&#123;&quot;2&quot;:[3,1,2],&quot;1&quot;:[2,3,1],&quot;0&quot;:[1,2,3]&#125;&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"配置文件说明\"><a href=\"#配置文件说明\" class=\"headerlink\" title=\"配置文件说明\"></a>配置文件说明</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">broker.id&#x3D;1  #当前机器在集群中的唯一标识，和zookeeper的myid性质一样,</span><br><span class=\"line\"></span><br><span class=\"line\">每一个broker在集群中的唯一表示，要求是正数。当该服务器的IP地址发生改变时，broker.id没有变化，则不会影响consumers的消息情况</span><br><span class=\"line\"></span><br><span class=\"line\">port&#x3D;9092  #当前kafka对外提供服务的端口默认是9092</span><br><span class=\"line\"></span><br><span class=\"line\">host.name&#x3D;192.168.1.172 #broker的主机地址，若是设置了，那么会绑定到这个地址上，若是没有，会绑定到所有的接口上，并将其中之一发送到ZK，一般不设置</span><br><span class=\"line\"></span><br><span class=\"line\">num.network.threads&#x3D;3 #broker处理消息的最大线程数，一般情况下数量为cpu核数</span><br><span class=\"line\"></span><br><span class=\"line\">num.io.threads&#x3D;8 #broker处理磁盘IO的线程数，数值为cpu核数2倍</span><br><span class=\"line\"></span><br><span class=\"line\">socket.send.buffer.bytes&#x3D;102400 #发送缓冲区buffer大小，数据不是一下子就发送的，先回存储到缓冲区了到达一定的大小后在发送，能提高性能</span><br><span class=\"line\"></span><br><span class=\"line\">socket.receive.buffer.bytes&#x3D;102400 #kafka接收缓冲区大小，当数据到达一定大小后在序列化到磁盘</span><br><span class=\"line\"></span><br><span class=\"line\">socket.request.max.bytes&#x3D;104857600 #这个参数是向kafka请求消息或者向kafka发送消息的请请求的最大数，这个值不能超过java的堆栈大小</span><br><span class=\"line\"></span><br><span class=\"line\">log.dirs&#x3D;&#x2F;tmp&#x2F;kafka-logs_1      #kafka数据的存放地址，多个地址的话用逗号分割,多个目录分布在不同磁盘上可以提高读写性能  &#x2F;data&#x2F;kafka-logs-1，&#x2F;data&#x2F;kafka-logs-2</span><br><span class=\"line\"></span><br><span class=\"line\">num.partitions&#x3D;3 #每个topic的分区个数，若是在topic创建时候没有指定的话会被topic创建时的指定参数覆盖</span><br><span class=\"line\"></span><br><span class=\"line\">num.recovery.threads.per.data.dir&#x3D;1 #用于在启动时,用于日志恢复的线程个数,默认是1.</span><br><span class=\"line\"></span><br><span class=\"line\">log.retention.hours&#x3D;168 #默认消息的最大持久化时间，168小时，7天</span><br><span class=\"line\"></span><br><span class=\"line\">log.segment.bytes&#x3D;1073741824    #topic的分区是以一堆segment文件存储的，这个控制每个segment的大小，会被topic创建时的指定参数覆盖</span><br><span class=\"line\"></span><br><span class=\"line\">log.retention.check.interval.ms&#x3D;300000 #每隔300000毫秒去检查上面配置的log失效时间（log.retention.hours&#x3D;168 ），到目录查看是否有过期的消息如果有，删除</span><br><span class=\"line\"></span><br><span class=\"line\">zookeeper.connect&#x3D;localhost:2181,localhost:2182,localhost:2183</span><br><span class=\"line\"></span><br><span class=\"line\">zookeeper.connection.timeout.ms&#x3D;6000 #ZooKeeper的连接超时时间</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"supervisor管理kafka\"><a href=\"#supervisor管理kafka\" class=\"headerlink\" title=\"supervisor管理kafka\"></a>supervisor管理kafka</h3><p><code>vim bin/kafka-run-class.sh</code>   在最上面增加环境路径</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">JAVA_HOME&#x3D;&#x2F;usr&#x2F;local&#x2F;java</span><br><span class=\"line\">export JAVA_HOME</span><br></pre></td></tr></table></figure>\n\n<p><code>vim /etc/supervisor/kafka.conf</code></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[program:kafka]</span><br><span class=\"line\">command&#x3D;&#x2F;usr&#x2F;local&#x2F;kafka&#x2F;kafka01&#x2F;bin&#x2F;kafka-server-start.sh &#x2F;usr&#x2F;local&#x2F;kafka&#x2F;kafka01&#x2F;config&#x2F;server.properties</span><br><span class=\"line\">user&#x3D;root</span><br><span class=\"line\">autostart&#x3D;true</span><br><span class=\"line\">autorestart&#x3D;true</span><br><span class=\"line\">startsecs&#x3D;10</span><br><span class=\"line\">stdout_logfile&#x3D;&#x2F;var&#x2F;log&#x2F;kafka.log</span><br><span class=\"line\">stdout_logfile_maxbytes&#x3D;1MB</span><br><span class=\"line\">stdout_logfile_backups&#x3D;10</span><br><span class=\"line\">stdout_capture_maxbytes&#x3D;1MB</span><br><span class=\"line\">stderr_logfile&#x3D;&#x2F;var&#x2F;log&#x2F;kafka.log</span><br><span class=\"line\">stderr_logfile_maxbytes&#x3D;1MB</span><br><span class=\"line\">stderr_logfile_backups&#x3D;10</span><br><span class=\"line\">stderr_capture_maxbytes&#x3D;1MB</span><br></pre></td></tr></table></figure>"},{"title":"openresty 编译安装","date":"2020-04-01T06:00:00.000Z","_content":"\n\n\n### 环境安装\n\n```\nyum install pcre pcre-devel openssl-devel gcc curl\nyum install GeoIP-devel GeoIP  -y\nyum install gcc-c++ make gcc -y\nyum install -y gcc gcc-c++ zlib-devel pcre-devel openssl-devel readline-devel\nyum -y install gd-devel\n```\n\n### 下载安装包\n\n```\ncd /usr/loca/src\nwget https://www.openssl.org/source/openssl-1.1.1f.tar.gz  下载最新版\nwget https://openresty.org/download/openresty-1.15.8.3.tar.gz   下载最新版\nwget https://github.com/vozlt/nginx-module-vts/archive/v0.1.18.tar.gz\n\ntar xf openresty-1.15.8.3.tar.gz \ntar xf openssl-1.1.1f.tar.gz\ntar xf v0.1.18.tar.gz\n```\n\n\n\n### 安装\n\n```\ncd openresty-1.15.8.3\n\n./configure  --prefix=/usr/local/openresty  \\\n  --user=nobody  --group=nobody \\\n  --http-client-body-temp-path=client_temp  \\\n  --http-proxy-temp-path=proxy_temp \\\n  --http-fastcgi-temp-path=fastcgi_temp \\\n  --http-uwsgi-temp-path=uwsgi_temp  \\\n  --with-http_ssl_module \\\n  --with-http_gunzip_module     \\\n  --with-http_gzip_static_module    \\\n  --with-file-aio    \\\n  --with-openssl=/usr/local/src/openssl-1.1.1f    \\\n  --with-poll_module       \\\n  --with-http_geoip_module       \\\n  --with-http_sub_module      \\\n  --with-http_v2_module      \\\n  --with-pcre       \\\n  --with-stream    \\\n  --with-http_realip_module \\\n  --with-http_geoip_module --with-mail \\\n  --with-http_mp4_module  \\\n  --with-http_flv_module \\\n  --with-http_auth_request_module  \\\n  --with-http_realip_module  \\\n  --with-http_image_filter_module \\\n  --add-module=/usr/local/src/nginx-module-vts-0.1.18\n  \n \n gmake -j `grep processor /proc/cpuinfo | wc -l` && make install\n \n \n```\n\n\n\nsystemctl 管理文件\n\n```\ncat  <<EOF >> /usr/lib/systemd/system/nginx.service\n[Unit]\nDescription=The nginx HTTP and reverse proxy server\nAfter=network.target remote-fs.target nss-lookup.target\n\n[Service]\nType=forking\nPIDFile=/run/nginx.pid\nExecStartPre=/usr/bin/rm -f /run/nginx.pid\nExecStartPre=/usr/sbin/nginx -t\nExecStart=/usr/sbin/nginx\nExecReload=/bin/kill -s HUP $MAINPID\nKillSignal=SIGQUIT\nTimeoutStopSec=5\nKillMode=process\nPrivateTmp=true\n\n[Install]\nWantedBy=multi-user.target\nEOF\n```\n\n### nginx 编译安装 错误\n\n第一个错误 : `/configure: error: C compiler cc is not found `缺少gcc编译器。\n\n```\nyum -y install gcc-c++ autoconf automake\n```\n\n第二个错误：`/configure: error: the HTTP rewrite module requires the PCRE library.`确少PCRE库\n\n```\nyum   -y install pcre pcre-devel\n```\n\n 第三个错误：`./configure: error: the HTTP cache module requires md5 functions from OpenSSL library. You can either disable the module by using --without-http-cache option, or install the OpenSSL library into the system, or build the OpenSSL library statically from the source with nginx by using --with-http_ssl_module --with-openssl=<path> options. `缺少ssl错误。\n\n```\nyum -y install openssl openssl-devel\n```\n\n第四个错误：`./configure: error: the HTTP gzip module requires the zlib library. `缺少zlib库\n\n```\nyum install -y zlib-devel\n```\n\n第五个错误信息：`./configure: error: the HTTP XSLT module requires the libxml2/libxslt  `缺少libxml2\n\n```\nyum -y install libxml2 libxml2-dev && yum -y install libxslt-devel\n```\n\n第六个错误信息：`./configure: error: the HTTP image filter module requires the GD library. You can either do not enable the module or install the libraries.`\n\n解决方法：http_image_filter_module是nginx提供的集成图片处理模块，需要gd-devel的支持\n\n```\n  yum -y install gd-devel\n```\n\n第七个错误信息：`./configure: error: perl module ExtUtils::Embed is required` 缺少ExtUtils\n\n```\nyum -y install perl-devel perl-ExtUtils-Embed\n```\n\n第八个错误信息：`./configure: error: the GeoIP module requires the GeoIP library. You can either do not enable the module or install the library. `缺少GeoIP\n\n```\nyum -y install GeoIP GeoIP-devel GeoIP-data\n```\n\n\n\n\n\n### nginx 开启 nginx-module-vts 监控\n\n```\nhttp {\n    include       mime.types;\n    default_type  application/octet-stream;\n    vhost_traffic_status_zone;     \n    vhost_traffic_status_filter_by_host on;\n    #vhost_traffic_status_dump logs/vts.db;   #持久化数据\n    \n    server {\n        listen       80;\n        server_name  localhost;\n        location / {\n            root   html;\n            index  index.html index.htm;\n        }\n        location /status {\n            vhost_traffic_status_display;\n            vhost_traffic_status_display_format html;\n        }\n    }\n}\n\n在浏览器打开   http://ip/status\n```\n\n```\n\n打开vhost过滤：\nvhost_traffic_status_filter_by_host on;\n开启此功能，在Nginx配置有多个server_name的情况下，会根据不同的server_name进行流量的统计，否则默认会把流量全部计算到第一个server_name上。\n在不想统计流量的server区域禁用vhost_traffic_status，配置示例：\nserver {\n...\nvhost_traffic_status off;\n...\n}\n```\n\n\n\n配置监控数据采集模块 nginx-vts-exporter\n\n```\nhttps://github.com/hnlq715/nginx-vts-exporter\n\n\n\nnginx-vts-exporter-0.9.1.linux-amd64/nginx-vts-exporter -nginx.scrape_timeout 10 -nginx.scrape_uri http://127.0.0.1/status/format/json\n\n\nnginx_vts_exporter的默认端口号：9913，对外暴露监控接口http://xxx:9913/metrics.\n```\n\n监控采集指标说明\n\n```\nnginx_server_requestMsec： 统计nginx，各个server请求转发的平均处理时间，精确到host\nnginx_server_requests：统计nginx各个host 各个请求的总数，精确到状态码\n\n```\n\nnginx_server_bytes：统计nginx进出的字节计数可以精确到每个host，in进，out出\n\n```\n\nnginx_server_bytes{direction=\"in\",host=\"*\"} 466638\nnginx_server_bytes{direction=\"in\",host=\"127.0.0.1\"} 21031\nnginx_server_bytes{direction=\"in\",host=\"9.56.39.66\"} 445607\nnginx_server_bytes{direction=\"out\",host=\"*\"} 8.089076e+06\nnginx_server_bytes{direction=\"out\",host=\"127.0.0.1\"} 1.993122e+06\nnginx_server_bytes{direction=\"out\",host=\"9.56.39.66\"} 6.095954e+06\n```\n\nnginx_server_cache：统计nginx缓存计算器，精确到每一种状态和转发type\n\n```\nnginx_server_cache{host=\"*\",status=\"bypass\"} 0\nnginx_server_cache{host=\"*\",status=\"expired\"} 0\nnginx_server_cache{host=\"*\",status=\"hit\"} 0\nnginx_server_cache{host=\"*\",status=\"miss\"} 0\nnginx_server_cache{host=\"*\",status=\"revalidated\"} 0\nnginx_server_cache{host=\"*\",status=\"scarce\"} 0\nnginx_server_cache{host=\"*\",status=\"stale\"} 0\nnginx_server_cache{host=\"*\",status=\"updating\"} 0\nnginx_server_cache{host=\"9.56.39.66\",status=\"bypass\"} 0\nnginx_server_cache{host=\"9.56.39.66\",status=\"expired\"} 0\nnginx_server_cache{host=\"9.56.39.66\",status=\"hit\"} 0\nnginx_server_cache{host=\"9.56.39.66\",status=\"miss\"} 0\nnginx_server_cache{host=\"9.56.39.66\",status=\"revalidated\"} 0\nnginx_server_cache{host=\"9.56.39.66\",status=\"scarce\"} 0\nnginx_server_cache{host=\"9.56.39.66\",status=\"stale\"} 0\nnginx_server_cache{host=\"9.56.39.66\",status=\"updating\"} 0\n```\n\nnginx_server_connections： 统计nginx几种连接状态type的连接数\n\n```\nnginx_server_connections{status=\"accepted\"} 98\nnginx_server_connections{status=\"active\"} 1\nnginx_server_connections{status=\"handled\"} 98\nnginx_server_connections{status=\"reading\"} 0\nnginx_server_connections{status=\"requests\"} 942\nnginx_server_connections{status=\"waiting\"} 0\nnginx_server_connections{status=\"writing\"} 1\n```\n\nnginx_server_requestMsec： 统计nginx，各个server请求转发的平均处理时间，精确到host \n\n```\nnginx_server_requestMsec{host=\"*\"} 0\nnginx_server_requestMsec{host=\"127.0.0.1\"} 0\nnginx_server_requestMsec{host=\"9.56.39.66\"} 0\n```\n\nnginx_server_requests：统计nginx各个host 各个请求的总数，精确到状态码\n\n```\nnginx_server_requests{code=\"1xx\",host=\"*\"} 0\nnginx_server_requests{code=\"1xx\",host=\"9.56.39.66\"} 0\nnginx_server_requests{code=\"2xx\",host=\"*\"} 940\nnginx_server_requests{code=\"2xx\",host=\"9.56.39.66\"} 745\nnginx_server_requests{code=\"3xx\",host=\"*\"} 0\nnginx_server_requests{code=\"3xx\",host=\"9.56.39.66\"} 0\nnginx_server_requests{code=\"4xx\",host=\"*\"} 1\nnginx_server_requests{code=\"4xx\",host=\"9.56.39.66\"} 1\nnginx_server_requests{code=\"5xx\",host=\"*\"} 0\nnginx_server_requests{code=\"5xx\",host=\"9.56.39.66\"} 0\nnginx_server_requests{code=\"total\",host=\"*\"} 941\nnginx_server_requests{code=\"total\",host=\"9.56.39.66\"} 746\n```\n\nnginx_upstream_bytes： 统计nginx各个 upstream 分组的字节总数，细分到进出\n\n```\nnginx_upstream_bytes{direction=\"in\",upstream=\"server_java_weixin\"} 0\nnginx_upstream_bytes{direction=\"out\",upstream=\"server_java_weixin\"} 0\n```\n\nnginx_upstream_requestMsec： 统计nginx 转发每个upstream中各个节点的请求的处理时间ms，不足1ms，会被标记为0\n\n```\nnginx_upstream_requestMsec{backend=\"9.56.39.66:8700\",upstream=\"server_java_weixin\"} 0\nnginx_upstream_requestMsec{backend=\"9.56.39.66:8800\",upstream=\"server_java_weixin\"} 0\nnginx_upstream_requestMsec{backend=\"9.56.39.66:8900\",upstream=\"server_java_weixin\"} 0\nnginx_upstream_requestMsec{backend=\"9.56.39.66:8901\",upstream=\"server_java_weixin\"} 0\nnginx_upstream_requestMsec{backend=\"9.56.39.66:8902\",upstream=\"server_java_weixin\"} 0\nnginx_upstream_requestMsec{backend=\"9.56.39.66:8903\",upstream=\"server_java_weixin\"} 0\n```\n\nnginx_upstream_requests： 统计各个upstream 请求总数，精确到状态码\n\n```\nnginx_upstream_requests{code=\"1xx\",upstream=\"server_java_weixin\"} 0\nnginx_upstream_requests{code=\"2xx\",upstream=\"server_java_weixin\"} 0\nnginx_upstream_requests{code=\"3xx\",upstream=\"server_java_weixin\"} 0\nnginx_upstream_requests{code=\"4xx\",upstream=\"server_java_weixin\"} 0\nnginx_upstream_requests{code=\"5xx\",upstream=\"server_java_weixin\"} 0\nnginx_upstream_requests{code=\"total\",upstream=\"server_java_weixin\"} 0\n```\n\nnginx_upstream_responseMsec：统计各个upstream 平均响应时长，精确到每个节点\n\n```\nnginx_upstream_responseMsec{backend=\"9.56.39.66:8700\",upstream=\"server_java_weixin\"} 293\nnginx_upstream_responseMsec{backend=\"9.56.39.66:8800\",upstream=\"server_java_weixin\"} 293\nnginx_upstream_responseMsec{backend=\"9.56.39.66:8900\",upstream=\"server_java_weixin\"} 292\nnginx_upstream_responseMsec{backend=\"9.56.39.66:8901\",upstream=\"server_java_weixin\"} 297\nnginx_upstream_responseMsec{backend=\"9.56.39.66:8902\",upstream=\"server_java_weixin\"} 295\nnginx_upstream_responseMsec{backend=\"9.56.39.66:8903\",upstream=\"server_java_weixin\"} 296\n```\n\n","source":"_posts/openresty编译安装.md","raw":"---\ntitle: openresty 编译安装\ndate: 2020-04-1 14:00:00\ncategories: \n- openresty\ntags:\n- linux\n- nginx\n---\n\n\n\n### 环境安装\n\n```\nyum install pcre pcre-devel openssl-devel gcc curl\nyum install GeoIP-devel GeoIP  -y\nyum install gcc-c++ make gcc -y\nyum install -y gcc gcc-c++ zlib-devel pcre-devel openssl-devel readline-devel\nyum -y install gd-devel\n```\n\n### 下载安装包\n\n```\ncd /usr/loca/src\nwget https://www.openssl.org/source/openssl-1.1.1f.tar.gz  下载最新版\nwget https://openresty.org/download/openresty-1.15.8.3.tar.gz   下载最新版\nwget https://github.com/vozlt/nginx-module-vts/archive/v0.1.18.tar.gz\n\ntar xf openresty-1.15.8.3.tar.gz \ntar xf openssl-1.1.1f.tar.gz\ntar xf v0.1.18.tar.gz\n```\n\n\n\n### 安装\n\n```\ncd openresty-1.15.8.3\n\n./configure  --prefix=/usr/local/openresty  \\\n  --user=nobody  --group=nobody \\\n  --http-client-body-temp-path=client_temp  \\\n  --http-proxy-temp-path=proxy_temp \\\n  --http-fastcgi-temp-path=fastcgi_temp \\\n  --http-uwsgi-temp-path=uwsgi_temp  \\\n  --with-http_ssl_module \\\n  --with-http_gunzip_module     \\\n  --with-http_gzip_static_module    \\\n  --with-file-aio    \\\n  --with-openssl=/usr/local/src/openssl-1.1.1f    \\\n  --with-poll_module       \\\n  --with-http_geoip_module       \\\n  --with-http_sub_module      \\\n  --with-http_v2_module      \\\n  --with-pcre       \\\n  --with-stream    \\\n  --with-http_realip_module \\\n  --with-http_geoip_module --with-mail \\\n  --with-http_mp4_module  \\\n  --with-http_flv_module \\\n  --with-http_auth_request_module  \\\n  --with-http_realip_module  \\\n  --with-http_image_filter_module \\\n  --add-module=/usr/local/src/nginx-module-vts-0.1.18\n  \n \n gmake -j `grep processor /proc/cpuinfo | wc -l` && make install\n \n \n```\n\n\n\nsystemctl 管理文件\n\n```\ncat  <<EOF >> /usr/lib/systemd/system/nginx.service\n[Unit]\nDescription=The nginx HTTP and reverse proxy server\nAfter=network.target remote-fs.target nss-lookup.target\n\n[Service]\nType=forking\nPIDFile=/run/nginx.pid\nExecStartPre=/usr/bin/rm -f /run/nginx.pid\nExecStartPre=/usr/sbin/nginx -t\nExecStart=/usr/sbin/nginx\nExecReload=/bin/kill -s HUP $MAINPID\nKillSignal=SIGQUIT\nTimeoutStopSec=5\nKillMode=process\nPrivateTmp=true\n\n[Install]\nWantedBy=multi-user.target\nEOF\n```\n\n### nginx 编译安装 错误\n\n第一个错误 : `/configure: error: C compiler cc is not found `缺少gcc编译器。\n\n```\nyum -y install gcc-c++ autoconf automake\n```\n\n第二个错误：`/configure: error: the HTTP rewrite module requires the PCRE library.`确少PCRE库\n\n```\nyum   -y install pcre pcre-devel\n```\n\n 第三个错误：`./configure: error: the HTTP cache module requires md5 functions from OpenSSL library. You can either disable the module by using --without-http-cache option, or install the OpenSSL library into the system, or build the OpenSSL library statically from the source with nginx by using --with-http_ssl_module --with-openssl=<path> options. `缺少ssl错误。\n\n```\nyum -y install openssl openssl-devel\n```\n\n第四个错误：`./configure: error: the HTTP gzip module requires the zlib library. `缺少zlib库\n\n```\nyum install -y zlib-devel\n```\n\n第五个错误信息：`./configure: error: the HTTP XSLT module requires the libxml2/libxslt  `缺少libxml2\n\n```\nyum -y install libxml2 libxml2-dev && yum -y install libxslt-devel\n```\n\n第六个错误信息：`./configure: error: the HTTP image filter module requires the GD library. You can either do not enable the module or install the libraries.`\n\n解决方法：http_image_filter_module是nginx提供的集成图片处理模块，需要gd-devel的支持\n\n```\n  yum -y install gd-devel\n```\n\n第七个错误信息：`./configure: error: perl module ExtUtils::Embed is required` 缺少ExtUtils\n\n```\nyum -y install perl-devel perl-ExtUtils-Embed\n```\n\n第八个错误信息：`./configure: error: the GeoIP module requires the GeoIP library. You can either do not enable the module or install the library. `缺少GeoIP\n\n```\nyum -y install GeoIP GeoIP-devel GeoIP-data\n```\n\n\n\n\n\n### nginx 开启 nginx-module-vts 监控\n\n```\nhttp {\n    include       mime.types;\n    default_type  application/octet-stream;\n    vhost_traffic_status_zone;     \n    vhost_traffic_status_filter_by_host on;\n    #vhost_traffic_status_dump logs/vts.db;   #持久化数据\n    \n    server {\n        listen       80;\n        server_name  localhost;\n        location / {\n            root   html;\n            index  index.html index.htm;\n        }\n        location /status {\n            vhost_traffic_status_display;\n            vhost_traffic_status_display_format html;\n        }\n    }\n}\n\n在浏览器打开   http://ip/status\n```\n\n```\n\n打开vhost过滤：\nvhost_traffic_status_filter_by_host on;\n开启此功能，在Nginx配置有多个server_name的情况下，会根据不同的server_name进行流量的统计，否则默认会把流量全部计算到第一个server_name上。\n在不想统计流量的server区域禁用vhost_traffic_status，配置示例：\nserver {\n...\nvhost_traffic_status off;\n...\n}\n```\n\n\n\n配置监控数据采集模块 nginx-vts-exporter\n\n```\nhttps://github.com/hnlq715/nginx-vts-exporter\n\n\n\nnginx-vts-exporter-0.9.1.linux-amd64/nginx-vts-exporter -nginx.scrape_timeout 10 -nginx.scrape_uri http://127.0.0.1/status/format/json\n\n\nnginx_vts_exporter的默认端口号：9913，对外暴露监控接口http://xxx:9913/metrics.\n```\n\n监控采集指标说明\n\n```\nnginx_server_requestMsec： 统计nginx，各个server请求转发的平均处理时间，精确到host\nnginx_server_requests：统计nginx各个host 各个请求的总数，精确到状态码\n\n```\n\nnginx_server_bytes：统计nginx进出的字节计数可以精确到每个host，in进，out出\n\n```\n\nnginx_server_bytes{direction=\"in\",host=\"*\"} 466638\nnginx_server_bytes{direction=\"in\",host=\"127.0.0.1\"} 21031\nnginx_server_bytes{direction=\"in\",host=\"9.56.39.66\"} 445607\nnginx_server_bytes{direction=\"out\",host=\"*\"} 8.089076e+06\nnginx_server_bytes{direction=\"out\",host=\"127.0.0.1\"} 1.993122e+06\nnginx_server_bytes{direction=\"out\",host=\"9.56.39.66\"} 6.095954e+06\n```\n\nnginx_server_cache：统计nginx缓存计算器，精确到每一种状态和转发type\n\n```\nnginx_server_cache{host=\"*\",status=\"bypass\"} 0\nnginx_server_cache{host=\"*\",status=\"expired\"} 0\nnginx_server_cache{host=\"*\",status=\"hit\"} 0\nnginx_server_cache{host=\"*\",status=\"miss\"} 0\nnginx_server_cache{host=\"*\",status=\"revalidated\"} 0\nnginx_server_cache{host=\"*\",status=\"scarce\"} 0\nnginx_server_cache{host=\"*\",status=\"stale\"} 0\nnginx_server_cache{host=\"*\",status=\"updating\"} 0\nnginx_server_cache{host=\"9.56.39.66\",status=\"bypass\"} 0\nnginx_server_cache{host=\"9.56.39.66\",status=\"expired\"} 0\nnginx_server_cache{host=\"9.56.39.66\",status=\"hit\"} 0\nnginx_server_cache{host=\"9.56.39.66\",status=\"miss\"} 0\nnginx_server_cache{host=\"9.56.39.66\",status=\"revalidated\"} 0\nnginx_server_cache{host=\"9.56.39.66\",status=\"scarce\"} 0\nnginx_server_cache{host=\"9.56.39.66\",status=\"stale\"} 0\nnginx_server_cache{host=\"9.56.39.66\",status=\"updating\"} 0\n```\n\nnginx_server_connections： 统计nginx几种连接状态type的连接数\n\n```\nnginx_server_connections{status=\"accepted\"} 98\nnginx_server_connections{status=\"active\"} 1\nnginx_server_connections{status=\"handled\"} 98\nnginx_server_connections{status=\"reading\"} 0\nnginx_server_connections{status=\"requests\"} 942\nnginx_server_connections{status=\"waiting\"} 0\nnginx_server_connections{status=\"writing\"} 1\n```\n\nnginx_server_requestMsec： 统计nginx，各个server请求转发的平均处理时间，精确到host \n\n```\nnginx_server_requestMsec{host=\"*\"} 0\nnginx_server_requestMsec{host=\"127.0.0.1\"} 0\nnginx_server_requestMsec{host=\"9.56.39.66\"} 0\n```\n\nnginx_server_requests：统计nginx各个host 各个请求的总数，精确到状态码\n\n```\nnginx_server_requests{code=\"1xx\",host=\"*\"} 0\nnginx_server_requests{code=\"1xx\",host=\"9.56.39.66\"} 0\nnginx_server_requests{code=\"2xx\",host=\"*\"} 940\nnginx_server_requests{code=\"2xx\",host=\"9.56.39.66\"} 745\nnginx_server_requests{code=\"3xx\",host=\"*\"} 0\nnginx_server_requests{code=\"3xx\",host=\"9.56.39.66\"} 0\nnginx_server_requests{code=\"4xx\",host=\"*\"} 1\nnginx_server_requests{code=\"4xx\",host=\"9.56.39.66\"} 1\nnginx_server_requests{code=\"5xx\",host=\"*\"} 0\nnginx_server_requests{code=\"5xx\",host=\"9.56.39.66\"} 0\nnginx_server_requests{code=\"total\",host=\"*\"} 941\nnginx_server_requests{code=\"total\",host=\"9.56.39.66\"} 746\n```\n\nnginx_upstream_bytes： 统计nginx各个 upstream 分组的字节总数，细分到进出\n\n```\nnginx_upstream_bytes{direction=\"in\",upstream=\"server_java_weixin\"} 0\nnginx_upstream_bytes{direction=\"out\",upstream=\"server_java_weixin\"} 0\n```\n\nnginx_upstream_requestMsec： 统计nginx 转发每个upstream中各个节点的请求的处理时间ms，不足1ms，会被标记为0\n\n```\nnginx_upstream_requestMsec{backend=\"9.56.39.66:8700\",upstream=\"server_java_weixin\"} 0\nnginx_upstream_requestMsec{backend=\"9.56.39.66:8800\",upstream=\"server_java_weixin\"} 0\nnginx_upstream_requestMsec{backend=\"9.56.39.66:8900\",upstream=\"server_java_weixin\"} 0\nnginx_upstream_requestMsec{backend=\"9.56.39.66:8901\",upstream=\"server_java_weixin\"} 0\nnginx_upstream_requestMsec{backend=\"9.56.39.66:8902\",upstream=\"server_java_weixin\"} 0\nnginx_upstream_requestMsec{backend=\"9.56.39.66:8903\",upstream=\"server_java_weixin\"} 0\n```\n\nnginx_upstream_requests： 统计各个upstream 请求总数，精确到状态码\n\n```\nnginx_upstream_requests{code=\"1xx\",upstream=\"server_java_weixin\"} 0\nnginx_upstream_requests{code=\"2xx\",upstream=\"server_java_weixin\"} 0\nnginx_upstream_requests{code=\"3xx\",upstream=\"server_java_weixin\"} 0\nnginx_upstream_requests{code=\"4xx\",upstream=\"server_java_weixin\"} 0\nnginx_upstream_requests{code=\"5xx\",upstream=\"server_java_weixin\"} 0\nnginx_upstream_requests{code=\"total\",upstream=\"server_java_weixin\"} 0\n```\n\nnginx_upstream_responseMsec：统计各个upstream 平均响应时长，精确到每个节点\n\n```\nnginx_upstream_responseMsec{backend=\"9.56.39.66:8700\",upstream=\"server_java_weixin\"} 293\nnginx_upstream_responseMsec{backend=\"9.56.39.66:8800\",upstream=\"server_java_weixin\"} 293\nnginx_upstream_responseMsec{backend=\"9.56.39.66:8900\",upstream=\"server_java_weixin\"} 292\nnginx_upstream_responseMsec{backend=\"9.56.39.66:8901\",upstream=\"server_java_weixin\"} 297\nnginx_upstream_responseMsec{backend=\"9.56.39.66:8902\",upstream=\"server_java_weixin\"} 295\nnginx_upstream_responseMsec{backend=\"9.56.39.66:8903\",upstream=\"server_java_weixin\"} 296\n```\n\n","slug":"openresty编译安装","published":1,"updated":"2021-06-18T08:07:11.198Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cku6979y1000v00uhd3u11pcc","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><h3 id=\"环境安装\"><a href=\"#环境安装\" class=\"headerlink\" title=\"环境安装\"></a>环境安装</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install pcre pcre-devel openssl-devel gcc curl</span><br><span class=\"line\">yum install GeoIP-devel GeoIP  -y</span><br><span class=\"line\">yum install gcc-c++ make gcc -y</span><br><span class=\"line\">yum install -y gcc gcc-c++ zlib-devel pcre-devel openssl-devel readline-devel</span><br><span class=\"line\">yum -y install gd-devel</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"下载安装包\"><a href=\"#下载安装包\" class=\"headerlink\" title=\"下载安装包\"></a>下载安装包</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd &#x2F;usr&#x2F;loca&#x2F;src</span><br><span class=\"line\">wget https:&#x2F;&#x2F;www.openssl.org&#x2F;source&#x2F;openssl-1.1.1f.tar.gz  下载最新版</span><br><span class=\"line\">wget https:&#x2F;&#x2F;openresty.org&#x2F;download&#x2F;openresty-1.15.8.3.tar.gz   下载最新版</span><br><span class=\"line\">wget https:&#x2F;&#x2F;github.com&#x2F;vozlt&#x2F;nginx-module-vts&#x2F;archive&#x2F;v0.1.18.tar.gz</span><br><span class=\"line\"></span><br><span class=\"line\">tar xf openresty-1.15.8.3.tar.gz </span><br><span class=\"line\">tar xf openssl-1.1.1f.tar.gz</span><br><span class=\"line\">tar xf v0.1.18.tar.gz</span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd openresty-1.15.8.3</span><br><span class=\"line\"></span><br><span class=\"line\">.&#x2F;configure  --prefix&#x3D;&#x2F;usr&#x2F;local&#x2F;openresty  \\</span><br><span class=\"line\">  --user&#x3D;nobody  --group&#x3D;nobody \\</span><br><span class=\"line\">  --http-client-body-temp-path&#x3D;client_temp  \\</span><br><span class=\"line\">  --http-proxy-temp-path&#x3D;proxy_temp \\</span><br><span class=\"line\">  --http-fastcgi-temp-path&#x3D;fastcgi_temp \\</span><br><span class=\"line\">  --http-uwsgi-temp-path&#x3D;uwsgi_temp  \\</span><br><span class=\"line\">  --with-http_ssl_module \\</span><br><span class=\"line\">  --with-http_gunzip_module     \\</span><br><span class=\"line\">  --with-http_gzip_static_module    \\</span><br><span class=\"line\">  --with-file-aio    \\</span><br><span class=\"line\">  --with-openssl&#x3D;&#x2F;usr&#x2F;local&#x2F;src&#x2F;openssl-1.1.1f    \\</span><br><span class=\"line\">  --with-poll_module       \\</span><br><span class=\"line\">  --with-http_geoip_module       \\</span><br><span class=\"line\">  --with-http_sub_module      \\</span><br><span class=\"line\">  --with-http_v2_module      \\</span><br><span class=\"line\">  --with-pcre       \\</span><br><span class=\"line\">  --with-stream    \\</span><br><span class=\"line\">  --with-http_realip_module \\</span><br><span class=\"line\">  --with-http_geoip_module --with-mail \\</span><br><span class=\"line\">  --with-http_mp4_module  \\</span><br><span class=\"line\">  --with-http_flv_module \\</span><br><span class=\"line\">  --with-http_auth_request_module  \\</span><br><span class=\"line\">  --with-http_realip_module  \\</span><br><span class=\"line\">  --with-http_image_filter_module \\</span><br><span class=\"line\">  --add-module&#x3D;&#x2F;usr&#x2F;local&#x2F;src&#x2F;nginx-module-vts-0.1.18</span><br><span class=\"line\">  </span><br><span class=\"line\"> </span><br><span class=\"line\"> gmake -j &#96;grep processor &#x2F;proc&#x2F;cpuinfo | wc -l&#96; &amp;&amp; make install</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br></pre></td></tr></table></figure>\n\n\n\n<p>systemctl 管理文件</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cat  &lt;&lt;EOF &gt;&gt; &#x2F;usr&#x2F;lib&#x2F;systemd&#x2F;system&#x2F;nginx.service</span><br><span class=\"line\">[Unit]</span><br><span class=\"line\">Description&#x3D;The nginx HTTP and reverse proxy server</span><br><span class=\"line\">After&#x3D;network.target remote-fs.target nss-lookup.target</span><br><span class=\"line\"></span><br><span class=\"line\">[Service]</span><br><span class=\"line\">Type&#x3D;forking</span><br><span class=\"line\">PIDFile&#x3D;&#x2F;run&#x2F;nginx.pid</span><br><span class=\"line\">ExecStartPre&#x3D;&#x2F;usr&#x2F;bin&#x2F;rm -f &#x2F;run&#x2F;nginx.pid</span><br><span class=\"line\">ExecStartPre&#x3D;&#x2F;usr&#x2F;sbin&#x2F;nginx -t</span><br><span class=\"line\">ExecStart&#x3D;&#x2F;usr&#x2F;sbin&#x2F;nginx</span><br><span class=\"line\">ExecReload&#x3D;&#x2F;bin&#x2F;kill -s HUP $MAINPID</span><br><span class=\"line\">KillSignal&#x3D;SIGQUIT</span><br><span class=\"line\">TimeoutStopSec&#x3D;5</span><br><span class=\"line\">KillMode&#x3D;process</span><br><span class=\"line\">PrivateTmp&#x3D;true</span><br><span class=\"line\"></span><br><span class=\"line\">[Install]</span><br><span class=\"line\">WantedBy&#x3D;multi-user.target</span><br><span class=\"line\">EOF</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"nginx-编译安装-错误\"><a href=\"#nginx-编译安装-错误\" class=\"headerlink\" title=\"nginx 编译安装 错误\"></a>nginx 编译安装 错误</h3><p>第一个错误 : <code>/configure: error: C compiler cc is not found </code>缺少gcc编译器。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum -y install gcc-c++ autoconf automake</span><br></pre></td></tr></table></figure>\n\n<p>第二个错误：<code>/configure: error: the HTTP rewrite module requires the PCRE library.</code>确少PCRE库</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum   -y install pcre pcre-devel</span><br></pre></td></tr></table></figure>\n\n<p> 第三个错误：<code>./configure: error: the HTTP cache module requires md5 functions from OpenSSL library. You can either disable the module by using --without-http-cache option, or install the OpenSSL library into the system, or build the OpenSSL library statically from the source with nginx by using --with-http_ssl_module --with-openssl=&lt;path&gt; options. </code>缺少ssl错误。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum -y install openssl openssl-devel</span><br></pre></td></tr></table></figure>\n\n<p>第四个错误：<code>./configure: error: the HTTP gzip module requires the zlib library. </code>缺少zlib库</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install -y zlib-devel</span><br></pre></td></tr></table></figure>\n\n<p>第五个错误信息：<code>./configure: error: the HTTP XSLT module requires the libxml2/libxslt  </code>缺少libxml2</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum -y install libxml2 libxml2-dev &amp;&amp; yum -y install libxslt-devel</span><br></pre></td></tr></table></figure>\n\n<p>第六个错误信息：<code>./configure: error: the HTTP image filter module requires the GD library. You can either do not enable the module or install the libraries.</code></p>\n<p>解决方法：http_image_filter_module是nginx提供的集成图片处理模块，需要gd-devel的支持</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum -y install gd-devel</span><br></pre></td></tr></table></figure>\n\n<p>第七个错误信息：<code>./configure: error: perl module ExtUtils::Embed is required</code> 缺少ExtUtils</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum -y install perl-devel perl-ExtUtils-Embed</span><br></pre></td></tr></table></figure>\n\n<p>第八个错误信息：<code>./configure: error: the GeoIP module requires the GeoIP library. You can either do not enable the module or install the library. </code>缺少GeoIP</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum -y install GeoIP GeoIP-devel GeoIP-data</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h3 id=\"nginx-开启-nginx-module-vts-监控\"><a href=\"#nginx-开启-nginx-module-vts-监控\" class=\"headerlink\" title=\"nginx 开启 nginx-module-vts 监控\"></a>nginx 开启 nginx-module-vts 监控</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">http &#123;</span><br><span class=\"line\">    include       mime.types;</span><br><span class=\"line\">    default_type  application&#x2F;octet-stream;</span><br><span class=\"line\">    vhost_traffic_status_zone;     </span><br><span class=\"line\">    vhost_traffic_status_filter_by_host on;</span><br><span class=\"line\">    #vhost_traffic_status_dump logs&#x2F;vts.db;   #持久化数据</span><br><span class=\"line\">    </span><br><span class=\"line\">    server &#123;</span><br><span class=\"line\">        listen       80;</span><br><span class=\"line\">        server_name  localhost;</span><br><span class=\"line\">        location &#x2F; &#123;</span><br><span class=\"line\">            root   html;</span><br><span class=\"line\">            index  index.html index.htm;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        location &#x2F;status &#123;</span><br><span class=\"line\">            vhost_traffic_status_display;</span><br><span class=\"line\">            vhost_traffic_status_display_format html;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">在浏览器打开   http:&#x2F;&#x2F;ip&#x2F;status</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">打开vhost过滤：</span><br><span class=\"line\">vhost_traffic_status_filter_by_host on;</span><br><span class=\"line\">开启此功能，在Nginx配置有多个server_name的情况下，会根据不同的server_name进行流量的统计，否则默认会把流量全部计算到第一个server_name上。</span><br><span class=\"line\">在不想统计流量的server区域禁用vhost_traffic_status，配置示例：</span><br><span class=\"line\">server &#123;</span><br><span class=\"line\">...</span><br><span class=\"line\">vhost_traffic_status off;</span><br><span class=\"line\">...</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<p>配置监控数据采集模块 nginx-vts-exporter</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">https:&#x2F;&#x2F;github.com&#x2F;hnlq715&#x2F;nginx-vts-exporter</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">nginx-vts-exporter-0.9.1.linux-amd64&#x2F;nginx-vts-exporter -nginx.scrape_timeout 10 -nginx.scrape_uri http:&#x2F;&#x2F;127.0.0.1&#x2F;status&#x2F;format&#x2F;json</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">nginx_vts_exporter的默认端口号：9913，对外暴露监控接口http:&#x2F;&#x2F;xxx:9913&#x2F;metrics.</span><br></pre></td></tr></table></figure>\n\n<p>监控采集指标说明</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nginx_server_requestMsec： 统计nginx，各个server请求转发的平均处理时间，精确到host</span><br><span class=\"line\">nginx_server_requests：统计nginx各个host 各个请求的总数，精确到状态码</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>nginx_server_bytes：统计nginx进出的字节计数可以精确到每个host，in进，out出</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">nginx_server_bytes&#123;direction&#x3D;&quot;in&quot;,host&#x3D;&quot;*&quot;&#125; 466638</span><br><span class=\"line\">nginx_server_bytes&#123;direction&#x3D;&quot;in&quot;,host&#x3D;&quot;127.0.0.1&quot;&#125; 21031</span><br><span class=\"line\">nginx_server_bytes&#123;direction&#x3D;&quot;in&quot;,host&#x3D;&quot;9.56.39.66&quot;&#125; 445607</span><br><span class=\"line\">nginx_server_bytes&#123;direction&#x3D;&quot;out&quot;,host&#x3D;&quot;*&quot;&#125; 8.089076e+06</span><br><span class=\"line\">nginx_server_bytes&#123;direction&#x3D;&quot;out&quot;,host&#x3D;&quot;127.0.0.1&quot;&#125; 1.993122e+06</span><br><span class=\"line\">nginx_server_bytes&#123;direction&#x3D;&quot;out&quot;,host&#x3D;&quot;9.56.39.66&quot;&#125; 6.095954e+06</span><br></pre></td></tr></table></figure>\n\n<p>nginx_server_cache：统计nginx缓存计算器，精确到每一种状态和转发type</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nginx_server_cache&#123;host&#x3D;&quot;*&quot;,status&#x3D;&quot;bypass&quot;&#125; 0</span><br><span class=\"line\">nginx_server_cache&#123;host&#x3D;&quot;*&quot;,status&#x3D;&quot;expired&quot;&#125; 0</span><br><span class=\"line\">nginx_server_cache&#123;host&#x3D;&quot;*&quot;,status&#x3D;&quot;hit&quot;&#125; 0</span><br><span class=\"line\">nginx_server_cache&#123;host&#x3D;&quot;*&quot;,status&#x3D;&quot;miss&quot;&#125; 0</span><br><span class=\"line\">nginx_server_cache&#123;host&#x3D;&quot;*&quot;,status&#x3D;&quot;revalidated&quot;&#125; 0</span><br><span class=\"line\">nginx_server_cache&#123;host&#x3D;&quot;*&quot;,status&#x3D;&quot;scarce&quot;&#125; 0</span><br><span class=\"line\">nginx_server_cache&#123;host&#x3D;&quot;*&quot;,status&#x3D;&quot;stale&quot;&#125; 0</span><br><span class=\"line\">nginx_server_cache&#123;host&#x3D;&quot;*&quot;,status&#x3D;&quot;updating&quot;&#125; 0</span><br><span class=\"line\">nginx_server_cache&#123;host&#x3D;&quot;9.56.39.66&quot;,status&#x3D;&quot;bypass&quot;&#125; 0</span><br><span class=\"line\">nginx_server_cache&#123;host&#x3D;&quot;9.56.39.66&quot;,status&#x3D;&quot;expired&quot;&#125; 0</span><br><span class=\"line\">nginx_server_cache&#123;host&#x3D;&quot;9.56.39.66&quot;,status&#x3D;&quot;hit&quot;&#125; 0</span><br><span class=\"line\">nginx_server_cache&#123;host&#x3D;&quot;9.56.39.66&quot;,status&#x3D;&quot;miss&quot;&#125; 0</span><br><span class=\"line\">nginx_server_cache&#123;host&#x3D;&quot;9.56.39.66&quot;,status&#x3D;&quot;revalidated&quot;&#125; 0</span><br><span class=\"line\">nginx_server_cache&#123;host&#x3D;&quot;9.56.39.66&quot;,status&#x3D;&quot;scarce&quot;&#125; 0</span><br><span class=\"line\">nginx_server_cache&#123;host&#x3D;&quot;9.56.39.66&quot;,status&#x3D;&quot;stale&quot;&#125; 0</span><br><span class=\"line\">nginx_server_cache&#123;host&#x3D;&quot;9.56.39.66&quot;,status&#x3D;&quot;updating&quot;&#125; 0</span><br></pre></td></tr></table></figure>\n\n<p>nginx_server_connections： 统计nginx几种连接状态type的连接数</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nginx_server_connections&#123;status&#x3D;&quot;accepted&quot;&#125; 98</span><br><span class=\"line\">nginx_server_connections&#123;status&#x3D;&quot;active&quot;&#125; 1</span><br><span class=\"line\">nginx_server_connections&#123;status&#x3D;&quot;handled&quot;&#125; 98</span><br><span class=\"line\">nginx_server_connections&#123;status&#x3D;&quot;reading&quot;&#125; 0</span><br><span class=\"line\">nginx_server_connections&#123;status&#x3D;&quot;requests&quot;&#125; 942</span><br><span class=\"line\">nginx_server_connections&#123;status&#x3D;&quot;waiting&quot;&#125; 0</span><br><span class=\"line\">nginx_server_connections&#123;status&#x3D;&quot;writing&quot;&#125; 1</span><br></pre></td></tr></table></figure>\n\n<p>nginx_server_requestMsec： 统计nginx，各个server请求转发的平均处理时间，精确到host </p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nginx_server_requestMsec&#123;host&#x3D;&quot;*&quot;&#125; 0</span><br><span class=\"line\">nginx_server_requestMsec&#123;host&#x3D;&quot;127.0.0.1&quot;&#125; 0</span><br><span class=\"line\">nginx_server_requestMsec&#123;host&#x3D;&quot;9.56.39.66&quot;&#125; 0</span><br></pre></td></tr></table></figure>\n\n<p>nginx_server_requests：统计nginx各个host 各个请求的总数，精确到状态码</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nginx_server_requests&#123;code&#x3D;&quot;1xx&quot;,host&#x3D;&quot;*&quot;&#125; 0</span><br><span class=\"line\">nginx_server_requests&#123;code&#x3D;&quot;1xx&quot;,host&#x3D;&quot;9.56.39.66&quot;&#125; 0</span><br><span class=\"line\">nginx_server_requests&#123;code&#x3D;&quot;2xx&quot;,host&#x3D;&quot;*&quot;&#125; 940</span><br><span class=\"line\">nginx_server_requests&#123;code&#x3D;&quot;2xx&quot;,host&#x3D;&quot;9.56.39.66&quot;&#125; 745</span><br><span class=\"line\">nginx_server_requests&#123;code&#x3D;&quot;3xx&quot;,host&#x3D;&quot;*&quot;&#125; 0</span><br><span class=\"line\">nginx_server_requests&#123;code&#x3D;&quot;3xx&quot;,host&#x3D;&quot;9.56.39.66&quot;&#125; 0</span><br><span class=\"line\">nginx_server_requests&#123;code&#x3D;&quot;4xx&quot;,host&#x3D;&quot;*&quot;&#125; 1</span><br><span class=\"line\">nginx_server_requests&#123;code&#x3D;&quot;4xx&quot;,host&#x3D;&quot;9.56.39.66&quot;&#125; 1</span><br><span class=\"line\">nginx_server_requests&#123;code&#x3D;&quot;5xx&quot;,host&#x3D;&quot;*&quot;&#125; 0</span><br><span class=\"line\">nginx_server_requests&#123;code&#x3D;&quot;5xx&quot;,host&#x3D;&quot;9.56.39.66&quot;&#125; 0</span><br><span class=\"line\">nginx_server_requests&#123;code&#x3D;&quot;total&quot;,host&#x3D;&quot;*&quot;&#125; 941</span><br><span class=\"line\">nginx_server_requests&#123;code&#x3D;&quot;total&quot;,host&#x3D;&quot;9.56.39.66&quot;&#125; 746</span><br></pre></td></tr></table></figure>\n\n<p>nginx_upstream_bytes： 统计nginx各个 upstream 分组的字节总数，细分到进出</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nginx_upstream_bytes&#123;direction&#x3D;&quot;in&quot;,upstream&#x3D;&quot;server_java_weixin&quot;&#125; 0</span><br><span class=\"line\">nginx_upstream_bytes&#123;direction&#x3D;&quot;out&quot;,upstream&#x3D;&quot;server_java_weixin&quot;&#125; 0</span><br></pre></td></tr></table></figure>\n\n<p>nginx_upstream_requestMsec： 统计nginx 转发每个upstream中各个节点的请求的处理时间ms，不足1ms，会被标记为0</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nginx_upstream_requestMsec&#123;backend&#x3D;&quot;9.56.39.66:8700&quot;,upstream&#x3D;&quot;server_java_weixin&quot;&#125; 0</span><br><span class=\"line\">nginx_upstream_requestMsec&#123;backend&#x3D;&quot;9.56.39.66:8800&quot;,upstream&#x3D;&quot;server_java_weixin&quot;&#125; 0</span><br><span class=\"line\">nginx_upstream_requestMsec&#123;backend&#x3D;&quot;9.56.39.66:8900&quot;,upstream&#x3D;&quot;server_java_weixin&quot;&#125; 0</span><br><span class=\"line\">nginx_upstream_requestMsec&#123;backend&#x3D;&quot;9.56.39.66:8901&quot;,upstream&#x3D;&quot;server_java_weixin&quot;&#125; 0</span><br><span class=\"line\">nginx_upstream_requestMsec&#123;backend&#x3D;&quot;9.56.39.66:8902&quot;,upstream&#x3D;&quot;server_java_weixin&quot;&#125; 0</span><br><span class=\"line\">nginx_upstream_requestMsec&#123;backend&#x3D;&quot;9.56.39.66:8903&quot;,upstream&#x3D;&quot;server_java_weixin&quot;&#125; 0</span><br></pre></td></tr></table></figure>\n\n<p>nginx_upstream_requests： 统计各个upstream 请求总数，精确到状态码</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nginx_upstream_requests&#123;code&#x3D;&quot;1xx&quot;,upstream&#x3D;&quot;server_java_weixin&quot;&#125; 0</span><br><span class=\"line\">nginx_upstream_requests&#123;code&#x3D;&quot;2xx&quot;,upstream&#x3D;&quot;server_java_weixin&quot;&#125; 0</span><br><span class=\"line\">nginx_upstream_requests&#123;code&#x3D;&quot;3xx&quot;,upstream&#x3D;&quot;server_java_weixin&quot;&#125; 0</span><br><span class=\"line\">nginx_upstream_requests&#123;code&#x3D;&quot;4xx&quot;,upstream&#x3D;&quot;server_java_weixin&quot;&#125; 0</span><br><span class=\"line\">nginx_upstream_requests&#123;code&#x3D;&quot;5xx&quot;,upstream&#x3D;&quot;server_java_weixin&quot;&#125; 0</span><br><span class=\"line\">nginx_upstream_requests&#123;code&#x3D;&quot;total&quot;,upstream&#x3D;&quot;server_java_weixin&quot;&#125; 0</span><br></pre></td></tr></table></figure>\n\n<p>nginx_upstream_responseMsec：统计各个upstream 平均响应时长，精确到每个节点</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nginx_upstream_responseMsec&#123;backend&#x3D;&quot;9.56.39.66:8700&quot;,upstream&#x3D;&quot;server_java_weixin&quot;&#125; 293</span><br><span class=\"line\">nginx_upstream_responseMsec&#123;backend&#x3D;&quot;9.56.39.66:8800&quot;,upstream&#x3D;&quot;server_java_weixin&quot;&#125; 293</span><br><span class=\"line\">nginx_upstream_responseMsec&#123;backend&#x3D;&quot;9.56.39.66:8900&quot;,upstream&#x3D;&quot;server_java_weixin&quot;&#125; 292</span><br><span class=\"line\">nginx_upstream_responseMsec&#123;backend&#x3D;&quot;9.56.39.66:8901&quot;,upstream&#x3D;&quot;server_java_weixin&quot;&#125; 297</span><br><span class=\"line\">nginx_upstream_responseMsec&#123;backend&#x3D;&quot;9.56.39.66:8902&quot;,upstream&#x3D;&quot;server_java_weixin&quot;&#125; 295</span><br><span class=\"line\">nginx_upstream_responseMsec&#123;backend&#x3D;&quot;9.56.39.66:8903&quot;,upstream&#x3D;&quot;server_java_weixin&quot;&#125; 296</span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"","more":"<h3 id=\"环境安装\"><a href=\"#环境安装\" class=\"headerlink\" title=\"环境安装\"></a>环境安装</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install pcre pcre-devel openssl-devel gcc curl</span><br><span class=\"line\">yum install GeoIP-devel GeoIP  -y</span><br><span class=\"line\">yum install gcc-c++ make gcc -y</span><br><span class=\"line\">yum install -y gcc gcc-c++ zlib-devel pcre-devel openssl-devel readline-devel</span><br><span class=\"line\">yum -y install gd-devel</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"下载安装包\"><a href=\"#下载安装包\" class=\"headerlink\" title=\"下载安装包\"></a>下载安装包</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd &#x2F;usr&#x2F;loca&#x2F;src</span><br><span class=\"line\">wget https:&#x2F;&#x2F;www.openssl.org&#x2F;source&#x2F;openssl-1.1.1f.tar.gz  下载最新版</span><br><span class=\"line\">wget https:&#x2F;&#x2F;openresty.org&#x2F;download&#x2F;openresty-1.15.8.3.tar.gz   下载最新版</span><br><span class=\"line\">wget https:&#x2F;&#x2F;github.com&#x2F;vozlt&#x2F;nginx-module-vts&#x2F;archive&#x2F;v0.1.18.tar.gz</span><br><span class=\"line\"></span><br><span class=\"line\">tar xf openresty-1.15.8.3.tar.gz </span><br><span class=\"line\">tar xf openssl-1.1.1f.tar.gz</span><br><span class=\"line\">tar xf v0.1.18.tar.gz</span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd openresty-1.15.8.3</span><br><span class=\"line\"></span><br><span class=\"line\">.&#x2F;configure  --prefix&#x3D;&#x2F;usr&#x2F;local&#x2F;openresty  \\</span><br><span class=\"line\">  --user&#x3D;nobody  --group&#x3D;nobody \\</span><br><span class=\"line\">  --http-client-body-temp-path&#x3D;client_temp  \\</span><br><span class=\"line\">  --http-proxy-temp-path&#x3D;proxy_temp \\</span><br><span class=\"line\">  --http-fastcgi-temp-path&#x3D;fastcgi_temp \\</span><br><span class=\"line\">  --http-uwsgi-temp-path&#x3D;uwsgi_temp  \\</span><br><span class=\"line\">  --with-http_ssl_module \\</span><br><span class=\"line\">  --with-http_gunzip_module     \\</span><br><span class=\"line\">  --with-http_gzip_static_module    \\</span><br><span class=\"line\">  --with-file-aio    \\</span><br><span class=\"line\">  --with-openssl&#x3D;&#x2F;usr&#x2F;local&#x2F;src&#x2F;openssl-1.1.1f    \\</span><br><span class=\"line\">  --with-poll_module       \\</span><br><span class=\"line\">  --with-http_geoip_module       \\</span><br><span class=\"line\">  --with-http_sub_module      \\</span><br><span class=\"line\">  --with-http_v2_module      \\</span><br><span class=\"line\">  --with-pcre       \\</span><br><span class=\"line\">  --with-stream    \\</span><br><span class=\"line\">  --with-http_realip_module \\</span><br><span class=\"line\">  --with-http_geoip_module --with-mail \\</span><br><span class=\"line\">  --with-http_mp4_module  \\</span><br><span class=\"line\">  --with-http_flv_module \\</span><br><span class=\"line\">  --with-http_auth_request_module  \\</span><br><span class=\"line\">  --with-http_realip_module  \\</span><br><span class=\"line\">  --with-http_image_filter_module \\</span><br><span class=\"line\">  --add-module&#x3D;&#x2F;usr&#x2F;local&#x2F;src&#x2F;nginx-module-vts-0.1.18</span><br><span class=\"line\">  </span><br><span class=\"line\"> </span><br><span class=\"line\"> gmake -j &#96;grep processor &#x2F;proc&#x2F;cpuinfo | wc -l&#96; &amp;&amp; make install</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br></pre></td></tr></table></figure>\n\n\n\n<p>systemctl 管理文件</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cat  &lt;&lt;EOF &gt;&gt; &#x2F;usr&#x2F;lib&#x2F;systemd&#x2F;system&#x2F;nginx.service</span><br><span class=\"line\">[Unit]</span><br><span class=\"line\">Description&#x3D;The nginx HTTP and reverse proxy server</span><br><span class=\"line\">After&#x3D;network.target remote-fs.target nss-lookup.target</span><br><span class=\"line\"></span><br><span class=\"line\">[Service]</span><br><span class=\"line\">Type&#x3D;forking</span><br><span class=\"line\">PIDFile&#x3D;&#x2F;run&#x2F;nginx.pid</span><br><span class=\"line\">ExecStartPre&#x3D;&#x2F;usr&#x2F;bin&#x2F;rm -f &#x2F;run&#x2F;nginx.pid</span><br><span class=\"line\">ExecStartPre&#x3D;&#x2F;usr&#x2F;sbin&#x2F;nginx -t</span><br><span class=\"line\">ExecStart&#x3D;&#x2F;usr&#x2F;sbin&#x2F;nginx</span><br><span class=\"line\">ExecReload&#x3D;&#x2F;bin&#x2F;kill -s HUP $MAINPID</span><br><span class=\"line\">KillSignal&#x3D;SIGQUIT</span><br><span class=\"line\">TimeoutStopSec&#x3D;5</span><br><span class=\"line\">KillMode&#x3D;process</span><br><span class=\"line\">PrivateTmp&#x3D;true</span><br><span class=\"line\"></span><br><span class=\"line\">[Install]</span><br><span class=\"line\">WantedBy&#x3D;multi-user.target</span><br><span class=\"line\">EOF</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"nginx-编译安装-错误\"><a href=\"#nginx-编译安装-错误\" class=\"headerlink\" title=\"nginx 编译安装 错误\"></a>nginx 编译安装 错误</h3><p>第一个错误 : <code>/configure: error: C compiler cc is not found </code>缺少gcc编译器。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum -y install gcc-c++ autoconf automake</span><br></pre></td></tr></table></figure>\n\n<p>第二个错误：<code>/configure: error: the HTTP rewrite module requires the PCRE library.</code>确少PCRE库</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum   -y install pcre pcre-devel</span><br></pre></td></tr></table></figure>\n\n<p> 第三个错误：<code>./configure: error: the HTTP cache module requires md5 functions from OpenSSL library. You can either disable the module by using --without-http-cache option, or install the OpenSSL library into the system, or build the OpenSSL library statically from the source with nginx by using --with-http_ssl_module --with-openssl=&lt;path&gt; options. </code>缺少ssl错误。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum -y install openssl openssl-devel</span><br></pre></td></tr></table></figure>\n\n<p>第四个错误：<code>./configure: error: the HTTP gzip module requires the zlib library. </code>缺少zlib库</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install -y zlib-devel</span><br></pre></td></tr></table></figure>\n\n<p>第五个错误信息：<code>./configure: error: the HTTP XSLT module requires the libxml2/libxslt  </code>缺少libxml2</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum -y install libxml2 libxml2-dev &amp;&amp; yum -y install libxslt-devel</span><br></pre></td></tr></table></figure>\n\n<p>第六个错误信息：<code>./configure: error: the HTTP image filter module requires the GD library. You can either do not enable the module or install the libraries.</code></p>\n<p>解决方法：http_image_filter_module是nginx提供的集成图片处理模块，需要gd-devel的支持</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum -y install gd-devel</span><br></pre></td></tr></table></figure>\n\n<p>第七个错误信息：<code>./configure: error: perl module ExtUtils::Embed is required</code> 缺少ExtUtils</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum -y install perl-devel perl-ExtUtils-Embed</span><br></pre></td></tr></table></figure>\n\n<p>第八个错误信息：<code>./configure: error: the GeoIP module requires the GeoIP library. You can either do not enable the module or install the library. </code>缺少GeoIP</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum -y install GeoIP GeoIP-devel GeoIP-data</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h3 id=\"nginx-开启-nginx-module-vts-监控\"><a href=\"#nginx-开启-nginx-module-vts-监控\" class=\"headerlink\" title=\"nginx 开启 nginx-module-vts 监控\"></a>nginx 开启 nginx-module-vts 监控</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">http &#123;</span><br><span class=\"line\">    include       mime.types;</span><br><span class=\"line\">    default_type  application&#x2F;octet-stream;</span><br><span class=\"line\">    vhost_traffic_status_zone;     </span><br><span class=\"line\">    vhost_traffic_status_filter_by_host on;</span><br><span class=\"line\">    #vhost_traffic_status_dump logs&#x2F;vts.db;   #持久化数据</span><br><span class=\"line\">    </span><br><span class=\"line\">    server &#123;</span><br><span class=\"line\">        listen       80;</span><br><span class=\"line\">        server_name  localhost;</span><br><span class=\"line\">        location &#x2F; &#123;</span><br><span class=\"line\">            root   html;</span><br><span class=\"line\">            index  index.html index.htm;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        location &#x2F;status &#123;</span><br><span class=\"line\">            vhost_traffic_status_display;</span><br><span class=\"line\">            vhost_traffic_status_display_format html;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">在浏览器打开   http:&#x2F;&#x2F;ip&#x2F;status</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">打开vhost过滤：</span><br><span class=\"line\">vhost_traffic_status_filter_by_host on;</span><br><span class=\"line\">开启此功能，在Nginx配置有多个server_name的情况下，会根据不同的server_name进行流量的统计，否则默认会把流量全部计算到第一个server_name上。</span><br><span class=\"line\">在不想统计流量的server区域禁用vhost_traffic_status，配置示例：</span><br><span class=\"line\">server &#123;</span><br><span class=\"line\">...</span><br><span class=\"line\">vhost_traffic_status off;</span><br><span class=\"line\">...</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<p>配置监控数据采集模块 nginx-vts-exporter</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">https:&#x2F;&#x2F;github.com&#x2F;hnlq715&#x2F;nginx-vts-exporter</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">nginx-vts-exporter-0.9.1.linux-amd64&#x2F;nginx-vts-exporter -nginx.scrape_timeout 10 -nginx.scrape_uri http:&#x2F;&#x2F;127.0.0.1&#x2F;status&#x2F;format&#x2F;json</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">nginx_vts_exporter的默认端口号：9913，对外暴露监控接口http:&#x2F;&#x2F;xxx:9913&#x2F;metrics.</span><br></pre></td></tr></table></figure>\n\n<p>监控采集指标说明</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nginx_server_requestMsec： 统计nginx，各个server请求转发的平均处理时间，精确到host</span><br><span class=\"line\">nginx_server_requests：统计nginx各个host 各个请求的总数，精确到状态码</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>nginx_server_bytes：统计nginx进出的字节计数可以精确到每个host，in进，out出</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">nginx_server_bytes&#123;direction&#x3D;&quot;in&quot;,host&#x3D;&quot;*&quot;&#125; 466638</span><br><span class=\"line\">nginx_server_bytes&#123;direction&#x3D;&quot;in&quot;,host&#x3D;&quot;127.0.0.1&quot;&#125; 21031</span><br><span class=\"line\">nginx_server_bytes&#123;direction&#x3D;&quot;in&quot;,host&#x3D;&quot;9.56.39.66&quot;&#125; 445607</span><br><span class=\"line\">nginx_server_bytes&#123;direction&#x3D;&quot;out&quot;,host&#x3D;&quot;*&quot;&#125; 8.089076e+06</span><br><span class=\"line\">nginx_server_bytes&#123;direction&#x3D;&quot;out&quot;,host&#x3D;&quot;127.0.0.1&quot;&#125; 1.993122e+06</span><br><span class=\"line\">nginx_server_bytes&#123;direction&#x3D;&quot;out&quot;,host&#x3D;&quot;9.56.39.66&quot;&#125; 6.095954e+06</span><br></pre></td></tr></table></figure>\n\n<p>nginx_server_cache：统计nginx缓存计算器，精确到每一种状态和转发type</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nginx_server_cache&#123;host&#x3D;&quot;*&quot;,status&#x3D;&quot;bypass&quot;&#125; 0</span><br><span class=\"line\">nginx_server_cache&#123;host&#x3D;&quot;*&quot;,status&#x3D;&quot;expired&quot;&#125; 0</span><br><span class=\"line\">nginx_server_cache&#123;host&#x3D;&quot;*&quot;,status&#x3D;&quot;hit&quot;&#125; 0</span><br><span class=\"line\">nginx_server_cache&#123;host&#x3D;&quot;*&quot;,status&#x3D;&quot;miss&quot;&#125; 0</span><br><span class=\"line\">nginx_server_cache&#123;host&#x3D;&quot;*&quot;,status&#x3D;&quot;revalidated&quot;&#125; 0</span><br><span class=\"line\">nginx_server_cache&#123;host&#x3D;&quot;*&quot;,status&#x3D;&quot;scarce&quot;&#125; 0</span><br><span class=\"line\">nginx_server_cache&#123;host&#x3D;&quot;*&quot;,status&#x3D;&quot;stale&quot;&#125; 0</span><br><span class=\"line\">nginx_server_cache&#123;host&#x3D;&quot;*&quot;,status&#x3D;&quot;updating&quot;&#125; 0</span><br><span class=\"line\">nginx_server_cache&#123;host&#x3D;&quot;9.56.39.66&quot;,status&#x3D;&quot;bypass&quot;&#125; 0</span><br><span class=\"line\">nginx_server_cache&#123;host&#x3D;&quot;9.56.39.66&quot;,status&#x3D;&quot;expired&quot;&#125; 0</span><br><span class=\"line\">nginx_server_cache&#123;host&#x3D;&quot;9.56.39.66&quot;,status&#x3D;&quot;hit&quot;&#125; 0</span><br><span class=\"line\">nginx_server_cache&#123;host&#x3D;&quot;9.56.39.66&quot;,status&#x3D;&quot;miss&quot;&#125; 0</span><br><span class=\"line\">nginx_server_cache&#123;host&#x3D;&quot;9.56.39.66&quot;,status&#x3D;&quot;revalidated&quot;&#125; 0</span><br><span class=\"line\">nginx_server_cache&#123;host&#x3D;&quot;9.56.39.66&quot;,status&#x3D;&quot;scarce&quot;&#125; 0</span><br><span class=\"line\">nginx_server_cache&#123;host&#x3D;&quot;9.56.39.66&quot;,status&#x3D;&quot;stale&quot;&#125; 0</span><br><span class=\"line\">nginx_server_cache&#123;host&#x3D;&quot;9.56.39.66&quot;,status&#x3D;&quot;updating&quot;&#125; 0</span><br></pre></td></tr></table></figure>\n\n<p>nginx_server_connections： 统计nginx几种连接状态type的连接数</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nginx_server_connections&#123;status&#x3D;&quot;accepted&quot;&#125; 98</span><br><span class=\"line\">nginx_server_connections&#123;status&#x3D;&quot;active&quot;&#125; 1</span><br><span class=\"line\">nginx_server_connections&#123;status&#x3D;&quot;handled&quot;&#125; 98</span><br><span class=\"line\">nginx_server_connections&#123;status&#x3D;&quot;reading&quot;&#125; 0</span><br><span class=\"line\">nginx_server_connections&#123;status&#x3D;&quot;requests&quot;&#125; 942</span><br><span class=\"line\">nginx_server_connections&#123;status&#x3D;&quot;waiting&quot;&#125; 0</span><br><span class=\"line\">nginx_server_connections&#123;status&#x3D;&quot;writing&quot;&#125; 1</span><br></pre></td></tr></table></figure>\n\n<p>nginx_server_requestMsec： 统计nginx，各个server请求转发的平均处理时间，精确到host </p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nginx_server_requestMsec&#123;host&#x3D;&quot;*&quot;&#125; 0</span><br><span class=\"line\">nginx_server_requestMsec&#123;host&#x3D;&quot;127.0.0.1&quot;&#125; 0</span><br><span class=\"line\">nginx_server_requestMsec&#123;host&#x3D;&quot;9.56.39.66&quot;&#125; 0</span><br></pre></td></tr></table></figure>\n\n<p>nginx_server_requests：统计nginx各个host 各个请求的总数，精确到状态码</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nginx_server_requests&#123;code&#x3D;&quot;1xx&quot;,host&#x3D;&quot;*&quot;&#125; 0</span><br><span class=\"line\">nginx_server_requests&#123;code&#x3D;&quot;1xx&quot;,host&#x3D;&quot;9.56.39.66&quot;&#125; 0</span><br><span class=\"line\">nginx_server_requests&#123;code&#x3D;&quot;2xx&quot;,host&#x3D;&quot;*&quot;&#125; 940</span><br><span class=\"line\">nginx_server_requests&#123;code&#x3D;&quot;2xx&quot;,host&#x3D;&quot;9.56.39.66&quot;&#125; 745</span><br><span class=\"line\">nginx_server_requests&#123;code&#x3D;&quot;3xx&quot;,host&#x3D;&quot;*&quot;&#125; 0</span><br><span class=\"line\">nginx_server_requests&#123;code&#x3D;&quot;3xx&quot;,host&#x3D;&quot;9.56.39.66&quot;&#125; 0</span><br><span class=\"line\">nginx_server_requests&#123;code&#x3D;&quot;4xx&quot;,host&#x3D;&quot;*&quot;&#125; 1</span><br><span class=\"line\">nginx_server_requests&#123;code&#x3D;&quot;4xx&quot;,host&#x3D;&quot;9.56.39.66&quot;&#125; 1</span><br><span class=\"line\">nginx_server_requests&#123;code&#x3D;&quot;5xx&quot;,host&#x3D;&quot;*&quot;&#125; 0</span><br><span class=\"line\">nginx_server_requests&#123;code&#x3D;&quot;5xx&quot;,host&#x3D;&quot;9.56.39.66&quot;&#125; 0</span><br><span class=\"line\">nginx_server_requests&#123;code&#x3D;&quot;total&quot;,host&#x3D;&quot;*&quot;&#125; 941</span><br><span class=\"line\">nginx_server_requests&#123;code&#x3D;&quot;total&quot;,host&#x3D;&quot;9.56.39.66&quot;&#125; 746</span><br></pre></td></tr></table></figure>\n\n<p>nginx_upstream_bytes： 统计nginx各个 upstream 分组的字节总数，细分到进出</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nginx_upstream_bytes&#123;direction&#x3D;&quot;in&quot;,upstream&#x3D;&quot;server_java_weixin&quot;&#125; 0</span><br><span class=\"line\">nginx_upstream_bytes&#123;direction&#x3D;&quot;out&quot;,upstream&#x3D;&quot;server_java_weixin&quot;&#125; 0</span><br></pre></td></tr></table></figure>\n\n<p>nginx_upstream_requestMsec： 统计nginx 转发每个upstream中各个节点的请求的处理时间ms，不足1ms，会被标记为0</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nginx_upstream_requestMsec&#123;backend&#x3D;&quot;9.56.39.66:8700&quot;,upstream&#x3D;&quot;server_java_weixin&quot;&#125; 0</span><br><span class=\"line\">nginx_upstream_requestMsec&#123;backend&#x3D;&quot;9.56.39.66:8800&quot;,upstream&#x3D;&quot;server_java_weixin&quot;&#125; 0</span><br><span class=\"line\">nginx_upstream_requestMsec&#123;backend&#x3D;&quot;9.56.39.66:8900&quot;,upstream&#x3D;&quot;server_java_weixin&quot;&#125; 0</span><br><span class=\"line\">nginx_upstream_requestMsec&#123;backend&#x3D;&quot;9.56.39.66:8901&quot;,upstream&#x3D;&quot;server_java_weixin&quot;&#125; 0</span><br><span class=\"line\">nginx_upstream_requestMsec&#123;backend&#x3D;&quot;9.56.39.66:8902&quot;,upstream&#x3D;&quot;server_java_weixin&quot;&#125; 0</span><br><span class=\"line\">nginx_upstream_requestMsec&#123;backend&#x3D;&quot;9.56.39.66:8903&quot;,upstream&#x3D;&quot;server_java_weixin&quot;&#125; 0</span><br></pre></td></tr></table></figure>\n\n<p>nginx_upstream_requests： 统计各个upstream 请求总数，精确到状态码</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nginx_upstream_requests&#123;code&#x3D;&quot;1xx&quot;,upstream&#x3D;&quot;server_java_weixin&quot;&#125; 0</span><br><span class=\"line\">nginx_upstream_requests&#123;code&#x3D;&quot;2xx&quot;,upstream&#x3D;&quot;server_java_weixin&quot;&#125; 0</span><br><span class=\"line\">nginx_upstream_requests&#123;code&#x3D;&quot;3xx&quot;,upstream&#x3D;&quot;server_java_weixin&quot;&#125; 0</span><br><span class=\"line\">nginx_upstream_requests&#123;code&#x3D;&quot;4xx&quot;,upstream&#x3D;&quot;server_java_weixin&quot;&#125; 0</span><br><span class=\"line\">nginx_upstream_requests&#123;code&#x3D;&quot;5xx&quot;,upstream&#x3D;&quot;server_java_weixin&quot;&#125; 0</span><br><span class=\"line\">nginx_upstream_requests&#123;code&#x3D;&quot;total&quot;,upstream&#x3D;&quot;server_java_weixin&quot;&#125; 0</span><br></pre></td></tr></table></figure>\n\n<p>nginx_upstream_responseMsec：统计各个upstream 平均响应时长，精确到每个节点</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nginx_upstream_responseMsec&#123;backend&#x3D;&quot;9.56.39.66:8700&quot;,upstream&#x3D;&quot;server_java_weixin&quot;&#125; 293</span><br><span class=\"line\">nginx_upstream_responseMsec&#123;backend&#x3D;&quot;9.56.39.66:8800&quot;,upstream&#x3D;&quot;server_java_weixin&quot;&#125; 293</span><br><span class=\"line\">nginx_upstream_responseMsec&#123;backend&#x3D;&quot;9.56.39.66:8900&quot;,upstream&#x3D;&quot;server_java_weixin&quot;&#125; 292</span><br><span class=\"line\">nginx_upstream_responseMsec&#123;backend&#x3D;&quot;9.56.39.66:8901&quot;,upstream&#x3D;&quot;server_java_weixin&quot;&#125; 297</span><br><span class=\"line\">nginx_upstream_responseMsec&#123;backend&#x3D;&quot;9.56.39.66:8902&quot;,upstream&#x3D;&quot;server_java_weixin&quot;&#125; 295</span><br><span class=\"line\">nginx_upstream_responseMsec&#123;backend&#x3D;&quot;9.56.39.66:8903&quot;,upstream&#x3D;&quot;server_java_weixin&quot;&#125; 296</span><br></pre></td></tr></table></figure>\n\n"},{"title":"pipenv使用","date":"2019-12-13T06:00:00.000Z","_content":"\n\n### 安装pipenv\n\n`python2.7.x or python3.6.* `\n\n```\npip install pipenv\n```\n\n### 启动pipenv\n\n```\ncd my_project\npipenv install\n```\n\n然后将目录更改为包含你的Python项目的文件夹，并启动Pipenv，这将在项目目录中创建两个新文件Pipfile和Pipfile.lock，如果项目不存在，则为项目创建一个新的虚拟环境。 如果你添加–two或–three标志到上面的最后一个命令，它分别使用Python 2或3来初始化你的项目。 否则将使用默认版本的Python。\n\n### 管理python依赖关系\n\n#### 安装Python包，请使用install关键字。\n\n```\npipenv install beautifulsoup4\n```\n\n#### 卸载Python包，请使用uninstall关键字。\n\n```\npipenv uninstall beautifulsoup4\n```\n\n#### 冻结软件包名称及其版本\n\n```\npipenv lock\n```\n\n如果另一个用户克隆存储库，可以添加Pipfiles到你的Git存储库，这样他们只需要在他们的系统中安装Pipenv，Pipenv会自动找到Pipfiles，创建一个新的虚拟环境并安装必要的软件包。\n\n```\npipenv install\n```\n\n### 管理开发环境\n\n通常有一些Python包只在你的开发环境中需要，而不是在你的生产环境中，例如单元测试包。 Pipenv将使用–dev标志保持两个环境分开。\n\n```\npipenv install --dev nose2\n```\n\nnose2，但也将其关联为只在开发环境中需要的软件包。 这很有用，因为现在，如果你要在你的生产环境中安装你的项目，\n\n```\npipenv install\n```\n\n默认情况下不会安装nose2包。 但是，如果另一个开发人员将你的项目克隆到自己的开发环境中，他们可以使用–dev标志，\n\n```\npipenv install –dev\n```\n\n并安装所有依赖项，包括开发包。\n\n### 运行代码\n\n为了激活与你的Python项目相关联的虚拟环境，你可以使用简单地shell命令，比如\n\n```\npipenv run which python\n```\n\n将在你的虚拟环境中运行which python命令，并显示与你的虚拟环境相关联的python可执行文件所在的路径。 这是在虚拟环境中运行你自己的Python代码的一个简单方法，\n\n```\npipenv run python my_project.py\n```\n\n如果你不想每次运行Python时都输入这么多，你可以在shell中设置一个别名，例如，\n\n```\nalias prp=\"pipenv run python\"\n```\n\n### 用法\n\n新建一个准备当环境的文件夹pipenvtest，并cd进入该文件夹：\n\n| 命令                          | 说明                            | 例子 |\n| ----------------------------- | ------------------------------- | ---- |\n| `pipenv --three`              | 会使用当前系统的Python3创建环境 |      |\n| `pipenv --python 3.6`         | 指定某一Python版本创建环境      |      |\n| `pipenv shell`                | 激活虚拟环境                    |      |\n| `pipenv --where`              | 显示目录信息                    |      |\n| `pipenv --venv`               | 显示虚拟环境信息                |      |\n| `pipenv --py`                 | 显示Python解释器信息            |      |\n| `pipenv install requests`     | 安装相关模块并加入到Pipfile     |      |\n| `pipenv install django==1.11` | 安装固定版本模块并加入到Pipfile |      |\n| `pipenv graph`                | 查看目前安装的库及其依赖        |      |\n| `pipenv check`                | 检查安全漏洞                    |      |\n| `pipenv uninstall --all`      | 卸载全部包并从Pipfile中移除     |      |\n\n### 设置国内源\n\n可以设置国内源：\n\n`Pipfile`文件中`[source]`下面`url`属性，比如修改成：\n\n`url = \"https://pypi.tuna.tsinghua.edu.cn/simple\"`","source":"_posts/pipenv使用.md","raw":"---\ntitle: pipenv使用\ndate: 2019-12-13 14:00:00\ncategories: \n- python\ntags:\n- pipenv\n- python\n---\n\n\n### 安装pipenv\n\n`python2.7.x or python3.6.* `\n\n```\npip install pipenv\n```\n\n### 启动pipenv\n\n```\ncd my_project\npipenv install\n```\n\n然后将目录更改为包含你的Python项目的文件夹，并启动Pipenv，这将在项目目录中创建两个新文件Pipfile和Pipfile.lock，如果项目不存在，则为项目创建一个新的虚拟环境。 如果你添加–two或–three标志到上面的最后一个命令，它分别使用Python 2或3来初始化你的项目。 否则将使用默认版本的Python。\n\n### 管理python依赖关系\n\n#### 安装Python包，请使用install关键字。\n\n```\npipenv install beautifulsoup4\n```\n\n#### 卸载Python包，请使用uninstall关键字。\n\n```\npipenv uninstall beautifulsoup4\n```\n\n#### 冻结软件包名称及其版本\n\n```\npipenv lock\n```\n\n如果另一个用户克隆存储库，可以添加Pipfiles到你的Git存储库，这样他们只需要在他们的系统中安装Pipenv，Pipenv会自动找到Pipfiles，创建一个新的虚拟环境并安装必要的软件包。\n\n```\npipenv install\n```\n\n### 管理开发环境\n\n通常有一些Python包只在你的开发环境中需要，而不是在你的生产环境中，例如单元测试包。 Pipenv将使用–dev标志保持两个环境分开。\n\n```\npipenv install --dev nose2\n```\n\nnose2，但也将其关联为只在开发环境中需要的软件包。 这很有用，因为现在，如果你要在你的生产环境中安装你的项目，\n\n```\npipenv install\n```\n\n默认情况下不会安装nose2包。 但是，如果另一个开发人员将你的项目克隆到自己的开发环境中，他们可以使用–dev标志，\n\n```\npipenv install –dev\n```\n\n并安装所有依赖项，包括开发包。\n\n### 运行代码\n\n为了激活与你的Python项目相关联的虚拟环境，你可以使用简单地shell命令，比如\n\n```\npipenv run which python\n```\n\n将在你的虚拟环境中运行which python命令，并显示与你的虚拟环境相关联的python可执行文件所在的路径。 这是在虚拟环境中运行你自己的Python代码的一个简单方法，\n\n```\npipenv run python my_project.py\n```\n\n如果你不想每次运行Python时都输入这么多，你可以在shell中设置一个别名，例如，\n\n```\nalias prp=\"pipenv run python\"\n```\n\n### 用法\n\n新建一个准备当环境的文件夹pipenvtest，并cd进入该文件夹：\n\n| 命令                          | 说明                            | 例子 |\n| ----------------------------- | ------------------------------- | ---- |\n| `pipenv --three`              | 会使用当前系统的Python3创建环境 |      |\n| `pipenv --python 3.6`         | 指定某一Python版本创建环境      |      |\n| `pipenv shell`                | 激活虚拟环境                    |      |\n| `pipenv --where`              | 显示目录信息                    |      |\n| `pipenv --venv`               | 显示虚拟环境信息                |      |\n| `pipenv --py`                 | 显示Python解释器信息            |      |\n| `pipenv install requests`     | 安装相关模块并加入到Pipfile     |      |\n| `pipenv install django==1.11` | 安装固定版本模块并加入到Pipfile |      |\n| `pipenv graph`                | 查看目前安装的库及其依赖        |      |\n| `pipenv check`                | 检查安全漏洞                    |      |\n| `pipenv uninstall --all`      | 卸载全部包并从Pipfile中移除     |      |\n\n### 设置国内源\n\n可以设置国内源：\n\n`Pipfile`文件中`[source]`下面`url`属性，比如修改成：\n\n`url = \"https://pypi.tuna.tsinghua.edu.cn/simple\"`","slug":"pipenv使用","published":1,"updated":"2021-06-18T08:07:11.199Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cku6979y1000x00uhdjf14xrc","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><h3 id=\"安装pipenv\"><a href=\"#安装pipenv\" class=\"headerlink\" title=\"安装pipenv\"></a>安装pipenv</h3><p><code>python2.7.x or python3.6.* </code></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pip install pipenv</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"启动pipenv\"><a href=\"#启动pipenv\" class=\"headerlink\" title=\"启动pipenv\"></a>启动pipenv</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd my_project</span><br><span class=\"line\">pipenv install</span><br></pre></td></tr></table></figure>\n\n<p>然后将目录更改为包含你的Python项目的文件夹，并启动Pipenv，这将在项目目录中创建两个新文件Pipfile和Pipfile.lock，如果项目不存在，则为项目创建一个新的虚拟环境。 如果你添加–two或–three标志到上面的最后一个命令，它分别使用Python 2或3来初始化你的项目。 否则将使用默认版本的Python。</p>\n<h3 id=\"管理python依赖关系\"><a href=\"#管理python依赖关系\" class=\"headerlink\" title=\"管理python依赖关系\"></a>管理python依赖关系</h3><h4 id=\"安装Python包，请使用install关键字。\"><a href=\"#安装Python包，请使用install关键字。\" class=\"headerlink\" title=\"安装Python包，请使用install关键字。\"></a>安装Python包，请使用install关键字。</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pipenv install beautifulsoup4</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"卸载Python包，请使用uninstall关键字。\"><a href=\"#卸载Python包，请使用uninstall关键字。\" class=\"headerlink\" title=\"卸载Python包，请使用uninstall关键字。\"></a>卸载Python包，请使用uninstall关键字。</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pipenv uninstall beautifulsoup4</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"冻结软件包名称及其版本\"><a href=\"#冻结软件包名称及其版本\" class=\"headerlink\" title=\"冻结软件包名称及其版本\"></a>冻结软件包名称及其版本</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pipenv lock</span><br></pre></td></tr></table></figure>\n\n<p>如果另一个用户克隆存储库，可以添加Pipfiles到你的Git存储库，这样他们只需要在他们的系统中安装Pipenv，Pipenv会自动找到Pipfiles，创建一个新的虚拟环境并安装必要的软件包。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pipenv install</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"管理开发环境\"><a href=\"#管理开发环境\" class=\"headerlink\" title=\"管理开发环境\"></a>管理开发环境</h3><p>通常有一些Python包只在你的开发环境中需要，而不是在你的生产环境中，例如单元测试包。 Pipenv将使用–dev标志保持两个环境分开。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pipenv install --dev nose2</span><br></pre></td></tr></table></figure>\n\n<p>nose2，但也将其关联为只在开发环境中需要的软件包。 这很有用，因为现在，如果你要在你的生产环境中安装你的项目，</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pipenv install</span><br></pre></td></tr></table></figure>\n\n<p>默认情况下不会安装nose2包。 但是，如果另一个开发人员将你的项目克隆到自己的开发环境中，他们可以使用–dev标志，</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pipenv install –dev</span><br></pre></td></tr></table></figure>\n\n<p>并安装所有依赖项，包括开发包。</p>\n<h3 id=\"运行代码\"><a href=\"#运行代码\" class=\"headerlink\" title=\"运行代码\"></a>运行代码</h3><p>为了激活与你的Python项目相关联的虚拟环境，你可以使用简单地shell命令，比如</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pipenv run which python</span><br></pre></td></tr></table></figure>\n\n<p>将在你的虚拟环境中运行which python命令，并显示与你的虚拟环境相关联的python可执行文件所在的路径。 这是在虚拟环境中运行你自己的Python代码的一个简单方法，</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pipenv run python my_project.py</span><br></pre></td></tr></table></figure>\n\n<p>如果你不想每次运行Python时都输入这么多，你可以在shell中设置一个别名，例如，</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">alias prp&#x3D;&quot;pipenv run python&quot;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"用法\"><a href=\"#用法\" class=\"headerlink\" title=\"用法\"></a>用法</h3><p>新建一个准备当环境的文件夹pipenvtest，并cd进入该文件夹：</p>\n<table>\n<thead>\n<tr>\n<th>命令</th>\n<th>说明</th>\n<th>例子</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><code>pipenv --three</code></td>\n<td>会使用当前系统的Python3创建环境</td>\n<td></td>\n</tr>\n<tr>\n<td><code>pipenv --python 3.6</code></td>\n<td>指定某一Python版本创建环境</td>\n<td></td>\n</tr>\n<tr>\n<td><code>pipenv shell</code></td>\n<td>激活虚拟环境</td>\n<td></td>\n</tr>\n<tr>\n<td><code>pipenv --where</code></td>\n<td>显示目录信息</td>\n<td></td>\n</tr>\n<tr>\n<td><code>pipenv --venv</code></td>\n<td>显示虚拟环境信息</td>\n<td></td>\n</tr>\n<tr>\n<td><code>pipenv --py</code></td>\n<td>显示Python解释器信息</td>\n<td></td>\n</tr>\n<tr>\n<td><code>pipenv install requests</code></td>\n<td>安装相关模块并加入到Pipfile</td>\n<td></td>\n</tr>\n<tr>\n<td><code>pipenv install django==1.11</code></td>\n<td>安装固定版本模块并加入到Pipfile</td>\n<td></td>\n</tr>\n<tr>\n<td><code>pipenv graph</code></td>\n<td>查看目前安装的库及其依赖</td>\n<td></td>\n</tr>\n<tr>\n<td><code>pipenv check</code></td>\n<td>检查安全漏洞</td>\n<td></td>\n</tr>\n<tr>\n<td><code>pipenv uninstall --all</code></td>\n<td>卸载全部包并从Pipfile中移除</td>\n<td></td>\n</tr>\n</tbody></table>\n<h3 id=\"设置国内源\"><a href=\"#设置国内源\" class=\"headerlink\" title=\"设置国内源\"></a>设置国内源</h3><p>可以设置国内源：</p>\n<p><code>Pipfile</code>文件中<code>[source]</code>下面<code>url</code>属性，比如修改成：</p>\n<p><code>url = &quot;https://pypi.tuna.tsinghua.edu.cn/simple&quot;</code></p>\n","site":{"data":{}},"excerpt":"","more":"<h3 id=\"安装pipenv\"><a href=\"#安装pipenv\" class=\"headerlink\" title=\"安装pipenv\"></a>安装pipenv</h3><p><code>python2.7.x or python3.6.* </code></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pip install pipenv</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"启动pipenv\"><a href=\"#启动pipenv\" class=\"headerlink\" title=\"启动pipenv\"></a>启动pipenv</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd my_project</span><br><span class=\"line\">pipenv install</span><br></pre></td></tr></table></figure>\n\n<p>然后将目录更改为包含你的Python项目的文件夹，并启动Pipenv，这将在项目目录中创建两个新文件Pipfile和Pipfile.lock，如果项目不存在，则为项目创建一个新的虚拟环境。 如果你添加–two或–three标志到上面的最后一个命令，它分别使用Python 2或3来初始化你的项目。 否则将使用默认版本的Python。</p>\n<h3 id=\"管理python依赖关系\"><a href=\"#管理python依赖关系\" class=\"headerlink\" title=\"管理python依赖关系\"></a>管理python依赖关系</h3><h4 id=\"安装Python包，请使用install关键字。\"><a href=\"#安装Python包，请使用install关键字。\" class=\"headerlink\" title=\"安装Python包，请使用install关键字。\"></a>安装Python包，请使用install关键字。</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pipenv install beautifulsoup4</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"卸载Python包，请使用uninstall关键字。\"><a href=\"#卸载Python包，请使用uninstall关键字。\" class=\"headerlink\" title=\"卸载Python包，请使用uninstall关键字。\"></a>卸载Python包，请使用uninstall关键字。</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pipenv uninstall beautifulsoup4</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"冻结软件包名称及其版本\"><a href=\"#冻结软件包名称及其版本\" class=\"headerlink\" title=\"冻结软件包名称及其版本\"></a>冻结软件包名称及其版本</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pipenv lock</span><br></pre></td></tr></table></figure>\n\n<p>如果另一个用户克隆存储库，可以添加Pipfiles到你的Git存储库，这样他们只需要在他们的系统中安装Pipenv，Pipenv会自动找到Pipfiles，创建一个新的虚拟环境并安装必要的软件包。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pipenv install</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"管理开发环境\"><a href=\"#管理开发环境\" class=\"headerlink\" title=\"管理开发环境\"></a>管理开发环境</h3><p>通常有一些Python包只在你的开发环境中需要，而不是在你的生产环境中，例如单元测试包。 Pipenv将使用–dev标志保持两个环境分开。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pipenv install --dev nose2</span><br></pre></td></tr></table></figure>\n\n<p>nose2，但也将其关联为只在开发环境中需要的软件包。 这很有用，因为现在，如果你要在你的生产环境中安装你的项目，</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pipenv install</span><br></pre></td></tr></table></figure>\n\n<p>默认情况下不会安装nose2包。 但是，如果另一个开发人员将你的项目克隆到自己的开发环境中，他们可以使用–dev标志，</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pipenv install –dev</span><br></pre></td></tr></table></figure>\n\n<p>并安装所有依赖项，包括开发包。</p>\n<h3 id=\"运行代码\"><a href=\"#运行代码\" class=\"headerlink\" title=\"运行代码\"></a>运行代码</h3><p>为了激活与你的Python项目相关联的虚拟环境，你可以使用简单地shell命令，比如</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pipenv run which python</span><br></pre></td></tr></table></figure>\n\n<p>将在你的虚拟环境中运行which python命令，并显示与你的虚拟环境相关联的python可执行文件所在的路径。 这是在虚拟环境中运行你自己的Python代码的一个简单方法，</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pipenv run python my_project.py</span><br></pre></td></tr></table></figure>\n\n<p>如果你不想每次运行Python时都输入这么多，你可以在shell中设置一个别名，例如，</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">alias prp&#x3D;&quot;pipenv run python&quot;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"用法\"><a href=\"#用法\" class=\"headerlink\" title=\"用法\"></a>用法</h3><p>新建一个准备当环境的文件夹pipenvtest，并cd进入该文件夹：</p>\n<table>\n<thead>\n<tr>\n<th>命令</th>\n<th>说明</th>\n<th>例子</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><code>pipenv --three</code></td>\n<td>会使用当前系统的Python3创建环境</td>\n<td></td>\n</tr>\n<tr>\n<td><code>pipenv --python 3.6</code></td>\n<td>指定某一Python版本创建环境</td>\n<td></td>\n</tr>\n<tr>\n<td><code>pipenv shell</code></td>\n<td>激活虚拟环境</td>\n<td></td>\n</tr>\n<tr>\n<td><code>pipenv --where</code></td>\n<td>显示目录信息</td>\n<td></td>\n</tr>\n<tr>\n<td><code>pipenv --venv</code></td>\n<td>显示虚拟环境信息</td>\n<td></td>\n</tr>\n<tr>\n<td><code>pipenv --py</code></td>\n<td>显示Python解释器信息</td>\n<td></td>\n</tr>\n<tr>\n<td><code>pipenv install requests</code></td>\n<td>安装相关模块并加入到Pipfile</td>\n<td></td>\n</tr>\n<tr>\n<td><code>pipenv install django==1.11</code></td>\n<td>安装固定版本模块并加入到Pipfile</td>\n<td></td>\n</tr>\n<tr>\n<td><code>pipenv graph</code></td>\n<td>查看目前安装的库及其依赖</td>\n<td></td>\n</tr>\n<tr>\n<td><code>pipenv check</code></td>\n<td>检查安全漏洞</td>\n<td></td>\n</tr>\n<tr>\n<td><code>pipenv uninstall --all</code></td>\n<td>卸载全部包并从Pipfile中移除</td>\n<td></td>\n</tr>\n</tbody></table>\n<h3 id=\"设置国内源\"><a href=\"#设置国内源\" class=\"headerlink\" title=\"设置国内源\"></a>设置国内源</h3><p>可以设置国内源：</p>\n<p><code>Pipfile</code>文件中<code>[source]</code>下面<code>url</code>属性，比如修改成：</p>\n<p><code>url = &quot;https://pypi.tuna.tsinghua.edu.cn/simple&quot;</code></p>\n"},{"title":"proxmox 超融合","date":"2020-05-11T06:00:00.000Z","_content":"\n\n\n**安装前准备**\n\n不使用磁盘控制器，不要做raid\n\n\n\n### 安装部署\n\n略\n\n\n\n**刪除內建的LVM thin**\n\nLVM 有两种，分为 Thin 和 非Thin， 而 pve內建的 local-lvm 的格式是 LVM-Thin ，在使用上有好处也有坏处:\n\n1) 好处:用来建vm or ct 可以有 snapshot(快照)的功能，而且可以超额分配硬碟空间(当然是有代价的)\n\n2) 坏处:这个分割区你无法直接放档案进去，等于这个分割区只能給 vm or ct 专用了\n\n若你不想使用 LVM-Thin 想把它移掉，只当一般的 LVM 使用，LVM 相对于 LVM-thin 的优缺点如下:\n\n1) 优点:你可以直接放档案进去\n\n2) 缺点:vm or ct 沒有快照功能，不能超额分配硬碟空间\n\n按下面的方法转换成一般的LVM 来使用\n\n注意:底下的操作会刪掉你 local-lvm 里的所有资料，请确定你 local-lvm 里沒有要保留的资料\n\n\n\n\n\n```bash\napt update\n```","source":"_posts/proxmox超融合.md","raw":"---\ntitle: proxmox 超融合\ndate: 2020-5-11 14:00:00\ncategories: \n- linux\ntags:\n- proxmox\n---\n\n\n\n**安装前准备**\n\n不使用磁盘控制器，不要做raid\n\n\n\n### 安装部署\n\n略\n\n\n\n**刪除內建的LVM thin**\n\nLVM 有两种，分为 Thin 和 非Thin， 而 pve內建的 local-lvm 的格式是 LVM-Thin ，在使用上有好处也有坏处:\n\n1) 好处:用来建vm or ct 可以有 snapshot(快照)的功能，而且可以超额分配硬碟空间(当然是有代价的)\n\n2) 坏处:这个分割区你无法直接放档案进去，等于这个分割区只能給 vm or ct 专用了\n\n若你不想使用 LVM-Thin 想把它移掉，只当一般的 LVM 使用，LVM 相对于 LVM-thin 的优缺点如下:\n\n1) 优点:你可以直接放档案进去\n\n2) 缺点:vm or ct 沒有快照功能，不能超额分配硬碟空间\n\n按下面的方法转换成一般的LVM 来使用\n\n注意:底下的操作会刪掉你 local-lvm 里的所有资料，请确定你 local-lvm 里沒有要保留的资料\n\n\n\n\n\n```bash\napt update\n```","slug":"proxmox超融合","published":1,"updated":"2021-06-18T08:07:11.201Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cku6979y3001200uh2f9jdy0q","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><p><strong>安装前准备</strong></p>\n<p>不使用磁盘控制器，不要做raid</p>\n<h3 id=\"安装部署\"><a href=\"#安装部署\" class=\"headerlink\" title=\"安装部署\"></a>安装部署</h3><p>略</p>\n<p><strong>刪除內建的LVM thin</strong></p>\n<p>LVM 有两种，分为 Thin 和 非Thin， 而 pve內建的 local-lvm 的格式是 LVM-Thin ，在使用上有好处也有坏处:</p>\n<ol>\n<li><p>好处:用来建vm or ct 可以有 snapshot(快照)的功能，而且可以超额分配硬碟空间(当然是有代价的)</p>\n</li>\n<li><p>坏处:这个分割区你无法直接放档案进去，等于这个分割区只能給 vm or ct 专用了</p>\n</li>\n</ol>\n<p>若你不想使用 LVM-Thin 想把它移掉，只当一般的 LVM 使用，LVM 相对于 LVM-thin 的优缺点如下:</p>\n<ol>\n<li><p>优点:你可以直接放档案进去</p>\n</li>\n<li><p>缺点:vm or ct 沒有快照功能，不能超额分配硬碟空间</p>\n</li>\n</ol>\n<p>按下面的方法转换成一般的LVM 来使用</p>\n<p>注意:底下的操作会刪掉你 local-lvm 里的所有资料，请确定你 local-lvm 里沒有要保留的资料</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apt update</span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"","more":"<p><strong>安装前准备</strong></p>\n<p>不使用磁盘控制器，不要做raid</p>\n<h3 id=\"安装部署\"><a href=\"#安装部署\" class=\"headerlink\" title=\"安装部署\"></a>安装部署</h3><p>略</p>\n<p><strong>刪除內建的LVM thin</strong></p>\n<p>LVM 有两种，分为 Thin 和 非Thin， 而 pve內建的 local-lvm 的格式是 LVM-Thin ，在使用上有好处也有坏处:</p>\n<ol>\n<li><p>好处:用来建vm or ct 可以有 snapshot(快照)的功能，而且可以超额分配硬碟空间(当然是有代价的)</p>\n</li>\n<li><p>坏处:这个分割区你无法直接放档案进去，等于这个分割区只能給 vm or ct 专用了</p>\n</li>\n</ol>\n<p>若你不想使用 LVM-Thin 想把它移掉，只当一般的 LVM 使用，LVM 相对于 LVM-thin 的优缺点如下:</p>\n<ol>\n<li><p>优点:你可以直接放档案进去</p>\n</li>\n<li><p>缺点:vm or ct 沒有快照功能，不能超额分配硬碟空间</p>\n</li>\n</ol>\n<p>按下面的方法转换成一般的LVM 来使用</p>\n<p>注意:底下的操作会刪掉你 local-lvm 里的所有资料，请确定你 local-lvm 里沒有要保留的资料</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apt update</span><br></pre></td></tr></table></figure>"},{"title":"spark 安装","date":"2019-12-13T06:00:00.000Z","_content":"\n##准备\n\n###环境要求\n\nJava版本不低于Hadoop要求，并配置环境变量\n\n### 安装\n\n在网站hadoop.apache.org下载稳定版本的Hadoop包\n\n解压压缩包并检查Hadoop是否可用\n\n```\ntar xf hadoop-3.0.1.tar.gz\nhadoop-3.0.1/bin/hadoop version\n\nHadoop 3.0.1\nSource code repository Unknown -r 496dc57cc2e4f4da117f7a8e3840aaeac0c1d2d0\nCompiled by lei on 2018-03-16T23:00Z\nCompiled with protoc 2.5.0\nFrom source with checksum 504d49cc3bcf4e2b56e2fd44ced8572\nThis command was run using /root/hadoop-3.0.1/share/hadoop/common/hadoop-common-3.0.1.jar\n```\n\n### 修改配置文件\n\n`hadoop-3.0.1/etc/hadoop/hadoop-env.sh`\n\n```\n#第27行\nexport JAVA_HOME=/usr/local/java\n```\n\n\n\nHadoop配置以`.xml`文件形式存在\n\n修改文件 `hadoop-3.0.1/etc/hadoop/core-site.xml` :\n\n```\n<configuration>\n        <property>\n                <!-- 指定hadoop运行时产生文件的存储目录 -->\n                <name>hadoop.tmp.dir</name>\n                <value>/home/users/hadoop/hadoop/tmp</value>\n        </property>\n        <property>\n                <!-- 指定HADOOP所使用的文件系统schema（URI），HDFS的老大（NameNode）的地址 -->\n                <name>fs.default.name</name>\n                <value>hdfs://node1:9000</value>\n        </property>\n</configuration>\n```\n\n修改文件`hadoop-3.0.1/etc/hadoop/hdfs-site.xml`:\n\n```\n<configuration>\n        <property>\n                <name>dfs.datanode.data.dir</name>\n                <value>/home/users/hadoop/hadoop/data</value>\n        </property>\n        <property>\n                <name>dfs.namenode.name.dir</name>\n                <value>/home/users/hadoop/hadoop/name</value>\n        </property>\n        <property>\n                <name>dfs.http.address</name>\n                <value>0.0.0.0:8100</value>\n        </property>\n        <property>\n                <name>dfs.replication</name>\n                <value>1</value>\n        </property>\n</configuration>\n```\n\n### namenode格式化\n\n```\nhadoop-3.0.1/bin/hdfs namenode -format\n```\n\n### 开启Namenode和Datanode\n\n```\nhadoop-3.0.1/sbin/start-dfs.sh\n```\n\n### HDFS的使用\n\nHDFS的命令执行格式：`hadoop fs -cmd`， 其中cmd是类shell的命令(命令可以通过添加环境变量来简化)\n\n```\nhadoop fs -ls /        //查看hdfs根目录的文件树\nhadoop fs -mkdir /test        //创建test文件夹\nhadoop fs -cp 文件 文件        //拷贝文件\n```","source":"_posts/spark安装.md","raw":"---\ntitle: spark 安装\ndate: 2019-12-13 14:00:00\ncategories: \n- bigdata\ntags:\n- spark\n---\n\n##准备\n\n###环境要求\n\nJava版本不低于Hadoop要求，并配置环境变量\n\n### 安装\n\n在网站hadoop.apache.org下载稳定版本的Hadoop包\n\n解压压缩包并检查Hadoop是否可用\n\n```\ntar xf hadoop-3.0.1.tar.gz\nhadoop-3.0.1/bin/hadoop version\n\nHadoop 3.0.1\nSource code repository Unknown -r 496dc57cc2e4f4da117f7a8e3840aaeac0c1d2d0\nCompiled by lei on 2018-03-16T23:00Z\nCompiled with protoc 2.5.0\nFrom source with checksum 504d49cc3bcf4e2b56e2fd44ced8572\nThis command was run using /root/hadoop-3.0.1/share/hadoop/common/hadoop-common-3.0.1.jar\n```\n\n### 修改配置文件\n\n`hadoop-3.0.1/etc/hadoop/hadoop-env.sh`\n\n```\n#第27行\nexport JAVA_HOME=/usr/local/java\n```\n\n\n\nHadoop配置以`.xml`文件形式存在\n\n修改文件 `hadoop-3.0.1/etc/hadoop/core-site.xml` :\n\n```\n<configuration>\n        <property>\n                <!-- 指定hadoop运行时产生文件的存储目录 -->\n                <name>hadoop.tmp.dir</name>\n                <value>/home/users/hadoop/hadoop/tmp</value>\n        </property>\n        <property>\n                <!-- 指定HADOOP所使用的文件系统schema（URI），HDFS的老大（NameNode）的地址 -->\n                <name>fs.default.name</name>\n                <value>hdfs://node1:9000</value>\n        </property>\n</configuration>\n```\n\n修改文件`hadoop-3.0.1/etc/hadoop/hdfs-site.xml`:\n\n```\n<configuration>\n        <property>\n                <name>dfs.datanode.data.dir</name>\n                <value>/home/users/hadoop/hadoop/data</value>\n        </property>\n        <property>\n                <name>dfs.namenode.name.dir</name>\n                <value>/home/users/hadoop/hadoop/name</value>\n        </property>\n        <property>\n                <name>dfs.http.address</name>\n                <value>0.0.0.0:8100</value>\n        </property>\n        <property>\n                <name>dfs.replication</name>\n                <value>1</value>\n        </property>\n</configuration>\n```\n\n### namenode格式化\n\n```\nhadoop-3.0.1/bin/hdfs namenode -format\n```\n\n### 开启Namenode和Datanode\n\n```\nhadoop-3.0.1/sbin/start-dfs.sh\n```\n\n### HDFS的使用\n\nHDFS的命令执行格式：`hadoop fs -cmd`， 其中cmd是类shell的命令(命令可以通过添加环境变量来简化)\n\n```\nhadoop fs -ls /        //查看hdfs根目录的文件树\nhadoop fs -mkdir /test        //创建test文件夹\nhadoop fs -cp 文件 文件        //拷贝文件\n```","slug":"spark安装","published":1,"updated":"2021-06-18T08:07:11.204Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cku6979y4001500uh33l1bx48","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><p>##准备</p>\n<p>###环境要求</p>\n<p>Java版本不低于Hadoop要求，并配置环境变量</p>\n<h3 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h3><p>在网站hadoop.apache.org下载稳定版本的Hadoop包</p>\n<p>解压压缩包并检查Hadoop是否可用</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tar xf hadoop-3.0.1.tar.gz</span><br><span class=\"line\">hadoop-3.0.1&#x2F;bin&#x2F;hadoop version</span><br><span class=\"line\"></span><br><span class=\"line\">Hadoop 3.0.1</span><br><span class=\"line\">Source code repository Unknown -r 496dc57cc2e4f4da117f7a8e3840aaeac0c1d2d0</span><br><span class=\"line\">Compiled by lei on 2018-03-16T23:00Z</span><br><span class=\"line\">Compiled with protoc 2.5.0</span><br><span class=\"line\">From source with checksum 504d49cc3bcf4e2b56e2fd44ced8572</span><br><span class=\"line\">This command was run using &#x2F;root&#x2F;hadoop-3.0.1&#x2F;share&#x2F;hadoop&#x2F;common&#x2F;hadoop-common-3.0.1.jar</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"修改配置文件\"><a href=\"#修改配置文件\" class=\"headerlink\" title=\"修改配置文件\"></a>修改配置文件</h3><p><code>hadoop-3.0.1/etc/hadoop/hadoop-env.sh</code></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#第27行</span><br><span class=\"line\">export JAVA_HOME&#x3D;&#x2F;usr&#x2F;local&#x2F;java</span><br></pre></td></tr></table></figure>\n\n\n\n<p>Hadoop配置以<code>.xml</code>文件形式存在</p>\n<p>修改文件 <code>hadoop-3.0.1/etc/hadoop/core-site.xml</code> :</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;configuration&gt;</span><br><span class=\"line\">        &lt;property&gt;</span><br><span class=\"line\">                &lt;!-- 指定hadoop运行时产生文件的存储目录 --&gt;</span><br><span class=\"line\">                &lt;name&gt;hadoop.tmp.dir&lt;&#x2F;name&gt;</span><br><span class=\"line\">                &lt;value&gt;&#x2F;home&#x2F;users&#x2F;hadoop&#x2F;hadoop&#x2F;tmp&lt;&#x2F;value&gt;</span><br><span class=\"line\">        &lt;&#x2F;property&gt;</span><br><span class=\"line\">        &lt;property&gt;</span><br><span class=\"line\">                &lt;!-- 指定HADOOP所使用的文件系统schema（URI），HDFS的老大（NameNode）的地址 --&gt;</span><br><span class=\"line\">                &lt;name&gt;fs.default.name&lt;&#x2F;name&gt;</span><br><span class=\"line\">                &lt;value&gt;hdfs:&#x2F;&#x2F;node1:9000&lt;&#x2F;value&gt;</span><br><span class=\"line\">        &lt;&#x2F;property&gt;</span><br><span class=\"line\">&lt;&#x2F;configuration&gt;</span><br></pre></td></tr></table></figure>\n\n<p>修改文件<code>hadoop-3.0.1/etc/hadoop/hdfs-site.xml</code>:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;configuration&gt;</span><br><span class=\"line\">        &lt;property&gt;</span><br><span class=\"line\">                &lt;name&gt;dfs.datanode.data.dir&lt;&#x2F;name&gt;</span><br><span class=\"line\">                &lt;value&gt;&#x2F;home&#x2F;users&#x2F;hadoop&#x2F;hadoop&#x2F;data&lt;&#x2F;value&gt;</span><br><span class=\"line\">        &lt;&#x2F;property&gt;</span><br><span class=\"line\">        &lt;property&gt;</span><br><span class=\"line\">                &lt;name&gt;dfs.namenode.name.dir&lt;&#x2F;name&gt;</span><br><span class=\"line\">                &lt;value&gt;&#x2F;home&#x2F;users&#x2F;hadoop&#x2F;hadoop&#x2F;name&lt;&#x2F;value&gt;</span><br><span class=\"line\">        &lt;&#x2F;property&gt;</span><br><span class=\"line\">        &lt;property&gt;</span><br><span class=\"line\">                &lt;name&gt;dfs.http.address&lt;&#x2F;name&gt;</span><br><span class=\"line\">                &lt;value&gt;0.0.0.0:8100&lt;&#x2F;value&gt;</span><br><span class=\"line\">        &lt;&#x2F;property&gt;</span><br><span class=\"line\">        &lt;property&gt;</span><br><span class=\"line\">                &lt;name&gt;dfs.replication&lt;&#x2F;name&gt;</span><br><span class=\"line\">                &lt;value&gt;1&lt;&#x2F;value&gt;</span><br><span class=\"line\">        &lt;&#x2F;property&gt;</span><br><span class=\"line\">&lt;&#x2F;configuration&gt;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"namenode格式化\"><a href=\"#namenode格式化\" class=\"headerlink\" title=\"namenode格式化\"></a>namenode格式化</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hadoop-3.0.1&#x2F;bin&#x2F;hdfs namenode -format</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"开启Namenode和Datanode\"><a href=\"#开启Namenode和Datanode\" class=\"headerlink\" title=\"开启Namenode和Datanode\"></a>开启Namenode和Datanode</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hadoop-3.0.1&#x2F;sbin&#x2F;start-dfs.sh</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"HDFS的使用\"><a href=\"#HDFS的使用\" class=\"headerlink\" title=\"HDFS的使用\"></a>HDFS的使用</h3><p>HDFS的命令执行格式：<code>hadoop fs -cmd</code>， 其中cmd是类shell的命令(命令可以通过添加环境变量来简化)</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hadoop fs -ls &#x2F;        &#x2F;&#x2F;查看hdfs根目录的文件树</span><br><span class=\"line\">hadoop fs -mkdir &#x2F;test        &#x2F;&#x2F;创建test文件夹</span><br><span class=\"line\">hadoop fs -cp 文件 文件        &#x2F;&#x2F;拷贝文件</span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"","more":"<p>##准备</p>\n<p>###环境要求</p>\n<p>Java版本不低于Hadoop要求，并配置环境变量</p>\n<h3 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h3><p>在网站hadoop.apache.org下载稳定版本的Hadoop包</p>\n<p>解压压缩包并检查Hadoop是否可用</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tar xf hadoop-3.0.1.tar.gz</span><br><span class=\"line\">hadoop-3.0.1&#x2F;bin&#x2F;hadoop version</span><br><span class=\"line\"></span><br><span class=\"line\">Hadoop 3.0.1</span><br><span class=\"line\">Source code repository Unknown -r 496dc57cc2e4f4da117f7a8e3840aaeac0c1d2d0</span><br><span class=\"line\">Compiled by lei on 2018-03-16T23:00Z</span><br><span class=\"line\">Compiled with protoc 2.5.0</span><br><span class=\"line\">From source with checksum 504d49cc3bcf4e2b56e2fd44ced8572</span><br><span class=\"line\">This command was run using &#x2F;root&#x2F;hadoop-3.0.1&#x2F;share&#x2F;hadoop&#x2F;common&#x2F;hadoop-common-3.0.1.jar</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"修改配置文件\"><a href=\"#修改配置文件\" class=\"headerlink\" title=\"修改配置文件\"></a>修改配置文件</h3><p><code>hadoop-3.0.1/etc/hadoop/hadoop-env.sh</code></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#第27行</span><br><span class=\"line\">export JAVA_HOME&#x3D;&#x2F;usr&#x2F;local&#x2F;java</span><br></pre></td></tr></table></figure>\n\n\n\n<p>Hadoop配置以<code>.xml</code>文件形式存在</p>\n<p>修改文件 <code>hadoop-3.0.1/etc/hadoop/core-site.xml</code> :</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;configuration&gt;</span><br><span class=\"line\">        &lt;property&gt;</span><br><span class=\"line\">                &lt;!-- 指定hadoop运行时产生文件的存储目录 --&gt;</span><br><span class=\"line\">                &lt;name&gt;hadoop.tmp.dir&lt;&#x2F;name&gt;</span><br><span class=\"line\">                &lt;value&gt;&#x2F;home&#x2F;users&#x2F;hadoop&#x2F;hadoop&#x2F;tmp&lt;&#x2F;value&gt;</span><br><span class=\"line\">        &lt;&#x2F;property&gt;</span><br><span class=\"line\">        &lt;property&gt;</span><br><span class=\"line\">                &lt;!-- 指定HADOOP所使用的文件系统schema（URI），HDFS的老大（NameNode）的地址 --&gt;</span><br><span class=\"line\">                &lt;name&gt;fs.default.name&lt;&#x2F;name&gt;</span><br><span class=\"line\">                &lt;value&gt;hdfs:&#x2F;&#x2F;node1:9000&lt;&#x2F;value&gt;</span><br><span class=\"line\">        &lt;&#x2F;property&gt;</span><br><span class=\"line\">&lt;&#x2F;configuration&gt;</span><br></pre></td></tr></table></figure>\n\n<p>修改文件<code>hadoop-3.0.1/etc/hadoop/hdfs-site.xml</code>:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;configuration&gt;</span><br><span class=\"line\">        &lt;property&gt;</span><br><span class=\"line\">                &lt;name&gt;dfs.datanode.data.dir&lt;&#x2F;name&gt;</span><br><span class=\"line\">                &lt;value&gt;&#x2F;home&#x2F;users&#x2F;hadoop&#x2F;hadoop&#x2F;data&lt;&#x2F;value&gt;</span><br><span class=\"line\">        &lt;&#x2F;property&gt;</span><br><span class=\"line\">        &lt;property&gt;</span><br><span class=\"line\">                &lt;name&gt;dfs.namenode.name.dir&lt;&#x2F;name&gt;</span><br><span class=\"line\">                &lt;value&gt;&#x2F;home&#x2F;users&#x2F;hadoop&#x2F;hadoop&#x2F;name&lt;&#x2F;value&gt;</span><br><span class=\"line\">        &lt;&#x2F;property&gt;</span><br><span class=\"line\">        &lt;property&gt;</span><br><span class=\"line\">                &lt;name&gt;dfs.http.address&lt;&#x2F;name&gt;</span><br><span class=\"line\">                &lt;value&gt;0.0.0.0:8100&lt;&#x2F;value&gt;</span><br><span class=\"line\">        &lt;&#x2F;property&gt;</span><br><span class=\"line\">        &lt;property&gt;</span><br><span class=\"line\">                &lt;name&gt;dfs.replication&lt;&#x2F;name&gt;</span><br><span class=\"line\">                &lt;value&gt;1&lt;&#x2F;value&gt;</span><br><span class=\"line\">        &lt;&#x2F;property&gt;</span><br><span class=\"line\">&lt;&#x2F;configuration&gt;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"namenode格式化\"><a href=\"#namenode格式化\" class=\"headerlink\" title=\"namenode格式化\"></a>namenode格式化</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hadoop-3.0.1&#x2F;bin&#x2F;hdfs namenode -format</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"开启Namenode和Datanode\"><a href=\"#开启Namenode和Datanode\" class=\"headerlink\" title=\"开启Namenode和Datanode\"></a>开启Namenode和Datanode</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hadoop-3.0.1&#x2F;sbin&#x2F;start-dfs.sh</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"HDFS的使用\"><a href=\"#HDFS的使用\" class=\"headerlink\" title=\"HDFS的使用\"></a>HDFS的使用</h3><p>HDFS的命令执行格式：<code>hadoop fs -cmd</code>， 其中cmd是类shell的命令(命令可以通过添加环境变量来简化)</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hadoop fs -ls &#x2F;        &#x2F;&#x2F;查看hdfs根目录的文件树</span><br><span class=\"line\">hadoop fs -mkdir &#x2F;test        &#x2F;&#x2F;创建test文件夹</span><br><span class=\"line\">hadoop fs -cp 文件 文件        &#x2F;&#x2F;拷贝文件</span><br></pre></td></tr></table></figure>"},{"title":"zookeeper 安装","date":"2019-12-13T06:00:00.000Z","_content":"\n## 一、 准备\n- 安装JDK\n- 准备 安装包 http://archive.apache.org/dist/zookeeper/\n- 官方手册 \nhttp://zookeeper.apache.org/doc/r3.4.6/zookeeperStarted.html\n\n## 二、单机安装\n\n### 2.1、解压安装包\n\n```bash\ncd /usr/local/src\ntar -zxf zookeeper-3.4.9.tar.gz -C /usr/local/\n```\n### 2.2、配置\n\n创建data和logs 目录\n```bash\nmkdir -p /mnt/zookeeper/{data,logs}\n```\n新建`zoo.cfg` 文件,写入以下内容保存：\n```\ntickTime=2000\ndataDir=/usr/myapp/zookeeper-3.4.5/data\ndataLogDir=/usr/myapp/zookeeper-3.4.5/logs\nclientPort=2181\n```\n### 2.3、启动和停止\n进入bin目录，启动、停止、重启分和查看当前节点状态（包括集群中是何角色）别执行：\n```\n./zkServer.sh start\n./zkServer.sh stop\n./zkServer.sh restart\n./zkServer.sh status\n```\n\n<hr/>\n\n## 三、伪集群模式\n\n伪集群模式就是在同一主机启动多个zookeeper并组成集群，下边以在192.168.220.128主机上创3个zookeeper组集群为例。\n\n将通过第一大点安装的zookeeper，复制成zookeeper1/zookeeper2/zookeeper3三份\n### 3.1、准备\n```\ncd /usr/local/zookeeper/\nmkdir {zookeeper1,zookeeper2,zookeeper3}\nmkdir -p /mnt/zookerper/{zookeeper1/{data,logs},zookeeper2/{data,logs},zookeeper3/{data,logs}}\n```\n\n### 3.2、zookeeper2配置\n\nzookeeper1 配置文件conf/zoo.cfg修改如下：\n```\ntickTime=2000\ndataDir=/mnt/zookerper/zookeeper1/data\ndataLogDir=/mnt/zookerper/zookeeper1/logs\nclientPort=2181\ninitLimit=5\nsyncLimit=2\nserver.1=192.168.220.128:2888:3888\nserver.2=192.168.220.128:4888:5888\nserver.3=192.168.220.128:6888:7888\n```\nzookeeper1的data/myid配置如下：\n```\necho '1' > /mnt/zookerper/zookeeper1/data/myid\n```\n### 3.3、zookeeper2配置\nzookeeper2 配置文件conf/zoo.cfg修改如下：\n```\ntickTime=2000\ndataDir=/mnt/zookerper/zookeeper2/data\ndataLogDir=/mnt/zookerper/zookeeper2/logs\nclientPort=2181\ninitLimit=5\nsyncLimit=2\nserver.1=192.168.220.128:2888:3888\nserver.2=192.168.220.128:4888:5888\nserver.3=192.168.220.128:6888:7888\n```\nzookeeper2的data/myid配置如下：\n```\necho '2' > /mnt/zookerper/zookeeper2/data/myid\n```\n\n### 3.4、zookeeper3配置\nzookeeper3 配置文件conf/zoo.cfg修改如下：\n```\ntickTime=2000\ndataDir=/mnt/zookerper/zookeeper3/data\ndataLogDir=/mnt/zookerper/zookeeper3/logs\nclientPort=2181\ninitLimit=5\nsyncLimit=2\nserver.1=192.168.220.128:2888:3888\nserver.2=192.168.220.128:4888:5888\nserver.3=192.168.220.128:6888:7888\n```\nzookeeper1的data/myid配置如下：\n```\necho '3' > /mnt/zookerper/zookeeper3/data/myid\n```\n### 3.5、启动和停止\n\n进入bin目录，启动、停止、重启分和查看当前节点状态（包括集群中是何角色）别执行：\n```\n./zkServer.sh start\n./zkServer.sh stop\n./zkServer.sh restart\n./zkServer.sh status\n```\n<hr>\n\n## 四、集群模式\n\n集群模式就是在不同主机上安装zookeeper然后组成集群的模式；下边以在192.168.220.128/129/130三台主机为例。\n\n将第1.1到1.3步中安装好的zookeeper打包复制到129和130上，并都解压到同样的目录下。\n\n### 4.1、conf/zoo.cfg文件修改\n三个zookeeper的conf/zoo.cfg修改如下：\n```\ntickTime=2000\ndataDir=/usr/myapp/zookeeper-3.4.5/data\ndataLogDir=/usr/myapp/zookeeper-3.4.5/logs\nclientPort=2181\ninitLimit=5\nsyncLimit=2\nserver.1=192.168.220.128:2888:3888\nserver.2=192.168.220.129:2888:3888\nserver.3=192.168.220.130:2888:3888\n```\n对于129和130，由于安装目录都是zookeeper-3.4.5所以dataDir和dataLogDir不需要改变，又由于在不同机器上所以clientPort也不需要改变\n\n所以此时129和130的conf/zoo.cfg的内容与128一样即可。\n\n### 4.2、data/myid文件修改\n\n128 data/myid修改如下：\n```\necho '1' > data/myid\n```\n129 data/myid修改如下：\n```\necho '2' > data/myid\n```\n130 data/myid修改如下：\n```\necho '3' > data/myid\n```\n\n<hr>\n\n## 五、测试集群是否启动成功\n\n```\nbin/zkCli.sh  -server 127.0.0.1:2181,127.0.0.1:2182,127.0.0.1:2183\n\nls /brokers/ids\n[1, 2, 3]\n```\n\n\n\n<hr>\n\n## 六、配置文件详解\n\n```\ntickTime=2000:\ntickTime这个时间是作为Zookeeper服务器之间或客户端与服务器之间维持心跳的时间间隔,也就是每个tickTime时间就会发送一个心跳；\n\ninitLimit=10:\ninitLimit这个配置项是用来配置Zookeeper接受客户端（这里所说的客户端不是用户连接Zookeeper服务器的客户端,而是Zookeeper服务器集群中连接到Leader的Follower 服务器）初始化连接时最长能忍受多少个心跳时间间隔数。\n当已经超过10个心跳的时间（也就是tickTime）长度后 Zookeeper 服务器还没有收到客户端的返回信息,那么表明这个客户端连接失败。总的时间长度就是 10*2000=20 秒；\n\nsyncLimit=5:\nsyncLimit这个配置项标识Leader与Follower之间发送消息,请求和应答时间长度,最长不能超过多少个tickTime的时间长度,总的时间长度就是5*2000=10秒；\n\ndataDir=/export/search/zookeeper-cluster/zookeeper-3.4.6-node1/data\ndataDir顾名思义就是Zookeeper保存数据的目录,默认情况下Zookeeper将写数据的日志文件也保存在这个目录里；\ndatailogDir=/usr/local/zookeeper-cluster/zookeeper-3.5.2-node1/datalog\n事物日志的存储路径，如果不配置这个那么事物日志会默认存储到dataDir制定的目录，这样会严重影响zk的性能，当zk吞吐量较大的时候，产生的事物日志、快照日志太多\nclientPort=2181\nclientPort这个端口就是客户端连接Zookeeper服务器的端口,Zookeeper会监听这个端口接受客户端的访问请求；\n\nserver.1=localhost:2887:3887\nserver.2=localhost:2888:3888\nserver.3=localhost:2889:3889\nserver.A=B：C：D：\nA是一个数字,表示这个是第几号服务器,B是这个服务器的ip地址\nC第一个端口用来集群成员的信息交换,表示的是这个服务器与集群中的Leader服务器交换信息的端口\nD是在leader挂掉时专门用来进行选举leader所用\n\n#autopurge.purgeInterval  这个参数指定了清理频率，单位是小时，需要填写一个1或更大的整数，默认是0，表示不开启自己清理功能。\n#autopurge.snapRetainCount 这个参数和上面的参数搭配使用，这个参数指定了需要保留的文件数目。默认是保留3个。\n```\n\n\n\n## 七、supervisor管理\n\n`vim bin/zkEnv.sh`在最上面增加环境路径\n\n```\nJAVA_HOME=/usr/local/java\nexport JAVA_HOME\n```\n\n`vim /etc/supervisor/zookeeper.conf`\n\n```\n[program:zookeeper]\ncommand=/usr/local/zookeeper-3.5.2-alpha/bin/zkServer.sh start-foreground\nautostart=true\nautorestart=true\nstartsecs=10\nstdout_logfile=/var/log/zookeeper.log\nstdout_logfile_maxbytes=1MB\nstdout_logfile_backups=10\nstdout_capture_maxbytes=1MB\nstderr_logfile=/var/log/zookeeper.log\nstderr_logfile_maxbytes=1MB\nstderr_logfile_backups=10\nstderr_capture_maxbytes=1MB\n```\n\n\n\n##八、报错及处理\n\n应用连接zookeepr报错：Session 0x0 for server 192.168.220.128/192.168.220.128:2181,unexpected error,closing socket connection and attempting reconnect；\n\n先看端口能否telnet通，如果通则使用./zkServer.sh status查看zk是否确实已启动，没启查看bin/zookeeper.out中的报错。\n\nbin/zookeeper.out中报错：“zookeeper address already in use”；显然端口被占用，要么是其他进程占用了配置的端口，要么是上边配置的clientPort和server中的端口有重复。\n\nbin/zookeeper.out中报错：Cannot open channel to 2 at election address /192.168.220.130:3888；这应该只是组成集群的130节点未启动，到130启动起来zk即会正常。\n\n","source":"_posts/zookeeper安装.md","raw":"---\ntitle: zookeeper 安装\ndate: 2019-12-13 14:00:00\ncategories: \n- bigdata\ntags:\n- zookeeper\n---\n\n## 一、 准备\n- 安装JDK\n- 准备 安装包 http://archive.apache.org/dist/zookeeper/\n- 官方手册 \nhttp://zookeeper.apache.org/doc/r3.4.6/zookeeperStarted.html\n\n## 二、单机安装\n\n### 2.1、解压安装包\n\n```bash\ncd /usr/local/src\ntar -zxf zookeeper-3.4.9.tar.gz -C /usr/local/\n```\n### 2.2、配置\n\n创建data和logs 目录\n```bash\nmkdir -p /mnt/zookeeper/{data,logs}\n```\n新建`zoo.cfg` 文件,写入以下内容保存：\n```\ntickTime=2000\ndataDir=/usr/myapp/zookeeper-3.4.5/data\ndataLogDir=/usr/myapp/zookeeper-3.4.5/logs\nclientPort=2181\n```\n### 2.3、启动和停止\n进入bin目录，启动、停止、重启分和查看当前节点状态（包括集群中是何角色）别执行：\n```\n./zkServer.sh start\n./zkServer.sh stop\n./zkServer.sh restart\n./zkServer.sh status\n```\n\n<hr/>\n\n## 三、伪集群模式\n\n伪集群模式就是在同一主机启动多个zookeeper并组成集群，下边以在192.168.220.128主机上创3个zookeeper组集群为例。\n\n将通过第一大点安装的zookeeper，复制成zookeeper1/zookeeper2/zookeeper3三份\n### 3.1、准备\n```\ncd /usr/local/zookeeper/\nmkdir {zookeeper1,zookeeper2,zookeeper3}\nmkdir -p /mnt/zookerper/{zookeeper1/{data,logs},zookeeper2/{data,logs},zookeeper3/{data,logs}}\n```\n\n### 3.2、zookeeper2配置\n\nzookeeper1 配置文件conf/zoo.cfg修改如下：\n```\ntickTime=2000\ndataDir=/mnt/zookerper/zookeeper1/data\ndataLogDir=/mnt/zookerper/zookeeper1/logs\nclientPort=2181\ninitLimit=5\nsyncLimit=2\nserver.1=192.168.220.128:2888:3888\nserver.2=192.168.220.128:4888:5888\nserver.3=192.168.220.128:6888:7888\n```\nzookeeper1的data/myid配置如下：\n```\necho '1' > /mnt/zookerper/zookeeper1/data/myid\n```\n### 3.3、zookeeper2配置\nzookeeper2 配置文件conf/zoo.cfg修改如下：\n```\ntickTime=2000\ndataDir=/mnt/zookerper/zookeeper2/data\ndataLogDir=/mnt/zookerper/zookeeper2/logs\nclientPort=2181\ninitLimit=5\nsyncLimit=2\nserver.1=192.168.220.128:2888:3888\nserver.2=192.168.220.128:4888:5888\nserver.3=192.168.220.128:6888:7888\n```\nzookeeper2的data/myid配置如下：\n```\necho '2' > /mnt/zookerper/zookeeper2/data/myid\n```\n\n### 3.4、zookeeper3配置\nzookeeper3 配置文件conf/zoo.cfg修改如下：\n```\ntickTime=2000\ndataDir=/mnt/zookerper/zookeeper3/data\ndataLogDir=/mnt/zookerper/zookeeper3/logs\nclientPort=2181\ninitLimit=5\nsyncLimit=2\nserver.1=192.168.220.128:2888:3888\nserver.2=192.168.220.128:4888:5888\nserver.3=192.168.220.128:6888:7888\n```\nzookeeper1的data/myid配置如下：\n```\necho '3' > /mnt/zookerper/zookeeper3/data/myid\n```\n### 3.5、启动和停止\n\n进入bin目录，启动、停止、重启分和查看当前节点状态（包括集群中是何角色）别执行：\n```\n./zkServer.sh start\n./zkServer.sh stop\n./zkServer.sh restart\n./zkServer.sh status\n```\n<hr>\n\n## 四、集群模式\n\n集群模式就是在不同主机上安装zookeeper然后组成集群的模式；下边以在192.168.220.128/129/130三台主机为例。\n\n将第1.1到1.3步中安装好的zookeeper打包复制到129和130上，并都解压到同样的目录下。\n\n### 4.1、conf/zoo.cfg文件修改\n三个zookeeper的conf/zoo.cfg修改如下：\n```\ntickTime=2000\ndataDir=/usr/myapp/zookeeper-3.4.5/data\ndataLogDir=/usr/myapp/zookeeper-3.4.5/logs\nclientPort=2181\ninitLimit=5\nsyncLimit=2\nserver.1=192.168.220.128:2888:3888\nserver.2=192.168.220.129:2888:3888\nserver.3=192.168.220.130:2888:3888\n```\n对于129和130，由于安装目录都是zookeeper-3.4.5所以dataDir和dataLogDir不需要改变，又由于在不同机器上所以clientPort也不需要改变\n\n所以此时129和130的conf/zoo.cfg的内容与128一样即可。\n\n### 4.2、data/myid文件修改\n\n128 data/myid修改如下：\n```\necho '1' > data/myid\n```\n129 data/myid修改如下：\n```\necho '2' > data/myid\n```\n130 data/myid修改如下：\n```\necho '3' > data/myid\n```\n\n<hr>\n\n## 五、测试集群是否启动成功\n\n```\nbin/zkCli.sh  -server 127.0.0.1:2181,127.0.0.1:2182,127.0.0.1:2183\n\nls /brokers/ids\n[1, 2, 3]\n```\n\n\n\n<hr>\n\n## 六、配置文件详解\n\n```\ntickTime=2000:\ntickTime这个时间是作为Zookeeper服务器之间或客户端与服务器之间维持心跳的时间间隔,也就是每个tickTime时间就会发送一个心跳；\n\ninitLimit=10:\ninitLimit这个配置项是用来配置Zookeeper接受客户端（这里所说的客户端不是用户连接Zookeeper服务器的客户端,而是Zookeeper服务器集群中连接到Leader的Follower 服务器）初始化连接时最长能忍受多少个心跳时间间隔数。\n当已经超过10个心跳的时间（也就是tickTime）长度后 Zookeeper 服务器还没有收到客户端的返回信息,那么表明这个客户端连接失败。总的时间长度就是 10*2000=20 秒；\n\nsyncLimit=5:\nsyncLimit这个配置项标识Leader与Follower之间发送消息,请求和应答时间长度,最长不能超过多少个tickTime的时间长度,总的时间长度就是5*2000=10秒；\n\ndataDir=/export/search/zookeeper-cluster/zookeeper-3.4.6-node1/data\ndataDir顾名思义就是Zookeeper保存数据的目录,默认情况下Zookeeper将写数据的日志文件也保存在这个目录里；\ndatailogDir=/usr/local/zookeeper-cluster/zookeeper-3.5.2-node1/datalog\n事物日志的存储路径，如果不配置这个那么事物日志会默认存储到dataDir制定的目录，这样会严重影响zk的性能，当zk吞吐量较大的时候，产生的事物日志、快照日志太多\nclientPort=2181\nclientPort这个端口就是客户端连接Zookeeper服务器的端口,Zookeeper会监听这个端口接受客户端的访问请求；\n\nserver.1=localhost:2887:3887\nserver.2=localhost:2888:3888\nserver.3=localhost:2889:3889\nserver.A=B：C：D：\nA是一个数字,表示这个是第几号服务器,B是这个服务器的ip地址\nC第一个端口用来集群成员的信息交换,表示的是这个服务器与集群中的Leader服务器交换信息的端口\nD是在leader挂掉时专门用来进行选举leader所用\n\n#autopurge.purgeInterval  这个参数指定了清理频率，单位是小时，需要填写一个1或更大的整数，默认是0，表示不开启自己清理功能。\n#autopurge.snapRetainCount 这个参数和上面的参数搭配使用，这个参数指定了需要保留的文件数目。默认是保留3个。\n```\n\n\n\n## 七、supervisor管理\n\n`vim bin/zkEnv.sh`在最上面增加环境路径\n\n```\nJAVA_HOME=/usr/local/java\nexport JAVA_HOME\n```\n\n`vim /etc/supervisor/zookeeper.conf`\n\n```\n[program:zookeeper]\ncommand=/usr/local/zookeeper-3.5.2-alpha/bin/zkServer.sh start-foreground\nautostart=true\nautorestart=true\nstartsecs=10\nstdout_logfile=/var/log/zookeeper.log\nstdout_logfile_maxbytes=1MB\nstdout_logfile_backups=10\nstdout_capture_maxbytes=1MB\nstderr_logfile=/var/log/zookeeper.log\nstderr_logfile_maxbytes=1MB\nstderr_logfile_backups=10\nstderr_capture_maxbytes=1MB\n```\n\n\n\n##八、报错及处理\n\n应用连接zookeepr报错：Session 0x0 for server 192.168.220.128/192.168.220.128:2181,unexpected error,closing socket connection and attempting reconnect；\n\n先看端口能否telnet通，如果通则使用./zkServer.sh status查看zk是否确实已启动，没启查看bin/zookeeper.out中的报错。\n\nbin/zookeeper.out中报错：“zookeeper address already in use”；显然端口被占用，要么是其他进程占用了配置的端口，要么是上边配置的clientPort和server中的端口有重复。\n\nbin/zookeeper.out中报错：Cannot open channel to 2 at election address /192.168.220.130:3888；这应该只是组成集群的130节点未启动，到130启动起来zk即会正常。\n\n","slug":"zookeeper安装","published":1,"updated":"2021-06-18T08:07:11.205Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cku6979y6001900uh088vewxl","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><h2 id=\"一、-准备\"><a href=\"#一、-准备\" class=\"headerlink\" title=\"一、 准备\"></a>一、 准备</h2><ul>\n<li>安装JDK</li>\n<li>准备 安装包 <a href=\"http://archive.apache.org/dist/zookeeper/\">http://archive.apache.org/dist/zookeeper/</a></li>\n<li>官方手册<br><a href=\"http://zookeeper.apache.org/doc/r3.4.6/zookeeperStarted.html\">http://zookeeper.apache.org/doc/r3.4.6/zookeeperStarted.html</a></li>\n</ul>\n<h2 id=\"二、单机安装\"><a href=\"#二、单机安装\" class=\"headerlink\" title=\"二、单机安装\"></a>二、单机安装</h2><h3 id=\"2-1、解压安装包\"><a href=\"#2-1、解压安装包\" class=\"headerlink\" title=\"2.1、解压安装包\"></a>2.1、解压安装包</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> /usr/<span class=\"built_in\">local</span>/src</span><br><span class=\"line\">tar -zxf zookeeper-3.4.9.tar.gz -C /usr/<span class=\"built_in\">local</span>/</span><br></pre></td></tr></table></figure>\n<h3 id=\"2-2、配置\"><a href=\"#2-2、配置\" class=\"headerlink\" title=\"2.2、配置\"></a>2.2、配置</h3><p>创建data和logs 目录</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir -p /mnt/zookeeper/&#123;data,logs&#125;</span><br></pre></td></tr></table></figure>\n<p>新建<code>zoo.cfg</code> 文件,写入以下内容保存：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tickTime&#x3D;2000</span><br><span class=\"line\">dataDir&#x3D;&#x2F;usr&#x2F;myapp&#x2F;zookeeper-3.4.5&#x2F;data</span><br><span class=\"line\">dataLogDir&#x3D;&#x2F;usr&#x2F;myapp&#x2F;zookeeper-3.4.5&#x2F;logs</span><br><span class=\"line\">clientPort&#x3D;2181</span><br></pre></td></tr></table></figure>\n<h3 id=\"2-3、启动和停止\"><a href=\"#2-3、启动和停止\" class=\"headerlink\" title=\"2.3、启动和停止\"></a>2.3、启动和停止</h3><p>进入bin目录，启动、停止、重启分和查看当前节点状态（包括集群中是何角色）别执行：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">.&#x2F;zkServer.sh start</span><br><span class=\"line\">.&#x2F;zkServer.sh stop</span><br><span class=\"line\">.&#x2F;zkServer.sh restart</span><br><span class=\"line\">.&#x2F;zkServer.sh status</span><br></pre></td></tr></table></figure>\n\n<hr/>\n\n<h2 id=\"三、伪集群模式\"><a href=\"#三、伪集群模式\" class=\"headerlink\" title=\"三、伪集群模式\"></a>三、伪集群模式</h2><p>伪集群模式就是在同一主机启动多个zookeeper并组成集群，下边以在192.168.220.128主机上创3个zookeeper组集群为例。</p>\n<p>将通过第一大点安装的zookeeper，复制成zookeeper1/zookeeper2/zookeeper3三份</p>\n<h3 id=\"3-1、准备\"><a href=\"#3-1、准备\" class=\"headerlink\" title=\"3.1、准备\"></a>3.1、准备</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd &#x2F;usr&#x2F;local&#x2F;zookeeper&#x2F;</span><br><span class=\"line\">mkdir &#123;zookeeper1,zookeeper2,zookeeper3&#125;</span><br><span class=\"line\">mkdir -p &#x2F;mnt&#x2F;zookerper&#x2F;&#123;zookeeper1&#x2F;&#123;data,logs&#125;,zookeeper2&#x2F;&#123;data,logs&#125;,zookeeper3&#x2F;&#123;data,logs&#125;&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"3-2、zookeeper2配置\"><a href=\"#3-2、zookeeper2配置\" class=\"headerlink\" title=\"3.2、zookeeper2配置\"></a>3.2、zookeeper2配置</h3><p>zookeeper1 配置文件conf/zoo.cfg修改如下：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tickTime&#x3D;2000</span><br><span class=\"line\">dataDir&#x3D;&#x2F;mnt&#x2F;zookerper&#x2F;zookeeper1&#x2F;data</span><br><span class=\"line\">dataLogDir&#x3D;&#x2F;mnt&#x2F;zookerper&#x2F;zookeeper1&#x2F;logs</span><br><span class=\"line\">clientPort&#x3D;2181</span><br><span class=\"line\">initLimit&#x3D;5</span><br><span class=\"line\">syncLimit&#x3D;2</span><br><span class=\"line\">server.1&#x3D;192.168.220.128:2888:3888</span><br><span class=\"line\">server.2&#x3D;192.168.220.128:4888:5888</span><br><span class=\"line\">server.3&#x3D;192.168.220.128:6888:7888</span><br></pre></td></tr></table></figure>\n<p>zookeeper1的data/myid配置如下：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">echo &#39;1&#39; &gt; &#x2F;mnt&#x2F;zookerper&#x2F;zookeeper1&#x2F;data&#x2F;myid</span><br></pre></td></tr></table></figure>\n<h3 id=\"3-3、zookeeper2配置\"><a href=\"#3-3、zookeeper2配置\" class=\"headerlink\" title=\"3.3、zookeeper2配置\"></a>3.3、zookeeper2配置</h3><p>zookeeper2 配置文件conf/zoo.cfg修改如下：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tickTime&#x3D;2000</span><br><span class=\"line\">dataDir&#x3D;&#x2F;mnt&#x2F;zookerper&#x2F;zookeeper2&#x2F;data</span><br><span class=\"line\">dataLogDir&#x3D;&#x2F;mnt&#x2F;zookerper&#x2F;zookeeper2&#x2F;logs</span><br><span class=\"line\">clientPort&#x3D;2181</span><br><span class=\"line\">initLimit&#x3D;5</span><br><span class=\"line\">syncLimit&#x3D;2</span><br><span class=\"line\">server.1&#x3D;192.168.220.128:2888:3888</span><br><span class=\"line\">server.2&#x3D;192.168.220.128:4888:5888</span><br><span class=\"line\">server.3&#x3D;192.168.220.128:6888:7888</span><br></pre></td></tr></table></figure>\n<p>zookeeper2的data/myid配置如下：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">echo &#39;2&#39; &gt; &#x2F;mnt&#x2F;zookerper&#x2F;zookeeper2&#x2F;data&#x2F;myid</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"3-4、zookeeper3配置\"><a href=\"#3-4、zookeeper3配置\" class=\"headerlink\" title=\"3.4、zookeeper3配置\"></a>3.4、zookeeper3配置</h3><p>zookeeper3 配置文件conf/zoo.cfg修改如下：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tickTime&#x3D;2000</span><br><span class=\"line\">dataDir&#x3D;&#x2F;mnt&#x2F;zookerper&#x2F;zookeeper3&#x2F;data</span><br><span class=\"line\">dataLogDir&#x3D;&#x2F;mnt&#x2F;zookerper&#x2F;zookeeper3&#x2F;logs</span><br><span class=\"line\">clientPort&#x3D;2181</span><br><span class=\"line\">initLimit&#x3D;5</span><br><span class=\"line\">syncLimit&#x3D;2</span><br><span class=\"line\">server.1&#x3D;192.168.220.128:2888:3888</span><br><span class=\"line\">server.2&#x3D;192.168.220.128:4888:5888</span><br><span class=\"line\">server.3&#x3D;192.168.220.128:6888:7888</span><br></pre></td></tr></table></figure>\n<p>zookeeper1的data/myid配置如下：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">echo &#39;3&#39; &gt; &#x2F;mnt&#x2F;zookerper&#x2F;zookeeper3&#x2F;data&#x2F;myid</span><br></pre></td></tr></table></figure>\n<h3 id=\"3-5、启动和停止\"><a href=\"#3-5、启动和停止\" class=\"headerlink\" title=\"3.5、启动和停止\"></a>3.5、启动和停止</h3><p>进入bin目录，启动、停止、重启分和查看当前节点状态（包括集群中是何角色）别执行：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">.&#x2F;zkServer.sh start</span><br><span class=\"line\">.&#x2F;zkServer.sh stop</span><br><span class=\"line\">.&#x2F;zkServer.sh restart</span><br><span class=\"line\">.&#x2F;zkServer.sh status</span><br></pre></td></tr></table></figure>\n<hr>\n\n<h2 id=\"四、集群模式\"><a href=\"#四、集群模式\" class=\"headerlink\" title=\"四、集群模式\"></a>四、集群模式</h2><p>集群模式就是在不同主机上安装zookeeper然后组成集群的模式；下边以在192.168.220.128/129/130三台主机为例。</p>\n<p>将第1.1到1.3步中安装好的zookeeper打包复制到129和130上，并都解压到同样的目录下。</p>\n<h3 id=\"4-1、conf-zoo-cfg文件修改\"><a href=\"#4-1、conf-zoo-cfg文件修改\" class=\"headerlink\" title=\"4.1、conf/zoo.cfg文件修改\"></a>4.1、conf/zoo.cfg文件修改</h3><p>三个zookeeper的conf/zoo.cfg修改如下：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tickTime&#x3D;2000</span><br><span class=\"line\">dataDir&#x3D;&#x2F;usr&#x2F;myapp&#x2F;zookeeper-3.4.5&#x2F;data</span><br><span class=\"line\">dataLogDir&#x3D;&#x2F;usr&#x2F;myapp&#x2F;zookeeper-3.4.5&#x2F;logs</span><br><span class=\"line\">clientPort&#x3D;2181</span><br><span class=\"line\">initLimit&#x3D;5</span><br><span class=\"line\">syncLimit&#x3D;2</span><br><span class=\"line\">server.1&#x3D;192.168.220.128:2888:3888</span><br><span class=\"line\">server.2&#x3D;192.168.220.129:2888:3888</span><br><span class=\"line\">server.3&#x3D;192.168.220.130:2888:3888</span><br></pre></td></tr></table></figure>\n<p>对于129和130，由于安装目录都是zookeeper-3.4.5所以dataDir和dataLogDir不需要改变，又由于在不同机器上所以clientPort也不需要改变</p>\n<p>所以此时129和130的conf/zoo.cfg的内容与128一样即可。</p>\n<h3 id=\"4-2、data-myid文件修改\"><a href=\"#4-2、data-myid文件修改\" class=\"headerlink\" title=\"4.2、data/myid文件修改\"></a>4.2、data/myid文件修改</h3><p>128 data/myid修改如下：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">echo &#39;1&#39; &gt; data&#x2F;myid</span><br></pre></td></tr></table></figure>\n<p>129 data/myid修改如下：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">echo &#39;2&#39; &gt; data&#x2F;myid</span><br></pre></td></tr></table></figure>\n<p>130 data/myid修改如下：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">echo &#39;3&#39; &gt; data&#x2F;myid</span><br></pre></td></tr></table></figure>\n\n<hr>\n\n<h2 id=\"五、测试集群是否启动成功\"><a href=\"#五、测试集群是否启动成功\" class=\"headerlink\" title=\"五、测试集群是否启动成功\"></a>五、测试集群是否启动成功</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">bin&#x2F;zkCli.sh  -server 127.0.0.1:2181,127.0.0.1:2182,127.0.0.1:2183</span><br><span class=\"line\"></span><br><span class=\"line\">ls &#x2F;brokers&#x2F;ids</span><br><span class=\"line\">[1, 2, 3]</span><br></pre></td></tr></table></figure>\n\n\n\n<hr>\n\n<h2 id=\"六、配置文件详解\"><a href=\"#六、配置文件详解\" class=\"headerlink\" title=\"六、配置文件详解\"></a>六、配置文件详解</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tickTime&#x3D;2000:</span><br><span class=\"line\">tickTime这个时间是作为Zookeeper服务器之间或客户端与服务器之间维持心跳的时间间隔,也就是每个tickTime时间就会发送一个心跳；</span><br><span class=\"line\"></span><br><span class=\"line\">initLimit&#x3D;10:</span><br><span class=\"line\">initLimit这个配置项是用来配置Zookeeper接受客户端（这里所说的客户端不是用户连接Zookeeper服务器的客户端,而是Zookeeper服务器集群中连接到Leader的Follower 服务器）初始化连接时最长能忍受多少个心跳时间间隔数。</span><br><span class=\"line\">当已经超过10个心跳的时间（也就是tickTime）长度后 Zookeeper 服务器还没有收到客户端的返回信息,那么表明这个客户端连接失败。总的时间长度就是 10*2000&#x3D;20 秒；</span><br><span class=\"line\"></span><br><span class=\"line\">syncLimit&#x3D;5:</span><br><span class=\"line\">syncLimit这个配置项标识Leader与Follower之间发送消息,请求和应答时间长度,最长不能超过多少个tickTime的时间长度,总的时间长度就是5*2000&#x3D;10秒；</span><br><span class=\"line\"></span><br><span class=\"line\">dataDir&#x3D;&#x2F;export&#x2F;search&#x2F;zookeeper-cluster&#x2F;zookeeper-3.4.6-node1&#x2F;data</span><br><span class=\"line\">dataDir顾名思义就是Zookeeper保存数据的目录,默认情况下Zookeeper将写数据的日志文件也保存在这个目录里；</span><br><span class=\"line\">datailogDir&#x3D;&#x2F;usr&#x2F;local&#x2F;zookeeper-cluster&#x2F;zookeeper-3.5.2-node1&#x2F;datalog</span><br><span class=\"line\">事物日志的存储路径，如果不配置这个那么事物日志会默认存储到dataDir制定的目录，这样会严重影响zk的性能，当zk吞吐量较大的时候，产生的事物日志、快照日志太多</span><br><span class=\"line\">clientPort&#x3D;2181</span><br><span class=\"line\">clientPort这个端口就是客户端连接Zookeeper服务器的端口,Zookeeper会监听这个端口接受客户端的访问请求；</span><br><span class=\"line\"></span><br><span class=\"line\">server.1&#x3D;localhost:2887:3887</span><br><span class=\"line\">server.2&#x3D;localhost:2888:3888</span><br><span class=\"line\">server.3&#x3D;localhost:2889:3889</span><br><span class=\"line\">server.A&#x3D;B：C：D：</span><br><span class=\"line\">A是一个数字,表示这个是第几号服务器,B是这个服务器的ip地址</span><br><span class=\"line\">C第一个端口用来集群成员的信息交换,表示的是这个服务器与集群中的Leader服务器交换信息的端口</span><br><span class=\"line\">D是在leader挂掉时专门用来进行选举leader所用</span><br><span class=\"line\"></span><br><span class=\"line\">#autopurge.purgeInterval  这个参数指定了清理频率，单位是小时，需要填写一个1或更大的整数，默认是0，表示不开启自己清理功能。</span><br><span class=\"line\">#autopurge.snapRetainCount 这个参数和上面的参数搭配使用，这个参数指定了需要保留的文件数目。默认是保留3个。</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"七、supervisor管理\"><a href=\"#七、supervisor管理\" class=\"headerlink\" title=\"七、supervisor管理\"></a>七、supervisor管理</h2><p><code>vim bin/zkEnv.sh</code>在最上面增加环境路径</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">JAVA_HOME&#x3D;&#x2F;usr&#x2F;local&#x2F;java</span><br><span class=\"line\">export JAVA_HOME</span><br></pre></td></tr></table></figure>\n\n<p><code>vim /etc/supervisor/zookeeper.conf</code></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[program:zookeeper]</span><br><span class=\"line\">command&#x3D;&#x2F;usr&#x2F;local&#x2F;zookeeper-3.5.2-alpha&#x2F;bin&#x2F;zkServer.sh start-foreground</span><br><span class=\"line\">autostart&#x3D;true</span><br><span class=\"line\">autorestart&#x3D;true</span><br><span class=\"line\">startsecs&#x3D;10</span><br><span class=\"line\">stdout_logfile&#x3D;&#x2F;var&#x2F;log&#x2F;zookeeper.log</span><br><span class=\"line\">stdout_logfile_maxbytes&#x3D;1MB</span><br><span class=\"line\">stdout_logfile_backups&#x3D;10</span><br><span class=\"line\">stdout_capture_maxbytes&#x3D;1MB</span><br><span class=\"line\">stderr_logfile&#x3D;&#x2F;var&#x2F;log&#x2F;zookeeper.log</span><br><span class=\"line\">stderr_logfile_maxbytes&#x3D;1MB</span><br><span class=\"line\">stderr_logfile_backups&#x3D;10</span><br><span class=\"line\">stderr_capture_maxbytes&#x3D;1MB</span><br></pre></td></tr></table></figure>\n\n\n\n<p>##八、报错及处理</p>\n<p>应用连接zookeepr报错：Session 0x0 for server 192.168.220.128/192.168.220.128:2181,unexpected error,closing socket connection and attempting reconnect；</p>\n<p>先看端口能否telnet通，如果通则使用./zkServer.sh status查看zk是否确实已启动，没启查看bin/zookeeper.out中的报错。</p>\n<p>bin/zookeeper.out中报错：“zookeeper address already in use”；显然端口被占用，要么是其他进程占用了配置的端口，要么是上边配置的clientPort和server中的端口有重复。</p>\n<p>bin/zookeeper.out中报错：Cannot open channel to 2 at election address /192.168.220.130:3888；这应该只是组成集群的130节点未启动，到130启动起来zk即会正常。</p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"一、-准备\"><a href=\"#一、-准备\" class=\"headerlink\" title=\"一、 准备\"></a>一、 准备</h2><ul>\n<li>安装JDK</li>\n<li>准备 安装包 <a href=\"http://archive.apache.org/dist/zookeeper/\">http://archive.apache.org/dist/zookeeper/</a></li>\n<li>官方手册<br><a href=\"http://zookeeper.apache.org/doc/r3.4.6/zookeeperStarted.html\">http://zookeeper.apache.org/doc/r3.4.6/zookeeperStarted.html</a></li>\n</ul>\n<h2 id=\"二、单机安装\"><a href=\"#二、单机安装\" class=\"headerlink\" title=\"二、单机安装\"></a>二、单机安装</h2><h3 id=\"2-1、解压安装包\"><a href=\"#2-1、解压安装包\" class=\"headerlink\" title=\"2.1、解压安装包\"></a>2.1、解压安装包</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> /usr/<span class=\"built_in\">local</span>/src</span><br><span class=\"line\">tar -zxf zookeeper-3.4.9.tar.gz -C /usr/<span class=\"built_in\">local</span>/</span><br></pre></td></tr></table></figure>\n<h3 id=\"2-2、配置\"><a href=\"#2-2、配置\" class=\"headerlink\" title=\"2.2、配置\"></a>2.2、配置</h3><p>创建data和logs 目录</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir -p /mnt/zookeeper/&#123;data,logs&#125;</span><br></pre></td></tr></table></figure>\n<p>新建<code>zoo.cfg</code> 文件,写入以下内容保存：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tickTime&#x3D;2000</span><br><span class=\"line\">dataDir&#x3D;&#x2F;usr&#x2F;myapp&#x2F;zookeeper-3.4.5&#x2F;data</span><br><span class=\"line\">dataLogDir&#x3D;&#x2F;usr&#x2F;myapp&#x2F;zookeeper-3.4.5&#x2F;logs</span><br><span class=\"line\">clientPort&#x3D;2181</span><br></pre></td></tr></table></figure>\n<h3 id=\"2-3、启动和停止\"><a href=\"#2-3、启动和停止\" class=\"headerlink\" title=\"2.3、启动和停止\"></a>2.3、启动和停止</h3><p>进入bin目录，启动、停止、重启分和查看当前节点状态（包括集群中是何角色）别执行：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">.&#x2F;zkServer.sh start</span><br><span class=\"line\">.&#x2F;zkServer.sh stop</span><br><span class=\"line\">.&#x2F;zkServer.sh restart</span><br><span class=\"line\">.&#x2F;zkServer.sh status</span><br></pre></td></tr></table></figure>\n\n<hr/>\n\n<h2 id=\"三、伪集群模式\"><a href=\"#三、伪集群模式\" class=\"headerlink\" title=\"三、伪集群模式\"></a>三、伪集群模式</h2><p>伪集群模式就是在同一主机启动多个zookeeper并组成集群，下边以在192.168.220.128主机上创3个zookeeper组集群为例。</p>\n<p>将通过第一大点安装的zookeeper，复制成zookeeper1/zookeeper2/zookeeper3三份</p>\n<h3 id=\"3-1、准备\"><a href=\"#3-1、准备\" class=\"headerlink\" title=\"3.1、准备\"></a>3.1、准备</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd &#x2F;usr&#x2F;local&#x2F;zookeeper&#x2F;</span><br><span class=\"line\">mkdir &#123;zookeeper1,zookeeper2,zookeeper3&#125;</span><br><span class=\"line\">mkdir -p &#x2F;mnt&#x2F;zookerper&#x2F;&#123;zookeeper1&#x2F;&#123;data,logs&#125;,zookeeper2&#x2F;&#123;data,logs&#125;,zookeeper3&#x2F;&#123;data,logs&#125;&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"3-2、zookeeper2配置\"><a href=\"#3-2、zookeeper2配置\" class=\"headerlink\" title=\"3.2、zookeeper2配置\"></a>3.2、zookeeper2配置</h3><p>zookeeper1 配置文件conf/zoo.cfg修改如下：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tickTime&#x3D;2000</span><br><span class=\"line\">dataDir&#x3D;&#x2F;mnt&#x2F;zookerper&#x2F;zookeeper1&#x2F;data</span><br><span class=\"line\">dataLogDir&#x3D;&#x2F;mnt&#x2F;zookerper&#x2F;zookeeper1&#x2F;logs</span><br><span class=\"line\">clientPort&#x3D;2181</span><br><span class=\"line\">initLimit&#x3D;5</span><br><span class=\"line\">syncLimit&#x3D;2</span><br><span class=\"line\">server.1&#x3D;192.168.220.128:2888:3888</span><br><span class=\"line\">server.2&#x3D;192.168.220.128:4888:5888</span><br><span class=\"line\">server.3&#x3D;192.168.220.128:6888:7888</span><br></pre></td></tr></table></figure>\n<p>zookeeper1的data/myid配置如下：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">echo &#39;1&#39; &gt; &#x2F;mnt&#x2F;zookerper&#x2F;zookeeper1&#x2F;data&#x2F;myid</span><br></pre></td></tr></table></figure>\n<h3 id=\"3-3、zookeeper2配置\"><a href=\"#3-3、zookeeper2配置\" class=\"headerlink\" title=\"3.3、zookeeper2配置\"></a>3.3、zookeeper2配置</h3><p>zookeeper2 配置文件conf/zoo.cfg修改如下：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tickTime&#x3D;2000</span><br><span class=\"line\">dataDir&#x3D;&#x2F;mnt&#x2F;zookerper&#x2F;zookeeper2&#x2F;data</span><br><span class=\"line\">dataLogDir&#x3D;&#x2F;mnt&#x2F;zookerper&#x2F;zookeeper2&#x2F;logs</span><br><span class=\"line\">clientPort&#x3D;2181</span><br><span class=\"line\">initLimit&#x3D;5</span><br><span class=\"line\">syncLimit&#x3D;2</span><br><span class=\"line\">server.1&#x3D;192.168.220.128:2888:3888</span><br><span class=\"line\">server.2&#x3D;192.168.220.128:4888:5888</span><br><span class=\"line\">server.3&#x3D;192.168.220.128:6888:7888</span><br></pre></td></tr></table></figure>\n<p>zookeeper2的data/myid配置如下：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">echo &#39;2&#39; &gt; &#x2F;mnt&#x2F;zookerper&#x2F;zookeeper2&#x2F;data&#x2F;myid</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"3-4、zookeeper3配置\"><a href=\"#3-4、zookeeper3配置\" class=\"headerlink\" title=\"3.4、zookeeper3配置\"></a>3.4、zookeeper3配置</h3><p>zookeeper3 配置文件conf/zoo.cfg修改如下：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tickTime&#x3D;2000</span><br><span class=\"line\">dataDir&#x3D;&#x2F;mnt&#x2F;zookerper&#x2F;zookeeper3&#x2F;data</span><br><span class=\"line\">dataLogDir&#x3D;&#x2F;mnt&#x2F;zookerper&#x2F;zookeeper3&#x2F;logs</span><br><span class=\"line\">clientPort&#x3D;2181</span><br><span class=\"line\">initLimit&#x3D;5</span><br><span class=\"line\">syncLimit&#x3D;2</span><br><span class=\"line\">server.1&#x3D;192.168.220.128:2888:3888</span><br><span class=\"line\">server.2&#x3D;192.168.220.128:4888:5888</span><br><span class=\"line\">server.3&#x3D;192.168.220.128:6888:7888</span><br></pre></td></tr></table></figure>\n<p>zookeeper1的data/myid配置如下：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">echo &#39;3&#39; &gt; &#x2F;mnt&#x2F;zookerper&#x2F;zookeeper3&#x2F;data&#x2F;myid</span><br></pre></td></tr></table></figure>\n<h3 id=\"3-5、启动和停止\"><a href=\"#3-5、启动和停止\" class=\"headerlink\" title=\"3.5、启动和停止\"></a>3.5、启动和停止</h3><p>进入bin目录，启动、停止、重启分和查看当前节点状态（包括集群中是何角色）别执行：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">.&#x2F;zkServer.sh start</span><br><span class=\"line\">.&#x2F;zkServer.sh stop</span><br><span class=\"line\">.&#x2F;zkServer.sh restart</span><br><span class=\"line\">.&#x2F;zkServer.sh status</span><br></pre></td></tr></table></figure>\n<hr>\n\n<h2 id=\"四、集群模式\"><a href=\"#四、集群模式\" class=\"headerlink\" title=\"四、集群模式\"></a>四、集群模式</h2><p>集群模式就是在不同主机上安装zookeeper然后组成集群的模式；下边以在192.168.220.128/129/130三台主机为例。</p>\n<p>将第1.1到1.3步中安装好的zookeeper打包复制到129和130上，并都解压到同样的目录下。</p>\n<h3 id=\"4-1、conf-zoo-cfg文件修改\"><a href=\"#4-1、conf-zoo-cfg文件修改\" class=\"headerlink\" title=\"4.1、conf/zoo.cfg文件修改\"></a>4.1、conf/zoo.cfg文件修改</h3><p>三个zookeeper的conf/zoo.cfg修改如下：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tickTime&#x3D;2000</span><br><span class=\"line\">dataDir&#x3D;&#x2F;usr&#x2F;myapp&#x2F;zookeeper-3.4.5&#x2F;data</span><br><span class=\"line\">dataLogDir&#x3D;&#x2F;usr&#x2F;myapp&#x2F;zookeeper-3.4.5&#x2F;logs</span><br><span class=\"line\">clientPort&#x3D;2181</span><br><span class=\"line\">initLimit&#x3D;5</span><br><span class=\"line\">syncLimit&#x3D;2</span><br><span class=\"line\">server.1&#x3D;192.168.220.128:2888:3888</span><br><span class=\"line\">server.2&#x3D;192.168.220.129:2888:3888</span><br><span class=\"line\">server.3&#x3D;192.168.220.130:2888:3888</span><br></pre></td></tr></table></figure>\n<p>对于129和130，由于安装目录都是zookeeper-3.4.5所以dataDir和dataLogDir不需要改变，又由于在不同机器上所以clientPort也不需要改变</p>\n<p>所以此时129和130的conf/zoo.cfg的内容与128一样即可。</p>\n<h3 id=\"4-2、data-myid文件修改\"><a href=\"#4-2、data-myid文件修改\" class=\"headerlink\" title=\"4.2、data/myid文件修改\"></a>4.2、data/myid文件修改</h3><p>128 data/myid修改如下：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">echo &#39;1&#39; &gt; data&#x2F;myid</span><br></pre></td></tr></table></figure>\n<p>129 data/myid修改如下：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">echo &#39;2&#39; &gt; data&#x2F;myid</span><br></pre></td></tr></table></figure>\n<p>130 data/myid修改如下：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">echo &#39;3&#39; &gt; data&#x2F;myid</span><br></pre></td></tr></table></figure>\n\n<hr>\n\n<h2 id=\"五、测试集群是否启动成功\"><a href=\"#五、测试集群是否启动成功\" class=\"headerlink\" title=\"五、测试集群是否启动成功\"></a>五、测试集群是否启动成功</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">bin&#x2F;zkCli.sh  -server 127.0.0.1:2181,127.0.0.1:2182,127.0.0.1:2183</span><br><span class=\"line\"></span><br><span class=\"line\">ls &#x2F;brokers&#x2F;ids</span><br><span class=\"line\">[1, 2, 3]</span><br></pre></td></tr></table></figure>\n\n\n\n<hr>\n\n<h2 id=\"六、配置文件详解\"><a href=\"#六、配置文件详解\" class=\"headerlink\" title=\"六、配置文件详解\"></a>六、配置文件详解</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tickTime&#x3D;2000:</span><br><span class=\"line\">tickTime这个时间是作为Zookeeper服务器之间或客户端与服务器之间维持心跳的时间间隔,也就是每个tickTime时间就会发送一个心跳；</span><br><span class=\"line\"></span><br><span class=\"line\">initLimit&#x3D;10:</span><br><span class=\"line\">initLimit这个配置项是用来配置Zookeeper接受客户端（这里所说的客户端不是用户连接Zookeeper服务器的客户端,而是Zookeeper服务器集群中连接到Leader的Follower 服务器）初始化连接时最长能忍受多少个心跳时间间隔数。</span><br><span class=\"line\">当已经超过10个心跳的时间（也就是tickTime）长度后 Zookeeper 服务器还没有收到客户端的返回信息,那么表明这个客户端连接失败。总的时间长度就是 10*2000&#x3D;20 秒；</span><br><span class=\"line\"></span><br><span class=\"line\">syncLimit&#x3D;5:</span><br><span class=\"line\">syncLimit这个配置项标识Leader与Follower之间发送消息,请求和应答时间长度,最长不能超过多少个tickTime的时间长度,总的时间长度就是5*2000&#x3D;10秒；</span><br><span class=\"line\"></span><br><span class=\"line\">dataDir&#x3D;&#x2F;export&#x2F;search&#x2F;zookeeper-cluster&#x2F;zookeeper-3.4.6-node1&#x2F;data</span><br><span class=\"line\">dataDir顾名思义就是Zookeeper保存数据的目录,默认情况下Zookeeper将写数据的日志文件也保存在这个目录里；</span><br><span class=\"line\">datailogDir&#x3D;&#x2F;usr&#x2F;local&#x2F;zookeeper-cluster&#x2F;zookeeper-3.5.2-node1&#x2F;datalog</span><br><span class=\"line\">事物日志的存储路径，如果不配置这个那么事物日志会默认存储到dataDir制定的目录，这样会严重影响zk的性能，当zk吞吐量较大的时候，产生的事物日志、快照日志太多</span><br><span class=\"line\">clientPort&#x3D;2181</span><br><span class=\"line\">clientPort这个端口就是客户端连接Zookeeper服务器的端口,Zookeeper会监听这个端口接受客户端的访问请求；</span><br><span class=\"line\"></span><br><span class=\"line\">server.1&#x3D;localhost:2887:3887</span><br><span class=\"line\">server.2&#x3D;localhost:2888:3888</span><br><span class=\"line\">server.3&#x3D;localhost:2889:3889</span><br><span class=\"line\">server.A&#x3D;B：C：D：</span><br><span class=\"line\">A是一个数字,表示这个是第几号服务器,B是这个服务器的ip地址</span><br><span class=\"line\">C第一个端口用来集群成员的信息交换,表示的是这个服务器与集群中的Leader服务器交换信息的端口</span><br><span class=\"line\">D是在leader挂掉时专门用来进行选举leader所用</span><br><span class=\"line\"></span><br><span class=\"line\">#autopurge.purgeInterval  这个参数指定了清理频率，单位是小时，需要填写一个1或更大的整数，默认是0，表示不开启自己清理功能。</span><br><span class=\"line\">#autopurge.snapRetainCount 这个参数和上面的参数搭配使用，这个参数指定了需要保留的文件数目。默认是保留3个。</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"七、supervisor管理\"><a href=\"#七、supervisor管理\" class=\"headerlink\" title=\"七、supervisor管理\"></a>七、supervisor管理</h2><p><code>vim bin/zkEnv.sh</code>在最上面增加环境路径</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">JAVA_HOME&#x3D;&#x2F;usr&#x2F;local&#x2F;java</span><br><span class=\"line\">export JAVA_HOME</span><br></pre></td></tr></table></figure>\n\n<p><code>vim /etc/supervisor/zookeeper.conf</code></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[program:zookeeper]</span><br><span class=\"line\">command&#x3D;&#x2F;usr&#x2F;local&#x2F;zookeeper-3.5.2-alpha&#x2F;bin&#x2F;zkServer.sh start-foreground</span><br><span class=\"line\">autostart&#x3D;true</span><br><span class=\"line\">autorestart&#x3D;true</span><br><span class=\"line\">startsecs&#x3D;10</span><br><span class=\"line\">stdout_logfile&#x3D;&#x2F;var&#x2F;log&#x2F;zookeeper.log</span><br><span class=\"line\">stdout_logfile_maxbytes&#x3D;1MB</span><br><span class=\"line\">stdout_logfile_backups&#x3D;10</span><br><span class=\"line\">stdout_capture_maxbytes&#x3D;1MB</span><br><span class=\"line\">stderr_logfile&#x3D;&#x2F;var&#x2F;log&#x2F;zookeeper.log</span><br><span class=\"line\">stderr_logfile_maxbytes&#x3D;1MB</span><br><span class=\"line\">stderr_logfile_backups&#x3D;10</span><br><span class=\"line\">stderr_capture_maxbytes&#x3D;1MB</span><br></pre></td></tr></table></figure>\n\n\n\n<p>##八、报错及处理</p>\n<p>应用连接zookeepr报错：Session 0x0 for server 192.168.220.128/192.168.220.128:2181,unexpected error,closing socket connection and attempting reconnect；</p>\n<p>先看端口能否telnet通，如果通则使用./zkServer.sh status查看zk是否确实已启动，没启查看bin/zookeeper.out中的报错。</p>\n<p>bin/zookeeper.out中报错：“zookeeper address already in use”；显然端口被占用，要么是其他进程占用了配置的端口，要么是上边配置的clientPort和server中的端口有重复。</p>\n<p>bin/zookeeper.out中报错：Cannot open channel to 2 at election address /192.168.220.130:3888；这应该只是组成集群的130节点未启动，到130启动起来zk即会正常。</p>\n"},{"title":"代码补全 AI 工具","date":"2020-09-21T04:38:00.000Z","_content":"\n\n\n### python ai 代码补全工具\n\n\n\n#### Kite\n\nhttps://kite.com/\n\n支持 python ，JavaScript\n免费\n\n\n\n#### TabNine\nhttps://www.tabnine.com/blog/deep/\n\n支持23种编程语言\n免费+收费\n\npycharm   插件中安装  Tabnine\n\n在编辑器中输入 \nTabNine::config\n会自动打开配置页面\n\nTabNine::config\nTabNine::version\nTabNine::active\nTabNine::restart\nTabNine::sem 打开当前语言的自动补全\nTabNine::no_sem 禁用当前语言的自动补全\n","source":"_posts/代码补全.md","raw":"---\ntitle: 代码补全 AI 工具\ndate: 2020-09-21 12:38\ncategories:\n- python\n\ntags:\n- tag\n- Kite\n- tabnine\n---\n\n\n\n### python ai 代码补全工具\n\n\n\n#### Kite\n\nhttps://kite.com/\n\n支持 python ，JavaScript\n免费\n\n\n\n#### TabNine\nhttps://www.tabnine.com/blog/deep/\n\n支持23种编程语言\n免费+收费\n\npycharm   插件中安装  Tabnine\n\n在编辑器中输入 \nTabNine::config\n会自动打开配置页面\n\nTabNine::config\nTabNine::version\nTabNine::active\nTabNine::restart\nTabNine::sem 打开当前语言的自动补全\nTabNine::no_sem 禁用当前语言的自动补全\n","slug":"代码补全","published":1,"updated":"2021-06-18T08:07:11.205Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cku6979y7001b00uh4ak02fht","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><h3 id=\"python-ai-代码补全工具\"><a href=\"#python-ai-代码补全工具\" class=\"headerlink\" title=\"python ai 代码补全工具\"></a>python ai 代码补全工具</h3><h4 id=\"Kite\"><a href=\"#Kite\" class=\"headerlink\" title=\"Kite\"></a>Kite</h4><p><a href=\"https://kite.com/\">https://kite.com/</a></p>\n<p>支持 python ，JavaScript<br>免费</p>\n<h4 id=\"TabNine\"><a href=\"#TabNine\" class=\"headerlink\" title=\"TabNine\"></a>TabNine</h4><p><a href=\"https://www.tabnine.com/blog/deep/\">https://www.tabnine.com/blog/deep/</a></p>\n<p>支持23种编程语言<br>免费+收费</p>\n<p>pycharm   插件中安装  Tabnine</p>\n<p>在编辑器中输入<br>TabNine::config<br>会自动打开配置页面</p>\n<p>TabNine::config<br>TabNine::version<br>TabNine::active<br>TabNine::restart<br>TabNine::sem 打开当前语言的自动补全<br>TabNine::no_sem 禁用当前语言的自动补全</p>\n","site":{"data":{}},"excerpt":"","more":"<h3 id=\"python-ai-代码补全工具\"><a href=\"#python-ai-代码补全工具\" class=\"headerlink\" title=\"python ai 代码补全工具\"></a>python ai 代码补全工具</h3><h4 id=\"Kite\"><a href=\"#Kite\" class=\"headerlink\" title=\"Kite\"></a>Kite</h4><p><a href=\"https://kite.com/\">https://kite.com/</a></p>\n<p>支持 python ，JavaScript<br>免费</p>\n<h4 id=\"TabNine\"><a href=\"#TabNine\" class=\"headerlink\" title=\"TabNine\"></a>TabNine</h4><p><a href=\"https://www.tabnine.com/blog/deep/\">https://www.tabnine.com/blog/deep/</a></p>\n<p>支持23种编程语言<br>免费+收费</p>\n<p>pycharm   插件中安装  Tabnine</p>\n<p>在编辑器中输入<br>TabNine::config<br>会自动打开配置页面</p>\n<p>TabNine::config<br>TabNine::version<br>TabNine::active<br>TabNine::restart<br>TabNine::sem 打开当前语言的自动补全<br>TabNine::no_sem 禁用当前语言的自动补全</p>\n"},{"title":"免费证书申请","date":"2021-07-22T09:35:00.000Z","_content":"\t\n\t\n摘要: Let's Encrypt 泛域名https \n<!-- more -->\n\n\n# 安装 Certbot \n\n## centos7安装snap\n```\nhttps://certbot.eff.org/lets-encrypt/centosrhel7-nginx\n```\n\n```\nyum install epel-release\nyum install snapd\nsystemctl enable --now snapd.socket\n\nln -s /var/lib/snapd/snap /snap\n\n```\n\n\n## centos7安装Certbot\n\n```\nsnap install core\nsnap refresh core\n\nsnap install --classic certbot\nln -s /snap/bin/certbot /usr/bin/certbot\n```\n\n# 生成证书\n```\ncertbot certonly --preferred-challenges dns --manual  -d *.xxxxx.com --server https://acme-v02.api.letsencrypt.org/directory --nginx\n```\n\n# 续订证书\n```\ncrontab -e\n\n0 12 * * * /usr/bin/certbot renew --quiet\n```\n\n","source":"_posts/证书申请.md","raw":"---\ntitle: 免费证书申请\ndate: 2021-07-22 17:35\ncategories:\n- ssl\ntags:\n- ssl\n- ca\n---\n\t\n\t\n摘要: Let's Encrypt 泛域名https \n<!-- more -->\n\n\n# 安装 Certbot \n\n## centos7安装snap\n```\nhttps://certbot.eff.org/lets-encrypt/centosrhel7-nginx\n```\n\n```\nyum install epel-release\nyum install snapd\nsystemctl enable --now snapd.socket\n\nln -s /var/lib/snapd/snap /snap\n\n```\n\n\n## centos7安装Certbot\n\n```\nsnap install core\nsnap refresh core\n\nsnap install --classic certbot\nln -s /snap/bin/certbot /usr/bin/certbot\n```\n\n# 生成证书\n```\ncertbot certonly --preferred-challenges dns --manual  -d *.xxxxx.com --server https://acme-v02.api.letsencrypt.org/directory --nginx\n```\n\n# 续订证书\n```\ncrontab -e\n\n0 12 * * * /usr/bin/certbot renew --quiet\n```\n\n","slug":"证书申请","published":1,"updated":"2021-07-23T02:02:55.044Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cku6979ya001f00uh6aav9at3","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><p>摘要: Let’s Encrypt 泛域名https </p>\n<span id=\"more\"></span>\n\n\n<h1 id=\"安装-Certbot\"><a href=\"#安装-Certbot\" class=\"headerlink\" title=\"安装 Certbot\"></a>安装 Certbot</h1><h2 id=\"centos7安装snap\"><a href=\"#centos7安装snap\" class=\"headerlink\" title=\"centos7安装snap\"></a>centos7安装snap</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">https:&#x2F;&#x2F;certbot.eff.org&#x2F;lets-encrypt&#x2F;centosrhel7-nginx</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install epel-release</span><br><span class=\"line\">yum install snapd</span><br><span class=\"line\">systemctl enable --now snapd.socket</span><br><span class=\"line\"></span><br><span class=\"line\">ln -s &#x2F;var&#x2F;lib&#x2F;snapd&#x2F;snap &#x2F;snap</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"centos7安装Certbot\"><a href=\"#centos7安装Certbot\" class=\"headerlink\" title=\"centos7安装Certbot\"></a>centos7安装Certbot</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">snap install core</span><br><span class=\"line\">snap refresh core</span><br><span class=\"line\"></span><br><span class=\"line\">snap install --classic certbot</span><br><span class=\"line\">ln -s &#x2F;snap&#x2F;bin&#x2F;certbot &#x2F;usr&#x2F;bin&#x2F;certbot</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"生成证书\"><a href=\"#生成证书\" class=\"headerlink\" title=\"生成证书\"></a>生成证书</h1><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">certbot certonly --preferred-challenges dns --manual  -d *.xxxxx.com --server https:&#x2F;&#x2F;acme-v02.api.letsencrypt.org&#x2F;directory --nginx</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"续订证书\"><a href=\"#续订证书\" class=\"headerlink\" title=\"续订证书\"></a>续订证书</h1><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">crontab -e</span><br><span class=\"line\"></span><br><span class=\"line\">0 12 * * * &#x2F;usr&#x2F;bin&#x2F;certbot renew --quiet</span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"<p>摘要: Let’s Encrypt 泛域名https </p>","more":"<h1 id=\"安装-Certbot\"><a href=\"#安装-Certbot\" class=\"headerlink\" title=\"安装 Certbot\"></a>安装 Certbot</h1><h2 id=\"centos7安装snap\"><a href=\"#centos7安装snap\" class=\"headerlink\" title=\"centos7安装snap\"></a>centos7安装snap</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">https:&#x2F;&#x2F;certbot.eff.org&#x2F;lets-encrypt&#x2F;centosrhel7-nginx</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install epel-release</span><br><span class=\"line\">yum install snapd</span><br><span class=\"line\">systemctl enable --now snapd.socket</span><br><span class=\"line\"></span><br><span class=\"line\">ln -s &#x2F;var&#x2F;lib&#x2F;snapd&#x2F;snap &#x2F;snap</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"centos7安装Certbot\"><a href=\"#centos7安装Certbot\" class=\"headerlink\" title=\"centos7安装Certbot\"></a>centos7安装Certbot</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">snap install core</span><br><span class=\"line\">snap refresh core</span><br><span class=\"line\"></span><br><span class=\"line\">snap install --classic certbot</span><br><span class=\"line\">ln -s &#x2F;snap&#x2F;bin&#x2F;certbot &#x2F;usr&#x2F;bin&#x2F;certbot</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"生成证书\"><a href=\"#生成证书\" class=\"headerlink\" title=\"生成证书\"></a>生成证书</h1><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">certbot certonly --preferred-challenges dns --manual  -d *.xxxxx.com --server https:&#x2F;&#x2F;acme-v02.api.letsencrypt.org&#x2F;directory --nginx</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"续订证书\"><a href=\"#续订证书\" class=\"headerlink\" title=\"续订证书\"></a>续订证书</h1><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">crontab -e</span><br><span class=\"line\"></span><br><span class=\"line\">0 12 * * * &#x2F;usr&#x2F;bin&#x2F;certbot renew --quiet</span><br></pre></td></tr></table></figure>"},{"title":"golang 碰到的错误","date":"2021-06-28T03:12:00.000Z","_content":"\t\n\t\n摘要: desc\n<!-- more -->\n\n\n## Err01\n#### 错误\n```\ngo mod tidy\n\nverifying github.com/jackc/pgio@v1.0.0: checksum mismatch\n        downloaded: h1:g12B9UwVnzGhueNavwioyEEpAmqMe1E/BN9ES+8ovkE=\n        go.sum:     h1:g12B9UwVnzGhuePromeAlertwioyEEpAmqMe1E/BN9ES+8ovkE=\n\nSECURITY ERROR\nThis download does NOT match an earlier download recorded in go.sum.\nThe bits may have been replaced on the origin server, or an attacker may\nhave intercepted the download attempt.\n\nFor more information, see 'go help module-auth'.\n\n```\n\n#### 处理\n```\ngo clean -modcache\n\ncd project && rm go.sum\n\ngo mod tidy\n````\n\n#### 原因\n```\n之前用 go 1.15的版本，现在又升级到 go 1.16，需要重新生成一次你的 mod 缓存，否则就会报错 checksum mismatch\n```\n\n\n## Err02\n\n#### 错误\n```\nexec: \"gcc\": executable file not found in %PATH%\n```\n\n#### 处理\n```\nwindows下载安装tdm-gcc 或者 Mingw 即可\n```\n\n#### 原因\n```\n原因是sqlitle3是个cgo库，需要gcd编译c代码\n```\n","source":"_posts/GO/error.md","raw":"---\ntitle: golang 碰到的错误\ndate: 2021-06-28 11:12\ncategories:\n- golang\ntags:\n- golang\n---\n\t\n\t\n摘要: desc\n<!-- more -->\n\n\n## Err01\n#### 错误\n```\ngo mod tidy\n\nverifying github.com/jackc/pgio@v1.0.0: checksum mismatch\n        downloaded: h1:g12B9UwVnzGhueNavwioyEEpAmqMe1E/BN9ES+8ovkE=\n        go.sum:     h1:g12B9UwVnzGhuePromeAlertwioyEEpAmqMe1E/BN9ES+8ovkE=\n\nSECURITY ERROR\nThis download does NOT match an earlier download recorded in go.sum.\nThe bits may have been replaced on the origin server, or an attacker may\nhave intercepted the download attempt.\n\nFor more information, see 'go help module-auth'.\n\n```\n\n#### 处理\n```\ngo clean -modcache\n\ncd project && rm go.sum\n\ngo mod tidy\n````\n\n#### 原因\n```\n之前用 go 1.15的版本，现在又升级到 go 1.16，需要重新生成一次你的 mod 缓存，否则就会报错 checksum mismatch\n```\n\n\n## Err02\n\n#### 错误\n```\nexec: \"gcc\": executable file not found in %PATH%\n```\n\n#### 处理\n```\nwindows下载安装tdm-gcc 或者 Mingw 即可\n```\n\n#### 原因\n```\n原因是sqlitle3是个cgo库，需要gcd编译c代码\n```\n","slug":"GO/error","published":1,"updated":"2021-06-28T03:20:38.221Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cku6979yb001i00uh2bde7bx8","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><p>摘要: desc</p>\n<span id=\"more\"></span>\n\n\n<h2 id=\"Err01\"><a href=\"#Err01\" class=\"headerlink\" title=\"Err01\"></a>Err01</h2><h4 id=\"错误\"><a href=\"#错误\" class=\"headerlink\" title=\"错误\"></a>错误</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">go mod tidy</span><br><span class=\"line\"></span><br><span class=\"line\">verifying github.com&#x2F;jackc&#x2F;pgio@v1.0.0: checksum mismatch</span><br><span class=\"line\">        downloaded: h1:g12B9UwVnzGhueNavwioyEEpAmqMe1E&#x2F;BN9ES+8ovkE&#x3D;</span><br><span class=\"line\">        go.sum:     h1:g12B9UwVnzGhuePromeAlertwioyEEpAmqMe1E&#x2F;BN9ES+8ovkE&#x3D;</span><br><span class=\"line\"></span><br><span class=\"line\">SECURITY ERROR</span><br><span class=\"line\">This download does NOT match an earlier download recorded in go.sum.</span><br><span class=\"line\">The bits may have been replaced on the origin server, or an attacker may</span><br><span class=\"line\">have intercepted the download attempt.</span><br><span class=\"line\"></span><br><span class=\"line\">For more information, see &#39;go help module-auth&#39;.</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"处理\"><a href=\"#处理\" class=\"headerlink\" title=\"处理\"></a>处理</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">go clean -modcache</span><br><span class=\"line\"></span><br><span class=\"line\">cd project &amp;&amp; rm go.sum</span><br><span class=\"line\"></span><br><span class=\"line\">go mod tidy</span><br><span class=\"line\">&#96;&#96;&#96;&#96;</span><br><span class=\"line\"></span><br><span class=\"line\">#### 原因</span><br></pre></td></tr></table></figure>\n<p>之前用 go 1.15的版本，现在又升级到 go 1.16，需要重新生成一次你的 mod 缓存，否则就会报错 checksum mismatch</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">## Err02</span><br><span class=\"line\"></span><br><span class=\"line\">#### 错误</span><br></pre></td></tr></table></figure>\n<p>exec: “gcc”: executable file not found in %PATH%</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">#### 处理</span><br></pre></td></tr></table></figure>\n<p>windows下载安装tdm-gcc 或者 Mingw 即可</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">#### 原因</span><br></pre></td></tr></table></figure>\n<p>原因是sqlitle3是个cgo库，需要gcd编译c代码</p>\n<pre><code>\n</code></pre>\n","site":{"data":{}},"excerpt":"<p>摘要: desc</p>","more":"<h2 id=\"Err01\"><a href=\"#Err01\" class=\"headerlink\" title=\"Err01\"></a>Err01</h2><h4 id=\"错误\"><a href=\"#错误\" class=\"headerlink\" title=\"错误\"></a>错误</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">go mod tidy</span><br><span class=\"line\"></span><br><span class=\"line\">verifying github.com&#x2F;jackc&#x2F;pgio@v1.0.0: checksum mismatch</span><br><span class=\"line\">        downloaded: h1:g12B9UwVnzGhueNavwioyEEpAmqMe1E&#x2F;BN9ES+8ovkE&#x3D;</span><br><span class=\"line\">        go.sum:     h1:g12B9UwVnzGhuePromeAlertwioyEEpAmqMe1E&#x2F;BN9ES+8ovkE&#x3D;</span><br><span class=\"line\"></span><br><span class=\"line\">SECURITY ERROR</span><br><span class=\"line\">This download does NOT match an earlier download recorded in go.sum.</span><br><span class=\"line\">The bits may have been replaced on the origin server, or an attacker may</span><br><span class=\"line\">have intercepted the download attempt.</span><br><span class=\"line\"></span><br><span class=\"line\">For more information, see &#39;go help module-auth&#39;.</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"处理\"><a href=\"#处理\" class=\"headerlink\" title=\"处理\"></a>处理</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">go clean -modcache</span><br><span class=\"line\"></span><br><span class=\"line\">cd project &amp;&amp; rm go.sum</span><br><span class=\"line\"></span><br><span class=\"line\">go mod tidy</span><br><span class=\"line\">&#96;&#96;&#96;&#96;</span><br><span class=\"line\"></span><br><span class=\"line\">#### 原因</span><br></pre></td></tr></table></figure>\n<p>之前用 go 1.15的版本，现在又升级到 go 1.16，需要重新生成一次你的 mod 缓存，否则就会报错 checksum mismatch</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">## Err02</span><br><span class=\"line\"></span><br><span class=\"line\">#### 错误</span><br></pre></td></tr></table></figure>\n<p>exec: “gcc”: executable file not found in %PATH%</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">#### 处理</span><br></pre></td></tr></table></figure>\n<p>windows下载安装tdm-gcc 或者 Mingw 即可</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">#### 原因</span><br></pre></td></tr></table></figure>\n<p>原因是sqlitle3是个cgo库，需要gcd编译c代码</p>\n<pre><code>\n</code></pre>"},{"title":"go 项目初始化","date":"2020-10-13T08:42:00.000Z","_content":"  \n  \n摘要: go项目初始化\n<!-- more -->\n\n### 项目创建\n```\nmkdir gocmdb\ncd gocmdb\ngo mod init gocmdb\n\n\nmkdir -p  {conf,middleware,models,pkg,routers,runtime,sql}    // unix\nmkdir  conf,middleware,models,pkg,routers,runtime,sql    // windows\n```\n\n```\nconf：         用于存储配置文件\nmiddleware：   应用中间件\nmodels：       应用数据库模型\nlogs:          运行日志\npkg：          第三方包\nrouters        路由逻辑处理\nruntime        应用运行时数据\n```\n\n\n\n\n","source":"_posts/GO/go.md","raw":"---\ntitle: go 项目初始化\ndate: 2020-10-13 16:42\ncategories:\n- go\ntags:\n- go\n---\n  \n  \n摘要: go项目初始化\n<!-- more -->\n\n### 项目创建\n```\nmkdir gocmdb\ncd gocmdb\ngo mod init gocmdb\n\n\nmkdir -p  {conf,middleware,models,pkg,routers,runtime,sql}    // unix\nmkdir  conf,middleware,models,pkg,routers,runtime,sql    // windows\n```\n\n```\nconf：         用于存储配置文件\nmiddleware：   应用中间件\nmodels：       应用数据库模型\nlogs:          运行日志\npkg：          第三方包\nrouters        路由逻辑处理\nruntime        应用运行时数据\n```\n\n\n\n\n","slug":"GO/go","published":1,"updated":"2021-06-18T08:07:11.182Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cku6979yf001l00uh8pk51ia4","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><p>摘要: go项目初始化</p>\n<span id=\"more\"></span>\n\n<h3 id=\"项目创建\"><a href=\"#项目创建\" class=\"headerlink\" title=\"项目创建\"></a>项目创建</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir gocmdb</span><br><span class=\"line\">cd gocmdb</span><br><span class=\"line\">go mod init gocmdb</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">mkdir -p  &#123;conf,middleware,models,pkg,routers,runtime,sql&#125;    &#x2F;&#x2F; unix</span><br><span class=\"line\">mkdir  conf,middleware,models,pkg,routers,runtime,sql    &#x2F;&#x2F; windows</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">conf：         用于存储配置文件</span><br><span class=\"line\">middleware：   应用中间件</span><br><span class=\"line\">models：       应用数据库模型</span><br><span class=\"line\">logs:          运行日志</span><br><span class=\"line\">pkg：          第三方包</span><br><span class=\"line\">routers        路由逻辑处理</span><br><span class=\"line\">runtime        应用运行时数据</span><br></pre></td></tr></table></figure>\n\n\n\n\n","site":{"data":{}},"excerpt":"<p>摘要: go项目初始化</p>","more":"<h3 id=\"项目创建\"><a href=\"#项目创建\" class=\"headerlink\" title=\"项目创建\"></a>项目创建</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir gocmdb</span><br><span class=\"line\">cd gocmdb</span><br><span class=\"line\">go mod init gocmdb</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">mkdir -p  &#123;conf,middleware,models,pkg,routers,runtime,sql&#125;    &#x2F;&#x2F; unix</span><br><span class=\"line\">mkdir  conf,middleware,models,pkg,routers,runtime,sql    &#x2F;&#x2F; windows</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">conf：         用于存储配置文件</span><br><span class=\"line\">middleware：   应用中间件</span><br><span class=\"line\">models：       应用数据库模型</span><br><span class=\"line\">logs:          运行日志</span><br><span class=\"line\">pkg：          第三方包</span><br><span class=\"line\">routers        路由逻辑处理</span><br><span class=\"line\">runtime        应用运行时数据</span><br></pre></td></tr></table></figure>"},{"title":"go mod 简单使用","date":"2020-10-13T08:28:00.000Z","_content":"  \n  \n摘要: go mod 使用\n<!-- more -->\n\n\ngo modules 是 golang 1.11 新加的特性。Modules官方定义为：\n\n> 模块是相关Go包的集合。modules是源代码交换和版本控制的单元。 go命令直接支持使用modules，包括记录和解析对其他模块的依赖性。modules替换旧的基于GOPATH的方法来指定在给定构建中使用哪些源文件\n\n### 如何使用 Modules ？\n\n把 golang 升级到 1.11\n\n设置 GO111MODULE\n\nGO111MODULE 有三个值：off, on和auto（默认值）。\n```\nGO111MODULE=off，go命令行将不会支持module功能，寻找依赖包的方式将会沿用旧版本那种通过vendor目录或者GOPATH模式来查找。\nGO111MODULE=on，go命令行会使用modules，而一点也不会去GOPATH目录下查找。\nGO111MODULE=auto，默认值，go命令行将会根据当前目录来决定是否启用module功能。这种情况下可以分为两种情形：\n    1、当前目录在GOPATH/src之外且该目录包含go.mod文件\n    2、当前文件在包含go.mod文件的目录下面。\n```\n\n\n> 当modules 功能启用时，依赖包的存放位置变更为$GOPATH/pkg，允许同一个package多个版本并存，且多个项目可以共享缓存的 module。\n\n\n### go mod  命令\ngolang 提供了 go mod命令来管理包。\ngo mod 有以下命令：\n\n\n\n| 命令 | 说明 | \n| ---- | ---- |\n| download |  download modules to local cache(下载依赖包) |\n| edit | edit go.mod from tools or scripts(编辑go.mod) |\n| graph | print module requirement graph (打印模块依赖图) |\n| init | initialize new module in current directory(在当前目录初始化mod) |\n| tidy | add missing and remove unused modules(拉取缺少的模块，移除不用的模块) |\n| vendor | make vendored copy of dependencies(将依赖复制到vendor下) |\n| verify | verify dependencies have expected content (验证依赖是否正确) |\n| why | explain why packages or modules are needed(解释为什么需要依赖) |\n\n---\n\ngo.mod 提供了module, require、replace和exclude 四个命令\n```\nmodule    语句指定包的名字(路径)\nrequire   语句指定的依赖项模块\nreplace   语句可以替换依赖项模块\nexclude   语句可以忽略依赖项模块\n```\n\n\n---\n\ngo get 升级\n\n- 运行 `go get -u`  将会升级到最新的次要版本或者修订版本(x.y.z, z是修订版本号， y是次要版本号)\n- 运行 `go get -u=patch` 将会升级到最新的修订版本\n- 运行 `go get package@version` 将会升级到指定的版本号version\n- 运行`go get`如果有版本的更改，那么go.mod文件也会更改\n\n\n### 使用replace替换无法直接获取的package\n由于某些已知的原因，并不是所有的package都能成功下载，比如：golang.org下的包。\nmodules 可以通过在 go.mod 文件中使用 replace 指令替换成github上对应的库，比如：\n```\nreplace (\n\tgolang.org/x/crypto v0.0.0-20190313024323-a1f597ede03a => github.com/golang/crypto v0.0.0-20190313024323-a1f597ede03a\n)\n```\n或者\n\n```\nreplace golang.org/x/crypto v0.0.0-20190313024323-a1f597ede03a => github.com/golang/crypto v0.0.0-20190313024323-a1f597ede03a\n```\n\n","source":"_posts/GO/gomod.md","raw":"---\ntitle: go mod 简单使用\ndate: 2020-10-13 16:28\ncategories:\n- go\ntags:\n- go-mod\n---\n  \n  \n摘要: go mod 使用\n<!-- more -->\n\n\ngo modules 是 golang 1.11 新加的特性。Modules官方定义为：\n\n> 模块是相关Go包的集合。modules是源代码交换和版本控制的单元。 go命令直接支持使用modules，包括记录和解析对其他模块的依赖性。modules替换旧的基于GOPATH的方法来指定在给定构建中使用哪些源文件\n\n### 如何使用 Modules ？\n\n把 golang 升级到 1.11\n\n设置 GO111MODULE\n\nGO111MODULE 有三个值：off, on和auto（默认值）。\n```\nGO111MODULE=off，go命令行将不会支持module功能，寻找依赖包的方式将会沿用旧版本那种通过vendor目录或者GOPATH模式来查找。\nGO111MODULE=on，go命令行会使用modules，而一点也不会去GOPATH目录下查找。\nGO111MODULE=auto，默认值，go命令行将会根据当前目录来决定是否启用module功能。这种情况下可以分为两种情形：\n    1、当前目录在GOPATH/src之外且该目录包含go.mod文件\n    2、当前文件在包含go.mod文件的目录下面。\n```\n\n\n> 当modules 功能启用时，依赖包的存放位置变更为$GOPATH/pkg，允许同一个package多个版本并存，且多个项目可以共享缓存的 module。\n\n\n### go mod  命令\ngolang 提供了 go mod命令来管理包。\ngo mod 有以下命令：\n\n\n\n| 命令 | 说明 | \n| ---- | ---- |\n| download |  download modules to local cache(下载依赖包) |\n| edit | edit go.mod from tools or scripts(编辑go.mod) |\n| graph | print module requirement graph (打印模块依赖图) |\n| init | initialize new module in current directory(在当前目录初始化mod) |\n| tidy | add missing and remove unused modules(拉取缺少的模块，移除不用的模块) |\n| vendor | make vendored copy of dependencies(将依赖复制到vendor下) |\n| verify | verify dependencies have expected content (验证依赖是否正确) |\n| why | explain why packages or modules are needed(解释为什么需要依赖) |\n\n---\n\ngo.mod 提供了module, require、replace和exclude 四个命令\n```\nmodule    语句指定包的名字(路径)\nrequire   语句指定的依赖项模块\nreplace   语句可以替换依赖项模块\nexclude   语句可以忽略依赖项模块\n```\n\n\n---\n\ngo get 升级\n\n- 运行 `go get -u`  将会升级到最新的次要版本或者修订版本(x.y.z, z是修订版本号， y是次要版本号)\n- 运行 `go get -u=patch` 将会升级到最新的修订版本\n- 运行 `go get package@version` 将会升级到指定的版本号version\n- 运行`go get`如果有版本的更改，那么go.mod文件也会更改\n\n\n### 使用replace替换无法直接获取的package\n由于某些已知的原因，并不是所有的package都能成功下载，比如：golang.org下的包。\nmodules 可以通过在 go.mod 文件中使用 replace 指令替换成github上对应的库，比如：\n```\nreplace (\n\tgolang.org/x/crypto v0.0.0-20190313024323-a1f597ede03a => github.com/golang/crypto v0.0.0-20190313024323-a1f597ede03a\n)\n```\n或者\n\n```\nreplace golang.org/x/crypto v0.0.0-20190313024323-a1f597ede03a => github.com/golang/crypto v0.0.0-20190313024323-a1f597ede03a\n```\n\n","slug":"GO/gomod","published":1,"updated":"2021-06-18T08:07:11.183Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cku6979yg001o00uhgm2zfyu3","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><p>摘要: go mod 使用</p>\n<span id=\"more\"></span>\n\n\n<p>go modules 是 golang 1.11 新加的特性。Modules官方定义为：</p>\n<blockquote>\n<p>模块是相关Go包的集合。modules是源代码交换和版本控制的单元。 go命令直接支持使用modules，包括记录和解析对其他模块的依赖性。modules替换旧的基于GOPATH的方法来指定在给定构建中使用哪些源文件</p>\n</blockquote>\n<h3 id=\"如何使用-Modules-？\"><a href=\"#如何使用-Modules-？\" class=\"headerlink\" title=\"如何使用 Modules ？\"></a>如何使用 Modules ？</h3><p>把 golang 升级到 1.11</p>\n<p>设置 GO111MODULE</p>\n<p>GO111MODULE 有三个值：off, on和auto（默认值）。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GO111MODULE&#x3D;off，go命令行将不会支持module功能，寻找依赖包的方式将会沿用旧版本那种通过vendor目录或者GOPATH模式来查找。</span><br><span class=\"line\">GO111MODULE&#x3D;on，go命令行会使用modules，而一点也不会去GOPATH目录下查找。</span><br><span class=\"line\">GO111MODULE&#x3D;auto，默认值，go命令行将会根据当前目录来决定是否启用module功能。这种情况下可以分为两种情形：</span><br><span class=\"line\">    1、当前目录在GOPATH&#x2F;src之外且该目录包含go.mod文件</span><br><span class=\"line\">    2、当前文件在包含go.mod文件的目录下面。</span><br></pre></td></tr></table></figure>\n\n\n<blockquote>\n<p>当modules 功能启用时，依赖包的存放位置变更为$GOPATH/pkg，允许同一个package多个版本并存，且多个项目可以共享缓存的 module。</p>\n</blockquote>\n<h3 id=\"go-mod-命令\"><a href=\"#go-mod-命令\" class=\"headerlink\" title=\"go mod  命令\"></a>go mod  命令</h3><p>golang 提供了 go mod命令来管理包。<br>go mod 有以下命令：</p>\n<table>\n<thead>\n<tr>\n<th>命令</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>download</td>\n<td>download modules to local cache(下载依赖包)</td>\n</tr>\n<tr>\n<td>edit</td>\n<td>edit go.mod from tools or scripts(编辑go.mod)</td>\n</tr>\n<tr>\n<td>graph</td>\n<td>print module requirement graph (打印模块依赖图)</td>\n</tr>\n<tr>\n<td>init</td>\n<td>initialize new module in current directory(在当前目录初始化mod)</td>\n</tr>\n<tr>\n<td>tidy</td>\n<td>add missing and remove unused modules(拉取缺少的模块，移除不用的模块)</td>\n</tr>\n<tr>\n<td>vendor</td>\n<td>make vendored copy of dependencies(将依赖复制到vendor下)</td>\n</tr>\n<tr>\n<td>verify</td>\n<td>verify dependencies have expected content (验证依赖是否正确)</td>\n</tr>\n<tr>\n<td>why</td>\n<td>explain why packages or modules are needed(解释为什么需要依赖)</td>\n</tr>\n</tbody></table>\n<hr>\n<p>go.mod 提供了module, require、replace和exclude 四个命令</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">module    语句指定包的名字(路径)</span><br><span class=\"line\">require   语句指定的依赖项模块</span><br><span class=\"line\">replace   语句可以替换依赖项模块</span><br><span class=\"line\">exclude   语句可以忽略依赖项模块</span><br></pre></td></tr></table></figure>\n\n\n<hr>\n<p>go get 升级</p>\n<ul>\n<li>运行 <code>go get -u</code>  将会升级到最新的次要版本或者修订版本(x.y.z, z是修订版本号， y是次要版本号)</li>\n<li>运行 <code>go get -u=patch</code> 将会升级到最新的修订版本</li>\n<li>运行 <code>go get package@version</code> 将会升级到指定的版本号version</li>\n<li>运行<code>go get</code>如果有版本的更改，那么go.mod文件也会更改</li>\n</ul>\n<h3 id=\"使用replace替换无法直接获取的package\"><a href=\"#使用replace替换无法直接获取的package\" class=\"headerlink\" title=\"使用replace替换无法直接获取的package\"></a>使用replace替换无法直接获取的package</h3><p>由于某些已知的原因，并不是所有的package都能成功下载，比如：golang.org下的包。<br>modules 可以通过在 go.mod 文件中使用 replace 指令替换成github上对应的库，比如：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">replace (</span><br><span class=\"line\">\tgolang.org&#x2F;x&#x2F;crypto v0.0.0-20190313024323-a1f597ede03a &#x3D;&gt; github.com&#x2F;golang&#x2F;crypto v0.0.0-20190313024323-a1f597ede03a</span><br><span class=\"line\">)</span><br></pre></td></tr></table></figure>\n<p>或者</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">replace golang.org&#x2F;x&#x2F;crypto v0.0.0-20190313024323-a1f597ede03a &#x3D;&gt; github.com&#x2F;golang&#x2F;crypto v0.0.0-20190313024323-a1f597ede03a</span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"<p>摘要: go mod 使用</p>","more":"<p>go modules 是 golang 1.11 新加的特性。Modules官方定义为：</p>\n<blockquote>\n<p>模块是相关Go包的集合。modules是源代码交换和版本控制的单元。 go命令直接支持使用modules，包括记录和解析对其他模块的依赖性。modules替换旧的基于GOPATH的方法来指定在给定构建中使用哪些源文件</p>\n</blockquote>\n<h3 id=\"如何使用-Modules-？\"><a href=\"#如何使用-Modules-？\" class=\"headerlink\" title=\"如何使用 Modules ？\"></a>如何使用 Modules ？</h3><p>把 golang 升级到 1.11</p>\n<p>设置 GO111MODULE</p>\n<p>GO111MODULE 有三个值：off, on和auto（默认值）。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GO111MODULE&#x3D;off，go命令行将不会支持module功能，寻找依赖包的方式将会沿用旧版本那种通过vendor目录或者GOPATH模式来查找。</span><br><span class=\"line\">GO111MODULE&#x3D;on，go命令行会使用modules，而一点也不会去GOPATH目录下查找。</span><br><span class=\"line\">GO111MODULE&#x3D;auto，默认值，go命令行将会根据当前目录来决定是否启用module功能。这种情况下可以分为两种情形：</span><br><span class=\"line\">    1、当前目录在GOPATH&#x2F;src之外且该目录包含go.mod文件</span><br><span class=\"line\">    2、当前文件在包含go.mod文件的目录下面。</span><br></pre></td></tr></table></figure>\n\n\n<blockquote>\n<p>当modules 功能启用时，依赖包的存放位置变更为$GOPATH/pkg，允许同一个package多个版本并存，且多个项目可以共享缓存的 module。</p>\n</blockquote>\n<h3 id=\"go-mod-命令\"><a href=\"#go-mod-命令\" class=\"headerlink\" title=\"go mod  命令\"></a>go mod  命令</h3><p>golang 提供了 go mod命令来管理包。<br>go mod 有以下命令：</p>\n<table>\n<thead>\n<tr>\n<th>命令</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>download</td>\n<td>download modules to local cache(下载依赖包)</td>\n</tr>\n<tr>\n<td>edit</td>\n<td>edit go.mod from tools or scripts(编辑go.mod)</td>\n</tr>\n<tr>\n<td>graph</td>\n<td>print module requirement graph (打印模块依赖图)</td>\n</tr>\n<tr>\n<td>init</td>\n<td>initialize new module in current directory(在当前目录初始化mod)</td>\n</tr>\n<tr>\n<td>tidy</td>\n<td>add missing and remove unused modules(拉取缺少的模块，移除不用的模块)</td>\n</tr>\n<tr>\n<td>vendor</td>\n<td>make vendored copy of dependencies(将依赖复制到vendor下)</td>\n</tr>\n<tr>\n<td>verify</td>\n<td>verify dependencies have expected content (验证依赖是否正确)</td>\n</tr>\n<tr>\n<td>why</td>\n<td>explain why packages or modules are needed(解释为什么需要依赖)</td>\n</tr>\n</tbody></table>\n<hr>\n<p>go.mod 提供了module, require、replace和exclude 四个命令</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">module    语句指定包的名字(路径)</span><br><span class=\"line\">require   语句指定的依赖项模块</span><br><span class=\"line\">replace   语句可以替换依赖项模块</span><br><span class=\"line\">exclude   语句可以忽略依赖项模块</span><br></pre></td></tr></table></figure>\n\n\n<hr>\n<p>go get 升级</p>\n<ul>\n<li>运行 <code>go get -u</code>  将会升级到最新的次要版本或者修订版本(x.y.z, z是修订版本号， y是次要版本号)</li>\n<li>运行 <code>go get -u=patch</code> 将会升级到最新的修订版本</li>\n<li>运行 <code>go get package@version</code> 将会升级到指定的版本号version</li>\n<li>运行<code>go get</code>如果有版本的更改，那么go.mod文件也会更改</li>\n</ul>\n<h3 id=\"使用replace替换无法直接获取的package\"><a href=\"#使用replace替换无法直接获取的package\" class=\"headerlink\" title=\"使用replace替换无法直接获取的package\"></a>使用replace替换无法直接获取的package</h3><p>由于某些已知的原因，并不是所有的package都能成功下载，比如：golang.org下的包。<br>modules 可以通过在 go.mod 文件中使用 replace 指令替换成github上对应的库，比如：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">replace (</span><br><span class=\"line\">\tgolang.org&#x2F;x&#x2F;crypto v0.0.0-20190313024323-a1f597ede03a &#x3D;&gt; github.com&#x2F;golang&#x2F;crypto v0.0.0-20190313024323-a1f597ede03a</span><br><span class=\"line\">)</span><br></pre></td></tr></table></figure>\n<p>或者</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">replace golang.org&#x2F;x&#x2F;crypto v0.0.0-20190313024323-a1f597ede03a &#x3D;&gt; github.com&#x2F;golang&#x2F;crypto v0.0.0-20190313024323-a1f597ede03a</span><br></pre></td></tr></table></figure>"},{"title":"Playbook支持任务结果回显","date":"2020-10-09T03:13:00.000Z","_content":"  \n  \n摘要: Playbook支持任务结果回显，不只是执行是否成功\n<!-- more -->\n\n### 配置文件\nansible.cfg 配置文件（变更callback路径位置）\n```\n[defaults]\ncallback_plugins=/etc/ansible/callback_plugins\n# change the default callback\n#stdout_callback = result_echo\n# enable additional callbacks\ncallback_whitelist = result_echo\nbin_ansible_callbacks = Ture\n\n```\n\n### 编写回显callback脚本\n```\nmkdir /etc/ansible/callback_plugins\n\ncd /etc/ansible/callback_plugins\nvim result_echo.py\n```\n```\n#!/usr/bin/env python\n# -*- coding=utf-8 -*-\n######################\nfrom __future__ import (absolute_import, division, print_function)\n__metaclass__ = type\n\nfrom ansible.plugins.callback.default import CallbackModule as CallbackModule_default\n\nclass CallbackModule(CallbackModule_default):\n\n    '''\n    Execution result echo\n    '''\n\n    CALLBACK_VERSION = 2.0\n    CALLBACK_TYPE = 'notification'\n    #CALLBACK_TYPE = 'stdout'\n    CALLBACK_NAME = 'result_echo'\n\n    def __init__(self):\n        super(CallbackModule, self).__init__()\n        self.lock_results = None\n\n    def on_any(self, *args, **kwargs):\n        pass\n    def runner_on_failed(self, host, res, ignore_errors=False):\n        pass\n    def runner_on_ok(self, host, res):\n        #pass\n        print(res)\n    def runner_on_skipped(self, host, item=None):\n        pass\n    def runner_on_unreachable(self, host, res):\n        #pass\n        print(res)\n    def runner_on_no_hosts(self):\n        pass\n    def runner_on_async_poll(self, host, res, jid, clock):\n        pass\n    def runner_on_async_ok(self, host, res, jid):\n        pass\n    def runner_on_async_failed(self, host, res, jid):\n        pass\n    def playbook_on_start(self):\n        pass\n    def playbook_on_notify(self, host, handler):\n        pass\n    def playbook_on_no_hosts_matched(self):\n        pass\n    def playbook_on_no_hosts_remaining(self):\n        pass\n    def playbook_on_task_start(self, name, is_conditional):\n        pass\n    def playbook_on_vars_prompt(self, varname, private=True, prompt=None, encrypt=None, confirm=False, salt_size=None, salt=None, default=None):\n        pass\n    def playbook_on_setup(self):\n        pass\n    def playbook_on_import_for_host(self, host, imported_file):\n        pass\n    def playbook_on_not_import_for_host(self, host, missing_file):\n        pass\n    def playbook_on_play_start(self, name):\n        pass\n    def playbook_on_stats(self, stats):\n        pass\n    def on_file_diff(self, host, diff):\n        pass\n    def v2_on_any(self, *args, **kwargs):\n        pass\n    def v2_runner_on_failed(self, result, ignore_errors=False):\n        #pass\n        #print (result.__dict__.items())\n        #if \"stderr_lines\" in result._result.keys():\n        #    print( result._result['stderr_lines'])\n        #if 'state' in result._result.keys():\n        #    print( result._result['state'])\n        #if 'invocation' in result._result.keys():\n        #    print( result._result['invocation'])\n    def v2_runner_on_ok(self, result):\n        if \"stdout\" in result._result.keys():\n            print( result._result['stdout'])\n        if 'state' in result._result.keys():\n            print( result._result['state'])\n        if 'invocation' in result._result.keys():\n            print( result._result['invocation'])\n        #pass\n    def v2_runner_on_skipped(self, result):\n        pass\n    def v2_runner_on_unreachable(self, result):\n        pass\n    def v2_runner_on_no_hosts(self, task):\n        pass\n    def v2_runner_on_async_poll(self, result):\n        pass\n    def v2_runner_on_async_ok(self, result):\n        pass\n    def v2_runner_on_async_failed(self, result):\n        pass\n    def v2_runner_on_file_diff(self, result, diff):\n        pass\n    def v2_playbook_on_start(self, playbook):\n        pass\n    def v2_playbook_on_notify(self, result, handler):\n        pass\n    def v2_playbook_on_no_hosts_matched(self):\n        pass\n    def v2_playbook_on_no_hosts_remaining(self):\n        pass\n    def v2_playbook_on_task_start(self, task, is_conditional):\n        pass\n    def v2_playbook_on_cleanup_task_start(self, task):\n        pass\n    def v2_playbook_on_handler_task_start(self, task):\n        pass\n    def v2_playbook_on_vars_prompt(self, varname, private=True, prompt=None, encrypt=None, confirm=False, salt_size=None, salt=None, default=None):\n        pass\n    def v2_playbook_on_setup(self):\n        pass\n    def v2_playbook_on_import_for_host(self, result, imported_file):\n        pass\n    def v2_playbook_on_not_import_for_host(self, result, missing_file):\n        pass\n    def v2_playbook_on_play_start(self, play):\n        pass\n    def v2_playbook_on_stats(self, stats):\n        pass\n    def v2_on_file_diff(self, result):\n        pass\n    def v2_playbook_on_include(self, included_file):\n        pass\n    def v2_runner_item_on_ok(self, result):\n        pass\n    def v2_runner_item_on_failed(self, result):\n        pass\n    def v2_runner_item_on_skipped(self, result):\n        pass\n    def v2_runner_retry(self, result):\n        pass\n```\n\n### 方法的result值\nprint(result._task) 输出任务名\nprint(result._check_key)\nprint(result._host) 输出主机名\nprint(result._result) 输出任务执行的结果\nprint(result.is_changed)\nprint(result.is_failed)\n\n\n### 定义callback说明信息\nCALLBACK_VERSION = 2.0 插件版本\nCALLBACK_TYPE = 'aggregate' 插件类型，如果是'stdout'时，只会加载一个这样的回调插件\nCALLBACK_NAME = 'timer' 插件名称，需与文件名称一致。\nCALLBACK_NEEDS_WHITELIST = True 插件是否需要在配置文件配置whitelist。为true是，ansible检查ansible.cfg文件中的callback_whitelist是否有插件名称，有则执行，无则跳过。\n","source":"_posts/ansible/Playbook支持任务结果回显.md","raw":"---\ntitle: Playbook支持任务结果回显\ndate: 2020-10-09 11:13\ncategories:\n- ansible\ntags:\n- ansible\n---\n  \n  \n摘要: Playbook支持任务结果回显，不只是执行是否成功\n<!-- more -->\n\n### 配置文件\nansible.cfg 配置文件（变更callback路径位置）\n```\n[defaults]\ncallback_plugins=/etc/ansible/callback_plugins\n# change the default callback\n#stdout_callback = result_echo\n# enable additional callbacks\ncallback_whitelist = result_echo\nbin_ansible_callbacks = Ture\n\n```\n\n### 编写回显callback脚本\n```\nmkdir /etc/ansible/callback_plugins\n\ncd /etc/ansible/callback_plugins\nvim result_echo.py\n```\n```\n#!/usr/bin/env python\n# -*- coding=utf-8 -*-\n######################\nfrom __future__ import (absolute_import, division, print_function)\n__metaclass__ = type\n\nfrom ansible.plugins.callback.default import CallbackModule as CallbackModule_default\n\nclass CallbackModule(CallbackModule_default):\n\n    '''\n    Execution result echo\n    '''\n\n    CALLBACK_VERSION = 2.0\n    CALLBACK_TYPE = 'notification'\n    #CALLBACK_TYPE = 'stdout'\n    CALLBACK_NAME = 'result_echo'\n\n    def __init__(self):\n        super(CallbackModule, self).__init__()\n        self.lock_results = None\n\n    def on_any(self, *args, **kwargs):\n        pass\n    def runner_on_failed(self, host, res, ignore_errors=False):\n        pass\n    def runner_on_ok(self, host, res):\n        #pass\n        print(res)\n    def runner_on_skipped(self, host, item=None):\n        pass\n    def runner_on_unreachable(self, host, res):\n        #pass\n        print(res)\n    def runner_on_no_hosts(self):\n        pass\n    def runner_on_async_poll(self, host, res, jid, clock):\n        pass\n    def runner_on_async_ok(self, host, res, jid):\n        pass\n    def runner_on_async_failed(self, host, res, jid):\n        pass\n    def playbook_on_start(self):\n        pass\n    def playbook_on_notify(self, host, handler):\n        pass\n    def playbook_on_no_hosts_matched(self):\n        pass\n    def playbook_on_no_hosts_remaining(self):\n        pass\n    def playbook_on_task_start(self, name, is_conditional):\n        pass\n    def playbook_on_vars_prompt(self, varname, private=True, prompt=None, encrypt=None, confirm=False, salt_size=None, salt=None, default=None):\n        pass\n    def playbook_on_setup(self):\n        pass\n    def playbook_on_import_for_host(self, host, imported_file):\n        pass\n    def playbook_on_not_import_for_host(self, host, missing_file):\n        pass\n    def playbook_on_play_start(self, name):\n        pass\n    def playbook_on_stats(self, stats):\n        pass\n    def on_file_diff(self, host, diff):\n        pass\n    def v2_on_any(self, *args, **kwargs):\n        pass\n    def v2_runner_on_failed(self, result, ignore_errors=False):\n        #pass\n        #print (result.__dict__.items())\n        #if \"stderr_lines\" in result._result.keys():\n        #    print( result._result['stderr_lines'])\n        #if 'state' in result._result.keys():\n        #    print( result._result['state'])\n        #if 'invocation' in result._result.keys():\n        #    print( result._result['invocation'])\n    def v2_runner_on_ok(self, result):\n        if \"stdout\" in result._result.keys():\n            print( result._result['stdout'])\n        if 'state' in result._result.keys():\n            print( result._result['state'])\n        if 'invocation' in result._result.keys():\n            print( result._result['invocation'])\n        #pass\n    def v2_runner_on_skipped(self, result):\n        pass\n    def v2_runner_on_unreachable(self, result):\n        pass\n    def v2_runner_on_no_hosts(self, task):\n        pass\n    def v2_runner_on_async_poll(self, result):\n        pass\n    def v2_runner_on_async_ok(self, result):\n        pass\n    def v2_runner_on_async_failed(self, result):\n        pass\n    def v2_runner_on_file_diff(self, result, diff):\n        pass\n    def v2_playbook_on_start(self, playbook):\n        pass\n    def v2_playbook_on_notify(self, result, handler):\n        pass\n    def v2_playbook_on_no_hosts_matched(self):\n        pass\n    def v2_playbook_on_no_hosts_remaining(self):\n        pass\n    def v2_playbook_on_task_start(self, task, is_conditional):\n        pass\n    def v2_playbook_on_cleanup_task_start(self, task):\n        pass\n    def v2_playbook_on_handler_task_start(self, task):\n        pass\n    def v2_playbook_on_vars_prompt(self, varname, private=True, prompt=None, encrypt=None, confirm=False, salt_size=None, salt=None, default=None):\n        pass\n    def v2_playbook_on_setup(self):\n        pass\n    def v2_playbook_on_import_for_host(self, result, imported_file):\n        pass\n    def v2_playbook_on_not_import_for_host(self, result, missing_file):\n        pass\n    def v2_playbook_on_play_start(self, play):\n        pass\n    def v2_playbook_on_stats(self, stats):\n        pass\n    def v2_on_file_diff(self, result):\n        pass\n    def v2_playbook_on_include(self, included_file):\n        pass\n    def v2_runner_item_on_ok(self, result):\n        pass\n    def v2_runner_item_on_failed(self, result):\n        pass\n    def v2_runner_item_on_skipped(self, result):\n        pass\n    def v2_runner_retry(self, result):\n        pass\n```\n\n### 方法的result值\nprint(result._task) 输出任务名\nprint(result._check_key)\nprint(result._host) 输出主机名\nprint(result._result) 输出任务执行的结果\nprint(result.is_changed)\nprint(result.is_failed)\n\n\n### 定义callback说明信息\nCALLBACK_VERSION = 2.0 插件版本\nCALLBACK_TYPE = 'aggregate' 插件类型，如果是'stdout'时，只会加载一个这样的回调插件\nCALLBACK_NAME = 'timer' 插件名称，需与文件名称一致。\nCALLBACK_NEEDS_WHITELIST = True 插件是否需要在配置文件配置whitelist。为true是，ansible检查ansible.cfg文件中的callback_whitelist是否有插件名称，有则执行，无则跳过。\n","slug":"ansible/Playbook支持任务结果回显","published":1,"updated":"2021-06-18T08:07:11.184Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cku6979yj001r00uh0zk6e2g5","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><p>摘要: Playbook支持任务结果回显，不只是执行是否成功</p>\n<span id=\"more\"></span>\n\n<h3 id=\"配置文件\"><a href=\"#配置文件\" class=\"headerlink\" title=\"配置文件\"></a>配置文件</h3><p>ansible.cfg 配置文件（变更callback路径位置）</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[defaults]</span><br><span class=\"line\">callback_plugins&#x3D;&#x2F;etc&#x2F;ansible&#x2F;callback_plugins</span><br><span class=\"line\"># change the default callback</span><br><span class=\"line\">#stdout_callback &#x3D; result_echo</span><br><span class=\"line\"># enable additional callbacks</span><br><span class=\"line\">callback_whitelist &#x3D; result_echo</span><br><span class=\"line\">bin_ansible_callbacks &#x3D; Ture</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"编写回显callback脚本\"><a href=\"#编写回显callback脚本\" class=\"headerlink\" title=\"编写回显callback脚本\"></a>编写回显callback脚本</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir &#x2F;etc&#x2F;ansible&#x2F;callback_plugins</span><br><span class=\"line\"></span><br><span class=\"line\">cd &#x2F;etc&#x2F;ansible&#x2F;callback_plugins</span><br><span class=\"line\">vim result_echo.py</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#!&#x2F;usr&#x2F;bin&#x2F;env python</span><br><span class=\"line\"># -*- coding&#x3D;utf-8 -*-</span><br><span class=\"line\">######################</span><br><span class=\"line\">from __future__ import (absolute_import, division, print_function)</span><br><span class=\"line\">__metaclass__ &#x3D; type</span><br><span class=\"line\"></span><br><span class=\"line\">from ansible.plugins.callback.default import CallbackModule as CallbackModule_default</span><br><span class=\"line\"></span><br><span class=\"line\">class CallbackModule(CallbackModule_default):</span><br><span class=\"line\"></span><br><span class=\"line\">    &#39;&#39;&#39;</span><br><span class=\"line\">    Execution result echo</span><br><span class=\"line\">    &#39;&#39;&#39;</span><br><span class=\"line\"></span><br><span class=\"line\">    CALLBACK_VERSION &#x3D; 2.0</span><br><span class=\"line\">    CALLBACK_TYPE &#x3D; &#39;notification&#39;</span><br><span class=\"line\">    #CALLBACK_TYPE &#x3D; &#39;stdout&#39;</span><br><span class=\"line\">    CALLBACK_NAME &#x3D; &#39;result_echo&#39;</span><br><span class=\"line\"></span><br><span class=\"line\">    def __init__(self):</span><br><span class=\"line\">        super(CallbackModule, self).__init__()</span><br><span class=\"line\">        self.lock_results &#x3D; None</span><br><span class=\"line\"></span><br><span class=\"line\">    def on_any(self, *args, **kwargs):</span><br><span class=\"line\">        pass</span><br><span class=\"line\">    def runner_on_failed(self, host, res, ignore_errors&#x3D;False):</span><br><span class=\"line\">        pass</span><br><span class=\"line\">    def runner_on_ok(self, host, res):</span><br><span class=\"line\">        #pass</span><br><span class=\"line\">        print(res)</span><br><span class=\"line\">    def runner_on_skipped(self, host, item&#x3D;None):</span><br><span class=\"line\">        pass</span><br><span class=\"line\">    def runner_on_unreachable(self, host, res):</span><br><span class=\"line\">        #pass</span><br><span class=\"line\">        print(res)</span><br><span class=\"line\">    def runner_on_no_hosts(self):</span><br><span class=\"line\">        pass</span><br><span class=\"line\">    def runner_on_async_poll(self, host, res, jid, clock):</span><br><span class=\"line\">        pass</span><br><span class=\"line\">    def runner_on_async_ok(self, host, res, jid):</span><br><span class=\"line\">        pass</span><br><span class=\"line\">    def runner_on_async_failed(self, host, res, jid):</span><br><span class=\"line\">        pass</span><br><span class=\"line\">    def playbook_on_start(self):</span><br><span class=\"line\">        pass</span><br><span class=\"line\">    def playbook_on_notify(self, host, handler):</span><br><span class=\"line\">        pass</span><br><span class=\"line\">    def playbook_on_no_hosts_matched(self):</span><br><span class=\"line\">        pass</span><br><span class=\"line\">    def playbook_on_no_hosts_remaining(self):</span><br><span class=\"line\">        pass</span><br><span class=\"line\">    def playbook_on_task_start(self, name, is_conditional):</span><br><span class=\"line\">        pass</span><br><span class=\"line\">    def playbook_on_vars_prompt(self, varname, private&#x3D;True, prompt&#x3D;None, encrypt&#x3D;None, confirm&#x3D;False, salt_size&#x3D;None, salt&#x3D;None, default&#x3D;None):</span><br><span class=\"line\">        pass</span><br><span class=\"line\">    def playbook_on_setup(self):</span><br><span class=\"line\">        pass</span><br><span class=\"line\">    def playbook_on_import_for_host(self, host, imported_file):</span><br><span class=\"line\">        pass</span><br><span class=\"line\">    def playbook_on_not_import_for_host(self, host, missing_file):</span><br><span class=\"line\">        pass</span><br><span class=\"line\">    def playbook_on_play_start(self, name):</span><br><span class=\"line\">        pass</span><br><span class=\"line\">    def playbook_on_stats(self, stats):</span><br><span class=\"line\">        pass</span><br><span class=\"line\">    def on_file_diff(self, host, diff):</span><br><span class=\"line\">        pass</span><br><span class=\"line\">    def v2_on_any(self, *args, **kwargs):</span><br><span class=\"line\">        pass</span><br><span class=\"line\">    def v2_runner_on_failed(self, result, ignore_errors&#x3D;False):</span><br><span class=\"line\">        #pass</span><br><span class=\"line\">        #print (result.__dict__.items())</span><br><span class=\"line\">        #if &quot;stderr_lines&quot; in result._result.keys():</span><br><span class=\"line\">        #    print( result._result[&#39;stderr_lines&#39;])</span><br><span class=\"line\">        #if &#39;state&#39; in result._result.keys():</span><br><span class=\"line\">        #    print( result._result[&#39;state&#39;])</span><br><span class=\"line\">        #if &#39;invocation&#39; in result._result.keys():</span><br><span class=\"line\">        #    print( result._result[&#39;invocation&#39;])</span><br><span class=\"line\">    def v2_runner_on_ok(self, result):</span><br><span class=\"line\">        if &quot;stdout&quot; in result._result.keys():</span><br><span class=\"line\">            print( result._result[&#39;stdout&#39;])</span><br><span class=\"line\">        if &#39;state&#39; in result._result.keys():</span><br><span class=\"line\">            print( result._result[&#39;state&#39;])</span><br><span class=\"line\">        if &#39;invocation&#39; in result._result.keys():</span><br><span class=\"line\">            print( result._result[&#39;invocation&#39;])</span><br><span class=\"line\">        #pass</span><br><span class=\"line\">    def v2_runner_on_skipped(self, result):</span><br><span class=\"line\">        pass</span><br><span class=\"line\">    def v2_runner_on_unreachable(self, result):</span><br><span class=\"line\">        pass</span><br><span class=\"line\">    def v2_runner_on_no_hosts(self, task):</span><br><span class=\"line\">        pass</span><br><span class=\"line\">    def v2_runner_on_async_poll(self, result):</span><br><span class=\"line\">        pass</span><br><span class=\"line\">    def v2_runner_on_async_ok(self, result):</span><br><span class=\"line\">        pass</span><br><span class=\"line\">    def v2_runner_on_async_failed(self, result):</span><br><span class=\"line\">        pass</span><br><span class=\"line\">    def v2_runner_on_file_diff(self, result, diff):</span><br><span class=\"line\">        pass</span><br><span class=\"line\">    def v2_playbook_on_start(self, playbook):</span><br><span class=\"line\">        pass</span><br><span class=\"line\">    def v2_playbook_on_notify(self, result, handler):</span><br><span class=\"line\">        pass</span><br><span class=\"line\">    def v2_playbook_on_no_hosts_matched(self):</span><br><span class=\"line\">        pass</span><br><span class=\"line\">    def v2_playbook_on_no_hosts_remaining(self):</span><br><span class=\"line\">        pass</span><br><span class=\"line\">    def v2_playbook_on_task_start(self, task, is_conditional):</span><br><span class=\"line\">        pass</span><br><span class=\"line\">    def v2_playbook_on_cleanup_task_start(self, task):</span><br><span class=\"line\">        pass</span><br><span class=\"line\">    def v2_playbook_on_handler_task_start(self, task):</span><br><span class=\"line\">        pass</span><br><span class=\"line\">    def v2_playbook_on_vars_prompt(self, varname, private&#x3D;True, prompt&#x3D;None, encrypt&#x3D;None, confirm&#x3D;False, salt_size&#x3D;None, salt&#x3D;None, default&#x3D;None):</span><br><span class=\"line\">        pass</span><br><span class=\"line\">    def v2_playbook_on_setup(self):</span><br><span class=\"line\">        pass</span><br><span class=\"line\">    def v2_playbook_on_import_for_host(self, result, imported_file):</span><br><span class=\"line\">        pass</span><br><span class=\"line\">    def v2_playbook_on_not_import_for_host(self, result, missing_file):</span><br><span class=\"line\">        pass</span><br><span class=\"line\">    def v2_playbook_on_play_start(self, play):</span><br><span class=\"line\">        pass</span><br><span class=\"line\">    def v2_playbook_on_stats(self, stats):</span><br><span class=\"line\">        pass</span><br><span class=\"line\">    def v2_on_file_diff(self, result):</span><br><span class=\"line\">        pass</span><br><span class=\"line\">    def v2_playbook_on_include(self, included_file):</span><br><span class=\"line\">        pass</span><br><span class=\"line\">    def v2_runner_item_on_ok(self, result):</span><br><span class=\"line\">        pass</span><br><span class=\"line\">    def v2_runner_item_on_failed(self, result):</span><br><span class=\"line\">        pass</span><br><span class=\"line\">    def v2_runner_item_on_skipped(self, result):</span><br><span class=\"line\">        pass</span><br><span class=\"line\">    def v2_runner_retry(self, result):</span><br><span class=\"line\">        pass</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"方法的result值\"><a href=\"#方法的result值\" class=\"headerlink\" title=\"方法的result值\"></a>方法的result值</h3><p>print(result._task) 输出任务名<br>print(result._check_key)<br>print(result._host) 输出主机名<br>print(result._result) 输出任务执行的结果<br>print(result.is_changed)<br>print(result.is_failed)</p>\n<h3 id=\"定义callback说明信息\"><a href=\"#定义callback说明信息\" class=\"headerlink\" title=\"定义callback说明信息\"></a>定义callback说明信息</h3><p>CALLBACK_VERSION = 2.0 插件版本<br>CALLBACK_TYPE = ‘aggregate’ 插件类型，如果是’stdout’时，只会加载一个这样的回调插件<br>CALLBACK_NAME = ‘timer’ 插件名称，需与文件名称一致。<br>CALLBACK_NEEDS_WHITELIST = True 插件是否需要在配置文件配置whitelist。为true是，ansible检查ansible.cfg文件中的callback_whitelist是否有插件名称，有则执行，无则跳过。</p>\n","site":{"data":{}},"excerpt":"<p>摘要: Playbook支持任务结果回显，不只是执行是否成功</p>","more":"<h3 id=\"配置文件\"><a href=\"#配置文件\" class=\"headerlink\" title=\"配置文件\"></a>配置文件</h3><p>ansible.cfg 配置文件（变更callback路径位置）</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[defaults]</span><br><span class=\"line\">callback_plugins&#x3D;&#x2F;etc&#x2F;ansible&#x2F;callback_plugins</span><br><span class=\"line\"># change the default callback</span><br><span class=\"line\">#stdout_callback &#x3D; result_echo</span><br><span class=\"line\"># enable additional callbacks</span><br><span class=\"line\">callback_whitelist &#x3D; result_echo</span><br><span class=\"line\">bin_ansible_callbacks &#x3D; Ture</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"编写回显callback脚本\"><a href=\"#编写回显callback脚本\" class=\"headerlink\" title=\"编写回显callback脚本\"></a>编写回显callback脚本</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir &#x2F;etc&#x2F;ansible&#x2F;callback_plugins</span><br><span class=\"line\"></span><br><span class=\"line\">cd &#x2F;etc&#x2F;ansible&#x2F;callback_plugins</span><br><span class=\"line\">vim result_echo.py</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#!&#x2F;usr&#x2F;bin&#x2F;env python</span><br><span class=\"line\"># -*- coding&#x3D;utf-8 -*-</span><br><span class=\"line\">######################</span><br><span class=\"line\">from __future__ import (absolute_import, division, print_function)</span><br><span class=\"line\">__metaclass__ &#x3D; type</span><br><span class=\"line\"></span><br><span class=\"line\">from ansible.plugins.callback.default import CallbackModule as CallbackModule_default</span><br><span class=\"line\"></span><br><span class=\"line\">class CallbackModule(CallbackModule_default):</span><br><span class=\"line\"></span><br><span class=\"line\">    &#39;&#39;&#39;</span><br><span class=\"line\">    Execution result echo</span><br><span class=\"line\">    &#39;&#39;&#39;</span><br><span class=\"line\"></span><br><span class=\"line\">    CALLBACK_VERSION &#x3D; 2.0</span><br><span class=\"line\">    CALLBACK_TYPE &#x3D; &#39;notification&#39;</span><br><span class=\"line\">    #CALLBACK_TYPE &#x3D; &#39;stdout&#39;</span><br><span class=\"line\">    CALLBACK_NAME &#x3D; &#39;result_echo&#39;</span><br><span class=\"line\"></span><br><span class=\"line\">    def __init__(self):</span><br><span class=\"line\">        super(CallbackModule, self).__init__()</span><br><span class=\"line\">        self.lock_results &#x3D; None</span><br><span class=\"line\"></span><br><span class=\"line\">    def on_any(self, *args, **kwargs):</span><br><span class=\"line\">        pass</span><br><span class=\"line\">    def runner_on_failed(self, host, res, ignore_errors&#x3D;False):</span><br><span class=\"line\">        pass</span><br><span class=\"line\">    def runner_on_ok(self, host, res):</span><br><span class=\"line\">        #pass</span><br><span class=\"line\">        print(res)</span><br><span class=\"line\">    def runner_on_skipped(self, host, item&#x3D;None):</span><br><span class=\"line\">        pass</span><br><span class=\"line\">    def runner_on_unreachable(self, host, res):</span><br><span class=\"line\">        #pass</span><br><span class=\"line\">        print(res)</span><br><span class=\"line\">    def runner_on_no_hosts(self):</span><br><span class=\"line\">        pass</span><br><span class=\"line\">    def runner_on_async_poll(self, host, res, jid, clock):</span><br><span class=\"line\">        pass</span><br><span class=\"line\">    def runner_on_async_ok(self, host, res, jid):</span><br><span class=\"line\">        pass</span><br><span class=\"line\">    def runner_on_async_failed(self, host, res, jid):</span><br><span class=\"line\">        pass</span><br><span class=\"line\">    def playbook_on_start(self):</span><br><span class=\"line\">        pass</span><br><span class=\"line\">    def playbook_on_notify(self, host, handler):</span><br><span class=\"line\">        pass</span><br><span class=\"line\">    def playbook_on_no_hosts_matched(self):</span><br><span class=\"line\">        pass</span><br><span class=\"line\">    def playbook_on_no_hosts_remaining(self):</span><br><span class=\"line\">        pass</span><br><span class=\"line\">    def playbook_on_task_start(self, name, is_conditional):</span><br><span class=\"line\">        pass</span><br><span class=\"line\">    def playbook_on_vars_prompt(self, varname, private&#x3D;True, prompt&#x3D;None, encrypt&#x3D;None, confirm&#x3D;False, salt_size&#x3D;None, salt&#x3D;None, default&#x3D;None):</span><br><span class=\"line\">        pass</span><br><span class=\"line\">    def playbook_on_setup(self):</span><br><span class=\"line\">        pass</span><br><span class=\"line\">    def playbook_on_import_for_host(self, host, imported_file):</span><br><span class=\"line\">        pass</span><br><span class=\"line\">    def playbook_on_not_import_for_host(self, host, missing_file):</span><br><span class=\"line\">        pass</span><br><span class=\"line\">    def playbook_on_play_start(self, name):</span><br><span class=\"line\">        pass</span><br><span class=\"line\">    def playbook_on_stats(self, stats):</span><br><span class=\"line\">        pass</span><br><span class=\"line\">    def on_file_diff(self, host, diff):</span><br><span class=\"line\">        pass</span><br><span class=\"line\">    def v2_on_any(self, *args, **kwargs):</span><br><span class=\"line\">        pass</span><br><span class=\"line\">    def v2_runner_on_failed(self, result, ignore_errors&#x3D;False):</span><br><span class=\"line\">        #pass</span><br><span class=\"line\">        #print (result.__dict__.items())</span><br><span class=\"line\">        #if &quot;stderr_lines&quot; in result._result.keys():</span><br><span class=\"line\">        #    print( result._result[&#39;stderr_lines&#39;])</span><br><span class=\"line\">        #if &#39;state&#39; in result._result.keys():</span><br><span class=\"line\">        #    print( result._result[&#39;state&#39;])</span><br><span class=\"line\">        #if &#39;invocation&#39; in result._result.keys():</span><br><span class=\"line\">        #    print( result._result[&#39;invocation&#39;])</span><br><span class=\"line\">    def v2_runner_on_ok(self, result):</span><br><span class=\"line\">        if &quot;stdout&quot; in result._result.keys():</span><br><span class=\"line\">            print( result._result[&#39;stdout&#39;])</span><br><span class=\"line\">        if &#39;state&#39; in result._result.keys():</span><br><span class=\"line\">            print( result._result[&#39;state&#39;])</span><br><span class=\"line\">        if &#39;invocation&#39; in result._result.keys():</span><br><span class=\"line\">            print( result._result[&#39;invocation&#39;])</span><br><span class=\"line\">        #pass</span><br><span class=\"line\">    def v2_runner_on_skipped(self, result):</span><br><span class=\"line\">        pass</span><br><span class=\"line\">    def v2_runner_on_unreachable(self, result):</span><br><span class=\"line\">        pass</span><br><span class=\"line\">    def v2_runner_on_no_hosts(self, task):</span><br><span class=\"line\">        pass</span><br><span class=\"line\">    def v2_runner_on_async_poll(self, result):</span><br><span class=\"line\">        pass</span><br><span class=\"line\">    def v2_runner_on_async_ok(self, result):</span><br><span class=\"line\">        pass</span><br><span class=\"line\">    def v2_runner_on_async_failed(self, result):</span><br><span class=\"line\">        pass</span><br><span class=\"line\">    def v2_runner_on_file_diff(self, result, diff):</span><br><span class=\"line\">        pass</span><br><span class=\"line\">    def v2_playbook_on_start(self, playbook):</span><br><span class=\"line\">        pass</span><br><span class=\"line\">    def v2_playbook_on_notify(self, result, handler):</span><br><span class=\"line\">        pass</span><br><span class=\"line\">    def v2_playbook_on_no_hosts_matched(self):</span><br><span class=\"line\">        pass</span><br><span class=\"line\">    def v2_playbook_on_no_hosts_remaining(self):</span><br><span class=\"line\">        pass</span><br><span class=\"line\">    def v2_playbook_on_task_start(self, task, is_conditional):</span><br><span class=\"line\">        pass</span><br><span class=\"line\">    def v2_playbook_on_cleanup_task_start(self, task):</span><br><span class=\"line\">        pass</span><br><span class=\"line\">    def v2_playbook_on_handler_task_start(self, task):</span><br><span class=\"line\">        pass</span><br><span class=\"line\">    def v2_playbook_on_vars_prompt(self, varname, private&#x3D;True, prompt&#x3D;None, encrypt&#x3D;None, confirm&#x3D;False, salt_size&#x3D;None, salt&#x3D;None, default&#x3D;None):</span><br><span class=\"line\">        pass</span><br><span class=\"line\">    def v2_playbook_on_setup(self):</span><br><span class=\"line\">        pass</span><br><span class=\"line\">    def v2_playbook_on_import_for_host(self, result, imported_file):</span><br><span class=\"line\">        pass</span><br><span class=\"line\">    def v2_playbook_on_not_import_for_host(self, result, missing_file):</span><br><span class=\"line\">        pass</span><br><span class=\"line\">    def v2_playbook_on_play_start(self, play):</span><br><span class=\"line\">        pass</span><br><span class=\"line\">    def v2_playbook_on_stats(self, stats):</span><br><span class=\"line\">        pass</span><br><span class=\"line\">    def v2_on_file_diff(self, result):</span><br><span class=\"line\">        pass</span><br><span class=\"line\">    def v2_playbook_on_include(self, included_file):</span><br><span class=\"line\">        pass</span><br><span class=\"line\">    def v2_runner_item_on_ok(self, result):</span><br><span class=\"line\">        pass</span><br><span class=\"line\">    def v2_runner_item_on_failed(self, result):</span><br><span class=\"line\">        pass</span><br><span class=\"line\">    def v2_runner_item_on_skipped(self, result):</span><br><span class=\"line\">        pass</span><br><span class=\"line\">    def v2_runner_retry(self, result):</span><br><span class=\"line\">        pass</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"方法的result值\"><a href=\"#方法的result值\" class=\"headerlink\" title=\"方法的result值\"></a>方法的result值</h3><p>print(result._task) 输出任务名<br>print(result._check_key)<br>print(result._host) 输出主机名<br>print(result._result) 输出任务执行的结果<br>print(result.is_changed)<br>print(result.is_failed)</p>\n<h3 id=\"定义callback说明信息\"><a href=\"#定义callback说明信息\" class=\"headerlink\" title=\"定义callback说明信息\"></a>定义callback说明信息</h3><p>CALLBACK_VERSION = 2.0 插件版本<br>CALLBACK_TYPE = ‘aggregate’ 插件类型，如果是’stdout’时，只会加载一个这样的回调插件<br>CALLBACK_NAME = ‘timer’ 插件名称，需与文件名称一致。<br>CALLBACK_NEEDS_WHITELIST = True 插件是否需要在配置文件配置whitelist。为true是，ansible检查ansible.cfg文件中的callback_whitelist是否有插件名称，有则执行，无则跳过。</p>"},{"title":"主机管理设计","date":"2020-10-13T06:17:00.000Z","_content":"  \n  \n摘要: desc\n<!-- more -->\n\n\n创建数据库\n```\nCREATE DATABASE cmdb\nuse cmdb\n```\n\nidc表\nCREATE TABLE `idc` (\n  `id` int(11) NOT NULL AUTO_INCREMENT,\n  `name` varchar(128) NOT NULL,\n  `location` varchar(128) NOT NULL,\n  PRIMARY KEY (`id`)\n) ENGINE=InnoDB AUTO_INCREMENT=4 DEFAULT CHARSET=utf8;\n\n|  字段   | 描述  |\n|  ----  | ----  |\n| id  | id |\n| name  | 名称 |\n| location | 位置 |\n\n\n物理机表\nserver\nCREATE TABLE `server_hw` (\n  `id` int(11) NOT NULL AUTO_INCREMENT comment '物理机id',\n  `hostname` varchar(128) NOT NULL  comment '主机名' ,\n  `serial_num` varchar(128)   comment '序列号',\n  `CPU` varchar(128)   comment 'CPU',\n  `memory` varchar(58)   comment '内存',\n  `disk` varchar(128)   comment '磁盘',\n  `mg_ip` varchar(128)  comment '管理ip',\n  `net_ip` varchar(128)  comment 'IP',\n  `ops` varchar(128)  comment '操作系统',\n  `asset_numb` varchar(128)  comment '资产编号',\n  `location` varchar(128)  comment 'idc',\n  `purchase_at` TIMESTAMP  comment '采购时间',\n  `over_at` TIMESTAMP  comment '过保时间',\n  `desc` varchar(128)  comment '描述',\n  `guarantee_status` int(2)  comment '保修状态',\n  `status` int(8)  comment '状态',\n  PRIMARY KEY (`id`)\n) ENGINE=InnoDB AUTO_INCREMENT=4 DEFAULT CHARSET=utf8;\n\n| 字段 | 描 述 |  属性 | 参数 | \n|  ----  | ----  | ---- | ---- |\n| id | id |  uuid | |\n| hostname| 主机名 | str | |\n| serial_num | 序列号 |  str | |\n| CPU | CPU |  str | |\n| memory | 内存 |  str | |\n| disk | 磁盘 | dict | |\n| net | 网卡 |  dict | |\n| mg_ip | 管理ip |  str | |\n| ops | 操作系统 |  str | |\n| asset_numb | 资产编号 | str | |\n| purchase_at | 采购时间 | time | |\n| over_at| 过保时间 | time |  |\n| desc | 备注 | str |  |\n| guarantee_status | 保修状态 | bit | 0, 1|\n| status | 状态 | bit | 0 , 1 , 2 , 3 |\n| location | 位置 | int |  |\n\n\nguarantee_status | 保修状态 | bit | \n0  在保\n1  过保\n\nstatus | 状态 | bit |\n0 下架     000000\n1 上架     000001\n2 上线     000010\n3 下线     000100\n4 故障     001000\n\n下架        000000\n下架, 下线  000100\n下架，故障  001000\n\n上架        000001\n上架，下线  000101\n上架，故障  001001\n\n\n\n\n虚拟机表\nserver_vm\n\nCREATE TABLE `server_vm` (\n  `id` int(11) NOT NULL AUTO_INCREMENT comment '虚拟机id',\n  `hostname` varchar(128)   comment '主机名' ,\n  `serial_num` varchar(128)   comment '序列号',\n  `CPU` varchar(128)   comment 'CPU',\n  `memory` varchar(58)   comment '内存',\n  `disk` varchar(128)   comment '磁盘',\n  `mg_ip` varchar(128)  comment '管理ip',\n  `net_ip` varchar(128)  comment 'IP',\n  `ops` varchar(128)  comment '操作系统',\n  `asset_numb` varchar(128)  comment '资产编号',\n  `location` int  comment '宿主机',\n  `status` int  comment '状态',\n  PRIMARY KEY (`id`)\n) ENGINE=InnoDB AUTO_INCREMENT=4 DEFAULT CHARSET=utf8;\n\n\n| 字段 | 描 述 |  属性 | 参数 | \n|  ----  | ----  | ---- | ---- |\n| id | id |  uuid | |\n| hostname| 主机名 | str | |\n| serial_num | 序列号 |  str | |\n| CPU | CPU |  str | |\n| memory | 内存 |  str | |\n| disk | 磁盘 | dict | |\n| mg_ip | 管理ip |  str | |\n| net_ip | ip | dict | |\n| ops | 操作系统 |  str | |\n| asset_numb | 资产编号 | str | |\n| desc | 备注 | str |  |\n| location | 位置 | str | |\n\n\n\nstatus : \n  200     成功\n  204     失败\n\n\nidc  crud \n\n/add    post \n{\n  \"name\":\"\",\n  \"location\":\"\"\n}\n\n\n\n\n\n### 项目创建\n```\nmkdir gocmdb\ncd gocmdb\ngo mod init gocmdb\n\nmkdir -p conf middleware models pkg routers runtime\n```\n\n```\nconf：         用于存储配置文件\nmiddleware：   应用中间件\nmodels：       应用数据库模型\npkg：          第三方包\nrouters        路由逻辑处理\nruntime        应用运行时数据\ndatasource     数据库连接和初始化表\n```\n\n```\nconf                配置文件\ncontrollers         控制器 入参处理 api的入口\ndatasource          数据库配置 \nmodels              结构体\ndb                  sql数据文件 postman接口文件\nrepo                数据库的操作\nmiddleware          中间件 jwt实现\nroute               注册路由\nservice             业务逻辑代码\nutils               工具类\nconfig.json         配置文件的映射\nmain.go             主程序入口\n```\n\n\n\n\n\n\n","source":"_posts/cmdb/hosts.md","raw":"---\ntitle: 主机管理设计\ndate: 2020-10-13 14:17\ncategories:\n- cmdb\ntags:\n- cmdb\n---\n  \n  \n摘要: desc\n<!-- more -->\n\n\n创建数据库\n```\nCREATE DATABASE cmdb\nuse cmdb\n```\n\nidc表\nCREATE TABLE `idc` (\n  `id` int(11) NOT NULL AUTO_INCREMENT,\n  `name` varchar(128) NOT NULL,\n  `location` varchar(128) NOT NULL,\n  PRIMARY KEY (`id`)\n) ENGINE=InnoDB AUTO_INCREMENT=4 DEFAULT CHARSET=utf8;\n\n|  字段   | 描述  |\n|  ----  | ----  |\n| id  | id |\n| name  | 名称 |\n| location | 位置 |\n\n\n物理机表\nserver\nCREATE TABLE `server_hw` (\n  `id` int(11) NOT NULL AUTO_INCREMENT comment '物理机id',\n  `hostname` varchar(128) NOT NULL  comment '主机名' ,\n  `serial_num` varchar(128)   comment '序列号',\n  `CPU` varchar(128)   comment 'CPU',\n  `memory` varchar(58)   comment '内存',\n  `disk` varchar(128)   comment '磁盘',\n  `mg_ip` varchar(128)  comment '管理ip',\n  `net_ip` varchar(128)  comment 'IP',\n  `ops` varchar(128)  comment '操作系统',\n  `asset_numb` varchar(128)  comment '资产编号',\n  `location` varchar(128)  comment 'idc',\n  `purchase_at` TIMESTAMP  comment '采购时间',\n  `over_at` TIMESTAMP  comment '过保时间',\n  `desc` varchar(128)  comment '描述',\n  `guarantee_status` int(2)  comment '保修状态',\n  `status` int(8)  comment '状态',\n  PRIMARY KEY (`id`)\n) ENGINE=InnoDB AUTO_INCREMENT=4 DEFAULT CHARSET=utf8;\n\n| 字段 | 描 述 |  属性 | 参数 | \n|  ----  | ----  | ---- | ---- |\n| id | id |  uuid | |\n| hostname| 主机名 | str | |\n| serial_num | 序列号 |  str | |\n| CPU | CPU |  str | |\n| memory | 内存 |  str | |\n| disk | 磁盘 | dict | |\n| net | 网卡 |  dict | |\n| mg_ip | 管理ip |  str | |\n| ops | 操作系统 |  str | |\n| asset_numb | 资产编号 | str | |\n| purchase_at | 采购时间 | time | |\n| over_at| 过保时间 | time |  |\n| desc | 备注 | str |  |\n| guarantee_status | 保修状态 | bit | 0, 1|\n| status | 状态 | bit | 0 , 1 , 2 , 3 |\n| location | 位置 | int |  |\n\n\nguarantee_status | 保修状态 | bit | \n0  在保\n1  过保\n\nstatus | 状态 | bit |\n0 下架     000000\n1 上架     000001\n2 上线     000010\n3 下线     000100\n4 故障     001000\n\n下架        000000\n下架, 下线  000100\n下架，故障  001000\n\n上架        000001\n上架，下线  000101\n上架，故障  001001\n\n\n\n\n虚拟机表\nserver_vm\n\nCREATE TABLE `server_vm` (\n  `id` int(11) NOT NULL AUTO_INCREMENT comment '虚拟机id',\n  `hostname` varchar(128)   comment '主机名' ,\n  `serial_num` varchar(128)   comment '序列号',\n  `CPU` varchar(128)   comment 'CPU',\n  `memory` varchar(58)   comment '内存',\n  `disk` varchar(128)   comment '磁盘',\n  `mg_ip` varchar(128)  comment '管理ip',\n  `net_ip` varchar(128)  comment 'IP',\n  `ops` varchar(128)  comment '操作系统',\n  `asset_numb` varchar(128)  comment '资产编号',\n  `location` int  comment '宿主机',\n  `status` int  comment '状态',\n  PRIMARY KEY (`id`)\n) ENGINE=InnoDB AUTO_INCREMENT=4 DEFAULT CHARSET=utf8;\n\n\n| 字段 | 描 述 |  属性 | 参数 | \n|  ----  | ----  | ---- | ---- |\n| id | id |  uuid | |\n| hostname| 主机名 | str | |\n| serial_num | 序列号 |  str | |\n| CPU | CPU |  str | |\n| memory | 内存 |  str | |\n| disk | 磁盘 | dict | |\n| mg_ip | 管理ip |  str | |\n| net_ip | ip | dict | |\n| ops | 操作系统 |  str | |\n| asset_numb | 资产编号 | str | |\n| desc | 备注 | str |  |\n| location | 位置 | str | |\n\n\n\nstatus : \n  200     成功\n  204     失败\n\n\nidc  crud \n\n/add    post \n{\n  \"name\":\"\",\n  \"location\":\"\"\n}\n\n\n\n\n\n### 项目创建\n```\nmkdir gocmdb\ncd gocmdb\ngo mod init gocmdb\n\nmkdir -p conf middleware models pkg routers runtime\n```\n\n```\nconf：         用于存储配置文件\nmiddleware：   应用中间件\nmodels：       应用数据库模型\npkg：          第三方包\nrouters        路由逻辑处理\nruntime        应用运行时数据\ndatasource     数据库连接和初始化表\n```\n\n```\nconf                配置文件\ncontrollers         控制器 入参处理 api的入口\ndatasource          数据库配置 \nmodels              结构体\ndb                  sql数据文件 postman接口文件\nrepo                数据库的操作\nmiddleware          中间件 jwt实现\nroute               注册路由\nservice             业务逻辑代码\nutils               工具类\nconfig.json         配置文件的映射\nmain.go             主程序入口\n```\n\n\n\n\n\n\n","slug":"cmdb/hosts","published":1,"updated":"2021-06-18T08:07:11.184Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cku6979yl001t00uhhejp3fu8","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><p>摘要: desc</p>\n<span id=\"more\"></span>\n\n\n<p>创建数据库</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">CREATE DATABASE cmdb</span><br><span class=\"line\">use cmdb</span><br></pre></td></tr></table></figure>\n\n<p>idc表<br>CREATE TABLE <code>idc</code> (<br>  <code>id</code> int(11) NOT NULL AUTO_INCREMENT,<br>  <code>name</code> varchar(128) NOT NULL,<br>  <code>location</code> varchar(128) NOT NULL,<br>  PRIMARY KEY (<code>id</code>)<br>) ENGINE=InnoDB AUTO_INCREMENT=4 DEFAULT CHARSET=utf8;</p>\n<table>\n<thead>\n<tr>\n<th>字段</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>id</td>\n<td>id</td>\n</tr>\n<tr>\n<td>name</td>\n<td>名称</td>\n</tr>\n<tr>\n<td>location</td>\n<td>位置</td>\n</tr>\n</tbody></table>\n<p>物理机表<br>server<br>CREATE TABLE <code>server_hw</code> (<br>  <code>id</code> int(11) NOT NULL AUTO_INCREMENT comment ‘物理机id’,<br>  <code>hostname</code> varchar(128) NOT NULL  comment ‘主机名’ ,<br>  <code>serial_num</code> varchar(128)   comment ‘序列号’,<br>  <code>CPU</code> varchar(128)   comment ‘CPU’,<br>  <code>memory</code> varchar(58)   comment ‘内存’,<br>  <code>disk</code> varchar(128)   comment ‘磁盘’,<br>  <code>mg_ip</code> varchar(128)  comment ‘管理ip’,<br>  <code>net_ip</code> varchar(128)  comment ‘IP’,<br>  <code>ops</code> varchar(128)  comment ‘操作系统’,<br>  <code>asset_numb</code> varchar(128)  comment ‘资产编号’,<br>  <code>location</code> varchar(128)  comment ‘idc’,<br>  <code>purchase_at</code> TIMESTAMP  comment ‘采购时间’,<br>  <code>over_at</code> TIMESTAMP  comment ‘过保时间’,<br>  <code>desc</code> varchar(128)  comment ‘描述’,<br>  <code>guarantee_status</code> int(2)  comment ‘保修状态’,<br>  <code>status</code> int(8)  comment ‘状态’,<br>  PRIMARY KEY (<code>id</code>)<br>) ENGINE=InnoDB AUTO_INCREMENT=4 DEFAULT CHARSET=utf8;</p>\n<table>\n<thead>\n<tr>\n<th>字段</th>\n<th>描 述</th>\n<th>属性</th>\n<th>参数</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>id</td>\n<td>id</td>\n<td>uuid</td>\n<td></td>\n</tr>\n<tr>\n<td>hostname</td>\n<td>主机名</td>\n<td>str</td>\n<td></td>\n</tr>\n<tr>\n<td>serial_num</td>\n<td>序列号</td>\n<td>str</td>\n<td></td>\n</tr>\n<tr>\n<td>CPU</td>\n<td>CPU</td>\n<td>str</td>\n<td></td>\n</tr>\n<tr>\n<td>memory</td>\n<td>内存</td>\n<td>str</td>\n<td></td>\n</tr>\n<tr>\n<td>disk</td>\n<td>磁盘</td>\n<td>dict</td>\n<td></td>\n</tr>\n<tr>\n<td>net</td>\n<td>网卡</td>\n<td>dict</td>\n<td></td>\n</tr>\n<tr>\n<td>mg_ip</td>\n<td>管理ip</td>\n<td>str</td>\n<td></td>\n</tr>\n<tr>\n<td>ops</td>\n<td>操作系统</td>\n<td>str</td>\n<td></td>\n</tr>\n<tr>\n<td>asset_numb</td>\n<td>资产编号</td>\n<td>str</td>\n<td></td>\n</tr>\n<tr>\n<td>purchase_at</td>\n<td>采购时间</td>\n<td>time</td>\n<td></td>\n</tr>\n<tr>\n<td>over_at</td>\n<td>过保时间</td>\n<td>time</td>\n<td></td>\n</tr>\n<tr>\n<td>desc</td>\n<td>备注</td>\n<td>str</td>\n<td></td>\n</tr>\n<tr>\n<td>guarantee_status</td>\n<td>保修状态</td>\n<td>bit</td>\n<td>0, 1</td>\n</tr>\n<tr>\n<td>status</td>\n<td>状态</td>\n<td>bit</td>\n<td>0 , 1 , 2 , 3</td>\n</tr>\n<tr>\n<td>location</td>\n<td>位置</td>\n<td>int</td>\n<td></td>\n</tr>\n</tbody></table>\n<p>guarantee_status | 保修状态 | bit |<br>0  在保<br>1  过保</p>\n<p>status | 状态 | bit |<br>0 下架     000000<br>1 上架     000001<br>2 上线     000010<br>3 下线     000100<br>4 故障     001000</p>\n<p>下架        000000<br>下架, 下线  000100<br>下架，故障  001000</p>\n<p>上架        000001<br>上架，下线  000101<br>上架，故障  001001</p>\n<p>虚拟机表<br>server_vm</p>\n<p>CREATE TABLE <code>server_vm</code> (<br>  <code>id</code> int(11) NOT NULL AUTO_INCREMENT comment ‘虚拟机id’,<br>  <code>hostname</code> varchar(128)   comment ‘主机名’ ,<br>  <code>serial_num</code> varchar(128)   comment ‘序列号’,<br>  <code>CPU</code> varchar(128)   comment ‘CPU’,<br>  <code>memory</code> varchar(58)   comment ‘内存’,<br>  <code>disk</code> varchar(128)   comment ‘磁盘’,<br>  <code>mg_ip</code> varchar(128)  comment ‘管理ip’,<br>  <code>net_ip</code> varchar(128)  comment ‘IP’,<br>  <code>ops</code> varchar(128)  comment ‘操作系统’,<br>  <code>asset_numb</code> varchar(128)  comment ‘资产编号’,<br>  <code>location</code> int  comment ‘宿主机’,<br>  <code>status</code> int  comment ‘状态’,<br>  PRIMARY KEY (<code>id</code>)<br>) ENGINE=InnoDB AUTO_INCREMENT=4 DEFAULT CHARSET=utf8;</p>\n<table>\n<thead>\n<tr>\n<th>字段</th>\n<th>描 述</th>\n<th>属性</th>\n<th>参数</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>id</td>\n<td>id</td>\n<td>uuid</td>\n<td></td>\n</tr>\n<tr>\n<td>hostname</td>\n<td>主机名</td>\n<td>str</td>\n<td></td>\n</tr>\n<tr>\n<td>serial_num</td>\n<td>序列号</td>\n<td>str</td>\n<td></td>\n</tr>\n<tr>\n<td>CPU</td>\n<td>CPU</td>\n<td>str</td>\n<td></td>\n</tr>\n<tr>\n<td>memory</td>\n<td>内存</td>\n<td>str</td>\n<td></td>\n</tr>\n<tr>\n<td>disk</td>\n<td>磁盘</td>\n<td>dict</td>\n<td></td>\n</tr>\n<tr>\n<td>mg_ip</td>\n<td>管理ip</td>\n<td>str</td>\n<td></td>\n</tr>\n<tr>\n<td>net_ip</td>\n<td>ip</td>\n<td>dict</td>\n<td></td>\n</tr>\n<tr>\n<td>ops</td>\n<td>操作系统</td>\n<td>str</td>\n<td></td>\n</tr>\n<tr>\n<td>asset_numb</td>\n<td>资产编号</td>\n<td>str</td>\n<td></td>\n</tr>\n<tr>\n<td>desc</td>\n<td>备注</td>\n<td>str</td>\n<td></td>\n</tr>\n<tr>\n<td>location</td>\n<td>位置</td>\n<td>str</td>\n<td></td>\n</tr>\n</tbody></table>\n<p>status :<br>  200     成功<br>  204     失败</p>\n<p>idc  crud </p>\n<p>/add    post<br>{<br>  “name”:””,<br>  “location”:””<br>}</p>\n<h3 id=\"项目创建\"><a href=\"#项目创建\" class=\"headerlink\" title=\"项目创建\"></a>项目创建</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir gocmdb</span><br><span class=\"line\">cd gocmdb</span><br><span class=\"line\">go mod init gocmdb</span><br><span class=\"line\"></span><br><span class=\"line\">mkdir -p conf middleware models pkg routers runtime</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">conf：         用于存储配置文件</span><br><span class=\"line\">middleware：   应用中间件</span><br><span class=\"line\">models：       应用数据库模型</span><br><span class=\"line\">pkg：          第三方包</span><br><span class=\"line\">routers        路由逻辑处理</span><br><span class=\"line\">runtime        应用运行时数据</span><br><span class=\"line\">datasource     数据库连接和初始化表</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">conf                配置文件</span><br><span class=\"line\">controllers         控制器 入参处理 api的入口</span><br><span class=\"line\">datasource          数据库配置 </span><br><span class=\"line\">models              结构体</span><br><span class=\"line\">db                  sql数据文件 postman接口文件</span><br><span class=\"line\">repo                数据库的操作</span><br><span class=\"line\">middleware          中间件 jwt实现</span><br><span class=\"line\">route               注册路由</span><br><span class=\"line\">service             业务逻辑代码</span><br><span class=\"line\">utils               工具类</span><br><span class=\"line\">config.json         配置文件的映射</span><br><span class=\"line\">main.go             主程序入口</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n\n","site":{"data":{}},"excerpt":"<p>摘要: desc</p>","more":"<p>创建数据库</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">CREATE DATABASE cmdb</span><br><span class=\"line\">use cmdb</span><br></pre></td></tr></table></figure>\n\n<p>idc表<br>CREATE TABLE <code>idc</code> (<br>  <code>id</code> int(11) NOT NULL AUTO_INCREMENT,<br>  <code>name</code> varchar(128) NOT NULL,<br>  <code>location</code> varchar(128) NOT NULL,<br>  PRIMARY KEY (<code>id</code>)<br>) ENGINE=InnoDB AUTO_INCREMENT=4 DEFAULT CHARSET=utf8;</p>\n<table>\n<thead>\n<tr>\n<th>字段</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>id</td>\n<td>id</td>\n</tr>\n<tr>\n<td>name</td>\n<td>名称</td>\n</tr>\n<tr>\n<td>location</td>\n<td>位置</td>\n</tr>\n</tbody></table>\n<p>物理机表<br>server<br>CREATE TABLE <code>server_hw</code> (<br>  <code>id</code> int(11) NOT NULL AUTO_INCREMENT comment ‘物理机id’,<br>  <code>hostname</code> varchar(128) NOT NULL  comment ‘主机名’ ,<br>  <code>serial_num</code> varchar(128)   comment ‘序列号’,<br>  <code>CPU</code> varchar(128)   comment ‘CPU’,<br>  <code>memory</code> varchar(58)   comment ‘内存’,<br>  <code>disk</code> varchar(128)   comment ‘磁盘’,<br>  <code>mg_ip</code> varchar(128)  comment ‘管理ip’,<br>  <code>net_ip</code> varchar(128)  comment ‘IP’,<br>  <code>ops</code> varchar(128)  comment ‘操作系统’,<br>  <code>asset_numb</code> varchar(128)  comment ‘资产编号’,<br>  <code>location</code> varchar(128)  comment ‘idc’,<br>  <code>purchase_at</code> TIMESTAMP  comment ‘采购时间’,<br>  <code>over_at</code> TIMESTAMP  comment ‘过保时间’,<br>  <code>desc</code> varchar(128)  comment ‘描述’,<br>  <code>guarantee_status</code> int(2)  comment ‘保修状态’,<br>  <code>status</code> int(8)  comment ‘状态’,<br>  PRIMARY KEY (<code>id</code>)<br>) ENGINE=InnoDB AUTO_INCREMENT=4 DEFAULT CHARSET=utf8;</p>\n<table>\n<thead>\n<tr>\n<th>字段</th>\n<th>描 述</th>\n<th>属性</th>\n<th>参数</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>id</td>\n<td>id</td>\n<td>uuid</td>\n<td></td>\n</tr>\n<tr>\n<td>hostname</td>\n<td>主机名</td>\n<td>str</td>\n<td></td>\n</tr>\n<tr>\n<td>serial_num</td>\n<td>序列号</td>\n<td>str</td>\n<td></td>\n</tr>\n<tr>\n<td>CPU</td>\n<td>CPU</td>\n<td>str</td>\n<td></td>\n</tr>\n<tr>\n<td>memory</td>\n<td>内存</td>\n<td>str</td>\n<td></td>\n</tr>\n<tr>\n<td>disk</td>\n<td>磁盘</td>\n<td>dict</td>\n<td></td>\n</tr>\n<tr>\n<td>net</td>\n<td>网卡</td>\n<td>dict</td>\n<td></td>\n</tr>\n<tr>\n<td>mg_ip</td>\n<td>管理ip</td>\n<td>str</td>\n<td></td>\n</tr>\n<tr>\n<td>ops</td>\n<td>操作系统</td>\n<td>str</td>\n<td></td>\n</tr>\n<tr>\n<td>asset_numb</td>\n<td>资产编号</td>\n<td>str</td>\n<td></td>\n</tr>\n<tr>\n<td>purchase_at</td>\n<td>采购时间</td>\n<td>time</td>\n<td></td>\n</tr>\n<tr>\n<td>over_at</td>\n<td>过保时间</td>\n<td>time</td>\n<td></td>\n</tr>\n<tr>\n<td>desc</td>\n<td>备注</td>\n<td>str</td>\n<td></td>\n</tr>\n<tr>\n<td>guarantee_status</td>\n<td>保修状态</td>\n<td>bit</td>\n<td>0, 1</td>\n</tr>\n<tr>\n<td>status</td>\n<td>状态</td>\n<td>bit</td>\n<td>0 , 1 , 2 , 3</td>\n</tr>\n<tr>\n<td>location</td>\n<td>位置</td>\n<td>int</td>\n<td></td>\n</tr>\n</tbody></table>\n<p>guarantee_status | 保修状态 | bit |<br>0  在保<br>1  过保</p>\n<p>status | 状态 | bit |<br>0 下架     000000<br>1 上架     000001<br>2 上线     000010<br>3 下线     000100<br>4 故障     001000</p>\n<p>下架        000000<br>下架, 下线  000100<br>下架，故障  001000</p>\n<p>上架        000001<br>上架，下线  000101<br>上架，故障  001001</p>\n<p>虚拟机表<br>server_vm</p>\n<p>CREATE TABLE <code>server_vm</code> (<br>  <code>id</code> int(11) NOT NULL AUTO_INCREMENT comment ‘虚拟机id’,<br>  <code>hostname</code> varchar(128)   comment ‘主机名’ ,<br>  <code>serial_num</code> varchar(128)   comment ‘序列号’,<br>  <code>CPU</code> varchar(128)   comment ‘CPU’,<br>  <code>memory</code> varchar(58)   comment ‘内存’,<br>  <code>disk</code> varchar(128)   comment ‘磁盘’,<br>  <code>mg_ip</code> varchar(128)  comment ‘管理ip’,<br>  <code>net_ip</code> varchar(128)  comment ‘IP’,<br>  <code>ops</code> varchar(128)  comment ‘操作系统’,<br>  <code>asset_numb</code> varchar(128)  comment ‘资产编号’,<br>  <code>location</code> int  comment ‘宿主机’,<br>  <code>status</code> int  comment ‘状态’,<br>  PRIMARY KEY (<code>id</code>)<br>) ENGINE=InnoDB AUTO_INCREMENT=4 DEFAULT CHARSET=utf8;</p>\n<table>\n<thead>\n<tr>\n<th>字段</th>\n<th>描 述</th>\n<th>属性</th>\n<th>参数</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>id</td>\n<td>id</td>\n<td>uuid</td>\n<td></td>\n</tr>\n<tr>\n<td>hostname</td>\n<td>主机名</td>\n<td>str</td>\n<td></td>\n</tr>\n<tr>\n<td>serial_num</td>\n<td>序列号</td>\n<td>str</td>\n<td></td>\n</tr>\n<tr>\n<td>CPU</td>\n<td>CPU</td>\n<td>str</td>\n<td></td>\n</tr>\n<tr>\n<td>memory</td>\n<td>内存</td>\n<td>str</td>\n<td></td>\n</tr>\n<tr>\n<td>disk</td>\n<td>磁盘</td>\n<td>dict</td>\n<td></td>\n</tr>\n<tr>\n<td>mg_ip</td>\n<td>管理ip</td>\n<td>str</td>\n<td></td>\n</tr>\n<tr>\n<td>net_ip</td>\n<td>ip</td>\n<td>dict</td>\n<td></td>\n</tr>\n<tr>\n<td>ops</td>\n<td>操作系统</td>\n<td>str</td>\n<td></td>\n</tr>\n<tr>\n<td>asset_numb</td>\n<td>资产编号</td>\n<td>str</td>\n<td></td>\n</tr>\n<tr>\n<td>desc</td>\n<td>备注</td>\n<td>str</td>\n<td></td>\n</tr>\n<tr>\n<td>location</td>\n<td>位置</td>\n<td>str</td>\n<td></td>\n</tr>\n</tbody></table>\n<p>status :<br>  200     成功<br>  204     失败</p>\n<p>idc  crud </p>\n<p>/add    post<br>{<br>  “name”:””,<br>  “location”:””<br>}</p>\n<h3 id=\"项目创建\"><a href=\"#项目创建\" class=\"headerlink\" title=\"项目创建\"></a>项目创建</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir gocmdb</span><br><span class=\"line\">cd gocmdb</span><br><span class=\"line\">go mod init gocmdb</span><br><span class=\"line\"></span><br><span class=\"line\">mkdir -p conf middleware models pkg routers runtime</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">conf：         用于存储配置文件</span><br><span class=\"line\">middleware：   应用中间件</span><br><span class=\"line\">models：       应用数据库模型</span><br><span class=\"line\">pkg：          第三方包</span><br><span class=\"line\">routers        路由逻辑处理</span><br><span class=\"line\">runtime        应用运行时数据</span><br><span class=\"line\">datasource     数据库连接和初始化表</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">conf                配置文件</span><br><span class=\"line\">controllers         控制器 入参处理 api的入口</span><br><span class=\"line\">datasource          数据库配置 </span><br><span class=\"line\">models              结构体</span><br><span class=\"line\">db                  sql数据文件 postman接口文件</span><br><span class=\"line\">repo                数据库的操作</span><br><span class=\"line\">middleware          中间件 jwt实现</span><br><span class=\"line\">route               注册路由</span><br><span class=\"line\">service             业务逻辑代码</span><br><span class=\"line\">utils               工具类</span><br><span class=\"line\">config.json         配置文件的映射</span><br><span class=\"line\">main.go             主程序入口</span><br></pre></td></tr></table></figure>"},{"title":"docker限制日志大小","date":"2021-06-28T08:01:00.000Z","_content":"\t\n\t\n摘要: docker限制日志大小\n<!-- more -->\n\n\n## 限制Docker日志大小\n如果Docker日志不限制大小，直接导致磁盘空间被用完，影响服务的可用性。\n\n修改docker配置文件，`vim /etc/docker/daemon.json`\n\n```\n{\n  \"log-driver\":\"json-file\",\n  \"log-opts\": {\"max-size\":\"500m\", \"max-file\":\"3\"}\n}\n```\n\n>max-size=500m，意味着一个容器日志大小上限是500M <br>\nmax-file=3，意味着一个容器有三个日志，分别是id+.json、id+1.json、id+2.json。\n\n然后重启docker的守护线程\n```\nsystemctl daemon-reload\nsystemctl restart docker\n```\n\n## docker-compose 限制日志大小\n\n```\ndocker-compose.yml中也可以限制 \n\nnginx:\n  image: nginx:1.12.1\n  restart: always\n  logging:\n    driver: \"json-file\"\n    options:\n      max-size: \"5g\"\n```\n\n## docker run 限制日志大小\n```\ndocker run -d --log-opt max-size=1g nginx\n```\n","source":"_posts/docker/docker日志大小.md","raw":"---\ntitle: docker限制日志大小\ndate: 2021-06-28 16:01\ncategories:\n- docker\ntags:\n- docker\n- log\n---\n\t\n\t\n摘要: docker限制日志大小\n<!-- more -->\n\n\n## 限制Docker日志大小\n如果Docker日志不限制大小，直接导致磁盘空间被用完，影响服务的可用性。\n\n修改docker配置文件，`vim /etc/docker/daemon.json`\n\n```\n{\n  \"log-driver\":\"json-file\",\n  \"log-opts\": {\"max-size\":\"500m\", \"max-file\":\"3\"}\n}\n```\n\n>max-size=500m，意味着一个容器日志大小上限是500M <br>\nmax-file=3，意味着一个容器有三个日志，分别是id+.json、id+1.json、id+2.json。\n\n然后重启docker的守护线程\n```\nsystemctl daemon-reload\nsystemctl restart docker\n```\n\n## docker-compose 限制日志大小\n\n```\ndocker-compose.yml中也可以限制 \n\nnginx:\n  image: nginx:1.12.1\n  restart: always\n  logging:\n    driver: \"json-file\"\n    options:\n      max-size: \"5g\"\n```\n\n## docker run 限制日志大小\n```\ndocker run -d --log-opt max-size=1g nginx\n```\n","slug":"docker/docker日志大小","published":1,"updated":"2021-09-22T01:42:33.787Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cku6979yo001w00uh8ofhcr30","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><p>摘要: docker限制日志大小</p>\n<span id=\"more\"></span>\n\n\n<h2 id=\"限制Docker日志大小\"><a href=\"#限制Docker日志大小\" class=\"headerlink\" title=\"限制Docker日志大小\"></a>限制Docker日志大小</h2><p>如果Docker日志不限制大小，直接导致磁盘空间被用完，影响服务的可用性。</p>\n<p>修改docker配置文件，<code>vim /etc/docker/daemon.json</code></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  &quot;log-driver&quot;:&quot;json-file&quot;,</span><br><span class=\"line\">  &quot;log-opts&quot;: &#123;&quot;max-size&quot;:&quot;500m&quot;, &quot;max-file&quot;:&quot;3&quot;&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>max-size=500m，意味着一个容器日志大小上限是500M <br><br>max-file=3，意味着一个容器有三个日志，分别是id+.json、id+1.json、id+2.json。</p>\n</blockquote>\n<p>然后重启docker的守护线程</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl daemon-reload</span><br><span class=\"line\">systemctl restart docker</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"docker-compose-限制日志大小\"><a href=\"#docker-compose-限制日志大小\" class=\"headerlink\" title=\"docker-compose 限制日志大小\"></a>docker-compose 限制日志大小</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker-compose.yml中也可以限制 </span><br><span class=\"line\"></span><br><span class=\"line\">nginx:</span><br><span class=\"line\">  image: nginx:1.12.1</span><br><span class=\"line\">  restart: always</span><br><span class=\"line\">  logging:</span><br><span class=\"line\">    driver: &quot;json-file&quot;</span><br><span class=\"line\">    options:</span><br><span class=\"line\">      max-size: &quot;5g&quot;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"docker-run-限制日志大小\"><a href=\"#docker-run-限制日志大小\" class=\"headerlink\" title=\"docker run 限制日志大小\"></a>docker run 限制日志大小</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run -d --log-opt max-size&#x3D;1g nginx</span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"<p>摘要: docker限制日志大小</p>","more":"<h2 id=\"限制Docker日志大小\"><a href=\"#限制Docker日志大小\" class=\"headerlink\" title=\"限制Docker日志大小\"></a>限制Docker日志大小</h2><p>如果Docker日志不限制大小，直接导致磁盘空间被用完，影响服务的可用性。</p>\n<p>修改docker配置文件，<code>vim /etc/docker/daemon.json</code></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  &quot;log-driver&quot;:&quot;json-file&quot;,</span><br><span class=\"line\">  &quot;log-opts&quot;: &#123;&quot;max-size&quot;:&quot;500m&quot;, &quot;max-file&quot;:&quot;3&quot;&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>max-size=500m，意味着一个容器日志大小上限是500M <br><br>max-file=3，意味着一个容器有三个日志，分别是id+.json、id+1.json、id+2.json。</p>\n</blockquote>\n<p>然后重启docker的守护线程</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl daemon-reload</span><br><span class=\"line\">systemctl restart docker</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"docker-compose-限制日志大小\"><a href=\"#docker-compose-限制日志大小\" class=\"headerlink\" title=\"docker-compose 限制日志大小\"></a>docker-compose 限制日志大小</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker-compose.yml中也可以限制 </span><br><span class=\"line\"></span><br><span class=\"line\">nginx:</span><br><span class=\"line\">  image: nginx:1.12.1</span><br><span class=\"line\">  restart: always</span><br><span class=\"line\">  logging:</span><br><span class=\"line\">    driver: &quot;json-file&quot;</span><br><span class=\"line\">    options:</span><br><span class=\"line\">      max-size: &quot;5g&quot;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"docker-run-限制日志大小\"><a href=\"#docker-run-限制日志大小\" class=\"headerlink\" title=\"docker run 限制日志大小\"></a>docker run 限制日志大小</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run -d --log-opt max-size&#x3D;1g nginx</span><br></pre></td></tr></table></figure>"},{"title":"docker配置代理","date":"2021-05-08T06:15:00.000Z","_content":"  \n  \n摘要: docker 配置代理\n<!-- more -->\n\n\n## 配置代理服务器\n创建或修改 /etc/docker/daemon.json\n```\n{\n    \"registry-mirrors\": [\n        \"https://1nj0zren.mirror.aliyuncs.com\",\n        \"https://docker.mirrors.ustc.edu.cn\",\n        \"http://f1361db2.m.daocloud.io\",\n        \"https://registry.docker-cn.com\"\n    ]\n}\n```\n\n加载配置：\n```\nsudo systemctl daemon-reload\nsudo systemctl restart docker\n```\n\n检查代理服务器是否生效\n命令行执行 `docker info`，查看配置是否已经生效。\n可以看到日志的最后部分有下面配置，说明就已经生效了。\n\n```\nRegistry Mirrors:\n https://1nj0zren.mirror.aliyuncs.com/\n https://docker.mirrors.ustc.edu.cn/\n http://f1361db2.m.daocloud.io/\n https://registry.docker-cn.com/\nLive Restore Enabled: true\n```\n\n\nDocker Hub 镜像加速器列表\n\n|镜像加速器|镜像加速器地址|\n|---|---|\n|Docker中国|\thttps://registry.docker-cn.com|\n|DaoCloud\t|http://f1361db2.m.daocloud.io（可登录）|\n|Azure |https://dockerhub.azk8s.cn|\n|中科大 |https://docker.mirrors.ustc.edu.cn |\n|阿里云\t|https://<your_code>.mirror.aliyuncs.com（需登录）|\n|七牛云\t|https://reg-mirror.qiniu.com|\n|网易云\t|https://hub-mirror.c.163.com|\n|腾讯云\t|https://mirror.ccs.tencentyun.com|\n","source":"_posts/docker/docker代理.md","raw":"---\ntitle: docker配置代理\ndate: 2021-05-08 14:15\ncategories:\n- docker\ntags:\n- docker\n---\n  \n  \n摘要: docker 配置代理\n<!-- more -->\n\n\n## 配置代理服务器\n创建或修改 /etc/docker/daemon.json\n```\n{\n    \"registry-mirrors\": [\n        \"https://1nj0zren.mirror.aliyuncs.com\",\n        \"https://docker.mirrors.ustc.edu.cn\",\n        \"http://f1361db2.m.daocloud.io\",\n        \"https://registry.docker-cn.com\"\n    ]\n}\n```\n\n加载配置：\n```\nsudo systemctl daemon-reload\nsudo systemctl restart docker\n```\n\n检查代理服务器是否生效\n命令行执行 `docker info`，查看配置是否已经生效。\n可以看到日志的最后部分有下面配置，说明就已经生效了。\n\n```\nRegistry Mirrors:\n https://1nj0zren.mirror.aliyuncs.com/\n https://docker.mirrors.ustc.edu.cn/\n http://f1361db2.m.daocloud.io/\n https://registry.docker-cn.com/\nLive Restore Enabled: true\n```\n\n\nDocker Hub 镜像加速器列表\n\n|镜像加速器|镜像加速器地址|\n|---|---|\n|Docker中国|\thttps://registry.docker-cn.com|\n|DaoCloud\t|http://f1361db2.m.daocloud.io（可登录）|\n|Azure |https://dockerhub.azk8s.cn|\n|中科大 |https://docker.mirrors.ustc.edu.cn |\n|阿里云\t|https://<your_code>.mirror.aliyuncs.com（需登录）|\n|七牛云\t|https://reg-mirror.qiniu.com|\n|网易云\t|https://hub-mirror.c.163.com|\n|腾讯云\t|https://mirror.ccs.tencentyun.com|\n","slug":"docker/docker代理","published":1,"updated":"2021-08-13T09:38:56.876Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cku6979ys002000uh2zry0te2","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><p>摘要: docker 配置代理</p>\n<span id=\"more\"></span>\n\n\n<h2 id=\"配置代理服务器\"><a href=\"#配置代理服务器\" class=\"headerlink\" title=\"配置代理服务器\"></a>配置代理服务器</h2><p>创建或修改 /etc/docker/daemon.json</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">    &quot;registry-mirrors&quot;: [</span><br><span class=\"line\">        &quot;https:&#x2F;&#x2F;1nj0zren.mirror.aliyuncs.com&quot;,</span><br><span class=\"line\">        &quot;https:&#x2F;&#x2F;docker.mirrors.ustc.edu.cn&quot;,</span><br><span class=\"line\">        &quot;http:&#x2F;&#x2F;f1361db2.m.daocloud.io&quot;,</span><br><span class=\"line\">        &quot;https:&#x2F;&#x2F;registry.docker-cn.com&quot;</span><br><span class=\"line\">    ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>加载配置：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo systemctl daemon-reload</span><br><span class=\"line\">sudo systemctl restart docker</span><br></pre></td></tr></table></figure>\n\n<p>检查代理服务器是否生效<br>命令行执行 <code>docker info</code>，查看配置是否已经生效。<br>可以看到日志的最后部分有下面配置，说明就已经生效了。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Registry Mirrors:</span><br><span class=\"line\"> https:&#x2F;&#x2F;1nj0zren.mirror.aliyuncs.com&#x2F;</span><br><span class=\"line\"> https:&#x2F;&#x2F;docker.mirrors.ustc.edu.cn&#x2F;</span><br><span class=\"line\"> http:&#x2F;&#x2F;f1361db2.m.daocloud.io&#x2F;</span><br><span class=\"line\"> https:&#x2F;&#x2F;registry.docker-cn.com&#x2F;</span><br><span class=\"line\">Live Restore Enabled: true</span><br></pre></td></tr></table></figure>\n\n\n<p>Docker Hub 镜像加速器列表</p>\n<table>\n<thead>\n<tr>\n<th>镜像加速器</th>\n<th>镜像加速器地址</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>Docker中国</td>\n<td><a href=\"https://registry.docker-cn.com/\">https://registry.docker-cn.com</a></td>\n</tr>\n<tr>\n<td>DaoCloud</td>\n<td><a href=\"http://f1361db2.m.daocloud.io(可登录)/\">http://f1361db2.m.daocloud.io（可登录）</a></td>\n</tr>\n<tr>\n<td>Azure</td>\n<td><a href=\"https://dockerhub.azk8s.cn/\">https://dockerhub.azk8s.cn</a></td>\n</tr>\n<tr>\n<td>中科大</td>\n<td><a href=\"https://docker.mirrors.ustc.edu.cn/\">https://docker.mirrors.ustc.edu.cn</a></td>\n</tr>\n<tr>\n<td>阿里云</td>\n<td>https://<your_code>.mirror.aliyuncs.com（需登录）</td>\n</tr>\n<tr>\n<td>七牛云</td>\n<td><a href=\"https://reg-mirror.qiniu.com/\">https://reg-mirror.qiniu.com</a></td>\n</tr>\n<tr>\n<td>网易云</td>\n<td><a href=\"https://hub-mirror.c.163.com/\">https://hub-mirror.c.163.com</a></td>\n</tr>\n<tr>\n<td>腾讯云</td>\n<td><a href=\"https://mirror.ccs.tencentyun.com/\">https://mirror.ccs.tencentyun.com</a></td>\n</tr>\n</tbody></table>\n","site":{"data":{}},"excerpt":"<p>摘要: docker 配置代理</p>","more":"<h2 id=\"配置代理服务器\"><a href=\"#配置代理服务器\" class=\"headerlink\" title=\"配置代理服务器\"></a>配置代理服务器</h2><p>创建或修改 /etc/docker/daemon.json</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">    &quot;registry-mirrors&quot;: [</span><br><span class=\"line\">        &quot;https:&#x2F;&#x2F;1nj0zren.mirror.aliyuncs.com&quot;,</span><br><span class=\"line\">        &quot;https:&#x2F;&#x2F;docker.mirrors.ustc.edu.cn&quot;,</span><br><span class=\"line\">        &quot;http:&#x2F;&#x2F;f1361db2.m.daocloud.io&quot;,</span><br><span class=\"line\">        &quot;https:&#x2F;&#x2F;registry.docker-cn.com&quot;</span><br><span class=\"line\">    ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>加载配置：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo systemctl daemon-reload</span><br><span class=\"line\">sudo systemctl restart docker</span><br></pre></td></tr></table></figure>\n\n<p>检查代理服务器是否生效<br>命令行执行 <code>docker info</code>，查看配置是否已经生效。<br>可以看到日志的最后部分有下面配置，说明就已经生效了。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Registry Mirrors:</span><br><span class=\"line\"> https:&#x2F;&#x2F;1nj0zren.mirror.aliyuncs.com&#x2F;</span><br><span class=\"line\"> https:&#x2F;&#x2F;docker.mirrors.ustc.edu.cn&#x2F;</span><br><span class=\"line\"> http:&#x2F;&#x2F;f1361db2.m.daocloud.io&#x2F;</span><br><span class=\"line\"> https:&#x2F;&#x2F;registry.docker-cn.com&#x2F;</span><br><span class=\"line\">Live Restore Enabled: true</span><br></pre></td></tr></table></figure>\n\n\n<p>Docker Hub 镜像加速器列表</p>\n<table>\n<thead>\n<tr>\n<th>镜像加速器</th>\n<th>镜像加速器地址</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>Docker中国</td>\n<td><a href=\"https://registry.docker-cn.com/\">https://registry.docker-cn.com</a></td>\n</tr>\n<tr>\n<td>DaoCloud</td>\n<td><a href=\"http://f1361db2.m.daocloud.io(可登录)/\">http://f1361db2.m.daocloud.io（可登录）</a></td>\n</tr>\n<tr>\n<td>Azure</td>\n<td><a href=\"https://dockerhub.azk8s.cn/\">https://dockerhub.azk8s.cn</a></td>\n</tr>\n<tr>\n<td>中科大</td>\n<td><a href=\"https://docker.mirrors.ustc.edu.cn/\">https://docker.mirrors.ustc.edu.cn</a></td>\n</tr>\n<tr>\n<td>阿里云</td>\n<td>https://<your_code>.mirror.aliyuncs.com（需登录）</td>\n</tr>\n<tr>\n<td>七牛云</td>\n<td><a href=\"https://reg-mirror.qiniu.com/\">https://reg-mirror.qiniu.com</a></td>\n</tr>\n<tr>\n<td>网易云</td>\n<td><a href=\"https://hub-mirror.c.163.com/\">https://hub-mirror.c.163.com</a></td>\n</tr>\n<tr>\n<td>腾讯云</td>\n<td><a href=\"https://mirror.ccs.tencentyun.com/\">https://mirror.ccs.tencentyun.com</a></td>\n</tr>\n</tbody></table>"},{"_content":"skywaking 部署使用\n\n\n\n\n\n下载\n\n```\nhttps://mirrors.tuna.tsinghua.edu.cn/apache/skywalking/8.0.0/\n\nwget https://mirrors.tuna.tsinghua.edu.cn/apache/skywalking/8.0.0/apache-skywalking-apm-es7-8.0.0.tar.gz\n```\n\n","source":"_posts/elasticsearch/skywaking.md","raw":"skywaking 部署使用\n\n\n\n\n\n下载\n\n```\nhttps://mirrors.tuna.tsinghua.edu.cn/apache/skywalking/8.0.0/\n\nwget https://mirrors.tuna.tsinghua.edu.cn/apache/skywalking/8.0.0/apache-skywalking-apm-es7-8.0.0.tar.gz\n```\n\n","slug":"elasticsearch/skywaking","published":1,"date":"2021-08-17T02:18:12.346Z","updated":"2021-06-18T08:07:11.186Z","title":"","comments":1,"layout":"post","photos":[],"link":"","_id":"cku6979yt002200uhap3qgdej","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><p>skywaking 部署使用</p>\n<p>下载</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">https:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;apache&#x2F;skywalking&#x2F;8.0.0&#x2F;</span><br><span class=\"line\"></span><br><span class=\"line\">wget https:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;apache&#x2F;skywalking&#x2F;8.0.0&#x2F;apache-skywalking-apm-es7-8.0.0.tar.gz</span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"","more":"<p>skywaking 部署使用</p>\n<p>下载</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">https:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;apache&#x2F;skywalking&#x2F;8.0.0&#x2F;</span><br><span class=\"line\"></span><br><span class=\"line\">wget https:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;apache&#x2F;skywalking&#x2F;8.0.0&#x2F;apache-skywalking-apm-es7-8.0.0.tar.gz</span><br></pre></td></tr></table></figure>\n\n"},{"title":"es7.x 安装","date":"2020-09-21T04:48:00.000Z","_content":"\n\n\n\n## 下载elasticsearch\n\n```\nhttps://www.elastic.co/cn/downloads/elasticsearch\n```\n\n```\nwget https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-7.8.0-linux-x86_64.tar.gz\n```\n\n## 创建用户和用户组\n```\nuseradd -M -s /sbin/nologin es\n```\n\n\n```\ntar xf elasticsearch-7.8.0-linux-x86_64.tar.gz\nmv elasticsearch-7.8.0 /home/es/elasticsearch-7.8.0\n\nchown es.es -R elasticsearch\nln -s /home/es/elasticsearch-7.8.0 /home/es/elasticsearch\nmkdir /home/es/elasticsearch/data\n```\n\n\n\n## 配置es\n\n```\ncat >> config/elasticsearch.yml <<EOF\n\n# ======================== Elasticsearch Configuration =========================\ncluster.name: cluster-Es\nnode.name: node01\nnetwork.host: 172.16.103.123\nnode.master: true\nnode.data: true\n# head 插件需要这打开这两个配置\nhttp.cors.allow-origin: \"*\"\nhttp.cors.enabled: true\nhttp.max_content_length: 200mb\n# 可以选举的主节点\ncluster.initial_master_nodes: [\"192.168.7.41:9300\",\"192.168.7.42:9300\",\"192.168.7.43:9300\"]\ndiscovery.seed_hosts: [\"192.168.7.41:9300\",\"192.168.7.42:9300\",\"192.168.7.43:9300\"]\ngateway.recover_after_nodes: 2\nnetwork.tcp.keep_alive: true\nnetwork.tcp.no_delay: true\ntransport.tcp.compress: true\n#集群内同时启动的数据任务个数，默认是2个\ncluster.routing.allocation.cluster_concurrent_rebalance: 16\n#添加或删除节点及负载均衡时并发恢复的线程个数，默认4个\ncluster.routing.allocation.node_concurrent_recoveries: 16\n#初始化数据恢复时，并发恢复线程的个数，默认4个\ncluster.routing.allocation.node_initial_primaries_recoveries: 16\n#开启 xpack 功能，如果要禁止使用密码，请将以下内容注释，直接启动不需要设置密码\n#xpack.security.enabled: true\n#xpack.security.transport.ssl.enabled: true\n#xpack.security.transport.ssl.verification_mode: certificate\n#xpack.security.transport.ssl.keystore.path: elastic-certificates.p12\n#xpack.security.transport.ssl.truststore.path: elastic-certificates.p12\nEOF\n```\n\n\n\n启动\n\n```\nsu - es -c \"/home/es/elasticsearch/bin/elasticsearch -d\"\n```\n\n\n\n启动二\n\n配置 services 文件\n\n```\nvim /lib/systemd/system/elasticsearch.service\n\n\n[Unit]\nDescription=elasticsearch\nAfter=network.target\n[Service]\nType=simple\nUser=es\nGroup=es\nWorkingDirectory=/opt/elasticsearch\nLimitNOFILE=100000\nLimitNPROC=100000\nRestart=no\nExecStart=/opt/elasticsearch/bin/elasticsearch\nPrivateTmp=true\n[Install]\nWantedBy=multi-user.target\n```\n\n\n\n\n\n```\nsystemctl daemon-reload\nsystemctl start elasticsearch\nsystemctl status elasticsearch\nsystemctl stop elasticsearch\n```\n\n\n\n","source":"_posts/elasticsearch/部署es7x.md","raw":"\n---\ntitle: es7.x 安装\ndate: 2020-09-21 12:48\ncategories:\n- elasticsearch\ntags:\n- es\n- elasticsearch\n---\n\n\n\n\n## 下载elasticsearch\n\n```\nhttps://www.elastic.co/cn/downloads/elasticsearch\n```\n\n```\nwget https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-7.8.0-linux-x86_64.tar.gz\n```\n\n## 创建用户和用户组\n```\nuseradd -M -s /sbin/nologin es\n```\n\n\n```\ntar xf elasticsearch-7.8.0-linux-x86_64.tar.gz\nmv elasticsearch-7.8.0 /home/es/elasticsearch-7.8.0\n\nchown es.es -R elasticsearch\nln -s /home/es/elasticsearch-7.8.0 /home/es/elasticsearch\nmkdir /home/es/elasticsearch/data\n```\n\n\n\n## 配置es\n\n```\ncat >> config/elasticsearch.yml <<EOF\n\n# ======================== Elasticsearch Configuration =========================\ncluster.name: cluster-Es\nnode.name: node01\nnetwork.host: 172.16.103.123\nnode.master: true\nnode.data: true\n# head 插件需要这打开这两个配置\nhttp.cors.allow-origin: \"*\"\nhttp.cors.enabled: true\nhttp.max_content_length: 200mb\n# 可以选举的主节点\ncluster.initial_master_nodes: [\"192.168.7.41:9300\",\"192.168.7.42:9300\",\"192.168.7.43:9300\"]\ndiscovery.seed_hosts: [\"192.168.7.41:9300\",\"192.168.7.42:9300\",\"192.168.7.43:9300\"]\ngateway.recover_after_nodes: 2\nnetwork.tcp.keep_alive: true\nnetwork.tcp.no_delay: true\ntransport.tcp.compress: true\n#集群内同时启动的数据任务个数，默认是2个\ncluster.routing.allocation.cluster_concurrent_rebalance: 16\n#添加或删除节点及负载均衡时并发恢复的线程个数，默认4个\ncluster.routing.allocation.node_concurrent_recoveries: 16\n#初始化数据恢复时，并发恢复线程的个数，默认4个\ncluster.routing.allocation.node_initial_primaries_recoveries: 16\n#开启 xpack 功能，如果要禁止使用密码，请将以下内容注释，直接启动不需要设置密码\n#xpack.security.enabled: true\n#xpack.security.transport.ssl.enabled: true\n#xpack.security.transport.ssl.verification_mode: certificate\n#xpack.security.transport.ssl.keystore.path: elastic-certificates.p12\n#xpack.security.transport.ssl.truststore.path: elastic-certificates.p12\nEOF\n```\n\n\n\n启动\n\n```\nsu - es -c \"/home/es/elasticsearch/bin/elasticsearch -d\"\n```\n\n\n\n启动二\n\n配置 services 文件\n\n```\nvim /lib/systemd/system/elasticsearch.service\n\n\n[Unit]\nDescription=elasticsearch\nAfter=network.target\n[Service]\nType=simple\nUser=es\nGroup=es\nWorkingDirectory=/opt/elasticsearch\nLimitNOFILE=100000\nLimitNPROC=100000\nRestart=no\nExecStart=/opt/elasticsearch/bin/elasticsearch\nPrivateTmp=true\n[Install]\nWantedBy=multi-user.target\n```\n\n\n\n\n\n```\nsystemctl daemon-reload\nsystemctl start elasticsearch\nsystemctl status elasticsearch\nsystemctl stop elasticsearch\n```\n\n\n\n","slug":"elasticsearch/部署es7x","published":1,"updated":"2021-07-31T09:59:32.473Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cku6979yv002600uh0b2g5p18","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><h2 id=\"下载elasticsearch\"><a href=\"#下载elasticsearch\" class=\"headerlink\" title=\"下载elasticsearch\"></a>下载elasticsearch</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">https:&#x2F;&#x2F;www.elastic.co&#x2F;cn&#x2F;downloads&#x2F;elasticsearch</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget https:&#x2F;&#x2F;artifacts.elastic.co&#x2F;downloads&#x2F;elasticsearch&#x2F;elasticsearch-7.8.0-linux-x86_64.tar.gz</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"创建用户和用户组\"><a href=\"#创建用户和用户组\" class=\"headerlink\" title=\"创建用户和用户组\"></a>创建用户和用户组</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">useradd -M -s &#x2F;sbin&#x2F;nologin es</span><br></pre></td></tr></table></figure>\n\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tar xf elasticsearch-7.8.0-linux-x86_64.tar.gz</span><br><span class=\"line\">mv elasticsearch-7.8.0 &#x2F;home&#x2F;es&#x2F;elasticsearch-7.8.0</span><br><span class=\"line\"></span><br><span class=\"line\">chown es.es -R elasticsearch</span><br><span class=\"line\">ln -s &#x2F;home&#x2F;es&#x2F;elasticsearch-7.8.0 &#x2F;home&#x2F;es&#x2F;elasticsearch</span><br><span class=\"line\">mkdir &#x2F;home&#x2F;es&#x2F;elasticsearch&#x2F;data</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"配置es\"><a href=\"#配置es\" class=\"headerlink\" title=\"配置es\"></a>配置es</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cat &gt;&gt; config&#x2F;elasticsearch.yml &lt;&lt;EOF</span><br><span class=\"line\"></span><br><span class=\"line\"># &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; Elasticsearch Configuration &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class=\"line\">cluster.name: cluster-Es</span><br><span class=\"line\">node.name: node01</span><br><span class=\"line\">network.host: 172.16.103.123</span><br><span class=\"line\">node.master: true</span><br><span class=\"line\">node.data: true</span><br><span class=\"line\"># head 插件需要这打开这两个配置</span><br><span class=\"line\">http.cors.allow-origin: &quot;*&quot;</span><br><span class=\"line\">http.cors.enabled: true</span><br><span class=\"line\">http.max_content_length: 200mb</span><br><span class=\"line\"># 可以选举的主节点</span><br><span class=\"line\">cluster.initial_master_nodes: [&quot;192.168.7.41:9300&quot;,&quot;192.168.7.42:9300&quot;,&quot;192.168.7.43:9300&quot;]</span><br><span class=\"line\">discovery.seed_hosts: [&quot;192.168.7.41:9300&quot;,&quot;192.168.7.42:9300&quot;,&quot;192.168.7.43:9300&quot;]</span><br><span class=\"line\">gateway.recover_after_nodes: 2</span><br><span class=\"line\">network.tcp.keep_alive: true</span><br><span class=\"line\">network.tcp.no_delay: true</span><br><span class=\"line\">transport.tcp.compress: true</span><br><span class=\"line\">#集群内同时启动的数据任务个数，默认是2个</span><br><span class=\"line\">cluster.routing.allocation.cluster_concurrent_rebalance: 16</span><br><span class=\"line\">#添加或删除节点及负载均衡时并发恢复的线程个数，默认4个</span><br><span class=\"line\">cluster.routing.allocation.node_concurrent_recoveries: 16</span><br><span class=\"line\">#初始化数据恢复时，并发恢复线程的个数，默认4个</span><br><span class=\"line\">cluster.routing.allocation.node_initial_primaries_recoveries: 16</span><br><span class=\"line\">#开启 xpack 功能，如果要禁止使用密码，请将以下内容注释，直接启动不需要设置密码</span><br><span class=\"line\">#xpack.security.enabled: true</span><br><span class=\"line\">#xpack.security.transport.ssl.enabled: true</span><br><span class=\"line\">#xpack.security.transport.ssl.verification_mode: certificate</span><br><span class=\"line\">#xpack.security.transport.ssl.keystore.path: elastic-certificates.p12</span><br><span class=\"line\">#xpack.security.transport.ssl.truststore.path: elastic-certificates.p12</span><br><span class=\"line\">EOF</span><br></pre></td></tr></table></figure>\n\n\n\n<p>启动</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">su - es -c &quot;&#x2F;home&#x2F;es&#x2F;elasticsearch&#x2F;bin&#x2F;elasticsearch -d&quot;</span><br></pre></td></tr></table></figure>\n\n\n\n<p>启动二</p>\n<p>配置 services 文件</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim &#x2F;lib&#x2F;systemd&#x2F;system&#x2F;elasticsearch.service</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">[Unit]</span><br><span class=\"line\">Description&#x3D;elasticsearch</span><br><span class=\"line\">After&#x3D;network.target</span><br><span class=\"line\">[Service]</span><br><span class=\"line\">Type&#x3D;simple</span><br><span class=\"line\">User&#x3D;es</span><br><span class=\"line\">Group&#x3D;es</span><br><span class=\"line\">WorkingDirectory&#x3D;&#x2F;opt&#x2F;elasticsearch</span><br><span class=\"line\">LimitNOFILE&#x3D;100000</span><br><span class=\"line\">LimitNPROC&#x3D;100000</span><br><span class=\"line\">Restart&#x3D;no</span><br><span class=\"line\">ExecStart&#x3D;&#x2F;opt&#x2F;elasticsearch&#x2F;bin&#x2F;elasticsearch</span><br><span class=\"line\">PrivateTmp&#x3D;true</span><br><span class=\"line\">[Install]</span><br><span class=\"line\">WantedBy&#x3D;multi-user.target</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl daemon-reload</span><br><span class=\"line\">systemctl start elasticsearch</span><br><span class=\"line\">systemctl status elasticsearch</span><br><span class=\"line\">systemctl stop elasticsearch</span><br></pre></td></tr></table></figure>\n\n\n\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"下载elasticsearch\"><a href=\"#下载elasticsearch\" class=\"headerlink\" title=\"下载elasticsearch\"></a>下载elasticsearch</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">https:&#x2F;&#x2F;www.elastic.co&#x2F;cn&#x2F;downloads&#x2F;elasticsearch</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget https:&#x2F;&#x2F;artifacts.elastic.co&#x2F;downloads&#x2F;elasticsearch&#x2F;elasticsearch-7.8.0-linux-x86_64.tar.gz</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"创建用户和用户组\"><a href=\"#创建用户和用户组\" class=\"headerlink\" title=\"创建用户和用户组\"></a>创建用户和用户组</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">useradd -M -s &#x2F;sbin&#x2F;nologin es</span><br></pre></td></tr></table></figure>\n\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tar xf elasticsearch-7.8.0-linux-x86_64.tar.gz</span><br><span class=\"line\">mv elasticsearch-7.8.0 &#x2F;home&#x2F;es&#x2F;elasticsearch-7.8.0</span><br><span class=\"line\"></span><br><span class=\"line\">chown es.es -R elasticsearch</span><br><span class=\"line\">ln -s &#x2F;home&#x2F;es&#x2F;elasticsearch-7.8.0 &#x2F;home&#x2F;es&#x2F;elasticsearch</span><br><span class=\"line\">mkdir &#x2F;home&#x2F;es&#x2F;elasticsearch&#x2F;data</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"配置es\"><a href=\"#配置es\" class=\"headerlink\" title=\"配置es\"></a>配置es</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cat &gt;&gt; config&#x2F;elasticsearch.yml &lt;&lt;EOF</span><br><span class=\"line\"></span><br><span class=\"line\"># &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; Elasticsearch Configuration &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class=\"line\">cluster.name: cluster-Es</span><br><span class=\"line\">node.name: node01</span><br><span class=\"line\">network.host: 172.16.103.123</span><br><span class=\"line\">node.master: true</span><br><span class=\"line\">node.data: true</span><br><span class=\"line\"># head 插件需要这打开这两个配置</span><br><span class=\"line\">http.cors.allow-origin: &quot;*&quot;</span><br><span class=\"line\">http.cors.enabled: true</span><br><span class=\"line\">http.max_content_length: 200mb</span><br><span class=\"line\"># 可以选举的主节点</span><br><span class=\"line\">cluster.initial_master_nodes: [&quot;192.168.7.41:9300&quot;,&quot;192.168.7.42:9300&quot;,&quot;192.168.7.43:9300&quot;]</span><br><span class=\"line\">discovery.seed_hosts: [&quot;192.168.7.41:9300&quot;,&quot;192.168.7.42:9300&quot;,&quot;192.168.7.43:9300&quot;]</span><br><span class=\"line\">gateway.recover_after_nodes: 2</span><br><span class=\"line\">network.tcp.keep_alive: true</span><br><span class=\"line\">network.tcp.no_delay: true</span><br><span class=\"line\">transport.tcp.compress: true</span><br><span class=\"line\">#集群内同时启动的数据任务个数，默认是2个</span><br><span class=\"line\">cluster.routing.allocation.cluster_concurrent_rebalance: 16</span><br><span class=\"line\">#添加或删除节点及负载均衡时并发恢复的线程个数，默认4个</span><br><span class=\"line\">cluster.routing.allocation.node_concurrent_recoveries: 16</span><br><span class=\"line\">#初始化数据恢复时，并发恢复线程的个数，默认4个</span><br><span class=\"line\">cluster.routing.allocation.node_initial_primaries_recoveries: 16</span><br><span class=\"line\">#开启 xpack 功能，如果要禁止使用密码，请将以下内容注释，直接启动不需要设置密码</span><br><span class=\"line\">#xpack.security.enabled: true</span><br><span class=\"line\">#xpack.security.transport.ssl.enabled: true</span><br><span class=\"line\">#xpack.security.transport.ssl.verification_mode: certificate</span><br><span class=\"line\">#xpack.security.transport.ssl.keystore.path: elastic-certificates.p12</span><br><span class=\"line\">#xpack.security.transport.ssl.truststore.path: elastic-certificates.p12</span><br><span class=\"line\">EOF</span><br></pre></td></tr></table></figure>\n\n\n\n<p>启动</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">su - es -c &quot;&#x2F;home&#x2F;es&#x2F;elasticsearch&#x2F;bin&#x2F;elasticsearch -d&quot;</span><br></pre></td></tr></table></figure>\n\n\n\n<p>启动二</p>\n<p>配置 services 文件</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim &#x2F;lib&#x2F;systemd&#x2F;system&#x2F;elasticsearch.service</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">[Unit]</span><br><span class=\"line\">Description&#x3D;elasticsearch</span><br><span class=\"line\">After&#x3D;network.target</span><br><span class=\"line\">[Service]</span><br><span class=\"line\">Type&#x3D;simple</span><br><span class=\"line\">User&#x3D;es</span><br><span class=\"line\">Group&#x3D;es</span><br><span class=\"line\">WorkingDirectory&#x3D;&#x2F;opt&#x2F;elasticsearch</span><br><span class=\"line\">LimitNOFILE&#x3D;100000</span><br><span class=\"line\">LimitNPROC&#x3D;100000</span><br><span class=\"line\">Restart&#x3D;no</span><br><span class=\"line\">ExecStart&#x3D;&#x2F;opt&#x2F;elasticsearch&#x2F;bin&#x2F;elasticsearch</span><br><span class=\"line\">PrivateTmp&#x3D;true</span><br><span class=\"line\">[Install]</span><br><span class=\"line\">WantedBy&#x3D;multi-user.target</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl daemon-reload</span><br><span class=\"line\">systemctl start elasticsearch</span><br><span class=\"line\">systemctl status elasticsearch</span><br><span class=\"line\">systemctl stop elasticsearch</span><br></pre></td></tr></table></figure>\n\n\n\n"},{"title":"ClickHouse分布式集群搭建指南","date":"2021-03-12T06:35:00.000Z","_content":"  \n  \n摘要: ClickHouse分布式集群搭建指南\n<!-- more -->\n\n## ClickHouse是什么\n\nClickHouse 是 Yandex（俄罗斯最大的搜索引擎）开源的一个用于实时数据分析的基于列存储的数据库，其处理数据的速度比传统方法快 100-1000 倍。ClickHouse 的性能超过了目前市场上可比的面向列的 DBMS，每秒钟每台服务器每秒处理数亿至十亿多行和数十千兆字节的数据。\n\n#### ClickHouse的一些特性\n- 快速：ClickHouse 会充分利用所有可用的硬件，以尽可能快地处理每个查询。单个查询的峰值处理性能超过每秒 2 TB（解压缩后，仅使用的列）。在分布式设置中，读取是在健康副本之间自动平衡的，以避免增加延迟。\n- 容错：ClickHouse 支持多主机异步复制，并且可以跨多个数据中心进行部署。所有节点都相等，这可以避免出现单点故障。单个节点或整个数据中心的停机时间不会影响系统的读写可用性。\n- 可伸缩：ClickHouse 可以在垂直和水平方向上很好地缩放。ClickHouse 易于调整以在具有数百或数千个节点的群集上或在单个服务器上，甚至在小型虚拟机上执行。当前，每个单节点安装的数据量超过数万亿行或数百兆兆字节。\n- 易用：ClickHouse 简单易用，开箱即用。它简化了所有数据处理：将所有结构化数据吸收到系统中，并且立即可用于构建报告。SQL 允许表达期望的结果，而无需涉及某些 DBMS 中可以找到的任何自定义非标准 API。\n- 充分利用硬件：ClickHouse 与具有相同的可用 I/O 吞吐量和 CPU 容量的传统的面向行的系统相比，其处理典型的分析查询要快两到三个数量级。列式存储格式允许在 RAM 中容纳更多热数据，从而缩短了响应时间。\n- 提高 CPU 效率：向量化查询执行涉及相关的 SIMD 处理器指令和运行时代码生成。处理列中的数据会提高 CPU 行缓存的命中率。\n- 优化磁盘访问：ClickHouse 可以最大程度地减少范围查询的次数，从而提高了使用旋转磁盘驱动器的效率，因为它可以保持连续存储数据。最小化数据传输：ClickHouse 使公司无需使用专门针对高性能计算的专用网络即可管理其数据\n\n\n## 架构\n\n#### 服务器\ncentos 7 三台机器（ZooKeeper,clickhouse 高可用）\n\n| 主机 | IP | 应用 | 备注 |\n|---|---|---|---|\n|logch01.ztyc.com| 10.200.76.11 | ClickHouse-server<br/> ClickHouse-client<br/> jdk1.8<br/> ZooKeeper | |\n|logch02.ztyc.com| 10.200.76.12 | ClickHouse-server<br/> ClickHouse-client<br/> jdk1.8<br/> ZooKeeper | |\n|logch03.ztyc.com| 10.200.76.13 | ClickHouse-server<br/> ClickHouse-client<br/> jdk1.8<br/> ZooKeeper | |\n\n#### host 文件解析\n\n设置hosts文件解析（ck同步表数据的时候会去ZooKeeper 里面查询，ZooKeeper 里面存储的是hosts域名，不是IP，不解析会导致可以同步表但是无法同步表数据）,三台操作 vi /etc/hosts\n```\nvim /etc/hosts\n\n10.200.76.11 logch01.ztyc.com\n10.200.76.12 logch02.ztyc.com\n10.200.76.13 logch03.ztyc.com\n```\n\n## 部署zk集群\n#### 安装jdk1.8\n```\n```\n\n#### 安装zk\n```\ncd /opt/soft\nwget https://downloads.apache.org/zookeeper/zookeeper-3.6.2/apache-zookeeper-3.6.2.tar.gz && tar -xf apache-zookeeper-3.6.2.tar.gz \nln -s apache-zookeeper-3.6.2 /opt/zookeeper\ncd /opt/zookeeper\ncp conf/zoo_sample.cfg conf/zoo.cfg\nmkdir data\n\n```\n修改配置文件 `conf/zoocfg` 三台一样\n```\ntickTime=2000\ninitLimit=10\nsyncLimit=5\ndataDir=/opt/zookeeper/data\nclientPort=2181\nserver.1=10.200.76.11:2888:3888\nserver.2=10.200.76.12:2888:3888\nserver.3=10.200.76.13:2888:3888\n```\n创建myid在ZooKeeper 数据目录,三台不一样，对应上面server.1这个数字\n```\necho 1 > /opt/zookeeper/data/myid  # 其他机器分别是2 3\n```\n启动并检查\n```\n./bin/zkServer.sh start\n./bin/zkServer.sh status\n```\n\n\n## 搭建clickhouse集群\n一分片一副本集群\n\nClickhouse 仅支持Linux 且必须支持SSE4.2 指令集\n```\ngrep -q sse4_2 /proc/cpuinfo && echo \"SSE 4.2 supported\" || echo \"SSE 4.2 not supported\"\n```\n```\nSSE 4.2 supported   # 不支持会显示  SSE 4.2 not supported\n```\n如果服务器不支持SSE指令集，则不能直接下载预编译安装包，需要通过源码编译特定版本进行安装\n\n\n## 安装依赖\n### 安装gcc\n\n#### 安装依赖\n```\nyum install git cmake ninja-build libicu-devel clang libicu-devel readline-devel mysql-devel openssl-devel unixODBC_devel bzip2 -y\n```\n\n#### 安装高版本 gcc\n```\nwget ftp://gnu.mirror.iweb.com/gcc/gcc-9.3.0/gcc-9.3.0.tar.xz\n\ntar xvf gcc-9.3.0.tar.xz\ncd gcc-9.3.0\n./contrib/download_prerequisites\n```\n**生成Makefile文件**\n\n```\n./configure --prefix=/usr/local -enable-checking=release -enable-languages=c,c++ -disable-multilib\n\n```\n\n**编译gcc**\n\n```\nmake -j4    #多核电脑可以添加 “-j4” ：make对多核处理器的优化选项，此步骤非常耗时\n\nls /usr/local/bin | grep gcc\n```\n\n**安装gcc**\n\n```\n make install\n```\n\n**配置gcc**\n\n```\ncd ~\nfind /usr/local/src/gcc-9.2.0/ -name \"libstdc++.so*\"\n\n/usr/local/src/gcc-9.2.0/stage1-x86_64-pc-linux-gnu/libstdc++-v3/src/.libs/libstdc++.so.6.0.24\n/usr/local/src/gcc-9.2.0/stage1-x86_64-pc-linux-gnu/libstdc++-v3/src/.libs/libstdc++.so.6\n/usr/local/src/gcc-9.2.0/stage1-x86_64-pc-linux-gnu/libstdc++-v3/src/.libs/libstdc++.so\n/usr/local/src/gcc-9.2.0/prev-x86_64-pc-linux-gnu/libstdc++-v3/src/.libs/libstdc++.so.6.0.24\n/usr/local/src/gcc-9.2.0/prev-x86_64-pc-linux-gnu/libstdc++-v3/src/.libs/libstdc++.so.6\n/usr/local/src/gcc-9.2.0/prev-x86_64-pc-linux-gnu/libstdc++-v3/src/.libs/libstdc++.so\n/usr/local/src/gcc-9.2.0/x86_64-pc-linux-gnu/libstdc++-v3/src/.libs/libstdc++.so.6.0.24\n/usr/local/src/gcc-9.2.0/x86_64-pc-linux-gnu/libstdc++-v3/src/.libs/libstdc++.so.6\n/usr/local/src/gcc-9.2.0/x86_64-pc-linux-gnu/libstdc++-v3/src/.libs/libstdc++.so\n\ncd /usr/lib64\ncp /usr/local/src/gcc-9.2.0/stage1-x86_64-pc-linux-gnu/libstdc++-v3/src/.libs/libstdc++.so.6.0.28 .\nmv libstdc++.so.6 libstdc++.so.6.old\nln -sv libstdc++.so.6.0.27 libstdc++.so.6\n\"libstdc++.so.6\" -> \"libstdc++.so.6.0.28\"\n```\n\n\n\n重启系统\n\n```\nreboot\n\n\n\ngcc -v\n\n```\n\n\n### 安装cmake\n#### 获取\n```\nhttps://cmake.org/download/\n\nwget https://github.com/Kitware/CMake/releases/download/v3.20.0/cmake-3.20.0.tar.gz\n```\n\n\n#### 编译\n```\ncd /usr/local/src\ntar xf cmake-3.20.0.tar.gz\ncd cmake-3.20.0\n./configure --prefix=/usr/local/cmake\nmake && make install\n```\n\n#### 软连接\n```\nln -s /usr/local/cmake/bin/cmake /usr/bin/cmake\n```\n#### 验证\n```\ncmake -version\n```\n```\ncmake version 3.20.0\n\nCMake suite maintained and supported by Kitware (kitware.com/cmake).\n```\n\n### 安装ninja\n```\nwget https://github.com/ninja-build/ninja/releases/download/v1.9.0/ninja-linux.zip\nunzip ninja-linux.zip -d /usr/local/bin/\n```\n```\nninja --version\n```\n\n### 安装clickhouse\n```\nyum install yum-utils\nrpm --import https://repo.yandex.ru/ClickHouse/ClickHouse-KEY.GPG\nyum-config-manager --add-repo https://repo.yandex.ru/ClickHouse/rpm/stable/x86_64\nyum install ClickHouse-server ClickHouse-client\nmkdir /opt/ClickHouse\nchown -R ClickHouse.ClickHouse /opt/ClickHouse/  #修改权限\n```\n\n### 源码安装clickhouse\n#### 源码获取\n```\ngit clone --recursive https://github.com/ClickHouse/ClickHouse\n```\n\n\n### 配置\n修改vim /etc/ClickHouse-server/config.xml\n修改 listen_host\n```\n<!-- Listen specified host. use :: (wildcard IPv6 address), if you want to accept connections both with IPv4 and IPv6 from everywhere. -->\n    <!-- <listen_host>::</listen_host> -->\n    <!-- Same for hosts with disabled ipv6: -->\n    <!-- <listen_host>0.0.0.0</listen_host> -->\n\n    <!-- Default values - try listen localhost on ipv4 and ipv6: -->\n    <!--\n    <listen_host>::1</listen_host>\n    <listen_host>127.0.0.1</listen_host>\n    -->\n    <listen_host>0.0.0.0</listen_host> <!-- 新增所有地址可以访问 -->\n    <!-- Don't exit if ipv6 or ipv4 unavailable, but listen_host with this protocol specified -->\n    <!-- <listen_try>0</listen_try> -->\n\n    <!-- Allow listen on same address:port -->\n    <!-- <listen_reuse_port>0</listen_reuse_port> -->\n\n    <!-- <listen_backlog>64</listen_backlog> -->\n```\n\n修改存储路径\n```\n<!-- Path to data directory, with trailing slash. -->\n    <path>/data/ClickHouse/</path>  <!-- 修改存储路径 -->\n\n    <!-- Path to temporary data for processing hard queries. -->\n    <tmp_path>/data/ClickHouse/tmp/</tmp_path>\n```\n添加集群配置\n```\n<remote_servers>\n    <bigdata> <!-- 集群名字，自定义 -->\n        <shard> <!-- 定义一个分片 -->\n            <!-- Optional. Shard weight when writing data. Default: 1. -->\n            <weight>1</weight>\n            <!-- Optional. Whether to write data to just one of the replicas. Default: false (write data to all replicas). -->\n            <internal_replication>false</internal_replication>\n            <replica> <!-- 这个分片的副本存在在哪些机器上 -->\n                <host>172.20.1.39</host>\n                <port>9000</port>\n            </replica>\n            <replica>\n                <host>172.20.1.246</host>\n                <port>9000</port>\n            </replica>\n        </shard>\n      <!--  \n        <shard>\n            <weight>2</weight>\n            <internal_replication>true</internal_replication>\n            <replica>\n                <host>172.20.1.39</host>\n                <port>9000</port>\n            </replica>\n            <replica>\n                <host>172.20.1.246</host>\n                <port>9000</port>\n            </replica>\n        </shard>\n        -->\n    </bigdata>\n</remote_servers>\n```\n\n添加zk 配置\n```\n<!-- ZooKeeper is used to store metadata about replicas, when using Replicated tables.\nOptional. If you don't use replicated tables, you could omit that.\n \nSee https://clickhouse.yandex/docs/en/table_engines/replication/\n-->\n \n<zookeeper incl=\"zookeeper-servers\" optional=\"true\" />\n<zookeeper>\n    <node index=\"1\">\n        <host>10.200.76.11</host>\n        <port>2181</port>\n    </node>\n    <node index=\"2\">\n        <host>10.200.76.12</host>\n        <port>2181</port>\n    </node>\n    <node index=\"3\">\n        <host>10.200.76.13</host>\n        <port>2182</port>\n    </node>\n</zookeeper>\n```\n\n配置分片macros变量\n```\n <macros incl=\"macros\" optional=\"true\" />\n    <!-- 配置分片macros变量，在用client创建表的时候回自动带入 -->\n    <macros>\n      <shard>1</shard>\n      <replica>172.20.1.39</replica> <!-- 这里指定当前集群节点的名字或者IP -->\n    </macros>\n```\n启动\n```\nsystemctl start ClickHouse-server.service\nsystemctl enable ClickHouse-server.service\n```\n检测\n```\n[root@bgdata zookeeper]# ClickHouse-client -h 172.20.1.246 -m\nClickHouse client version 20.3.2.1 (official build).\nConnecting to 172.20.1.246:9000 as user default.\nConnected to ClickHouse server version 20.3.2 revision 54433.\nbgdata.operate.ck-0002 :) select * from system.clusters ;\n\nSELECT *\nFROM system.clusters\n\n┌─cluster─┬─shard_num─┬─shard_weight─┬─replica_num─┬─host_name────┬─host_address─┬─port─┬─is_local─┬─user────┬─default_database─┬─errors_count─┬─estimated_recovery_time─┐\n│ bigdata │         1 │            1 │           1 │ 172.20.1.39  │ 172.20.1.39  │ 9000 │        0 │ default │                  │            0 │                       0 │\n│ bigdata │         1 │            1 │           2 │ 172.20.1.246 │ 172.20.1.246 │ 9000 │        1 │ default │                  │            0 │                       0 │\n└─────────┴───────────┴──────────────┴─────────────┴──────────────┴──────────────┴──────┴──────────┴─────────┴──────────────────┴──────────────┴─────────────────────────┘\n\n2 rows in set. Elapsed: 0.001 sec.\n```\n\n\n## 测试\n\n两台都分别创建数据库 create database test1;\n一台建表建立数据\n```\nCREATE TABLE t1 ON CLUSTER bigdata\n(\n    `ts` DateTime,\n    `uid` String,\n    `biz` String\n)\nENGINE = ReplicatedMergeTree('/ClickHouse/test1/tables/{shard}/t1', '{replica}')\nPARTITION BY toYYYYMMDD(ts)\nORDER BY ts\nSETTINGS index_granularity = 8192\n######说明 {shard}自动获取对应配置文件的macros分片设置变量 replica一样  ENGINE = ReplicatedMergeTree，不能为之前的MergeTree\n######'/ClickHouse/test1/tables/{shard}/t1' 是写入zk里面的地址，唯一，注意命名规范\n\nINSERT INTO t1 VALUES ('2019-06-07 20:01:01', 'a', 'show');\nINSERT INTO t1 VALUES ('2019-06-07 20:01:02', 'b', 'show');\nINSERT INTO t1 VALUES ('2019-06-07 20:01:03', 'a', 'click');\nINSERT INTO t1 VALUES ('2019-06-08 20:01:04', 'c', 'show');\nINSERT INTO t1 VALUES ('2019-06-08 20:01:05', 'c', 'click');\n```\n\n第二台机器查看数据，如果数据查询到了 ，并且一致，则成功，否则需重新检查配置\n\n3. 总结\n- 副本集是针对的表，不是库也不上整个ck，所以可以一些表用ReplicatedMergeTree也可以直接不复制，所以数据库都需要创建\n- 和ES分片和副本机器分布有区别，CK的每台机器只能一个分片的副本，所以如果要搭建2分片2副本需要2*2的机器，不然报错\n- 测试读写数据的时候发现，新建的表会同步，但是数据没有同步，通过查CK log以及zk里面对应host发现 zk存储的是主机名，不是ip，所以就无法找到主机写入，需要改hosts文件\n- 测试python ClickHouse_driver连接集群，发现需要高版本的ClickHouse_driver，不然没有alt_hosts参数\n- 增删数据库每台需要手动执行，增删表需要加上ON CLUSTER bigdata，增删数据是实时异步\n\n\n#### python连接ck集群范例\n\n```\nfrom ClickHouse_driver import Client\nclient = Client(\"172.20.1.39\",database=\"test1\",alt_hosts=\"172.20.1.246\") # 这里alt_hosts代表其他副本机器以,分割，shit源码看到的\nprint(client.execute(\"show tables\"))\n```\n\n","source":"_posts/elk/ClickHouse分布式集群搭建指南.md","raw":"---\ntitle: ClickHouse分布式集群搭建指南\ndate: 2021-03-12 14:35\ncategories:\n- elk\ntags:\n- clickhouse\n---\n  \n  \n摘要: ClickHouse分布式集群搭建指南\n<!-- more -->\n\n## ClickHouse是什么\n\nClickHouse 是 Yandex（俄罗斯最大的搜索引擎）开源的一个用于实时数据分析的基于列存储的数据库，其处理数据的速度比传统方法快 100-1000 倍。ClickHouse 的性能超过了目前市场上可比的面向列的 DBMS，每秒钟每台服务器每秒处理数亿至十亿多行和数十千兆字节的数据。\n\n#### ClickHouse的一些特性\n- 快速：ClickHouse 会充分利用所有可用的硬件，以尽可能快地处理每个查询。单个查询的峰值处理性能超过每秒 2 TB（解压缩后，仅使用的列）。在分布式设置中，读取是在健康副本之间自动平衡的，以避免增加延迟。\n- 容错：ClickHouse 支持多主机异步复制，并且可以跨多个数据中心进行部署。所有节点都相等，这可以避免出现单点故障。单个节点或整个数据中心的停机时间不会影响系统的读写可用性。\n- 可伸缩：ClickHouse 可以在垂直和水平方向上很好地缩放。ClickHouse 易于调整以在具有数百或数千个节点的群集上或在单个服务器上，甚至在小型虚拟机上执行。当前，每个单节点安装的数据量超过数万亿行或数百兆兆字节。\n- 易用：ClickHouse 简单易用，开箱即用。它简化了所有数据处理：将所有结构化数据吸收到系统中，并且立即可用于构建报告。SQL 允许表达期望的结果，而无需涉及某些 DBMS 中可以找到的任何自定义非标准 API。\n- 充分利用硬件：ClickHouse 与具有相同的可用 I/O 吞吐量和 CPU 容量的传统的面向行的系统相比，其处理典型的分析查询要快两到三个数量级。列式存储格式允许在 RAM 中容纳更多热数据，从而缩短了响应时间。\n- 提高 CPU 效率：向量化查询执行涉及相关的 SIMD 处理器指令和运行时代码生成。处理列中的数据会提高 CPU 行缓存的命中率。\n- 优化磁盘访问：ClickHouse 可以最大程度地减少范围查询的次数，从而提高了使用旋转磁盘驱动器的效率，因为它可以保持连续存储数据。最小化数据传输：ClickHouse 使公司无需使用专门针对高性能计算的专用网络即可管理其数据\n\n\n## 架构\n\n#### 服务器\ncentos 7 三台机器（ZooKeeper,clickhouse 高可用）\n\n| 主机 | IP | 应用 | 备注 |\n|---|---|---|---|\n|logch01.ztyc.com| 10.200.76.11 | ClickHouse-server<br/> ClickHouse-client<br/> jdk1.8<br/> ZooKeeper | |\n|logch02.ztyc.com| 10.200.76.12 | ClickHouse-server<br/> ClickHouse-client<br/> jdk1.8<br/> ZooKeeper | |\n|logch03.ztyc.com| 10.200.76.13 | ClickHouse-server<br/> ClickHouse-client<br/> jdk1.8<br/> ZooKeeper | |\n\n#### host 文件解析\n\n设置hosts文件解析（ck同步表数据的时候会去ZooKeeper 里面查询，ZooKeeper 里面存储的是hosts域名，不是IP，不解析会导致可以同步表但是无法同步表数据）,三台操作 vi /etc/hosts\n```\nvim /etc/hosts\n\n10.200.76.11 logch01.ztyc.com\n10.200.76.12 logch02.ztyc.com\n10.200.76.13 logch03.ztyc.com\n```\n\n## 部署zk集群\n#### 安装jdk1.8\n```\n```\n\n#### 安装zk\n```\ncd /opt/soft\nwget https://downloads.apache.org/zookeeper/zookeeper-3.6.2/apache-zookeeper-3.6.2.tar.gz && tar -xf apache-zookeeper-3.6.2.tar.gz \nln -s apache-zookeeper-3.6.2 /opt/zookeeper\ncd /opt/zookeeper\ncp conf/zoo_sample.cfg conf/zoo.cfg\nmkdir data\n\n```\n修改配置文件 `conf/zoocfg` 三台一样\n```\ntickTime=2000\ninitLimit=10\nsyncLimit=5\ndataDir=/opt/zookeeper/data\nclientPort=2181\nserver.1=10.200.76.11:2888:3888\nserver.2=10.200.76.12:2888:3888\nserver.3=10.200.76.13:2888:3888\n```\n创建myid在ZooKeeper 数据目录,三台不一样，对应上面server.1这个数字\n```\necho 1 > /opt/zookeeper/data/myid  # 其他机器分别是2 3\n```\n启动并检查\n```\n./bin/zkServer.sh start\n./bin/zkServer.sh status\n```\n\n\n## 搭建clickhouse集群\n一分片一副本集群\n\nClickhouse 仅支持Linux 且必须支持SSE4.2 指令集\n```\ngrep -q sse4_2 /proc/cpuinfo && echo \"SSE 4.2 supported\" || echo \"SSE 4.2 not supported\"\n```\n```\nSSE 4.2 supported   # 不支持会显示  SSE 4.2 not supported\n```\n如果服务器不支持SSE指令集，则不能直接下载预编译安装包，需要通过源码编译特定版本进行安装\n\n\n## 安装依赖\n### 安装gcc\n\n#### 安装依赖\n```\nyum install git cmake ninja-build libicu-devel clang libicu-devel readline-devel mysql-devel openssl-devel unixODBC_devel bzip2 -y\n```\n\n#### 安装高版本 gcc\n```\nwget ftp://gnu.mirror.iweb.com/gcc/gcc-9.3.0/gcc-9.3.0.tar.xz\n\ntar xvf gcc-9.3.0.tar.xz\ncd gcc-9.3.0\n./contrib/download_prerequisites\n```\n**生成Makefile文件**\n\n```\n./configure --prefix=/usr/local -enable-checking=release -enable-languages=c,c++ -disable-multilib\n\n```\n\n**编译gcc**\n\n```\nmake -j4    #多核电脑可以添加 “-j4” ：make对多核处理器的优化选项，此步骤非常耗时\n\nls /usr/local/bin | grep gcc\n```\n\n**安装gcc**\n\n```\n make install\n```\n\n**配置gcc**\n\n```\ncd ~\nfind /usr/local/src/gcc-9.2.0/ -name \"libstdc++.so*\"\n\n/usr/local/src/gcc-9.2.0/stage1-x86_64-pc-linux-gnu/libstdc++-v3/src/.libs/libstdc++.so.6.0.24\n/usr/local/src/gcc-9.2.0/stage1-x86_64-pc-linux-gnu/libstdc++-v3/src/.libs/libstdc++.so.6\n/usr/local/src/gcc-9.2.0/stage1-x86_64-pc-linux-gnu/libstdc++-v3/src/.libs/libstdc++.so\n/usr/local/src/gcc-9.2.0/prev-x86_64-pc-linux-gnu/libstdc++-v3/src/.libs/libstdc++.so.6.0.24\n/usr/local/src/gcc-9.2.0/prev-x86_64-pc-linux-gnu/libstdc++-v3/src/.libs/libstdc++.so.6\n/usr/local/src/gcc-9.2.0/prev-x86_64-pc-linux-gnu/libstdc++-v3/src/.libs/libstdc++.so\n/usr/local/src/gcc-9.2.0/x86_64-pc-linux-gnu/libstdc++-v3/src/.libs/libstdc++.so.6.0.24\n/usr/local/src/gcc-9.2.0/x86_64-pc-linux-gnu/libstdc++-v3/src/.libs/libstdc++.so.6\n/usr/local/src/gcc-9.2.0/x86_64-pc-linux-gnu/libstdc++-v3/src/.libs/libstdc++.so\n\ncd /usr/lib64\ncp /usr/local/src/gcc-9.2.0/stage1-x86_64-pc-linux-gnu/libstdc++-v3/src/.libs/libstdc++.so.6.0.28 .\nmv libstdc++.so.6 libstdc++.so.6.old\nln -sv libstdc++.so.6.0.27 libstdc++.so.6\n\"libstdc++.so.6\" -> \"libstdc++.so.6.0.28\"\n```\n\n\n\n重启系统\n\n```\nreboot\n\n\n\ngcc -v\n\n```\n\n\n### 安装cmake\n#### 获取\n```\nhttps://cmake.org/download/\n\nwget https://github.com/Kitware/CMake/releases/download/v3.20.0/cmake-3.20.0.tar.gz\n```\n\n\n#### 编译\n```\ncd /usr/local/src\ntar xf cmake-3.20.0.tar.gz\ncd cmake-3.20.0\n./configure --prefix=/usr/local/cmake\nmake && make install\n```\n\n#### 软连接\n```\nln -s /usr/local/cmake/bin/cmake /usr/bin/cmake\n```\n#### 验证\n```\ncmake -version\n```\n```\ncmake version 3.20.0\n\nCMake suite maintained and supported by Kitware (kitware.com/cmake).\n```\n\n### 安装ninja\n```\nwget https://github.com/ninja-build/ninja/releases/download/v1.9.0/ninja-linux.zip\nunzip ninja-linux.zip -d /usr/local/bin/\n```\n```\nninja --version\n```\n\n### 安装clickhouse\n```\nyum install yum-utils\nrpm --import https://repo.yandex.ru/ClickHouse/ClickHouse-KEY.GPG\nyum-config-manager --add-repo https://repo.yandex.ru/ClickHouse/rpm/stable/x86_64\nyum install ClickHouse-server ClickHouse-client\nmkdir /opt/ClickHouse\nchown -R ClickHouse.ClickHouse /opt/ClickHouse/  #修改权限\n```\n\n### 源码安装clickhouse\n#### 源码获取\n```\ngit clone --recursive https://github.com/ClickHouse/ClickHouse\n```\n\n\n### 配置\n修改vim /etc/ClickHouse-server/config.xml\n修改 listen_host\n```\n<!-- Listen specified host. use :: (wildcard IPv6 address), if you want to accept connections both with IPv4 and IPv6 from everywhere. -->\n    <!-- <listen_host>::</listen_host> -->\n    <!-- Same for hosts with disabled ipv6: -->\n    <!-- <listen_host>0.0.0.0</listen_host> -->\n\n    <!-- Default values - try listen localhost on ipv4 and ipv6: -->\n    <!--\n    <listen_host>::1</listen_host>\n    <listen_host>127.0.0.1</listen_host>\n    -->\n    <listen_host>0.0.0.0</listen_host> <!-- 新增所有地址可以访问 -->\n    <!-- Don't exit if ipv6 or ipv4 unavailable, but listen_host with this protocol specified -->\n    <!-- <listen_try>0</listen_try> -->\n\n    <!-- Allow listen on same address:port -->\n    <!-- <listen_reuse_port>0</listen_reuse_port> -->\n\n    <!-- <listen_backlog>64</listen_backlog> -->\n```\n\n修改存储路径\n```\n<!-- Path to data directory, with trailing slash. -->\n    <path>/data/ClickHouse/</path>  <!-- 修改存储路径 -->\n\n    <!-- Path to temporary data for processing hard queries. -->\n    <tmp_path>/data/ClickHouse/tmp/</tmp_path>\n```\n添加集群配置\n```\n<remote_servers>\n    <bigdata> <!-- 集群名字，自定义 -->\n        <shard> <!-- 定义一个分片 -->\n            <!-- Optional. Shard weight when writing data. Default: 1. -->\n            <weight>1</weight>\n            <!-- Optional. Whether to write data to just one of the replicas. Default: false (write data to all replicas). -->\n            <internal_replication>false</internal_replication>\n            <replica> <!-- 这个分片的副本存在在哪些机器上 -->\n                <host>172.20.1.39</host>\n                <port>9000</port>\n            </replica>\n            <replica>\n                <host>172.20.1.246</host>\n                <port>9000</port>\n            </replica>\n        </shard>\n      <!--  \n        <shard>\n            <weight>2</weight>\n            <internal_replication>true</internal_replication>\n            <replica>\n                <host>172.20.1.39</host>\n                <port>9000</port>\n            </replica>\n            <replica>\n                <host>172.20.1.246</host>\n                <port>9000</port>\n            </replica>\n        </shard>\n        -->\n    </bigdata>\n</remote_servers>\n```\n\n添加zk 配置\n```\n<!-- ZooKeeper is used to store metadata about replicas, when using Replicated tables.\nOptional. If you don't use replicated tables, you could omit that.\n \nSee https://clickhouse.yandex/docs/en/table_engines/replication/\n-->\n \n<zookeeper incl=\"zookeeper-servers\" optional=\"true\" />\n<zookeeper>\n    <node index=\"1\">\n        <host>10.200.76.11</host>\n        <port>2181</port>\n    </node>\n    <node index=\"2\">\n        <host>10.200.76.12</host>\n        <port>2181</port>\n    </node>\n    <node index=\"3\">\n        <host>10.200.76.13</host>\n        <port>2182</port>\n    </node>\n</zookeeper>\n```\n\n配置分片macros变量\n```\n <macros incl=\"macros\" optional=\"true\" />\n    <!-- 配置分片macros变量，在用client创建表的时候回自动带入 -->\n    <macros>\n      <shard>1</shard>\n      <replica>172.20.1.39</replica> <!-- 这里指定当前集群节点的名字或者IP -->\n    </macros>\n```\n启动\n```\nsystemctl start ClickHouse-server.service\nsystemctl enable ClickHouse-server.service\n```\n检测\n```\n[root@bgdata zookeeper]# ClickHouse-client -h 172.20.1.246 -m\nClickHouse client version 20.3.2.1 (official build).\nConnecting to 172.20.1.246:9000 as user default.\nConnected to ClickHouse server version 20.3.2 revision 54433.\nbgdata.operate.ck-0002 :) select * from system.clusters ;\n\nSELECT *\nFROM system.clusters\n\n┌─cluster─┬─shard_num─┬─shard_weight─┬─replica_num─┬─host_name────┬─host_address─┬─port─┬─is_local─┬─user────┬─default_database─┬─errors_count─┬─estimated_recovery_time─┐\n│ bigdata │         1 │            1 │           1 │ 172.20.1.39  │ 172.20.1.39  │ 9000 │        0 │ default │                  │            0 │                       0 │\n│ bigdata │         1 │            1 │           2 │ 172.20.1.246 │ 172.20.1.246 │ 9000 │        1 │ default │                  │            0 │                       0 │\n└─────────┴───────────┴──────────────┴─────────────┴──────────────┴──────────────┴──────┴──────────┴─────────┴──────────────────┴──────────────┴─────────────────────────┘\n\n2 rows in set. Elapsed: 0.001 sec.\n```\n\n\n## 测试\n\n两台都分别创建数据库 create database test1;\n一台建表建立数据\n```\nCREATE TABLE t1 ON CLUSTER bigdata\n(\n    `ts` DateTime,\n    `uid` String,\n    `biz` String\n)\nENGINE = ReplicatedMergeTree('/ClickHouse/test1/tables/{shard}/t1', '{replica}')\nPARTITION BY toYYYYMMDD(ts)\nORDER BY ts\nSETTINGS index_granularity = 8192\n######说明 {shard}自动获取对应配置文件的macros分片设置变量 replica一样  ENGINE = ReplicatedMergeTree，不能为之前的MergeTree\n######'/ClickHouse/test1/tables/{shard}/t1' 是写入zk里面的地址，唯一，注意命名规范\n\nINSERT INTO t1 VALUES ('2019-06-07 20:01:01', 'a', 'show');\nINSERT INTO t1 VALUES ('2019-06-07 20:01:02', 'b', 'show');\nINSERT INTO t1 VALUES ('2019-06-07 20:01:03', 'a', 'click');\nINSERT INTO t1 VALUES ('2019-06-08 20:01:04', 'c', 'show');\nINSERT INTO t1 VALUES ('2019-06-08 20:01:05', 'c', 'click');\n```\n\n第二台机器查看数据，如果数据查询到了 ，并且一致，则成功，否则需重新检查配置\n\n3. 总结\n- 副本集是针对的表，不是库也不上整个ck，所以可以一些表用ReplicatedMergeTree也可以直接不复制，所以数据库都需要创建\n- 和ES分片和副本机器分布有区别，CK的每台机器只能一个分片的副本，所以如果要搭建2分片2副本需要2*2的机器，不然报错\n- 测试读写数据的时候发现，新建的表会同步，但是数据没有同步，通过查CK log以及zk里面对应host发现 zk存储的是主机名，不是ip，所以就无法找到主机写入，需要改hosts文件\n- 测试python ClickHouse_driver连接集群，发现需要高版本的ClickHouse_driver，不然没有alt_hosts参数\n- 增删数据库每台需要手动执行，增删表需要加上ON CLUSTER bigdata，增删数据是实时异步\n\n\n#### python连接ck集群范例\n\n```\nfrom ClickHouse_driver import Client\nclient = Client(\"172.20.1.39\",database=\"test1\",alt_hosts=\"172.20.1.246\") # 这里alt_hosts代表其他副本机器以,分割，shit源码看到的\nprint(client.execute(\"show tables\"))\n```\n\n","slug":"elk/ClickHouse分布式集群搭建指南","published":1,"updated":"2021-06-18T08:07:11.187Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cku6979yw002800uh61946wf7","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><p>摘要: ClickHouse分布式集群搭建指南</p>\n<span id=\"more\"></span>\n\n<h2 id=\"ClickHouse是什么\"><a href=\"#ClickHouse是什么\" class=\"headerlink\" title=\"ClickHouse是什么\"></a>ClickHouse是什么</h2><p>ClickHouse 是 Yandex（俄罗斯最大的搜索引擎）开源的一个用于实时数据分析的基于列存储的数据库，其处理数据的速度比传统方法快 100-1000 倍。ClickHouse 的性能超过了目前市场上可比的面向列的 DBMS，每秒钟每台服务器每秒处理数亿至十亿多行和数十千兆字节的数据。</p>\n<h4 id=\"ClickHouse的一些特性\"><a href=\"#ClickHouse的一些特性\" class=\"headerlink\" title=\"ClickHouse的一些特性\"></a>ClickHouse的一些特性</h4><ul>\n<li>快速：ClickHouse 会充分利用所有可用的硬件，以尽可能快地处理每个查询。单个查询的峰值处理性能超过每秒 2 TB（解压缩后，仅使用的列）。在分布式设置中，读取是在健康副本之间自动平衡的，以避免增加延迟。</li>\n<li>容错：ClickHouse 支持多主机异步复制，并且可以跨多个数据中心进行部署。所有节点都相等，这可以避免出现单点故障。单个节点或整个数据中心的停机时间不会影响系统的读写可用性。</li>\n<li>可伸缩：ClickHouse 可以在垂直和水平方向上很好地缩放。ClickHouse 易于调整以在具有数百或数千个节点的群集上或在单个服务器上，甚至在小型虚拟机上执行。当前，每个单节点安装的数据量超过数万亿行或数百兆兆字节。</li>\n<li>易用：ClickHouse 简单易用，开箱即用。它简化了所有数据处理：将所有结构化数据吸收到系统中，并且立即可用于构建报告。SQL 允许表达期望的结果，而无需涉及某些 DBMS 中可以找到的任何自定义非标准 API。</li>\n<li>充分利用硬件：ClickHouse 与具有相同的可用 I/O 吞吐量和 CPU 容量的传统的面向行的系统相比，其处理典型的分析查询要快两到三个数量级。列式存储格式允许在 RAM 中容纳更多热数据，从而缩短了响应时间。</li>\n<li>提高 CPU 效率：向量化查询执行涉及相关的 SIMD 处理器指令和运行时代码生成。处理列中的数据会提高 CPU 行缓存的命中率。</li>\n<li>优化磁盘访问：ClickHouse 可以最大程度地减少范围查询的次数，从而提高了使用旋转磁盘驱动器的效率，因为它可以保持连续存储数据。最小化数据传输：ClickHouse 使公司无需使用专门针对高性能计算的专用网络即可管理其数据</li>\n</ul>\n<h2 id=\"架构\"><a href=\"#架构\" class=\"headerlink\" title=\"架构\"></a>架构</h2><h4 id=\"服务器\"><a href=\"#服务器\" class=\"headerlink\" title=\"服务器\"></a>服务器</h4><p>centos 7 三台机器（ZooKeeper,clickhouse 高可用）</p>\n<table>\n<thead>\n<tr>\n<th>主机</th>\n<th>IP</th>\n<th>应用</th>\n<th>备注</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>logch01.ztyc.com</td>\n<td>10.200.76.11</td>\n<td>ClickHouse-server<br/> ClickHouse-client<br/> jdk1.8<br/> ZooKeeper</td>\n<td></td>\n</tr>\n<tr>\n<td>logch02.ztyc.com</td>\n<td>10.200.76.12</td>\n<td>ClickHouse-server<br/> ClickHouse-client<br/> jdk1.8<br/> ZooKeeper</td>\n<td></td>\n</tr>\n<tr>\n<td>logch03.ztyc.com</td>\n<td>10.200.76.13</td>\n<td>ClickHouse-server<br/> ClickHouse-client<br/> jdk1.8<br/> ZooKeeper</td>\n<td></td>\n</tr>\n</tbody></table>\n<h4 id=\"host-文件解析\"><a href=\"#host-文件解析\" class=\"headerlink\" title=\"host 文件解析\"></a>host 文件解析</h4><p>设置hosts文件解析（ck同步表数据的时候会去ZooKeeper 里面查询，ZooKeeper 里面存储的是hosts域名，不是IP，不解析会导致可以同步表但是无法同步表数据）,三台操作 vi /etc/hosts</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim &#x2F;etc&#x2F;hosts</span><br><span class=\"line\"></span><br><span class=\"line\">10.200.76.11 logch01.ztyc.com</span><br><span class=\"line\">10.200.76.12 logch02.ztyc.com</span><br><span class=\"line\">10.200.76.13 logch03.ztyc.com</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"部署zk集群\"><a href=\"#部署zk集群\" class=\"headerlink\" title=\"部署zk集群\"></a>部署zk集群</h2><h4 id=\"安装jdk1-8\"><a href=\"#安装jdk1-8\" class=\"headerlink\" title=\"安装jdk1.8\"></a>安装jdk1.8</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#96;&#96;&#96;</span><br><span class=\"line\"></span><br><span class=\"line\">#### 安装zk</span><br></pre></td></tr></table></figure>\n<p>cd /opt/soft<br>wget <a href=\"https://downloads.apache.org/zookeeper/zookeeper-3.6.2/apache-zookeeper-3.6.2.tar.gz\">https://downloads.apache.org/zookeeper/zookeeper-3.6.2/apache-zookeeper-3.6.2.tar.gz</a> &amp;&amp; tar -xf apache-zookeeper-3.6.2.tar.gz<br>ln -s apache-zookeeper-3.6.2 /opt/zookeeper<br>cd /opt/zookeeper<br>cp conf/zoo_sample.cfg conf/zoo.cfg<br>mkdir data</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">修改配置文件 &#96;conf&#x2F;zoocfg&#96; 三台一样</span><br></pre></td></tr></table></figure>\n<p>tickTime=2000<br>initLimit=10<br>syncLimit=5<br>dataDir=/opt/zookeeper/data<br>clientPort=2181<br>server.1=10.200.76.11:2888:3888<br>server.2=10.200.76.12:2888:3888<br>server.3=10.200.76.13:2888:3888</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">创建myid在ZooKeeper 数据目录,三台不一样，对应上面server.1这个数字</span><br></pre></td></tr></table></figure>\n<p>echo 1 &gt; /opt/zookeeper/data/myid  # 其他机器分别是2 3</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">启动并检查</span><br></pre></td></tr></table></figure>\n<p>./bin/zkServer.sh start<br>./bin/zkServer.sh status</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">## 搭建clickhouse集群</span><br><span class=\"line\">一分片一副本集群</span><br><span class=\"line\"></span><br><span class=\"line\">Clickhouse 仅支持Linux 且必须支持SSE4.2 指令集</span><br></pre></td></tr></table></figure>\n<p>grep -q sse4_2 /proc/cpuinfo &amp;&amp; echo “SSE 4.2 supported” || echo “SSE 4.2 not supported”</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#96;&#96;&#96;</span><br><span class=\"line\">SSE 4.2 supported   # 不支持会显示  SSE 4.2 not supported</span><br></pre></td></tr></table></figure>\n<p>如果服务器不支持SSE指令集，则不能直接下载预编译安装包，需要通过源码编译特定版本进行安装</p>\n<h2 id=\"安装依赖\"><a href=\"#安装依赖\" class=\"headerlink\" title=\"安装依赖\"></a>安装依赖</h2><h3 id=\"安装gcc\"><a href=\"#安装gcc\" class=\"headerlink\" title=\"安装gcc\"></a>安装gcc</h3><h4 id=\"安装依赖-1\"><a href=\"#安装依赖-1\" class=\"headerlink\" title=\"安装依赖\"></a>安装依赖</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install git cmake ninja-build libicu-devel clang libicu-devel readline-devel mysql-devel openssl-devel unixODBC_devel bzip2 -y</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"安装高版本-gcc\"><a href=\"#安装高版本-gcc\" class=\"headerlink\" title=\"安装高版本 gcc\"></a>安装高版本 gcc</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget ftp:&#x2F;&#x2F;gnu.mirror.iweb.com&#x2F;gcc&#x2F;gcc-9.3.0&#x2F;gcc-9.3.0.tar.xz</span><br><span class=\"line\"></span><br><span class=\"line\">tar xvf gcc-9.3.0.tar.xz</span><br><span class=\"line\">cd gcc-9.3.0</span><br><span class=\"line\">.&#x2F;contrib&#x2F;download_prerequisites</span><br></pre></td></tr></table></figure>\n<p><strong>生成Makefile文件</strong></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">.&#x2F;configure --prefix&#x3D;&#x2F;usr&#x2F;local -enable-checking&#x3D;release -enable-languages&#x3D;c,c++ -disable-multilib</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p><strong>编译gcc</strong></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">make -j4    #多核电脑可以添加 “-j4” ：make对多核处理器的优化选项，此步骤非常耗时</span><br><span class=\"line\"></span><br><span class=\"line\">ls &#x2F;usr&#x2F;local&#x2F;bin | grep gcc</span><br></pre></td></tr></table></figure>\n\n<p><strong>安装gcc</strong></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">make install</span><br></pre></td></tr></table></figure>\n\n<p><strong>配置gcc</strong></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd ~</span><br><span class=\"line\">find &#x2F;usr&#x2F;local&#x2F;src&#x2F;gcc-9.2.0&#x2F; -name &quot;libstdc++.so*&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">&#x2F;usr&#x2F;local&#x2F;src&#x2F;gcc-9.2.0&#x2F;stage1-x86_64-pc-linux-gnu&#x2F;libstdc++-v3&#x2F;src&#x2F;.libs&#x2F;libstdc++.so.6.0.24</span><br><span class=\"line\">&#x2F;usr&#x2F;local&#x2F;src&#x2F;gcc-9.2.0&#x2F;stage1-x86_64-pc-linux-gnu&#x2F;libstdc++-v3&#x2F;src&#x2F;.libs&#x2F;libstdc++.so.6</span><br><span class=\"line\">&#x2F;usr&#x2F;local&#x2F;src&#x2F;gcc-9.2.0&#x2F;stage1-x86_64-pc-linux-gnu&#x2F;libstdc++-v3&#x2F;src&#x2F;.libs&#x2F;libstdc++.so</span><br><span class=\"line\">&#x2F;usr&#x2F;local&#x2F;src&#x2F;gcc-9.2.0&#x2F;prev-x86_64-pc-linux-gnu&#x2F;libstdc++-v3&#x2F;src&#x2F;.libs&#x2F;libstdc++.so.6.0.24</span><br><span class=\"line\">&#x2F;usr&#x2F;local&#x2F;src&#x2F;gcc-9.2.0&#x2F;prev-x86_64-pc-linux-gnu&#x2F;libstdc++-v3&#x2F;src&#x2F;.libs&#x2F;libstdc++.so.6</span><br><span class=\"line\">&#x2F;usr&#x2F;local&#x2F;src&#x2F;gcc-9.2.0&#x2F;prev-x86_64-pc-linux-gnu&#x2F;libstdc++-v3&#x2F;src&#x2F;.libs&#x2F;libstdc++.so</span><br><span class=\"line\">&#x2F;usr&#x2F;local&#x2F;src&#x2F;gcc-9.2.0&#x2F;x86_64-pc-linux-gnu&#x2F;libstdc++-v3&#x2F;src&#x2F;.libs&#x2F;libstdc++.so.6.0.24</span><br><span class=\"line\">&#x2F;usr&#x2F;local&#x2F;src&#x2F;gcc-9.2.0&#x2F;x86_64-pc-linux-gnu&#x2F;libstdc++-v3&#x2F;src&#x2F;.libs&#x2F;libstdc++.so.6</span><br><span class=\"line\">&#x2F;usr&#x2F;local&#x2F;src&#x2F;gcc-9.2.0&#x2F;x86_64-pc-linux-gnu&#x2F;libstdc++-v3&#x2F;src&#x2F;.libs&#x2F;libstdc++.so</span><br><span class=\"line\"></span><br><span class=\"line\">cd &#x2F;usr&#x2F;lib64</span><br><span class=\"line\">cp &#x2F;usr&#x2F;local&#x2F;src&#x2F;gcc-9.2.0&#x2F;stage1-x86_64-pc-linux-gnu&#x2F;libstdc++-v3&#x2F;src&#x2F;.libs&#x2F;libstdc++.so.6.0.28 .</span><br><span class=\"line\">mv libstdc++.so.6 libstdc++.so.6.old</span><br><span class=\"line\">ln -sv libstdc++.so.6.0.27 libstdc++.so.6</span><br><span class=\"line\">&quot;libstdc++.so.6&quot; -&gt; &quot;libstdc++.so.6.0.28&quot;</span><br></pre></td></tr></table></figure>\n\n\n\n<p>重启系统</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">reboot</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">gcc -v</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n<h3 id=\"安装cmake\"><a href=\"#安装cmake\" class=\"headerlink\" title=\"安装cmake\"></a>安装cmake</h3><h4 id=\"获取\"><a href=\"#获取\" class=\"headerlink\" title=\"获取\"></a>获取</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">https:&#x2F;&#x2F;cmake.org&#x2F;download&#x2F;</span><br><span class=\"line\"></span><br><span class=\"line\">wget https:&#x2F;&#x2F;github.com&#x2F;Kitware&#x2F;CMake&#x2F;releases&#x2F;download&#x2F;v3.20.0&#x2F;cmake-3.20.0.tar.gz</span><br></pre></td></tr></table></figure>\n\n\n<h4 id=\"编译\"><a href=\"#编译\" class=\"headerlink\" title=\"编译\"></a>编译</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd &#x2F;usr&#x2F;local&#x2F;src</span><br><span class=\"line\">tar xf cmake-3.20.0.tar.gz</span><br><span class=\"line\">cd cmake-3.20.0</span><br><span class=\"line\">.&#x2F;configure --prefix&#x3D;&#x2F;usr&#x2F;local&#x2F;cmake</span><br><span class=\"line\">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"软连接\"><a href=\"#软连接\" class=\"headerlink\" title=\"软连接\"></a>软连接</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ln -s &#x2F;usr&#x2F;local&#x2F;cmake&#x2F;bin&#x2F;cmake &#x2F;usr&#x2F;bin&#x2F;cmake</span><br></pre></td></tr></table></figure>\n<h4 id=\"验证\"><a href=\"#验证\" class=\"headerlink\" title=\"验证\"></a>验证</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cmake -version</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cmake version 3.20.0</span><br><span class=\"line\"></span><br><span class=\"line\">CMake suite maintained and supported by Kitware (kitware.com&#x2F;cmake).</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"安装ninja\"><a href=\"#安装ninja\" class=\"headerlink\" title=\"安装ninja\"></a>安装ninja</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget https:&#x2F;&#x2F;github.com&#x2F;ninja-build&#x2F;ninja&#x2F;releases&#x2F;download&#x2F;v1.9.0&#x2F;ninja-linux.zip</span><br><span class=\"line\">unzip ninja-linux.zip -d &#x2F;usr&#x2F;local&#x2F;bin&#x2F;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ninja --version</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"安装clickhouse\"><a href=\"#安装clickhouse\" class=\"headerlink\" title=\"安装clickhouse\"></a>安装clickhouse</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install yum-utils</span><br><span class=\"line\">rpm --import https:&#x2F;&#x2F;repo.yandex.ru&#x2F;ClickHouse&#x2F;ClickHouse-KEY.GPG</span><br><span class=\"line\">yum-config-manager --add-repo https:&#x2F;&#x2F;repo.yandex.ru&#x2F;ClickHouse&#x2F;rpm&#x2F;stable&#x2F;x86_64</span><br><span class=\"line\">yum install ClickHouse-server ClickHouse-client</span><br><span class=\"line\">mkdir &#x2F;opt&#x2F;ClickHouse</span><br><span class=\"line\">chown -R ClickHouse.ClickHouse &#x2F;opt&#x2F;ClickHouse&#x2F;  #修改权限</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"源码安装clickhouse\"><a href=\"#源码安装clickhouse\" class=\"headerlink\" title=\"源码安装clickhouse\"></a>源码安装clickhouse</h3><h4 id=\"源码获取\"><a href=\"#源码获取\" class=\"headerlink\" title=\"源码获取\"></a>源码获取</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git clone --recursive https:&#x2F;&#x2F;github.com&#x2F;ClickHouse&#x2F;ClickHouse</span><br></pre></td></tr></table></figure>\n\n\n<h3 id=\"配置\"><a href=\"#配置\" class=\"headerlink\" title=\"配置\"></a>配置</h3><p>修改vim /etc/ClickHouse-server/config.xml<br>修改 listen_host</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;!-- Listen specified host. use :: (wildcard IPv6 address), if you want to accept connections both with IPv4 and IPv6 from everywhere. --&gt;</span><br><span class=\"line\">    &lt;!-- &lt;listen_host&gt;::&lt;&#x2F;listen_host&gt; --&gt;</span><br><span class=\"line\">    &lt;!-- Same for hosts with disabled ipv6: --&gt;</span><br><span class=\"line\">    &lt;!-- &lt;listen_host&gt;0.0.0.0&lt;&#x2F;listen_host&gt; --&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;!-- Default values - try listen localhost on ipv4 and ipv6: --&gt;</span><br><span class=\"line\">    &lt;!--</span><br><span class=\"line\">    &lt;listen_host&gt;::1&lt;&#x2F;listen_host&gt;</span><br><span class=\"line\">    &lt;listen_host&gt;127.0.0.1&lt;&#x2F;listen_host&gt;</span><br><span class=\"line\">    --&gt;</span><br><span class=\"line\">    &lt;listen_host&gt;0.0.0.0&lt;&#x2F;listen_host&gt; &lt;!-- 新增所有地址可以访问 --&gt;</span><br><span class=\"line\">    &lt;!-- Don&#39;t exit if ipv6 or ipv4 unavailable, but listen_host with this protocol specified --&gt;</span><br><span class=\"line\">    &lt;!-- &lt;listen_try&gt;0&lt;&#x2F;listen_try&gt; --&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;!-- Allow listen on same address:port --&gt;</span><br><span class=\"line\">    &lt;!-- &lt;listen_reuse_port&gt;0&lt;&#x2F;listen_reuse_port&gt; --&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;!-- &lt;listen_backlog&gt;64&lt;&#x2F;listen_backlog&gt; --&gt;</span><br></pre></td></tr></table></figure>\n\n<p>修改存储路径</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;!-- Path to data directory, with trailing slash. --&gt;</span><br><span class=\"line\">    &lt;path&gt;&#x2F;data&#x2F;ClickHouse&#x2F;&lt;&#x2F;path&gt;  &lt;!-- 修改存储路径 --&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;!-- Path to temporary data for processing hard queries. --&gt;</span><br><span class=\"line\">    &lt;tmp_path&gt;&#x2F;data&#x2F;ClickHouse&#x2F;tmp&#x2F;&lt;&#x2F;tmp_path&gt;</span><br></pre></td></tr></table></figure>\n<p>添加集群配置</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;remote_servers&gt;</span><br><span class=\"line\">    &lt;bigdata&gt; &lt;!-- 集群名字，自定义 --&gt;</span><br><span class=\"line\">        &lt;shard&gt; &lt;!-- 定义一个分片 --&gt;</span><br><span class=\"line\">            &lt;!-- Optional. Shard weight when writing data. Default: 1. --&gt;</span><br><span class=\"line\">            &lt;weight&gt;1&lt;&#x2F;weight&gt;</span><br><span class=\"line\">            &lt;!-- Optional. Whether to write data to just one of the replicas. Default: false (write data to all replicas). --&gt;</span><br><span class=\"line\">            &lt;internal_replication&gt;false&lt;&#x2F;internal_replication&gt;</span><br><span class=\"line\">            &lt;replica&gt; &lt;!-- 这个分片的副本存在在哪些机器上 --&gt;</span><br><span class=\"line\">                &lt;host&gt;172.20.1.39&lt;&#x2F;host&gt;</span><br><span class=\"line\">                &lt;port&gt;9000&lt;&#x2F;port&gt;</span><br><span class=\"line\">            &lt;&#x2F;replica&gt;</span><br><span class=\"line\">            &lt;replica&gt;</span><br><span class=\"line\">                &lt;host&gt;172.20.1.246&lt;&#x2F;host&gt;</span><br><span class=\"line\">                &lt;port&gt;9000&lt;&#x2F;port&gt;</span><br><span class=\"line\">            &lt;&#x2F;replica&gt;</span><br><span class=\"line\">        &lt;&#x2F;shard&gt;</span><br><span class=\"line\">      &lt;!--  </span><br><span class=\"line\">        &lt;shard&gt;</span><br><span class=\"line\">            &lt;weight&gt;2&lt;&#x2F;weight&gt;</span><br><span class=\"line\">            &lt;internal_replication&gt;true&lt;&#x2F;internal_replication&gt;</span><br><span class=\"line\">            &lt;replica&gt;</span><br><span class=\"line\">                &lt;host&gt;172.20.1.39&lt;&#x2F;host&gt;</span><br><span class=\"line\">                &lt;port&gt;9000&lt;&#x2F;port&gt;</span><br><span class=\"line\">            &lt;&#x2F;replica&gt;</span><br><span class=\"line\">            &lt;replica&gt;</span><br><span class=\"line\">                &lt;host&gt;172.20.1.246&lt;&#x2F;host&gt;</span><br><span class=\"line\">                &lt;port&gt;9000&lt;&#x2F;port&gt;</span><br><span class=\"line\">            &lt;&#x2F;replica&gt;</span><br><span class=\"line\">        &lt;&#x2F;shard&gt;</span><br><span class=\"line\">        --&gt;</span><br><span class=\"line\">    &lt;&#x2F;bigdata&gt;</span><br><span class=\"line\">&lt;&#x2F;remote_servers&gt;</span><br></pre></td></tr></table></figure>\n\n<p>添加zk 配置</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;!-- ZooKeeper is used to store metadata about replicas, when using Replicated tables.</span><br><span class=\"line\">Optional. If you don&#39;t use replicated tables, you could omit that.</span><br><span class=\"line\"> </span><br><span class=\"line\">See https:&#x2F;&#x2F;clickhouse.yandex&#x2F;docs&#x2F;en&#x2F;table_engines&#x2F;replication&#x2F;</span><br><span class=\"line\">--&gt;</span><br><span class=\"line\"> </span><br><span class=\"line\">&lt;zookeeper incl&#x3D;&quot;zookeeper-servers&quot; optional&#x3D;&quot;true&quot; &#x2F;&gt;</span><br><span class=\"line\">&lt;zookeeper&gt;</span><br><span class=\"line\">    &lt;node index&#x3D;&quot;1&quot;&gt;</span><br><span class=\"line\">        &lt;host&gt;10.200.76.11&lt;&#x2F;host&gt;</span><br><span class=\"line\">        &lt;port&gt;2181&lt;&#x2F;port&gt;</span><br><span class=\"line\">    &lt;&#x2F;node&gt;</span><br><span class=\"line\">    &lt;node index&#x3D;&quot;2&quot;&gt;</span><br><span class=\"line\">        &lt;host&gt;10.200.76.12&lt;&#x2F;host&gt;</span><br><span class=\"line\">        &lt;port&gt;2181&lt;&#x2F;port&gt;</span><br><span class=\"line\">    &lt;&#x2F;node&gt;</span><br><span class=\"line\">    &lt;node index&#x3D;&quot;3&quot;&gt;</span><br><span class=\"line\">        &lt;host&gt;10.200.76.13&lt;&#x2F;host&gt;</span><br><span class=\"line\">        &lt;port&gt;2182&lt;&#x2F;port&gt;</span><br><span class=\"line\">    &lt;&#x2F;node&gt;</span><br><span class=\"line\">&lt;&#x2F;zookeeper&gt;</span><br></pre></td></tr></table></figure>\n\n<p>配置分片macros变量</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;macros incl&#x3D;&quot;macros&quot; optional&#x3D;&quot;true&quot; &#x2F;&gt;</span><br><span class=\"line\">   &lt;!-- 配置分片macros变量，在用client创建表的时候回自动带入 --&gt;</span><br><span class=\"line\">   &lt;macros&gt;</span><br><span class=\"line\">     &lt;shard&gt;1&lt;&#x2F;shard&gt;</span><br><span class=\"line\">     &lt;replica&gt;172.20.1.39&lt;&#x2F;replica&gt; &lt;!-- 这里指定当前集群节点的名字或者IP --&gt;</span><br><span class=\"line\">   &lt;&#x2F;macros&gt;</span><br></pre></td></tr></table></figure>\n<p>启动</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl start ClickHouse-server.service</span><br><span class=\"line\">systemctl enable ClickHouse-server.service</span><br></pre></td></tr></table></figure>\n<p>检测</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@bgdata zookeeper]# ClickHouse-client -h 172.20.1.246 -m</span><br><span class=\"line\">ClickHouse client version 20.3.2.1 (official build).</span><br><span class=\"line\">Connecting to 172.20.1.246:9000 as user default.</span><br><span class=\"line\">Connected to ClickHouse server version 20.3.2 revision 54433.</span><br><span class=\"line\">bgdata.operate.ck-0002 :) select * from system.clusters ;</span><br><span class=\"line\"></span><br><span class=\"line\">SELECT *</span><br><span class=\"line\">FROM system.clusters</span><br><span class=\"line\"></span><br><span class=\"line\">┌─cluster─┬─shard_num─┬─shard_weight─┬─replica_num─┬─host_name────┬─host_address─┬─port─┬─is_local─┬─user────┬─default_database─┬─errors_count─┬─estimated_recovery_time─┐</span><br><span class=\"line\">│ bigdata │         1 │            1 │           1 │ 172.20.1.39  │ 172.20.1.39  │ 9000 │        0 │ default │                  │            0 │                       0 │</span><br><span class=\"line\">│ bigdata │         1 │            1 │           2 │ 172.20.1.246 │ 172.20.1.246 │ 9000 │        1 │ default │                  │            0 │                       0 │</span><br><span class=\"line\">└─────────┴───────────┴──────────────┴─────────────┴──────────────┴──────────────┴──────┴──────────┴─────────┴──────────────────┴──────────────┴─────────────────────────┘</span><br><span class=\"line\"></span><br><span class=\"line\">2 rows in set. Elapsed: 0.001 sec.</span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"测试\"><a href=\"#测试\" class=\"headerlink\" title=\"测试\"></a>测试</h2><p>两台都分别创建数据库 create database test1;<br>一台建表建立数据</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">CREATE TABLE t1 ON CLUSTER bigdata</span><br><span class=\"line\">(</span><br><span class=\"line\">    &#96;ts&#96; DateTime,</span><br><span class=\"line\">    &#96;uid&#96; String,</span><br><span class=\"line\">    &#96;biz&#96; String</span><br><span class=\"line\">)</span><br><span class=\"line\">ENGINE &#x3D; ReplicatedMergeTree(&#39;&#x2F;ClickHouse&#x2F;test1&#x2F;tables&#x2F;&#123;shard&#125;&#x2F;t1&#39;, &#39;&#123;replica&#125;&#39;)</span><br><span class=\"line\">PARTITION BY toYYYYMMDD(ts)</span><br><span class=\"line\">ORDER BY ts</span><br><span class=\"line\">SETTINGS index_granularity &#x3D; 8192</span><br><span class=\"line\">######说明 &#123;shard&#125;自动获取对应配置文件的macros分片设置变量 replica一样  ENGINE &#x3D; ReplicatedMergeTree，不能为之前的MergeTree</span><br><span class=\"line\">######&#39;&#x2F;ClickHouse&#x2F;test1&#x2F;tables&#x2F;&#123;shard&#125;&#x2F;t1&#39; 是写入zk里面的地址，唯一，注意命名规范</span><br><span class=\"line\"></span><br><span class=\"line\">INSERT INTO t1 VALUES (&#39;2019-06-07 20:01:01&#39;, &#39;a&#39;, &#39;show&#39;);</span><br><span class=\"line\">INSERT INTO t1 VALUES (&#39;2019-06-07 20:01:02&#39;, &#39;b&#39;, &#39;show&#39;);</span><br><span class=\"line\">INSERT INTO t1 VALUES (&#39;2019-06-07 20:01:03&#39;, &#39;a&#39;, &#39;click&#39;);</span><br><span class=\"line\">INSERT INTO t1 VALUES (&#39;2019-06-08 20:01:04&#39;, &#39;c&#39;, &#39;show&#39;);</span><br><span class=\"line\">INSERT INTO t1 VALUES (&#39;2019-06-08 20:01:05&#39;, &#39;c&#39;, &#39;click&#39;);</span><br></pre></td></tr></table></figure>\n\n<p>第二台机器查看数据，如果数据查询到了 ，并且一致，则成功，否则需重新检查配置</p>\n<ol start=\"3\">\n<li>总结</li>\n</ol>\n<ul>\n<li>副本集是针对的表，不是库也不上整个ck，所以可以一些表用ReplicatedMergeTree也可以直接不复制，所以数据库都需要创建</li>\n<li>和ES分片和副本机器分布有区别，CK的每台机器只能一个分片的副本，所以如果要搭建2分片2副本需要2*2的机器，不然报错</li>\n<li>测试读写数据的时候发现，新建的表会同步，但是数据没有同步，通过查CK log以及zk里面对应host发现 zk存储的是主机名，不是ip，所以就无法找到主机写入，需要改hosts文件</li>\n<li>测试python ClickHouse_driver连接集群，发现需要高版本的ClickHouse_driver，不然没有alt_hosts参数</li>\n<li>增删数据库每台需要手动执行，增删表需要加上ON CLUSTER bigdata，增删数据是实时异步</li>\n</ul>\n<h4 id=\"python连接ck集群范例\"><a href=\"#python连接ck集群范例\" class=\"headerlink\" title=\"python连接ck集群范例\"></a>python连接ck集群范例</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">from ClickHouse_driver import Client</span><br><span class=\"line\">client &#x3D; Client(&quot;172.20.1.39&quot;,database&#x3D;&quot;test1&quot;,alt_hosts&#x3D;&quot;172.20.1.246&quot;) # 这里alt_hosts代表其他副本机器以,分割，shit源码看到的</span><br><span class=\"line\">print(client.execute(&quot;show tables&quot;))</span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"<p>摘要: ClickHouse分布式集群搭建指南</p>","more":"<h2 id=\"ClickHouse是什么\"><a href=\"#ClickHouse是什么\" class=\"headerlink\" title=\"ClickHouse是什么\"></a>ClickHouse是什么</h2><p>ClickHouse 是 Yandex（俄罗斯最大的搜索引擎）开源的一个用于实时数据分析的基于列存储的数据库，其处理数据的速度比传统方法快 100-1000 倍。ClickHouse 的性能超过了目前市场上可比的面向列的 DBMS，每秒钟每台服务器每秒处理数亿至十亿多行和数十千兆字节的数据。</p>\n<h4 id=\"ClickHouse的一些特性\"><a href=\"#ClickHouse的一些特性\" class=\"headerlink\" title=\"ClickHouse的一些特性\"></a>ClickHouse的一些特性</h4><ul>\n<li>快速：ClickHouse 会充分利用所有可用的硬件，以尽可能快地处理每个查询。单个查询的峰值处理性能超过每秒 2 TB（解压缩后，仅使用的列）。在分布式设置中，读取是在健康副本之间自动平衡的，以避免增加延迟。</li>\n<li>容错：ClickHouse 支持多主机异步复制，并且可以跨多个数据中心进行部署。所有节点都相等，这可以避免出现单点故障。单个节点或整个数据中心的停机时间不会影响系统的读写可用性。</li>\n<li>可伸缩：ClickHouse 可以在垂直和水平方向上很好地缩放。ClickHouse 易于调整以在具有数百或数千个节点的群集上或在单个服务器上，甚至在小型虚拟机上执行。当前，每个单节点安装的数据量超过数万亿行或数百兆兆字节。</li>\n<li>易用：ClickHouse 简单易用，开箱即用。它简化了所有数据处理：将所有结构化数据吸收到系统中，并且立即可用于构建报告。SQL 允许表达期望的结果，而无需涉及某些 DBMS 中可以找到的任何自定义非标准 API。</li>\n<li>充分利用硬件：ClickHouse 与具有相同的可用 I/O 吞吐量和 CPU 容量的传统的面向行的系统相比，其处理典型的分析查询要快两到三个数量级。列式存储格式允许在 RAM 中容纳更多热数据，从而缩短了响应时间。</li>\n<li>提高 CPU 效率：向量化查询执行涉及相关的 SIMD 处理器指令和运行时代码生成。处理列中的数据会提高 CPU 行缓存的命中率。</li>\n<li>优化磁盘访问：ClickHouse 可以最大程度地减少范围查询的次数，从而提高了使用旋转磁盘驱动器的效率，因为它可以保持连续存储数据。最小化数据传输：ClickHouse 使公司无需使用专门针对高性能计算的专用网络即可管理其数据</li>\n</ul>\n<h2 id=\"架构\"><a href=\"#架构\" class=\"headerlink\" title=\"架构\"></a>架构</h2><h4 id=\"服务器\"><a href=\"#服务器\" class=\"headerlink\" title=\"服务器\"></a>服务器</h4><p>centos 7 三台机器（ZooKeeper,clickhouse 高可用）</p>\n<table>\n<thead>\n<tr>\n<th>主机</th>\n<th>IP</th>\n<th>应用</th>\n<th>备注</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>logch01.ztyc.com</td>\n<td>10.200.76.11</td>\n<td>ClickHouse-server<br/> ClickHouse-client<br/> jdk1.8<br/> ZooKeeper</td>\n<td></td>\n</tr>\n<tr>\n<td>logch02.ztyc.com</td>\n<td>10.200.76.12</td>\n<td>ClickHouse-server<br/> ClickHouse-client<br/> jdk1.8<br/> ZooKeeper</td>\n<td></td>\n</tr>\n<tr>\n<td>logch03.ztyc.com</td>\n<td>10.200.76.13</td>\n<td>ClickHouse-server<br/> ClickHouse-client<br/> jdk1.8<br/> ZooKeeper</td>\n<td></td>\n</tr>\n</tbody></table>\n<h4 id=\"host-文件解析\"><a href=\"#host-文件解析\" class=\"headerlink\" title=\"host 文件解析\"></a>host 文件解析</h4><p>设置hosts文件解析（ck同步表数据的时候会去ZooKeeper 里面查询，ZooKeeper 里面存储的是hosts域名，不是IP，不解析会导致可以同步表但是无法同步表数据）,三台操作 vi /etc/hosts</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim &#x2F;etc&#x2F;hosts</span><br><span class=\"line\"></span><br><span class=\"line\">10.200.76.11 logch01.ztyc.com</span><br><span class=\"line\">10.200.76.12 logch02.ztyc.com</span><br><span class=\"line\">10.200.76.13 logch03.ztyc.com</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"部署zk集群\"><a href=\"#部署zk集群\" class=\"headerlink\" title=\"部署zk集群\"></a>部署zk集群</h2><h4 id=\"安装jdk1-8\"><a href=\"#安装jdk1-8\" class=\"headerlink\" title=\"安装jdk1.8\"></a>安装jdk1.8</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#96;&#96;&#96;</span><br><span class=\"line\"></span><br><span class=\"line\">#### 安装zk</span><br></pre></td></tr></table></figure>\n<p>cd /opt/soft<br>wget <a href=\"https://downloads.apache.org/zookeeper/zookeeper-3.6.2/apache-zookeeper-3.6.2.tar.gz\">https://downloads.apache.org/zookeeper/zookeeper-3.6.2/apache-zookeeper-3.6.2.tar.gz</a> &amp;&amp; tar -xf apache-zookeeper-3.6.2.tar.gz<br>ln -s apache-zookeeper-3.6.2 /opt/zookeeper<br>cd /opt/zookeeper<br>cp conf/zoo_sample.cfg conf/zoo.cfg<br>mkdir data</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">修改配置文件 &#96;conf&#x2F;zoocfg&#96; 三台一样</span><br></pre></td></tr></table></figure>\n<p>tickTime=2000<br>initLimit=10<br>syncLimit=5<br>dataDir=/opt/zookeeper/data<br>clientPort=2181<br>server.1=10.200.76.11:2888:3888<br>server.2=10.200.76.12:2888:3888<br>server.3=10.200.76.13:2888:3888</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">创建myid在ZooKeeper 数据目录,三台不一样，对应上面server.1这个数字</span><br></pre></td></tr></table></figure>\n<p>echo 1 &gt; /opt/zookeeper/data/myid  # 其他机器分别是2 3</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">启动并检查</span><br></pre></td></tr></table></figure>\n<p>./bin/zkServer.sh start<br>./bin/zkServer.sh status</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">## 搭建clickhouse集群</span><br><span class=\"line\">一分片一副本集群</span><br><span class=\"line\"></span><br><span class=\"line\">Clickhouse 仅支持Linux 且必须支持SSE4.2 指令集</span><br></pre></td></tr></table></figure>\n<p>grep -q sse4_2 /proc/cpuinfo &amp;&amp; echo “SSE 4.2 supported” || echo “SSE 4.2 not supported”</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#96;&#96;&#96;</span><br><span class=\"line\">SSE 4.2 supported   # 不支持会显示  SSE 4.2 not supported</span><br></pre></td></tr></table></figure>\n<p>如果服务器不支持SSE指令集，则不能直接下载预编译安装包，需要通过源码编译特定版本进行安装</p>\n<h2 id=\"安装依赖\"><a href=\"#安装依赖\" class=\"headerlink\" title=\"安装依赖\"></a>安装依赖</h2><h3 id=\"安装gcc\"><a href=\"#安装gcc\" class=\"headerlink\" title=\"安装gcc\"></a>安装gcc</h3><h4 id=\"安装依赖-1\"><a href=\"#安装依赖-1\" class=\"headerlink\" title=\"安装依赖\"></a>安装依赖</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install git cmake ninja-build libicu-devel clang libicu-devel readline-devel mysql-devel openssl-devel unixODBC_devel bzip2 -y</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"安装高版本-gcc\"><a href=\"#安装高版本-gcc\" class=\"headerlink\" title=\"安装高版本 gcc\"></a>安装高版本 gcc</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget ftp:&#x2F;&#x2F;gnu.mirror.iweb.com&#x2F;gcc&#x2F;gcc-9.3.0&#x2F;gcc-9.3.0.tar.xz</span><br><span class=\"line\"></span><br><span class=\"line\">tar xvf gcc-9.3.0.tar.xz</span><br><span class=\"line\">cd gcc-9.3.0</span><br><span class=\"line\">.&#x2F;contrib&#x2F;download_prerequisites</span><br></pre></td></tr></table></figure>\n<p><strong>生成Makefile文件</strong></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">.&#x2F;configure --prefix&#x3D;&#x2F;usr&#x2F;local -enable-checking&#x3D;release -enable-languages&#x3D;c,c++ -disable-multilib</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p><strong>编译gcc</strong></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">make -j4    #多核电脑可以添加 “-j4” ：make对多核处理器的优化选项，此步骤非常耗时</span><br><span class=\"line\"></span><br><span class=\"line\">ls &#x2F;usr&#x2F;local&#x2F;bin | grep gcc</span><br></pre></td></tr></table></figure>\n\n<p><strong>安装gcc</strong></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">make install</span><br></pre></td></tr></table></figure>\n\n<p><strong>配置gcc</strong></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd ~</span><br><span class=\"line\">find &#x2F;usr&#x2F;local&#x2F;src&#x2F;gcc-9.2.0&#x2F; -name &quot;libstdc++.so*&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">&#x2F;usr&#x2F;local&#x2F;src&#x2F;gcc-9.2.0&#x2F;stage1-x86_64-pc-linux-gnu&#x2F;libstdc++-v3&#x2F;src&#x2F;.libs&#x2F;libstdc++.so.6.0.24</span><br><span class=\"line\">&#x2F;usr&#x2F;local&#x2F;src&#x2F;gcc-9.2.0&#x2F;stage1-x86_64-pc-linux-gnu&#x2F;libstdc++-v3&#x2F;src&#x2F;.libs&#x2F;libstdc++.so.6</span><br><span class=\"line\">&#x2F;usr&#x2F;local&#x2F;src&#x2F;gcc-9.2.0&#x2F;stage1-x86_64-pc-linux-gnu&#x2F;libstdc++-v3&#x2F;src&#x2F;.libs&#x2F;libstdc++.so</span><br><span class=\"line\">&#x2F;usr&#x2F;local&#x2F;src&#x2F;gcc-9.2.0&#x2F;prev-x86_64-pc-linux-gnu&#x2F;libstdc++-v3&#x2F;src&#x2F;.libs&#x2F;libstdc++.so.6.0.24</span><br><span class=\"line\">&#x2F;usr&#x2F;local&#x2F;src&#x2F;gcc-9.2.0&#x2F;prev-x86_64-pc-linux-gnu&#x2F;libstdc++-v3&#x2F;src&#x2F;.libs&#x2F;libstdc++.so.6</span><br><span class=\"line\">&#x2F;usr&#x2F;local&#x2F;src&#x2F;gcc-9.2.0&#x2F;prev-x86_64-pc-linux-gnu&#x2F;libstdc++-v3&#x2F;src&#x2F;.libs&#x2F;libstdc++.so</span><br><span class=\"line\">&#x2F;usr&#x2F;local&#x2F;src&#x2F;gcc-9.2.0&#x2F;x86_64-pc-linux-gnu&#x2F;libstdc++-v3&#x2F;src&#x2F;.libs&#x2F;libstdc++.so.6.0.24</span><br><span class=\"line\">&#x2F;usr&#x2F;local&#x2F;src&#x2F;gcc-9.2.0&#x2F;x86_64-pc-linux-gnu&#x2F;libstdc++-v3&#x2F;src&#x2F;.libs&#x2F;libstdc++.so.6</span><br><span class=\"line\">&#x2F;usr&#x2F;local&#x2F;src&#x2F;gcc-9.2.0&#x2F;x86_64-pc-linux-gnu&#x2F;libstdc++-v3&#x2F;src&#x2F;.libs&#x2F;libstdc++.so</span><br><span class=\"line\"></span><br><span class=\"line\">cd &#x2F;usr&#x2F;lib64</span><br><span class=\"line\">cp &#x2F;usr&#x2F;local&#x2F;src&#x2F;gcc-9.2.0&#x2F;stage1-x86_64-pc-linux-gnu&#x2F;libstdc++-v3&#x2F;src&#x2F;.libs&#x2F;libstdc++.so.6.0.28 .</span><br><span class=\"line\">mv libstdc++.so.6 libstdc++.so.6.old</span><br><span class=\"line\">ln -sv libstdc++.so.6.0.27 libstdc++.so.6</span><br><span class=\"line\">&quot;libstdc++.so.6&quot; -&gt; &quot;libstdc++.so.6.0.28&quot;</span><br></pre></td></tr></table></figure>\n\n\n\n<p>重启系统</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">reboot</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">gcc -v</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n<h3 id=\"安装cmake\"><a href=\"#安装cmake\" class=\"headerlink\" title=\"安装cmake\"></a>安装cmake</h3><h4 id=\"获取\"><a href=\"#获取\" class=\"headerlink\" title=\"获取\"></a>获取</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">https:&#x2F;&#x2F;cmake.org&#x2F;download&#x2F;</span><br><span class=\"line\"></span><br><span class=\"line\">wget https:&#x2F;&#x2F;github.com&#x2F;Kitware&#x2F;CMake&#x2F;releases&#x2F;download&#x2F;v3.20.0&#x2F;cmake-3.20.0.tar.gz</span><br></pre></td></tr></table></figure>\n\n\n<h4 id=\"编译\"><a href=\"#编译\" class=\"headerlink\" title=\"编译\"></a>编译</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd &#x2F;usr&#x2F;local&#x2F;src</span><br><span class=\"line\">tar xf cmake-3.20.0.tar.gz</span><br><span class=\"line\">cd cmake-3.20.0</span><br><span class=\"line\">.&#x2F;configure --prefix&#x3D;&#x2F;usr&#x2F;local&#x2F;cmake</span><br><span class=\"line\">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"软连接\"><a href=\"#软连接\" class=\"headerlink\" title=\"软连接\"></a>软连接</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ln -s &#x2F;usr&#x2F;local&#x2F;cmake&#x2F;bin&#x2F;cmake &#x2F;usr&#x2F;bin&#x2F;cmake</span><br></pre></td></tr></table></figure>\n<h4 id=\"验证\"><a href=\"#验证\" class=\"headerlink\" title=\"验证\"></a>验证</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cmake -version</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cmake version 3.20.0</span><br><span class=\"line\"></span><br><span class=\"line\">CMake suite maintained and supported by Kitware (kitware.com&#x2F;cmake).</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"安装ninja\"><a href=\"#安装ninja\" class=\"headerlink\" title=\"安装ninja\"></a>安装ninja</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget https:&#x2F;&#x2F;github.com&#x2F;ninja-build&#x2F;ninja&#x2F;releases&#x2F;download&#x2F;v1.9.0&#x2F;ninja-linux.zip</span><br><span class=\"line\">unzip ninja-linux.zip -d &#x2F;usr&#x2F;local&#x2F;bin&#x2F;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ninja --version</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"安装clickhouse\"><a href=\"#安装clickhouse\" class=\"headerlink\" title=\"安装clickhouse\"></a>安装clickhouse</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install yum-utils</span><br><span class=\"line\">rpm --import https:&#x2F;&#x2F;repo.yandex.ru&#x2F;ClickHouse&#x2F;ClickHouse-KEY.GPG</span><br><span class=\"line\">yum-config-manager --add-repo https:&#x2F;&#x2F;repo.yandex.ru&#x2F;ClickHouse&#x2F;rpm&#x2F;stable&#x2F;x86_64</span><br><span class=\"line\">yum install ClickHouse-server ClickHouse-client</span><br><span class=\"line\">mkdir &#x2F;opt&#x2F;ClickHouse</span><br><span class=\"line\">chown -R ClickHouse.ClickHouse &#x2F;opt&#x2F;ClickHouse&#x2F;  #修改权限</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"源码安装clickhouse\"><a href=\"#源码安装clickhouse\" class=\"headerlink\" title=\"源码安装clickhouse\"></a>源码安装clickhouse</h3><h4 id=\"源码获取\"><a href=\"#源码获取\" class=\"headerlink\" title=\"源码获取\"></a>源码获取</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git clone --recursive https:&#x2F;&#x2F;github.com&#x2F;ClickHouse&#x2F;ClickHouse</span><br></pre></td></tr></table></figure>\n\n\n<h3 id=\"配置\"><a href=\"#配置\" class=\"headerlink\" title=\"配置\"></a>配置</h3><p>修改vim /etc/ClickHouse-server/config.xml<br>修改 listen_host</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;!-- Listen specified host. use :: (wildcard IPv6 address), if you want to accept connections both with IPv4 and IPv6 from everywhere. --&gt;</span><br><span class=\"line\">    &lt;!-- &lt;listen_host&gt;::&lt;&#x2F;listen_host&gt; --&gt;</span><br><span class=\"line\">    &lt;!-- Same for hosts with disabled ipv6: --&gt;</span><br><span class=\"line\">    &lt;!-- &lt;listen_host&gt;0.0.0.0&lt;&#x2F;listen_host&gt; --&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;!-- Default values - try listen localhost on ipv4 and ipv6: --&gt;</span><br><span class=\"line\">    &lt;!--</span><br><span class=\"line\">    &lt;listen_host&gt;::1&lt;&#x2F;listen_host&gt;</span><br><span class=\"line\">    &lt;listen_host&gt;127.0.0.1&lt;&#x2F;listen_host&gt;</span><br><span class=\"line\">    --&gt;</span><br><span class=\"line\">    &lt;listen_host&gt;0.0.0.0&lt;&#x2F;listen_host&gt; &lt;!-- 新增所有地址可以访问 --&gt;</span><br><span class=\"line\">    &lt;!-- Don&#39;t exit if ipv6 or ipv4 unavailable, but listen_host with this protocol specified --&gt;</span><br><span class=\"line\">    &lt;!-- &lt;listen_try&gt;0&lt;&#x2F;listen_try&gt; --&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;!-- Allow listen on same address:port --&gt;</span><br><span class=\"line\">    &lt;!-- &lt;listen_reuse_port&gt;0&lt;&#x2F;listen_reuse_port&gt; --&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;!-- &lt;listen_backlog&gt;64&lt;&#x2F;listen_backlog&gt; --&gt;</span><br></pre></td></tr></table></figure>\n\n<p>修改存储路径</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;!-- Path to data directory, with trailing slash. --&gt;</span><br><span class=\"line\">    &lt;path&gt;&#x2F;data&#x2F;ClickHouse&#x2F;&lt;&#x2F;path&gt;  &lt;!-- 修改存储路径 --&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;!-- Path to temporary data for processing hard queries. --&gt;</span><br><span class=\"line\">    &lt;tmp_path&gt;&#x2F;data&#x2F;ClickHouse&#x2F;tmp&#x2F;&lt;&#x2F;tmp_path&gt;</span><br></pre></td></tr></table></figure>\n<p>添加集群配置</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;remote_servers&gt;</span><br><span class=\"line\">    &lt;bigdata&gt; &lt;!-- 集群名字，自定义 --&gt;</span><br><span class=\"line\">        &lt;shard&gt; &lt;!-- 定义一个分片 --&gt;</span><br><span class=\"line\">            &lt;!-- Optional. Shard weight when writing data. Default: 1. --&gt;</span><br><span class=\"line\">            &lt;weight&gt;1&lt;&#x2F;weight&gt;</span><br><span class=\"line\">            &lt;!-- Optional. Whether to write data to just one of the replicas. Default: false (write data to all replicas). --&gt;</span><br><span class=\"line\">            &lt;internal_replication&gt;false&lt;&#x2F;internal_replication&gt;</span><br><span class=\"line\">            &lt;replica&gt; &lt;!-- 这个分片的副本存在在哪些机器上 --&gt;</span><br><span class=\"line\">                &lt;host&gt;172.20.1.39&lt;&#x2F;host&gt;</span><br><span class=\"line\">                &lt;port&gt;9000&lt;&#x2F;port&gt;</span><br><span class=\"line\">            &lt;&#x2F;replica&gt;</span><br><span class=\"line\">            &lt;replica&gt;</span><br><span class=\"line\">                &lt;host&gt;172.20.1.246&lt;&#x2F;host&gt;</span><br><span class=\"line\">                &lt;port&gt;9000&lt;&#x2F;port&gt;</span><br><span class=\"line\">            &lt;&#x2F;replica&gt;</span><br><span class=\"line\">        &lt;&#x2F;shard&gt;</span><br><span class=\"line\">      &lt;!--  </span><br><span class=\"line\">        &lt;shard&gt;</span><br><span class=\"line\">            &lt;weight&gt;2&lt;&#x2F;weight&gt;</span><br><span class=\"line\">            &lt;internal_replication&gt;true&lt;&#x2F;internal_replication&gt;</span><br><span class=\"line\">            &lt;replica&gt;</span><br><span class=\"line\">                &lt;host&gt;172.20.1.39&lt;&#x2F;host&gt;</span><br><span class=\"line\">                &lt;port&gt;9000&lt;&#x2F;port&gt;</span><br><span class=\"line\">            &lt;&#x2F;replica&gt;</span><br><span class=\"line\">            &lt;replica&gt;</span><br><span class=\"line\">                &lt;host&gt;172.20.1.246&lt;&#x2F;host&gt;</span><br><span class=\"line\">                &lt;port&gt;9000&lt;&#x2F;port&gt;</span><br><span class=\"line\">            &lt;&#x2F;replica&gt;</span><br><span class=\"line\">        &lt;&#x2F;shard&gt;</span><br><span class=\"line\">        --&gt;</span><br><span class=\"line\">    &lt;&#x2F;bigdata&gt;</span><br><span class=\"line\">&lt;&#x2F;remote_servers&gt;</span><br></pre></td></tr></table></figure>\n\n<p>添加zk 配置</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;!-- ZooKeeper is used to store metadata about replicas, when using Replicated tables.</span><br><span class=\"line\">Optional. If you don&#39;t use replicated tables, you could omit that.</span><br><span class=\"line\"> </span><br><span class=\"line\">See https:&#x2F;&#x2F;clickhouse.yandex&#x2F;docs&#x2F;en&#x2F;table_engines&#x2F;replication&#x2F;</span><br><span class=\"line\">--&gt;</span><br><span class=\"line\"> </span><br><span class=\"line\">&lt;zookeeper incl&#x3D;&quot;zookeeper-servers&quot; optional&#x3D;&quot;true&quot; &#x2F;&gt;</span><br><span class=\"line\">&lt;zookeeper&gt;</span><br><span class=\"line\">    &lt;node index&#x3D;&quot;1&quot;&gt;</span><br><span class=\"line\">        &lt;host&gt;10.200.76.11&lt;&#x2F;host&gt;</span><br><span class=\"line\">        &lt;port&gt;2181&lt;&#x2F;port&gt;</span><br><span class=\"line\">    &lt;&#x2F;node&gt;</span><br><span class=\"line\">    &lt;node index&#x3D;&quot;2&quot;&gt;</span><br><span class=\"line\">        &lt;host&gt;10.200.76.12&lt;&#x2F;host&gt;</span><br><span class=\"line\">        &lt;port&gt;2181&lt;&#x2F;port&gt;</span><br><span class=\"line\">    &lt;&#x2F;node&gt;</span><br><span class=\"line\">    &lt;node index&#x3D;&quot;3&quot;&gt;</span><br><span class=\"line\">        &lt;host&gt;10.200.76.13&lt;&#x2F;host&gt;</span><br><span class=\"line\">        &lt;port&gt;2182&lt;&#x2F;port&gt;</span><br><span class=\"line\">    &lt;&#x2F;node&gt;</span><br><span class=\"line\">&lt;&#x2F;zookeeper&gt;</span><br></pre></td></tr></table></figure>\n\n<p>配置分片macros变量</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;macros incl&#x3D;&quot;macros&quot; optional&#x3D;&quot;true&quot; &#x2F;&gt;</span><br><span class=\"line\">   &lt;!-- 配置分片macros变量，在用client创建表的时候回自动带入 --&gt;</span><br><span class=\"line\">   &lt;macros&gt;</span><br><span class=\"line\">     &lt;shard&gt;1&lt;&#x2F;shard&gt;</span><br><span class=\"line\">     &lt;replica&gt;172.20.1.39&lt;&#x2F;replica&gt; &lt;!-- 这里指定当前集群节点的名字或者IP --&gt;</span><br><span class=\"line\">   &lt;&#x2F;macros&gt;</span><br></pre></td></tr></table></figure>\n<p>启动</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl start ClickHouse-server.service</span><br><span class=\"line\">systemctl enable ClickHouse-server.service</span><br></pre></td></tr></table></figure>\n<p>检测</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@bgdata zookeeper]# ClickHouse-client -h 172.20.1.246 -m</span><br><span class=\"line\">ClickHouse client version 20.3.2.1 (official build).</span><br><span class=\"line\">Connecting to 172.20.1.246:9000 as user default.</span><br><span class=\"line\">Connected to ClickHouse server version 20.3.2 revision 54433.</span><br><span class=\"line\">bgdata.operate.ck-0002 :) select * from system.clusters ;</span><br><span class=\"line\"></span><br><span class=\"line\">SELECT *</span><br><span class=\"line\">FROM system.clusters</span><br><span class=\"line\"></span><br><span class=\"line\">┌─cluster─┬─shard_num─┬─shard_weight─┬─replica_num─┬─host_name────┬─host_address─┬─port─┬─is_local─┬─user────┬─default_database─┬─errors_count─┬─estimated_recovery_time─┐</span><br><span class=\"line\">│ bigdata │         1 │            1 │           1 │ 172.20.1.39  │ 172.20.1.39  │ 9000 │        0 │ default │                  │            0 │                       0 │</span><br><span class=\"line\">│ bigdata │         1 │            1 │           2 │ 172.20.1.246 │ 172.20.1.246 │ 9000 │        1 │ default │                  │            0 │                       0 │</span><br><span class=\"line\">└─────────┴───────────┴──────────────┴─────────────┴──────────────┴──────────────┴──────┴──────────┴─────────┴──────────────────┴──────────────┴─────────────────────────┘</span><br><span class=\"line\"></span><br><span class=\"line\">2 rows in set. Elapsed: 0.001 sec.</span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"测试\"><a href=\"#测试\" class=\"headerlink\" title=\"测试\"></a>测试</h2><p>两台都分别创建数据库 create database test1;<br>一台建表建立数据</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">CREATE TABLE t1 ON CLUSTER bigdata</span><br><span class=\"line\">(</span><br><span class=\"line\">    &#96;ts&#96; DateTime,</span><br><span class=\"line\">    &#96;uid&#96; String,</span><br><span class=\"line\">    &#96;biz&#96; String</span><br><span class=\"line\">)</span><br><span class=\"line\">ENGINE &#x3D; ReplicatedMergeTree(&#39;&#x2F;ClickHouse&#x2F;test1&#x2F;tables&#x2F;&#123;shard&#125;&#x2F;t1&#39;, &#39;&#123;replica&#125;&#39;)</span><br><span class=\"line\">PARTITION BY toYYYYMMDD(ts)</span><br><span class=\"line\">ORDER BY ts</span><br><span class=\"line\">SETTINGS index_granularity &#x3D; 8192</span><br><span class=\"line\">######说明 &#123;shard&#125;自动获取对应配置文件的macros分片设置变量 replica一样  ENGINE &#x3D; ReplicatedMergeTree，不能为之前的MergeTree</span><br><span class=\"line\">######&#39;&#x2F;ClickHouse&#x2F;test1&#x2F;tables&#x2F;&#123;shard&#125;&#x2F;t1&#39; 是写入zk里面的地址，唯一，注意命名规范</span><br><span class=\"line\"></span><br><span class=\"line\">INSERT INTO t1 VALUES (&#39;2019-06-07 20:01:01&#39;, &#39;a&#39;, &#39;show&#39;);</span><br><span class=\"line\">INSERT INTO t1 VALUES (&#39;2019-06-07 20:01:02&#39;, &#39;b&#39;, &#39;show&#39;);</span><br><span class=\"line\">INSERT INTO t1 VALUES (&#39;2019-06-07 20:01:03&#39;, &#39;a&#39;, &#39;click&#39;);</span><br><span class=\"line\">INSERT INTO t1 VALUES (&#39;2019-06-08 20:01:04&#39;, &#39;c&#39;, &#39;show&#39;);</span><br><span class=\"line\">INSERT INTO t1 VALUES (&#39;2019-06-08 20:01:05&#39;, &#39;c&#39;, &#39;click&#39;);</span><br></pre></td></tr></table></figure>\n\n<p>第二台机器查看数据，如果数据查询到了 ，并且一致，则成功，否则需重新检查配置</p>\n<ol start=\"3\">\n<li>总结</li>\n</ol>\n<ul>\n<li>副本集是针对的表，不是库也不上整个ck，所以可以一些表用ReplicatedMergeTree也可以直接不复制，所以数据库都需要创建</li>\n<li>和ES分片和副本机器分布有区别，CK的每台机器只能一个分片的副本，所以如果要搭建2分片2副本需要2*2的机器，不然报错</li>\n<li>测试读写数据的时候发现，新建的表会同步，但是数据没有同步，通过查CK log以及zk里面对应host发现 zk存储的是主机名，不是ip，所以就无法找到主机写入，需要改hosts文件</li>\n<li>测试python ClickHouse_driver连接集群，发现需要高版本的ClickHouse_driver，不然没有alt_hosts参数</li>\n<li>增删数据库每台需要手动执行，增删表需要加上ON CLUSTER bigdata，增删数据是实时异步</li>\n</ul>\n<h4 id=\"python连接ck集群范例\"><a href=\"#python连接ck集群范例\" class=\"headerlink\" title=\"python连接ck集群范例\"></a>python连接ck集群范例</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">from ClickHouse_driver import Client</span><br><span class=\"line\">client &#x3D; Client(&quot;172.20.1.39&quot;,database&#x3D;&quot;test1&quot;,alt_hosts&#x3D;&quot;172.20.1.246&quot;) # 这里alt_hosts代表其他副本机器以,分割，shit源码看到的</span><br><span class=\"line\">print(client.execute(&quot;show tables&quot;))</span><br></pre></td></tr></table></figure>"},{"title":"filebeat使用案例","date":"2021-07-05T07:03:00.000Z","_content":"\t\n\t\n摘要: filebeat 使用案例\n<!-- more -->\n\n\n## 项目有个需求：filebeat(v7.7)采集日志的时间替换为日志时间。通过调研，网上都是通过logstash来转换的\n```\nfilter{\n \n  grok{\n     // 1 取出时间值 给 一个新字段\n     patterns_dir => \"./patterns\"\n     match => { \"message\" => [\"%{IP:source_Ip},%{NUMBER:source_Port},%{IP:dest_Ip},%{NUMBER:dest_Port},%{MYPATTERN:create_Time}\"]}\n  }\n  date {\n      // 2 只要时间字段匹配这个格式 就赋值给@timestamp。\n     match => [ \"create_Time\", \"yyyy-MM-dd HH:mm:ss:ssssss\" ]\n     target => \"@timestamp\"\n  }\n}\n```\nfilebeat原生支持\n全局阅览filebeat官网，终于在processor配置里找到了方法。主要是使用script 、timestamp 这两个属性。\n```\nscript 作用是提取log里的时间值，并赋值给一个字段\ntimestamp作用是把一个字段值格式化为时间戳。这样采集时间戳就替换成了log里的时间。\n```\n\n例如 我的日志长这样\n```\n2020-08-05 16:21:51.824 [第10行 虚拟]\n```\n\n添加下面配置\n```\nprocessors:\n  ...\n  - script:\n      lang: javascript\n      id: my_filter\n      tag: enable\n      source: >\n        function process(event) {\n            var str= event.Get(\"message\");\n            var time =str.split(\" \").slice(0,2).join(\" \");\n            event.Put(\"start_time\",time);\n        }\n \n  - timestamp:\n      # 格式化时间值 给 时间戳 \n      field: start_time\n      # 使用我国东八区时间  解析log时间\n      timezone: Asia/Shanghai\n      layouts:\n        - '2006-01-02 15:04:05'\n        - '2006-01-02 15:04:05.999'\n      test:\n        - '2019-06-22 16:33:51'\n```\n\n输出结果为\n```\n{\n  \"@timestamp\": \"2020-08-05T08:21:51.824Z\",\n  \"@metadata\": {\n    \"beat\": \"filebeat\",\n    \"type\": \"_doc\",\n    \"version\": \"7.7.0\"\n  },\n  \"message\": \"2020-08-05 16:21:51.824 [第10行 虚拟]\",\n  \"ecs\": {\n    \"version\": \"1.5.0\"\n  }\n}\n```\n\n附测试时完整配置：\n```\nfilebeat.inputs:\n  - type: log\n    enabled: true\n    paths:\n      - /etc/test/1.log\n    reload.enabled: true\n    reload.period: 10s\n# 这里直接打印出来（测试使用）    \noutput.console:\n  pretty: true\nprocessors:\n  - script:\n      lang: javascript\n      id: my_filter\n      tag: enable\n      source: >\n        function process(event) {\n            var str= event.Get(\"message\");\n            var time =str.split(\" \").slice(0,2).join(\" \");\n            event.Put(\"start_time\",time);\n        }\n  - timestamp:\n      field: start_time\n      timezone: Asia/Shanghai\n      layouts:\n        - '2006-01-02 15:04:05'\n        - '2006-01-02 15:04:05.999'\n      test:\n        - '2019-06-22 16:33:51'\n```\n\n本文中timezone说明\n很多朋友问到timezone的问题，我这里详细描述下。\n\n@timestamp 这个字段 系统自带的，默认时间就是采集log的UTC时间 。例如 现在时间是2020-12-30 18:59:58.234 ，那么他的值为2020-12-30T10:59:58.234Z\n\n现在我们手动替换@timestamp为日志时间（东八区），需要将时间字符串解析成UTC时间，赋值给@timestamp，那么我们必须显示的指定timezone 信息。\n\n指定timezone后的表现\n\nlog时间字符串：2020-08-05 16:21:51.824\n重新赋值的@timestamp值： 2020-08-05T08:17:11.535Z （正确）\n未指定timezone后的表现\n\nlog时间字符串：2020-08-05 16:21:51.824\n重新赋值的@timestamp值： 2020-08-05T16:17:11.535Z （默认使用了UTC零时区解析）\n\n\n\n## filebeat收集多日志并自定义索引\nfilebeat6.x\n```\n#-------------------------- Elasticsearch output ------------------------------\n\noutput.elasticsearch:\n  # Array of hosts to connect to.\n  hosts: [\"192.168.31.234:9200\"]\n  index: \"nginx-%{[beat.version]}-%{+yyyy.MM}\"\nsetup.template.name: \"nginx_web\"\nsetup.template.pattern: \"nginx_web-\"\nsetup.template.enabled: false$\nsetup.template.overwrite: true$\n```\n\nfilebeat7.x\n```\noutput.elasticsearch:\n  hosts: [\"https://localhost:9200\"]\n  index: \"filebeat-%{[agent.version]}-%{+yyyy.MM.dd}\"\nsetup.template.name: \"nginx_web\"\nsetup.template.pattern: \"nginx_web-\"\nsetup.template.enabled: false$\nsetup.template.overwrite: true$\n```\n\n\n## filebeat7.7直接给es传输日志，自定义索引名\n\nElasticStack从2019年1月29日的6.6.0版本的开始，引入了索引生命周期管理的功能，新版本的Filebeat则默认的配置开启了ILM，导致索引的命名规则被ILM策略控制。\n加上这个配置就好了：\n\nfilebeat 配置关闭 ILM 即可解决Index Pattern不生效的问题\n```\nsetup.ilm.enabled: false\n```\n\n具体配置：\n```\n#==================== Elasticsearch template setting ==========================\nsetup.ilm.enabled: false\nsetup.template.name: \"filebeat-127\"\nsetup.template.pattern: \"filebeat-127-*\"\n\nsetup.template.settings:\n  index.number_of_shards: 1\n  index.number_of_replicas: 0\n  index.codec: best_compression \n#-------------------------- Elasticsearch output ------------------------------\noutput.elasticsearch:\n  hosts: [\"127.0.0.1:9200\"]\n  index: \"filebeat-127-%{+yyyy.MM.dd}\"\n\n  username: \"elastic\"\n  password: \"xxxxxxxxxxx\"\n```  \n\n\n\n## filebeat 输出到不同的es index \n```\noutput.elasticsearch:\n  # Array of hosts to connect to.\n  hosts: [\"10.4.144.173:9200\"]\n  indices:\n    - index: \"oom_-java-%{+yyyy.MM.dd}\"\n      when.contains:\n        fields:\n          index: 'oom-java'\n\n    - index: \"oom-oms-java-%{+yyyy.MM.dd}\"\n      when.contains:\n        fields:\n          index: 'oom-oms-java'\n\n  username: \"elastic\"\n  password: \"${ES_PWD}\"\n```","source":"_posts/elk/filebeat案例.md","raw":"---\ntitle: filebeat使用案例\ndate: 2021-07-05 15:03\ncategories:\n- elk\ntags:\n- filebeat\n- elk\n---\n\t\n\t\n摘要: filebeat 使用案例\n<!-- more -->\n\n\n## 项目有个需求：filebeat(v7.7)采集日志的时间替换为日志时间。通过调研，网上都是通过logstash来转换的\n```\nfilter{\n \n  grok{\n     // 1 取出时间值 给 一个新字段\n     patterns_dir => \"./patterns\"\n     match => { \"message\" => [\"%{IP:source_Ip},%{NUMBER:source_Port},%{IP:dest_Ip},%{NUMBER:dest_Port},%{MYPATTERN:create_Time}\"]}\n  }\n  date {\n      // 2 只要时间字段匹配这个格式 就赋值给@timestamp。\n     match => [ \"create_Time\", \"yyyy-MM-dd HH:mm:ss:ssssss\" ]\n     target => \"@timestamp\"\n  }\n}\n```\nfilebeat原生支持\n全局阅览filebeat官网，终于在processor配置里找到了方法。主要是使用script 、timestamp 这两个属性。\n```\nscript 作用是提取log里的时间值，并赋值给一个字段\ntimestamp作用是把一个字段值格式化为时间戳。这样采集时间戳就替换成了log里的时间。\n```\n\n例如 我的日志长这样\n```\n2020-08-05 16:21:51.824 [第10行 虚拟]\n```\n\n添加下面配置\n```\nprocessors:\n  ...\n  - script:\n      lang: javascript\n      id: my_filter\n      tag: enable\n      source: >\n        function process(event) {\n            var str= event.Get(\"message\");\n            var time =str.split(\" \").slice(0,2).join(\" \");\n            event.Put(\"start_time\",time);\n        }\n \n  - timestamp:\n      # 格式化时间值 给 时间戳 \n      field: start_time\n      # 使用我国东八区时间  解析log时间\n      timezone: Asia/Shanghai\n      layouts:\n        - '2006-01-02 15:04:05'\n        - '2006-01-02 15:04:05.999'\n      test:\n        - '2019-06-22 16:33:51'\n```\n\n输出结果为\n```\n{\n  \"@timestamp\": \"2020-08-05T08:21:51.824Z\",\n  \"@metadata\": {\n    \"beat\": \"filebeat\",\n    \"type\": \"_doc\",\n    \"version\": \"7.7.0\"\n  },\n  \"message\": \"2020-08-05 16:21:51.824 [第10行 虚拟]\",\n  \"ecs\": {\n    \"version\": \"1.5.0\"\n  }\n}\n```\n\n附测试时完整配置：\n```\nfilebeat.inputs:\n  - type: log\n    enabled: true\n    paths:\n      - /etc/test/1.log\n    reload.enabled: true\n    reload.period: 10s\n# 这里直接打印出来（测试使用）    \noutput.console:\n  pretty: true\nprocessors:\n  - script:\n      lang: javascript\n      id: my_filter\n      tag: enable\n      source: >\n        function process(event) {\n            var str= event.Get(\"message\");\n            var time =str.split(\" \").slice(0,2).join(\" \");\n            event.Put(\"start_time\",time);\n        }\n  - timestamp:\n      field: start_time\n      timezone: Asia/Shanghai\n      layouts:\n        - '2006-01-02 15:04:05'\n        - '2006-01-02 15:04:05.999'\n      test:\n        - '2019-06-22 16:33:51'\n```\n\n本文中timezone说明\n很多朋友问到timezone的问题，我这里详细描述下。\n\n@timestamp 这个字段 系统自带的，默认时间就是采集log的UTC时间 。例如 现在时间是2020-12-30 18:59:58.234 ，那么他的值为2020-12-30T10:59:58.234Z\n\n现在我们手动替换@timestamp为日志时间（东八区），需要将时间字符串解析成UTC时间，赋值给@timestamp，那么我们必须显示的指定timezone 信息。\n\n指定timezone后的表现\n\nlog时间字符串：2020-08-05 16:21:51.824\n重新赋值的@timestamp值： 2020-08-05T08:17:11.535Z （正确）\n未指定timezone后的表现\n\nlog时间字符串：2020-08-05 16:21:51.824\n重新赋值的@timestamp值： 2020-08-05T16:17:11.535Z （默认使用了UTC零时区解析）\n\n\n\n## filebeat收集多日志并自定义索引\nfilebeat6.x\n```\n#-------------------------- Elasticsearch output ------------------------------\n\noutput.elasticsearch:\n  # Array of hosts to connect to.\n  hosts: [\"192.168.31.234:9200\"]\n  index: \"nginx-%{[beat.version]}-%{+yyyy.MM}\"\nsetup.template.name: \"nginx_web\"\nsetup.template.pattern: \"nginx_web-\"\nsetup.template.enabled: false$\nsetup.template.overwrite: true$\n```\n\nfilebeat7.x\n```\noutput.elasticsearch:\n  hosts: [\"https://localhost:9200\"]\n  index: \"filebeat-%{[agent.version]}-%{+yyyy.MM.dd}\"\nsetup.template.name: \"nginx_web\"\nsetup.template.pattern: \"nginx_web-\"\nsetup.template.enabled: false$\nsetup.template.overwrite: true$\n```\n\n\n## filebeat7.7直接给es传输日志，自定义索引名\n\nElasticStack从2019年1月29日的6.6.0版本的开始，引入了索引生命周期管理的功能，新版本的Filebeat则默认的配置开启了ILM，导致索引的命名规则被ILM策略控制。\n加上这个配置就好了：\n\nfilebeat 配置关闭 ILM 即可解决Index Pattern不生效的问题\n```\nsetup.ilm.enabled: false\n```\n\n具体配置：\n```\n#==================== Elasticsearch template setting ==========================\nsetup.ilm.enabled: false\nsetup.template.name: \"filebeat-127\"\nsetup.template.pattern: \"filebeat-127-*\"\n\nsetup.template.settings:\n  index.number_of_shards: 1\n  index.number_of_replicas: 0\n  index.codec: best_compression \n#-------------------------- Elasticsearch output ------------------------------\noutput.elasticsearch:\n  hosts: [\"127.0.0.1:9200\"]\n  index: \"filebeat-127-%{+yyyy.MM.dd}\"\n\n  username: \"elastic\"\n  password: \"xxxxxxxxxxx\"\n```  \n\n\n\n## filebeat 输出到不同的es index \n```\noutput.elasticsearch:\n  # Array of hosts to connect to.\n  hosts: [\"10.4.144.173:9200\"]\n  indices:\n    - index: \"oom_-java-%{+yyyy.MM.dd}\"\n      when.contains:\n        fields:\n          index: 'oom-java'\n\n    - index: \"oom-oms-java-%{+yyyy.MM.dd}\"\n      when.contains:\n        fields:\n          index: 'oom-oms-java'\n\n  username: \"elastic\"\n  password: \"${ES_PWD}\"\n```","slug":"elk/filebeat案例","published":1,"updated":"2021-07-05T09:31:52.816Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cku6979yx002b00uh2vv41ywg","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><p>摘要: filebeat 使用案例</p>\n<span id=\"more\"></span>\n\n\n<h2 id=\"项目有个需求：filebeat-v7-7-采集日志的时间替换为日志时间。通过调研，网上都是通过logstash来转换的\"><a href=\"#项目有个需求：filebeat-v7-7-采集日志的时间替换为日志时间。通过调研，网上都是通过logstash来转换的\" class=\"headerlink\" title=\"项目有个需求：filebeat(v7.7)采集日志的时间替换为日志时间。通过调研，网上都是通过logstash来转换的\"></a>项目有个需求：filebeat(v7.7)采集日志的时间替换为日志时间。通过调研，网上都是通过logstash来转换的</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">filter&#123;</span><br><span class=\"line\"> </span><br><span class=\"line\">  grok&#123;</span><br><span class=\"line\">     &#x2F;&#x2F; 1 取出时间值 给 一个新字段</span><br><span class=\"line\">     patterns_dir &#x3D;&gt; &quot;.&#x2F;patterns&quot;</span><br><span class=\"line\">     match &#x3D;&gt; &#123; &quot;message&quot; &#x3D;&gt; [&quot;%&#123;IP:source_Ip&#125;,%&#123;NUMBER:source_Port&#125;,%&#123;IP:dest_Ip&#125;,%&#123;NUMBER:dest_Port&#125;,%&#123;MYPATTERN:create_Time&#125;&quot;]&#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  date &#123;</span><br><span class=\"line\">      &#x2F;&#x2F; 2 只要时间字段匹配这个格式 就赋值给@timestamp。</span><br><span class=\"line\">     match &#x3D;&gt; [ &quot;create_Time&quot;, &quot;yyyy-MM-dd HH:mm:ss:ssssss&quot; ]</span><br><span class=\"line\">     target &#x3D;&gt; &quot;@timestamp&quot;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>filebeat原生支持<br>全局阅览filebeat官网，终于在processor配置里找到了方法。主要是使用script 、timestamp 这两个属性。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">script 作用是提取log里的时间值，并赋值给一个字段</span><br><span class=\"line\">timestamp作用是把一个字段值格式化为时间戳。这样采集时间戳就替换成了log里的时间。</span><br></pre></td></tr></table></figure>\n\n<p>例如 我的日志长这样</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">2020-08-05 16:21:51.824 [第10行 虚拟]</span><br></pre></td></tr></table></figure>\n\n<p>添加下面配置</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">processors:</span><br><span class=\"line\">  ...</span><br><span class=\"line\">  - script:</span><br><span class=\"line\">      lang: javascript</span><br><span class=\"line\">      id: my_filter</span><br><span class=\"line\">      tag: enable</span><br><span class=\"line\">      source: &gt;</span><br><span class=\"line\">        function process(event) &#123;</span><br><span class=\"line\">            var str&#x3D; event.Get(&quot;message&quot;);</span><br><span class=\"line\">            var time &#x3D;str.split(&quot; &quot;).slice(0,2).join(&quot; &quot;);</span><br><span class=\"line\">            event.Put(&quot;start_time&quot;,time);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">  - timestamp:</span><br><span class=\"line\">      # 格式化时间值 给 时间戳 </span><br><span class=\"line\">      field: start_time</span><br><span class=\"line\">      # 使用我国东八区时间  解析log时间</span><br><span class=\"line\">      timezone: Asia&#x2F;Shanghai</span><br><span class=\"line\">      layouts:</span><br><span class=\"line\">        - &#39;2006-01-02 15:04:05&#39;</span><br><span class=\"line\">        - &#39;2006-01-02 15:04:05.999&#39;</span><br><span class=\"line\">      test:</span><br><span class=\"line\">        - &#39;2019-06-22 16:33:51&#39;</span><br></pre></td></tr></table></figure>\n\n<p>输出结果为</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  &quot;@timestamp&quot;: &quot;2020-08-05T08:21:51.824Z&quot;,</span><br><span class=\"line\">  &quot;@metadata&quot;: &#123;</span><br><span class=\"line\">    &quot;beat&quot;: &quot;filebeat&quot;,</span><br><span class=\"line\">    &quot;type&quot;: &quot;_doc&quot;,</span><br><span class=\"line\">    &quot;version&quot;: &quot;7.7.0&quot;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &quot;message&quot;: &quot;2020-08-05 16:21:51.824 [第10行 虚拟]&quot;,</span><br><span class=\"line\">  &quot;ecs&quot;: &#123;</span><br><span class=\"line\">    &quot;version&quot;: &quot;1.5.0&quot;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>附测试时完整配置：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">filebeat.inputs:</span><br><span class=\"line\">  - type: log</span><br><span class=\"line\">    enabled: true</span><br><span class=\"line\">    paths:</span><br><span class=\"line\">      - &#x2F;etc&#x2F;test&#x2F;1.log</span><br><span class=\"line\">    reload.enabled: true</span><br><span class=\"line\">    reload.period: 10s</span><br><span class=\"line\"># 这里直接打印出来（测试使用）    </span><br><span class=\"line\">output.console:</span><br><span class=\"line\">  pretty: true</span><br><span class=\"line\">processors:</span><br><span class=\"line\">  - script:</span><br><span class=\"line\">      lang: javascript</span><br><span class=\"line\">      id: my_filter</span><br><span class=\"line\">      tag: enable</span><br><span class=\"line\">      source: &gt;</span><br><span class=\"line\">        function process(event) &#123;</span><br><span class=\"line\">            var str&#x3D; event.Get(&quot;message&quot;);</span><br><span class=\"line\">            var time &#x3D;str.split(&quot; &quot;).slice(0,2).join(&quot; &quot;);</span><br><span class=\"line\">            event.Put(&quot;start_time&quot;,time);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">  - timestamp:</span><br><span class=\"line\">      field: start_time</span><br><span class=\"line\">      timezone: Asia&#x2F;Shanghai</span><br><span class=\"line\">      layouts:</span><br><span class=\"line\">        - &#39;2006-01-02 15:04:05&#39;</span><br><span class=\"line\">        - &#39;2006-01-02 15:04:05.999&#39;</span><br><span class=\"line\">      test:</span><br><span class=\"line\">        - &#39;2019-06-22 16:33:51&#39;</span><br></pre></td></tr></table></figure>\n\n<p>本文中timezone说明<br>很多朋友问到timezone的问题，我这里详细描述下。</p>\n<p>@timestamp 这个字段 系统自带的，默认时间就是采集log的UTC时间 。例如 现在时间是2020-12-30 18:59:58.234 ，那么他的值为2020-12-30T10:59:58.234Z</p>\n<p>现在我们手动替换@timestamp为日志时间（东八区），需要将时间字符串解析成UTC时间，赋值给@timestamp，那么我们必须显示的指定timezone 信息。</p>\n<p>指定timezone后的表现</p>\n<p>log时间字符串：2020-08-05 16:21:51.824<br>重新赋值的@timestamp值： 2020-08-05T08:17:11.535Z （正确）<br>未指定timezone后的表现</p>\n<p>log时间字符串：2020-08-05 16:21:51.824<br>重新赋值的@timestamp值： 2020-08-05T16:17:11.535Z （默认使用了UTC零时区解析）</p>\n<h2 id=\"filebeat收集多日志并自定义索引\"><a href=\"#filebeat收集多日志并自定义索引\" class=\"headerlink\" title=\"filebeat收集多日志并自定义索引\"></a>filebeat收集多日志并自定义索引</h2><p>filebeat6.x</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#-------------------------- Elasticsearch output ------------------------------</span><br><span class=\"line\"></span><br><span class=\"line\">output.elasticsearch:</span><br><span class=\"line\">  # Array of hosts to connect to.</span><br><span class=\"line\">  hosts: [&quot;192.168.31.234:9200&quot;]</span><br><span class=\"line\">  index: &quot;nginx-%&#123;[beat.version]&#125;-%&#123;+yyyy.MM&#125;&quot;</span><br><span class=\"line\">setup.template.name: &quot;nginx_web&quot;</span><br><span class=\"line\">setup.template.pattern: &quot;nginx_web-&quot;</span><br><span class=\"line\">setup.template.enabled: false$</span><br><span class=\"line\">setup.template.overwrite: true$</span><br></pre></td></tr></table></figure>\n\n<p>filebeat7.x</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">output.elasticsearch:</span><br><span class=\"line\">  hosts: [&quot;https:&#x2F;&#x2F;localhost:9200&quot;]</span><br><span class=\"line\">  index: &quot;filebeat-%&#123;[agent.version]&#125;-%&#123;+yyyy.MM.dd&#125;&quot;</span><br><span class=\"line\">setup.template.name: &quot;nginx_web&quot;</span><br><span class=\"line\">setup.template.pattern: &quot;nginx_web-&quot;</span><br><span class=\"line\">setup.template.enabled: false$</span><br><span class=\"line\">setup.template.overwrite: true$</span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"filebeat7-7直接给es传输日志，自定义索引名\"><a href=\"#filebeat7-7直接给es传输日志，自定义索引名\" class=\"headerlink\" title=\"filebeat7.7直接给es传输日志，自定义索引名\"></a>filebeat7.7直接给es传输日志，自定义索引名</h2><p>ElasticStack从2019年1月29日的6.6.0版本的开始，引入了索引生命周期管理的功能，新版本的Filebeat则默认的配置开启了ILM，导致索引的命名规则被ILM策略控制。<br>加上这个配置就好了：</p>\n<p>filebeat 配置关闭 ILM 即可解决Index Pattern不生效的问题</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">setup.ilm.enabled: false</span><br></pre></td></tr></table></figure>\n\n<p>具体配置：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; Elasticsearch template setting &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class=\"line\">setup.ilm.enabled: false</span><br><span class=\"line\">setup.template.name: &quot;filebeat-127&quot;</span><br><span class=\"line\">setup.template.pattern: &quot;filebeat-127-*&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">setup.template.settings:</span><br><span class=\"line\">  index.number_of_shards: 1</span><br><span class=\"line\">  index.number_of_replicas: 0</span><br><span class=\"line\">  index.codec: best_compression </span><br><span class=\"line\">#-------------------------- Elasticsearch output ------------------------------</span><br><span class=\"line\">output.elasticsearch:</span><br><span class=\"line\">  hosts: [&quot;127.0.0.1:9200&quot;]</span><br><span class=\"line\">  index: &quot;filebeat-127-%&#123;+yyyy.MM.dd&#125;&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">  username: &quot;elastic&quot;</span><br><span class=\"line\">  password: &quot;xxxxxxxxxxx&quot;</span><br><span class=\"line\">&#96;&#96;&#96;  </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">## filebeat 输出到不同的es index </span><br></pre></td></tr></table></figure>\n<p>output.elasticsearch:</p>\n<h1 id=\"Array-of-hosts-to-connect-to\"><a href=\"#Array-of-hosts-to-connect-to\" class=\"headerlink\" title=\"Array of hosts to connect to.\"></a>Array of hosts to connect to.</h1><p>  hosts: [“10.4.144.173:9200”]<br>  indices:<br>    - index: “oom_-java-%{+yyyy.MM.dd}”<br>      when.contains:<br>        fields:<br>          index: ‘oom-java’</p>\n<pre><code>- index: &quot;oom-oms-java-%&#123;+yyyy.MM.dd&#125;&quot;\n  when.contains:\n    fields:\n      index: &#39;oom-oms-java&#39;\n</code></pre>\n<p>  username: “elastic”<br>  password: “${ES_PWD}”<br>```</p>\n","site":{"data":{}},"excerpt":"<p>摘要: filebeat 使用案例</p>","more":"<h2 id=\"项目有个需求：filebeat-v7-7-采集日志的时间替换为日志时间。通过调研，网上都是通过logstash来转换的\"><a href=\"#项目有个需求：filebeat-v7-7-采集日志的时间替换为日志时间。通过调研，网上都是通过logstash来转换的\" class=\"headerlink\" title=\"项目有个需求：filebeat(v7.7)采集日志的时间替换为日志时间。通过调研，网上都是通过logstash来转换的\"></a>项目有个需求：filebeat(v7.7)采集日志的时间替换为日志时间。通过调研，网上都是通过logstash来转换的</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">filter&#123;</span><br><span class=\"line\"> </span><br><span class=\"line\">  grok&#123;</span><br><span class=\"line\">     &#x2F;&#x2F; 1 取出时间值 给 一个新字段</span><br><span class=\"line\">     patterns_dir &#x3D;&gt; &quot;.&#x2F;patterns&quot;</span><br><span class=\"line\">     match &#x3D;&gt; &#123; &quot;message&quot; &#x3D;&gt; [&quot;%&#123;IP:source_Ip&#125;,%&#123;NUMBER:source_Port&#125;,%&#123;IP:dest_Ip&#125;,%&#123;NUMBER:dest_Port&#125;,%&#123;MYPATTERN:create_Time&#125;&quot;]&#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  date &#123;</span><br><span class=\"line\">      &#x2F;&#x2F; 2 只要时间字段匹配这个格式 就赋值给@timestamp。</span><br><span class=\"line\">     match &#x3D;&gt; [ &quot;create_Time&quot;, &quot;yyyy-MM-dd HH:mm:ss:ssssss&quot; ]</span><br><span class=\"line\">     target &#x3D;&gt; &quot;@timestamp&quot;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>filebeat原生支持<br>全局阅览filebeat官网，终于在processor配置里找到了方法。主要是使用script 、timestamp 这两个属性。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">script 作用是提取log里的时间值，并赋值给一个字段</span><br><span class=\"line\">timestamp作用是把一个字段值格式化为时间戳。这样采集时间戳就替换成了log里的时间。</span><br></pre></td></tr></table></figure>\n\n<p>例如 我的日志长这样</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">2020-08-05 16:21:51.824 [第10行 虚拟]</span><br></pre></td></tr></table></figure>\n\n<p>添加下面配置</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">processors:</span><br><span class=\"line\">  ...</span><br><span class=\"line\">  - script:</span><br><span class=\"line\">      lang: javascript</span><br><span class=\"line\">      id: my_filter</span><br><span class=\"line\">      tag: enable</span><br><span class=\"line\">      source: &gt;</span><br><span class=\"line\">        function process(event) &#123;</span><br><span class=\"line\">            var str&#x3D; event.Get(&quot;message&quot;);</span><br><span class=\"line\">            var time &#x3D;str.split(&quot; &quot;).slice(0,2).join(&quot; &quot;);</span><br><span class=\"line\">            event.Put(&quot;start_time&quot;,time);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">  - timestamp:</span><br><span class=\"line\">      # 格式化时间值 给 时间戳 </span><br><span class=\"line\">      field: start_time</span><br><span class=\"line\">      # 使用我国东八区时间  解析log时间</span><br><span class=\"line\">      timezone: Asia&#x2F;Shanghai</span><br><span class=\"line\">      layouts:</span><br><span class=\"line\">        - &#39;2006-01-02 15:04:05&#39;</span><br><span class=\"line\">        - &#39;2006-01-02 15:04:05.999&#39;</span><br><span class=\"line\">      test:</span><br><span class=\"line\">        - &#39;2019-06-22 16:33:51&#39;</span><br></pre></td></tr></table></figure>\n\n<p>输出结果为</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  &quot;@timestamp&quot;: &quot;2020-08-05T08:21:51.824Z&quot;,</span><br><span class=\"line\">  &quot;@metadata&quot;: &#123;</span><br><span class=\"line\">    &quot;beat&quot;: &quot;filebeat&quot;,</span><br><span class=\"line\">    &quot;type&quot;: &quot;_doc&quot;,</span><br><span class=\"line\">    &quot;version&quot;: &quot;7.7.0&quot;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &quot;message&quot;: &quot;2020-08-05 16:21:51.824 [第10行 虚拟]&quot;,</span><br><span class=\"line\">  &quot;ecs&quot;: &#123;</span><br><span class=\"line\">    &quot;version&quot;: &quot;1.5.0&quot;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>附测试时完整配置：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">filebeat.inputs:</span><br><span class=\"line\">  - type: log</span><br><span class=\"line\">    enabled: true</span><br><span class=\"line\">    paths:</span><br><span class=\"line\">      - &#x2F;etc&#x2F;test&#x2F;1.log</span><br><span class=\"line\">    reload.enabled: true</span><br><span class=\"line\">    reload.period: 10s</span><br><span class=\"line\"># 这里直接打印出来（测试使用）    </span><br><span class=\"line\">output.console:</span><br><span class=\"line\">  pretty: true</span><br><span class=\"line\">processors:</span><br><span class=\"line\">  - script:</span><br><span class=\"line\">      lang: javascript</span><br><span class=\"line\">      id: my_filter</span><br><span class=\"line\">      tag: enable</span><br><span class=\"line\">      source: &gt;</span><br><span class=\"line\">        function process(event) &#123;</span><br><span class=\"line\">            var str&#x3D; event.Get(&quot;message&quot;);</span><br><span class=\"line\">            var time &#x3D;str.split(&quot; &quot;).slice(0,2).join(&quot; &quot;);</span><br><span class=\"line\">            event.Put(&quot;start_time&quot;,time);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">  - timestamp:</span><br><span class=\"line\">      field: start_time</span><br><span class=\"line\">      timezone: Asia&#x2F;Shanghai</span><br><span class=\"line\">      layouts:</span><br><span class=\"line\">        - &#39;2006-01-02 15:04:05&#39;</span><br><span class=\"line\">        - &#39;2006-01-02 15:04:05.999&#39;</span><br><span class=\"line\">      test:</span><br><span class=\"line\">        - &#39;2019-06-22 16:33:51&#39;</span><br></pre></td></tr></table></figure>\n\n<p>本文中timezone说明<br>很多朋友问到timezone的问题，我这里详细描述下。</p>\n<p>@timestamp 这个字段 系统自带的，默认时间就是采集log的UTC时间 。例如 现在时间是2020-12-30 18:59:58.234 ，那么他的值为2020-12-30T10:59:58.234Z</p>\n<p>现在我们手动替换@timestamp为日志时间（东八区），需要将时间字符串解析成UTC时间，赋值给@timestamp，那么我们必须显示的指定timezone 信息。</p>\n<p>指定timezone后的表现</p>\n<p>log时间字符串：2020-08-05 16:21:51.824<br>重新赋值的@timestamp值： 2020-08-05T08:17:11.535Z （正确）<br>未指定timezone后的表现</p>\n<p>log时间字符串：2020-08-05 16:21:51.824<br>重新赋值的@timestamp值： 2020-08-05T16:17:11.535Z （默认使用了UTC零时区解析）</p>\n<h2 id=\"filebeat收集多日志并自定义索引\"><a href=\"#filebeat收集多日志并自定义索引\" class=\"headerlink\" title=\"filebeat收集多日志并自定义索引\"></a>filebeat收集多日志并自定义索引</h2><p>filebeat6.x</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#-------------------------- Elasticsearch output ------------------------------</span><br><span class=\"line\"></span><br><span class=\"line\">output.elasticsearch:</span><br><span class=\"line\">  # Array of hosts to connect to.</span><br><span class=\"line\">  hosts: [&quot;192.168.31.234:9200&quot;]</span><br><span class=\"line\">  index: &quot;nginx-%&#123;[beat.version]&#125;-%&#123;+yyyy.MM&#125;&quot;</span><br><span class=\"line\">setup.template.name: &quot;nginx_web&quot;</span><br><span class=\"line\">setup.template.pattern: &quot;nginx_web-&quot;</span><br><span class=\"line\">setup.template.enabled: false$</span><br><span class=\"line\">setup.template.overwrite: true$</span><br></pre></td></tr></table></figure>\n\n<p>filebeat7.x</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">output.elasticsearch:</span><br><span class=\"line\">  hosts: [&quot;https:&#x2F;&#x2F;localhost:9200&quot;]</span><br><span class=\"line\">  index: &quot;filebeat-%&#123;[agent.version]&#125;-%&#123;+yyyy.MM.dd&#125;&quot;</span><br><span class=\"line\">setup.template.name: &quot;nginx_web&quot;</span><br><span class=\"line\">setup.template.pattern: &quot;nginx_web-&quot;</span><br><span class=\"line\">setup.template.enabled: false$</span><br><span class=\"line\">setup.template.overwrite: true$</span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"filebeat7-7直接给es传输日志，自定义索引名\"><a href=\"#filebeat7-7直接给es传输日志，自定义索引名\" class=\"headerlink\" title=\"filebeat7.7直接给es传输日志，自定义索引名\"></a>filebeat7.7直接给es传输日志，自定义索引名</h2><p>ElasticStack从2019年1月29日的6.6.0版本的开始，引入了索引生命周期管理的功能，新版本的Filebeat则默认的配置开启了ILM，导致索引的命名规则被ILM策略控制。<br>加上这个配置就好了：</p>\n<p>filebeat 配置关闭 ILM 即可解决Index Pattern不生效的问题</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">setup.ilm.enabled: false</span><br></pre></td></tr></table></figure>\n\n<p>具体配置：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; Elasticsearch template setting &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class=\"line\">setup.ilm.enabled: false</span><br><span class=\"line\">setup.template.name: &quot;filebeat-127&quot;</span><br><span class=\"line\">setup.template.pattern: &quot;filebeat-127-*&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">setup.template.settings:</span><br><span class=\"line\">  index.number_of_shards: 1</span><br><span class=\"line\">  index.number_of_replicas: 0</span><br><span class=\"line\">  index.codec: best_compression </span><br><span class=\"line\">#-------------------------- Elasticsearch output ------------------------------</span><br><span class=\"line\">output.elasticsearch:</span><br><span class=\"line\">  hosts: [&quot;127.0.0.1:9200&quot;]</span><br><span class=\"line\">  index: &quot;filebeat-127-%&#123;+yyyy.MM.dd&#125;&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">  username: &quot;elastic&quot;</span><br><span class=\"line\">  password: &quot;xxxxxxxxxxx&quot;</span><br><span class=\"line\">&#96;&#96;&#96;  </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">## filebeat 输出到不同的es index </span><br></pre></td></tr></table></figure>\n<p>output.elasticsearch:</p>\n<h1 id=\"Array-of-hosts-to-connect-to\"><a href=\"#Array-of-hosts-to-connect-to\" class=\"headerlink\" title=\"Array of hosts to connect to.\"></a>Array of hosts to connect to.</h1><p>  hosts: [“10.4.144.173:9200”]<br>  indices:<br>    - index: “oom_-java-%{+yyyy.MM.dd}”<br>      when.contains:<br>        fields:<br>          index: ‘oom-java’</p>\n<pre><code>- index: &quot;oom-oms-java-%&#123;+yyyy.MM.dd&#125;&quot;\n  when.contains:\n    fields:\n      index: &#39;oom-oms-java&#39;\n</code></pre>\n<p>  username: “elastic”<br>  password: “${ES_PWD}”<br>```</p>"},{"title":"flask自定义分页","date":"2020-02-13T06:00:00.000Z","_content":"\n\n\n## flask 自定义fenye\n\npage_utils.py\n\n```python\n#!usr/bin/env python\n# -*- coding:utf-8 -*-\nfrom urllib import urlencode\nclass Pagination(object):\n    \"\"\"\n    自定义分页\n    \"\"\"\n    def __init__(self, current_page, total_count, base_url, params, per_page_count=10, max_pager_count=11):\n        try:\n            current_page = int(current_page)\n        except Exception as e:\n            current_page = 1\n        if current_page <=0:\n            current_page = 1\n        self.current_page = current_page\n        # 数据总条数\n        self.total_count = total_count\n  \n        # 每页显示10条数据\n        self.per_page_count = per_page_count\n  \n        # 页面上应该显示的最大页码\n        max_page_num, div = divmod(total_count, per_page_count)\n        if div:\n            max_page_num += 1\n        self.max_page_num = max_page_num\n  \n        # 页面上默认显示11个页码（当前页在中间）\n        self.max_pager_count = max_pager_count\n        self.half_max_pager_count = int((max_pager_count - 1) / 2)\n  \n        # URL前缀\n        self.base_url = base_url\n  \n        # request.GET\n        import copy\n        params = copy.deepcopy(params)\n        get_dict = params.to_dict()\n  \n        self.params = get_dict\n  \n    @property\n    def start(self):\n        return (self.current_page - 1) * self.per_page_count\n  \n    @property\n    def end(self):\n        return self.current_page * self.per_page_count\n  \n    def page_html(self):\n        # 如果总页数 <= 11\n        if self.max_page_num <= self.max_pager_count:\n            pager_start = 1\n            pager_end = self.max_page_num\n        # 如果总页数 > 11\n        else:\n            # 如果当前页 <= 5\n            if self.current_page <= self.half_max_pager_count:\n                pager_start = 1\n                pager_end = self.max_pager_count\n            else:\n                # 当前页 + 5 > 总页码\n                if (self.current_page + self.half_max_pager_count) > self.max_page_num:\n                    pager_end = self.max_page_num\n                    pager_start = self.max_page_num - self.max_pager_count + 1   #倒这数11个\n                else:\n                    pager_start = self.current_page - self.half_max_pager_count\n                    pager_end = self.current_page + self.half_max_pager_count\n  \n        page_html_list = []\n        # {source:[2,], status:[2], gender:[2],consultant:[1],page:[1]}\n        # 首页\n        self.params['page'] = 1\n        first_page = '<li><a href=\"%s?%s\">首页</a></li>'.decode(\"utf-8\") % (self.base_url,urlencode(self.params),)\n        page_html_list.append(first_page)\n        # 上一页\n        self.params[\"page\"] = self.current_page - 1\n        if self.params[\"page\"] < 1:\n            pervious_page = '<li class=\"disabled\"><a href=\"%s?%s\" aria-label=\"Previous\">上一页</span></a></li>'.decode(\"utf-8\") % (self.base_url, urlencode(self.params))\n        else:\n            pervious_page = '<li><a href = \"%s?%s\" aria-label = \"Previous\" >上一页</span></a></li>'.decode(\"utf-8\") % ( self.base_url, urlencode(self.params))\n        page_html_list.append(pervious_page)\n        # 中间页码\n        for i in range(pager_start, pager_end + 1):\n            self.params['page'] = i\n            if i == self.current_page:\n                temp = '<li class=\"active\"><a href=\"%s?%s\">%s</a></li>' % (self.base_url,urlencode(self.params), i,)\n            else:\n                temp = '<li><a href=\"%s?%s\">%s</a></li>' % (self.base_url,urlencode(self.params), i,)\n            page_html_list.append(temp)\n  \n        # 下一页\n        self.params[\"page\"] = self.current_page + 1\n        if self.params[\"page\"] > self.max_page_num:\n            self.params[\"page\"] = self.current_page\n            next_page = '<li class=\"disabled\"><a href = \"%s?%s\" aria-label = \"Next\">下一页</span></a></li >'.decode(\"utf-8\") % (self.base_url, urlencode(self.params))\n        else:\n            next_page = '<li><a href = \"%s?%s\" aria-label = \"Next\">下一页</span></a></li>'.decode(\"utf-8\") % (self.base_url, urlencode(self.params))\n        page_html_list.append(next_page)\n  \n        # 尾页\n        self.params['page'] = self.max_page_num\n        last_page = '<li><a href=\"%s?%s\">尾页</a></li>'.decode(\"utf-8\") % (self.base_url, urlencode(self.params),)\n        page_html_list.append(last_page)\n  \n        return ''.join(page_html_list)\n\n```\n\n\n\n自定义方法中的参数：\ncurrent_page——表示当前页。\ntotal_count——表示数据总条数。\nbase_url——表示分页URL前缀，请求的前缀获取可以通过Flask的request.path方法，无需自己指定。\n例如：我们的路由方法为@app.route('/test')，request.path方法即可获取/test。\nparams——表示请求传入的数据，params可以通过request.args动态获取。\n例如：我们链接点击为：http://localhost:5000/test?page=10，此时request.args获取数据为ImmutableMultiDict([('page', u'10')])\nper_page_count——指定每页显示数。\nmax_pager_count——指定页面最大显示页码\n\n\n\n## 测试类\n\ntest.py:\n\n```python\n#!usr/bin/env python\n# -*- coding:utf-8 -*-\nfrom flask import Flask, render_template, request\nfrom page_utils import Pagination\napp = Flask(__name__)\n  \n@app.route('/test')\ndef test():\n    li = []\n    for i in range(1, 100):\n        li.append(i)\n    pager_obj = Pagination(request.args.get(\"page\", 1), len(li), request.path, request.args, per_page_count=10)\n    print(request.path)\n    print(request.args)\n    index_list = li[pager_obj.start:pager_obj.end]\n    html = pager_obj.page_html()\n    return render_template(\"obj/test.html\", index_list=index_list, html=html)\n  \nif __name__ == '__main__':\n    app.run(debug=True)\n```\n\n\n\n在上面的程序中，li为我们要分页的对象，数组list，我们获取到这个list之后，把他用工具类中的起止方法包起来。\n传递数据用包装后的list，这样就达到了需要哪一段数据我们传递哪一段的效果，包装的方法：index_list = li[pager_obj.start:pager_obj.end]\n\n \n\n我们用一个HTML页面去显示它，分页样式不是重点，我们这里直接引入bootstrap封装好的分页效果，代码如下：\n\ntest.html\n\n```html\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <title>Title</title>\n    <link rel=\"stylesheet\" href=\"{{ url_for('static', filename='css/bootstrap.min.css') }}\">\n    <style>\n        .container{\n            margin-top: 20px;\n        }\n    </style>\n</head>\n<body>\n    <div class=\"container\">\n        <div class=\"row \" style=\"margin-top: 10px\">\n                <ul>\n                    {% for foo in index_list %}\n                        <li>{{ foo }}：这是列表内容~~</li>\n                    {% endfor %}\n                </ul>\n                <nav aria-label=\"Page navigation\" class=\"pull-right\">\n                    <ul class=\"pagination\">\n                        {{ html|safe }}\n                    </ul>\n                </nav>\n        </div>\n    </div>\n</body>\n</html>\n```\n\n","source":"_posts/flask/flask分页.md","raw":"---\ntitle: flask自定义分页\ndate: 2020-02-13 14:00:00\ncategories: \n- flask\ntags:\n- python\n- flask\n---\n\n\n\n## flask 自定义fenye\n\npage_utils.py\n\n```python\n#!usr/bin/env python\n# -*- coding:utf-8 -*-\nfrom urllib import urlencode\nclass Pagination(object):\n    \"\"\"\n    自定义分页\n    \"\"\"\n    def __init__(self, current_page, total_count, base_url, params, per_page_count=10, max_pager_count=11):\n        try:\n            current_page = int(current_page)\n        except Exception as e:\n            current_page = 1\n        if current_page <=0:\n            current_page = 1\n        self.current_page = current_page\n        # 数据总条数\n        self.total_count = total_count\n  \n        # 每页显示10条数据\n        self.per_page_count = per_page_count\n  \n        # 页面上应该显示的最大页码\n        max_page_num, div = divmod(total_count, per_page_count)\n        if div:\n            max_page_num += 1\n        self.max_page_num = max_page_num\n  \n        # 页面上默认显示11个页码（当前页在中间）\n        self.max_pager_count = max_pager_count\n        self.half_max_pager_count = int((max_pager_count - 1) / 2)\n  \n        # URL前缀\n        self.base_url = base_url\n  \n        # request.GET\n        import copy\n        params = copy.deepcopy(params)\n        get_dict = params.to_dict()\n  \n        self.params = get_dict\n  \n    @property\n    def start(self):\n        return (self.current_page - 1) * self.per_page_count\n  \n    @property\n    def end(self):\n        return self.current_page * self.per_page_count\n  \n    def page_html(self):\n        # 如果总页数 <= 11\n        if self.max_page_num <= self.max_pager_count:\n            pager_start = 1\n            pager_end = self.max_page_num\n        # 如果总页数 > 11\n        else:\n            # 如果当前页 <= 5\n            if self.current_page <= self.half_max_pager_count:\n                pager_start = 1\n                pager_end = self.max_pager_count\n            else:\n                # 当前页 + 5 > 总页码\n                if (self.current_page + self.half_max_pager_count) > self.max_page_num:\n                    pager_end = self.max_page_num\n                    pager_start = self.max_page_num - self.max_pager_count + 1   #倒这数11个\n                else:\n                    pager_start = self.current_page - self.half_max_pager_count\n                    pager_end = self.current_page + self.half_max_pager_count\n  \n        page_html_list = []\n        # {source:[2,], status:[2], gender:[2],consultant:[1],page:[1]}\n        # 首页\n        self.params['page'] = 1\n        first_page = '<li><a href=\"%s?%s\">首页</a></li>'.decode(\"utf-8\") % (self.base_url,urlencode(self.params),)\n        page_html_list.append(first_page)\n        # 上一页\n        self.params[\"page\"] = self.current_page - 1\n        if self.params[\"page\"] < 1:\n            pervious_page = '<li class=\"disabled\"><a href=\"%s?%s\" aria-label=\"Previous\">上一页</span></a></li>'.decode(\"utf-8\") % (self.base_url, urlencode(self.params))\n        else:\n            pervious_page = '<li><a href = \"%s?%s\" aria-label = \"Previous\" >上一页</span></a></li>'.decode(\"utf-8\") % ( self.base_url, urlencode(self.params))\n        page_html_list.append(pervious_page)\n        # 中间页码\n        for i in range(pager_start, pager_end + 1):\n            self.params['page'] = i\n            if i == self.current_page:\n                temp = '<li class=\"active\"><a href=\"%s?%s\">%s</a></li>' % (self.base_url,urlencode(self.params), i,)\n            else:\n                temp = '<li><a href=\"%s?%s\">%s</a></li>' % (self.base_url,urlencode(self.params), i,)\n            page_html_list.append(temp)\n  \n        # 下一页\n        self.params[\"page\"] = self.current_page + 1\n        if self.params[\"page\"] > self.max_page_num:\n            self.params[\"page\"] = self.current_page\n            next_page = '<li class=\"disabled\"><a href = \"%s?%s\" aria-label = \"Next\">下一页</span></a></li >'.decode(\"utf-8\") % (self.base_url, urlencode(self.params))\n        else:\n            next_page = '<li><a href = \"%s?%s\" aria-label = \"Next\">下一页</span></a></li>'.decode(\"utf-8\") % (self.base_url, urlencode(self.params))\n        page_html_list.append(next_page)\n  \n        # 尾页\n        self.params['page'] = self.max_page_num\n        last_page = '<li><a href=\"%s?%s\">尾页</a></li>'.decode(\"utf-8\") % (self.base_url, urlencode(self.params),)\n        page_html_list.append(last_page)\n  \n        return ''.join(page_html_list)\n\n```\n\n\n\n自定义方法中的参数：\ncurrent_page——表示当前页。\ntotal_count——表示数据总条数。\nbase_url——表示分页URL前缀，请求的前缀获取可以通过Flask的request.path方法，无需自己指定。\n例如：我们的路由方法为@app.route('/test')，request.path方法即可获取/test。\nparams——表示请求传入的数据，params可以通过request.args动态获取。\n例如：我们链接点击为：http://localhost:5000/test?page=10，此时request.args获取数据为ImmutableMultiDict([('page', u'10')])\nper_page_count——指定每页显示数。\nmax_pager_count——指定页面最大显示页码\n\n\n\n## 测试类\n\ntest.py:\n\n```python\n#!usr/bin/env python\n# -*- coding:utf-8 -*-\nfrom flask import Flask, render_template, request\nfrom page_utils import Pagination\napp = Flask(__name__)\n  \n@app.route('/test')\ndef test():\n    li = []\n    for i in range(1, 100):\n        li.append(i)\n    pager_obj = Pagination(request.args.get(\"page\", 1), len(li), request.path, request.args, per_page_count=10)\n    print(request.path)\n    print(request.args)\n    index_list = li[pager_obj.start:pager_obj.end]\n    html = pager_obj.page_html()\n    return render_template(\"obj/test.html\", index_list=index_list, html=html)\n  \nif __name__ == '__main__':\n    app.run(debug=True)\n```\n\n\n\n在上面的程序中，li为我们要分页的对象，数组list，我们获取到这个list之后，把他用工具类中的起止方法包起来。\n传递数据用包装后的list，这样就达到了需要哪一段数据我们传递哪一段的效果，包装的方法：index_list = li[pager_obj.start:pager_obj.end]\n\n \n\n我们用一个HTML页面去显示它，分页样式不是重点，我们这里直接引入bootstrap封装好的分页效果，代码如下：\n\ntest.html\n\n```html\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <title>Title</title>\n    <link rel=\"stylesheet\" href=\"{{ url_for('static', filename='css/bootstrap.min.css') }}\">\n    <style>\n        .container{\n            margin-top: 20px;\n        }\n    </style>\n</head>\n<body>\n    <div class=\"container\">\n        <div class=\"row \" style=\"margin-top: 10px\">\n                <ul>\n                    {% for foo in index_list %}\n                        <li>{{ foo }}：这是列表内容~~</li>\n                    {% endfor %}\n                </ul>\n                <nav aria-label=\"Page navigation\" class=\"pull-right\">\n                    <ul class=\"pagination\">\n                        {{ html|safe }}\n                    </ul>\n                </nav>\n        </div>\n    </div>\n</body>\n</html>\n```\n\n","slug":"flask/flask分页","published":1,"updated":"2021-06-18T08:07:11.187Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cku6979yy002d00uh2vnuhewe","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><h2 id=\"flask-自定义fenye\"><a href=\"#flask-自定义fenye\" class=\"headerlink\" title=\"flask 自定义fenye\"></a>flask 自定义fenye</h2><p>page_utils.py</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#!usr/bin/env python</span></span><br><span class=\"line\"><span class=\"comment\"># -*- coding:utf-8 -*-</span></span><br><span class=\"line\"><span class=\"keyword\">from</span> urllib <span class=\"keyword\">import</span> urlencode</span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Pagination</span>(<span class=\"params\"><span class=\"built_in\">object</span></span>):</span></span><br><span class=\"line\">    <span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"string\">    自定义分页</span></span><br><span class=\"line\"><span class=\"string\">    &quot;&quot;&quot;</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__init__</span>(<span class=\"params\">self, current_page, total_count, base_url, params, per_page_count=<span class=\"number\">10</span>, max_pager_count=<span class=\"number\">11</span></span>):</span></span><br><span class=\"line\">        <span class=\"keyword\">try</span>:</span><br><span class=\"line\">            current_page = <span class=\"built_in\">int</span>(current_page)</span><br><span class=\"line\">        <span class=\"keyword\">except</span> Exception <span class=\"keyword\">as</span> e:</span><br><span class=\"line\">            current_page = <span class=\"number\">1</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> current_page &lt;=<span class=\"number\">0</span>:</span><br><span class=\"line\">            current_page = <span class=\"number\">1</span></span><br><span class=\"line\">        self.current_page = current_page</span><br><span class=\"line\">        <span class=\"comment\"># 数据总条数</span></span><br><span class=\"line\">        self.total_count = total_count</span><br><span class=\"line\">  </span><br><span class=\"line\">        <span class=\"comment\"># 每页显示10条数据</span></span><br><span class=\"line\">        self.per_page_count = per_page_count</span><br><span class=\"line\">  </span><br><span class=\"line\">        <span class=\"comment\"># 页面上应该显示的最大页码</span></span><br><span class=\"line\">        max_page_num, div = <span class=\"built_in\">divmod</span>(total_count, per_page_count)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> div:</span><br><span class=\"line\">            max_page_num += <span class=\"number\">1</span></span><br><span class=\"line\">        self.max_page_num = max_page_num</span><br><span class=\"line\">  </span><br><span class=\"line\">        <span class=\"comment\"># 页面上默认显示11个页码（当前页在中间）</span></span><br><span class=\"line\">        self.max_pager_count = max_pager_count</span><br><span class=\"line\">        self.half_max_pager_count = <span class=\"built_in\">int</span>((max_pager_count - <span class=\"number\">1</span>) / <span class=\"number\">2</span>)</span><br><span class=\"line\">  </span><br><span class=\"line\">        <span class=\"comment\"># URL前缀</span></span><br><span class=\"line\">        self.base_url = base_url</span><br><span class=\"line\">  </span><br><span class=\"line\">        <span class=\"comment\"># request.GET</span></span><br><span class=\"line\">        <span class=\"keyword\">import</span> copy</span><br><span class=\"line\">        params = copy.deepcopy(params)</span><br><span class=\"line\">        get_dict = params.to_dict()</span><br><span class=\"line\">  </span><br><span class=\"line\">        self.params = get_dict</span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"meta\">    @property</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">start</span>(<span class=\"params\">self</span>):</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> (self.current_page - <span class=\"number\">1</span>) * self.per_page_count</span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"meta\">    @property</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">end</span>(<span class=\"params\">self</span>):</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> self.current_page * self.per_page_count</span><br><span class=\"line\">  </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">page_html</span>(<span class=\"params\">self</span>):</span></span><br><span class=\"line\">        <span class=\"comment\"># 如果总页数 &lt;= 11</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> self.max_page_num &lt;= self.max_pager_count:</span><br><span class=\"line\">            pager_start = <span class=\"number\">1</span></span><br><span class=\"line\">            pager_end = self.max_page_num</span><br><span class=\"line\">        <span class=\"comment\"># 如果总页数 &gt; 11</span></span><br><span class=\"line\">        <span class=\"keyword\">else</span>:</span><br><span class=\"line\">            <span class=\"comment\"># 如果当前页 &lt;= 5</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> self.current_page &lt;= self.half_max_pager_count:</span><br><span class=\"line\">                pager_start = <span class=\"number\">1</span></span><br><span class=\"line\">                pager_end = self.max_pager_count</span><br><span class=\"line\">            <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                <span class=\"comment\"># 当前页 + 5 &gt; 总页码</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> (self.current_page + self.half_max_pager_count) &gt; self.max_page_num:</span><br><span class=\"line\">                    pager_end = self.max_page_num</span><br><span class=\"line\">                    pager_start = self.max_page_num - self.max_pager_count + <span class=\"number\">1</span>   <span class=\"comment\">#倒这数11个</span></span><br><span class=\"line\">                <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                    pager_start = self.current_page - self.half_max_pager_count</span><br><span class=\"line\">                    pager_end = self.current_page + self.half_max_pager_count</span><br><span class=\"line\">  </span><br><span class=\"line\">        page_html_list = []</span><br><span class=\"line\">        <span class=\"comment\"># &#123;source:[2,], status:[2], gender:[2],consultant:[1],page:[1]&#125;</span></span><br><span class=\"line\">        <span class=\"comment\"># 首页</span></span><br><span class=\"line\">        self.params[<span class=\"string\">&#x27;page&#x27;</span>] = <span class=\"number\">1</span></span><br><span class=\"line\">        first_page = <span class=\"string\">&#x27;&lt;li&gt;&lt;a href=&quot;%s?%s&quot;&gt;首页&lt;/a&gt;&lt;/li&gt;&#x27;</span>.decode(<span class=\"string\">&quot;utf-8&quot;</span>) % (self.base_url,urlencode(self.params),)</span><br><span class=\"line\">        page_html_list.append(first_page)</span><br><span class=\"line\">        <span class=\"comment\"># 上一页</span></span><br><span class=\"line\">        self.params[<span class=\"string\">&quot;page&quot;</span>] = self.current_page - <span class=\"number\">1</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> self.params[<span class=\"string\">&quot;page&quot;</span>] &lt; <span class=\"number\">1</span>:</span><br><span class=\"line\">            pervious_page = <span class=\"string\">&#x27;&lt;li class=&quot;disabled&quot;&gt;&lt;a href=&quot;%s?%s&quot; aria-label=&quot;Previous&quot;&gt;上一页&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;&#x27;</span>.decode(<span class=\"string\">&quot;utf-8&quot;</span>) % (self.base_url, urlencode(self.params))</span><br><span class=\"line\">        <span class=\"keyword\">else</span>:</span><br><span class=\"line\">            pervious_page = <span class=\"string\">&#x27;&lt;li&gt;&lt;a href = &quot;%s?%s&quot; aria-label = &quot;Previous&quot; &gt;上一页&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;&#x27;</span>.decode(<span class=\"string\">&quot;utf-8&quot;</span>) % ( self.base_url, urlencode(self.params))</span><br><span class=\"line\">        page_html_list.append(pervious_page)</span><br><span class=\"line\">        <span class=\"comment\"># 中间页码</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(pager_start, pager_end + <span class=\"number\">1</span>):</span><br><span class=\"line\">            self.params[<span class=\"string\">&#x27;page&#x27;</span>] = i</span><br><span class=\"line\">            <span class=\"keyword\">if</span> i == self.current_page:</span><br><span class=\"line\">                temp = <span class=\"string\">&#x27;&lt;li class=&quot;active&quot;&gt;&lt;a href=&quot;%s?%s&quot;&gt;%s&lt;/a&gt;&lt;/li&gt;&#x27;</span> % (self.base_url,urlencode(self.params), i,)</span><br><span class=\"line\">            <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                temp = <span class=\"string\">&#x27;&lt;li&gt;&lt;a href=&quot;%s?%s&quot;&gt;%s&lt;/a&gt;&lt;/li&gt;&#x27;</span> % (self.base_url,urlencode(self.params), i,)</span><br><span class=\"line\">            page_html_list.append(temp)</span><br><span class=\"line\">  </span><br><span class=\"line\">        <span class=\"comment\"># 下一页</span></span><br><span class=\"line\">        self.params[<span class=\"string\">&quot;page&quot;</span>] = self.current_page + <span class=\"number\">1</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> self.params[<span class=\"string\">&quot;page&quot;</span>] &gt; self.max_page_num:</span><br><span class=\"line\">            self.params[<span class=\"string\">&quot;page&quot;</span>] = self.current_page</span><br><span class=\"line\">            next_page = <span class=\"string\">&#x27;&lt;li class=&quot;disabled&quot;&gt;&lt;a href = &quot;%s?%s&quot; aria-label = &quot;Next&quot;&gt;下一页&lt;/span&gt;&lt;/a&gt;&lt;/li &gt;&#x27;</span>.decode(<span class=\"string\">&quot;utf-8&quot;</span>) % (self.base_url, urlencode(self.params))</span><br><span class=\"line\">        <span class=\"keyword\">else</span>:</span><br><span class=\"line\">            next_page = <span class=\"string\">&#x27;&lt;li&gt;&lt;a href = &quot;%s?%s&quot; aria-label = &quot;Next&quot;&gt;下一页&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;&#x27;</span>.decode(<span class=\"string\">&quot;utf-8&quot;</span>) % (self.base_url, urlencode(self.params))</span><br><span class=\"line\">        page_html_list.append(next_page)</span><br><span class=\"line\">  </span><br><span class=\"line\">        <span class=\"comment\"># 尾页</span></span><br><span class=\"line\">        self.params[<span class=\"string\">&#x27;page&#x27;</span>] = self.max_page_num</span><br><span class=\"line\">        last_page = <span class=\"string\">&#x27;&lt;li&gt;&lt;a href=&quot;%s?%s&quot;&gt;尾页&lt;/a&gt;&lt;/li&gt;&#x27;</span>.decode(<span class=\"string\">&quot;utf-8&quot;</span>) % (self.base_url, urlencode(self.params),)</span><br><span class=\"line\">        page_html_list.append(last_page)</span><br><span class=\"line\">  </span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&#x27;&#x27;</span>.join(page_html_list)</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<p>自定义方法中的参数：<br>current_page——表示当前页。<br>total_count——表示数据总条数。<br>base_url——表示分页URL前缀，请求的前缀获取可以通过Flask的request.path方法，无需自己指定。<br>例如：我们的路由方法为@app.route(‘/test’)，request.path方法即可获取/test。<br>params——表示请求传入的数据，params可以通过request.args动态获取。<br>例如：我们链接点击为：<a href=\"http://localhost:5000/test?page=10%EF%BC%8C%E6%AD%A4%E6%97%B6request.args%E8%8E%B7%E5%8F%96%E6%95%B0%E6%8D%AE%E4%B8%BAImmutableMultiDict\">http://localhost:5000/test?page=10，此时request.args获取数据为ImmutableMultiDict</a>([(‘page’, u’10’)])<br>per_page_count——指定每页显示数。<br>max_pager_count——指定页面最大显示页码</p>\n<h2 id=\"测试类\"><a href=\"#测试类\" class=\"headerlink\" title=\"测试类\"></a>测试类</h2><p>test.py:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#!usr/bin/env python</span></span><br><span class=\"line\"><span class=\"comment\"># -*- coding:utf-8 -*-</span></span><br><span class=\"line\"><span class=\"keyword\">from</span> flask <span class=\"keyword\">import</span> Flask, render_template, request</span><br><span class=\"line\"><span class=\"keyword\">from</span> page_utils <span class=\"keyword\">import</span> Pagination</span><br><span class=\"line\">app = Flask(__name__)</span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"meta\">@app.route(<span class=\"params\"><span class=\"string\">&#x27;/test&#x27;</span></span>)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">test</span>():</span></span><br><span class=\"line\">    li = []</span><br><span class=\"line\">    <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">1</span>, <span class=\"number\">100</span>):</span><br><span class=\"line\">        li.append(i)</span><br><span class=\"line\">    pager_obj = Pagination(request.args.get(<span class=\"string\">&quot;page&quot;</span>, <span class=\"number\">1</span>), <span class=\"built_in\">len</span>(li), request.path, request.args, per_page_count=<span class=\"number\">10</span>)</span><br><span class=\"line\">    print(request.path)</span><br><span class=\"line\">    print(request.args)</span><br><span class=\"line\">    index_list = li[pager_obj.start:pager_obj.end]</span><br><span class=\"line\">    html = pager_obj.page_html()</span><br><span class=\"line\">    <span class=\"keyword\">return</span> render_template(<span class=\"string\">&quot;obj/test.html&quot;</span>, index_list=index_list, html=html)</span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&#x27;__main__&#x27;</span>:</span><br><span class=\"line\">    app.run(debug=<span class=\"literal\">True</span>)</span><br></pre></td></tr></table></figure>\n\n\n\n<p>在上面的程序中，li为我们要分页的对象，数组list，我们获取到这个list之后，把他用工具类中的起止方法包起来。<br>传递数据用包装后的list，这样就达到了需要哪一段数据我们传递哪一段的效果，包装的方法：index_list = li[pager_obj.start:pager_obj.end]</p>\n<p>我们用一个HTML页面去显示它，分页样式不是重点，我们这里直接引入bootstrap封装好的分页效果，代码如下：</p>\n<p>test.html</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">&quot;en&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>Title<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">link</span> <span class=\"attr\">rel</span>=<span class=\"string\">&quot;stylesheet&quot;</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;&#123;&#123; url_for(&#x27;static&#x27;, filename=&#x27;css/bootstrap.min.css&#x27;) &#125;&#125;&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\">        .container&#123;</span><br><span class=\"line\"><span class=\"css\">            <span class=\"attribute\">margin-top</span>: <span class=\"number\">20px</span>;</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;container&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;row &quot;</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;margin-top: 10px&quot;</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">ul</span>&gt;</span></span><br><span class=\"line\">                    &#123;% for foo in index_list %&#125;</span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">li</span>&gt;</span>&#123;&#123; foo &#125;&#125;：这是列表内容~~<span class=\"tag\">&lt;/<span class=\"name\">li</span>&gt;</span></span><br><span class=\"line\">                    &#123;% endfor %&#125;</span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">ul</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">nav</span> <span class=\"attr\">aria-label</span>=<span class=\"string\">&quot;Page navigation&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;pull-right&quot;</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">ul</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;pagination&quot;</span>&gt;</span></span><br><span class=\"line\">                        &#123;&#123; html|safe &#125;&#125;</span><br><span class=\"line\">                    <span class=\"tag\">&lt;/<span class=\"name\">ul</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">nav</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"flask-自定义fenye\"><a href=\"#flask-自定义fenye\" class=\"headerlink\" title=\"flask 自定义fenye\"></a>flask 自定义fenye</h2><p>page_utils.py</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#!usr/bin/env python</span></span><br><span class=\"line\"><span class=\"comment\"># -*- coding:utf-8 -*-</span></span><br><span class=\"line\"><span class=\"keyword\">from</span> urllib <span class=\"keyword\">import</span> urlencode</span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Pagination</span>(<span class=\"params\"><span class=\"built_in\">object</span></span>):</span></span><br><span class=\"line\">    <span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"string\">    自定义分页</span></span><br><span class=\"line\"><span class=\"string\">    &quot;&quot;&quot;</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__init__</span>(<span class=\"params\">self, current_page, total_count, base_url, params, per_page_count=<span class=\"number\">10</span>, max_pager_count=<span class=\"number\">11</span></span>):</span></span><br><span class=\"line\">        <span class=\"keyword\">try</span>:</span><br><span class=\"line\">            current_page = <span class=\"built_in\">int</span>(current_page)</span><br><span class=\"line\">        <span class=\"keyword\">except</span> Exception <span class=\"keyword\">as</span> e:</span><br><span class=\"line\">            current_page = <span class=\"number\">1</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> current_page &lt;=<span class=\"number\">0</span>:</span><br><span class=\"line\">            current_page = <span class=\"number\">1</span></span><br><span class=\"line\">        self.current_page = current_page</span><br><span class=\"line\">        <span class=\"comment\"># 数据总条数</span></span><br><span class=\"line\">        self.total_count = total_count</span><br><span class=\"line\">  </span><br><span class=\"line\">        <span class=\"comment\"># 每页显示10条数据</span></span><br><span class=\"line\">        self.per_page_count = per_page_count</span><br><span class=\"line\">  </span><br><span class=\"line\">        <span class=\"comment\"># 页面上应该显示的最大页码</span></span><br><span class=\"line\">        max_page_num, div = <span class=\"built_in\">divmod</span>(total_count, per_page_count)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> div:</span><br><span class=\"line\">            max_page_num += <span class=\"number\">1</span></span><br><span class=\"line\">        self.max_page_num = max_page_num</span><br><span class=\"line\">  </span><br><span class=\"line\">        <span class=\"comment\"># 页面上默认显示11个页码（当前页在中间）</span></span><br><span class=\"line\">        self.max_pager_count = max_pager_count</span><br><span class=\"line\">        self.half_max_pager_count = <span class=\"built_in\">int</span>((max_pager_count - <span class=\"number\">1</span>) / <span class=\"number\">2</span>)</span><br><span class=\"line\">  </span><br><span class=\"line\">        <span class=\"comment\"># URL前缀</span></span><br><span class=\"line\">        self.base_url = base_url</span><br><span class=\"line\">  </span><br><span class=\"line\">        <span class=\"comment\"># request.GET</span></span><br><span class=\"line\">        <span class=\"keyword\">import</span> copy</span><br><span class=\"line\">        params = copy.deepcopy(params)</span><br><span class=\"line\">        get_dict = params.to_dict()</span><br><span class=\"line\">  </span><br><span class=\"line\">        self.params = get_dict</span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"meta\">    @property</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">start</span>(<span class=\"params\">self</span>):</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> (self.current_page - <span class=\"number\">1</span>) * self.per_page_count</span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"meta\">    @property</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">end</span>(<span class=\"params\">self</span>):</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> self.current_page * self.per_page_count</span><br><span class=\"line\">  </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">page_html</span>(<span class=\"params\">self</span>):</span></span><br><span class=\"line\">        <span class=\"comment\"># 如果总页数 &lt;= 11</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> self.max_page_num &lt;= self.max_pager_count:</span><br><span class=\"line\">            pager_start = <span class=\"number\">1</span></span><br><span class=\"line\">            pager_end = self.max_page_num</span><br><span class=\"line\">        <span class=\"comment\"># 如果总页数 &gt; 11</span></span><br><span class=\"line\">        <span class=\"keyword\">else</span>:</span><br><span class=\"line\">            <span class=\"comment\"># 如果当前页 &lt;= 5</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> self.current_page &lt;= self.half_max_pager_count:</span><br><span class=\"line\">                pager_start = <span class=\"number\">1</span></span><br><span class=\"line\">                pager_end = self.max_pager_count</span><br><span class=\"line\">            <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                <span class=\"comment\"># 当前页 + 5 &gt; 总页码</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> (self.current_page + self.half_max_pager_count) &gt; self.max_page_num:</span><br><span class=\"line\">                    pager_end = self.max_page_num</span><br><span class=\"line\">                    pager_start = self.max_page_num - self.max_pager_count + <span class=\"number\">1</span>   <span class=\"comment\">#倒这数11个</span></span><br><span class=\"line\">                <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                    pager_start = self.current_page - self.half_max_pager_count</span><br><span class=\"line\">                    pager_end = self.current_page + self.half_max_pager_count</span><br><span class=\"line\">  </span><br><span class=\"line\">        page_html_list = []</span><br><span class=\"line\">        <span class=\"comment\"># &#123;source:[2,], status:[2], gender:[2],consultant:[1],page:[1]&#125;</span></span><br><span class=\"line\">        <span class=\"comment\"># 首页</span></span><br><span class=\"line\">        self.params[<span class=\"string\">&#x27;page&#x27;</span>] = <span class=\"number\">1</span></span><br><span class=\"line\">        first_page = <span class=\"string\">&#x27;&lt;li&gt;&lt;a href=&quot;%s?%s&quot;&gt;首页&lt;/a&gt;&lt;/li&gt;&#x27;</span>.decode(<span class=\"string\">&quot;utf-8&quot;</span>) % (self.base_url,urlencode(self.params),)</span><br><span class=\"line\">        page_html_list.append(first_page)</span><br><span class=\"line\">        <span class=\"comment\"># 上一页</span></span><br><span class=\"line\">        self.params[<span class=\"string\">&quot;page&quot;</span>] = self.current_page - <span class=\"number\">1</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> self.params[<span class=\"string\">&quot;page&quot;</span>] &lt; <span class=\"number\">1</span>:</span><br><span class=\"line\">            pervious_page = <span class=\"string\">&#x27;&lt;li class=&quot;disabled&quot;&gt;&lt;a href=&quot;%s?%s&quot; aria-label=&quot;Previous&quot;&gt;上一页&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;&#x27;</span>.decode(<span class=\"string\">&quot;utf-8&quot;</span>) % (self.base_url, urlencode(self.params))</span><br><span class=\"line\">        <span class=\"keyword\">else</span>:</span><br><span class=\"line\">            pervious_page = <span class=\"string\">&#x27;&lt;li&gt;&lt;a href = &quot;%s?%s&quot; aria-label = &quot;Previous&quot; &gt;上一页&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;&#x27;</span>.decode(<span class=\"string\">&quot;utf-8&quot;</span>) % ( self.base_url, urlencode(self.params))</span><br><span class=\"line\">        page_html_list.append(pervious_page)</span><br><span class=\"line\">        <span class=\"comment\"># 中间页码</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(pager_start, pager_end + <span class=\"number\">1</span>):</span><br><span class=\"line\">            self.params[<span class=\"string\">&#x27;page&#x27;</span>] = i</span><br><span class=\"line\">            <span class=\"keyword\">if</span> i == self.current_page:</span><br><span class=\"line\">                temp = <span class=\"string\">&#x27;&lt;li class=&quot;active&quot;&gt;&lt;a href=&quot;%s?%s&quot;&gt;%s&lt;/a&gt;&lt;/li&gt;&#x27;</span> % (self.base_url,urlencode(self.params), i,)</span><br><span class=\"line\">            <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                temp = <span class=\"string\">&#x27;&lt;li&gt;&lt;a href=&quot;%s?%s&quot;&gt;%s&lt;/a&gt;&lt;/li&gt;&#x27;</span> % (self.base_url,urlencode(self.params), i,)</span><br><span class=\"line\">            page_html_list.append(temp)</span><br><span class=\"line\">  </span><br><span class=\"line\">        <span class=\"comment\"># 下一页</span></span><br><span class=\"line\">        self.params[<span class=\"string\">&quot;page&quot;</span>] = self.current_page + <span class=\"number\">1</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> self.params[<span class=\"string\">&quot;page&quot;</span>] &gt; self.max_page_num:</span><br><span class=\"line\">            self.params[<span class=\"string\">&quot;page&quot;</span>] = self.current_page</span><br><span class=\"line\">            next_page = <span class=\"string\">&#x27;&lt;li class=&quot;disabled&quot;&gt;&lt;a href = &quot;%s?%s&quot; aria-label = &quot;Next&quot;&gt;下一页&lt;/span&gt;&lt;/a&gt;&lt;/li &gt;&#x27;</span>.decode(<span class=\"string\">&quot;utf-8&quot;</span>) % (self.base_url, urlencode(self.params))</span><br><span class=\"line\">        <span class=\"keyword\">else</span>:</span><br><span class=\"line\">            next_page = <span class=\"string\">&#x27;&lt;li&gt;&lt;a href = &quot;%s?%s&quot; aria-label = &quot;Next&quot;&gt;下一页&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;&#x27;</span>.decode(<span class=\"string\">&quot;utf-8&quot;</span>) % (self.base_url, urlencode(self.params))</span><br><span class=\"line\">        page_html_list.append(next_page)</span><br><span class=\"line\">  </span><br><span class=\"line\">        <span class=\"comment\"># 尾页</span></span><br><span class=\"line\">        self.params[<span class=\"string\">&#x27;page&#x27;</span>] = self.max_page_num</span><br><span class=\"line\">        last_page = <span class=\"string\">&#x27;&lt;li&gt;&lt;a href=&quot;%s?%s&quot;&gt;尾页&lt;/a&gt;&lt;/li&gt;&#x27;</span>.decode(<span class=\"string\">&quot;utf-8&quot;</span>) % (self.base_url, urlencode(self.params),)</span><br><span class=\"line\">        page_html_list.append(last_page)</span><br><span class=\"line\">  </span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&#x27;&#x27;</span>.join(page_html_list)</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<p>自定义方法中的参数：<br>current_page——表示当前页。<br>total_count——表示数据总条数。<br>base_url——表示分页URL前缀，请求的前缀获取可以通过Flask的request.path方法，无需自己指定。<br>例如：我们的路由方法为@app.route(‘/test’)，request.path方法即可获取/test。<br>params——表示请求传入的数据，params可以通过request.args动态获取。<br>例如：我们链接点击为：<a href=\"http://localhost:5000/test?page=10%EF%BC%8C%E6%AD%A4%E6%97%B6request.args%E8%8E%B7%E5%8F%96%E6%95%B0%E6%8D%AE%E4%B8%BAImmutableMultiDict\">http://localhost:5000/test?page=10，此时request.args获取数据为ImmutableMultiDict</a>([(‘page’, u’10’)])<br>per_page_count——指定每页显示数。<br>max_pager_count——指定页面最大显示页码</p>\n<h2 id=\"测试类\"><a href=\"#测试类\" class=\"headerlink\" title=\"测试类\"></a>测试类</h2><p>test.py:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#!usr/bin/env python</span></span><br><span class=\"line\"><span class=\"comment\"># -*- coding:utf-8 -*-</span></span><br><span class=\"line\"><span class=\"keyword\">from</span> flask <span class=\"keyword\">import</span> Flask, render_template, request</span><br><span class=\"line\"><span class=\"keyword\">from</span> page_utils <span class=\"keyword\">import</span> Pagination</span><br><span class=\"line\">app = Flask(__name__)</span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"meta\">@app.route(<span class=\"params\"><span class=\"string\">&#x27;/test&#x27;</span></span>)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">test</span>():</span></span><br><span class=\"line\">    li = []</span><br><span class=\"line\">    <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">1</span>, <span class=\"number\">100</span>):</span><br><span class=\"line\">        li.append(i)</span><br><span class=\"line\">    pager_obj = Pagination(request.args.get(<span class=\"string\">&quot;page&quot;</span>, <span class=\"number\">1</span>), <span class=\"built_in\">len</span>(li), request.path, request.args, per_page_count=<span class=\"number\">10</span>)</span><br><span class=\"line\">    print(request.path)</span><br><span class=\"line\">    print(request.args)</span><br><span class=\"line\">    index_list = li[pager_obj.start:pager_obj.end]</span><br><span class=\"line\">    html = pager_obj.page_html()</span><br><span class=\"line\">    <span class=\"keyword\">return</span> render_template(<span class=\"string\">&quot;obj/test.html&quot;</span>, index_list=index_list, html=html)</span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&#x27;__main__&#x27;</span>:</span><br><span class=\"line\">    app.run(debug=<span class=\"literal\">True</span>)</span><br></pre></td></tr></table></figure>\n\n\n\n<p>在上面的程序中，li为我们要分页的对象，数组list，我们获取到这个list之后，把他用工具类中的起止方法包起来。<br>传递数据用包装后的list，这样就达到了需要哪一段数据我们传递哪一段的效果，包装的方法：index_list = li[pager_obj.start:pager_obj.end]</p>\n<p>我们用一个HTML页面去显示它，分页样式不是重点，我们这里直接引入bootstrap封装好的分页效果，代码如下：</p>\n<p>test.html</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">&quot;en&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>Title<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">link</span> <span class=\"attr\">rel</span>=<span class=\"string\">&quot;stylesheet&quot;</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;&#123;&#123; url_for(&#x27;static&#x27;, filename=&#x27;css/bootstrap.min.css&#x27;) &#125;&#125;&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\">        .container&#123;</span><br><span class=\"line\"><span class=\"css\">            <span class=\"attribute\">margin-top</span>: <span class=\"number\">20px</span>;</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;container&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;row &quot;</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;margin-top: 10px&quot;</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">ul</span>&gt;</span></span><br><span class=\"line\">                    &#123;% for foo in index_list %&#125;</span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">li</span>&gt;</span>&#123;&#123; foo &#125;&#125;：这是列表内容~~<span class=\"tag\">&lt;/<span class=\"name\">li</span>&gt;</span></span><br><span class=\"line\">                    &#123;% endfor %&#125;</span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">ul</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">nav</span> <span class=\"attr\">aria-label</span>=<span class=\"string\">&quot;Page navigation&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;pull-right&quot;</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">ul</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;pagination&quot;</span>&gt;</span></span><br><span class=\"line\">                        &#123;&#123; html|safe &#125;&#125;</span><br><span class=\"line\">                    <span class=\"tag\">&lt;/<span class=\"name\">ul</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">nav</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n"},{"title":"gorm  简单使用","date":"2021-07-21T06:32:00.000Z","_content":"\t\n\t\n摘要: gorm  简单使用\n<!-- more -->\n\n\n\n## 创建例子\n```\npackage main\n\nimport (\n\t\"fmt\"\n\t\"github.com/jinzhu/gorm\"\n\t_ \"github.com/jinzhu/gorm/dialects/sqlite\"\n)\n\n// UserInfo 用户信息\ntype UserInfo struct {\n\tID uint\n\tName string\n\tGender string\n\tHobby string\n}\n\n\nfunc main() {\n\tdb, err := gorm.Open(\"sqlite3\", \"/db/gorm.db\")\n\tif err != nil {\n\t\tfmt.Println(\"%v\\n\", err)\n\t\tpanic(err)\n\t}\n\tdefer db.Close()\n\n\t// 自动迁移\n\tdb.AutoMigrate(&UserInfo{})\n\n}\n\n```\n\n## 简单 CURD \n\n```\n\n// UserInfo 用户信息\ntype UserInfo struct {\n\tID     uint\n\tName   string\n\tAge    int\n\tGender string\n\tHobby  string\n}\n\nfunc main() {\n\tdb, err := gorm.Open(\"sqlite3\", \"db/gorm.db\")\n\tif err != nil {\n\t\tfmt.Println(\"%v\\n\", err)\n\t\tpanic(err)\n\t}\n\tdefer db.Close()\n\t// 自动迁移\n\tdb.AutoMigrate(&UserInfo{})\n\n\n  // ################\n\t//  添加数据\n\t// ################  \n\t// 定义对象\n\tu1 := UserInfo{1, \"七米\", 18,\"男\", \"篮球\"}\n\tu2 := UserInfo{2, \"沙河娜扎\", 23,\"女\", \"足球\"}\n\n\t// 创建记录\n\tdb.Create(&u1)\n\tdb.Create(&u2)\n\n\n  // ################\n\t//  查询\n\t// ################  \n\n\tvar u = new(UserInfo)\n\tdb.First(u)\n\tfmt.Printf(\"查询一条： %#v\\n\", u)\n\n\t//查询最后一行\n\tvar u3 UserInfo\n\tdb.Last(&u3)\n\tfmt.Printf(\"查询最后一条：%#v\\n\", u3)\n\n\t// 条件查询\n\tvar uu UserInfo\n\tdb.Find(&uu, \"hobby=?\", \"足球\")\n\tfmt.Printf(\"条件查询：%#v\\n\", uu)\n\n\n\n\t// 查看  age大于12 的数据\n\tu4 := []UserInfo{}\n\tdb.Where(\"age>12\").Find(&u4)\n\tfmt.Printf(\"查询age大于12的数据：%#v\\n\", u4)\n\n\t// 查询age大于20的数据\n\tvar n = 20\n\tu5 := []UserInfo{}\n\tdb.Where(\"age>?\", n).Find(&u5) // 动态的数据使用占位符\n\tfmt.Printf(\"传参查询age大于20的数据：%#v\\n\", u5)\n\n\tvar n1 = 10\n\tvar n2 = 20\n\tu6 := []UserInfo{}\n\tdb.Where(\"age > ? AND age < ?\", n1, n2).Find(&u6)\n\tfmt.Printf(\"查询age 范围在10,20的数据：%#v\\n\", u6)\n\n\t// 查询age等于3 5 6的数据\n\tu7 := []UserInfo{}\n\tdb.Where(\"age in (?)\", []int{18, 23, 6}).Find(&u7)\n\tfmt.Printf(\"传参查询age等于的数据：%#v\\n\", u7)\n\n\t// 查询 名称包含 '米' 的数据\n\tu8 := []UserInfo{}\n\tdb.Where(\"name like ?\", \"%米%\").Find(&u8)\n\tfmt.Printf(\"查询名字包含米的名称：%#v\\n\", u8)\n\n\t// 查询id在什么之间\n\tu9 := []UserInfo{}\n\tdb.Where(\"age between ? and ?\", 3, 25).Find(&u9)\n\tfmt.Printf(\"查询ID 的数据：%#v\\n\", u9)\n\n\n\t// Or 条件\n\tu10 := []UserInfo{}\n\tdb.Where(\"age=? OR age=?\", 28, 23).Find(&u10)\n\tfmt.Printf(\"age 为28 或者23 的数据：%#v\\n\", u10)\n\t// 另一种写法\n\tu11 := []UserInfo{}\n\tdb.Where(\"age=?\", 18).Or(\"age=?\", 23).Or(\"id=4\").Find(&u11)\n\tfmt.Printf(\"age 为28 或者23 的数据：%#v\\n\", u11)\n\n\t// 选择字段查询\n\tu12 := []UserInfo{}\n\tdb.Select(\"id, name, age\").Find(&u12)\n\tfmt.Printf(\"选择字段查询：%#v\\n\", u12)\n\n\t/*\n\t   SubQuery 子查询\n\t   models.DB.Table(\"user\").Select(\"avg(age)\").SubQuery()\n\t*/\n\tu13 := []UserInfo{}\n\t// 先查出平均年龄 models.DB.Table(\"user\").Select(\"avg(age)\").SubQuery()\n\t// 在当做参数传给问号\n\t// 在Find一下\n\tdb.Where(\"age<?\",db.Table(\"user_infos\").Select(\"avg(age)\").SubQuery()).Find(&u13)\n\tfmt.Printf(\"子查询：%#v\\n\", u13)\n\n\t//排序\n\tu14 := []UserInfo{}\n\t// id Asc 按照id进行升序排序\n\tdb.Where(\"id>1\").Order(\"id Asc\").Find(&u14)\n\tfmt.Printf(\"升序：%#v\\n\", u14)\n\n\t// desc 降序\n\tu15 := []UserInfo{}\n\tdb.Where(\"id>0\").Order(\"hobby Desc\").Order(\"id Asc\").Find(&u15)\n\tfmt.Printf(\"降序：%#v\\n\", u15)\n\n\t// 只要前面两条\n\tu16 := []UserInfo{}\n\tdb.Where(\"id>1\").Limit(2).Find(&u16)\n\tfmt.Printf(\"查询前面两条：%#v\\n\", u16)\n\n\t// 跳过2条查询2条\n\tu17 := []UserInfo{}\n\tdb.Where(\"id>1\").Offset(2).Limit(2).Find(&u17)\n\tfmt.Printf(\"跳过2条查询2条：%#v\\n\", u17)\n\n\t// 查询总数\n\tvar total int\n\tvar ut = []UserInfo{}\n\tdb.Find(&ut).Count(&total)\n\tfmt.Printf(\"总数,%#v\\n\", total)\n\n  // ################\n\t//  更新\n\t// ################  \n\t//u1 := UserInfo{1, \"七米\", 18,\"男\", \"篮球\"}\n\tdb.Model(&u).Update(\"hobby\", \"双色球\")\n\tfmt.Printf(\"查询一条： %#v\\n\", u)\n\n  // ################\n\t//  删除\n\t// ################  \n\n\tdb.Delete(&u)\n\n}\n\n\n```\n\n## 一对多操作\n\n```\npackage main\n\nimport (\n\t\"fmt\"\n\t\"github.com/jinzhu/gorm\"\n\t_ \"github.com/jinzhu/gorm/dialects/sqlite\"\n\t\"math/rand\"\n\t\"time\"\n)\n\n\n## 一个文章只属于一个分类，一个分类中有多个文章\n\n//文章表\ntype Article struct {\n\tId int `json:\"id\"`\n\tTitle string `json:\"title\"`\n\tCategoryId int `json:\"category_id\"`\n}\n\n//分类表\ntype Category struct {\n\tID int `json:\"id\"`\n\tCategoryName string `json:\"category_name\"`\n\tStatus int `json:\"status\"`\n\tArticles []*Article `gorm:\"foreignkey:Id;ASSOCIATION_FOREIGNKEY:ID\"`\n\tCreatedAt time.Time `json:\"created_at\"`\n\tUpdatedAt time.Time `json:\"updated_at\"`\n}\n\n\nfunc main() {\n\tdb, err := gorm.Open(\"sqlite3\", \"db/gorm.db\")\n\tif err != nil {\n\t\tfmt.Println(\"%v\\n\", err)\n\t\tpanic(err)\n\t}\n\tdb.LogMode(true)\n\tdefer db.Close()\n\t// 自动迁移\n\tdb.AutoMigrate(&Article{},&Category{})\n\n\n  // 添加\n\t//// 添加分类\n\t//fmt.Println(article)\n\t//c1 :=Category{\n\t//\tCategoryName: \"中文\",\n\t//\tStatus: 1,\n\t//}\n\t//c2 := Category{\n\t//\tCategoryName: \"历史\",\n\t//\tStatus: 0,\n\t//}\n\t//db.Create(&c1)\n\t//db.Create(&c2)\n\t//\n\n  //// 添加文章\n\t// article01 := Article{\n\t//\tTitle: \"语言学\",\n\t//\tCategoryId: 1,\n\t//}\n\t//article02 := Article{\n\t//\tTitle: \"散文集\",\n\t//\tCategoryId: 1,\n\t//}\n\t//article03 := Article{\n\t//\tTitle: \"历史魅力\",\n\t//\tCategoryId: 0,\n\t//}\n\t\n\t//db.Create(&article01)\n\t//db.Create(&article02)\n\t//db.Create(&article03)\n\n\t// 预加载查询 \n\tvar cc Category\n\tdb.Where(\"id = ?\",1).First(&cc)\n\n\t// 预加载查询\n\tdb.Preload(\"Articles\").Find(&cc)\n\t// 内链查询\n\tdb.Preload(\"Articles\",\"Title = ?\",\"数学01\").Find(&cc)\n\n\t// 自定义预加载SQL\n\tdb.Preload(\"Articles\", func(db *gorm.DB) *gorm.DB{\n\t\treturn db.Where(\"Title = ?\",\"数学01\")\n\t}).Find(&cc)\n\tfmt.Println(cc)\n\tfmt.Println(cc.CategoryName, cc.Articles)\n\tfmt.Println(cc.Articles[0].Title)\n\tfor k,v := range cc.Articles {\n\t\tfmt.Println(k,\"--\",v.Id,v.Title,v.CategoryId)\n\t}\n\n\t// 链式预加载查询 \n\t\n\n\n\n}\n\n\n\n\n// 随机数生成 RandomString returns a random string with a fixed length\nfunc RandomString(n int, allowedChars ...[]rune) string {\n\tvar defaultLetters = []rune(\"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789\")\n\n\tvar letters []rune\n\n\tif len(allowedChars) == 0 {\n\t\tletters = defaultLetters\n\t} else {\n\t\tletters = allowedChars[0]\n\t}\n\n\tb := make([]rune, n)\n\tfor i := range b {\n\t\tb[i] = letters[rand.Intn(len(letters))]\n\t}\n\n\treturn string(b)\n}\n\n\n\n\n\n\n```\n\n\n## 多对多 操作\n```\npackage main\n\nimport (\n\t\"fmt\"\n\t\"github.com/jinzhu/gorm\"\n\t_ \"github.com/jinzhu/gorm/dialects/sqlite\"\n\t\"math/rand\"\n\t\"time\"\n)\n\n\n//文章表\ntype Article struct {\n\tId         int      `json:\"id\"`\n\tTitle      string   `json:\"title\"`\n\tCategoryId int      `json:\"category_id\"`\n\tCategory   Category `json:\"category\";gorm:\"foreignkey:CategoryID\"` //指定关联外键\n\tTag        []*Tag   `gorm:\"many2many:article_tag\" json:\"tag\"`      //多对多关系.\n\t//article_tag表默认article_id字段对应article表id.tag_id字段对应tag表id\n\t//可以把对应sql日志打印出来,便于调试\n}\n\n//标签表\ntype Tag struct {\n\tId      int    `json:\"id\" `\n\tTagName string `json:\"tag_name\"`\n\tArticles []*Article  `gorm:\"many2many:article_tag\" json:\"article\"`      //多对多关系.\n}\n\n//分类表\ntype Category struct {\n\tID           int       `json:\"id\"`\n\tCategoryName string    `json:\"category_name\"`\n\tStatus       int       `json:\"status\"`\n\tCreatedAt    time.Time `json:\"created_at\"`\n\tUpdatedAt    time.Time `json:\"updated_at\"`\n}\n\nfunc main() {\n\tdb, err := gorm.Open(\"sqlite3\", \"db/gorm.db\")\n\tif err != nil {\n\t\tfmt.Println(\"%v\\n\", err)\n\t\tpanic(err)\n\t}\n\tdb.LogMode(true)\n\tdefer db.Close()\n\t// 自动迁移\n\t//db.AutoMigrate(&Article{},&ArticleTag{},&Tag{},&Category{})\n\t//db.AutoMigrate(&Article{},&Tag{},&Category{})\n\n\t//// 手动添加tag\n\t//newTag01 := Tag{\n\t//\tTagName: \"科学\",\n\t//}\n\t//db.Create(&newTag01)\n\n\n\t//// 添加 Category 类型\n\t//newCategory := Category{\n\t//\tCategoryName: \"Test\",\n\t//\tStatus: 1,\n\t//}\n\t//db.Create(&newCategory)\n\t//fmt.Println(newCategory)\n\n\n\t//// ############ 增加\n\n\t////  01  插入  会重复创建标签并关联\n\t//newArticle := Article{Title: fmt.Sprintf(\"china-01-%s\", RandomString(8)) , Tag: []*Tag{&Tag{TagName: \"中文\"}}}\n\t//db.Create(&newArticle)\n\t//fmt.Println(newArticle)\n\n\t////02 开始已有标签-不必重复添加标签\n\t////后来文章选择已有标签ID进行关联-还是会更新关联\n\t//taglist := []*Tag{}\n\t////db.Where(\"id = 1 \").Find(&taglist)\n\t//db.Where(\"id IN (?)\", []int{1,2}).Find(&taglist)\n\t//newArticle2 := Article{Title: fmt.Sprintf(\"计算机基础02-%s\", RandomString(8)) }\n\t//newArticle2.Tag= taglist\n\t//db.Create(&newArticle2)\n\t//fmt.Println(newArticle2)\n\n\t////03  正确使用添加后关联-这个不会更新关联\n\t//newArticle02 := Article{Title: fmt.Sprintf(\"china-04-%s\", RandomString(8))}\n\t//db.Create(&newArticle02)\n\t//taglist02 := []*Tag{}\n\t////db.First(&taglist02, 1) ## 关联一个\n\t////db.Where(\"id IN (?)\", []int{1,2}).Find(&taglist02)  ## 关联多个\n\t//db.Model(&newArticle02).Association(\"Tag\").Append(taglist02)\n\t//fmt.Println(newArticle02)\n\n\t////04 使用标签关联文章\n\t//newTag := Tag{\n\t//\tTagName: \"数学\",\n\t//}\n\t//db.Create(&newTag)\n\t//\n\t//tag01 := Tag{}\n\t//db.First(&tag01, newTag.Id)\n\t//a := Article{}\n\t//db.First(&a, 2)\n\t//db.Model(&tag01).Association(\"Articles\").Append(a)\n\n\t/// #### 查询\n\t//a := Article{}\n\t//db.First(&a, 2)\n\t// 01 通过 Related 使用 many to many 关联\n\t//db.Model(&a).Related(&a.Tag, \"Tag\")\n\n\t// 02 查找匹配的关联\n\t//db.Debug().Model(&a).Association(\"Tag\").Find(&a.Tag)\n\n\t// 03 预加载分两条查询语句\n\t//a := Article{}\n\t//db.Debug().Preload(\"Tag\").Find(&a, \"id = ?\", 2)\n\t//\n\t//fmt.Print(a.Title + \" : [\")\n\t//for _, tag := range a.Tag {\n\t//\tfmt.Print( tag.TagName + \" \")\n\t//}\n\t//fmt.Print(\"]\")\n\n\n\t// 04 使用标签查询关联的文章\n\t//t := Tag{}\n\t//db.First(&t, 1)\n\t//db.Model(&t).Related(&t.Articles, \"Articles\")\n\t//fmt.Print(t.TagName + \" : \")\n\t//for _, a := range t.Articles {\n\t// fmt.Print(a.Title + \"  \")\n\t//}\n\n\n\t// ### 更新\n\t// 用户对象数据\n\t//a := Article{}\n\t//db.First(&a, 1)\n\t//\n\t//// 使用创建新关联替换当前关联\n\t//// 单个\n\t//\n\t//t := Tag{}\n\t//db.First(&t, 1)\n\t//db.Model(&a).Association(\"Tag\").Replace(t)\n\n\t//多个\n\t//t01 := []*Tag{}\n\t//db.Where(\"id IN (?)\", []uint{1, 2}).Find(&t01)\n\t//db.Model(&a).Association(\"Tag\").Replace(t01)\n\t//fmt.Println(a)\n\n\t// = 清除 =\n\t// ========\n\t////用户对象数据\n\t//a1 := Article{}\n\t//db.First(&a1, 2)\n\t////\n\t//////清空对关联的引用，不会删除关联本身\n\t//db.Model(&a1).Association(\"Tag\").Clear()\n\t////删除关联的引用，不会删除关联本身\n\t////&user.Languages 普通查询为空，需要关联查询得到\n\t//db.Model(&a).Association(\"Tag\").Delete(&a.Tag)\n\n\n\t//// = 删除 =\n\t////  删除时，需要先清空引用后再执行删除\n\t//// ========\n\t//a2 := Article{}\n\t//db.First(&a2, 2)\n\t//\n\t////删除时，需要先清空引用后再执行删除\n\t//db.Debug().Delete(&a2)\n\t////默认软删除，Unscoped()记录删除\n\t//db.Debug().Unscoped().Delete(&a2)\n\t//fmt.Println(a2)\n\n\t// ========\n\t// = 总数 =\n\t// ========\n\t//a3 := Article{}\n\t//db.First(&a3, 2)\n\t//// 获取关联的总数\n\t//count := db.Model(&a3).Association(\"Tag\").Count()\n\t//fmt.Printf(\"\\r\\n关联总数：%d\", count)\n\n\tt3 := Tag{}\n\tdb.First(&t3, 2)\n\t// 获取关联的总数\n\tcount := db.Model(&t3).Association(\"Articles\").Count()\n\tfmt.Printf(\"\\r\\n关联总数：%d\", count)\n\n}\n\n\n\n\n// 随机数生成 RandomString returns a random string with a fixed length\nfunc RandomString(n int, allowedChars ...[]rune) string {\n\tvar defaultLetters = []rune(\"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789\")\n\n\tvar letters []rune\n\n\tif len(allowedChars) == 0 {\n\t\tletters = defaultLetters\n\t} else {\n\t\tletters = allowedChars[0]\n\t}\n\n\tb := make([]rune, n)\n\tfor i := range b {\n\t\tb[i] = letters[rand.Intn(len(letters))]\n\t}\n\n\treturn string(b)\n}\n\n\n```\n","source":"_posts/gorm/gorm简单使用.md","raw":"---\ntitle: gorm  简单使用\ndate: 2021-07-21 14:32\ncategories:\n- go\ntags:\n- gorm\n---\n\t\n\t\n摘要: gorm  简单使用\n<!-- more -->\n\n\n\n## 创建例子\n```\npackage main\n\nimport (\n\t\"fmt\"\n\t\"github.com/jinzhu/gorm\"\n\t_ \"github.com/jinzhu/gorm/dialects/sqlite\"\n)\n\n// UserInfo 用户信息\ntype UserInfo struct {\n\tID uint\n\tName string\n\tGender string\n\tHobby string\n}\n\n\nfunc main() {\n\tdb, err := gorm.Open(\"sqlite3\", \"/db/gorm.db\")\n\tif err != nil {\n\t\tfmt.Println(\"%v\\n\", err)\n\t\tpanic(err)\n\t}\n\tdefer db.Close()\n\n\t// 自动迁移\n\tdb.AutoMigrate(&UserInfo{})\n\n}\n\n```\n\n## 简单 CURD \n\n```\n\n// UserInfo 用户信息\ntype UserInfo struct {\n\tID     uint\n\tName   string\n\tAge    int\n\tGender string\n\tHobby  string\n}\n\nfunc main() {\n\tdb, err := gorm.Open(\"sqlite3\", \"db/gorm.db\")\n\tif err != nil {\n\t\tfmt.Println(\"%v\\n\", err)\n\t\tpanic(err)\n\t}\n\tdefer db.Close()\n\t// 自动迁移\n\tdb.AutoMigrate(&UserInfo{})\n\n\n  // ################\n\t//  添加数据\n\t// ################  \n\t// 定义对象\n\tu1 := UserInfo{1, \"七米\", 18,\"男\", \"篮球\"}\n\tu2 := UserInfo{2, \"沙河娜扎\", 23,\"女\", \"足球\"}\n\n\t// 创建记录\n\tdb.Create(&u1)\n\tdb.Create(&u2)\n\n\n  // ################\n\t//  查询\n\t// ################  \n\n\tvar u = new(UserInfo)\n\tdb.First(u)\n\tfmt.Printf(\"查询一条： %#v\\n\", u)\n\n\t//查询最后一行\n\tvar u3 UserInfo\n\tdb.Last(&u3)\n\tfmt.Printf(\"查询最后一条：%#v\\n\", u3)\n\n\t// 条件查询\n\tvar uu UserInfo\n\tdb.Find(&uu, \"hobby=?\", \"足球\")\n\tfmt.Printf(\"条件查询：%#v\\n\", uu)\n\n\n\n\t// 查看  age大于12 的数据\n\tu4 := []UserInfo{}\n\tdb.Where(\"age>12\").Find(&u4)\n\tfmt.Printf(\"查询age大于12的数据：%#v\\n\", u4)\n\n\t// 查询age大于20的数据\n\tvar n = 20\n\tu5 := []UserInfo{}\n\tdb.Where(\"age>?\", n).Find(&u5) // 动态的数据使用占位符\n\tfmt.Printf(\"传参查询age大于20的数据：%#v\\n\", u5)\n\n\tvar n1 = 10\n\tvar n2 = 20\n\tu6 := []UserInfo{}\n\tdb.Where(\"age > ? AND age < ?\", n1, n2).Find(&u6)\n\tfmt.Printf(\"查询age 范围在10,20的数据：%#v\\n\", u6)\n\n\t// 查询age等于3 5 6的数据\n\tu7 := []UserInfo{}\n\tdb.Where(\"age in (?)\", []int{18, 23, 6}).Find(&u7)\n\tfmt.Printf(\"传参查询age等于的数据：%#v\\n\", u7)\n\n\t// 查询 名称包含 '米' 的数据\n\tu8 := []UserInfo{}\n\tdb.Where(\"name like ?\", \"%米%\").Find(&u8)\n\tfmt.Printf(\"查询名字包含米的名称：%#v\\n\", u8)\n\n\t// 查询id在什么之间\n\tu9 := []UserInfo{}\n\tdb.Where(\"age between ? and ?\", 3, 25).Find(&u9)\n\tfmt.Printf(\"查询ID 的数据：%#v\\n\", u9)\n\n\n\t// Or 条件\n\tu10 := []UserInfo{}\n\tdb.Where(\"age=? OR age=?\", 28, 23).Find(&u10)\n\tfmt.Printf(\"age 为28 或者23 的数据：%#v\\n\", u10)\n\t// 另一种写法\n\tu11 := []UserInfo{}\n\tdb.Where(\"age=?\", 18).Or(\"age=?\", 23).Or(\"id=4\").Find(&u11)\n\tfmt.Printf(\"age 为28 或者23 的数据：%#v\\n\", u11)\n\n\t// 选择字段查询\n\tu12 := []UserInfo{}\n\tdb.Select(\"id, name, age\").Find(&u12)\n\tfmt.Printf(\"选择字段查询：%#v\\n\", u12)\n\n\t/*\n\t   SubQuery 子查询\n\t   models.DB.Table(\"user\").Select(\"avg(age)\").SubQuery()\n\t*/\n\tu13 := []UserInfo{}\n\t// 先查出平均年龄 models.DB.Table(\"user\").Select(\"avg(age)\").SubQuery()\n\t// 在当做参数传给问号\n\t// 在Find一下\n\tdb.Where(\"age<?\",db.Table(\"user_infos\").Select(\"avg(age)\").SubQuery()).Find(&u13)\n\tfmt.Printf(\"子查询：%#v\\n\", u13)\n\n\t//排序\n\tu14 := []UserInfo{}\n\t// id Asc 按照id进行升序排序\n\tdb.Where(\"id>1\").Order(\"id Asc\").Find(&u14)\n\tfmt.Printf(\"升序：%#v\\n\", u14)\n\n\t// desc 降序\n\tu15 := []UserInfo{}\n\tdb.Where(\"id>0\").Order(\"hobby Desc\").Order(\"id Asc\").Find(&u15)\n\tfmt.Printf(\"降序：%#v\\n\", u15)\n\n\t// 只要前面两条\n\tu16 := []UserInfo{}\n\tdb.Where(\"id>1\").Limit(2).Find(&u16)\n\tfmt.Printf(\"查询前面两条：%#v\\n\", u16)\n\n\t// 跳过2条查询2条\n\tu17 := []UserInfo{}\n\tdb.Where(\"id>1\").Offset(2).Limit(2).Find(&u17)\n\tfmt.Printf(\"跳过2条查询2条：%#v\\n\", u17)\n\n\t// 查询总数\n\tvar total int\n\tvar ut = []UserInfo{}\n\tdb.Find(&ut).Count(&total)\n\tfmt.Printf(\"总数,%#v\\n\", total)\n\n  // ################\n\t//  更新\n\t// ################  \n\t//u1 := UserInfo{1, \"七米\", 18,\"男\", \"篮球\"}\n\tdb.Model(&u).Update(\"hobby\", \"双色球\")\n\tfmt.Printf(\"查询一条： %#v\\n\", u)\n\n  // ################\n\t//  删除\n\t// ################  \n\n\tdb.Delete(&u)\n\n}\n\n\n```\n\n## 一对多操作\n\n```\npackage main\n\nimport (\n\t\"fmt\"\n\t\"github.com/jinzhu/gorm\"\n\t_ \"github.com/jinzhu/gorm/dialects/sqlite\"\n\t\"math/rand\"\n\t\"time\"\n)\n\n\n## 一个文章只属于一个分类，一个分类中有多个文章\n\n//文章表\ntype Article struct {\n\tId int `json:\"id\"`\n\tTitle string `json:\"title\"`\n\tCategoryId int `json:\"category_id\"`\n}\n\n//分类表\ntype Category struct {\n\tID int `json:\"id\"`\n\tCategoryName string `json:\"category_name\"`\n\tStatus int `json:\"status\"`\n\tArticles []*Article `gorm:\"foreignkey:Id;ASSOCIATION_FOREIGNKEY:ID\"`\n\tCreatedAt time.Time `json:\"created_at\"`\n\tUpdatedAt time.Time `json:\"updated_at\"`\n}\n\n\nfunc main() {\n\tdb, err := gorm.Open(\"sqlite3\", \"db/gorm.db\")\n\tif err != nil {\n\t\tfmt.Println(\"%v\\n\", err)\n\t\tpanic(err)\n\t}\n\tdb.LogMode(true)\n\tdefer db.Close()\n\t// 自动迁移\n\tdb.AutoMigrate(&Article{},&Category{})\n\n\n  // 添加\n\t//// 添加分类\n\t//fmt.Println(article)\n\t//c1 :=Category{\n\t//\tCategoryName: \"中文\",\n\t//\tStatus: 1,\n\t//}\n\t//c2 := Category{\n\t//\tCategoryName: \"历史\",\n\t//\tStatus: 0,\n\t//}\n\t//db.Create(&c1)\n\t//db.Create(&c2)\n\t//\n\n  //// 添加文章\n\t// article01 := Article{\n\t//\tTitle: \"语言学\",\n\t//\tCategoryId: 1,\n\t//}\n\t//article02 := Article{\n\t//\tTitle: \"散文集\",\n\t//\tCategoryId: 1,\n\t//}\n\t//article03 := Article{\n\t//\tTitle: \"历史魅力\",\n\t//\tCategoryId: 0,\n\t//}\n\t\n\t//db.Create(&article01)\n\t//db.Create(&article02)\n\t//db.Create(&article03)\n\n\t// 预加载查询 \n\tvar cc Category\n\tdb.Where(\"id = ?\",1).First(&cc)\n\n\t// 预加载查询\n\tdb.Preload(\"Articles\").Find(&cc)\n\t// 内链查询\n\tdb.Preload(\"Articles\",\"Title = ?\",\"数学01\").Find(&cc)\n\n\t// 自定义预加载SQL\n\tdb.Preload(\"Articles\", func(db *gorm.DB) *gorm.DB{\n\t\treturn db.Where(\"Title = ?\",\"数学01\")\n\t}).Find(&cc)\n\tfmt.Println(cc)\n\tfmt.Println(cc.CategoryName, cc.Articles)\n\tfmt.Println(cc.Articles[0].Title)\n\tfor k,v := range cc.Articles {\n\t\tfmt.Println(k,\"--\",v.Id,v.Title,v.CategoryId)\n\t}\n\n\t// 链式预加载查询 \n\t\n\n\n\n}\n\n\n\n\n// 随机数生成 RandomString returns a random string with a fixed length\nfunc RandomString(n int, allowedChars ...[]rune) string {\n\tvar defaultLetters = []rune(\"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789\")\n\n\tvar letters []rune\n\n\tif len(allowedChars) == 0 {\n\t\tletters = defaultLetters\n\t} else {\n\t\tletters = allowedChars[0]\n\t}\n\n\tb := make([]rune, n)\n\tfor i := range b {\n\t\tb[i] = letters[rand.Intn(len(letters))]\n\t}\n\n\treturn string(b)\n}\n\n\n\n\n\n\n```\n\n\n## 多对多 操作\n```\npackage main\n\nimport (\n\t\"fmt\"\n\t\"github.com/jinzhu/gorm\"\n\t_ \"github.com/jinzhu/gorm/dialects/sqlite\"\n\t\"math/rand\"\n\t\"time\"\n)\n\n\n//文章表\ntype Article struct {\n\tId         int      `json:\"id\"`\n\tTitle      string   `json:\"title\"`\n\tCategoryId int      `json:\"category_id\"`\n\tCategory   Category `json:\"category\";gorm:\"foreignkey:CategoryID\"` //指定关联外键\n\tTag        []*Tag   `gorm:\"many2many:article_tag\" json:\"tag\"`      //多对多关系.\n\t//article_tag表默认article_id字段对应article表id.tag_id字段对应tag表id\n\t//可以把对应sql日志打印出来,便于调试\n}\n\n//标签表\ntype Tag struct {\n\tId      int    `json:\"id\" `\n\tTagName string `json:\"tag_name\"`\n\tArticles []*Article  `gorm:\"many2many:article_tag\" json:\"article\"`      //多对多关系.\n}\n\n//分类表\ntype Category struct {\n\tID           int       `json:\"id\"`\n\tCategoryName string    `json:\"category_name\"`\n\tStatus       int       `json:\"status\"`\n\tCreatedAt    time.Time `json:\"created_at\"`\n\tUpdatedAt    time.Time `json:\"updated_at\"`\n}\n\nfunc main() {\n\tdb, err := gorm.Open(\"sqlite3\", \"db/gorm.db\")\n\tif err != nil {\n\t\tfmt.Println(\"%v\\n\", err)\n\t\tpanic(err)\n\t}\n\tdb.LogMode(true)\n\tdefer db.Close()\n\t// 自动迁移\n\t//db.AutoMigrate(&Article{},&ArticleTag{},&Tag{},&Category{})\n\t//db.AutoMigrate(&Article{},&Tag{},&Category{})\n\n\t//// 手动添加tag\n\t//newTag01 := Tag{\n\t//\tTagName: \"科学\",\n\t//}\n\t//db.Create(&newTag01)\n\n\n\t//// 添加 Category 类型\n\t//newCategory := Category{\n\t//\tCategoryName: \"Test\",\n\t//\tStatus: 1,\n\t//}\n\t//db.Create(&newCategory)\n\t//fmt.Println(newCategory)\n\n\n\t//// ############ 增加\n\n\t////  01  插入  会重复创建标签并关联\n\t//newArticle := Article{Title: fmt.Sprintf(\"china-01-%s\", RandomString(8)) , Tag: []*Tag{&Tag{TagName: \"中文\"}}}\n\t//db.Create(&newArticle)\n\t//fmt.Println(newArticle)\n\n\t////02 开始已有标签-不必重复添加标签\n\t////后来文章选择已有标签ID进行关联-还是会更新关联\n\t//taglist := []*Tag{}\n\t////db.Where(\"id = 1 \").Find(&taglist)\n\t//db.Where(\"id IN (?)\", []int{1,2}).Find(&taglist)\n\t//newArticle2 := Article{Title: fmt.Sprintf(\"计算机基础02-%s\", RandomString(8)) }\n\t//newArticle2.Tag= taglist\n\t//db.Create(&newArticle2)\n\t//fmt.Println(newArticle2)\n\n\t////03  正确使用添加后关联-这个不会更新关联\n\t//newArticle02 := Article{Title: fmt.Sprintf(\"china-04-%s\", RandomString(8))}\n\t//db.Create(&newArticle02)\n\t//taglist02 := []*Tag{}\n\t////db.First(&taglist02, 1) ## 关联一个\n\t////db.Where(\"id IN (?)\", []int{1,2}).Find(&taglist02)  ## 关联多个\n\t//db.Model(&newArticle02).Association(\"Tag\").Append(taglist02)\n\t//fmt.Println(newArticle02)\n\n\t////04 使用标签关联文章\n\t//newTag := Tag{\n\t//\tTagName: \"数学\",\n\t//}\n\t//db.Create(&newTag)\n\t//\n\t//tag01 := Tag{}\n\t//db.First(&tag01, newTag.Id)\n\t//a := Article{}\n\t//db.First(&a, 2)\n\t//db.Model(&tag01).Association(\"Articles\").Append(a)\n\n\t/// #### 查询\n\t//a := Article{}\n\t//db.First(&a, 2)\n\t// 01 通过 Related 使用 many to many 关联\n\t//db.Model(&a).Related(&a.Tag, \"Tag\")\n\n\t// 02 查找匹配的关联\n\t//db.Debug().Model(&a).Association(\"Tag\").Find(&a.Tag)\n\n\t// 03 预加载分两条查询语句\n\t//a := Article{}\n\t//db.Debug().Preload(\"Tag\").Find(&a, \"id = ?\", 2)\n\t//\n\t//fmt.Print(a.Title + \" : [\")\n\t//for _, tag := range a.Tag {\n\t//\tfmt.Print( tag.TagName + \" \")\n\t//}\n\t//fmt.Print(\"]\")\n\n\n\t// 04 使用标签查询关联的文章\n\t//t := Tag{}\n\t//db.First(&t, 1)\n\t//db.Model(&t).Related(&t.Articles, \"Articles\")\n\t//fmt.Print(t.TagName + \" : \")\n\t//for _, a := range t.Articles {\n\t// fmt.Print(a.Title + \"  \")\n\t//}\n\n\n\t// ### 更新\n\t// 用户对象数据\n\t//a := Article{}\n\t//db.First(&a, 1)\n\t//\n\t//// 使用创建新关联替换当前关联\n\t//// 单个\n\t//\n\t//t := Tag{}\n\t//db.First(&t, 1)\n\t//db.Model(&a).Association(\"Tag\").Replace(t)\n\n\t//多个\n\t//t01 := []*Tag{}\n\t//db.Where(\"id IN (?)\", []uint{1, 2}).Find(&t01)\n\t//db.Model(&a).Association(\"Tag\").Replace(t01)\n\t//fmt.Println(a)\n\n\t// = 清除 =\n\t// ========\n\t////用户对象数据\n\t//a1 := Article{}\n\t//db.First(&a1, 2)\n\t////\n\t//////清空对关联的引用，不会删除关联本身\n\t//db.Model(&a1).Association(\"Tag\").Clear()\n\t////删除关联的引用，不会删除关联本身\n\t////&user.Languages 普通查询为空，需要关联查询得到\n\t//db.Model(&a).Association(\"Tag\").Delete(&a.Tag)\n\n\n\t//// = 删除 =\n\t////  删除时，需要先清空引用后再执行删除\n\t//// ========\n\t//a2 := Article{}\n\t//db.First(&a2, 2)\n\t//\n\t////删除时，需要先清空引用后再执行删除\n\t//db.Debug().Delete(&a2)\n\t////默认软删除，Unscoped()记录删除\n\t//db.Debug().Unscoped().Delete(&a2)\n\t//fmt.Println(a2)\n\n\t// ========\n\t// = 总数 =\n\t// ========\n\t//a3 := Article{}\n\t//db.First(&a3, 2)\n\t//// 获取关联的总数\n\t//count := db.Model(&a3).Association(\"Tag\").Count()\n\t//fmt.Printf(\"\\r\\n关联总数：%d\", count)\n\n\tt3 := Tag{}\n\tdb.First(&t3, 2)\n\t// 获取关联的总数\n\tcount := db.Model(&t3).Association(\"Articles\").Count()\n\tfmt.Printf(\"\\r\\n关联总数：%d\", count)\n\n}\n\n\n\n\n// 随机数生成 RandomString returns a random string with a fixed length\nfunc RandomString(n int, allowedChars ...[]rune) string {\n\tvar defaultLetters = []rune(\"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789\")\n\n\tvar letters []rune\n\n\tif len(allowedChars) == 0 {\n\t\tletters = defaultLetters\n\t} else {\n\t\tletters = allowedChars[0]\n\t}\n\n\tb := make([]rune, n)\n\tfor i := range b {\n\t\tb[i] = letters[rand.Intn(len(letters))]\n\t}\n\n\treturn string(b)\n}\n\n\n```\n","slug":"gorm/gorm简单使用","published":1,"updated":"2021-08-22T07:24:28.620Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cku6979yz002g00uhbz8z2y88","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><p>摘要: gorm  简单使用</p>\n<span id=\"more\"></span>\n\n\n\n<h2 id=\"创建例子\"><a href=\"#创建例子\" class=\"headerlink\" title=\"创建例子\"></a>创建例子</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">package main</span><br><span class=\"line\"></span><br><span class=\"line\">import (</span><br><span class=\"line\">\t&quot;fmt&quot;</span><br><span class=\"line\">\t&quot;github.com&#x2F;jinzhu&#x2F;gorm&quot;</span><br><span class=\"line\">\t_ &quot;github.com&#x2F;jinzhu&#x2F;gorm&#x2F;dialects&#x2F;sqlite&quot;</span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\">&#x2F;&#x2F; UserInfo 用户信息</span><br><span class=\"line\">type UserInfo struct &#123;</span><br><span class=\"line\">\tID uint</span><br><span class=\"line\">\tName string</span><br><span class=\"line\">\tGender string</span><br><span class=\"line\">\tHobby string</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">func main() &#123;</span><br><span class=\"line\">\tdb, err :&#x3D; gorm.Open(&quot;sqlite3&quot;, &quot;&#x2F;db&#x2F;gorm.db&quot;)</span><br><span class=\"line\">\tif err !&#x3D; nil &#123;</span><br><span class=\"line\">\t\tfmt.Println(&quot;%v\\n&quot;, err)</span><br><span class=\"line\">\t\tpanic(err)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tdefer db.Close()</span><br><span class=\"line\"></span><br><span class=\"line\">\t&#x2F;&#x2F; 自动迁移</span><br><span class=\"line\">\tdb.AutoMigrate(&amp;UserInfo&#123;&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"简单-CURD\"><a href=\"#简单-CURD\" class=\"headerlink\" title=\"简单 CURD\"></a>简单 CURD</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">&#x2F;&#x2F; UserInfo 用户信息</span><br><span class=\"line\">type UserInfo struct &#123;</span><br><span class=\"line\">\tID     uint</span><br><span class=\"line\">\tName   string</span><br><span class=\"line\">\tAge    int</span><br><span class=\"line\">\tGender string</span><br><span class=\"line\">\tHobby  string</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">func main() &#123;</span><br><span class=\"line\">\tdb, err :&#x3D; gorm.Open(&quot;sqlite3&quot;, &quot;db&#x2F;gorm.db&quot;)</span><br><span class=\"line\">\tif err !&#x3D; nil &#123;</span><br><span class=\"line\">\t\tfmt.Println(&quot;%v\\n&quot;, err)</span><br><span class=\"line\">\t\tpanic(err)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tdefer db.Close()</span><br><span class=\"line\">\t&#x2F;&#x2F; 自动迁移</span><br><span class=\"line\">\tdb.AutoMigrate(&amp;UserInfo&#123;&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">  &#x2F;&#x2F; ################</span><br><span class=\"line\">\t&#x2F;&#x2F;  添加数据</span><br><span class=\"line\">\t&#x2F;&#x2F; ################  </span><br><span class=\"line\">\t&#x2F;&#x2F; 定义对象</span><br><span class=\"line\">\tu1 :&#x3D; UserInfo&#123;1, &quot;七米&quot;, 18,&quot;男&quot;, &quot;篮球&quot;&#125;</span><br><span class=\"line\">\tu2 :&#x3D; UserInfo&#123;2, &quot;沙河娜扎&quot;, 23,&quot;女&quot;, &quot;足球&quot;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t&#x2F;&#x2F; 创建记录</span><br><span class=\"line\">\tdb.Create(&amp;u1)</span><br><span class=\"line\">\tdb.Create(&amp;u2)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">  &#x2F;&#x2F; ################</span><br><span class=\"line\">\t&#x2F;&#x2F;  查询</span><br><span class=\"line\">\t&#x2F;&#x2F; ################  </span><br><span class=\"line\"></span><br><span class=\"line\">\tvar u &#x3D; new(UserInfo)</span><br><span class=\"line\">\tdb.First(u)</span><br><span class=\"line\">\tfmt.Printf(&quot;查询一条： %#v\\n&quot;, u)</span><br><span class=\"line\"></span><br><span class=\"line\">\t&#x2F;&#x2F;查询最后一行</span><br><span class=\"line\">\tvar u3 UserInfo</span><br><span class=\"line\">\tdb.Last(&amp;u3)</span><br><span class=\"line\">\tfmt.Printf(&quot;查询最后一条：%#v\\n&quot;, u3)</span><br><span class=\"line\"></span><br><span class=\"line\">\t&#x2F;&#x2F; 条件查询</span><br><span class=\"line\">\tvar uu UserInfo</span><br><span class=\"line\">\tdb.Find(&amp;uu, &quot;hobby&#x3D;?&quot;, &quot;足球&quot;)</span><br><span class=\"line\">\tfmt.Printf(&quot;条件查询：%#v\\n&quot;, uu)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t&#x2F;&#x2F; 查看  age大于12 的数据</span><br><span class=\"line\">\tu4 :&#x3D; []UserInfo&#123;&#125;</span><br><span class=\"line\">\tdb.Where(&quot;age&gt;12&quot;).Find(&amp;u4)</span><br><span class=\"line\">\tfmt.Printf(&quot;查询age大于12的数据：%#v\\n&quot;, u4)</span><br><span class=\"line\"></span><br><span class=\"line\">\t&#x2F;&#x2F; 查询age大于20的数据</span><br><span class=\"line\">\tvar n &#x3D; 20</span><br><span class=\"line\">\tu5 :&#x3D; []UserInfo&#123;&#125;</span><br><span class=\"line\">\tdb.Where(&quot;age&gt;?&quot;, n).Find(&amp;u5) &#x2F;&#x2F; 动态的数据使用占位符</span><br><span class=\"line\">\tfmt.Printf(&quot;传参查询age大于20的数据：%#v\\n&quot;, u5)</span><br><span class=\"line\"></span><br><span class=\"line\">\tvar n1 &#x3D; 10</span><br><span class=\"line\">\tvar n2 &#x3D; 20</span><br><span class=\"line\">\tu6 :&#x3D; []UserInfo&#123;&#125;</span><br><span class=\"line\">\tdb.Where(&quot;age &gt; ? AND age &lt; ?&quot;, n1, n2).Find(&amp;u6)</span><br><span class=\"line\">\tfmt.Printf(&quot;查询age 范围在10,20的数据：%#v\\n&quot;, u6)</span><br><span class=\"line\"></span><br><span class=\"line\">\t&#x2F;&#x2F; 查询age等于3 5 6的数据</span><br><span class=\"line\">\tu7 :&#x3D; []UserInfo&#123;&#125;</span><br><span class=\"line\">\tdb.Where(&quot;age in (?)&quot;, []int&#123;18, 23, 6&#125;).Find(&amp;u7)</span><br><span class=\"line\">\tfmt.Printf(&quot;传参查询age等于的数据：%#v\\n&quot;, u7)</span><br><span class=\"line\"></span><br><span class=\"line\">\t&#x2F;&#x2F; 查询 名称包含 &#39;米&#39; 的数据</span><br><span class=\"line\">\tu8 :&#x3D; []UserInfo&#123;&#125;</span><br><span class=\"line\">\tdb.Where(&quot;name like ?&quot;, &quot;%米%&quot;).Find(&amp;u8)</span><br><span class=\"line\">\tfmt.Printf(&quot;查询名字包含米的名称：%#v\\n&quot;, u8)</span><br><span class=\"line\"></span><br><span class=\"line\">\t&#x2F;&#x2F; 查询id在什么之间</span><br><span class=\"line\">\tu9 :&#x3D; []UserInfo&#123;&#125;</span><br><span class=\"line\">\tdb.Where(&quot;age between ? and ?&quot;, 3, 25).Find(&amp;u9)</span><br><span class=\"line\">\tfmt.Printf(&quot;查询ID 的数据：%#v\\n&quot;, u9)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t&#x2F;&#x2F; Or 条件</span><br><span class=\"line\">\tu10 :&#x3D; []UserInfo&#123;&#125;</span><br><span class=\"line\">\tdb.Where(&quot;age&#x3D;? OR age&#x3D;?&quot;, 28, 23).Find(&amp;u10)</span><br><span class=\"line\">\tfmt.Printf(&quot;age 为28 或者23 的数据：%#v\\n&quot;, u10)</span><br><span class=\"line\">\t&#x2F;&#x2F; 另一种写法</span><br><span class=\"line\">\tu11 :&#x3D; []UserInfo&#123;&#125;</span><br><span class=\"line\">\tdb.Where(&quot;age&#x3D;?&quot;, 18).Or(&quot;age&#x3D;?&quot;, 23).Or(&quot;id&#x3D;4&quot;).Find(&amp;u11)</span><br><span class=\"line\">\tfmt.Printf(&quot;age 为28 或者23 的数据：%#v\\n&quot;, u11)</span><br><span class=\"line\"></span><br><span class=\"line\">\t&#x2F;&#x2F; 选择字段查询</span><br><span class=\"line\">\tu12 :&#x3D; []UserInfo&#123;&#125;</span><br><span class=\"line\">\tdb.Select(&quot;id, name, age&quot;).Find(&amp;u12)</span><br><span class=\"line\">\tfmt.Printf(&quot;选择字段查询：%#v\\n&quot;, u12)</span><br><span class=\"line\"></span><br><span class=\"line\">\t&#x2F;*</span><br><span class=\"line\">\t   SubQuery 子查询</span><br><span class=\"line\">\t   models.DB.Table(&quot;user&quot;).Select(&quot;avg(age)&quot;).SubQuery()</span><br><span class=\"line\">\t*&#x2F;</span><br><span class=\"line\">\tu13 :&#x3D; []UserInfo&#123;&#125;</span><br><span class=\"line\">\t&#x2F;&#x2F; 先查出平均年龄 models.DB.Table(&quot;user&quot;).Select(&quot;avg(age)&quot;).SubQuery()</span><br><span class=\"line\">\t&#x2F;&#x2F; 在当做参数传给问号</span><br><span class=\"line\">\t&#x2F;&#x2F; 在Find一下</span><br><span class=\"line\">\tdb.Where(&quot;age&lt;?&quot;,db.Table(&quot;user_infos&quot;).Select(&quot;avg(age)&quot;).SubQuery()).Find(&amp;u13)</span><br><span class=\"line\">\tfmt.Printf(&quot;子查询：%#v\\n&quot;, u13)</span><br><span class=\"line\"></span><br><span class=\"line\">\t&#x2F;&#x2F;排序</span><br><span class=\"line\">\tu14 :&#x3D; []UserInfo&#123;&#125;</span><br><span class=\"line\">\t&#x2F;&#x2F; id Asc 按照id进行升序排序</span><br><span class=\"line\">\tdb.Where(&quot;id&gt;1&quot;).Order(&quot;id Asc&quot;).Find(&amp;u14)</span><br><span class=\"line\">\tfmt.Printf(&quot;升序：%#v\\n&quot;, u14)</span><br><span class=\"line\"></span><br><span class=\"line\">\t&#x2F;&#x2F; desc 降序</span><br><span class=\"line\">\tu15 :&#x3D; []UserInfo&#123;&#125;</span><br><span class=\"line\">\tdb.Where(&quot;id&gt;0&quot;).Order(&quot;hobby Desc&quot;).Order(&quot;id Asc&quot;).Find(&amp;u15)</span><br><span class=\"line\">\tfmt.Printf(&quot;降序：%#v\\n&quot;, u15)</span><br><span class=\"line\"></span><br><span class=\"line\">\t&#x2F;&#x2F; 只要前面两条</span><br><span class=\"line\">\tu16 :&#x3D; []UserInfo&#123;&#125;</span><br><span class=\"line\">\tdb.Where(&quot;id&gt;1&quot;).Limit(2).Find(&amp;u16)</span><br><span class=\"line\">\tfmt.Printf(&quot;查询前面两条：%#v\\n&quot;, u16)</span><br><span class=\"line\"></span><br><span class=\"line\">\t&#x2F;&#x2F; 跳过2条查询2条</span><br><span class=\"line\">\tu17 :&#x3D; []UserInfo&#123;&#125;</span><br><span class=\"line\">\tdb.Where(&quot;id&gt;1&quot;).Offset(2).Limit(2).Find(&amp;u17)</span><br><span class=\"line\">\tfmt.Printf(&quot;跳过2条查询2条：%#v\\n&quot;, u17)</span><br><span class=\"line\"></span><br><span class=\"line\">\t&#x2F;&#x2F; 查询总数</span><br><span class=\"line\">\tvar total int</span><br><span class=\"line\">\tvar ut &#x3D; []UserInfo&#123;&#125;</span><br><span class=\"line\">\tdb.Find(&amp;ut).Count(&amp;total)</span><br><span class=\"line\">\tfmt.Printf(&quot;总数,%#v\\n&quot;, total)</span><br><span class=\"line\"></span><br><span class=\"line\">  &#x2F;&#x2F; ################</span><br><span class=\"line\">\t&#x2F;&#x2F;  更新</span><br><span class=\"line\">\t&#x2F;&#x2F; ################  </span><br><span class=\"line\">\t&#x2F;&#x2F;u1 :&#x3D; UserInfo&#123;1, &quot;七米&quot;, 18,&quot;男&quot;, &quot;篮球&quot;&#125;</span><br><span class=\"line\">\tdb.Model(&amp;u).Update(&quot;hobby&quot;, &quot;双色球&quot;)</span><br><span class=\"line\">\tfmt.Printf(&quot;查询一条： %#v\\n&quot;, u)</span><br><span class=\"line\"></span><br><span class=\"line\">  &#x2F;&#x2F; ################</span><br><span class=\"line\">\t&#x2F;&#x2F;  删除</span><br><span class=\"line\">\t&#x2F;&#x2F; ################  </span><br><span class=\"line\"></span><br><span class=\"line\">\tdb.Delete(&amp;u)</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"一对多操作\"><a href=\"#一对多操作\" class=\"headerlink\" title=\"一对多操作\"></a>一对多操作</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">package main</span><br><span class=\"line\"></span><br><span class=\"line\">import (</span><br><span class=\"line\">\t&quot;fmt&quot;</span><br><span class=\"line\">\t&quot;github.com&#x2F;jinzhu&#x2F;gorm&quot;</span><br><span class=\"line\">\t_ &quot;github.com&#x2F;jinzhu&#x2F;gorm&#x2F;dialects&#x2F;sqlite&quot;</span><br><span class=\"line\">\t&quot;math&#x2F;rand&quot;</span><br><span class=\"line\">\t&quot;time&quot;</span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">## 一个文章只属于一个分类，一个分类中有多个文章</span><br><span class=\"line\"></span><br><span class=\"line\">&#x2F;&#x2F;文章表</span><br><span class=\"line\">type Article struct &#123;</span><br><span class=\"line\">\tId int &#96;json:&quot;id&quot;&#96;</span><br><span class=\"line\">\tTitle string &#96;json:&quot;title&quot;&#96;</span><br><span class=\"line\">\tCategoryId int &#96;json:&quot;category_id&quot;&#96;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#x2F;&#x2F;分类表</span><br><span class=\"line\">type Category struct &#123;</span><br><span class=\"line\">\tID int &#96;json:&quot;id&quot;&#96;</span><br><span class=\"line\">\tCategoryName string &#96;json:&quot;category_name&quot;&#96;</span><br><span class=\"line\">\tStatus int &#96;json:&quot;status&quot;&#96;</span><br><span class=\"line\">\tArticles []*Article &#96;gorm:&quot;foreignkey:Id;ASSOCIATION_FOREIGNKEY:ID&quot;&#96;</span><br><span class=\"line\">\tCreatedAt time.Time &#96;json:&quot;created_at&quot;&#96;</span><br><span class=\"line\">\tUpdatedAt time.Time &#96;json:&quot;updated_at&quot;&#96;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">func main() &#123;</span><br><span class=\"line\">\tdb, err :&#x3D; gorm.Open(&quot;sqlite3&quot;, &quot;db&#x2F;gorm.db&quot;)</span><br><span class=\"line\">\tif err !&#x3D; nil &#123;</span><br><span class=\"line\">\t\tfmt.Println(&quot;%v\\n&quot;, err)</span><br><span class=\"line\">\t\tpanic(err)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tdb.LogMode(true)</span><br><span class=\"line\">\tdefer db.Close()</span><br><span class=\"line\">\t&#x2F;&#x2F; 自动迁移</span><br><span class=\"line\">\tdb.AutoMigrate(&amp;Article&#123;&#125;,&amp;Category&#123;&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">  &#x2F;&#x2F; 添加</span><br><span class=\"line\">\t&#x2F;&#x2F;&#x2F;&#x2F; 添加分类</span><br><span class=\"line\">\t&#x2F;&#x2F;fmt.Println(article)</span><br><span class=\"line\">\t&#x2F;&#x2F;c1 :&#x3D;Category&#123;</span><br><span class=\"line\">\t&#x2F;&#x2F;\tCategoryName: &quot;中文&quot;,</span><br><span class=\"line\">\t&#x2F;&#x2F;\tStatus: 1,</span><br><span class=\"line\">\t&#x2F;&#x2F;&#125;</span><br><span class=\"line\">\t&#x2F;&#x2F;c2 :&#x3D; Category&#123;</span><br><span class=\"line\">\t&#x2F;&#x2F;\tCategoryName: &quot;历史&quot;,</span><br><span class=\"line\">\t&#x2F;&#x2F;\tStatus: 0,</span><br><span class=\"line\">\t&#x2F;&#x2F;&#125;</span><br><span class=\"line\">\t&#x2F;&#x2F;db.Create(&amp;c1)</span><br><span class=\"line\">\t&#x2F;&#x2F;db.Create(&amp;c2)</span><br><span class=\"line\">\t&#x2F;&#x2F;</span><br><span class=\"line\"></span><br><span class=\"line\">  &#x2F;&#x2F;&#x2F;&#x2F; 添加文章</span><br><span class=\"line\">\t&#x2F;&#x2F; article01 :&#x3D; Article&#123;</span><br><span class=\"line\">\t&#x2F;&#x2F;\tTitle: &quot;语言学&quot;,</span><br><span class=\"line\">\t&#x2F;&#x2F;\tCategoryId: 1,</span><br><span class=\"line\">\t&#x2F;&#x2F;&#125;</span><br><span class=\"line\">\t&#x2F;&#x2F;article02 :&#x3D; Article&#123;</span><br><span class=\"line\">\t&#x2F;&#x2F;\tTitle: &quot;散文集&quot;,</span><br><span class=\"line\">\t&#x2F;&#x2F;\tCategoryId: 1,</span><br><span class=\"line\">\t&#x2F;&#x2F;&#125;</span><br><span class=\"line\">\t&#x2F;&#x2F;article03 :&#x3D; Article&#123;</span><br><span class=\"line\">\t&#x2F;&#x2F;\tTitle: &quot;历史魅力&quot;,</span><br><span class=\"line\">\t&#x2F;&#x2F;\tCategoryId: 0,</span><br><span class=\"line\">\t&#x2F;&#x2F;&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t&#x2F;&#x2F;db.Create(&amp;article01)</span><br><span class=\"line\">\t&#x2F;&#x2F;db.Create(&amp;article02)</span><br><span class=\"line\">\t&#x2F;&#x2F;db.Create(&amp;article03)</span><br><span class=\"line\"></span><br><span class=\"line\">\t&#x2F;&#x2F; 预加载查询 </span><br><span class=\"line\">\tvar cc Category</span><br><span class=\"line\">\tdb.Where(&quot;id &#x3D; ?&quot;,1).First(&amp;cc)</span><br><span class=\"line\"></span><br><span class=\"line\">\t&#x2F;&#x2F; 预加载查询</span><br><span class=\"line\">\tdb.Preload(&quot;Articles&quot;).Find(&amp;cc)</span><br><span class=\"line\">\t&#x2F;&#x2F; 内链查询</span><br><span class=\"line\">\tdb.Preload(&quot;Articles&quot;,&quot;Title &#x3D; ?&quot;,&quot;数学01&quot;).Find(&amp;cc)</span><br><span class=\"line\"></span><br><span class=\"line\">\t&#x2F;&#x2F; 自定义预加载SQL</span><br><span class=\"line\">\tdb.Preload(&quot;Articles&quot;, func(db *gorm.DB) *gorm.DB&#123;</span><br><span class=\"line\">\t\treturn db.Where(&quot;Title &#x3D; ?&quot;,&quot;数学01&quot;)</span><br><span class=\"line\">\t&#125;).Find(&amp;cc)</span><br><span class=\"line\">\tfmt.Println(cc)</span><br><span class=\"line\">\tfmt.Println(cc.CategoryName, cc.Articles)</span><br><span class=\"line\">\tfmt.Println(cc.Articles[0].Title)</span><br><span class=\"line\">\tfor k,v :&#x3D; range cc.Articles &#123;</span><br><span class=\"line\">\t\tfmt.Println(k,&quot;--&quot;,v.Id,v.Title,v.CategoryId)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t&#x2F;&#x2F; 链式预加载查询 </span><br><span class=\"line\">\t</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#x2F;&#x2F; 随机数生成 RandomString returns a random string with a fixed length</span><br><span class=\"line\">func RandomString(n int, allowedChars ...[]rune) string &#123;</span><br><span class=\"line\">\tvar defaultLetters &#x3D; []rune(&quot;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&quot;)</span><br><span class=\"line\"></span><br><span class=\"line\">\tvar letters []rune</span><br><span class=\"line\"></span><br><span class=\"line\">\tif len(allowedChars) &#x3D;&#x3D; 0 &#123;</span><br><span class=\"line\">\t\tletters &#x3D; defaultLetters</span><br><span class=\"line\">\t&#125; else &#123;</span><br><span class=\"line\">\t\tletters &#x3D; allowedChars[0]</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\tb :&#x3D; make([]rune, n)</span><br><span class=\"line\">\tfor i :&#x3D; range b &#123;</span><br><span class=\"line\">\t\tb[i] &#x3D; letters[rand.Intn(len(letters))]</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\treturn string(b)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"多对多-操作\"><a href=\"#多对多-操作\" class=\"headerlink\" title=\"多对多 操作\"></a>多对多 操作</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">package main</span><br><span class=\"line\"></span><br><span class=\"line\">import (</span><br><span class=\"line\">\t&quot;fmt&quot;</span><br><span class=\"line\">\t&quot;github.com&#x2F;jinzhu&#x2F;gorm&quot;</span><br><span class=\"line\">\t_ &quot;github.com&#x2F;jinzhu&#x2F;gorm&#x2F;dialects&#x2F;sqlite&quot;</span><br><span class=\"line\">\t&quot;math&#x2F;rand&quot;</span><br><span class=\"line\">\t&quot;time&quot;</span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#x2F;&#x2F;文章表</span><br><span class=\"line\">type Article struct &#123;</span><br><span class=\"line\">\tId         int      &#96;json:&quot;id&quot;&#96;</span><br><span class=\"line\">\tTitle      string   &#96;json:&quot;title&quot;&#96;</span><br><span class=\"line\">\tCategoryId int      &#96;json:&quot;category_id&quot;&#96;</span><br><span class=\"line\">\tCategory   Category &#96;json:&quot;category&quot;;gorm:&quot;foreignkey:CategoryID&quot;&#96; &#x2F;&#x2F;指定关联外键</span><br><span class=\"line\">\tTag        []*Tag   &#96;gorm:&quot;many2many:article_tag&quot; json:&quot;tag&quot;&#96;      &#x2F;&#x2F;多对多关系.</span><br><span class=\"line\">\t&#x2F;&#x2F;article_tag表默认article_id字段对应article表id.tag_id字段对应tag表id</span><br><span class=\"line\">\t&#x2F;&#x2F;可以把对应sql日志打印出来,便于调试</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#x2F;&#x2F;标签表</span><br><span class=\"line\">type Tag struct &#123;</span><br><span class=\"line\">\tId      int    &#96;json:&quot;id&quot; &#96;</span><br><span class=\"line\">\tTagName string &#96;json:&quot;tag_name&quot;&#96;</span><br><span class=\"line\">\tArticles []*Article  &#96;gorm:&quot;many2many:article_tag&quot; json:&quot;article&quot;&#96;      &#x2F;&#x2F;多对多关系.</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#x2F;&#x2F;分类表</span><br><span class=\"line\">type Category struct &#123;</span><br><span class=\"line\">\tID           int       &#96;json:&quot;id&quot;&#96;</span><br><span class=\"line\">\tCategoryName string    &#96;json:&quot;category_name&quot;&#96;</span><br><span class=\"line\">\tStatus       int       &#96;json:&quot;status&quot;&#96;</span><br><span class=\"line\">\tCreatedAt    time.Time &#96;json:&quot;created_at&quot;&#96;</span><br><span class=\"line\">\tUpdatedAt    time.Time &#96;json:&quot;updated_at&quot;&#96;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">func main() &#123;</span><br><span class=\"line\">\tdb, err :&#x3D; gorm.Open(&quot;sqlite3&quot;, &quot;db&#x2F;gorm.db&quot;)</span><br><span class=\"line\">\tif err !&#x3D; nil &#123;</span><br><span class=\"line\">\t\tfmt.Println(&quot;%v\\n&quot;, err)</span><br><span class=\"line\">\t\tpanic(err)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tdb.LogMode(true)</span><br><span class=\"line\">\tdefer db.Close()</span><br><span class=\"line\">\t&#x2F;&#x2F; 自动迁移</span><br><span class=\"line\">\t&#x2F;&#x2F;db.AutoMigrate(&amp;Article&#123;&#125;,&amp;ArticleTag&#123;&#125;,&amp;Tag&#123;&#125;,&amp;Category&#123;&#125;)</span><br><span class=\"line\">\t&#x2F;&#x2F;db.AutoMigrate(&amp;Article&#123;&#125;,&amp;Tag&#123;&#125;,&amp;Category&#123;&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">\t&#x2F;&#x2F;&#x2F;&#x2F; 手动添加tag</span><br><span class=\"line\">\t&#x2F;&#x2F;newTag01 :&#x3D; Tag&#123;</span><br><span class=\"line\">\t&#x2F;&#x2F;\tTagName: &quot;科学&quot;,</span><br><span class=\"line\">\t&#x2F;&#x2F;&#125;</span><br><span class=\"line\">\t&#x2F;&#x2F;db.Create(&amp;newTag01)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t&#x2F;&#x2F;&#x2F;&#x2F; 添加 Category 类型</span><br><span class=\"line\">\t&#x2F;&#x2F;newCategory :&#x3D; Category&#123;</span><br><span class=\"line\">\t&#x2F;&#x2F;\tCategoryName: &quot;Test&quot;,</span><br><span class=\"line\">\t&#x2F;&#x2F;\tStatus: 1,</span><br><span class=\"line\">\t&#x2F;&#x2F;&#125;</span><br><span class=\"line\">\t&#x2F;&#x2F;db.Create(&amp;newCategory)</span><br><span class=\"line\">\t&#x2F;&#x2F;fmt.Println(newCategory)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t&#x2F;&#x2F;&#x2F;&#x2F; ############ 增加</span><br><span class=\"line\"></span><br><span class=\"line\">\t&#x2F;&#x2F;&#x2F;&#x2F;  01  插入  会重复创建标签并关联</span><br><span class=\"line\">\t&#x2F;&#x2F;newArticle :&#x3D; Article&#123;Title: fmt.Sprintf(&quot;china-01-%s&quot;, RandomString(8)) , Tag: []*Tag&#123;&amp;Tag&#123;TagName: &quot;中文&quot;&#125;&#125;&#125;</span><br><span class=\"line\">\t&#x2F;&#x2F;db.Create(&amp;newArticle)</span><br><span class=\"line\">\t&#x2F;&#x2F;fmt.Println(newArticle)</span><br><span class=\"line\"></span><br><span class=\"line\">\t&#x2F;&#x2F;&#x2F;&#x2F;02 开始已有标签-不必重复添加标签</span><br><span class=\"line\">\t&#x2F;&#x2F;&#x2F;&#x2F;后来文章选择已有标签ID进行关联-还是会更新关联</span><br><span class=\"line\">\t&#x2F;&#x2F;taglist :&#x3D; []*Tag&#123;&#125;</span><br><span class=\"line\">\t&#x2F;&#x2F;&#x2F;&#x2F;db.Where(&quot;id &#x3D; 1 &quot;).Find(&amp;taglist)</span><br><span class=\"line\">\t&#x2F;&#x2F;db.Where(&quot;id IN (?)&quot;, []int&#123;1,2&#125;).Find(&amp;taglist)</span><br><span class=\"line\">\t&#x2F;&#x2F;newArticle2 :&#x3D; Article&#123;Title: fmt.Sprintf(&quot;计算机基础02-%s&quot;, RandomString(8)) &#125;</span><br><span class=\"line\">\t&#x2F;&#x2F;newArticle2.Tag&#x3D; taglist</span><br><span class=\"line\">\t&#x2F;&#x2F;db.Create(&amp;newArticle2)</span><br><span class=\"line\">\t&#x2F;&#x2F;fmt.Println(newArticle2)</span><br><span class=\"line\"></span><br><span class=\"line\">\t&#x2F;&#x2F;&#x2F;&#x2F;03  正确使用添加后关联-这个不会更新关联</span><br><span class=\"line\">\t&#x2F;&#x2F;newArticle02 :&#x3D; Article&#123;Title: fmt.Sprintf(&quot;china-04-%s&quot;, RandomString(8))&#125;</span><br><span class=\"line\">\t&#x2F;&#x2F;db.Create(&amp;newArticle02)</span><br><span class=\"line\">\t&#x2F;&#x2F;taglist02 :&#x3D; []*Tag&#123;&#125;</span><br><span class=\"line\">\t&#x2F;&#x2F;&#x2F;&#x2F;db.First(&amp;taglist02, 1) ## 关联一个</span><br><span class=\"line\">\t&#x2F;&#x2F;&#x2F;&#x2F;db.Where(&quot;id IN (?)&quot;, []int&#123;1,2&#125;).Find(&amp;taglist02)  ## 关联多个</span><br><span class=\"line\">\t&#x2F;&#x2F;db.Model(&amp;newArticle02).Association(&quot;Tag&quot;).Append(taglist02)</span><br><span class=\"line\">\t&#x2F;&#x2F;fmt.Println(newArticle02)</span><br><span class=\"line\"></span><br><span class=\"line\">\t&#x2F;&#x2F;&#x2F;&#x2F;04 使用标签关联文章</span><br><span class=\"line\">\t&#x2F;&#x2F;newTag :&#x3D; Tag&#123;</span><br><span class=\"line\">\t&#x2F;&#x2F;\tTagName: &quot;数学&quot;,</span><br><span class=\"line\">\t&#x2F;&#x2F;&#125;</span><br><span class=\"line\">\t&#x2F;&#x2F;db.Create(&amp;newTag)</span><br><span class=\"line\">\t&#x2F;&#x2F;</span><br><span class=\"line\">\t&#x2F;&#x2F;tag01 :&#x3D; Tag&#123;&#125;</span><br><span class=\"line\">\t&#x2F;&#x2F;db.First(&amp;tag01, newTag.Id)</span><br><span class=\"line\">\t&#x2F;&#x2F;a :&#x3D; Article&#123;&#125;</span><br><span class=\"line\">\t&#x2F;&#x2F;db.First(&amp;a, 2)</span><br><span class=\"line\">\t&#x2F;&#x2F;db.Model(&amp;tag01).Association(&quot;Articles&quot;).Append(a)</span><br><span class=\"line\"></span><br><span class=\"line\">\t&#x2F;&#x2F;&#x2F; #### 查询</span><br><span class=\"line\">\t&#x2F;&#x2F;a :&#x3D; Article&#123;&#125;</span><br><span class=\"line\">\t&#x2F;&#x2F;db.First(&amp;a, 2)</span><br><span class=\"line\">\t&#x2F;&#x2F; 01 通过 Related 使用 many to many 关联</span><br><span class=\"line\">\t&#x2F;&#x2F;db.Model(&amp;a).Related(&amp;a.Tag, &quot;Tag&quot;)</span><br><span class=\"line\"></span><br><span class=\"line\">\t&#x2F;&#x2F; 02 查找匹配的关联</span><br><span class=\"line\">\t&#x2F;&#x2F;db.Debug().Model(&amp;a).Association(&quot;Tag&quot;).Find(&amp;a.Tag)</span><br><span class=\"line\"></span><br><span class=\"line\">\t&#x2F;&#x2F; 03 预加载分两条查询语句</span><br><span class=\"line\">\t&#x2F;&#x2F;a :&#x3D; Article&#123;&#125;</span><br><span class=\"line\">\t&#x2F;&#x2F;db.Debug().Preload(&quot;Tag&quot;).Find(&amp;a, &quot;id &#x3D; ?&quot;, 2)</span><br><span class=\"line\">\t&#x2F;&#x2F;</span><br><span class=\"line\">\t&#x2F;&#x2F;fmt.Print(a.Title + &quot; : [&quot;)</span><br><span class=\"line\">\t&#x2F;&#x2F;for _, tag :&#x3D; range a.Tag &#123;</span><br><span class=\"line\">\t&#x2F;&#x2F;\tfmt.Print( tag.TagName + &quot; &quot;)</span><br><span class=\"line\">\t&#x2F;&#x2F;&#125;</span><br><span class=\"line\">\t&#x2F;&#x2F;fmt.Print(&quot;]&quot;)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t&#x2F;&#x2F; 04 使用标签查询关联的文章</span><br><span class=\"line\">\t&#x2F;&#x2F;t :&#x3D; Tag&#123;&#125;</span><br><span class=\"line\">\t&#x2F;&#x2F;db.First(&amp;t, 1)</span><br><span class=\"line\">\t&#x2F;&#x2F;db.Model(&amp;t).Related(&amp;t.Articles, &quot;Articles&quot;)</span><br><span class=\"line\">\t&#x2F;&#x2F;fmt.Print(t.TagName + &quot; : &quot;)</span><br><span class=\"line\">\t&#x2F;&#x2F;for _, a :&#x3D; range t.Articles &#123;</span><br><span class=\"line\">\t&#x2F;&#x2F; fmt.Print(a.Title + &quot;  &quot;)</span><br><span class=\"line\">\t&#x2F;&#x2F;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t&#x2F;&#x2F; ### 更新</span><br><span class=\"line\">\t&#x2F;&#x2F; 用户对象数据</span><br><span class=\"line\">\t&#x2F;&#x2F;a :&#x3D; Article&#123;&#125;</span><br><span class=\"line\">\t&#x2F;&#x2F;db.First(&amp;a, 1)</span><br><span class=\"line\">\t&#x2F;&#x2F;</span><br><span class=\"line\">\t&#x2F;&#x2F;&#x2F;&#x2F; 使用创建新关联替换当前关联</span><br><span class=\"line\">\t&#x2F;&#x2F;&#x2F;&#x2F; 单个</span><br><span class=\"line\">\t&#x2F;&#x2F;</span><br><span class=\"line\">\t&#x2F;&#x2F;t :&#x3D; Tag&#123;&#125;</span><br><span class=\"line\">\t&#x2F;&#x2F;db.First(&amp;t, 1)</span><br><span class=\"line\">\t&#x2F;&#x2F;db.Model(&amp;a).Association(&quot;Tag&quot;).Replace(t)</span><br><span class=\"line\"></span><br><span class=\"line\">\t&#x2F;&#x2F;多个</span><br><span class=\"line\">\t&#x2F;&#x2F;t01 :&#x3D; []*Tag&#123;&#125;</span><br><span class=\"line\">\t&#x2F;&#x2F;db.Where(&quot;id IN (?)&quot;, []uint&#123;1, 2&#125;).Find(&amp;t01)</span><br><span class=\"line\">\t&#x2F;&#x2F;db.Model(&amp;a).Association(&quot;Tag&quot;).Replace(t01)</span><br><span class=\"line\">\t&#x2F;&#x2F;fmt.Println(a)</span><br><span class=\"line\"></span><br><span class=\"line\">\t&#x2F;&#x2F; &#x3D; 清除 &#x3D;</span><br><span class=\"line\">\t&#x2F;&#x2F; &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class=\"line\">\t&#x2F;&#x2F;&#x2F;&#x2F;用户对象数据</span><br><span class=\"line\">\t&#x2F;&#x2F;a1 :&#x3D; Article&#123;&#125;</span><br><span class=\"line\">\t&#x2F;&#x2F;db.First(&amp;a1, 2)</span><br><span class=\"line\">\t&#x2F;&#x2F;&#x2F;&#x2F;</span><br><span class=\"line\">\t&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;清空对关联的引用，不会删除关联本身</span><br><span class=\"line\">\t&#x2F;&#x2F;db.Model(&amp;a1).Association(&quot;Tag&quot;).Clear()</span><br><span class=\"line\">\t&#x2F;&#x2F;&#x2F;&#x2F;删除关联的引用，不会删除关联本身</span><br><span class=\"line\">\t&#x2F;&#x2F;&#x2F;&#x2F;&amp;user.Languages 普通查询为空，需要关联查询得到</span><br><span class=\"line\">\t&#x2F;&#x2F;db.Model(&amp;a).Association(&quot;Tag&quot;).Delete(&amp;a.Tag)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t&#x2F;&#x2F;&#x2F;&#x2F; &#x3D; 删除 &#x3D;</span><br><span class=\"line\">\t&#x2F;&#x2F;&#x2F;&#x2F;  删除时，需要先清空引用后再执行删除</span><br><span class=\"line\">\t&#x2F;&#x2F;&#x2F;&#x2F; &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class=\"line\">\t&#x2F;&#x2F;a2 :&#x3D; Article&#123;&#125;</span><br><span class=\"line\">\t&#x2F;&#x2F;db.First(&amp;a2, 2)</span><br><span class=\"line\">\t&#x2F;&#x2F;</span><br><span class=\"line\">\t&#x2F;&#x2F;&#x2F;&#x2F;删除时，需要先清空引用后再执行删除</span><br><span class=\"line\">\t&#x2F;&#x2F;db.Debug().Delete(&amp;a2)</span><br><span class=\"line\">\t&#x2F;&#x2F;&#x2F;&#x2F;默认软删除，Unscoped()记录删除</span><br><span class=\"line\">\t&#x2F;&#x2F;db.Debug().Unscoped().Delete(&amp;a2)</span><br><span class=\"line\">\t&#x2F;&#x2F;fmt.Println(a2)</span><br><span class=\"line\"></span><br><span class=\"line\">\t&#x2F;&#x2F; &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class=\"line\">\t&#x2F;&#x2F; &#x3D; 总数 &#x3D;</span><br><span class=\"line\">\t&#x2F;&#x2F; &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class=\"line\">\t&#x2F;&#x2F;a3 :&#x3D; Article&#123;&#125;</span><br><span class=\"line\">\t&#x2F;&#x2F;db.First(&amp;a3, 2)</span><br><span class=\"line\">\t&#x2F;&#x2F;&#x2F;&#x2F; 获取关联的总数</span><br><span class=\"line\">\t&#x2F;&#x2F;count :&#x3D; db.Model(&amp;a3).Association(&quot;Tag&quot;).Count()</span><br><span class=\"line\">\t&#x2F;&#x2F;fmt.Printf(&quot;\\r\\n关联总数：%d&quot;, count)</span><br><span class=\"line\"></span><br><span class=\"line\">\tt3 :&#x3D; Tag&#123;&#125;</span><br><span class=\"line\">\tdb.First(&amp;t3, 2)</span><br><span class=\"line\">\t&#x2F;&#x2F; 获取关联的总数</span><br><span class=\"line\">\tcount :&#x3D; db.Model(&amp;t3).Association(&quot;Articles&quot;).Count()</span><br><span class=\"line\">\tfmt.Printf(&quot;\\r\\n关联总数：%d&quot;, count)</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#x2F;&#x2F; 随机数生成 RandomString returns a random string with a fixed length</span><br><span class=\"line\">func RandomString(n int, allowedChars ...[]rune) string &#123;</span><br><span class=\"line\">\tvar defaultLetters &#x3D; []rune(&quot;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&quot;)</span><br><span class=\"line\"></span><br><span class=\"line\">\tvar letters []rune</span><br><span class=\"line\"></span><br><span class=\"line\">\tif len(allowedChars) &#x3D;&#x3D; 0 &#123;</span><br><span class=\"line\">\t\tletters &#x3D; defaultLetters</span><br><span class=\"line\">\t&#125; else &#123;</span><br><span class=\"line\">\t\tletters &#x3D; allowedChars[0]</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\tb :&#x3D; make([]rune, n)</span><br><span class=\"line\">\tfor i :&#x3D; range b &#123;</span><br><span class=\"line\">\t\tb[i] &#x3D; letters[rand.Intn(len(letters))]</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\treturn string(b)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"<p>摘要: gorm  简单使用</p>","more":"<h2 id=\"创建例子\"><a href=\"#创建例子\" class=\"headerlink\" title=\"创建例子\"></a>创建例子</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">package main</span><br><span class=\"line\"></span><br><span class=\"line\">import (</span><br><span class=\"line\">\t&quot;fmt&quot;</span><br><span class=\"line\">\t&quot;github.com&#x2F;jinzhu&#x2F;gorm&quot;</span><br><span class=\"line\">\t_ &quot;github.com&#x2F;jinzhu&#x2F;gorm&#x2F;dialects&#x2F;sqlite&quot;</span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\">&#x2F;&#x2F; UserInfo 用户信息</span><br><span class=\"line\">type UserInfo struct &#123;</span><br><span class=\"line\">\tID uint</span><br><span class=\"line\">\tName string</span><br><span class=\"line\">\tGender string</span><br><span class=\"line\">\tHobby string</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">func main() &#123;</span><br><span class=\"line\">\tdb, err :&#x3D; gorm.Open(&quot;sqlite3&quot;, &quot;&#x2F;db&#x2F;gorm.db&quot;)</span><br><span class=\"line\">\tif err !&#x3D; nil &#123;</span><br><span class=\"line\">\t\tfmt.Println(&quot;%v\\n&quot;, err)</span><br><span class=\"line\">\t\tpanic(err)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tdefer db.Close()</span><br><span class=\"line\"></span><br><span class=\"line\">\t&#x2F;&#x2F; 自动迁移</span><br><span class=\"line\">\tdb.AutoMigrate(&amp;UserInfo&#123;&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"简单-CURD\"><a href=\"#简单-CURD\" class=\"headerlink\" title=\"简单 CURD\"></a>简单 CURD</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">&#x2F;&#x2F; UserInfo 用户信息</span><br><span class=\"line\">type UserInfo struct &#123;</span><br><span class=\"line\">\tID     uint</span><br><span class=\"line\">\tName   string</span><br><span class=\"line\">\tAge    int</span><br><span class=\"line\">\tGender string</span><br><span class=\"line\">\tHobby  string</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">func main() &#123;</span><br><span class=\"line\">\tdb, err :&#x3D; gorm.Open(&quot;sqlite3&quot;, &quot;db&#x2F;gorm.db&quot;)</span><br><span class=\"line\">\tif err !&#x3D; nil &#123;</span><br><span class=\"line\">\t\tfmt.Println(&quot;%v\\n&quot;, err)</span><br><span class=\"line\">\t\tpanic(err)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tdefer db.Close()</span><br><span class=\"line\">\t&#x2F;&#x2F; 自动迁移</span><br><span class=\"line\">\tdb.AutoMigrate(&amp;UserInfo&#123;&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">  &#x2F;&#x2F; ################</span><br><span class=\"line\">\t&#x2F;&#x2F;  添加数据</span><br><span class=\"line\">\t&#x2F;&#x2F; ################  </span><br><span class=\"line\">\t&#x2F;&#x2F; 定义对象</span><br><span class=\"line\">\tu1 :&#x3D; UserInfo&#123;1, &quot;七米&quot;, 18,&quot;男&quot;, &quot;篮球&quot;&#125;</span><br><span class=\"line\">\tu2 :&#x3D; UserInfo&#123;2, &quot;沙河娜扎&quot;, 23,&quot;女&quot;, &quot;足球&quot;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t&#x2F;&#x2F; 创建记录</span><br><span class=\"line\">\tdb.Create(&amp;u1)</span><br><span class=\"line\">\tdb.Create(&amp;u2)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">  &#x2F;&#x2F; ################</span><br><span class=\"line\">\t&#x2F;&#x2F;  查询</span><br><span class=\"line\">\t&#x2F;&#x2F; ################  </span><br><span class=\"line\"></span><br><span class=\"line\">\tvar u &#x3D; new(UserInfo)</span><br><span class=\"line\">\tdb.First(u)</span><br><span class=\"line\">\tfmt.Printf(&quot;查询一条： %#v\\n&quot;, u)</span><br><span class=\"line\"></span><br><span class=\"line\">\t&#x2F;&#x2F;查询最后一行</span><br><span class=\"line\">\tvar u3 UserInfo</span><br><span class=\"line\">\tdb.Last(&amp;u3)</span><br><span class=\"line\">\tfmt.Printf(&quot;查询最后一条：%#v\\n&quot;, u3)</span><br><span class=\"line\"></span><br><span class=\"line\">\t&#x2F;&#x2F; 条件查询</span><br><span class=\"line\">\tvar uu UserInfo</span><br><span class=\"line\">\tdb.Find(&amp;uu, &quot;hobby&#x3D;?&quot;, &quot;足球&quot;)</span><br><span class=\"line\">\tfmt.Printf(&quot;条件查询：%#v\\n&quot;, uu)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t&#x2F;&#x2F; 查看  age大于12 的数据</span><br><span class=\"line\">\tu4 :&#x3D; []UserInfo&#123;&#125;</span><br><span class=\"line\">\tdb.Where(&quot;age&gt;12&quot;).Find(&amp;u4)</span><br><span class=\"line\">\tfmt.Printf(&quot;查询age大于12的数据：%#v\\n&quot;, u4)</span><br><span class=\"line\"></span><br><span class=\"line\">\t&#x2F;&#x2F; 查询age大于20的数据</span><br><span class=\"line\">\tvar n &#x3D; 20</span><br><span class=\"line\">\tu5 :&#x3D; []UserInfo&#123;&#125;</span><br><span class=\"line\">\tdb.Where(&quot;age&gt;?&quot;, n).Find(&amp;u5) &#x2F;&#x2F; 动态的数据使用占位符</span><br><span class=\"line\">\tfmt.Printf(&quot;传参查询age大于20的数据：%#v\\n&quot;, u5)</span><br><span class=\"line\"></span><br><span class=\"line\">\tvar n1 &#x3D; 10</span><br><span class=\"line\">\tvar n2 &#x3D; 20</span><br><span class=\"line\">\tu6 :&#x3D; []UserInfo&#123;&#125;</span><br><span class=\"line\">\tdb.Where(&quot;age &gt; ? AND age &lt; ?&quot;, n1, n2).Find(&amp;u6)</span><br><span class=\"line\">\tfmt.Printf(&quot;查询age 范围在10,20的数据：%#v\\n&quot;, u6)</span><br><span class=\"line\"></span><br><span class=\"line\">\t&#x2F;&#x2F; 查询age等于3 5 6的数据</span><br><span class=\"line\">\tu7 :&#x3D; []UserInfo&#123;&#125;</span><br><span class=\"line\">\tdb.Where(&quot;age in (?)&quot;, []int&#123;18, 23, 6&#125;).Find(&amp;u7)</span><br><span class=\"line\">\tfmt.Printf(&quot;传参查询age等于的数据：%#v\\n&quot;, u7)</span><br><span class=\"line\"></span><br><span class=\"line\">\t&#x2F;&#x2F; 查询 名称包含 &#39;米&#39; 的数据</span><br><span class=\"line\">\tu8 :&#x3D; []UserInfo&#123;&#125;</span><br><span class=\"line\">\tdb.Where(&quot;name like ?&quot;, &quot;%米%&quot;).Find(&amp;u8)</span><br><span class=\"line\">\tfmt.Printf(&quot;查询名字包含米的名称：%#v\\n&quot;, u8)</span><br><span class=\"line\"></span><br><span class=\"line\">\t&#x2F;&#x2F; 查询id在什么之间</span><br><span class=\"line\">\tu9 :&#x3D; []UserInfo&#123;&#125;</span><br><span class=\"line\">\tdb.Where(&quot;age between ? and ?&quot;, 3, 25).Find(&amp;u9)</span><br><span class=\"line\">\tfmt.Printf(&quot;查询ID 的数据：%#v\\n&quot;, u9)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t&#x2F;&#x2F; Or 条件</span><br><span class=\"line\">\tu10 :&#x3D; []UserInfo&#123;&#125;</span><br><span class=\"line\">\tdb.Where(&quot;age&#x3D;? OR age&#x3D;?&quot;, 28, 23).Find(&amp;u10)</span><br><span class=\"line\">\tfmt.Printf(&quot;age 为28 或者23 的数据：%#v\\n&quot;, u10)</span><br><span class=\"line\">\t&#x2F;&#x2F; 另一种写法</span><br><span class=\"line\">\tu11 :&#x3D; []UserInfo&#123;&#125;</span><br><span class=\"line\">\tdb.Where(&quot;age&#x3D;?&quot;, 18).Or(&quot;age&#x3D;?&quot;, 23).Or(&quot;id&#x3D;4&quot;).Find(&amp;u11)</span><br><span class=\"line\">\tfmt.Printf(&quot;age 为28 或者23 的数据：%#v\\n&quot;, u11)</span><br><span class=\"line\"></span><br><span class=\"line\">\t&#x2F;&#x2F; 选择字段查询</span><br><span class=\"line\">\tu12 :&#x3D; []UserInfo&#123;&#125;</span><br><span class=\"line\">\tdb.Select(&quot;id, name, age&quot;).Find(&amp;u12)</span><br><span class=\"line\">\tfmt.Printf(&quot;选择字段查询：%#v\\n&quot;, u12)</span><br><span class=\"line\"></span><br><span class=\"line\">\t&#x2F;*</span><br><span class=\"line\">\t   SubQuery 子查询</span><br><span class=\"line\">\t   models.DB.Table(&quot;user&quot;).Select(&quot;avg(age)&quot;).SubQuery()</span><br><span class=\"line\">\t*&#x2F;</span><br><span class=\"line\">\tu13 :&#x3D; []UserInfo&#123;&#125;</span><br><span class=\"line\">\t&#x2F;&#x2F; 先查出平均年龄 models.DB.Table(&quot;user&quot;).Select(&quot;avg(age)&quot;).SubQuery()</span><br><span class=\"line\">\t&#x2F;&#x2F; 在当做参数传给问号</span><br><span class=\"line\">\t&#x2F;&#x2F; 在Find一下</span><br><span class=\"line\">\tdb.Where(&quot;age&lt;?&quot;,db.Table(&quot;user_infos&quot;).Select(&quot;avg(age)&quot;).SubQuery()).Find(&amp;u13)</span><br><span class=\"line\">\tfmt.Printf(&quot;子查询：%#v\\n&quot;, u13)</span><br><span class=\"line\"></span><br><span class=\"line\">\t&#x2F;&#x2F;排序</span><br><span class=\"line\">\tu14 :&#x3D; []UserInfo&#123;&#125;</span><br><span class=\"line\">\t&#x2F;&#x2F; id Asc 按照id进行升序排序</span><br><span class=\"line\">\tdb.Where(&quot;id&gt;1&quot;).Order(&quot;id Asc&quot;).Find(&amp;u14)</span><br><span class=\"line\">\tfmt.Printf(&quot;升序：%#v\\n&quot;, u14)</span><br><span class=\"line\"></span><br><span class=\"line\">\t&#x2F;&#x2F; desc 降序</span><br><span class=\"line\">\tu15 :&#x3D; []UserInfo&#123;&#125;</span><br><span class=\"line\">\tdb.Where(&quot;id&gt;0&quot;).Order(&quot;hobby Desc&quot;).Order(&quot;id Asc&quot;).Find(&amp;u15)</span><br><span class=\"line\">\tfmt.Printf(&quot;降序：%#v\\n&quot;, u15)</span><br><span class=\"line\"></span><br><span class=\"line\">\t&#x2F;&#x2F; 只要前面两条</span><br><span class=\"line\">\tu16 :&#x3D; []UserInfo&#123;&#125;</span><br><span class=\"line\">\tdb.Where(&quot;id&gt;1&quot;).Limit(2).Find(&amp;u16)</span><br><span class=\"line\">\tfmt.Printf(&quot;查询前面两条：%#v\\n&quot;, u16)</span><br><span class=\"line\"></span><br><span class=\"line\">\t&#x2F;&#x2F; 跳过2条查询2条</span><br><span class=\"line\">\tu17 :&#x3D; []UserInfo&#123;&#125;</span><br><span class=\"line\">\tdb.Where(&quot;id&gt;1&quot;).Offset(2).Limit(2).Find(&amp;u17)</span><br><span class=\"line\">\tfmt.Printf(&quot;跳过2条查询2条：%#v\\n&quot;, u17)</span><br><span class=\"line\"></span><br><span class=\"line\">\t&#x2F;&#x2F; 查询总数</span><br><span class=\"line\">\tvar total int</span><br><span class=\"line\">\tvar ut &#x3D; []UserInfo&#123;&#125;</span><br><span class=\"line\">\tdb.Find(&amp;ut).Count(&amp;total)</span><br><span class=\"line\">\tfmt.Printf(&quot;总数,%#v\\n&quot;, total)</span><br><span class=\"line\"></span><br><span class=\"line\">  &#x2F;&#x2F; ################</span><br><span class=\"line\">\t&#x2F;&#x2F;  更新</span><br><span class=\"line\">\t&#x2F;&#x2F; ################  </span><br><span class=\"line\">\t&#x2F;&#x2F;u1 :&#x3D; UserInfo&#123;1, &quot;七米&quot;, 18,&quot;男&quot;, &quot;篮球&quot;&#125;</span><br><span class=\"line\">\tdb.Model(&amp;u).Update(&quot;hobby&quot;, &quot;双色球&quot;)</span><br><span class=\"line\">\tfmt.Printf(&quot;查询一条： %#v\\n&quot;, u)</span><br><span class=\"line\"></span><br><span class=\"line\">  &#x2F;&#x2F; ################</span><br><span class=\"line\">\t&#x2F;&#x2F;  删除</span><br><span class=\"line\">\t&#x2F;&#x2F; ################  </span><br><span class=\"line\"></span><br><span class=\"line\">\tdb.Delete(&amp;u)</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"一对多操作\"><a href=\"#一对多操作\" class=\"headerlink\" title=\"一对多操作\"></a>一对多操作</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">package main</span><br><span class=\"line\"></span><br><span class=\"line\">import (</span><br><span class=\"line\">\t&quot;fmt&quot;</span><br><span class=\"line\">\t&quot;github.com&#x2F;jinzhu&#x2F;gorm&quot;</span><br><span class=\"line\">\t_ &quot;github.com&#x2F;jinzhu&#x2F;gorm&#x2F;dialects&#x2F;sqlite&quot;</span><br><span class=\"line\">\t&quot;math&#x2F;rand&quot;</span><br><span class=\"line\">\t&quot;time&quot;</span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">## 一个文章只属于一个分类，一个分类中有多个文章</span><br><span class=\"line\"></span><br><span class=\"line\">&#x2F;&#x2F;文章表</span><br><span class=\"line\">type Article struct &#123;</span><br><span class=\"line\">\tId int &#96;json:&quot;id&quot;&#96;</span><br><span class=\"line\">\tTitle string &#96;json:&quot;title&quot;&#96;</span><br><span class=\"line\">\tCategoryId int &#96;json:&quot;category_id&quot;&#96;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#x2F;&#x2F;分类表</span><br><span class=\"line\">type Category struct &#123;</span><br><span class=\"line\">\tID int &#96;json:&quot;id&quot;&#96;</span><br><span class=\"line\">\tCategoryName string &#96;json:&quot;category_name&quot;&#96;</span><br><span class=\"line\">\tStatus int &#96;json:&quot;status&quot;&#96;</span><br><span class=\"line\">\tArticles []*Article &#96;gorm:&quot;foreignkey:Id;ASSOCIATION_FOREIGNKEY:ID&quot;&#96;</span><br><span class=\"line\">\tCreatedAt time.Time &#96;json:&quot;created_at&quot;&#96;</span><br><span class=\"line\">\tUpdatedAt time.Time &#96;json:&quot;updated_at&quot;&#96;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">func main() &#123;</span><br><span class=\"line\">\tdb, err :&#x3D; gorm.Open(&quot;sqlite3&quot;, &quot;db&#x2F;gorm.db&quot;)</span><br><span class=\"line\">\tif err !&#x3D; nil &#123;</span><br><span class=\"line\">\t\tfmt.Println(&quot;%v\\n&quot;, err)</span><br><span class=\"line\">\t\tpanic(err)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tdb.LogMode(true)</span><br><span class=\"line\">\tdefer db.Close()</span><br><span class=\"line\">\t&#x2F;&#x2F; 自动迁移</span><br><span class=\"line\">\tdb.AutoMigrate(&amp;Article&#123;&#125;,&amp;Category&#123;&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">  &#x2F;&#x2F; 添加</span><br><span class=\"line\">\t&#x2F;&#x2F;&#x2F;&#x2F; 添加分类</span><br><span class=\"line\">\t&#x2F;&#x2F;fmt.Println(article)</span><br><span class=\"line\">\t&#x2F;&#x2F;c1 :&#x3D;Category&#123;</span><br><span class=\"line\">\t&#x2F;&#x2F;\tCategoryName: &quot;中文&quot;,</span><br><span class=\"line\">\t&#x2F;&#x2F;\tStatus: 1,</span><br><span class=\"line\">\t&#x2F;&#x2F;&#125;</span><br><span class=\"line\">\t&#x2F;&#x2F;c2 :&#x3D; Category&#123;</span><br><span class=\"line\">\t&#x2F;&#x2F;\tCategoryName: &quot;历史&quot;,</span><br><span class=\"line\">\t&#x2F;&#x2F;\tStatus: 0,</span><br><span class=\"line\">\t&#x2F;&#x2F;&#125;</span><br><span class=\"line\">\t&#x2F;&#x2F;db.Create(&amp;c1)</span><br><span class=\"line\">\t&#x2F;&#x2F;db.Create(&amp;c2)</span><br><span class=\"line\">\t&#x2F;&#x2F;</span><br><span class=\"line\"></span><br><span class=\"line\">  &#x2F;&#x2F;&#x2F;&#x2F; 添加文章</span><br><span class=\"line\">\t&#x2F;&#x2F; article01 :&#x3D; Article&#123;</span><br><span class=\"line\">\t&#x2F;&#x2F;\tTitle: &quot;语言学&quot;,</span><br><span class=\"line\">\t&#x2F;&#x2F;\tCategoryId: 1,</span><br><span class=\"line\">\t&#x2F;&#x2F;&#125;</span><br><span class=\"line\">\t&#x2F;&#x2F;article02 :&#x3D; Article&#123;</span><br><span class=\"line\">\t&#x2F;&#x2F;\tTitle: &quot;散文集&quot;,</span><br><span class=\"line\">\t&#x2F;&#x2F;\tCategoryId: 1,</span><br><span class=\"line\">\t&#x2F;&#x2F;&#125;</span><br><span class=\"line\">\t&#x2F;&#x2F;article03 :&#x3D; Article&#123;</span><br><span class=\"line\">\t&#x2F;&#x2F;\tTitle: &quot;历史魅力&quot;,</span><br><span class=\"line\">\t&#x2F;&#x2F;\tCategoryId: 0,</span><br><span class=\"line\">\t&#x2F;&#x2F;&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t&#x2F;&#x2F;db.Create(&amp;article01)</span><br><span class=\"line\">\t&#x2F;&#x2F;db.Create(&amp;article02)</span><br><span class=\"line\">\t&#x2F;&#x2F;db.Create(&amp;article03)</span><br><span class=\"line\"></span><br><span class=\"line\">\t&#x2F;&#x2F; 预加载查询 </span><br><span class=\"line\">\tvar cc Category</span><br><span class=\"line\">\tdb.Where(&quot;id &#x3D; ?&quot;,1).First(&amp;cc)</span><br><span class=\"line\"></span><br><span class=\"line\">\t&#x2F;&#x2F; 预加载查询</span><br><span class=\"line\">\tdb.Preload(&quot;Articles&quot;).Find(&amp;cc)</span><br><span class=\"line\">\t&#x2F;&#x2F; 内链查询</span><br><span class=\"line\">\tdb.Preload(&quot;Articles&quot;,&quot;Title &#x3D; ?&quot;,&quot;数学01&quot;).Find(&amp;cc)</span><br><span class=\"line\"></span><br><span class=\"line\">\t&#x2F;&#x2F; 自定义预加载SQL</span><br><span class=\"line\">\tdb.Preload(&quot;Articles&quot;, func(db *gorm.DB) *gorm.DB&#123;</span><br><span class=\"line\">\t\treturn db.Where(&quot;Title &#x3D; ?&quot;,&quot;数学01&quot;)</span><br><span class=\"line\">\t&#125;).Find(&amp;cc)</span><br><span class=\"line\">\tfmt.Println(cc)</span><br><span class=\"line\">\tfmt.Println(cc.CategoryName, cc.Articles)</span><br><span class=\"line\">\tfmt.Println(cc.Articles[0].Title)</span><br><span class=\"line\">\tfor k,v :&#x3D; range cc.Articles &#123;</span><br><span class=\"line\">\t\tfmt.Println(k,&quot;--&quot;,v.Id,v.Title,v.CategoryId)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t&#x2F;&#x2F; 链式预加载查询 </span><br><span class=\"line\">\t</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#x2F;&#x2F; 随机数生成 RandomString returns a random string with a fixed length</span><br><span class=\"line\">func RandomString(n int, allowedChars ...[]rune) string &#123;</span><br><span class=\"line\">\tvar defaultLetters &#x3D; []rune(&quot;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&quot;)</span><br><span class=\"line\"></span><br><span class=\"line\">\tvar letters []rune</span><br><span class=\"line\"></span><br><span class=\"line\">\tif len(allowedChars) &#x3D;&#x3D; 0 &#123;</span><br><span class=\"line\">\t\tletters &#x3D; defaultLetters</span><br><span class=\"line\">\t&#125; else &#123;</span><br><span class=\"line\">\t\tletters &#x3D; allowedChars[0]</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\tb :&#x3D; make([]rune, n)</span><br><span class=\"line\">\tfor i :&#x3D; range b &#123;</span><br><span class=\"line\">\t\tb[i] &#x3D; letters[rand.Intn(len(letters))]</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\treturn string(b)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"多对多-操作\"><a href=\"#多对多-操作\" class=\"headerlink\" title=\"多对多 操作\"></a>多对多 操作</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">package main</span><br><span class=\"line\"></span><br><span class=\"line\">import (</span><br><span class=\"line\">\t&quot;fmt&quot;</span><br><span class=\"line\">\t&quot;github.com&#x2F;jinzhu&#x2F;gorm&quot;</span><br><span class=\"line\">\t_ &quot;github.com&#x2F;jinzhu&#x2F;gorm&#x2F;dialects&#x2F;sqlite&quot;</span><br><span class=\"line\">\t&quot;math&#x2F;rand&quot;</span><br><span class=\"line\">\t&quot;time&quot;</span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#x2F;&#x2F;文章表</span><br><span class=\"line\">type Article struct &#123;</span><br><span class=\"line\">\tId         int      &#96;json:&quot;id&quot;&#96;</span><br><span class=\"line\">\tTitle      string   &#96;json:&quot;title&quot;&#96;</span><br><span class=\"line\">\tCategoryId int      &#96;json:&quot;category_id&quot;&#96;</span><br><span class=\"line\">\tCategory   Category &#96;json:&quot;category&quot;;gorm:&quot;foreignkey:CategoryID&quot;&#96; &#x2F;&#x2F;指定关联外键</span><br><span class=\"line\">\tTag        []*Tag   &#96;gorm:&quot;many2many:article_tag&quot; json:&quot;tag&quot;&#96;      &#x2F;&#x2F;多对多关系.</span><br><span class=\"line\">\t&#x2F;&#x2F;article_tag表默认article_id字段对应article表id.tag_id字段对应tag表id</span><br><span class=\"line\">\t&#x2F;&#x2F;可以把对应sql日志打印出来,便于调试</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#x2F;&#x2F;标签表</span><br><span class=\"line\">type Tag struct &#123;</span><br><span class=\"line\">\tId      int    &#96;json:&quot;id&quot; &#96;</span><br><span class=\"line\">\tTagName string &#96;json:&quot;tag_name&quot;&#96;</span><br><span class=\"line\">\tArticles []*Article  &#96;gorm:&quot;many2many:article_tag&quot; json:&quot;article&quot;&#96;      &#x2F;&#x2F;多对多关系.</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#x2F;&#x2F;分类表</span><br><span class=\"line\">type Category struct &#123;</span><br><span class=\"line\">\tID           int       &#96;json:&quot;id&quot;&#96;</span><br><span class=\"line\">\tCategoryName string    &#96;json:&quot;category_name&quot;&#96;</span><br><span class=\"line\">\tStatus       int       &#96;json:&quot;status&quot;&#96;</span><br><span class=\"line\">\tCreatedAt    time.Time &#96;json:&quot;created_at&quot;&#96;</span><br><span class=\"line\">\tUpdatedAt    time.Time &#96;json:&quot;updated_at&quot;&#96;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">func main() &#123;</span><br><span class=\"line\">\tdb, err :&#x3D; gorm.Open(&quot;sqlite3&quot;, &quot;db&#x2F;gorm.db&quot;)</span><br><span class=\"line\">\tif err !&#x3D; nil &#123;</span><br><span class=\"line\">\t\tfmt.Println(&quot;%v\\n&quot;, err)</span><br><span class=\"line\">\t\tpanic(err)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tdb.LogMode(true)</span><br><span class=\"line\">\tdefer db.Close()</span><br><span class=\"line\">\t&#x2F;&#x2F; 自动迁移</span><br><span class=\"line\">\t&#x2F;&#x2F;db.AutoMigrate(&amp;Article&#123;&#125;,&amp;ArticleTag&#123;&#125;,&amp;Tag&#123;&#125;,&amp;Category&#123;&#125;)</span><br><span class=\"line\">\t&#x2F;&#x2F;db.AutoMigrate(&amp;Article&#123;&#125;,&amp;Tag&#123;&#125;,&amp;Category&#123;&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">\t&#x2F;&#x2F;&#x2F;&#x2F; 手动添加tag</span><br><span class=\"line\">\t&#x2F;&#x2F;newTag01 :&#x3D; Tag&#123;</span><br><span class=\"line\">\t&#x2F;&#x2F;\tTagName: &quot;科学&quot;,</span><br><span class=\"line\">\t&#x2F;&#x2F;&#125;</span><br><span class=\"line\">\t&#x2F;&#x2F;db.Create(&amp;newTag01)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t&#x2F;&#x2F;&#x2F;&#x2F; 添加 Category 类型</span><br><span class=\"line\">\t&#x2F;&#x2F;newCategory :&#x3D; Category&#123;</span><br><span class=\"line\">\t&#x2F;&#x2F;\tCategoryName: &quot;Test&quot;,</span><br><span class=\"line\">\t&#x2F;&#x2F;\tStatus: 1,</span><br><span class=\"line\">\t&#x2F;&#x2F;&#125;</span><br><span class=\"line\">\t&#x2F;&#x2F;db.Create(&amp;newCategory)</span><br><span class=\"line\">\t&#x2F;&#x2F;fmt.Println(newCategory)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t&#x2F;&#x2F;&#x2F;&#x2F; ############ 增加</span><br><span class=\"line\"></span><br><span class=\"line\">\t&#x2F;&#x2F;&#x2F;&#x2F;  01  插入  会重复创建标签并关联</span><br><span class=\"line\">\t&#x2F;&#x2F;newArticle :&#x3D; Article&#123;Title: fmt.Sprintf(&quot;china-01-%s&quot;, RandomString(8)) , Tag: []*Tag&#123;&amp;Tag&#123;TagName: &quot;中文&quot;&#125;&#125;&#125;</span><br><span class=\"line\">\t&#x2F;&#x2F;db.Create(&amp;newArticle)</span><br><span class=\"line\">\t&#x2F;&#x2F;fmt.Println(newArticle)</span><br><span class=\"line\"></span><br><span class=\"line\">\t&#x2F;&#x2F;&#x2F;&#x2F;02 开始已有标签-不必重复添加标签</span><br><span class=\"line\">\t&#x2F;&#x2F;&#x2F;&#x2F;后来文章选择已有标签ID进行关联-还是会更新关联</span><br><span class=\"line\">\t&#x2F;&#x2F;taglist :&#x3D; []*Tag&#123;&#125;</span><br><span class=\"line\">\t&#x2F;&#x2F;&#x2F;&#x2F;db.Where(&quot;id &#x3D; 1 &quot;).Find(&amp;taglist)</span><br><span class=\"line\">\t&#x2F;&#x2F;db.Where(&quot;id IN (?)&quot;, []int&#123;1,2&#125;).Find(&amp;taglist)</span><br><span class=\"line\">\t&#x2F;&#x2F;newArticle2 :&#x3D; Article&#123;Title: fmt.Sprintf(&quot;计算机基础02-%s&quot;, RandomString(8)) &#125;</span><br><span class=\"line\">\t&#x2F;&#x2F;newArticle2.Tag&#x3D; taglist</span><br><span class=\"line\">\t&#x2F;&#x2F;db.Create(&amp;newArticle2)</span><br><span class=\"line\">\t&#x2F;&#x2F;fmt.Println(newArticle2)</span><br><span class=\"line\"></span><br><span class=\"line\">\t&#x2F;&#x2F;&#x2F;&#x2F;03  正确使用添加后关联-这个不会更新关联</span><br><span class=\"line\">\t&#x2F;&#x2F;newArticle02 :&#x3D; Article&#123;Title: fmt.Sprintf(&quot;china-04-%s&quot;, RandomString(8))&#125;</span><br><span class=\"line\">\t&#x2F;&#x2F;db.Create(&amp;newArticle02)</span><br><span class=\"line\">\t&#x2F;&#x2F;taglist02 :&#x3D; []*Tag&#123;&#125;</span><br><span class=\"line\">\t&#x2F;&#x2F;&#x2F;&#x2F;db.First(&amp;taglist02, 1) ## 关联一个</span><br><span class=\"line\">\t&#x2F;&#x2F;&#x2F;&#x2F;db.Where(&quot;id IN (?)&quot;, []int&#123;1,2&#125;).Find(&amp;taglist02)  ## 关联多个</span><br><span class=\"line\">\t&#x2F;&#x2F;db.Model(&amp;newArticle02).Association(&quot;Tag&quot;).Append(taglist02)</span><br><span class=\"line\">\t&#x2F;&#x2F;fmt.Println(newArticle02)</span><br><span class=\"line\"></span><br><span class=\"line\">\t&#x2F;&#x2F;&#x2F;&#x2F;04 使用标签关联文章</span><br><span class=\"line\">\t&#x2F;&#x2F;newTag :&#x3D; Tag&#123;</span><br><span class=\"line\">\t&#x2F;&#x2F;\tTagName: &quot;数学&quot;,</span><br><span class=\"line\">\t&#x2F;&#x2F;&#125;</span><br><span class=\"line\">\t&#x2F;&#x2F;db.Create(&amp;newTag)</span><br><span class=\"line\">\t&#x2F;&#x2F;</span><br><span class=\"line\">\t&#x2F;&#x2F;tag01 :&#x3D; Tag&#123;&#125;</span><br><span class=\"line\">\t&#x2F;&#x2F;db.First(&amp;tag01, newTag.Id)</span><br><span class=\"line\">\t&#x2F;&#x2F;a :&#x3D; Article&#123;&#125;</span><br><span class=\"line\">\t&#x2F;&#x2F;db.First(&amp;a, 2)</span><br><span class=\"line\">\t&#x2F;&#x2F;db.Model(&amp;tag01).Association(&quot;Articles&quot;).Append(a)</span><br><span class=\"line\"></span><br><span class=\"line\">\t&#x2F;&#x2F;&#x2F; #### 查询</span><br><span class=\"line\">\t&#x2F;&#x2F;a :&#x3D; Article&#123;&#125;</span><br><span class=\"line\">\t&#x2F;&#x2F;db.First(&amp;a, 2)</span><br><span class=\"line\">\t&#x2F;&#x2F; 01 通过 Related 使用 many to many 关联</span><br><span class=\"line\">\t&#x2F;&#x2F;db.Model(&amp;a).Related(&amp;a.Tag, &quot;Tag&quot;)</span><br><span class=\"line\"></span><br><span class=\"line\">\t&#x2F;&#x2F; 02 查找匹配的关联</span><br><span class=\"line\">\t&#x2F;&#x2F;db.Debug().Model(&amp;a).Association(&quot;Tag&quot;).Find(&amp;a.Tag)</span><br><span class=\"line\"></span><br><span class=\"line\">\t&#x2F;&#x2F; 03 预加载分两条查询语句</span><br><span class=\"line\">\t&#x2F;&#x2F;a :&#x3D; Article&#123;&#125;</span><br><span class=\"line\">\t&#x2F;&#x2F;db.Debug().Preload(&quot;Tag&quot;).Find(&amp;a, &quot;id &#x3D; ?&quot;, 2)</span><br><span class=\"line\">\t&#x2F;&#x2F;</span><br><span class=\"line\">\t&#x2F;&#x2F;fmt.Print(a.Title + &quot; : [&quot;)</span><br><span class=\"line\">\t&#x2F;&#x2F;for _, tag :&#x3D; range a.Tag &#123;</span><br><span class=\"line\">\t&#x2F;&#x2F;\tfmt.Print( tag.TagName + &quot; &quot;)</span><br><span class=\"line\">\t&#x2F;&#x2F;&#125;</span><br><span class=\"line\">\t&#x2F;&#x2F;fmt.Print(&quot;]&quot;)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t&#x2F;&#x2F; 04 使用标签查询关联的文章</span><br><span class=\"line\">\t&#x2F;&#x2F;t :&#x3D; Tag&#123;&#125;</span><br><span class=\"line\">\t&#x2F;&#x2F;db.First(&amp;t, 1)</span><br><span class=\"line\">\t&#x2F;&#x2F;db.Model(&amp;t).Related(&amp;t.Articles, &quot;Articles&quot;)</span><br><span class=\"line\">\t&#x2F;&#x2F;fmt.Print(t.TagName + &quot; : &quot;)</span><br><span class=\"line\">\t&#x2F;&#x2F;for _, a :&#x3D; range t.Articles &#123;</span><br><span class=\"line\">\t&#x2F;&#x2F; fmt.Print(a.Title + &quot;  &quot;)</span><br><span class=\"line\">\t&#x2F;&#x2F;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t&#x2F;&#x2F; ### 更新</span><br><span class=\"line\">\t&#x2F;&#x2F; 用户对象数据</span><br><span class=\"line\">\t&#x2F;&#x2F;a :&#x3D; Article&#123;&#125;</span><br><span class=\"line\">\t&#x2F;&#x2F;db.First(&amp;a, 1)</span><br><span class=\"line\">\t&#x2F;&#x2F;</span><br><span class=\"line\">\t&#x2F;&#x2F;&#x2F;&#x2F; 使用创建新关联替换当前关联</span><br><span class=\"line\">\t&#x2F;&#x2F;&#x2F;&#x2F; 单个</span><br><span class=\"line\">\t&#x2F;&#x2F;</span><br><span class=\"line\">\t&#x2F;&#x2F;t :&#x3D; Tag&#123;&#125;</span><br><span class=\"line\">\t&#x2F;&#x2F;db.First(&amp;t, 1)</span><br><span class=\"line\">\t&#x2F;&#x2F;db.Model(&amp;a).Association(&quot;Tag&quot;).Replace(t)</span><br><span class=\"line\"></span><br><span class=\"line\">\t&#x2F;&#x2F;多个</span><br><span class=\"line\">\t&#x2F;&#x2F;t01 :&#x3D; []*Tag&#123;&#125;</span><br><span class=\"line\">\t&#x2F;&#x2F;db.Where(&quot;id IN (?)&quot;, []uint&#123;1, 2&#125;).Find(&amp;t01)</span><br><span class=\"line\">\t&#x2F;&#x2F;db.Model(&amp;a).Association(&quot;Tag&quot;).Replace(t01)</span><br><span class=\"line\">\t&#x2F;&#x2F;fmt.Println(a)</span><br><span class=\"line\"></span><br><span class=\"line\">\t&#x2F;&#x2F; &#x3D; 清除 &#x3D;</span><br><span class=\"line\">\t&#x2F;&#x2F; &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class=\"line\">\t&#x2F;&#x2F;&#x2F;&#x2F;用户对象数据</span><br><span class=\"line\">\t&#x2F;&#x2F;a1 :&#x3D; Article&#123;&#125;</span><br><span class=\"line\">\t&#x2F;&#x2F;db.First(&amp;a1, 2)</span><br><span class=\"line\">\t&#x2F;&#x2F;&#x2F;&#x2F;</span><br><span class=\"line\">\t&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;清空对关联的引用，不会删除关联本身</span><br><span class=\"line\">\t&#x2F;&#x2F;db.Model(&amp;a1).Association(&quot;Tag&quot;).Clear()</span><br><span class=\"line\">\t&#x2F;&#x2F;&#x2F;&#x2F;删除关联的引用，不会删除关联本身</span><br><span class=\"line\">\t&#x2F;&#x2F;&#x2F;&#x2F;&amp;user.Languages 普通查询为空，需要关联查询得到</span><br><span class=\"line\">\t&#x2F;&#x2F;db.Model(&amp;a).Association(&quot;Tag&quot;).Delete(&amp;a.Tag)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t&#x2F;&#x2F;&#x2F;&#x2F; &#x3D; 删除 &#x3D;</span><br><span class=\"line\">\t&#x2F;&#x2F;&#x2F;&#x2F;  删除时，需要先清空引用后再执行删除</span><br><span class=\"line\">\t&#x2F;&#x2F;&#x2F;&#x2F; &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class=\"line\">\t&#x2F;&#x2F;a2 :&#x3D; Article&#123;&#125;</span><br><span class=\"line\">\t&#x2F;&#x2F;db.First(&amp;a2, 2)</span><br><span class=\"line\">\t&#x2F;&#x2F;</span><br><span class=\"line\">\t&#x2F;&#x2F;&#x2F;&#x2F;删除时，需要先清空引用后再执行删除</span><br><span class=\"line\">\t&#x2F;&#x2F;db.Debug().Delete(&amp;a2)</span><br><span class=\"line\">\t&#x2F;&#x2F;&#x2F;&#x2F;默认软删除，Unscoped()记录删除</span><br><span class=\"line\">\t&#x2F;&#x2F;db.Debug().Unscoped().Delete(&amp;a2)</span><br><span class=\"line\">\t&#x2F;&#x2F;fmt.Println(a2)</span><br><span class=\"line\"></span><br><span class=\"line\">\t&#x2F;&#x2F; &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class=\"line\">\t&#x2F;&#x2F; &#x3D; 总数 &#x3D;</span><br><span class=\"line\">\t&#x2F;&#x2F; &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class=\"line\">\t&#x2F;&#x2F;a3 :&#x3D; Article&#123;&#125;</span><br><span class=\"line\">\t&#x2F;&#x2F;db.First(&amp;a3, 2)</span><br><span class=\"line\">\t&#x2F;&#x2F;&#x2F;&#x2F; 获取关联的总数</span><br><span class=\"line\">\t&#x2F;&#x2F;count :&#x3D; db.Model(&amp;a3).Association(&quot;Tag&quot;).Count()</span><br><span class=\"line\">\t&#x2F;&#x2F;fmt.Printf(&quot;\\r\\n关联总数：%d&quot;, count)</span><br><span class=\"line\"></span><br><span class=\"line\">\tt3 :&#x3D; Tag&#123;&#125;</span><br><span class=\"line\">\tdb.First(&amp;t3, 2)</span><br><span class=\"line\">\t&#x2F;&#x2F; 获取关联的总数</span><br><span class=\"line\">\tcount :&#x3D; db.Model(&amp;t3).Association(&quot;Articles&quot;).Count()</span><br><span class=\"line\">\tfmt.Printf(&quot;\\r\\n关联总数：%d&quot;, count)</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#x2F;&#x2F; 随机数生成 RandomString returns a random string with a fixed length</span><br><span class=\"line\">func RandomString(n int, allowedChars ...[]rune) string &#123;</span><br><span class=\"line\">\tvar defaultLetters &#x3D; []rune(&quot;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&quot;)</span><br><span class=\"line\"></span><br><span class=\"line\">\tvar letters []rune</span><br><span class=\"line\"></span><br><span class=\"line\">\tif len(allowedChars) &#x3D;&#x3D; 0 &#123;</span><br><span class=\"line\">\t\tletters &#x3D; defaultLetters</span><br><span class=\"line\">\t&#125; else &#123;</span><br><span class=\"line\">\t\tletters &#x3D; allowedChars[0]</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\tb :&#x3D; make([]rune, n)</span><br><span class=\"line\">\tfor i :&#x3D; range b &#123;</span><br><span class=\"line\">\t\tb[i] &#x3D; letters[rand.Intn(len(letters))]</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\treturn string(b)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>"},{"title":"jenkins 常见问题","date":"2019-12-18T02:00:00.000Z","_content":"\n\n\n\n\n### jenkins 工作目录修改\n\n**旧**：\n\n```\n系统管理→系统设置→主目录（的右边问号下面）→高级（是不是忽略了啊\\(^o^)/~）→工作空间根目录\n```\n\n点开后面的问号可以看见3个参数（配置路径需要的）：\n\n1. - `${JENKINS_HOME}` — **Jenkins** home directory.#JENKINS_HOME这个参数不用说了\n   - `${ITEM_ROOTDIR}` — Root directory of a job for which the default workspace is allocated.#ITEM_ROOTDIR：默认的工作空间目录。完整的路径就是JENKINS_HOME/jobs/xxxx/workspace \n   - `${ITEM_FULL_NAME}` — '/'-separated job name, like \"foo/bar\".#ITEM_FULL_NAME：job的名称，这个就是我们需要的。\n\n 我们只需要把workspace目录赶出JENKINS_HOME目录就行了。上配置：\n\n```\nworkspace：/home/froad/workspace/${ITEM_FULL_NAME}#前面的目录随便你改，只需要在最后带上${ITEM_FULL_NAME}JENKINS_HOME：/home/froad/.jenkins#给你们对比着看\n#好了，这下.svn目录不打架了。我也不用头疼了。\n```\n\n删除已经存在的workspace目录\n\n```\nfind . -type d -name\"workspace\"|xargs rm -rf#看见find后面的那个点了么，改成你的路径就行了\n```\n\n**新**：\n\n```\n在  config.xml   文件内，查找 workspaceDir 关键字，将你的自定义 工作空间根目录 地址替换默认的地址\n```\n\n```\n  <workspaceDir>/opt/jenkins/workspace/${ITEM_FULL_NAME}</workspaceDir>\n```\n\n重启jenkins","source":"_posts/jenkins/jenkins.md","raw":"---\ntitle: jenkins 常见问题\ndate: 2019-12-18 10:00:00\ncategories: \n- jenkins\ntags:\n- jenkins\n---\n\n\n\n\n\n### jenkins 工作目录修改\n\n**旧**：\n\n```\n系统管理→系统设置→主目录（的右边问号下面）→高级（是不是忽略了啊\\(^o^)/~）→工作空间根目录\n```\n\n点开后面的问号可以看见3个参数（配置路径需要的）：\n\n1. - `${JENKINS_HOME}` — **Jenkins** home directory.#JENKINS_HOME这个参数不用说了\n   - `${ITEM_ROOTDIR}` — Root directory of a job for which the default workspace is allocated.#ITEM_ROOTDIR：默认的工作空间目录。完整的路径就是JENKINS_HOME/jobs/xxxx/workspace \n   - `${ITEM_FULL_NAME}` — '/'-separated job name, like \"foo/bar\".#ITEM_FULL_NAME：job的名称，这个就是我们需要的。\n\n 我们只需要把workspace目录赶出JENKINS_HOME目录就行了。上配置：\n\n```\nworkspace：/home/froad/workspace/${ITEM_FULL_NAME}#前面的目录随便你改，只需要在最后带上${ITEM_FULL_NAME}JENKINS_HOME：/home/froad/.jenkins#给你们对比着看\n#好了，这下.svn目录不打架了。我也不用头疼了。\n```\n\n删除已经存在的workspace目录\n\n```\nfind . -type d -name\"workspace\"|xargs rm -rf#看见find后面的那个点了么，改成你的路径就行了\n```\n\n**新**：\n\n```\n在  config.xml   文件内，查找 workspaceDir 关键字，将你的自定义 工作空间根目录 地址替换默认的地址\n```\n\n```\n  <workspaceDir>/opt/jenkins/workspace/${ITEM_FULL_NAME}</workspaceDir>\n```\n\n重启jenkins","slug":"jenkins/jenkins","published":1,"updated":"2021-06-18T08:07:11.194Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cku6979z0002i00uh06rt4mls","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><h3 id=\"jenkins-工作目录修改\"><a href=\"#jenkins-工作目录修改\" class=\"headerlink\" title=\"jenkins 工作目录修改\"></a>jenkins 工作目录修改</h3><p><strong>旧</strong>：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">系统管理→系统设置→主目录（的右边问号下面）→高级（是不是忽略了啊\\(^o^)&#x2F;~）→工作空间根目录</span><br></pre></td></tr></table></figure>\n\n<p>点开后面的问号可以看见3个参数（配置路径需要的）：</p>\n<ol>\n<li><ul>\n<li><code>$&#123;JENKINS_HOME&#125;</code> — <strong>Jenkins</strong> home directory.#JENKINS_HOME这个参数不用说了</li>\n<li><code>$&#123;ITEM_ROOTDIR&#125;</code> — Root directory of a job for which the default workspace is allocated.#ITEM_ROOTDIR：默认的工作空间目录。完整的路径就是JENKINS_HOME/jobs/xxxx/workspace </li>\n<li><code>$&#123;ITEM_FULL_NAME&#125;</code> — ‘/‘-separated job name, like “foo/bar”.#ITEM_FULL_NAME：job的名称，这个就是我们需要的。</li>\n</ul>\n<p>我们只需要把workspace目录赶出JENKINS_HOME目录就行了。上配置：</p>\n</li>\n</ol>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">workspace：&#x2F;home&#x2F;froad&#x2F;workspace&#x2F;$&#123;ITEM_FULL_NAME&#125;#前面的目录随便你改，只需要在最后带上$&#123;ITEM_FULL_NAME&#125;JENKINS_HOME：&#x2F;home&#x2F;froad&#x2F;.jenkins#给你们对比着看</span><br><span class=\"line\">#好了，这下.svn目录不打架了。我也不用头疼了。</span><br></pre></td></tr></table></figure>\n\n<p>删除已经存在的workspace目录</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">find . -type d -name&quot;workspace&quot;|xargs rm -rf#看见find后面的那个点了么，改成你的路径就行了</span><br></pre></td></tr></table></figure>\n\n<p><strong>新</strong>：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">在  config.xml   文件内，查找 workspaceDir 关键字，将你的自定义 工作空间根目录 地址替换默认的地址</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;workspaceDir&gt;&#x2F;opt&#x2F;jenkins&#x2F;workspace&#x2F;$&#123;ITEM_FULL_NAME&#125;&lt;&#x2F;workspaceDir&gt;</span><br></pre></td></tr></table></figure>\n\n<p>重启jenkins</p>\n","site":{"data":{}},"excerpt":"","more":"<h3 id=\"jenkins-工作目录修改\"><a href=\"#jenkins-工作目录修改\" class=\"headerlink\" title=\"jenkins 工作目录修改\"></a>jenkins 工作目录修改</h3><p><strong>旧</strong>：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">系统管理→系统设置→主目录（的右边问号下面）→高级（是不是忽略了啊\\(^o^)&#x2F;~）→工作空间根目录</span><br></pre></td></tr></table></figure>\n\n<p>点开后面的问号可以看见3个参数（配置路径需要的）：</p>\n<ol>\n<li><ul>\n<li><code>$&#123;JENKINS_HOME&#125;</code> — <strong>Jenkins</strong> home directory.#JENKINS_HOME这个参数不用说了</li>\n<li><code>$&#123;ITEM_ROOTDIR&#125;</code> — Root directory of a job for which the default workspace is allocated.#ITEM_ROOTDIR：默认的工作空间目录。完整的路径就是JENKINS_HOME/jobs/xxxx/workspace </li>\n<li><code>$&#123;ITEM_FULL_NAME&#125;</code> — ‘/‘-separated job name, like “foo/bar”.#ITEM_FULL_NAME：job的名称，这个就是我们需要的。</li>\n</ul>\n<p>我们只需要把workspace目录赶出JENKINS_HOME目录就行了。上配置：</p>\n</li>\n</ol>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">workspace：&#x2F;home&#x2F;froad&#x2F;workspace&#x2F;$&#123;ITEM_FULL_NAME&#125;#前面的目录随便你改，只需要在最后带上$&#123;ITEM_FULL_NAME&#125;JENKINS_HOME：&#x2F;home&#x2F;froad&#x2F;.jenkins#给你们对比着看</span><br><span class=\"line\">#好了，这下.svn目录不打架了。我也不用头疼了。</span><br></pre></td></tr></table></figure>\n\n<p>删除已经存在的workspace目录</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">find . -type d -name&quot;workspace&quot;|xargs rm -rf#看见find后面的那个点了么，改成你的路径就行了</span><br></pre></td></tr></table></figure>\n\n<p><strong>新</strong>：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">在  config.xml   文件内，查找 workspaceDir 关键字，将你的自定义 工作空间根目录 地址替换默认的地址</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;workspaceDir&gt;&#x2F;opt&#x2F;jenkins&#x2F;workspace&#x2F;$&#123;ITEM_FULL_NAME&#125;&lt;&#x2F;workspaceDir&gt;</span><br></pre></td></tr></table></figure>\n\n<p>重启jenkins</p>\n"},{"title":"jenkins共享库使用","date":"2021-08-11T03:32:00.000Z","_content":"\t\n\t\n摘要: desc\n<!-- more -->\n\n\n## 安装docker\n在构建代码是会使用jenkins触发docker启用一个jenkins slave 来构建代码\n\n安装略\n\n## 安装jenkins \n\njenkins [rpm下载地址](https://mirrors.tuna.tsinghua.edu.cn/jenkins/redhat-stable/)\n\n```\nyum install jenkins-2.289.3-1.1.noarch.rpm -y\n\n```\n\n\n默认安装路径\n\n自动安装完成之后： \n```\n/etc/rc.d/init.d/jenkins  启动脚本\n\n/usr/lib/jenkins/jenkins.war    WAR包 \n\n/etc/sysconfig/jenkins       配置文件\n\n/var/lib/jenkins/        默认的JENKINS_HOME目录\n\n/var/log/jenkins/jenkins.log    Jenkins日志文件\n\n```\n\n### 错误\n```\n/usr/bin/java: No such file or directory\n```\n在 /etc/rc.d/init.d/jenkins 中配置java路径\n\n\n### 安装jenkins插件\n\n|插件|作用||\n|---|---|---|\n|http Request |发起http请求|\n|build user vars | 获取用户名称 |\n|DingTalk | 钉钉消息|\n|ansiColor |输出彩色信息 |\n\n\n## 配置jenkins\n\n\n## 编写 jenkins SharedLibraries\n\n","source":"_posts/jenkins/jenkins共享库使用.md","raw":"---\ntitle: jenkins共享库使用\ndate: 2021-08-11 11:32\ncategories:\n- jenkins\ntags:\n- jenkins\n---\n\t\n\t\n摘要: desc\n<!-- more -->\n\n\n## 安装docker\n在构建代码是会使用jenkins触发docker启用一个jenkins slave 来构建代码\n\n安装略\n\n## 安装jenkins \n\njenkins [rpm下载地址](https://mirrors.tuna.tsinghua.edu.cn/jenkins/redhat-stable/)\n\n```\nyum install jenkins-2.289.3-1.1.noarch.rpm -y\n\n```\n\n\n默认安装路径\n\n自动安装完成之后： \n```\n/etc/rc.d/init.d/jenkins  启动脚本\n\n/usr/lib/jenkins/jenkins.war    WAR包 \n\n/etc/sysconfig/jenkins       配置文件\n\n/var/lib/jenkins/        默认的JENKINS_HOME目录\n\n/var/log/jenkins/jenkins.log    Jenkins日志文件\n\n```\n\n### 错误\n```\n/usr/bin/java: No such file or directory\n```\n在 /etc/rc.d/init.d/jenkins 中配置java路径\n\n\n### 安装jenkins插件\n\n|插件|作用||\n|---|---|---|\n|http Request |发起http请求|\n|build user vars | 获取用户名称 |\n|DingTalk | 钉钉消息|\n|ansiColor |输出彩色信息 |\n\n\n## 配置jenkins\n\n\n## 编写 jenkins SharedLibraries\n\n","slug":"jenkins/jenkins共享库使用","published":1,"updated":"2021-08-11T03:57:05.263Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cku6979z1002l00uh7rwjhzwj","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><p>摘要: desc</p>\n<span id=\"more\"></span>\n\n\n<h2 id=\"安装docker\"><a href=\"#安装docker\" class=\"headerlink\" title=\"安装docker\"></a>安装docker</h2><p>在构建代码是会使用jenkins触发docker启用一个jenkins slave 来构建代码</p>\n<p>安装略</p>\n<h2 id=\"安装jenkins\"><a href=\"#安装jenkins\" class=\"headerlink\" title=\"安装jenkins\"></a>安装jenkins</h2><p>jenkins <a href=\"https://mirrors.tuna.tsinghua.edu.cn/jenkins/redhat-stable/\">rpm下载地址</a></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install jenkins-2.289.3-1.1.noarch.rpm -y</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n<p>默认安装路径</p>\n<p>自动安装完成之后： </p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;etc&#x2F;rc.d&#x2F;init.d&#x2F;jenkins  启动脚本</span><br><span class=\"line\"></span><br><span class=\"line\">&#x2F;usr&#x2F;lib&#x2F;jenkins&#x2F;jenkins.war    WAR包 </span><br><span class=\"line\"></span><br><span class=\"line\">&#x2F;etc&#x2F;sysconfig&#x2F;jenkins       配置文件</span><br><span class=\"line\"></span><br><span class=\"line\">&#x2F;var&#x2F;lib&#x2F;jenkins&#x2F;        默认的JENKINS_HOME目录</span><br><span class=\"line\"></span><br><span class=\"line\">&#x2F;var&#x2F;log&#x2F;jenkins&#x2F;jenkins.log    Jenkins日志文件</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"错误\"><a href=\"#错误\" class=\"headerlink\" title=\"错误\"></a>错误</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;usr&#x2F;bin&#x2F;java: No such file or directory</span><br></pre></td></tr></table></figure>\n<p>在 /etc/rc.d/init.d/jenkins 中配置java路径</p>\n<h3 id=\"安装jenkins插件\"><a href=\"#安装jenkins插件\" class=\"headerlink\" title=\"安装jenkins插件\"></a>安装jenkins插件</h3><table>\n<thead>\n<tr>\n<th>插件</th>\n<th>作用</th>\n<th></th>\n</tr>\n</thead>\n<tbody><tr>\n<td>http Request</td>\n<td>发起http请求</td>\n<td></td>\n</tr>\n<tr>\n<td>build user vars</td>\n<td>获取用户名称</td>\n<td></td>\n</tr>\n<tr>\n<td>DingTalk</td>\n<td>钉钉消息</td>\n<td></td>\n</tr>\n<tr>\n<td>ansiColor</td>\n<td>输出彩色信息</td>\n<td></td>\n</tr>\n</tbody></table>\n<h2 id=\"配置jenkins\"><a href=\"#配置jenkins\" class=\"headerlink\" title=\"配置jenkins\"></a>配置jenkins</h2><h2 id=\"编写-jenkins-SharedLibraries\"><a href=\"#编写-jenkins-SharedLibraries\" class=\"headerlink\" title=\"编写 jenkins SharedLibraries\"></a>编写 jenkins SharedLibraries</h2>","site":{"data":{}},"excerpt":"<p>摘要: desc</p>","more":"<h2 id=\"安装docker\"><a href=\"#安装docker\" class=\"headerlink\" title=\"安装docker\"></a>安装docker</h2><p>在构建代码是会使用jenkins触发docker启用一个jenkins slave 来构建代码</p>\n<p>安装略</p>\n<h2 id=\"安装jenkins\"><a href=\"#安装jenkins\" class=\"headerlink\" title=\"安装jenkins\"></a>安装jenkins</h2><p>jenkins <a href=\"https://mirrors.tuna.tsinghua.edu.cn/jenkins/redhat-stable/\">rpm下载地址</a></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install jenkins-2.289.3-1.1.noarch.rpm -y</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n<p>默认安装路径</p>\n<p>自动安装完成之后： </p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;etc&#x2F;rc.d&#x2F;init.d&#x2F;jenkins  启动脚本</span><br><span class=\"line\"></span><br><span class=\"line\">&#x2F;usr&#x2F;lib&#x2F;jenkins&#x2F;jenkins.war    WAR包 </span><br><span class=\"line\"></span><br><span class=\"line\">&#x2F;etc&#x2F;sysconfig&#x2F;jenkins       配置文件</span><br><span class=\"line\"></span><br><span class=\"line\">&#x2F;var&#x2F;lib&#x2F;jenkins&#x2F;        默认的JENKINS_HOME目录</span><br><span class=\"line\"></span><br><span class=\"line\">&#x2F;var&#x2F;log&#x2F;jenkins&#x2F;jenkins.log    Jenkins日志文件</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"错误\"><a href=\"#错误\" class=\"headerlink\" title=\"错误\"></a>错误</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;usr&#x2F;bin&#x2F;java: No such file or directory</span><br></pre></td></tr></table></figure>\n<p>在 /etc/rc.d/init.d/jenkins 中配置java路径</p>\n<h3 id=\"安装jenkins插件\"><a href=\"#安装jenkins插件\" class=\"headerlink\" title=\"安装jenkins插件\"></a>安装jenkins插件</h3><table>\n<thead>\n<tr>\n<th>插件</th>\n<th>作用</th>\n<th></th>\n</tr>\n</thead>\n<tbody><tr>\n<td>http Request</td>\n<td>发起http请求</td>\n<td></td>\n</tr>\n<tr>\n<td>build user vars</td>\n<td>获取用户名称</td>\n<td></td>\n</tr>\n<tr>\n<td>DingTalk</td>\n<td>钉钉消息</td>\n<td></td>\n</tr>\n<tr>\n<td>ansiColor</td>\n<td>输出彩色信息</td>\n<td></td>\n</tr>\n</tbody></table>\n<h2 id=\"配置jenkins\"><a href=\"#配置jenkins\" class=\"headerlink\" title=\"配置jenkins\"></a>配置jenkins</h2><h2 id=\"编写-jenkins-SharedLibraries\"><a href=\"#编写-jenkins-SharedLibraries\" class=\"headerlink\" title=\"编写 jenkins SharedLibraries\"></a>编写 jenkins SharedLibraries</h2>"},{"title":"jenkins更新插件镜像","date":"2021-03-24T08:37:00.000Z","_content":"  \n  \n摘要: jenkins更新插件镜像地址\n<!-- more -->\n\n\n## 备份\n\n```\ncd /var/lib/jenkins/updates\ncp default.json default.json.back\n```\n\n## 替换域名\n```\nsed -i 's#https://updates.jenkins.io/download#https://mirrors.tuna.tsinghua.edu.cn/jenkins#g' default.json && sed -i 's#http://www.google.com#https://www.baidu.com#g' default.json\n```\n\n## 重启服务\n```\nsystemctl restart jenkins\n```","source":"_posts/jenkins/jenkins插件地址更新.md","raw":"---\ntitle: jenkins更新插件镜像\ndate: 2021-03-24 16:37\ncategories:\n- jenkins\ntags:\n- jenkins\n---\n  \n  \n摘要: jenkins更新插件镜像地址\n<!-- more -->\n\n\n## 备份\n\n```\ncd /var/lib/jenkins/updates\ncp default.json default.json.back\n```\n\n## 替换域名\n```\nsed -i 's#https://updates.jenkins.io/download#https://mirrors.tuna.tsinghua.edu.cn/jenkins#g' default.json && sed -i 's#http://www.google.com#https://www.baidu.com#g' default.json\n```\n\n## 重启服务\n```\nsystemctl restart jenkins\n```","slug":"jenkins/jenkins插件地址更新","published":1,"updated":"2021-06-18T08:07:11.194Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cku6979z2002n00uh7tgyamit","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><p>摘要: jenkins更新插件镜像地址</p>\n<span id=\"more\"></span>\n\n\n<h2 id=\"备份\"><a href=\"#备份\" class=\"headerlink\" title=\"备份\"></a>备份</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd &#x2F;var&#x2F;lib&#x2F;jenkins&#x2F;updates</span><br><span class=\"line\">cp default.json default.json.back</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"替换域名\"><a href=\"#替换域名\" class=\"headerlink\" title=\"替换域名\"></a>替换域名</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sed -i &#39;s#https:&#x2F;&#x2F;updates.jenkins.io&#x2F;download#https:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;jenkins#g&#39; default.json &amp;&amp; sed -i &#39;s#http:&#x2F;&#x2F;www.google.com#https:&#x2F;&#x2F;www.baidu.com#g&#39; default.json</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"重启服务\"><a href=\"#重启服务\" class=\"headerlink\" title=\"重启服务\"></a>重启服务</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl restart jenkins</span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"<p>摘要: jenkins更新插件镜像地址</p>","more":"<h2 id=\"备份\"><a href=\"#备份\" class=\"headerlink\" title=\"备份\"></a>备份</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd &#x2F;var&#x2F;lib&#x2F;jenkins&#x2F;updates</span><br><span class=\"line\">cp default.json default.json.back</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"替换域名\"><a href=\"#替换域名\" class=\"headerlink\" title=\"替换域名\"></a>替换域名</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sed -i &#39;s#https:&#x2F;&#x2F;updates.jenkins.io&#x2F;download#https:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;jenkins#g&#39; default.json &amp;&amp; sed -i &#39;s#http:&#x2F;&#x2F;www.google.com#https:&#x2F;&#x2F;www.baidu.com#g&#39; default.json</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"重启服务\"><a href=\"#重启服务\" class=\"headerlink\" title=\"重启服务\"></a>重启服务</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl restart jenkins</span><br></pre></td></tr></table></figure>"},{"title":"Centos7内核升级","date":"2020-04-01T06:00:00.000Z","_content":"\n\n** 内核下载 **\n```\nhttps://elrepo.org/linux/kernel/el7/x86_64/RPMS/\n```\n\n**安装ELRepo到CentOS**\n\n```\nrpm --import https://www.elrepo.org/RPM-GPG-KEY-elrepo.org\nyum install https://www.elrepo.org/elrepo-release-7.0-3.el7.elrepo.noarch.rpm\n```\n\n\n\n**添加 repository 后, 列出可以使用的kernel包版本**\n\n```\nyum --disablerepo=\"*\" --enablerepo=\"elrepo-kernel\" list available\n```\n\n**安装需要的kernel版本，这里安装 kernel-lt**\n\n```\nyum --enablerepo=elrepo-kernel install kernel-lt\n```\n\n内核版本介绍：\n\n- **lt**:longterm的缩写：长期维护版；\n- **ml**:mainline的缩写：最新稳定版；\n\n\n\n方式一：\n\n**检查kernel启动顺序**\n\n默认启动的顺序是从0开始，新内核是从头插入（目前位置在0，而4.4.4的是在1），所以需要选择0。\n\n```\ngrub2-set-default 0\n```\n\n\n\n### 删除老内核以及内核工具\n\n```\nrpm -qa|grep kernel|grep 3.10\nrpm -qa|grep kernel|grep 3.10|xargs yum remove -y\n```\n\n### 安装新版本工具包\n\n```\nyum --disablerepo=\\* --enablerepo=elrepo-kernel install -y kernel-ml-tools.x86_64\n\nrpm -qa|grep kernel\n```\n\n**重新创建kernel配置**\n\n```\n grub2-mkconfig -o /boot/grub2/grub.cfg\n \n \n reboot   # 重启\n```\n\n\n\n方式二：\n\n####  查看系统上的所有可以内核：\n\n```\n# sudo awk -F\\' '$1==\"menuentry \" {print i++ \" : \" $2}' /etc/grub2.cfg\n0 : CentOS Linux (4.15.6-1.el7.elrepo.x86_64) 7 (Core)\n1 : CentOS Linux (3.10.0-514.26.2.el7.x86_64) 7 (Core)\n2 : CentOS Linux (3.10.0-327.el7.x86_64) 7 (Core)\n3 : CentOS Linux (0-rescue-f9d400c5e1e8c3a8209e990d887d4ac1) 7 (Core)\n```\n\n#### 通过 `grub2-set-default 0` 命令设置：\n\n```\ngrub2-set-default 0\n\n\nreboot  #重启\n```\n\n\n\n\n\n## 删除旧内核\n\n#### 方式一，通过 `yum remove` 命令\n\n```\n查看系统中全部的内核：\n\n# rpm -qa | grep kernel\n\nkernel-tools-libs-3.10.0-514.26.2.el7.x86_64\nkernel-ml-4.15.6-1.el7.elrepo.x86_64\nkernel-3.10.0-327.el7.x86_64\nkernel-tools-3.10.0-514.26.2.el7.x86_64\nkernel-headers-3.10.0-514.26.2.el7.x86_64\nkernel-3.10.0-514.26.2.el7.x86_64\n```\n\n删除旧内核的 RPM 包\n\n```\nyum remove kernel-tools-libs-3.10.0-514.26.2.el7.x86_64 kernel-3.10.0-327.el7.x86_64 kernel-tools-3.10.0-514.26.2.el7.x86_64 kernel-headers-3.10.0-514.26.2.el7.x86_64 kernel-3.10.0-514.26.2.el7.x86_64\n```\n\n\n\n#### 方式二，通过 `yum-utils` 工具\n\n````\nyum install yum-utils\n````\n\n\n\n#### 删除\n\n```\npackage-cleanup --oldkernels\n```\n\n","source":"_posts/install/Centos7升级内核.md","raw":"---\ntitle: Centos7内核升级\ndate: 2020-04-1 14:00:00\ncategories: \n- centos7\ntags:\n- update\n---\n\n\n** 内核下载 **\n```\nhttps://elrepo.org/linux/kernel/el7/x86_64/RPMS/\n```\n\n**安装ELRepo到CentOS**\n\n```\nrpm --import https://www.elrepo.org/RPM-GPG-KEY-elrepo.org\nyum install https://www.elrepo.org/elrepo-release-7.0-3.el7.elrepo.noarch.rpm\n```\n\n\n\n**添加 repository 后, 列出可以使用的kernel包版本**\n\n```\nyum --disablerepo=\"*\" --enablerepo=\"elrepo-kernel\" list available\n```\n\n**安装需要的kernel版本，这里安装 kernel-lt**\n\n```\nyum --enablerepo=elrepo-kernel install kernel-lt\n```\n\n内核版本介绍：\n\n- **lt**:longterm的缩写：长期维护版；\n- **ml**:mainline的缩写：最新稳定版；\n\n\n\n方式一：\n\n**检查kernel启动顺序**\n\n默认启动的顺序是从0开始，新内核是从头插入（目前位置在0，而4.4.4的是在1），所以需要选择0。\n\n```\ngrub2-set-default 0\n```\n\n\n\n### 删除老内核以及内核工具\n\n```\nrpm -qa|grep kernel|grep 3.10\nrpm -qa|grep kernel|grep 3.10|xargs yum remove -y\n```\n\n### 安装新版本工具包\n\n```\nyum --disablerepo=\\* --enablerepo=elrepo-kernel install -y kernel-ml-tools.x86_64\n\nrpm -qa|grep kernel\n```\n\n**重新创建kernel配置**\n\n```\n grub2-mkconfig -o /boot/grub2/grub.cfg\n \n \n reboot   # 重启\n```\n\n\n\n方式二：\n\n####  查看系统上的所有可以内核：\n\n```\n# sudo awk -F\\' '$1==\"menuentry \" {print i++ \" : \" $2}' /etc/grub2.cfg\n0 : CentOS Linux (4.15.6-1.el7.elrepo.x86_64) 7 (Core)\n1 : CentOS Linux (3.10.0-514.26.2.el7.x86_64) 7 (Core)\n2 : CentOS Linux (3.10.0-327.el7.x86_64) 7 (Core)\n3 : CentOS Linux (0-rescue-f9d400c5e1e8c3a8209e990d887d4ac1) 7 (Core)\n```\n\n#### 通过 `grub2-set-default 0` 命令设置：\n\n```\ngrub2-set-default 0\n\n\nreboot  #重启\n```\n\n\n\n\n\n## 删除旧内核\n\n#### 方式一，通过 `yum remove` 命令\n\n```\n查看系统中全部的内核：\n\n# rpm -qa | grep kernel\n\nkernel-tools-libs-3.10.0-514.26.2.el7.x86_64\nkernel-ml-4.15.6-1.el7.elrepo.x86_64\nkernel-3.10.0-327.el7.x86_64\nkernel-tools-3.10.0-514.26.2.el7.x86_64\nkernel-headers-3.10.0-514.26.2.el7.x86_64\nkernel-3.10.0-514.26.2.el7.x86_64\n```\n\n删除旧内核的 RPM 包\n\n```\nyum remove kernel-tools-libs-3.10.0-514.26.2.el7.x86_64 kernel-3.10.0-327.el7.x86_64 kernel-tools-3.10.0-514.26.2.el7.x86_64 kernel-headers-3.10.0-514.26.2.el7.x86_64 kernel-3.10.0-514.26.2.el7.x86_64\n```\n\n\n\n#### 方式二，通过 `yum-utils` 工具\n\n````\nyum install yum-utils\n````\n\n\n\n#### 删除\n\n```\npackage-cleanup --oldkernels\n```\n\n","slug":"install/Centos7升级内核","published":1,"updated":"2021-08-29T05:01:59.791Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cku6979z4002q00uh3cfp11rs","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><p>** 内核下载 **</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">https:&#x2F;&#x2F;elrepo.org&#x2F;linux&#x2F;kernel&#x2F;el7&#x2F;x86_64&#x2F;RPMS&#x2F;</span><br></pre></td></tr></table></figure>\n\n<p><strong>安装ELRepo到CentOS</strong></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rpm --import https:&#x2F;&#x2F;www.elrepo.org&#x2F;RPM-GPG-KEY-elrepo.org</span><br><span class=\"line\">yum install https:&#x2F;&#x2F;www.elrepo.org&#x2F;elrepo-release-7.0-3.el7.elrepo.noarch.rpm</span><br></pre></td></tr></table></figure>\n\n\n\n<p><strong>添加 repository 后, 列出可以使用的kernel包版本</strong></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum --disablerepo&#x3D;&quot;*&quot; --enablerepo&#x3D;&quot;elrepo-kernel&quot; list available</span><br></pre></td></tr></table></figure>\n\n<p><strong>安装需要的kernel版本，这里安装 kernel-lt</strong></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum --enablerepo&#x3D;elrepo-kernel install kernel-lt</span><br></pre></td></tr></table></figure>\n\n<p>内核版本介绍：</p>\n<ul>\n<li><strong>lt</strong>:longterm的缩写：长期维护版；</li>\n<li><strong>ml</strong>:mainline的缩写：最新稳定版；</li>\n</ul>\n<p>方式一：</p>\n<p><strong>检查kernel启动顺序</strong></p>\n<p>默认启动的顺序是从0开始，新内核是从头插入（目前位置在0，而4.4.4的是在1），所以需要选择0。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">grub2-set-default 0</span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"删除老内核以及内核工具\"><a href=\"#删除老内核以及内核工具\" class=\"headerlink\" title=\"删除老内核以及内核工具\"></a>删除老内核以及内核工具</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rpm -qa|grep kernel|grep 3.10</span><br><span class=\"line\">rpm -qa|grep kernel|grep 3.10|xargs yum remove -y</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"安装新版本工具包\"><a href=\"#安装新版本工具包\" class=\"headerlink\" title=\"安装新版本工具包\"></a>安装新版本工具包</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum --disablerepo&#x3D;\\* --enablerepo&#x3D;elrepo-kernel install -y kernel-ml-tools.x86_64</span><br><span class=\"line\"></span><br><span class=\"line\">rpm -qa|grep kernel</span><br></pre></td></tr></table></figure>\n\n<p><strong>重新创建kernel配置</strong></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">grub2-mkconfig -o &#x2F;boot&#x2F;grub2&#x2F;grub.cfg</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">reboot   # 重启</span><br></pre></td></tr></table></figure>\n\n\n\n<p>方式二：</p>\n<h4 id=\"查看系统上的所有可以内核：\"><a href=\"#查看系统上的所有可以内核：\" class=\"headerlink\" title=\"查看系统上的所有可以内核：\"></a>查看系统上的所有可以内核：</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># sudo awk -F\\&#39; &#39;$1&#x3D;&#x3D;&quot;menuentry &quot; &#123;print i++ &quot; : &quot; $2&#125;&#39; &#x2F;etc&#x2F;grub2.cfg</span><br><span class=\"line\">0 : CentOS Linux (4.15.6-1.el7.elrepo.x86_64) 7 (Core)</span><br><span class=\"line\">1 : CentOS Linux (3.10.0-514.26.2.el7.x86_64) 7 (Core)</span><br><span class=\"line\">2 : CentOS Linux (3.10.0-327.el7.x86_64) 7 (Core)</span><br><span class=\"line\">3 : CentOS Linux (0-rescue-f9d400c5e1e8c3a8209e990d887d4ac1) 7 (Core)</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"通过-grub2-set-default-0-命令设置：\"><a href=\"#通过-grub2-set-default-0-命令设置：\" class=\"headerlink\" title=\"通过 grub2-set-default 0 命令设置：\"></a>通过 <code>grub2-set-default 0</code> 命令设置：</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">grub2-set-default 0</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">reboot  #重启</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h2 id=\"删除旧内核\"><a href=\"#删除旧内核\" class=\"headerlink\" title=\"删除旧内核\"></a>删除旧内核</h2><h4 id=\"方式一，通过-yum-remove-命令\"><a href=\"#方式一，通过-yum-remove-命令\" class=\"headerlink\" title=\"方式一，通过 yum remove 命令\"></a>方式一，通过 <code>yum remove</code> 命令</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">查看系统中全部的内核：</span><br><span class=\"line\"></span><br><span class=\"line\"># rpm -qa | grep kernel</span><br><span class=\"line\"></span><br><span class=\"line\">kernel-tools-libs-3.10.0-514.26.2.el7.x86_64</span><br><span class=\"line\">kernel-ml-4.15.6-1.el7.elrepo.x86_64</span><br><span class=\"line\">kernel-3.10.0-327.el7.x86_64</span><br><span class=\"line\">kernel-tools-3.10.0-514.26.2.el7.x86_64</span><br><span class=\"line\">kernel-headers-3.10.0-514.26.2.el7.x86_64</span><br><span class=\"line\">kernel-3.10.0-514.26.2.el7.x86_64</span><br></pre></td></tr></table></figure>\n\n<p>删除旧内核的 RPM 包</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum remove kernel-tools-libs-3.10.0-514.26.2.el7.x86_64 kernel-3.10.0-327.el7.x86_64 kernel-tools-3.10.0-514.26.2.el7.x86_64 kernel-headers-3.10.0-514.26.2.el7.x86_64 kernel-3.10.0-514.26.2.el7.x86_64</span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"方式二，通过-yum-utils-工具\"><a href=\"#方式二，通过-yum-utils-工具\" class=\"headerlink\" title=\"方式二，通过 yum-utils 工具\"></a>方式二，通过 <code>yum-utils</code> 工具</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install yum-utils</span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"删除\"><a href=\"#删除\" class=\"headerlink\" title=\"删除\"></a>删除</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">package-cleanup --oldkernels</span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"","more":"<p>** 内核下载 **</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">https:&#x2F;&#x2F;elrepo.org&#x2F;linux&#x2F;kernel&#x2F;el7&#x2F;x86_64&#x2F;RPMS&#x2F;</span><br></pre></td></tr></table></figure>\n\n<p><strong>安装ELRepo到CentOS</strong></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rpm --import https:&#x2F;&#x2F;www.elrepo.org&#x2F;RPM-GPG-KEY-elrepo.org</span><br><span class=\"line\">yum install https:&#x2F;&#x2F;www.elrepo.org&#x2F;elrepo-release-7.0-3.el7.elrepo.noarch.rpm</span><br></pre></td></tr></table></figure>\n\n\n\n<p><strong>添加 repository 后, 列出可以使用的kernel包版本</strong></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum --disablerepo&#x3D;&quot;*&quot; --enablerepo&#x3D;&quot;elrepo-kernel&quot; list available</span><br></pre></td></tr></table></figure>\n\n<p><strong>安装需要的kernel版本，这里安装 kernel-lt</strong></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum --enablerepo&#x3D;elrepo-kernel install kernel-lt</span><br></pre></td></tr></table></figure>\n\n<p>内核版本介绍：</p>\n<ul>\n<li><strong>lt</strong>:longterm的缩写：长期维护版；</li>\n<li><strong>ml</strong>:mainline的缩写：最新稳定版；</li>\n</ul>\n<p>方式一：</p>\n<p><strong>检查kernel启动顺序</strong></p>\n<p>默认启动的顺序是从0开始，新内核是从头插入（目前位置在0，而4.4.4的是在1），所以需要选择0。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">grub2-set-default 0</span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"删除老内核以及内核工具\"><a href=\"#删除老内核以及内核工具\" class=\"headerlink\" title=\"删除老内核以及内核工具\"></a>删除老内核以及内核工具</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rpm -qa|grep kernel|grep 3.10</span><br><span class=\"line\">rpm -qa|grep kernel|grep 3.10|xargs yum remove -y</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"安装新版本工具包\"><a href=\"#安装新版本工具包\" class=\"headerlink\" title=\"安装新版本工具包\"></a>安装新版本工具包</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum --disablerepo&#x3D;\\* --enablerepo&#x3D;elrepo-kernel install -y kernel-ml-tools.x86_64</span><br><span class=\"line\"></span><br><span class=\"line\">rpm -qa|grep kernel</span><br></pre></td></tr></table></figure>\n\n<p><strong>重新创建kernel配置</strong></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">grub2-mkconfig -o &#x2F;boot&#x2F;grub2&#x2F;grub.cfg</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">reboot   # 重启</span><br></pre></td></tr></table></figure>\n\n\n\n<p>方式二：</p>\n<h4 id=\"查看系统上的所有可以内核：\"><a href=\"#查看系统上的所有可以内核：\" class=\"headerlink\" title=\"查看系统上的所有可以内核：\"></a>查看系统上的所有可以内核：</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># sudo awk -F\\&#39; &#39;$1&#x3D;&#x3D;&quot;menuentry &quot; &#123;print i++ &quot; : &quot; $2&#125;&#39; &#x2F;etc&#x2F;grub2.cfg</span><br><span class=\"line\">0 : CentOS Linux (4.15.6-1.el7.elrepo.x86_64) 7 (Core)</span><br><span class=\"line\">1 : CentOS Linux (3.10.0-514.26.2.el7.x86_64) 7 (Core)</span><br><span class=\"line\">2 : CentOS Linux (3.10.0-327.el7.x86_64) 7 (Core)</span><br><span class=\"line\">3 : CentOS Linux (0-rescue-f9d400c5e1e8c3a8209e990d887d4ac1) 7 (Core)</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"通过-grub2-set-default-0-命令设置：\"><a href=\"#通过-grub2-set-default-0-命令设置：\" class=\"headerlink\" title=\"通过 grub2-set-default 0 命令设置：\"></a>通过 <code>grub2-set-default 0</code> 命令设置：</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">grub2-set-default 0</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">reboot  #重启</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h2 id=\"删除旧内核\"><a href=\"#删除旧内核\" class=\"headerlink\" title=\"删除旧内核\"></a>删除旧内核</h2><h4 id=\"方式一，通过-yum-remove-命令\"><a href=\"#方式一，通过-yum-remove-命令\" class=\"headerlink\" title=\"方式一，通过 yum remove 命令\"></a>方式一，通过 <code>yum remove</code> 命令</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">查看系统中全部的内核：</span><br><span class=\"line\"></span><br><span class=\"line\"># rpm -qa | grep kernel</span><br><span class=\"line\"></span><br><span class=\"line\">kernel-tools-libs-3.10.0-514.26.2.el7.x86_64</span><br><span class=\"line\">kernel-ml-4.15.6-1.el7.elrepo.x86_64</span><br><span class=\"line\">kernel-3.10.0-327.el7.x86_64</span><br><span class=\"line\">kernel-tools-3.10.0-514.26.2.el7.x86_64</span><br><span class=\"line\">kernel-headers-3.10.0-514.26.2.el7.x86_64</span><br><span class=\"line\">kernel-3.10.0-514.26.2.el7.x86_64</span><br></pre></td></tr></table></figure>\n\n<p>删除旧内核的 RPM 包</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum remove kernel-tools-libs-3.10.0-514.26.2.el7.x86_64 kernel-3.10.0-327.el7.x86_64 kernel-tools-3.10.0-514.26.2.el7.x86_64 kernel-headers-3.10.0-514.26.2.el7.x86_64 kernel-3.10.0-514.26.2.el7.x86_64</span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"方式二，通过-yum-utils-工具\"><a href=\"#方式二，通过-yum-utils-工具\" class=\"headerlink\" title=\"方式二，通过 yum-utils 工具\"></a>方式二，通过 <code>yum-utils</code> 工具</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install yum-utils</span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"删除\"><a href=\"#删除\" class=\"headerlink\" title=\"删除\"></a>删除</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">package-cleanup --oldkernels</span><br></pre></td></tr></table></figure>\n\n"},{"title":"Centos7系统优化脚本","date":"2020-09-21T04:40:00.000Z","_content":"\n```bash\n#!/bin/bash\n\nset -e\n\ninit_yum(){\necho -e \"\\033[1;32m ###########  初始化yum 源 ############# \\033[0m\"\ncd /etc/yum.repos.d/\n[[ ! -d repo ]] && mkdir -p repo || echo \"已存在\"\n\\mv -f Cent* repo\n# aliyun\ncurl -s -O  http://mirrors.aliyun.com/repo/Centos-7.repo\n# 163\ncurl -s -O http://mirrors.163.com/.help/CentOS7-Base-163.repo\n\n# 安装epel源\nyum install -y epel-release\n# 安装aliyun epel源\ncurl -o /etc/yum.repos.d/epel-7.repo http://mirrors.aliyun.com/repo/epel-7.repo\n\n# 清除系统所有的yum缓存\nyum clean all\n# 生成yum缓存\nyum makecache\n\n# 查看系统可用的yum源和所有的yum源\nyum repolist enabled\ncd -\n\nsleep 1\necho -e \"\\033[1;32m ###########  初始化yum 源 完成 ############# \\033[0m\"\n}\n\ninit_ntp(){\necho -e \"\\033[1;32m ###########  时间同步  ############# \\033[0m\"\nif [ !$(rpm -qa | grep ntp-) ];then\nyum install ntp -y\nfi\n\ncat >/etc/ntp.conf<<EOF\ndriftfile /var/lib/ntp/drift\nrestrict default nomodify notrap nopeer noquery\nrestrict 127.0.0.1 \nrestrict ::1\nserver cn.ntp.org.cn iburst\nserver ntp.aliyun.com iburst\nincludefile /etc/ntp/crypto/pw\nkeys /etc/ntp/keys\ndisable monitor\nEOF\n\nsystemctl start ntpd\nsystemctl enable ntpd\nsystemctl status ntpd\n}\n\n\nfunction ulimits(){\ncat > /etc/security/limits.conf <<EOF\n* soft noproc 20480\n* hard noproc 20480\nroot soft nofile 65536\nroot hard nofile 65536\n* soft nofile 65536\n* hard nofile 65536\nEOF\nulimit -n 65536\nulimit -u 20480\n#echo \"[ulimits 配置] ==> OK\"\n}\n\ninit_selinux(){\necho -e \"\\033[1;32m 禁用SELinux / 关闭防火墙  ############# \\033[0m\"\nsed -i '/SELINUX/s/enforcing/disabled/' /etc/selinux/config\nsetenforce 0\n\nsed -i 's/^GSSAPIAuthentication yes$/GSSAPIAuthentication no/' /etc/ssh/sshd_config\nsed -i 's/#UseDNS yes/UseDNS no/' /etc/ssh/sshd_config\n\nyum install -y openssl openssh bash\n\nsystemctl  restart sshd.service\nsystemctl stop firewalld.service\nsystemctl disable firewalld.service\n}\n\ninit_sysctl(){\necho -e \"\\033[1;32m ###########  内核参数优化  ############# \\033[0m\"\n\ncat >> /etc/sysctl.conf << EOF\n#CTCDN系统优化参数\n#关闭ipv6\nnet.ipv6.conf.all.disable_ipv6 = 1\nnet.ipv6.conf.default.disable_ipv6 = 1\n#决定检查过期多久邻居条目\nnet.ipv4.neigh.default.gc_stale_time=120\n#使用arp_announce / arp_ignore解决ARP映射问题\nnet.ipv4.conf.default.arp_announce = 2\nnet.ipv4.conf.all.arp_announce=2\nnet.ipv4.conf.lo.arp_announce=2\n# 避免放大攻击\nnet.ipv4.icmp_echo_ignore_broadcasts = 1\n# 开启恶意icmp错误消息保护\nnet.ipv4.icmp_ignore_bogus_error_responses = 1\n#关闭路由转发\nnet.ipv4.ip_forward = 0\nnet.ipv4.conf.all.send_redirects = 0\nnet.ipv4.conf.default.send_redirects = 0\n#开启反向路径过滤\nnet.ipv4.conf.all.rp_filter = 1\nnet.ipv4.conf.default.rp_filter = 1\n#处理无源路由的包\nnet.ipv4.conf.all.accept_source_route = 0\nnet.ipv4.conf.default.accept_source_route = 0\n#关闭sysrq功能\nkernel.sysrq = 0\n#core文件名中添加pid作为扩展名\nkernel.core_uses_pid = 1\n# 开启SYN洪水攻击保护\nnet.ipv4.tcp_syncookies = 1\n#修改消息队列长度\nkernel.msgmnb = 65536\nkernel.msgmax = 65536\n#设置最大内存共享段大小bytes\nkernel.shmmax = 68719476736\nkernel.shmall = 4294967296\n#timewait的数量，默认180000\nnet.ipv4.tcp_max_tw_buckets = 6000\nnet.ipv4.tcp_sack = 1\nnet.ipv4.tcp_window_scaling = 1\nnet.ipv4.tcp_rmem = 4096        87380   4194304\nnet.ipv4.tcp_wmem = 4096        16384   4194304\nnet.core.wmem_default = 8388608\nnet.core.rmem_default = 8388608\nnet.core.rmem_max = 16777216\nnet.core.wmem_max = 16777216\n#每个网络接口接收数据包的速率比内核处理这些包的速率快时，允许送到队列的数据包的最大数目\nnet.core.netdev_max_backlog = 262144\n#限制仅仅是为了防止简单的DoS 攻击\nnet.ipv4.tcp_max_orphans = 3276800\n#未收到客户端确认信息的连接请求的最大值\nnet.ipv4.tcp_max_syn_backlog = 262144\nnet.ipv4.tcp_timestamps = 0\n#内核放弃建立连接之前发送SYNACK 包的数量\nnet.ipv4.tcp_synack_retries = 1\n#内核放弃建立连接之前发送SYN 包的数量\nnet.ipv4.tcp_syn_retries = 1\n#启用timewait 快速回收\nnet.ipv4.tcp_tw_recycle = 1\n#开启重用。允许将TIME-WAIT sockets 重新用于新的TCP 连接\nnet.ipv4.tcp_tw_reuse = 1\nnet.ipv4.tcp_mem = 94500000 915000000 927000000\nnet.ipv4.tcp_fin_timeout = 1\n#当keepalive 起用的时候，TCP 发送keepalive 消息的频度。缺省是2 小时\nnet.ipv4.tcp_keepalive_time = 1800\nnet.ipv4.tcp_keepalive_probes = 3\nnet.ipv4.tcp_keepalive_intvl = 15\n#允许系统打开的端口范围\nnet.ipv4.ip_local_port_range = 1024    65000\n# 确保无人能修改路由表\nnet.ipv4.conf.all.accept_redirects = 0\nnet.ipv4.conf.default.accept_redirects = 0\nnet.ipv4.conf.all.secure_redirects = 0\nnet.ipv4.conf.default.secure_redirects = 0\nEOF\n/sbin/sysctl -p\n\n}\n\ninit_vim(){\necho -e \"\\033[1;32m ###########  初始化vim 配置  ############# \\033[0m\"\n\nif [ !$(rpm -q vim-common) ];then\nyum install vim -y\nfi\necho 'alias vi=vim' >> /etc/profile\necho 'stty erase ^H' >> /etc/profile\ncat >> /root/.vimrc << EOF\nset tabstop=4\nset shiftwidth=4\nset expandtab\nsyntax on\n\"set number\nEOF\n\n}\n\n\nfunction other(){\nyum groupinstall Development tools -y >/dev/null 2>&1\nyum install -y vim wget lrzsz telnet traceroute iotop tree >/dev/null 2>&1\nyum install -y ncftp axel git zlib-devel openssl-devel unzip xz libxslt-devel libxml2-devel libcurl-devel >/dev/null 2>&1\n}\n\nfunction history(){\nif ! grep \"HISTTIMEFORMAT\" /etc/profile >/dev/null 2>&1\nthen echo '\nUserIP=$(who -u am i | cut -d\"(\"  -f 2 | sed -e \"s/[()]//g\")\nexport HISTTIMEFORMAT=\"[%F %T] [`whoami`] [${UserIP}] \" ' >> /etc/profile;\nfi\n#echo \"[history 优化] ==> OK\"\n}\n\nplatform=$(uname -i)\nif [ ${platform} != \"x86_64\" ];then\necho \"这个脚本只能优化 64位系统\"\nexit 1\nfi\n\ninit_yum\ninit_ntp\ninit_selinux\nulimits\nother\nhistory\ninit_vim\ninit_sysctl\n\ncat << EOF\n+-------------------------------------------------+\n|                优 化 已 完 成             |\n|             5s 后 重启 这台服务器 !       |\n+-------------------------------------------------+\nEOF\n\nsleep 5\n\nreboot\n```\n\n\n\njdk 环境变量\n\n```\n/etc/profile.d/jdk.sh\n\nJAVA_HOME=/opt/jdk1.8.0_221\nCLASSPATH=${JAVA_HOME}/lib/\nPATH=$PATH:${JAVA_HOME}/bin\nexport PATH JAVA_HOME CLASSPAT\n```\n\n","source":"_posts/install/centos7优化脚本.md","raw":"---\ntitle: Centos7系统优化脚本\ndate: 2020-09-21 12:40\ncategories:\n- centos7\ntags:\n- 优化\n---\n\n```bash\n#!/bin/bash\n\nset -e\n\ninit_yum(){\necho -e \"\\033[1;32m ###########  初始化yum 源 ############# \\033[0m\"\ncd /etc/yum.repos.d/\n[[ ! -d repo ]] && mkdir -p repo || echo \"已存在\"\n\\mv -f Cent* repo\n# aliyun\ncurl -s -O  http://mirrors.aliyun.com/repo/Centos-7.repo\n# 163\ncurl -s -O http://mirrors.163.com/.help/CentOS7-Base-163.repo\n\n# 安装epel源\nyum install -y epel-release\n# 安装aliyun epel源\ncurl -o /etc/yum.repos.d/epel-7.repo http://mirrors.aliyun.com/repo/epel-7.repo\n\n# 清除系统所有的yum缓存\nyum clean all\n# 生成yum缓存\nyum makecache\n\n# 查看系统可用的yum源和所有的yum源\nyum repolist enabled\ncd -\n\nsleep 1\necho -e \"\\033[1;32m ###########  初始化yum 源 完成 ############# \\033[0m\"\n}\n\ninit_ntp(){\necho -e \"\\033[1;32m ###########  时间同步  ############# \\033[0m\"\nif [ !$(rpm -qa | grep ntp-) ];then\nyum install ntp -y\nfi\n\ncat >/etc/ntp.conf<<EOF\ndriftfile /var/lib/ntp/drift\nrestrict default nomodify notrap nopeer noquery\nrestrict 127.0.0.1 \nrestrict ::1\nserver cn.ntp.org.cn iburst\nserver ntp.aliyun.com iburst\nincludefile /etc/ntp/crypto/pw\nkeys /etc/ntp/keys\ndisable monitor\nEOF\n\nsystemctl start ntpd\nsystemctl enable ntpd\nsystemctl status ntpd\n}\n\n\nfunction ulimits(){\ncat > /etc/security/limits.conf <<EOF\n* soft noproc 20480\n* hard noproc 20480\nroot soft nofile 65536\nroot hard nofile 65536\n* soft nofile 65536\n* hard nofile 65536\nEOF\nulimit -n 65536\nulimit -u 20480\n#echo \"[ulimits 配置] ==> OK\"\n}\n\ninit_selinux(){\necho -e \"\\033[1;32m 禁用SELinux / 关闭防火墙  ############# \\033[0m\"\nsed -i '/SELINUX/s/enforcing/disabled/' /etc/selinux/config\nsetenforce 0\n\nsed -i 's/^GSSAPIAuthentication yes$/GSSAPIAuthentication no/' /etc/ssh/sshd_config\nsed -i 's/#UseDNS yes/UseDNS no/' /etc/ssh/sshd_config\n\nyum install -y openssl openssh bash\n\nsystemctl  restart sshd.service\nsystemctl stop firewalld.service\nsystemctl disable firewalld.service\n}\n\ninit_sysctl(){\necho -e \"\\033[1;32m ###########  内核参数优化  ############# \\033[0m\"\n\ncat >> /etc/sysctl.conf << EOF\n#CTCDN系统优化参数\n#关闭ipv6\nnet.ipv6.conf.all.disable_ipv6 = 1\nnet.ipv6.conf.default.disable_ipv6 = 1\n#决定检查过期多久邻居条目\nnet.ipv4.neigh.default.gc_stale_time=120\n#使用arp_announce / arp_ignore解决ARP映射问题\nnet.ipv4.conf.default.arp_announce = 2\nnet.ipv4.conf.all.arp_announce=2\nnet.ipv4.conf.lo.arp_announce=2\n# 避免放大攻击\nnet.ipv4.icmp_echo_ignore_broadcasts = 1\n# 开启恶意icmp错误消息保护\nnet.ipv4.icmp_ignore_bogus_error_responses = 1\n#关闭路由转发\nnet.ipv4.ip_forward = 0\nnet.ipv4.conf.all.send_redirects = 0\nnet.ipv4.conf.default.send_redirects = 0\n#开启反向路径过滤\nnet.ipv4.conf.all.rp_filter = 1\nnet.ipv4.conf.default.rp_filter = 1\n#处理无源路由的包\nnet.ipv4.conf.all.accept_source_route = 0\nnet.ipv4.conf.default.accept_source_route = 0\n#关闭sysrq功能\nkernel.sysrq = 0\n#core文件名中添加pid作为扩展名\nkernel.core_uses_pid = 1\n# 开启SYN洪水攻击保护\nnet.ipv4.tcp_syncookies = 1\n#修改消息队列长度\nkernel.msgmnb = 65536\nkernel.msgmax = 65536\n#设置最大内存共享段大小bytes\nkernel.shmmax = 68719476736\nkernel.shmall = 4294967296\n#timewait的数量，默认180000\nnet.ipv4.tcp_max_tw_buckets = 6000\nnet.ipv4.tcp_sack = 1\nnet.ipv4.tcp_window_scaling = 1\nnet.ipv4.tcp_rmem = 4096        87380   4194304\nnet.ipv4.tcp_wmem = 4096        16384   4194304\nnet.core.wmem_default = 8388608\nnet.core.rmem_default = 8388608\nnet.core.rmem_max = 16777216\nnet.core.wmem_max = 16777216\n#每个网络接口接收数据包的速率比内核处理这些包的速率快时，允许送到队列的数据包的最大数目\nnet.core.netdev_max_backlog = 262144\n#限制仅仅是为了防止简单的DoS 攻击\nnet.ipv4.tcp_max_orphans = 3276800\n#未收到客户端确认信息的连接请求的最大值\nnet.ipv4.tcp_max_syn_backlog = 262144\nnet.ipv4.tcp_timestamps = 0\n#内核放弃建立连接之前发送SYNACK 包的数量\nnet.ipv4.tcp_synack_retries = 1\n#内核放弃建立连接之前发送SYN 包的数量\nnet.ipv4.tcp_syn_retries = 1\n#启用timewait 快速回收\nnet.ipv4.tcp_tw_recycle = 1\n#开启重用。允许将TIME-WAIT sockets 重新用于新的TCP 连接\nnet.ipv4.tcp_tw_reuse = 1\nnet.ipv4.tcp_mem = 94500000 915000000 927000000\nnet.ipv4.tcp_fin_timeout = 1\n#当keepalive 起用的时候，TCP 发送keepalive 消息的频度。缺省是2 小时\nnet.ipv4.tcp_keepalive_time = 1800\nnet.ipv4.tcp_keepalive_probes = 3\nnet.ipv4.tcp_keepalive_intvl = 15\n#允许系统打开的端口范围\nnet.ipv4.ip_local_port_range = 1024    65000\n# 确保无人能修改路由表\nnet.ipv4.conf.all.accept_redirects = 0\nnet.ipv4.conf.default.accept_redirects = 0\nnet.ipv4.conf.all.secure_redirects = 0\nnet.ipv4.conf.default.secure_redirects = 0\nEOF\n/sbin/sysctl -p\n\n}\n\ninit_vim(){\necho -e \"\\033[1;32m ###########  初始化vim 配置  ############# \\033[0m\"\n\nif [ !$(rpm -q vim-common) ];then\nyum install vim -y\nfi\necho 'alias vi=vim' >> /etc/profile\necho 'stty erase ^H' >> /etc/profile\ncat >> /root/.vimrc << EOF\nset tabstop=4\nset shiftwidth=4\nset expandtab\nsyntax on\n\"set number\nEOF\n\n}\n\n\nfunction other(){\nyum groupinstall Development tools -y >/dev/null 2>&1\nyum install -y vim wget lrzsz telnet traceroute iotop tree >/dev/null 2>&1\nyum install -y ncftp axel git zlib-devel openssl-devel unzip xz libxslt-devel libxml2-devel libcurl-devel >/dev/null 2>&1\n}\n\nfunction history(){\nif ! grep \"HISTTIMEFORMAT\" /etc/profile >/dev/null 2>&1\nthen echo '\nUserIP=$(who -u am i | cut -d\"(\"  -f 2 | sed -e \"s/[()]//g\")\nexport HISTTIMEFORMAT=\"[%F %T] [`whoami`] [${UserIP}] \" ' >> /etc/profile;\nfi\n#echo \"[history 优化] ==> OK\"\n}\n\nplatform=$(uname -i)\nif [ ${platform} != \"x86_64\" ];then\necho \"这个脚本只能优化 64位系统\"\nexit 1\nfi\n\ninit_yum\ninit_ntp\ninit_selinux\nulimits\nother\nhistory\ninit_vim\ninit_sysctl\n\ncat << EOF\n+-------------------------------------------------+\n|                优 化 已 完 成             |\n|             5s 后 重启 这台服务器 !       |\n+-------------------------------------------------+\nEOF\n\nsleep 5\n\nreboot\n```\n\n\n\njdk 环境变量\n\n```\n/etc/profile.d/jdk.sh\n\nJAVA_HOME=/opt/jdk1.8.0_221\nCLASSPATH=${JAVA_HOME}/lib/\nPATH=$PATH:${JAVA_HOME}/bin\nexport PATH JAVA_HOME CLASSPAT\n```\n\n","slug":"install/centos7优化脚本","published":1,"updated":"2021-06-18T08:07:11.189Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cku6979z5002u00uh4irda8l7","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/bin/bash</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">set</span> -e</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">init_yum</span></span>()&#123;</span><br><span class=\"line\"><span class=\"built_in\">echo</span> -e <span class=\"string\">&quot;\\033[1;32m ###########  初始化yum 源 ############# \\033[0m&quot;</span></span><br><span class=\"line\"><span class=\"built_in\">cd</span> /etc/yum.repos.d/</span><br><span class=\"line\">[[ ! -d repo ]] &amp;&amp; mkdir -p repo || <span class=\"built_in\">echo</span> <span class=\"string\">&quot;已存在&quot;</span></span><br><span class=\"line\">\\mv -f Cent* repo</span><br><span class=\"line\"><span class=\"comment\"># aliyun</span></span><br><span class=\"line\">curl -s -O  http://mirrors.aliyun.com/repo/Centos-7.repo</span><br><span class=\"line\"><span class=\"comment\"># 163</span></span><br><span class=\"line\">curl -s -O http://mirrors.163.com/.<span class=\"built_in\">help</span>/CentOS7-Base-163.repo</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 安装epel源</span></span><br><span class=\"line\">yum install -y epel-release</span><br><span class=\"line\"><span class=\"comment\"># 安装aliyun epel源</span></span><br><span class=\"line\">curl -o /etc/yum.repos.d/epel-7.repo http://mirrors.aliyun.com/repo/epel-7.repo</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 清除系统所有的yum缓存</span></span><br><span class=\"line\">yum clean all</span><br><span class=\"line\"><span class=\"comment\"># 生成yum缓存</span></span><br><span class=\"line\">yum makecache</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 查看系统可用的yum源和所有的yum源</span></span><br><span class=\"line\">yum repolist enabled</span><br><span class=\"line\"><span class=\"built_in\">cd</span> -</span><br><span class=\"line\"></span><br><span class=\"line\">sleep 1</span><br><span class=\"line\"><span class=\"built_in\">echo</span> -e <span class=\"string\">&quot;\\033[1;32m ###########  初始化yum 源 完成 ############# \\033[0m&quot;</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">init_ntp</span></span>()&#123;</span><br><span class=\"line\"><span class=\"built_in\">echo</span> -e <span class=\"string\">&quot;\\033[1;32m ###########  时间同步  ############# \\033[0m&quot;</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> [ !$(rpm -qa | grep ntp-) ];<span class=\"keyword\">then</span></span><br><span class=\"line\">yum install ntp -y</span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"></span><br><span class=\"line\">cat &gt;/etc/ntp.conf&lt;&lt;<span class=\"string\">EOF</span></span><br><span class=\"line\"><span class=\"string\">driftfile /var/lib/ntp/drift</span></span><br><span class=\"line\"><span class=\"string\">restrict default nomodify notrap nopeer noquery</span></span><br><span class=\"line\"><span class=\"string\">restrict 127.0.0.1 </span></span><br><span class=\"line\"><span class=\"string\">restrict ::1</span></span><br><span class=\"line\"><span class=\"string\">server cn.ntp.org.cn iburst</span></span><br><span class=\"line\"><span class=\"string\">server ntp.aliyun.com iburst</span></span><br><span class=\"line\"><span class=\"string\">includefile /etc/ntp/crypto/pw</span></span><br><span class=\"line\"><span class=\"string\">keys /etc/ntp/keys</span></span><br><span class=\"line\"><span class=\"string\">disable monitor</span></span><br><span class=\"line\"><span class=\"string\">EOF</span></span><br><span class=\"line\"></span><br><span class=\"line\">systemctl start ntpd</span><br><span class=\"line\">systemctl <span class=\"built_in\">enable</span> ntpd</span><br><span class=\"line\">systemctl status ntpd</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"function\"><span class=\"title\">ulimits</span></span>()&#123;</span><br><span class=\"line\">cat &gt; /etc/security/limits.conf &lt;&lt;<span class=\"string\">EOF</span></span><br><span class=\"line\"><span class=\"string\">* soft noproc 20480</span></span><br><span class=\"line\"><span class=\"string\">* hard noproc 20480</span></span><br><span class=\"line\"><span class=\"string\">root soft nofile 65536</span></span><br><span class=\"line\"><span class=\"string\">root hard nofile 65536</span></span><br><span class=\"line\"><span class=\"string\">* soft nofile 65536</span></span><br><span class=\"line\"><span class=\"string\">* hard nofile 65536</span></span><br><span class=\"line\"><span class=\"string\">EOF</span></span><br><span class=\"line\"><span class=\"built_in\">ulimit</span> -n 65536</span><br><span class=\"line\"><span class=\"built_in\">ulimit</span> -u 20480</span><br><span class=\"line\"><span class=\"comment\">#echo &quot;[ulimits 配置] ==&gt; OK&quot;</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">init_selinux</span></span>()&#123;</span><br><span class=\"line\"><span class=\"built_in\">echo</span> -e <span class=\"string\">&quot;\\033[1;32m 禁用SELinux / 关闭防火墙  ############# \\033[0m&quot;</span></span><br><span class=\"line\">sed -i <span class=\"string\">&#x27;/SELINUX/s/enforcing/disabled/&#x27;</span> /etc/selinux/config</span><br><span class=\"line\">setenforce 0</span><br><span class=\"line\"></span><br><span class=\"line\">sed -i <span class=\"string\">&#x27;s/^GSSAPIAuthentication yes$/GSSAPIAuthentication no/&#x27;</span> /etc/ssh/sshd_config</span><br><span class=\"line\">sed -i <span class=\"string\">&#x27;s/#UseDNS yes/UseDNS no/&#x27;</span> /etc/ssh/sshd_config</span><br><span class=\"line\"></span><br><span class=\"line\">yum install -y openssl openssh bash</span><br><span class=\"line\"></span><br><span class=\"line\">systemctl  restart sshd.service</span><br><span class=\"line\">systemctl stop firewalld.service</span><br><span class=\"line\">systemctl <span class=\"built_in\">disable</span> firewalld.service</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">init_sysctl</span></span>()&#123;</span><br><span class=\"line\"><span class=\"built_in\">echo</span> -e <span class=\"string\">&quot;\\033[1;32m ###########  内核参数优化  ############# \\033[0m&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">cat &gt;&gt; /etc/sysctl.conf &lt;&lt; <span class=\"string\">EOF</span></span><br><span class=\"line\"><span class=\"string\">#CTCDN系统优化参数</span></span><br><span class=\"line\"><span class=\"string\">#关闭ipv6</span></span><br><span class=\"line\"><span class=\"string\">net.ipv6.conf.all.disable_ipv6 = 1</span></span><br><span class=\"line\"><span class=\"string\">net.ipv6.conf.default.disable_ipv6 = 1</span></span><br><span class=\"line\"><span class=\"string\">#决定检查过期多久邻居条目</span></span><br><span class=\"line\"><span class=\"string\">net.ipv4.neigh.default.gc_stale_time=120</span></span><br><span class=\"line\"><span class=\"string\">#使用arp_announce / arp_ignore解决ARP映射问题</span></span><br><span class=\"line\"><span class=\"string\">net.ipv4.conf.default.arp_announce = 2</span></span><br><span class=\"line\"><span class=\"string\">net.ipv4.conf.all.arp_announce=2</span></span><br><span class=\"line\"><span class=\"string\">net.ipv4.conf.lo.arp_announce=2</span></span><br><span class=\"line\"><span class=\"string\"># 避免放大攻击</span></span><br><span class=\"line\"><span class=\"string\">net.ipv4.icmp_echo_ignore_broadcasts = 1</span></span><br><span class=\"line\"><span class=\"string\"># 开启恶意icmp错误消息保护</span></span><br><span class=\"line\"><span class=\"string\">net.ipv4.icmp_ignore_bogus_error_responses = 1</span></span><br><span class=\"line\"><span class=\"string\">#关闭路由转发</span></span><br><span class=\"line\"><span class=\"string\">net.ipv4.ip_forward = 0</span></span><br><span class=\"line\"><span class=\"string\">net.ipv4.conf.all.send_redirects = 0</span></span><br><span class=\"line\"><span class=\"string\">net.ipv4.conf.default.send_redirects = 0</span></span><br><span class=\"line\"><span class=\"string\">#开启反向路径过滤</span></span><br><span class=\"line\"><span class=\"string\">net.ipv4.conf.all.rp_filter = 1</span></span><br><span class=\"line\"><span class=\"string\">net.ipv4.conf.default.rp_filter = 1</span></span><br><span class=\"line\"><span class=\"string\">#处理无源路由的包</span></span><br><span class=\"line\"><span class=\"string\">net.ipv4.conf.all.accept_source_route = 0</span></span><br><span class=\"line\"><span class=\"string\">net.ipv4.conf.default.accept_source_route = 0</span></span><br><span class=\"line\"><span class=\"string\">#关闭sysrq功能</span></span><br><span class=\"line\"><span class=\"string\">kernel.sysrq = 0</span></span><br><span class=\"line\"><span class=\"string\">#core文件名中添加pid作为扩展名</span></span><br><span class=\"line\"><span class=\"string\">kernel.core_uses_pid = 1</span></span><br><span class=\"line\"><span class=\"string\"># 开启SYN洪水攻击保护</span></span><br><span class=\"line\"><span class=\"string\">net.ipv4.tcp_syncookies = 1</span></span><br><span class=\"line\"><span class=\"string\">#修改消息队列长度</span></span><br><span class=\"line\"><span class=\"string\">kernel.msgmnb = 65536</span></span><br><span class=\"line\"><span class=\"string\">kernel.msgmax = 65536</span></span><br><span class=\"line\"><span class=\"string\">#设置最大内存共享段大小bytes</span></span><br><span class=\"line\"><span class=\"string\">kernel.shmmax = 68719476736</span></span><br><span class=\"line\"><span class=\"string\">kernel.shmall = 4294967296</span></span><br><span class=\"line\"><span class=\"string\">#timewait的数量，默认180000</span></span><br><span class=\"line\"><span class=\"string\">net.ipv4.tcp_max_tw_buckets = 6000</span></span><br><span class=\"line\"><span class=\"string\">net.ipv4.tcp_sack = 1</span></span><br><span class=\"line\"><span class=\"string\">net.ipv4.tcp_window_scaling = 1</span></span><br><span class=\"line\"><span class=\"string\">net.ipv4.tcp_rmem = 4096        87380   4194304</span></span><br><span class=\"line\"><span class=\"string\">net.ipv4.tcp_wmem = 4096        16384   4194304</span></span><br><span class=\"line\"><span class=\"string\">net.core.wmem_default = 8388608</span></span><br><span class=\"line\"><span class=\"string\">net.core.rmem_default = 8388608</span></span><br><span class=\"line\"><span class=\"string\">net.core.rmem_max = 16777216</span></span><br><span class=\"line\"><span class=\"string\">net.core.wmem_max = 16777216</span></span><br><span class=\"line\"><span class=\"string\">#每个网络接口接收数据包的速率比内核处理这些包的速率快时，允许送到队列的数据包的最大数目</span></span><br><span class=\"line\"><span class=\"string\">net.core.netdev_max_backlog = 262144</span></span><br><span class=\"line\"><span class=\"string\">#限制仅仅是为了防止简单的DoS 攻击</span></span><br><span class=\"line\"><span class=\"string\">net.ipv4.tcp_max_orphans = 3276800</span></span><br><span class=\"line\"><span class=\"string\">#未收到客户端确认信息的连接请求的最大值</span></span><br><span class=\"line\"><span class=\"string\">net.ipv4.tcp_max_syn_backlog = 262144</span></span><br><span class=\"line\"><span class=\"string\">net.ipv4.tcp_timestamps = 0</span></span><br><span class=\"line\"><span class=\"string\">#内核放弃建立连接之前发送SYNACK 包的数量</span></span><br><span class=\"line\"><span class=\"string\">net.ipv4.tcp_synack_retries = 1</span></span><br><span class=\"line\"><span class=\"string\">#内核放弃建立连接之前发送SYN 包的数量</span></span><br><span class=\"line\"><span class=\"string\">net.ipv4.tcp_syn_retries = 1</span></span><br><span class=\"line\"><span class=\"string\">#启用timewait 快速回收</span></span><br><span class=\"line\"><span class=\"string\">net.ipv4.tcp_tw_recycle = 1</span></span><br><span class=\"line\"><span class=\"string\">#开启重用。允许将TIME-WAIT sockets 重新用于新的TCP 连接</span></span><br><span class=\"line\"><span class=\"string\">net.ipv4.tcp_tw_reuse = 1</span></span><br><span class=\"line\"><span class=\"string\">net.ipv4.tcp_mem = 94500000 915000000 927000000</span></span><br><span class=\"line\"><span class=\"string\">net.ipv4.tcp_fin_timeout = 1</span></span><br><span class=\"line\"><span class=\"string\">#当keepalive 起用的时候，TCP 发送keepalive 消息的频度。缺省是2 小时</span></span><br><span class=\"line\"><span class=\"string\">net.ipv4.tcp_keepalive_time = 1800</span></span><br><span class=\"line\"><span class=\"string\">net.ipv4.tcp_keepalive_probes = 3</span></span><br><span class=\"line\"><span class=\"string\">net.ipv4.tcp_keepalive_intvl = 15</span></span><br><span class=\"line\"><span class=\"string\">#允许系统打开的端口范围</span></span><br><span class=\"line\"><span class=\"string\">net.ipv4.ip_local_port_range = 1024    65000</span></span><br><span class=\"line\"><span class=\"string\"># 确保无人能修改路由表</span></span><br><span class=\"line\"><span class=\"string\">net.ipv4.conf.all.accept_redirects = 0</span></span><br><span class=\"line\"><span class=\"string\">net.ipv4.conf.default.accept_redirects = 0</span></span><br><span class=\"line\"><span class=\"string\">net.ipv4.conf.all.secure_redirects = 0</span></span><br><span class=\"line\"><span class=\"string\">net.ipv4.conf.default.secure_redirects = 0</span></span><br><span class=\"line\"><span class=\"string\">EOF</span></span><br><span class=\"line\">/sbin/sysctl -p</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">init_vim</span></span>()&#123;</span><br><span class=\"line\"><span class=\"built_in\">echo</span> -e <span class=\"string\">&quot;\\033[1;32m ###########  初始化vim 配置  ############# \\033[0m&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> [ !$(rpm -q vim-common) ];<span class=\"keyword\">then</span></span><br><span class=\"line\">yum install vim -y</span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&#x27;alias vi=vim&#x27;</span> &gt;&gt; /etc/profile</span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&#x27;stty erase ^H&#x27;</span> &gt;&gt; /etc/profile</span><br><span class=\"line\">cat &gt;&gt; /root/.vimrc &lt;&lt; <span class=\"string\">EOF</span></span><br><span class=\"line\"><span class=\"string\">set tabstop=4</span></span><br><span class=\"line\"><span class=\"string\">set shiftwidth=4</span></span><br><span class=\"line\"><span class=\"string\">set expandtab</span></span><br><span class=\"line\"><span class=\"string\">syntax on</span></span><br><span class=\"line\"><span class=\"string\">&quot;set number</span></span><br><span class=\"line\"><span class=\"string\">EOF</span></span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"function\"><span class=\"title\">other</span></span>()&#123;</span><br><span class=\"line\">yum groupinstall Development tools -y &gt;/dev/null 2&gt;&amp;1</span><br><span class=\"line\">yum install -y vim wget lrzsz telnet traceroute iotop tree &gt;/dev/null 2&gt;&amp;1</span><br><span class=\"line\">yum install -y ncftp axel git zlib-devel openssl-devel unzip xz libxslt-devel libxml2-devel libcurl-devel &gt;/dev/null 2&gt;&amp;1</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"function\"><span class=\"title\">history</span></span>()&#123;</span><br><span class=\"line\"><span class=\"keyword\">if</span> ! grep <span class=\"string\">&quot;HISTTIMEFORMAT&quot;</span> /etc/profile &gt;/dev/null 2&gt;&amp;1</span><br><span class=\"line\"><span class=\"keyword\">then</span> <span class=\"built_in\">echo</span> <span class=\"string\">&#x27;</span></span><br><span class=\"line\"><span class=\"string\">UserIP=$(who -u am i | cut -d&quot;(&quot;  -f 2 | sed -e &quot;s/[()]//g&quot;)</span></span><br><span class=\"line\"><span class=\"string\">export HISTTIMEFORMAT=&quot;[%F %T] [`whoami`] [$&#123;UserIP&#125;] &quot; &#x27;</span> &gt;&gt; /etc/profile;</span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"><span class=\"comment\">#echo &quot;[history 优化] ==&gt; OK&quot;</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">platform=$(uname -i)</span><br><span class=\"line\"><span class=\"keyword\">if</span> [ <span class=\"variable\">$&#123;platform&#125;</span> != <span class=\"string\">&quot;x86_64&quot;</span> ];<span class=\"keyword\">then</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;这个脚本只能优化 64位系统&quot;</span></span><br><span class=\"line\"><span class=\"built_in\">exit</span> 1</span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"></span><br><span class=\"line\">init_yum</span><br><span class=\"line\">init_ntp</span><br><span class=\"line\">init_selinux</span><br><span class=\"line\">ulimits</span><br><span class=\"line\">other</span><br><span class=\"line\"><span class=\"built_in\">history</span></span><br><span class=\"line\">init_vim</span><br><span class=\"line\">init_sysctl</span><br><span class=\"line\"></span><br><span class=\"line\">cat &lt;&lt; <span class=\"string\">EOF</span></span><br><span class=\"line\"><span class=\"string\">+-------------------------------------------------+</span></span><br><span class=\"line\"><span class=\"string\">|                优 化 已 完 成             |</span></span><br><span class=\"line\"><span class=\"string\">|             5s 后 重启 这台服务器 !       |</span></span><br><span class=\"line\"><span class=\"string\">+-------------------------------------------------+</span></span><br><span class=\"line\"><span class=\"string\">EOF</span></span><br><span class=\"line\"></span><br><span class=\"line\">sleep 5</span><br><span class=\"line\"></span><br><span class=\"line\">reboot</span><br></pre></td></tr></table></figure>\n\n\n\n<p>jdk 环境变量</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;etc&#x2F;profile.d&#x2F;jdk.sh</span><br><span class=\"line\"></span><br><span class=\"line\">JAVA_HOME&#x3D;&#x2F;opt&#x2F;jdk1.8.0_221</span><br><span class=\"line\">CLASSPATH&#x3D;$&#123;JAVA_HOME&#125;&#x2F;lib&#x2F;</span><br><span class=\"line\">PATH&#x3D;$PATH:$&#123;JAVA_HOME&#125;&#x2F;bin</span><br><span class=\"line\">export PATH JAVA_HOME CLASSPAT</span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"","more":"<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/bin/bash</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">set</span> -e</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">init_yum</span></span>()&#123;</span><br><span class=\"line\"><span class=\"built_in\">echo</span> -e <span class=\"string\">&quot;\\033[1;32m ###########  初始化yum 源 ############# \\033[0m&quot;</span></span><br><span class=\"line\"><span class=\"built_in\">cd</span> /etc/yum.repos.d/</span><br><span class=\"line\">[[ ! -d repo ]] &amp;&amp; mkdir -p repo || <span class=\"built_in\">echo</span> <span class=\"string\">&quot;已存在&quot;</span></span><br><span class=\"line\">\\mv -f Cent* repo</span><br><span class=\"line\"><span class=\"comment\"># aliyun</span></span><br><span class=\"line\">curl -s -O  http://mirrors.aliyun.com/repo/Centos-7.repo</span><br><span class=\"line\"><span class=\"comment\"># 163</span></span><br><span class=\"line\">curl -s -O http://mirrors.163.com/.<span class=\"built_in\">help</span>/CentOS7-Base-163.repo</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 安装epel源</span></span><br><span class=\"line\">yum install -y epel-release</span><br><span class=\"line\"><span class=\"comment\"># 安装aliyun epel源</span></span><br><span class=\"line\">curl -o /etc/yum.repos.d/epel-7.repo http://mirrors.aliyun.com/repo/epel-7.repo</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 清除系统所有的yum缓存</span></span><br><span class=\"line\">yum clean all</span><br><span class=\"line\"><span class=\"comment\"># 生成yum缓存</span></span><br><span class=\"line\">yum makecache</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 查看系统可用的yum源和所有的yum源</span></span><br><span class=\"line\">yum repolist enabled</span><br><span class=\"line\"><span class=\"built_in\">cd</span> -</span><br><span class=\"line\"></span><br><span class=\"line\">sleep 1</span><br><span class=\"line\"><span class=\"built_in\">echo</span> -e <span class=\"string\">&quot;\\033[1;32m ###########  初始化yum 源 完成 ############# \\033[0m&quot;</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">init_ntp</span></span>()&#123;</span><br><span class=\"line\"><span class=\"built_in\">echo</span> -e <span class=\"string\">&quot;\\033[1;32m ###########  时间同步  ############# \\033[0m&quot;</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> [ !$(rpm -qa | grep ntp-) ];<span class=\"keyword\">then</span></span><br><span class=\"line\">yum install ntp -y</span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"></span><br><span class=\"line\">cat &gt;/etc/ntp.conf&lt;&lt;<span class=\"string\">EOF</span></span><br><span class=\"line\"><span class=\"string\">driftfile /var/lib/ntp/drift</span></span><br><span class=\"line\"><span class=\"string\">restrict default nomodify notrap nopeer noquery</span></span><br><span class=\"line\"><span class=\"string\">restrict 127.0.0.1 </span></span><br><span class=\"line\"><span class=\"string\">restrict ::1</span></span><br><span class=\"line\"><span class=\"string\">server cn.ntp.org.cn iburst</span></span><br><span class=\"line\"><span class=\"string\">server ntp.aliyun.com iburst</span></span><br><span class=\"line\"><span class=\"string\">includefile /etc/ntp/crypto/pw</span></span><br><span class=\"line\"><span class=\"string\">keys /etc/ntp/keys</span></span><br><span class=\"line\"><span class=\"string\">disable monitor</span></span><br><span class=\"line\"><span class=\"string\">EOF</span></span><br><span class=\"line\"></span><br><span class=\"line\">systemctl start ntpd</span><br><span class=\"line\">systemctl <span class=\"built_in\">enable</span> ntpd</span><br><span class=\"line\">systemctl status ntpd</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"function\"><span class=\"title\">ulimits</span></span>()&#123;</span><br><span class=\"line\">cat &gt; /etc/security/limits.conf &lt;&lt;<span class=\"string\">EOF</span></span><br><span class=\"line\"><span class=\"string\">* soft noproc 20480</span></span><br><span class=\"line\"><span class=\"string\">* hard noproc 20480</span></span><br><span class=\"line\"><span class=\"string\">root soft nofile 65536</span></span><br><span class=\"line\"><span class=\"string\">root hard nofile 65536</span></span><br><span class=\"line\"><span class=\"string\">* soft nofile 65536</span></span><br><span class=\"line\"><span class=\"string\">* hard nofile 65536</span></span><br><span class=\"line\"><span class=\"string\">EOF</span></span><br><span class=\"line\"><span class=\"built_in\">ulimit</span> -n 65536</span><br><span class=\"line\"><span class=\"built_in\">ulimit</span> -u 20480</span><br><span class=\"line\"><span class=\"comment\">#echo &quot;[ulimits 配置] ==&gt; OK&quot;</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">init_selinux</span></span>()&#123;</span><br><span class=\"line\"><span class=\"built_in\">echo</span> -e <span class=\"string\">&quot;\\033[1;32m 禁用SELinux / 关闭防火墙  ############# \\033[0m&quot;</span></span><br><span class=\"line\">sed -i <span class=\"string\">&#x27;/SELINUX/s/enforcing/disabled/&#x27;</span> /etc/selinux/config</span><br><span class=\"line\">setenforce 0</span><br><span class=\"line\"></span><br><span class=\"line\">sed -i <span class=\"string\">&#x27;s/^GSSAPIAuthentication yes$/GSSAPIAuthentication no/&#x27;</span> /etc/ssh/sshd_config</span><br><span class=\"line\">sed -i <span class=\"string\">&#x27;s/#UseDNS yes/UseDNS no/&#x27;</span> /etc/ssh/sshd_config</span><br><span class=\"line\"></span><br><span class=\"line\">yum install -y openssl openssh bash</span><br><span class=\"line\"></span><br><span class=\"line\">systemctl  restart sshd.service</span><br><span class=\"line\">systemctl stop firewalld.service</span><br><span class=\"line\">systemctl <span class=\"built_in\">disable</span> firewalld.service</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">init_sysctl</span></span>()&#123;</span><br><span class=\"line\"><span class=\"built_in\">echo</span> -e <span class=\"string\">&quot;\\033[1;32m ###########  内核参数优化  ############# \\033[0m&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">cat &gt;&gt; /etc/sysctl.conf &lt;&lt; <span class=\"string\">EOF</span></span><br><span class=\"line\"><span class=\"string\">#CTCDN系统优化参数</span></span><br><span class=\"line\"><span class=\"string\">#关闭ipv6</span></span><br><span class=\"line\"><span class=\"string\">net.ipv6.conf.all.disable_ipv6 = 1</span></span><br><span class=\"line\"><span class=\"string\">net.ipv6.conf.default.disable_ipv6 = 1</span></span><br><span class=\"line\"><span class=\"string\">#决定检查过期多久邻居条目</span></span><br><span class=\"line\"><span class=\"string\">net.ipv4.neigh.default.gc_stale_time=120</span></span><br><span class=\"line\"><span class=\"string\">#使用arp_announce / arp_ignore解决ARP映射问题</span></span><br><span class=\"line\"><span class=\"string\">net.ipv4.conf.default.arp_announce = 2</span></span><br><span class=\"line\"><span class=\"string\">net.ipv4.conf.all.arp_announce=2</span></span><br><span class=\"line\"><span class=\"string\">net.ipv4.conf.lo.arp_announce=2</span></span><br><span class=\"line\"><span class=\"string\"># 避免放大攻击</span></span><br><span class=\"line\"><span class=\"string\">net.ipv4.icmp_echo_ignore_broadcasts = 1</span></span><br><span class=\"line\"><span class=\"string\"># 开启恶意icmp错误消息保护</span></span><br><span class=\"line\"><span class=\"string\">net.ipv4.icmp_ignore_bogus_error_responses = 1</span></span><br><span class=\"line\"><span class=\"string\">#关闭路由转发</span></span><br><span class=\"line\"><span class=\"string\">net.ipv4.ip_forward = 0</span></span><br><span class=\"line\"><span class=\"string\">net.ipv4.conf.all.send_redirects = 0</span></span><br><span class=\"line\"><span class=\"string\">net.ipv4.conf.default.send_redirects = 0</span></span><br><span class=\"line\"><span class=\"string\">#开启反向路径过滤</span></span><br><span class=\"line\"><span class=\"string\">net.ipv4.conf.all.rp_filter = 1</span></span><br><span class=\"line\"><span class=\"string\">net.ipv4.conf.default.rp_filter = 1</span></span><br><span class=\"line\"><span class=\"string\">#处理无源路由的包</span></span><br><span class=\"line\"><span class=\"string\">net.ipv4.conf.all.accept_source_route = 0</span></span><br><span class=\"line\"><span class=\"string\">net.ipv4.conf.default.accept_source_route = 0</span></span><br><span class=\"line\"><span class=\"string\">#关闭sysrq功能</span></span><br><span class=\"line\"><span class=\"string\">kernel.sysrq = 0</span></span><br><span class=\"line\"><span class=\"string\">#core文件名中添加pid作为扩展名</span></span><br><span class=\"line\"><span class=\"string\">kernel.core_uses_pid = 1</span></span><br><span class=\"line\"><span class=\"string\"># 开启SYN洪水攻击保护</span></span><br><span class=\"line\"><span class=\"string\">net.ipv4.tcp_syncookies = 1</span></span><br><span class=\"line\"><span class=\"string\">#修改消息队列长度</span></span><br><span class=\"line\"><span class=\"string\">kernel.msgmnb = 65536</span></span><br><span class=\"line\"><span class=\"string\">kernel.msgmax = 65536</span></span><br><span class=\"line\"><span class=\"string\">#设置最大内存共享段大小bytes</span></span><br><span class=\"line\"><span class=\"string\">kernel.shmmax = 68719476736</span></span><br><span class=\"line\"><span class=\"string\">kernel.shmall = 4294967296</span></span><br><span class=\"line\"><span class=\"string\">#timewait的数量，默认180000</span></span><br><span class=\"line\"><span class=\"string\">net.ipv4.tcp_max_tw_buckets = 6000</span></span><br><span class=\"line\"><span class=\"string\">net.ipv4.tcp_sack = 1</span></span><br><span class=\"line\"><span class=\"string\">net.ipv4.tcp_window_scaling = 1</span></span><br><span class=\"line\"><span class=\"string\">net.ipv4.tcp_rmem = 4096        87380   4194304</span></span><br><span class=\"line\"><span class=\"string\">net.ipv4.tcp_wmem = 4096        16384   4194304</span></span><br><span class=\"line\"><span class=\"string\">net.core.wmem_default = 8388608</span></span><br><span class=\"line\"><span class=\"string\">net.core.rmem_default = 8388608</span></span><br><span class=\"line\"><span class=\"string\">net.core.rmem_max = 16777216</span></span><br><span class=\"line\"><span class=\"string\">net.core.wmem_max = 16777216</span></span><br><span class=\"line\"><span class=\"string\">#每个网络接口接收数据包的速率比内核处理这些包的速率快时，允许送到队列的数据包的最大数目</span></span><br><span class=\"line\"><span class=\"string\">net.core.netdev_max_backlog = 262144</span></span><br><span class=\"line\"><span class=\"string\">#限制仅仅是为了防止简单的DoS 攻击</span></span><br><span class=\"line\"><span class=\"string\">net.ipv4.tcp_max_orphans = 3276800</span></span><br><span class=\"line\"><span class=\"string\">#未收到客户端确认信息的连接请求的最大值</span></span><br><span class=\"line\"><span class=\"string\">net.ipv4.tcp_max_syn_backlog = 262144</span></span><br><span class=\"line\"><span class=\"string\">net.ipv4.tcp_timestamps = 0</span></span><br><span class=\"line\"><span class=\"string\">#内核放弃建立连接之前发送SYNACK 包的数量</span></span><br><span class=\"line\"><span class=\"string\">net.ipv4.tcp_synack_retries = 1</span></span><br><span class=\"line\"><span class=\"string\">#内核放弃建立连接之前发送SYN 包的数量</span></span><br><span class=\"line\"><span class=\"string\">net.ipv4.tcp_syn_retries = 1</span></span><br><span class=\"line\"><span class=\"string\">#启用timewait 快速回收</span></span><br><span class=\"line\"><span class=\"string\">net.ipv4.tcp_tw_recycle = 1</span></span><br><span class=\"line\"><span class=\"string\">#开启重用。允许将TIME-WAIT sockets 重新用于新的TCP 连接</span></span><br><span class=\"line\"><span class=\"string\">net.ipv4.tcp_tw_reuse = 1</span></span><br><span class=\"line\"><span class=\"string\">net.ipv4.tcp_mem = 94500000 915000000 927000000</span></span><br><span class=\"line\"><span class=\"string\">net.ipv4.tcp_fin_timeout = 1</span></span><br><span class=\"line\"><span class=\"string\">#当keepalive 起用的时候，TCP 发送keepalive 消息的频度。缺省是2 小时</span></span><br><span class=\"line\"><span class=\"string\">net.ipv4.tcp_keepalive_time = 1800</span></span><br><span class=\"line\"><span class=\"string\">net.ipv4.tcp_keepalive_probes = 3</span></span><br><span class=\"line\"><span class=\"string\">net.ipv4.tcp_keepalive_intvl = 15</span></span><br><span class=\"line\"><span class=\"string\">#允许系统打开的端口范围</span></span><br><span class=\"line\"><span class=\"string\">net.ipv4.ip_local_port_range = 1024    65000</span></span><br><span class=\"line\"><span class=\"string\"># 确保无人能修改路由表</span></span><br><span class=\"line\"><span class=\"string\">net.ipv4.conf.all.accept_redirects = 0</span></span><br><span class=\"line\"><span class=\"string\">net.ipv4.conf.default.accept_redirects = 0</span></span><br><span class=\"line\"><span class=\"string\">net.ipv4.conf.all.secure_redirects = 0</span></span><br><span class=\"line\"><span class=\"string\">net.ipv4.conf.default.secure_redirects = 0</span></span><br><span class=\"line\"><span class=\"string\">EOF</span></span><br><span class=\"line\">/sbin/sysctl -p</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">init_vim</span></span>()&#123;</span><br><span class=\"line\"><span class=\"built_in\">echo</span> -e <span class=\"string\">&quot;\\033[1;32m ###########  初始化vim 配置  ############# \\033[0m&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> [ !$(rpm -q vim-common) ];<span class=\"keyword\">then</span></span><br><span class=\"line\">yum install vim -y</span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&#x27;alias vi=vim&#x27;</span> &gt;&gt; /etc/profile</span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&#x27;stty erase ^H&#x27;</span> &gt;&gt; /etc/profile</span><br><span class=\"line\">cat &gt;&gt; /root/.vimrc &lt;&lt; <span class=\"string\">EOF</span></span><br><span class=\"line\"><span class=\"string\">set tabstop=4</span></span><br><span class=\"line\"><span class=\"string\">set shiftwidth=4</span></span><br><span class=\"line\"><span class=\"string\">set expandtab</span></span><br><span class=\"line\"><span class=\"string\">syntax on</span></span><br><span class=\"line\"><span class=\"string\">&quot;set number</span></span><br><span class=\"line\"><span class=\"string\">EOF</span></span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"function\"><span class=\"title\">other</span></span>()&#123;</span><br><span class=\"line\">yum groupinstall Development tools -y &gt;/dev/null 2&gt;&amp;1</span><br><span class=\"line\">yum install -y vim wget lrzsz telnet traceroute iotop tree &gt;/dev/null 2&gt;&amp;1</span><br><span class=\"line\">yum install -y ncftp axel git zlib-devel openssl-devel unzip xz libxslt-devel libxml2-devel libcurl-devel &gt;/dev/null 2&gt;&amp;1</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"function\"><span class=\"title\">history</span></span>()&#123;</span><br><span class=\"line\"><span class=\"keyword\">if</span> ! grep <span class=\"string\">&quot;HISTTIMEFORMAT&quot;</span> /etc/profile &gt;/dev/null 2&gt;&amp;1</span><br><span class=\"line\"><span class=\"keyword\">then</span> <span class=\"built_in\">echo</span> <span class=\"string\">&#x27;</span></span><br><span class=\"line\"><span class=\"string\">UserIP=$(who -u am i | cut -d&quot;(&quot;  -f 2 | sed -e &quot;s/[()]//g&quot;)</span></span><br><span class=\"line\"><span class=\"string\">export HISTTIMEFORMAT=&quot;[%F %T] [`whoami`] [$&#123;UserIP&#125;] &quot; &#x27;</span> &gt;&gt; /etc/profile;</span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"><span class=\"comment\">#echo &quot;[history 优化] ==&gt; OK&quot;</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">platform=$(uname -i)</span><br><span class=\"line\"><span class=\"keyword\">if</span> [ <span class=\"variable\">$&#123;platform&#125;</span> != <span class=\"string\">&quot;x86_64&quot;</span> ];<span class=\"keyword\">then</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;这个脚本只能优化 64位系统&quot;</span></span><br><span class=\"line\"><span class=\"built_in\">exit</span> 1</span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"></span><br><span class=\"line\">init_yum</span><br><span class=\"line\">init_ntp</span><br><span class=\"line\">init_selinux</span><br><span class=\"line\">ulimits</span><br><span class=\"line\">other</span><br><span class=\"line\"><span class=\"built_in\">history</span></span><br><span class=\"line\">init_vim</span><br><span class=\"line\">init_sysctl</span><br><span class=\"line\"></span><br><span class=\"line\">cat &lt;&lt; <span class=\"string\">EOF</span></span><br><span class=\"line\"><span class=\"string\">+-------------------------------------------------+</span></span><br><span class=\"line\"><span class=\"string\">|                优 化 已 完 成             |</span></span><br><span class=\"line\"><span class=\"string\">|             5s 后 重启 这台服务器 !       |</span></span><br><span class=\"line\"><span class=\"string\">+-------------------------------------------------+</span></span><br><span class=\"line\"><span class=\"string\">EOF</span></span><br><span class=\"line\"></span><br><span class=\"line\">sleep 5</span><br><span class=\"line\"></span><br><span class=\"line\">reboot</span><br></pre></td></tr></table></figure>\n\n\n\n<p>jdk 环境变量</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;etc&#x2F;profile.d&#x2F;jdk.sh</span><br><span class=\"line\"></span><br><span class=\"line\">JAVA_HOME&#x3D;&#x2F;opt&#x2F;jdk1.8.0_221</span><br><span class=\"line\">CLASSPATH&#x3D;$&#123;JAVA_HOME&#125;&#x2F;lib&#x2F;</span><br><span class=\"line\">PATH&#x3D;$PATH:$&#123;JAVA_HOME&#125;&#x2F;bin</span><br><span class=\"line\">export PATH JAVA_HOME CLASSPAT</span><br></pre></td></tr></table></figure>\n\n"},{"title":"centos7使用clamav扫描挖矿","date":"2021-02-01T02:38:00.000Z","_content":"  \n  \n摘要: 记录一次centos7扫描挖矿病毒\n<!-- more -->\n\n\n## 安装clamav\n#### 1、下载clamav源码包\n```\n#下载地址\nhttp://www.clamav.net/downloads\n\ncd /usr/local/src/\nwget https://clamav-site.s3.amazonaws.com/production/release_files/files/000/000/584/original/clamav-0.103.0.tar.gz?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIAIY6OSGQFGUNJQ7GQ%2F20210201%2Fus-east-1%2Fs3%2Faws4_request&X-Amz-Date=20210201T023706Z&X-Amz-Expires=3600&X-Amz-SignedHeaders=host&X-Amz-Signature=6aeefb9c748ac872bb11732317913ac36ffb4204f32886bda0f1154d897f1a1e\n```\n#### 2、安装编译依赖\n```\nyum install gcc-c++ openssl openssl-devel -y\n```\n#### 3、编译clamav\n```\ncd /usr/local/src/\ntar xf clamav-0.103.0.tar.gz\ncd clamav-0.103.0\n./configure --prefix=/usr/local/clamav-103  --sysconfdir=/etc\n# 将clamav安装到 /usr/local/clamav-0.103.0 将配置文件放到 /etc 目录\n```\n```\n...\nconfig.status: executing libtool commands\nconfigure: Summary of detected features follows\n              OS          : linux-gnu\n              pthreads    : yes (-lpthread)\nconfigure: Summary of miscellaneous features\n              check       : no (auto)\n              fanotify    : yes\n              fdpassing   : 1\n              IPv6        : yes\n              openssl     : /usr\n              libcurl     : /usr\nconfigure: Summary of optional tools\n              clamdtop    : no (missing ncurses / pdcurses) (disabled)\n              milter      : no (missing libmilter) (disabled)\n              clamsubmit  : no (missing libjson-c-dev. Use the website to submit FPs/FNs.) (disabled)\n              clamonacc   : yes (auto)\nconfigure: Summary of engine performance features\n              release mode: yes\n              llvm        : no (disabled)\n              mempool     : yes\nconfigure: Summary of engine detection features\n              iconv       : yes\n              bzip2       : ok\n              zlib        : yes (from system)\n              unrar       : yes\n              preclass    : no (missing libjson-c-dev) (disabled)\n              pcre        : /usr\n              libmspack   : yes (Internal)\n              libxml2     : no\n              yara        : yes\n              fts         : yes (internal, libc's is not LFS compatible)\n\n```\n#### 4、安装\n```\nmake -j4 && make check && make install\n```\n\n### 配置clamav\n#### 创建软连接\n```\nln -s /usr/local/clamav-103/bin/* /usr/local/bin/\nln -s /usr/local/clamav-103/sbin/* /usr/local/sbin/\n```\n#### 创建相关文件\n```\ncd /usr/local/clamav-103\nmkdir logs updata\nmkdir /var/lib/clamav\ncd logs\ntouch clamd.log freshclam.log\n```\n\n#### 修改配置文件\n```\ncd /etc\ncp clamd.conf.sample clamd.conf\ncp freshclam.conf.sample freshclam.conf\n\ncat >> clamd.conf <<-eof\nLocalSocket /var/lib/clamav/clamd.socket\nPidFile /var/lib/clamav/clamd.pid\nDatabaseDirectory /usr/local/clamav-103/updata\nLogFile /usr/local/clamav-103/logs/clamd.log\neof\n\ncat >> freshclam.conf <<-eof\nDatabaseDirectory /usr/local/clamav-103/updata\nUpdateLogFile /usr/local/clamav-103/logs/freshclam.log\nPidFile /var/lib/clamav/freshclam.pid\neof\n\n```\n将 Example 进行注释\n```\ncd /etc\nsed -i 's/Example/#Example/g' clamd.conf freshclam.conf\ngrep -n \"#Example\" clamd.conf freshclam.conf\n```\n\n#### 创建clamav用户并授权\n```\nuseradd -M -s /sbin/nologin clamav\nchown -R clamav:clamav /usr/local/clamav-103\nchown -R clamav:clamav /var/lib/clamav\n```\n\n### 启动clamd\n\n##### 更新病毒库\n```\nfreshclam   #如果下载慢,使用 错误二中的地址手动下载放入到病毒库目录中\n```\n\n```\nclamd start   # 如果报错，提示 'LibClamAV Error: cl_load(): No such file or directory:' 参数错误二\n```\n\n### 使用clamav\n\n参数说明\n```\n-r    递归扫描子文件\n–i    只显示被感染的文件\n-l    指定日志文件\n--remove    删除被感染文件\n--move    隔离被感染文件\n```\n\n使用示例\n```\nclamscan –ri / -l clamscan.log  --remove   #这里递归扫描根目录 / ，发现感染文件立即删除\n```\n\n\n| 选项                     | 适用的文件类型                  | 执行命令示例                      |\n| ------------------------ | ------------------------------- | --------------------------------- |\n| -r                       | 所有文件                        | clamscan -r                       |\n| --unrar                  | .rar 文件                       | clamscan --unrar                  |\n| --arj                    | .arj 文件                       | clamscan --arj                    |\n| --unzoo                  | .zoo 文件                       | clamscan --unzoo                  |\n| --lha                    | .lzh 文件                       | clamscan --lha                    |\n| --jar                    | .jar 文件                       | clamscan --jar                    |\n| --deb                    | .deb 安装包                     | clamscan --deb                    |\n| --tar                    | .tar 文件                       | clamscan --tar                    |\n| --tgz                    | .tar.gz                         | clamscan --tgz                    |\n| --log=FILE/-l FILE       | 增加扫描日志                    | clamscan -l /var/log/clamscan.log |\n| --move=directory         | 把病毒文件移动到目录directory下 | clamscan --move /tmp              |\n| --copy=directory         | 把病毒文件复制到目录directory下 | clamscan --copy /tmp              |\n| --remove                 | 删除病毒文件                    | clamscan --move /abc              |\n| --quiet                  | 输出错误消息                    | clamscan --quiet                  |\n| --infected/-i            | 输出感染文件                    | clamscan -i                       |\n| --suppress-ok-results/-o | 跳过扫描OK的文件                | clamscan -o                       |\n| –no-summary              | 不显示统计信息                  |                                   |\n| --bell                   | 扫描到病毒文件发出警报声音      |                                   |\n\n\n### 报错处理\n错误一\n```\n...\nchecking for ncurses/ncurses.h... no\nconfigure: unable to compile/link with ncurses\nchecking ncurses.h usability... no\nchecking ncurses.h presence... no\nchecking for ncurses.h... no\nconfigure: unable to compile/link with ncurses\nchecking curses.h usability... no\nchecking curses.h presence... no\nchecking for curses.h... no\nconfigure: unable to compile/link with pdcurses\nconfigure: WARNING: ****** not building clamdtop: ncurses not found\nchecking for llvm-config... no\nchecking LFS safe fts implementation... no\nchecking for libcurl installation... configure: error: libcurl not found. libcurl (e.g. libcurl-devel) is required in order to build freshclam and clamsubmit.\n```\n处理\n```\nyum install libcurl-devel -y\n```\n\n错误二\n```\n clamd start\nLibClamAV Error: cli_loaddbdir(): No supported database files found in /usr/local/clamav-103/updata\nERROR: Can't open file or directory\n```\n处理\n```\n原因分析\n原因：没有病毒库！\nyum安装的ClamAv，病毒库默认路径是:\n/var/lib/clamav\n\n源码安装时，默认的病毒库路径是：\n/usr/local/share/clamav\n\n而我在/etc/clamav.conf 中配的是 /usr/local/clamav-103/updata\n下载病毒库时，由于使用\"freshclam\"命令下载太慢，换成了wget的方式手动下载病毒库，如下:\ncd /usr/local/clamav-103/updata\nwget http://database.clamav.net/main.cvd\nwget http://database.clamav.net/daily.cvd\nwget http://database.clamav.net/bytecode.cvd\n```","source":"_posts/install/centos7使用clamav.md","raw":"---\ntitle: centos7使用clamav扫描挖矿\ndate: 2021-02-01 10:38\ncategories:\n- centos7\ntags:\n- clamav\n---\n  \n  \n摘要: 记录一次centos7扫描挖矿病毒\n<!-- more -->\n\n\n## 安装clamav\n#### 1、下载clamav源码包\n```\n#下载地址\nhttp://www.clamav.net/downloads\n\ncd /usr/local/src/\nwget https://clamav-site.s3.amazonaws.com/production/release_files/files/000/000/584/original/clamav-0.103.0.tar.gz?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIAIY6OSGQFGUNJQ7GQ%2F20210201%2Fus-east-1%2Fs3%2Faws4_request&X-Amz-Date=20210201T023706Z&X-Amz-Expires=3600&X-Amz-SignedHeaders=host&X-Amz-Signature=6aeefb9c748ac872bb11732317913ac36ffb4204f32886bda0f1154d897f1a1e\n```\n#### 2、安装编译依赖\n```\nyum install gcc-c++ openssl openssl-devel -y\n```\n#### 3、编译clamav\n```\ncd /usr/local/src/\ntar xf clamav-0.103.0.tar.gz\ncd clamav-0.103.0\n./configure --prefix=/usr/local/clamav-103  --sysconfdir=/etc\n# 将clamav安装到 /usr/local/clamav-0.103.0 将配置文件放到 /etc 目录\n```\n```\n...\nconfig.status: executing libtool commands\nconfigure: Summary of detected features follows\n              OS          : linux-gnu\n              pthreads    : yes (-lpthread)\nconfigure: Summary of miscellaneous features\n              check       : no (auto)\n              fanotify    : yes\n              fdpassing   : 1\n              IPv6        : yes\n              openssl     : /usr\n              libcurl     : /usr\nconfigure: Summary of optional tools\n              clamdtop    : no (missing ncurses / pdcurses) (disabled)\n              milter      : no (missing libmilter) (disabled)\n              clamsubmit  : no (missing libjson-c-dev. Use the website to submit FPs/FNs.) (disabled)\n              clamonacc   : yes (auto)\nconfigure: Summary of engine performance features\n              release mode: yes\n              llvm        : no (disabled)\n              mempool     : yes\nconfigure: Summary of engine detection features\n              iconv       : yes\n              bzip2       : ok\n              zlib        : yes (from system)\n              unrar       : yes\n              preclass    : no (missing libjson-c-dev) (disabled)\n              pcre        : /usr\n              libmspack   : yes (Internal)\n              libxml2     : no\n              yara        : yes\n              fts         : yes (internal, libc's is not LFS compatible)\n\n```\n#### 4、安装\n```\nmake -j4 && make check && make install\n```\n\n### 配置clamav\n#### 创建软连接\n```\nln -s /usr/local/clamav-103/bin/* /usr/local/bin/\nln -s /usr/local/clamav-103/sbin/* /usr/local/sbin/\n```\n#### 创建相关文件\n```\ncd /usr/local/clamav-103\nmkdir logs updata\nmkdir /var/lib/clamav\ncd logs\ntouch clamd.log freshclam.log\n```\n\n#### 修改配置文件\n```\ncd /etc\ncp clamd.conf.sample clamd.conf\ncp freshclam.conf.sample freshclam.conf\n\ncat >> clamd.conf <<-eof\nLocalSocket /var/lib/clamav/clamd.socket\nPidFile /var/lib/clamav/clamd.pid\nDatabaseDirectory /usr/local/clamav-103/updata\nLogFile /usr/local/clamav-103/logs/clamd.log\neof\n\ncat >> freshclam.conf <<-eof\nDatabaseDirectory /usr/local/clamav-103/updata\nUpdateLogFile /usr/local/clamav-103/logs/freshclam.log\nPidFile /var/lib/clamav/freshclam.pid\neof\n\n```\n将 Example 进行注释\n```\ncd /etc\nsed -i 's/Example/#Example/g' clamd.conf freshclam.conf\ngrep -n \"#Example\" clamd.conf freshclam.conf\n```\n\n#### 创建clamav用户并授权\n```\nuseradd -M -s /sbin/nologin clamav\nchown -R clamav:clamav /usr/local/clamav-103\nchown -R clamav:clamav /var/lib/clamav\n```\n\n### 启动clamd\n\n##### 更新病毒库\n```\nfreshclam   #如果下载慢,使用 错误二中的地址手动下载放入到病毒库目录中\n```\n\n```\nclamd start   # 如果报错，提示 'LibClamAV Error: cl_load(): No such file or directory:' 参数错误二\n```\n\n### 使用clamav\n\n参数说明\n```\n-r    递归扫描子文件\n–i    只显示被感染的文件\n-l    指定日志文件\n--remove    删除被感染文件\n--move    隔离被感染文件\n```\n\n使用示例\n```\nclamscan –ri / -l clamscan.log  --remove   #这里递归扫描根目录 / ，发现感染文件立即删除\n```\n\n\n| 选项                     | 适用的文件类型                  | 执行命令示例                      |\n| ------------------------ | ------------------------------- | --------------------------------- |\n| -r                       | 所有文件                        | clamscan -r                       |\n| --unrar                  | .rar 文件                       | clamscan --unrar                  |\n| --arj                    | .arj 文件                       | clamscan --arj                    |\n| --unzoo                  | .zoo 文件                       | clamscan --unzoo                  |\n| --lha                    | .lzh 文件                       | clamscan --lha                    |\n| --jar                    | .jar 文件                       | clamscan --jar                    |\n| --deb                    | .deb 安装包                     | clamscan --deb                    |\n| --tar                    | .tar 文件                       | clamscan --tar                    |\n| --tgz                    | .tar.gz                         | clamscan --tgz                    |\n| --log=FILE/-l FILE       | 增加扫描日志                    | clamscan -l /var/log/clamscan.log |\n| --move=directory         | 把病毒文件移动到目录directory下 | clamscan --move /tmp              |\n| --copy=directory         | 把病毒文件复制到目录directory下 | clamscan --copy /tmp              |\n| --remove                 | 删除病毒文件                    | clamscan --move /abc              |\n| --quiet                  | 输出错误消息                    | clamscan --quiet                  |\n| --infected/-i            | 输出感染文件                    | clamscan -i                       |\n| --suppress-ok-results/-o | 跳过扫描OK的文件                | clamscan -o                       |\n| –no-summary              | 不显示统计信息                  |                                   |\n| --bell                   | 扫描到病毒文件发出警报声音      |                                   |\n\n\n### 报错处理\n错误一\n```\n...\nchecking for ncurses/ncurses.h... no\nconfigure: unable to compile/link with ncurses\nchecking ncurses.h usability... no\nchecking ncurses.h presence... no\nchecking for ncurses.h... no\nconfigure: unable to compile/link with ncurses\nchecking curses.h usability... no\nchecking curses.h presence... no\nchecking for curses.h... no\nconfigure: unable to compile/link with pdcurses\nconfigure: WARNING: ****** not building clamdtop: ncurses not found\nchecking for llvm-config... no\nchecking LFS safe fts implementation... no\nchecking for libcurl installation... configure: error: libcurl not found. libcurl (e.g. libcurl-devel) is required in order to build freshclam and clamsubmit.\n```\n处理\n```\nyum install libcurl-devel -y\n```\n\n错误二\n```\n clamd start\nLibClamAV Error: cli_loaddbdir(): No supported database files found in /usr/local/clamav-103/updata\nERROR: Can't open file or directory\n```\n处理\n```\n原因分析\n原因：没有病毒库！\nyum安装的ClamAv，病毒库默认路径是:\n/var/lib/clamav\n\n源码安装时，默认的病毒库路径是：\n/usr/local/share/clamav\n\n而我在/etc/clamav.conf 中配的是 /usr/local/clamav-103/updata\n下载病毒库时，由于使用\"freshclam\"命令下载太慢，换成了wget的方式手动下载病毒库，如下:\ncd /usr/local/clamav-103/updata\nwget http://database.clamav.net/main.cvd\nwget http://database.clamav.net/daily.cvd\nwget http://database.clamav.net/bytecode.cvd\n```","slug":"install/centos7使用clamav","published":1,"updated":"2021-06-18T08:07:11.189Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cku6979z6002w00uhbijr2jh0","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><p>摘要: 记录一次centos7扫描挖矿病毒</p>\n<span id=\"more\"></span>\n\n\n<h2 id=\"安装clamav\"><a href=\"#安装clamav\" class=\"headerlink\" title=\"安装clamav\"></a>安装clamav</h2><h4 id=\"1、下载clamav源码包\"><a href=\"#1、下载clamav源码包\" class=\"headerlink\" title=\"1、下载clamav源码包\"></a>1、下载clamav源码包</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#下载地址</span><br><span class=\"line\">http:&#x2F;&#x2F;www.clamav.net&#x2F;downloads</span><br><span class=\"line\"></span><br><span class=\"line\">cd &#x2F;usr&#x2F;local&#x2F;src&#x2F;</span><br><span class=\"line\">wget https:&#x2F;&#x2F;clamav-site.s3.amazonaws.com&#x2F;production&#x2F;release_files&#x2F;files&#x2F;000&#x2F;000&#x2F;584&#x2F;original&#x2F;clamav-0.103.0.tar.gz?X-Amz-Algorithm&#x3D;AWS4-HMAC-SHA256&amp;X-Amz-Credential&#x3D;AKIAIY6OSGQFGUNJQ7GQ%2F20210201%2Fus-east-1%2Fs3%2Faws4_request&amp;X-Amz-Date&#x3D;20210201T023706Z&amp;X-Amz-Expires&#x3D;3600&amp;X-Amz-SignedHeaders&#x3D;host&amp;X-Amz-Signature&#x3D;6aeefb9c748ac872bb11732317913ac36ffb4204f32886bda0f1154d897f1a1e</span><br></pre></td></tr></table></figure>\n<h4 id=\"2、安装编译依赖\"><a href=\"#2、安装编译依赖\" class=\"headerlink\" title=\"2、安装编译依赖\"></a>2、安装编译依赖</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install gcc-c++ openssl openssl-devel -y</span><br></pre></td></tr></table></figure>\n<h4 id=\"3、编译clamav\"><a href=\"#3、编译clamav\" class=\"headerlink\" title=\"3、编译clamav\"></a>3、编译clamav</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd &#x2F;usr&#x2F;local&#x2F;src&#x2F;</span><br><span class=\"line\">tar xf clamav-0.103.0.tar.gz</span><br><span class=\"line\">cd clamav-0.103.0</span><br><span class=\"line\">.&#x2F;configure --prefix&#x3D;&#x2F;usr&#x2F;local&#x2F;clamav-103  --sysconfdir&#x3D;&#x2F;etc</span><br><span class=\"line\"># 将clamav安装到 &#x2F;usr&#x2F;local&#x2F;clamav-0.103.0 将配置文件放到 &#x2F;etc 目录</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">...</span><br><span class=\"line\">config.status: executing libtool commands</span><br><span class=\"line\">configure: Summary of detected features follows</span><br><span class=\"line\">              OS          : linux-gnu</span><br><span class=\"line\">              pthreads    : yes (-lpthread)</span><br><span class=\"line\">configure: Summary of miscellaneous features</span><br><span class=\"line\">              check       : no (auto)</span><br><span class=\"line\">              fanotify    : yes</span><br><span class=\"line\">              fdpassing   : 1</span><br><span class=\"line\">              IPv6        : yes</span><br><span class=\"line\">              openssl     : &#x2F;usr</span><br><span class=\"line\">              libcurl     : &#x2F;usr</span><br><span class=\"line\">configure: Summary of optional tools</span><br><span class=\"line\">              clamdtop    : no (missing ncurses &#x2F; pdcurses) (disabled)</span><br><span class=\"line\">              milter      : no (missing libmilter) (disabled)</span><br><span class=\"line\">              clamsubmit  : no (missing libjson-c-dev. Use the website to submit FPs&#x2F;FNs.) (disabled)</span><br><span class=\"line\">              clamonacc   : yes (auto)</span><br><span class=\"line\">configure: Summary of engine performance features</span><br><span class=\"line\">              release mode: yes</span><br><span class=\"line\">              llvm        : no (disabled)</span><br><span class=\"line\">              mempool     : yes</span><br><span class=\"line\">configure: Summary of engine detection features</span><br><span class=\"line\">              iconv       : yes</span><br><span class=\"line\">              bzip2       : ok</span><br><span class=\"line\">              zlib        : yes (from system)</span><br><span class=\"line\">              unrar       : yes</span><br><span class=\"line\">              preclass    : no (missing libjson-c-dev) (disabled)</span><br><span class=\"line\">              pcre        : &#x2F;usr</span><br><span class=\"line\">              libmspack   : yes (Internal)</span><br><span class=\"line\">              libxml2     : no</span><br><span class=\"line\">              yara        : yes</span><br><span class=\"line\">              fts         : yes (internal, libc&#39;s is not LFS compatible)</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h4 id=\"4、安装\"><a href=\"#4、安装\" class=\"headerlink\" title=\"4、安装\"></a>4、安装</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">make -j4 &amp;&amp; make check &amp;&amp; make install</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"配置clamav\"><a href=\"#配置clamav\" class=\"headerlink\" title=\"配置clamav\"></a>配置clamav</h3><h4 id=\"创建软连接\"><a href=\"#创建软连接\" class=\"headerlink\" title=\"创建软连接\"></a>创建软连接</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ln -s &#x2F;usr&#x2F;local&#x2F;clamav-103&#x2F;bin&#x2F;* &#x2F;usr&#x2F;local&#x2F;bin&#x2F;</span><br><span class=\"line\">ln -s &#x2F;usr&#x2F;local&#x2F;clamav-103&#x2F;sbin&#x2F;* &#x2F;usr&#x2F;local&#x2F;sbin&#x2F;</span><br></pre></td></tr></table></figure>\n<h4 id=\"创建相关文件\"><a href=\"#创建相关文件\" class=\"headerlink\" title=\"创建相关文件\"></a>创建相关文件</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd &#x2F;usr&#x2F;local&#x2F;clamav-103</span><br><span class=\"line\">mkdir logs updata</span><br><span class=\"line\">mkdir &#x2F;var&#x2F;lib&#x2F;clamav</span><br><span class=\"line\">cd logs</span><br><span class=\"line\">touch clamd.log freshclam.log</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"修改配置文件\"><a href=\"#修改配置文件\" class=\"headerlink\" title=\"修改配置文件\"></a>修改配置文件</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd &#x2F;etc</span><br><span class=\"line\">cp clamd.conf.sample clamd.conf</span><br><span class=\"line\">cp freshclam.conf.sample freshclam.conf</span><br><span class=\"line\"></span><br><span class=\"line\">cat &gt;&gt; clamd.conf &lt;&lt;-eof</span><br><span class=\"line\">LocalSocket &#x2F;var&#x2F;lib&#x2F;clamav&#x2F;clamd.socket</span><br><span class=\"line\">PidFile &#x2F;var&#x2F;lib&#x2F;clamav&#x2F;clamd.pid</span><br><span class=\"line\">DatabaseDirectory &#x2F;usr&#x2F;local&#x2F;clamav-103&#x2F;updata</span><br><span class=\"line\">LogFile &#x2F;usr&#x2F;local&#x2F;clamav-103&#x2F;logs&#x2F;clamd.log</span><br><span class=\"line\">eof</span><br><span class=\"line\"></span><br><span class=\"line\">cat &gt;&gt; freshclam.conf &lt;&lt;-eof</span><br><span class=\"line\">DatabaseDirectory &#x2F;usr&#x2F;local&#x2F;clamav-103&#x2F;updata</span><br><span class=\"line\">UpdateLogFile &#x2F;usr&#x2F;local&#x2F;clamav-103&#x2F;logs&#x2F;freshclam.log</span><br><span class=\"line\">PidFile &#x2F;var&#x2F;lib&#x2F;clamav&#x2F;freshclam.pid</span><br><span class=\"line\">eof</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>将 Example 进行注释</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd &#x2F;etc</span><br><span class=\"line\">sed -i &#39;s&#x2F;Example&#x2F;#Example&#x2F;g&#39; clamd.conf freshclam.conf</span><br><span class=\"line\">grep -n &quot;#Example&quot; clamd.conf freshclam.conf</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"创建clamav用户并授权\"><a href=\"#创建clamav用户并授权\" class=\"headerlink\" title=\"创建clamav用户并授权\"></a>创建clamav用户并授权</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">useradd -M -s &#x2F;sbin&#x2F;nologin clamav</span><br><span class=\"line\">chown -R clamav:clamav &#x2F;usr&#x2F;local&#x2F;clamav-103</span><br><span class=\"line\">chown -R clamav:clamav &#x2F;var&#x2F;lib&#x2F;clamav</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"启动clamd\"><a href=\"#启动clamd\" class=\"headerlink\" title=\"启动clamd\"></a>启动clamd</h3><h5 id=\"更新病毒库\"><a href=\"#更新病毒库\" class=\"headerlink\" title=\"更新病毒库\"></a>更新病毒库</h5><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">freshclam   #如果下载慢,使用 错误二中的地址手动下载放入到病毒库目录中</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">clamd start   # 如果报错，提示 &#39;LibClamAV Error: cl_load(): No such file or directory:&#39; 参数错误二</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"使用clamav\"><a href=\"#使用clamav\" class=\"headerlink\" title=\"使用clamav\"></a>使用clamav</h3><p>参数说明</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">-r    递归扫描子文件</span><br><span class=\"line\">–i    只显示被感染的文件</span><br><span class=\"line\">-l    指定日志文件</span><br><span class=\"line\">--remove    删除被感染文件</span><br><span class=\"line\">--move    隔离被感染文件</span><br></pre></td></tr></table></figure>\n\n<p>使用示例</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">clamscan –ri &#x2F; -l clamscan.log  --remove   #这里递归扫描根目录 &#x2F; ，发现感染文件立即删除</span><br></pre></td></tr></table></figure>\n\n\n<table>\n<thead>\n<tr>\n<th>选项</th>\n<th>适用的文件类型</th>\n<th>执行命令示例</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>-r</td>\n<td>所有文件</td>\n<td>clamscan -r</td>\n</tr>\n<tr>\n<td>–unrar</td>\n<td>.rar 文件</td>\n<td>clamscan –unrar</td>\n</tr>\n<tr>\n<td>–arj</td>\n<td>.arj 文件</td>\n<td>clamscan –arj</td>\n</tr>\n<tr>\n<td>–unzoo</td>\n<td>.zoo 文件</td>\n<td>clamscan –unzoo</td>\n</tr>\n<tr>\n<td>–lha</td>\n<td>.lzh 文件</td>\n<td>clamscan –lha</td>\n</tr>\n<tr>\n<td>–jar</td>\n<td>.jar 文件</td>\n<td>clamscan –jar</td>\n</tr>\n<tr>\n<td>–deb</td>\n<td>.deb 安装包</td>\n<td>clamscan –deb</td>\n</tr>\n<tr>\n<td>–tar</td>\n<td>.tar 文件</td>\n<td>clamscan –tar</td>\n</tr>\n<tr>\n<td>–tgz</td>\n<td>.tar.gz</td>\n<td>clamscan –tgz</td>\n</tr>\n<tr>\n<td>–log=FILE/-l FILE</td>\n<td>增加扫描日志</td>\n<td>clamscan -l /var/log/clamscan.log</td>\n</tr>\n<tr>\n<td>–move=directory</td>\n<td>把病毒文件移动到目录directory下</td>\n<td>clamscan –move /tmp</td>\n</tr>\n<tr>\n<td>–copy=directory</td>\n<td>把病毒文件复制到目录directory下</td>\n<td>clamscan –copy /tmp</td>\n</tr>\n<tr>\n<td>–remove</td>\n<td>删除病毒文件</td>\n<td>clamscan –move /abc</td>\n</tr>\n<tr>\n<td>–quiet</td>\n<td>输出错误消息</td>\n<td>clamscan –quiet</td>\n</tr>\n<tr>\n<td>–infected/-i</td>\n<td>输出感染文件</td>\n<td>clamscan -i</td>\n</tr>\n<tr>\n<td>–suppress-ok-results/-o</td>\n<td>跳过扫描OK的文件</td>\n<td>clamscan -o</td>\n</tr>\n<tr>\n<td>–no-summary</td>\n<td>不显示统计信息</td>\n<td></td>\n</tr>\n<tr>\n<td>–bell</td>\n<td>扫描到病毒文件发出警报声音</td>\n<td></td>\n</tr>\n</tbody></table>\n<h3 id=\"报错处理\"><a href=\"#报错处理\" class=\"headerlink\" title=\"报错处理\"></a>报错处理</h3><p>错误一</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">...</span><br><span class=\"line\">checking for ncurses&#x2F;ncurses.h... no</span><br><span class=\"line\">configure: unable to compile&#x2F;link with ncurses</span><br><span class=\"line\">checking ncurses.h usability... no</span><br><span class=\"line\">checking ncurses.h presence... no</span><br><span class=\"line\">checking for ncurses.h... no</span><br><span class=\"line\">configure: unable to compile&#x2F;link with ncurses</span><br><span class=\"line\">checking curses.h usability... no</span><br><span class=\"line\">checking curses.h presence... no</span><br><span class=\"line\">checking for curses.h... no</span><br><span class=\"line\">configure: unable to compile&#x2F;link with pdcurses</span><br><span class=\"line\">configure: WARNING: ****** not building clamdtop: ncurses not found</span><br><span class=\"line\">checking for llvm-config... no</span><br><span class=\"line\">checking LFS safe fts implementation... no</span><br><span class=\"line\">checking for libcurl installation... configure: error: libcurl not found. libcurl (e.g. libcurl-devel) is required in order to build freshclam and clamsubmit.</span><br></pre></td></tr></table></figure>\n<p>处理</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install libcurl-devel -y</span><br></pre></td></tr></table></figure>\n\n<p>错误二</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> clamd start</span><br><span class=\"line\">LibClamAV Error: cli_loaddbdir(): No supported database files found in &#x2F;usr&#x2F;local&#x2F;clamav-103&#x2F;updata</span><br><span class=\"line\">ERROR: Can&#39;t open file or directory</span><br></pre></td></tr></table></figure>\n<p>处理</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">原因分析</span><br><span class=\"line\">原因：没有病毒库！</span><br><span class=\"line\">yum安装的ClamAv，病毒库默认路径是:</span><br><span class=\"line\">&#x2F;var&#x2F;lib&#x2F;clamav</span><br><span class=\"line\"></span><br><span class=\"line\">源码安装时，默认的病毒库路径是：</span><br><span class=\"line\">&#x2F;usr&#x2F;local&#x2F;share&#x2F;clamav</span><br><span class=\"line\"></span><br><span class=\"line\">而我在&#x2F;etc&#x2F;clamav.conf 中配的是 &#x2F;usr&#x2F;local&#x2F;clamav-103&#x2F;updata</span><br><span class=\"line\">下载病毒库时，由于使用&quot;freshclam&quot;命令下载太慢，换成了wget的方式手动下载病毒库，如下:</span><br><span class=\"line\">cd &#x2F;usr&#x2F;local&#x2F;clamav-103&#x2F;updata</span><br><span class=\"line\">wget http:&#x2F;&#x2F;database.clamav.net&#x2F;main.cvd</span><br><span class=\"line\">wget http:&#x2F;&#x2F;database.clamav.net&#x2F;daily.cvd</span><br><span class=\"line\">wget http:&#x2F;&#x2F;database.clamav.net&#x2F;bytecode.cvd</span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"<p>摘要: 记录一次centos7扫描挖矿病毒</p>","more":"<h2 id=\"安装clamav\"><a href=\"#安装clamav\" class=\"headerlink\" title=\"安装clamav\"></a>安装clamav</h2><h4 id=\"1、下载clamav源码包\"><a href=\"#1、下载clamav源码包\" class=\"headerlink\" title=\"1、下载clamav源码包\"></a>1、下载clamav源码包</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#下载地址</span><br><span class=\"line\">http:&#x2F;&#x2F;www.clamav.net&#x2F;downloads</span><br><span class=\"line\"></span><br><span class=\"line\">cd &#x2F;usr&#x2F;local&#x2F;src&#x2F;</span><br><span class=\"line\">wget https:&#x2F;&#x2F;clamav-site.s3.amazonaws.com&#x2F;production&#x2F;release_files&#x2F;files&#x2F;000&#x2F;000&#x2F;584&#x2F;original&#x2F;clamav-0.103.0.tar.gz?X-Amz-Algorithm&#x3D;AWS4-HMAC-SHA256&amp;X-Amz-Credential&#x3D;AKIAIY6OSGQFGUNJQ7GQ%2F20210201%2Fus-east-1%2Fs3%2Faws4_request&amp;X-Amz-Date&#x3D;20210201T023706Z&amp;X-Amz-Expires&#x3D;3600&amp;X-Amz-SignedHeaders&#x3D;host&amp;X-Amz-Signature&#x3D;6aeefb9c748ac872bb11732317913ac36ffb4204f32886bda0f1154d897f1a1e</span><br></pre></td></tr></table></figure>\n<h4 id=\"2、安装编译依赖\"><a href=\"#2、安装编译依赖\" class=\"headerlink\" title=\"2、安装编译依赖\"></a>2、安装编译依赖</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install gcc-c++ openssl openssl-devel -y</span><br></pre></td></tr></table></figure>\n<h4 id=\"3、编译clamav\"><a href=\"#3、编译clamav\" class=\"headerlink\" title=\"3、编译clamav\"></a>3、编译clamav</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd &#x2F;usr&#x2F;local&#x2F;src&#x2F;</span><br><span class=\"line\">tar xf clamav-0.103.0.tar.gz</span><br><span class=\"line\">cd clamav-0.103.0</span><br><span class=\"line\">.&#x2F;configure --prefix&#x3D;&#x2F;usr&#x2F;local&#x2F;clamav-103  --sysconfdir&#x3D;&#x2F;etc</span><br><span class=\"line\"># 将clamav安装到 &#x2F;usr&#x2F;local&#x2F;clamav-0.103.0 将配置文件放到 &#x2F;etc 目录</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">...</span><br><span class=\"line\">config.status: executing libtool commands</span><br><span class=\"line\">configure: Summary of detected features follows</span><br><span class=\"line\">              OS          : linux-gnu</span><br><span class=\"line\">              pthreads    : yes (-lpthread)</span><br><span class=\"line\">configure: Summary of miscellaneous features</span><br><span class=\"line\">              check       : no (auto)</span><br><span class=\"line\">              fanotify    : yes</span><br><span class=\"line\">              fdpassing   : 1</span><br><span class=\"line\">              IPv6        : yes</span><br><span class=\"line\">              openssl     : &#x2F;usr</span><br><span class=\"line\">              libcurl     : &#x2F;usr</span><br><span class=\"line\">configure: Summary of optional tools</span><br><span class=\"line\">              clamdtop    : no (missing ncurses &#x2F; pdcurses) (disabled)</span><br><span class=\"line\">              milter      : no (missing libmilter) (disabled)</span><br><span class=\"line\">              clamsubmit  : no (missing libjson-c-dev. Use the website to submit FPs&#x2F;FNs.) (disabled)</span><br><span class=\"line\">              clamonacc   : yes (auto)</span><br><span class=\"line\">configure: Summary of engine performance features</span><br><span class=\"line\">              release mode: yes</span><br><span class=\"line\">              llvm        : no (disabled)</span><br><span class=\"line\">              mempool     : yes</span><br><span class=\"line\">configure: Summary of engine detection features</span><br><span class=\"line\">              iconv       : yes</span><br><span class=\"line\">              bzip2       : ok</span><br><span class=\"line\">              zlib        : yes (from system)</span><br><span class=\"line\">              unrar       : yes</span><br><span class=\"line\">              preclass    : no (missing libjson-c-dev) (disabled)</span><br><span class=\"line\">              pcre        : &#x2F;usr</span><br><span class=\"line\">              libmspack   : yes (Internal)</span><br><span class=\"line\">              libxml2     : no</span><br><span class=\"line\">              yara        : yes</span><br><span class=\"line\">              fts         : yes (internal, libc&#39;s is not LFS compatible)</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h4 id=\"4、安装\"><a href=\"#4、安装\" class=\"headerlink\" title=\"4、安装\"></a>4、安装</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">make -j4 &amp;&amp; make check &amp;&amp; make install</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"配置clamav\"><a href=\"#配置clamav\" class=\"headerlink\" title=\"配置clamav\"></a>配置clamav</h3><h4 id=\"创建软连接\"><a href=\"#创建软连接\" class=\"headerlink\" title=\"创建软连接\"></a>创建软连接</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ln -s &#x2F;usr&#x2F;local&#x2F;clamav-103&#x2F;bin&#x2F;* &#x2F;usr&#x2F;local&#x2F;bin&#x2F;</span><br><span class=\"line\">ln -s &#x2F;usr&#x2F;local&#x2F;clamav-103&#x2F;sbin&#x2F;* &#x2F;usr&#x2F;local&#x2F;sbin&#x2F;</span><br></pre></td></tr></table></figure>\n<h4 id=\"创建相关文件\"><a href=\"#创建相关文件\" class=\"headerlink\" title=\"创建相关文件\"></a>创建相关文件</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd &#x2F;usr&#x2F;local&#x2F;clamav-103</span><br><span class=\"line\">mkdir logs updata</span><br><span class=\"line\">mkdir &#x2F;var&#x2F;lib&#x2F;clamav</span><br><span class=\"line\">cd logs</span><br><span class=\"line\">touch clamd.log freshclam.log</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"修改配置文件\"><a href=\"#修改配置文件\" class=\"headerlink\" title=\"修改配置文件\"></a>修改配置文件</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd &#x2F;etc</span><br><span class=\"line\">cp clamd.conf.sample clamd.conf</span><br><span class=\"line\">cp freshclam.conf.sample freshclam.conf</span><br><span class=\"line\"></span><br><span class=\"line\">cat &gt;&gt; clamd.conf &lt;&lt;-eof</span><br><span class=\"line\">LocalSocket &#x2F;var&#x2F;lib&#x2F;clamav&#x2F;clamd.socket</span><br><span class=\"line\">PidFile &#x2F;var&#x2F;lib&#x2F;clamav&#x2F;clamd.pid</span><br><span class=\"line\">DatabaseDirectory &#x2F;usr&#x2F;local&#x2F;clamav-103&#x2F;updata</span><br><span class=\"line\">LogFile &#x2F;usr&#x2F;local&#x2F;clamav-103&#x2F;logs&#x2F;clamd.log</span><br><span class=\"line\">eof</span><br><span class=\"line\"></span><br><span class=\"line\">cat &gt;&gt; freshclam.conf &lt;&lt;-eof</span><br><span class=\"line\">DatabaseDirectory &#x2F;usr&#x2F;local&#x2F;clamav-103&#x2F;updata</span><br><span class=\"line\">UpdateLogFile &#x2F;usr&#x2F;local&#x2F;clamav-103&#x2F;logs&#x2F;freshclam.log</span><br><span class=\"line\">PidFile &#x2F;var&#x2F;lib&#x2F;clamav&#x2F;freshclam.pid</span><br><span class=\"line\">eof</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>将 Example 进行注释</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd &#x2F;etc</span><br><span class=\"line\">sed -i &#39;s&#x2F;Example&#x2F;#Example&#x2F;g&#39; clamd.conf freshclam.conf</span><br><span class=\"line\">grep -n &quot;#Example&quot; clamd.conf freshclam.conf</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"创建clamav用户并授权\"><a href=\"#创建clamav用户并授权\" class=\"headerlink\" title=\"创建clamav用户并授权\"></a>创建clamav用户并授权</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">useradd -M -s &#x2F;sbin&#x2F;nologin clamav</span><br><span class=\"line\">chown -R clamav:clamav &#x2F;usr&#x2F;local&#x2F;clamav-103</span><br><span class=\"line\">chown -R clamav:clamav &#x2F;var&#x2F;lib&#x2F;clamav</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"启动clamd\"><a href=\"#启动clamd\" class=\"headerlink\" title=\"启动clamd\"></a>启动clamd</h3><h5 id=\"更新病毒库\"><a href=\"#更新病毒库\" class=\"headerlink\" title=\"更新病毒库\"></a>更新病毒库</h5><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">freshclam   #如果下载慢,使用 错误二中的地址手动下载放入到病毒库目录中</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">clamd start   # 如果报错，提示 &#39;LibClamAV Error: cl_load(): No such file or directory:&#39; 参数错误二</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"使用clamav\"><a href=\"#使用clamav\" class=\"headerlink\" title=\"使用clamav\"></a>使用clamav</h3><p>参数说明</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">-r    递归扫描子文件</span><br><span class=\"line\">–i    只显示被感染的文件</span><br><span class=\"line\">-l    指定日志文件</span><br><span class=\"line\">--remove    删除被感染文件</span><br><span class=\"line\">--move    隔离被感染文件</span><br></pre></td></tr></table></figure>\n\n<p>使用示例</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">clamscan –ri &#x2F; -l clamscan.log  --remove   #这里递归扫描根目录 &#x2F; ，发现感染文件立即删除</span><br></pre></td></tr></table></figure>\n\n\n<table>\n<thead>\n<tr>\n<th>选项</th>\n<th>适用的文件类型</th>\n<th>执行命令示例</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>-r</td>\n<td>所有文件</td>\n<td>clamscan -r</td>\n</tr>\n<tr>\n<td>–unrar</td>\n<td>.rar 文件</td>\n<td>clamscan –unrar</td>\n</tr>\n<tr>\n<td>–arj</td>\n<td>.arj 文件</td>\n<td>clamscan –arj</td>\n</tr>\n<tr>\n<td>–unzoo</td>\n<td>.zoo 文件</td>\n<td>clamscan –unzoo</td>\n</tr>\n<tr>\n<td>–lha</td>\n<td>.lzh 文件</td>\n<td>clamscan –lha</td>\n</tr>\n<tr>\n<td>–jar</td>\n<td>.jar 文件</td>\n<td>clamscan –jar</td>\n</tr>\n<tr>\n<td>–deb</td>\n<td>.deb 安装包</td>\n<td>clamscan –deb</td>\n</tr>\n<tr>\n<td>–tar</td>\n<td>.tar 文件</td>\n<td>clamscan –tar</td>\n</tr>\n<tr>\n<td>–tgz</td>\n<td>.tar.gz</td>\n<td>clamscan –tgz</td>\n</tr>\n<tr>\n<td>–log=FILE/-l FILE</td>\n<td>增加扫描日志</td>\n<td>clamscan -l /var/log/clamscan.log</td>\n</tr>\n<tr>\n<td>–move=directory</td>\n<td>把病毒文件移动到目录directory下</td>\n<td>clamscan –move /tmp</td>\n</tr>\n<tr>\n<td>–copy=directory</td>\n<td>把病毒文件复制到目录directory下</td>\n<td>clamscan –copy /tmp</td>\n</tr>\n<tr>\n<td>–remove</td>\n<td>删除病毒文件</td>\n<td>clamscan –move /abc</td>\n</tr>\n<tr>\n<td>–quiet</td>\n<td>输出错误消息</td>\n<td>clamscan –quiet</td>\n</tr>\n<tr>\n<td>–infected/-i</td>\n<td>输出感染文件</td>\n<td>clamscan -i</td>\n</tr>\n<tr>\n<td>–suppress-ok-results/-o</td>\n<td>跳过扫描OK的文件</td>\n<td>clamscan -o</td>\n</tr>\n<tr>\n<td>–no-summary</td>\n<td>不显示统计信息</td>\n<td></td>\n</tr>\n<tr>\n<td>–bell</td>\n<td>扫描到病毒文件发出警报声音</td>\n<td></td>\n</tr>\n</tbody></table>\n<h3 id=\"报错处理\"><a href=\"#报错处理\" class=\"headerlink\" title=\"报错处理\"></a>报错处理</h3><p>错误一</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">...</span><br><span class=\"line\">checking for ncurses&#x2F;ncurses.h... no</span><br><span class=\"line\">configure: unable to compile&#x2F;link with ncurses</span><br><span class=\"line\">checking ncurses.h usability... no</span><br><span class=\"line\">checking ncurses.h presence... no</span><br><span class=\"line\">checking for ncurses.h... no</span><br><span class=\"line\">configure: unable to compile&#x2F;link with ncurses</span><br><span class=\"line\">checking curses.h usability... no</span><br><span class=\"line\">checking curses.h presence... no</span><br><span class=\"line\">checking for curses.h... no</span><br><span class=\"line\">configure: unable to compile&#x2F;link with pdcurses</span><br><span class=\"line\">configure: WARNING: ****** not building clamdtop: ncurses not found</span><br><span class=\"line\">checking for llvm-config... no</span><br><span class=\"line\">checking LFS safe fts implementation... no</span><br><span class=\"line\">checking for libcurl installation... configure: error: libcurl not found. libcurl (e.g. libcurl-devel) is required in order to build freshclam and clamsubmit.</span><br></pre></td></tr></table></figure>\n<p>处理</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install libcurl-devel -y</span><br></pre></td></tr></table></figure>\n\n<p>错误二</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> clamd start</span><br><span class=\"line\">LibClamAV Error: cli_loaddbdir(): No supported database files found in &#x2F;usr&#x2F;local&#x2F;clamav-103&#x2F;updata</span><br><span class=\"line\">ERROR: Can&#39;t open file or directory</span><br></pre></td></tr></table></figure>\n<p>处理</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">原因分析</span><br><span class=\"line\">原因：没有病毒库！</span><br><span class=\"line\">yum安装的ClamAv，病毒库默认路径是:</span><br><span class=\"line\">&#x2F;var&#x2F;lib&#x2F;clamav</span><br><span class=\"line\"></span><br><span class=\"line\">源码安装时，默认的病毒库路径是：</span><br><span class=\"line\">&#x2F;usr&#x2F;local&#x2F;share&#x2F;clamav</span><br><span class=\"line\"></span><br><span class=\"line\">而我在&#x2F;etc&#x2F;clamav.conf 中配的是 &#x2F;usr&#x2F;local&#x2F;clamav-103&#x2F;updata</span><br><span class=\"line\">下载病毒库时，由于使用&quot;freshclam&quot;命令下载太慢，换成了wget的方式手动下载病毒库，如下:</span><br><span class=\"line\">cd &#x2F;usr&#x2F;local&#x2F;clamav-103&#x2F;updata</span><br><span class=\"line\">wget http:&#x2F;&#x2F;database.clamav.net&#x2F;main.cvd</span><br><span class=\"line\">wget http:&#x2F;&#x2F;database.clamav.net&#x2F;daily.cvd</span><br><span class=\"line\">wget http:&#x2F;&#x2F;database.clamav.net&#x2F;bytecode.cvd</span><br></pre></td></tr></table></figure>"},{"title":"CentOS7关闭透明大页面","date":"2021-07-29T07:42:00.000Z","_content":"\t\n\t\n摘要: desc\n<!-- more -->\n\n## 开机自动关闭服务化\n\n这里提供另一个将脚本注入到启动服务的方法，新建一个服务配置：\n```\nvi /etc/systemd/system/disable-thp.service\n```\n\n```\n[Unit]\nDescription=Disable Transparent Huge Pages (THP)\n\n[Service]\nType=simple\nExecStart=/bin/sh -c \"echo 'never' > /sys/kernel/mm/transparent_hugepage/enabled && echo 'never' > /sys/kernel/mm/transparent_hugepage/defrag\"\n\n[Install]\nWantedBy=multi-user.target\n```\n\nreload，配置开机自启动：\n```\nsystemctl daemon-reload\nsystemctl start disable-thp\nsystemctl enable disable-thp\n```\n重启后进行验证：\n```\ncat /sys/kernel/mm/transparent_hugepage/enabled\ncat /sys/kernel/mm/transparent_hugepage/defrag\n```","source":"_posts/install/centos7关闭透明大页面.md","raw":"---\ntitle: CentOS7关闭透明大页面\ndate: 2021-07-29 15:42\ncategories:\n- linux\ntags:\n- linux\n---\n\t\n\t\n摘要: desc\n<!-- more -->\n\n## 开机自动关闭服务化\n\n这里提供另一个将脚本注入到启动服务的方法，新建一个服务配置：\n```\nvi /etc/systemd/system/disable-thp.service\n```\n\n```\n[Unit]\nDescription=Disable Transparent Huge Pages (THP)\n\n[Service]\nType=simple\nExecStart=/bin/sh -c \"echo 'never' > /sys/kernel/mm/transparent_hugepage/enabled && echo 'never' > /sys/kernel/mm/transparent_hugepage/defrag\"\n\n[Install]\nWantedBy=multi-user.target\n```\n\nreload，配置开机自启动：\n```\nsystemctl daemon-reload\nsystemctl start disable-thp\nsystemctl enable disable-thp\n```\n重启后进行验证：\n```\ncat /sys/kernel/mm/transparent_hugepage/enabled\ncat /sys/kernel/mm/transparent_hugepage/defrag\n```","slug":"install/centos7关闭透明大页面","published":1,"updated":"2021-07-29T07:43:27.645Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cku6979z7003100uh2h4ddxb6","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><p>摘要: desc</p>\n<span id=\"more\"></span>\n\n<h2 id=\"开机自动关闭服务化\"><a href=\"#开机自动关闭服务化\" class=\"headerlink\" title=\"开机自动关闭服务化\"></a>开机自动关闭服务化</h2><p>这里提供另一个将脚本注入到启动服务的方法，新建一个服务配置：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vi &#x2F;etc&#x2F;systemd&#x2F;system&#x2F;disable-thp.service</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[Unit]</span><br><span class=\"line\">Description&#x3D;Disable Transparent Huge Pages (THP)</span><br><span class=\"line\"></span><br><span class=\"line\">[Service]</span><br><span class=\"line\">Type&#x3D;simple</span><br><span class=\"line\">ExecStart&#x3D;&#x2F;bin&#x2F;sh -c &quot;echo &#39;never&#39; &gt; &#x2F;sys&#x2F;kernel&#x2F;mm&#x2F;transparent_hugepage&#x2F;enabled &amp;&amp; echo &#39;never&#39; &gt; &#x2F;sys&#x2F;kernel&#x2F;mm&#x2F;transparent_hugepage&#x2F;defrag&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">[Install]</span><br><span class=\"line\">WantedBy&#x3D;multi-user.target</span><br></pre></td></tr></table></figure>\n\n<p>reload，配置开机自启动：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl daemon-reload</span><br><span class=\"line\">systemctl start disable-thp</span><br><span class=\"line\">systemctl enable disable-thp</span><br></pre></td></tr></table></figure>\n<p>重启后进行验证：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cat &#x2F;sys&#x2F;kernel&#x2F;mm&#x2F;transparent_hugepage&#x2F;enabled</span><br><span class=\"line\">cat &#x2F;sys&#x2F;kernel&#x2F;mm&#x2F;transparent_hugepage&#x2F;defrag</span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"<p>摘要: desc</p>","more":"<h2 id=\"开机自动关闭服务化\"><a href=\"#开机自动关闭服务化\" class=\"headerlink\" title=\"开机自动关闭服务化\"></a>开机自动关闭服务化</h2><p>这里提供另一个将脚本注入到启动服务的方法，新建一个服务配置：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vi &#x2F;etc&#x2F;systemd&#x2F;system&#x2F;disable-thp.service</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[Unit]</span><br><span class=\"line\">Description&#x3D;Disable Transparent Huge Pages (THP)</span><br><span class=\"line\"></span><br><span class=\"line\">[Service]</span><br><span class=\"line\">Type&#x3D;simple</span><br><span class=\"line\">ExecStart&#x3D;&#x2F;bin&#x2F;sh -c &quot;echo &#39;never&#39; &gt; &#x2F;sys&#x2F;kernel&#x2F;mm&#x2F;transparent_hugepage&#x2F;enabled &amp;&amp; echo &#39;never&#39; &gt; &#x2F;sys&#x2F;kernel&#x2F;mm&#x2F;transparent_hugepage&#x2F;defrag&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">[Install]</span><br><span class=\"line\">WantedBy&#x3D;multi-user.target</span><br></pre></td></tr></table></figure>\n\n<p>reload，配置开机自启动：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl daemon-reload</span><br><span class=\"line\">systemctl start disable-thp</span><br><span class=\"line\">systemctl enable disable-thp</span><br></pre></td></tr></table></figure>\n<p>重启后进行验证：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cat &#x2F;sys&#x2F;kernel&#x2F;mm&#x2F;transparent_hugepage&#x2F;enabled</span><br><span class=\"line\">cat &#x2F;sys&#x2F;kernel&#x2F;mm&#x2F;transparent_hugepage&#x2F;defrag</span><br></pre></td></tr></table></figure>"},{"title":"centos7升级confluence","date":"2021-03-20T08:47:00.000Z","_content":"  \n  \n摘要: cenfluence6.12 升级cenfluence7.4.8\n<!-- more -->\n\n\n## 升级流程\n\n### 备份数据\n#### 官方备份\n```\n点击 一般设置 --> 备份与还原  --> 备份\n```\n#### 手动备份\n```\n1，备份数据源。默认路径为：/var/atlassian/application-data/confluence/confluence.cfg.xml\n\n2，备份附件。默认路径为：/var/atlassian/application-data/confluence/attachments\n```\n\n#### 备份破解文件\n```\nmv /opt/atlassian/confluence/confluence/WEB-INF/lib/atlassian-extras-decoder-v2-3.4.1.jar ~/atlassian-extras-2.4.jar\n```\n\n\n## 部署最新版本\n\n### 获取新的版本\n[官方下载地址](https://www.atlassian.com/software/confluence/download)\n\n### 执行\n将新版安装包放在 `/opt` 目录下\n```\nchmod +x atlassian-confluence-7.4.8-x64.bin\n./atlassian-confluence-7.4.8-x64.bin\n```\n\n```\n......\nStarting Installer ...\n\nThis will install Confluence 7.4.8 on your computer.\nOK [o, Enter], Cancel [c]\no        # 回车 或按 o\nClick Next to continue, or Cancel to exit Setup.\n\nChoose the appropriate installation or upgrade option.\nPlease choose one of the following:\nExpress Install (uses default settings) [1], \nCustom Install (recommended for advanced users) [2], \nUpgrade an existing Confluence installation [3, Enter]\n3       # 选择3 表示更新\nExisting installation directory:\n[/opt/atlassian/confluence]\n\n\nBack Up Confluence Home\nThe upgrade process will automatically back up your Confluence Installation\nDirectory. You can also choose to back up your existing Confluence Home\nDirectory. Both directories are backed up as zip archive files in their\nrespective parent directory locations.\n\nWe strongly recommend choosing this option in the unlikely event that you\nexperience problems with the upgrade and may require these backups to\nrestore your existing Confluence installation.\n\nIf you have many attachments in your Confluence Home Directory, the zip\narchive of this directory may consume a significant amount of disk space.\nBack up Confluence home ?\nYes [y, Enter], No [n]\ny     # 询问是否需要备份\n\nChecking for local modifications.\n\nList of modifications made within Confluence directories.\n\nThe following provides a list of file modifications within the confluence\ndirectory.\n\nModified files:\n\tconfluence/WEB-INF/lib/atlassian-extras-decoder-v2-3.4.1.jar\nRemoved files:\n\t(none)\nAdded files:\n\tconfluence/WEB-INF/classes/log4j-diagnostic.properties\n\tconfluence/WEB-INF/lib/mysql-connector-java-5.1.46-bin.jar\n\n[Enter]\n\n\nChecking if your instance of Confluence is running\n\nUpgrade Check List\nBack up your external database\nWe strongly recommend you back up your Confluence database if you have not\nalready done so.\n\nPlease refer to the following URL for back up guidelines:\nhttps://docs.atlassian.com/confluence/docs-74/Production+Backup+Strategy\n\nCheck plugin compatibility\nCheck that your non-bundled plugins are compatible with Confluence 7.4.8.\n\nAccess the plugin manager through the following URL:\nhttp://localhost:8090/plugins/servlet/upm#compatibility\n\nFor more information see our documentation at the following URL:\nhttps://docs.atlassian.com/confluence/docs-74/Installing+and+Configuring+Plugins+using+the+Universal+Plugin+Manager\n\n\nPlease ensure you have read the above checklist before upgrading.\nYour existing Confluence installation is about to be upgraded!\n\nThe upgrade process will shut down your existing Confluence installation to complete the upgrade.\n\nDo you want to proceed?\nUpgrade [u, Enter], Exit [e]\nu               #  展示改变的文件，询问是否升级\n\nYour instance of Confluence is currently being upgraded.\nShutting down Confluence...\nChecking if Confluence has been shutdown...\nBacking up the Confluence installation directory\n                                                                           \nBacking up the Confluence home directory\n                                                                           \nDeleting the previous Confluence installation directory...\n\nExtracting files ...\n                                                                           \n\nPlease wait a few moments while we configure Confluence.\n\nInstallation of Confluence 7.4.8 is complete\nStart Confluence now?\nYes [y, Enter], No [n]\ny          # 部署完成 ，是否启动\n\nPlease wait a few moments while Confluence starts up.\nLaunching Confluence ...\n\nInstallation of Confluence 7.4.8 is complete\nYour installation of Confluence 7.4.8 is now ready and can be accessed via\nyour browser.\nCustom modifications\nYour previous Confluence installation contains customisations that must be\nmanually transferred. Refer to our documentation more information:\nhttps://docs.atlassian.com/confluence/docs-74/Upgrading+Confluence#UpgradingConfluence-custommodifications\nConfluence 7.4.8 can be accessed at http://localhost:8090\n\nConfluence 7.4.8 may take several minutes to load on first start up.\nFinishing installation ...\n\n```\n\n\n### 访问\n```\nip:8090\n```\n\n## 界面报错处理\n报错一:  更新之后破解文件失效了, 将备份的破解文件替换回去\n```\nLicenseException:Failed to verify the license.\n```\n将备份的破解文件替换回去\n```\nmv ~/atlassian-extras-2.4.jar /opt/atlassian/confluence/confluence/WEB-INF/lib/atlassian-extras-decoder-v2-3.4.1.jar\n```\n重启服务\n\n报错二: \n```\nMySQL session isolation level 'REPEATABLE-READ' is no longer supported. Session isolation level must be 'READ-COMMITTED'. See http://confluence.atlassian.com/x/GAtmDg\n```\n修改 mysql 默认事务隔离级别\n需要修改/etc/my.cnf\n\n在[mysqld]下增加一行\n```\ntransaction-isolation=READ-COMMITTED\n```\n\n重启mysqld\n重启confluence\n\n\n## 升级完成\n\n\n\n","source":"_posts/install/centos7升级confluence.md","raw":"---\ntitle: centos7升级confluence\ndate: 2021-03-20 16:47\ncategories:\n- centos7\ntags:\n- confluence\n---\n  \n  \n摘要: cenfluence6.12 升级cenfluence7.4.8\n<!-- more -->\n\n\n## 升级流程\n\n### 备份数据\n#### 官方备份\n```\n点击 一般设置 --> 备份与还原  --> 备份\n```\n#### 手动备份\n```\n1，备份数据源。默认路径为：/var/atlassian/application-data/confluence/confluence.cfg.xml\n\n2，备份附件。默认路径为：/var/atlassian/application-data/confluence/attachments\n```\n\n#### 备份破解文件\n```\nmv /opt/atlassian/confluence/confluence/WEB-INF/lib/atlassian-extras-decoder-v2-3.4.1.jar ~/atlassian-extras-2.4.jar\n```\n\n\n## 部署最新版本\n\n### 获取新的版本\n[官方下载地址](https://www.atlassian.com/software/confluence/download)\n\n### 执行\n将新版安装包放在 `/opt` 目录下\n```\nchmod +x atlassian-confluence-7.4.8-x64.bin\n./atlassian-confluence-7.4.8-x64.bin\n```\n\n```\n......\nStarting Installer ...\n\nThis will install Confluence 7.4.8 on your computer.\nOK [o, Enter], Cancel [c]\no        # 回车 或按 o\nClick Next to continue, or Cancel to exit Setup.\n\nChoose the appropriate installation or upgrade option.\nPlease choose one of the following:\nExpress Install (uses default settings) [1], \nCustom Install (recommended for advanced users) [2], \nUpgrade an existing Confluence installation [3, Enter]\n3       # 选择3 表示更新\nExisting installation directory:\n[/opt/atlassian/confluence]\n\n\nBack Up Confluence Home\nThe upgrade process will automatically back up your Confluence Installation\nDirectory. You can also choose to back up your existing Confluence Home\nDirectory. Both directories are backed up as zip archive files in their\nrespective parent directory locations.\n\nWe strongly recommend choosing this option in the unlikely event that you\nexperience problems with the upgrade and may require these backups to\nrestore your existing Confluence installation.\n\nIf you have many attachments in your Confluence Home Directory, the zip\narchive of this directory may consume a significant amount of disk space.\nBack up Confluence home ?\nYes [y, Enter], No [n]\ny     # 询问是否需要备份\n\nChecking for local modifications.\n\nList of modifications made within Confluence directories.\n\nThe following provides a list of file modifications within the confluence\ndirectory.\n\nModified files:\n\tconfluence/WEB-INF/lib/atlassian-extras-decoder-v2-3.4.1.jar\nRemoved files:\n\t(none)\nAdded files:\n\tconfluence/WEB-INF/classes/log4j-diagnostic.properties\n\tconfluence/WEB-INF/lib/mysql-connector-java-5.1.46-bin.jar\n\n[Enter]\n\n\nChecking if your instance of Confluence is running\n\nUpgrade Check List\nBack up your external database\nWe strongly recommend you back up your Confluence database if you have not\nalready done so.\n\nPlease refer to the following URL for back up guidelines:\nhttps://docs.atlassian.com/confluence/docs-74/Production+Backup+Strategy\n\nCheck plugin compatibility\nCheck that your non-bundled plugins are compatible with Confluence 7.4.8.\n\nAccess the plugin manager through the following URL:\nhttp://localhost:8090/plugins/servlet/upm#compatibility\n\nFor more information see our documentation at the following URL:\nhttps://docs.atlassian.com/confluence/docs-74/Installing+and+Configuring+Plugins+using+the+Universal+Plugin+Manager\n\n\nPlease ensure you have read the above checklist before upgrading.\nYour existing Confluence installation is about to be upgraded!\n\nThe upgrade process will shut down your existing Confluence installation to complete the upgrade.\n\nDo you want to proceed?\nUpgrade [u, Enter], Exit [e]\nu               #  展示改变的文件，询问是否升级\n\nYour instance of Confluence is currently being upgraded.\nShutting down Confluence...\nChecking if Confluence has been shutdown...\nBacking up the Confluence installation directory\n                                                                           \nBacking up the Confluence home directory\n                                                                           \nDeleting the previous Confluence installation directory...\n\nExtracting files ...\n                                                                           \n\nPlease wait a few moments while we configure Confluence.\n\nInstallation of Confluence 7.4.8 is complete\nStart Confluence now?\nYes [y, Enter], No [n]\ny          # 部署完成 ，是否启动\n\nPlease wait a few moments while Confluence starts up.\nLaunching Confluence ...\n\nInstallation of Confluence 7.4.8 is complete\nYour installation of Confluence 7.4.8 is now ready and can be accessed via\nyour browser.\nCustom modifications\nYour previous Confluence installation contains customisations that must be\nmanually transferred. Refer to our documentation more information:\nhttps://docs.atlassian.com/confluence/docs-74/Upgrading+Confluence#UpgradingConfluence-custommodifications\nConfluence 7.4.8 can be accessed at http://localhost:8090\n\nConfluence 7.4.8 may take several minutes to load on first start up.\nFinishing installation ...\n\n```\n\n\n### 访问\n```\nip:8090\n```\n\n## 界面报错处理\n报错一:  更新之后破解文件失效了, 将备份的破解文件替换回去\n```\nLicenseException:Failed to verify the license.\n```\n将备份的破解文件替换回去\n```\nmv ~/atlassian-extras-2.4.jar /opt/atlassian/confluence/confluence/WEB-INF/lib/atlassian-extras-decoder-v2-3.4.1.jar\n```\n重启服务\n\n报错二: \n```\nMySQL session isolation level 'REPEATABLE-READ' is no longer supported. Session isolation level must be 'READ-COMMITTED'. See http://confluence.atlassian.com/x/GAtmDg\n```\n修改 mysql 默认事务隔离级别\n需要修改/etc/my.cnf\n\n在[mysqld]下增加一行\n```\ntransaction-isolation=READ-COMMITTED\n```\n\n重启mysqld\n重启confluence\n\n\n## 升级完成\n\n\n\n","slug":"install/centos7升级confluence","published":1,"updated":"2021-06-18T08:07:11.190Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cku6979z8003200uh8enre70d","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><p>摘要: cenfluence6.12 升级cenfluence7.4.8</p>\n<span id=\"more\"></span>\n\n\n<h2 id=\"升级流程\"><a href=\"#升级流程\" class=\"headerlink\" title=\"升级流程\"></a>升级流程</h2><h3 id=\"备份数据\"><a href=\"#备份数据\" class=\"headerlink\" title=\"备份数据\"></a>备份数据</h3><h4 id=\"官方备份\"><a href=\"#官方备份\" class=\"headerlink\" title=\"官方备份\"></a>官方备份</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">点击 一般设置 --&gt; 备份与还原  --&gt; 备份</span><br></pre></td></tr></table></figure>\n<h4 id=\"手动备份\"><a href=\"#手动备份\" class=\"headerlink\" title=\"手动备份\"></a>手动备份</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1，备份数据源。默认路径为：&#x2F;var&#x2F;atlassian&#x2F;application-data&#x2F;confluence&#x2F;confluence.cfg.xml</span><br><span class=\"line\"></span><br><span class=\"line\">2，备份附件。默认路径为：&#x2F;var&#x2F;atlassian&#x2F;application-data&#x2F;confluence&#x2F;attachments</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"备份破解文件\"><a href=\"#备份破解文件\" class=\"headerlink\" title=\"备份破解文件\"></a>备份破解文件</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mv &#x2F;opt&#x2F;atlassian&#x2F;confluence&#x2F;confluence&#x2F;WEB-INF&#x2F;lib&#x2F;atlassian-extras-decoder-v2-3.4.1.jar ~&#x2F;atlassian-extras-2.4.jar</span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"部署最新版本\"><a href=\"#部署最新版本\" class=\"headerlink\" title=\"部署最新版本\"></a>部署最新版本</h2><h3 id=\"获取新的版本\"><a href=\"#获取新的版本\" class=\"headerlink\" title=\"获取新的版本\"></a>获取新的版本</h3><p><a href=\"https://www.atlassian.com/software/confluence/download\">官方下载地址</a></p>\n<h3 id=\"执行\"><a href=\"#执行\" class=\"headerlink\" title=\"执行\"></a>执行</h3><p>将新版安装包放在 <code>/opt</code> 目录下</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">chmod +x atlassian-confluence-7.4.8-x64.bin</span><br><span class=\"line\">.&#x2F;atlassian-confluence-7.4.8-x64.bin</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">......</span><br><span class=\"line\">Starting Installer ...</span><br><span class=\"line\"></span><br><span class=\"line\">This will install Confluence 7.4.8 on your computer.</span><br><span class=\"line\">OK [o, Enter], Cancel [c]</span><br><span class=\"line\">o        # 回车 或按 o</span><br><span class=\"line\">Click Next to continue, or Cancel to exit Setup.</span><br><span class=\"line\"></span><br><span class=\"line\">Choose the appropriate installation or upgrade option.</span><br><span class=\"line\">Please choose one of the following:</span><br><span class=\"line\">Express Install (uses default settings) [1], </span><br><span class=\"line\">Custom Install (recommended for advanced users) [2], </span><br><span class=\"line\">Upgrade an existing Confluence installation [3, Enter]</span><br><span class=\"line\">3       # 选择3 表示更新</span><br><span class=\"line\">Existing installation directory:</span><br><span class=\"line\">[&#x2F;opt&#x2F;atlassian&#x2F;confluence]</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">Back Up Confluence Home</span><br><span class=\"line\">The upgrade process will automatically back up your Confluence Installation</span><br><span class=\"line\">Directory. You can also choose to back up your existing Confluence Home</span><br><span class=\"line\">Directory. Both directories are backed up as zip archive files in their</span><br><span class=\"line\">respective parent directory locations.</span><br><span class=\"line\"></span><br><span class=\"line\">We strongly recommend choosing this option in the unlikely event that you</span><br><span class=\"line\">experience problems with the upgrade and may require these backups to</span><br><span class=\"line\">restore your existing Confluence installation.</span><br><span class=\"line\"></span><br><span class=\"line\">If you have many attachments in your Confluence Home Directory, the zip</span><br><span class=\"line\">archive of this directory may consume a significant amount of disk space.</span><br><span class=\"line\">Back up Confluence home ?</span><br><span class=\"line\">Yes [y, Enter], No [n]</span><br><span class=\"line\">y     # 询问是否需要备份</span><br><span class=\"line\"></span><br><span class=\"line\">Checking for local modifications.</span><br><span class=\"line\"></span><br><span class=\"line\">List of modifications made within Confluence directories.</span><br><span class=\"line\"></span><br><span class=\"line\">The following provides a list of file modifications within the confluence</span><br><span class=\"line\">directory.</span><br><span class=\"line\"></span><br><span class=\"line\">Modified files:</span><br><span class=\"line\">\tconfluence&#x2F;WEB-INF&#x2F;lib&#x2F;atlassian-extras-decoder-v2-3.4.1.jar</span><br><span class=\"line\">Removed files:</span><br><span class=\"line\">\t(none)</span><br><span class=\"line\">Added files:</span><br><span class=\"line\">\tconfluence&#x2F;WEB-INF&#x2F;classes&#x2F;log4j-diagnostic.properties</span><br><span class=\"line\">\tconfluence&#x2F;WEB-INF&#x2F;lib&#x2F;mysql-connector-java-5.1.46-bin.jar</span><br><span class=\"line\"></span><br><span class=\"line\">[Enter]</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">Checking if your instance of Confluence is running</span><br><span class=\"line\"></span><br><span class=\"line\">Upgrade Check List</span><br><span class=\"line\">Back up your external database</span><br><span class=\"line\">We strongly recommend you back up your Confluence database if you have not</span><br><span class=\"line\">already done so.</span><br><span class=\"line\"></span><br><span class=\"line\">Please refer to the following URL for back up guidelines:</span><br><span class=\"line\">https:&#x2F;&#x2F;docs.atlassian.com&#x2F;confluence&#x2F;docs-74&#x2F;Production+Backup+Strategy</span><br><span class=\"line\"></span><br><span class=\"line\">Check plugin compatibility</span><br><span class=\"line\">Check that your non-bundled plugins are compatible with Confluence 7.4.8.</span><br><span class=\"line\"></span><br><span class=\"line\">Access the plugin manager through the following URL:</span><br><span class=\"line\">http:&#x2F;&#x2F;localhost:8090&#x2F;plugins&#x2F;servlet&#x2F;upm#compatibility</span><br><span class=\"line\"></span><br><span class=\"line\">For more information see our documentation at the following URL:</span><br><span class=\"line\">https:&#x2F;&#x2F;docs.atlassian.com&#x2F;confluence&#x2F;docs-74&#x2F;Installing+and+Configuring+Plugins+using+the+Universal+Plugin+Manager</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">Please ensure you have read the above checklist before upgrading.</span><br><span class=\"line\">Your existing Confluence installation is about to be upgraded!</span><br><span class=\"line\"></span><br><span class=\"line\">The upgrade process will shut down your existing Confluence installation to complete the upgrade.</span><br><span class=\"line\"></span><br><span class=\"line\">Do you want to proceed?</span><br><span class=\"line\">Upgrade [u, Enter], Exit [e]</span><br><span class=\"line\">u               #  展示改变的文件，询问是否升级</span><br><span class=\"line\"></span><br><span class=\"line\">Your instance of Confluence is currently being upgraded.</span><br><span class=\"line\">Shutting down Confluence...</span><br><span class=\"line\">Checking if Confluence has been shutdown...</span><br><span class=\"line\">Backing up the Confluence installation directory</span><br><span class=\"line\">                                                                           </span><br><span class=\"line\">Backing up the Confluence home directory</span><br><span class=\"line\">                                                                           </span><br><span class=\"line\">Deleting the previous Confluence installation directory...</span><br><span class=\"line\"></span><br><span class=\"line\">Extracting files ...</span><br><span class=\"line\">                                                                           </span><br><span class=\"line\"></span><br><span class=\"line\">Please wait a few moments while we configure Confluence.</span><br><span class=\"line\"></span><br><span class=\"line\">Installation of Confluence 7.4.8 is complete</span><br><span class=\"line\">Start Confluence now?</span><br><span class=\"line\">Yes [y, Enter], No [n]</span><br><span class=\"line\">y          # 部署完成 ，是否启动</span><br><span class=\"line\"></span><br><span class=\"line\">Please wait a few moments while Confluence starts up.</span><br><span class=\"line\">Launching Confluence ...</span><br><span class=\"line\"></span><br><span class=\"line\">Installation of Confluence 7.4.8 is complete</span><br><span class=\"line\">Your installation of Confluence 7.4.8 is now ready and can be accessed via</span><br><span class=\"line\">your browser.</span><br><span class=\"line\">Custom modifications</span><br><span class=\"line\">Your previous Confluence installation contains customisations that must be</span><br><span class=\"line\">manually transferred. Refer to our documentation more information:</span><br><span class=\"line\">https:&#x2F;&#x2F;docs.atlassian.com&#x2F;confluence&#x2F;docs-74&#x2F;Upgrading+Confluence#UpgradingConfluence-custommodifications</span><br><span class=\"line\">Confluence 7.4.8 can be accessed at http:&#x2F;&#x2F;localhost:8090</span><br><span class=\"line\"></span><br><span class=\"line\">Confluence 7.4.8 may take several minutes to load on first start up.</span><br><span class=\"line\">Finishing installation ...</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n<h3 id=\"访问\"><a href=\"#访问\" class=\"headerlink\" title=\"访问\"></a>访问</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ip:8090</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"界面报错处理\"><a href=\"#界面报错处理\" class=\"headerlink\" title=\"界面报错处理\"></a>界面报错处理</h2><p>报错一:  更新之后破解文件失效了, 将备份的破解文件替换回去</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">LicenseException:Failed to verify the license.</span><br></pre></td></tr></table></figure>\n<p>将备份的破解文件替换回去</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mv ~&#x2F;atlassian-extras-2.4.jar &#x2F;opt&#x2F;atlassian&#x2F;confluence&#x2F;confluence&#x2F;WEB-INF&#x2F;lib&#x2F;atlassian-extras-decoder-v2-3.4.1.jar</span><br></pre></td></tr></table></figure>\n<p>重启服务</p>\n<p>报错二: </p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">MySQL session isolation level &#39;REPEATABLE-READ&#39; is no longer supported. Session isolation level must be &#39;READ-COMMITTED&#39;. See http:&#x2F;&#x2F;confluence.atlassian.com&#x2F;x&#x2F;GAtmDg</span><br></pre></td></tr></table></figure>\n<p>修改 mysql 默认事务隔离级别<br>需要修改/etc/my.cnf</p>\n<p>在[mysqld]下增加一行</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">transaction-isolation&#x3D;READ-COMMITTED</span><br></pre></td></tr></table></figure>\n\n<p>重启mysqld<br>重启confluence</p>\n<h2 id=\"升级完成\"><a href=\"#升级完成\" class=\"headerlink\" title=\"升级完成\"></a>升级完成</h2>","site":{"data":{}},"excerpt":"<p>摘要: cenfluence6.12 升级cenfluence7.4.8</p>","more":"<h2 id=\"升级流程\"><a href=\"#升级流程\" class=\"headerlink\" title=\"升级流程\"></a>升级流程</h2><h3 id=\"备份数据\"><a href=\"#备份数据\" class=\"headerlink\" title=\"备份数据\"></a>备份数据</h3><h4 id=\"官方备份\"><a href=\"#官方备份\" class=\"headerlink\" title=\"官方备份\"></a>官方备份</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">点击 一般设置 --&gt; 备份与还原  --&gt; 备份</span><br></pre></td></tr></table></figure>\n<h4 id=\"手动备份\"><a href=\"#手动备份\" class=\"headerlink\" title=\"手动备份\"></a>手动备份</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1，备份数据源。默认路径为：&#x2F;var&#x2F;atlassian&#x2F;application-data&#x2F;confluence&#x2F;confluence.cfg.xml</span><br><span class=\"line\"></span><br><span class=\"line\">2，备份附件。默认路径为：&#x2F;var&#x2F;atlassian&#x2F;application-data&#x2F;confluence&#x2F;attachments</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"备份破解文件\"><a href=\"#备份破解文件\" class=\"headerlink\" title=\"备份破解文件\"></a>备份破解文件</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mv &#x2F;opt&#x2F;atlassian&#x2F;confluence&#x2F;confluence&#x2F;WEB-INF&#x2F;lib&#x2F;atlassian-extras-decoder-v2-3.4.1.jar ~&#x2F;atlassian-extras-2.4.jar</span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"部署最新版本\"><a href=\"#部署最新版本\" class=\"headerlink\" title=\"部署最新版本\"></a>部署最新版本</h2><h3 id=\"获取新的版本\"><a href=\"#获取新的版本\" class=\"headerlink\" title=\"获取新的版本\"></a>获取新的版本</h3><p><a href=\"https://www.atlassian.com/software/confluence/download\">官方下载地址</a></p>\n<h3 id=\"执行\"><a href=\"#执行\" class=\"headerlink\" title=\"执行\"></a>执行</h3><p>将新版安装包放在 <code>/opt</code> 目录下</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">chmod +x atlassian-confluence-7.4.8-x64.bin</span><br><span class=\"line\">.&#x2F;atlassian-confluence-7.4.8-x64.bin</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">......</span><br><span class=\"line\">Starting Installer ...</span><br><span class=\"line\"></span><br><span class=\"line\">This will install Confluence 7.4.8 on your computer.</span><br><span class=\"line\">OK [o, Enter], Cancel [c]</span><br><span class=\"line\">o        # 回车 或按 o</span><br><span class=\"line\">Click Next to continue, or Cancel to exit Setup.</span><br><span class=\"line\"></span><br><span class=\"line\">Choose the appropriate installation or upgrade option.</span><br><span class=\"line\">Please choose one of the following:</span><br><span class=\"line\">Express Install (uses default settings) [1], </span><br><span class=\"line\">Custom Install (recommended for advanced users) [2], </span><br><span class=\"line\">Upgrade an existing Confluence installation [3, Enter]</span><br><span class=\"line\">3       # 选择3 表示更新</span><br><span class=\"line\">Existing installation directory:</span><br><span class=\"line\">[&#x2F;opt&#x2F;atlassian&#x2F;confluence]</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">Back Up Confluence Home</span><br><span class=\"line\">The upgrade process will automatically back up your Confluence Installation</span><br><span class=\"line\">Directory. You can also choose to back up your existing Confluence Home</span><br><span class=\"line\">Directory. Both directories are backed up as zip archive files in their</span><br><span class=\"line\">respective parent directory locations.</span><br><span class=\"line\"></span><br><span class=\"line\">We strongly recommend choosing this option in the unlikely event that you</span><br><span class=\"line\">experience problems with the upgrade and may require these backups to</span><br><span class=\"line\">restore your existing Confluence installation.</span><br><span class=\"line\"></span><br><span class=\"line\">If you have many attachments in your Confluence Home Directory, the zip</span><br><span class=\"line\">archive of this directory may consume a significant amount of disk space.</span><br><span class=\"line\">Back up Confluence home ?</span><br><span class=\"line\">Yes [y, Enter], No [n]</span><br><span class=\"line\">y     # 询问是否需要备份</span><br><span class=\"line\"></span><br><span class=\"line\">Checking for local modifications.</span><br><span class=\"line\"></span><br><span class=\"line\">List of modifications made within Confluence directories.</span><br><span class=\"line\"></span><br><span class=\"line\">The following provides a list of file modifications within the confluence</span><br><span class=\"line\">directory.</span><br><span class=\"line\"></span><br><span class=\"line\">Modified files:</span><br><span class=\"line\">\tconfluence&#x2F;WEB-INF&#x2F;lib&#x2F;atlassian-extras-decoder-v2-3.4.1.jar</span><br><span class=\"line\">Removed files:</span><br><span class=\"line\">\t(none)</span><br><span class=\"line\">Added files:</span><br><span class=\"line\">\tconfluence&#x2F;WEB-INF&#x2F;classes&#x2F;log4j-diagnostic.properties</span><br><span class=\"line\">\tconfluence&#x2F;WEB-INF&#x2F;lib&#x2F;mysql-connector-java-5.1.46-bin.jar</span><br><span class=\"line\"></span><br><span class=\"line\">[Enter]</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">Checking if your instance of Confluence is running</span><br><span class=\"line\"></span><br><span class=\"line\">Upgrade Check List</span><br><span class=\"line\">Back up your external database</span><br><span class=\"line\">We strongly recommend you back up your Confluence database if you have not</span><br><span class=\"line\">already done so.</span><br><span class=\"line\"></span><br><span class=\"line\">Please refer to the following URL for back up guidelines:</span><br><span class=\"line\">https:&#x2F;&#x2F;docs.atlassian.com&#x2F;confluence&#x2F;docs-74&#x2F;Production+Backup+Strategy</span><br><span class=\"line\"></span><br><span class=\"line\">Check plugin compatibility</span><br><span class=\"line\">Check that your non-bundled plugins are compatible with Confluence 7.4.8.</span><br><span class=\"line\"></span><br><span class=\"line\">Access the plugin manager through the following URL:</span><br><span class=\"line\">http:&#x2F;&#x2F;localhost:8090&#x2F;plugins&#x2F;servlet&#x2F;upm#compatibility</span><br><span class=\"line\"></span><br><span class=\"line\">For more information see our documentation at the following URL:</span><br><span class=\"line\">https:&#x2F;&#x2F;docs.atlassian.com&#x2F;confluence&#x2F;docs-74&#x2F;Installing+and+Configuring+Plugins+using+the+Universal+Plugin+Manager</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">Please ensure you have read the above checklist before upgrading.</span><br><span class=\"line\">Your existing Confluence installation is about to be upgraded!</span><br><span class=\"line\"></span><br><span class=\"line\">The upgrade process will shut down your existing Confluence installation to complete the upgrade.</span><br><span class=\"line\"></span><br><span class=\"line\">Do you want to proceed?</span><br><span class=\"line\">Upgrade [u, Enter], Exit [e]</span><br><span class=\"line\">u               #  展示改变的文件，询问是否升级</span><br><span class=\"line\"></span><br><span class=\"line\">Your instance of Confluence is currently being upgraded.</span><br><span class=\"line\">Shutting down Confluence...</span><br><span class=\"line\">Checking if Confluence has been shutdown...</span><br><span class=\"line\">Backing up the Confluence installation directory</span><br><span class=\"line\">                                                                           </span><br><span class=\"line\">Backing up the Confluence home directory</span><br><span class=\"line\">                                                                           </span><br><span class=\"line\">Deleting the previous Confluence installation directory...</span><br><span class=\"line\"></span><br><span class=\"line\">Extracting files ...</span><br><span class=\"line\">                                                                           </span><br><span class=\"line\"></span><br><span class=\"line\">Please wait a few moments while we configure Confluence.</span><br><span class=\"line\"></span><br><span class=\"line\">Installation of Confluence 7.4.8 is complete</span><br><span class=\"line\">Start Confluence now?</span><br><span class=\"line\">Yes [y, Enter], No [n]</span><br><span class=\"line\">y          # 部署完成 ，是否启动</span><br><span class=\"line\"></span><br><span class=\"line\">Please wait a few moments while Confluence starts up.</span><br><span class=\"line\">Launching Confluence ...</span><br><span class=\"line\"></span><br><span class=\"line\">Installation of Confluence 7.4.8 is complete</span><br><span class=\"line\">Your installation of Confluence 7.4.8 is now ready and can be accessed via</span><br><span class=\"line\">your browser.</span><br><span class=\"line\">Custom modifications</span><br><span class=\"line\">Your previous Confluence installation contains customisations that must be</span><br><span class=\"line\">manually transferred. Refer to our documentation more information:</span><br><span class=\"line\">https:&#x2F;&#x2F;docs.atlassian.com&#x2F;confluence&#x2F;docs-74&#x2F;Upgrading+Confluence#UpgradingConfluence-custommodifications</span><br><span class=\"line\">Confluence 7.4.8 can be accessed at http:&#x2F;&#x2F;localhost:8090</span><br><span class=\"line\"></span><br><span class=\"line\">Confluence 7.4.8 may take several minutes to load on first start up.</span><br><span class=\"line\">Finishing installation ...</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n<h3 id=\"访问\"><a href=\"#访问\" class=\"headerlink\" title=\"访问\"></a>访问</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ip:8090</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"界面报错处理\"><a href=\"#界面报错处理\" class=\"headerlink\" title=\"界面报错处理\"></a>界面报错处理</h2><p>报错一:  更新之后破解文件失效了, 将备份的破解文件替换回去</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">LicenseException:Failed to verify the license.</span><br></pre></td></tr></table></figure>\n<p>将备份的破解文件替换回去</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mv ~&#x2F;atlassian-extras-2.4.jar &#x2F;opt&#x2F;atlassian&#x2F;confluence&#x2F;confluence&#x2F;WEB-INF&#x2F;lib&#x2F;atlassian-extras-decoder-v2-3.4.1.jar</span><br></pre></td></tr></table></figure>\n<p>重启服务</p>\n<p>报错二: </p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">MySQL session isolation level &#39;REPEATABLE-READ&#39; is no longer supported. Session isolation level must be &#39;READ-COMMITTED&#39;. See http:&#x2F;&#x2F;confluence.atlassian.com&#x2F;x&#x2F;GAtmDg</span><br></pre></td></tr></table></figure>\n<p>修改 mysql 默认事务隔离级别<br>需要修改/etc/my.cnf</p>\n<p>在[mysqld]下增加一行</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">transaction-isolation&#x3D;READ-COMMITTED</span><br></pre></td></tr></table></figure>\n\n<p>重启mysqld<br>重启confluence</p>\n<h2 id=\"升级完成\"><a href=\"#升级完成\" class=\"headerlink\" title=\"升级完成\"></a>升级完成</h2>"},{"title":"centos7安装awx","date":"2021-03-17T07:45:00.000Z","_content":"  \n  \n摘要: centos7 安装awx\n<!-- more -->\n\n## 安装依赖\n\n### 安装docker\n```\n# curl -sSL https://get.daocloud.io/docker | sh\n```\n\n### 安装python3\n```\n# yum install python3\n```\n\n### 安装docker-compose\n```\n# pip3 install docker-compose   ## 如果没有pip3 使用 yum install python-pip3 安装\n\n## 不要使用下面方式安装\n# curl -L https://get.daocloud.io/docker/compose/releases/download/1.28.5/docker-compose-`uname -s`-`uname -m` > /usr/local/bin/docker-compose\n# chmod +x /usr/local/bin/docker-compose\n# ln -s /usr/local/bin/docker-compose /usr/bin/docker-compose\n```\n\n#### 安装ansible\n```\n# yum install epel-release\n# yum install ansible\n```\n\n## 部署awx\n\n从18.0版开始，AWX Operator是安装AWX的首选方法。\n\n\n### 下载 awx\n```\n# cd /opt\n# git clone https://github.com/ansible/awx.git  网络不好试试  https://github.com.cnpmjs.org/ansible/awx.git\n# cd awx/installer/\n```\n\n修改配置 `inventory` 文件配置\n```\npg_password=***\nrabbitmq_password=***\nadmin_password=***\nproject_data_dir=/var/lib/awx/projects\n```\n\n### 部署安装\n```\n# ansible-playbook -i inventory install.yml\n```\n\n### 等待Docker容器启动\n```\n# docker ps -a\n```\n\n\n部署完成，浏览器访问`本机IP地址`，默认使用`80`端口\n","source":"_posts/install/centos7安装awx.md","raw":"---\ntitle: centos7安装awx\ndate: 2021-03-17 15:45\ncategories:\n- centos7\ntags:\n- awx\n---\n  \n  \n摘要: centos7 安装awx\n<!-- more -->\n\n## 安装依赖\n\n### 安装docker\n```\n# curl -sSL https://get.daocloud.io/docker | sh\n```\n\n### 安装python3\n```\n# yum install python3\n```\n\n### 安装docker-compose\n```\n# pip3 install docker-compose   ## 如果没有pip3 使用 yum install python-pip3 安装\n\n## 不要使用下面方式安装\n# curl -L https://get.daocloud.io/docker/compose/releases/download/1.28.5/docker-compose-`uname -s`-`uname -m` > /usr/local/bin/docker-compose\n# chmod +x /usr/local/bin/docker-compose\n# ln -s /usr/local/bin/docker-compose /usr/bin/docker-compose\n```\n\n#### 安装ansible\n```\n# yum install epel-release\n# yum install ansible\n```\n\n## 部署awx\n\n从18.0版开始，AWX Operator是安装AWX的首选方法。\n\n\n### 下载 awx\n```\n# cd /opt\n# git clone https://github.com/ansible/awx.git  网络不好试试  https://github.com.cnpmjs.org/ansible/awx.git\n# cd awx/installer/\n```\n\n修改配置 `inventory` 文件配置\n```\npg_password=***\nrabbitmq_password=***\nadmin_password=***\nproject_data_dir=/var/lib/awx/projects\n```\n\n### 部署安装\n```\n# ansible-playbook -i inventory install.yml\n```\n\n### 等待Docker容器启动\n```\n# docker ps -a\n```\n\n\n部署完成，浏览器访问`本机IP地址`，默认使用`80`端口\n","slug":"install/centos7安装awx","published":1,"updated":"2021-06-18T08:07:11.190Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cku6979z9003600uh8x8x4poj","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><p>摘要: centos7 安装awx</p>\n<span id=\"more\"></span>\n\n<h2 id=\"安装依赖\"><a href=\"#安装依赖\" class=\"headerlink\" title=\"安装依赖\"></a>安装依赖</h2><h3 id=\"安装docker\"><a href=\"#安装docker\" class=\"headerlink\" title=\"安装docker\"></a>安装docker</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># curl -sSL https:&#x2F;&#x2F;get.daocloud.io&#x2F;docker | sh</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"安装python3\"><a href=\"#安装python3\" class=\"headerlink\" title=\"安装python3\"></a>安装python3</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># yum install python3</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"安装docker-compose\"><a href=\"#安装docker-compose\" class=\"headerlink\" title=\"安装docker-compose\"></a>安装docker-compose</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># pip3 install docker-compose   ## 如果没有pip3 使用 yum install python-pip3 安装</span><br><span class=\"line\"></span><br><span class=\"line\">## 不要使用下面方式安装</span><br><span class=\"line\"># curl -L https:&#x2F;&#x2F;get.daocloud.io&#x2F;docker&#x2F;compose&#x2F;releases&#x2F;download&#x2F;1.28.5&#x2F;docker-compose-&#96;uname -s&#96;-&#96;uname -m&#96; &gt; &#x2F;usr&#x2F;local&#x2F;bin&#x2F;docker-compose</span><br><span class=\"line\"># chmod +x &#x2F;usr&#x2F;local&#x2F;bin&#x2F;docker-compose</span><br><span class=\"line\"># ln -s &#x2F;usr&#x2F;local&#x2F;bin&#x2F;docker-compose &#x2F;usr&#x2F;bin&#x2F;docker-compose</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"安装ansible\"><a href=\"#安装ansible\" class=\"headerlink\" title=\"安装ansible\"></a>安装ansible</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># yum install epel-release</span><br><span class=\"line\"># yum install ansible</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"部署awx\"><a href=\"#部署awx\" class=\"headerlink\" title=\"部署awx\"></a>部署awx</h2><p>从18.0版开始，AWX Operator是安装AWX的首选方法。</p>\n<h3 id=\"下载-awx\"><a href=\"#下载-awx\" class=\"headerlink\" title=\"下载 awx\"></a>下载 awx</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># cd &#x2F;opt</span><br><span class=\"line\"># git clone https:&#x2F;&#x2F;github.com&#x2F;ansible&#x2F;awx.git  网络不好试试  https:&#x2F;&#x2F;github.com.cnpmjs.org&#x2F;ansible&#x2F;awx.git</span><br><span class=\"line\"># cd awx&#x2F;installer&#x2F;</span><br></pre></td></tr></table></figure>\n\n<p>修改配置 <code>inventory</code> 文件配置</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pg_password&#x3D;***</span><br><span class=\"line\">rabbitmq_password&#x3D;***</span><br><span class=\"line\">admin_password&#x3D;***</span><br><span class=\"line\">project_data_dir&#x3D;&#x2F;var&#x2F;lib&#x2F;awx&#x2F;projects</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"部署安装\"><a href=\"#部署安装\" class=\"headerlink\" title=\"部署安装\"></a>部署安装</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># ansible-playbook -i inventory install.yml</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"等待Docker容器启动\"><a href=\"#等待Docker容器启动\" class=\"headerlink\" title=\"等待Docker容器启动\"></a>等待Docker容器启动</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># docker ps -a</span><br></pre></td></tr></table></figure>\n\n\n<p>部署完成，浏览器访问<code>本机IP地址</code>，默认使用<code>80</code>端口</p>\n","site":{"data":{}},"excerpt":"<p>摘要: centos7 安装awx</p>","more":"<h2 id=\"安装依赖\"><a href=\"#安装依赖\" class=\"headerlink\" title=\"安装依赖\"></a>安装依赖</h2><h3 id=\"安装docker\"><a href=\"#安装docker\" class=\"headerlink\" title=\"安装docker\"></a>安装docker</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># curl -sSL https:&#x2F;&#x2F;get.daocloud.io&#x2F;docker | sh</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"安装python3\"><a href=\"#安装python3\" class=\"headerlink\" title=\"安装python3\"></a>安装python3</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># yum install python3</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"安装docker-compose\"><a href=\"#安装docker-compose\" class=\"headerlink\" title=\"安装docker-compose\"></a>安装docker-compose</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># pip3 install docker-compose   ## 如果没有pip3 使用 yum install python-pip3 安装</span><br><span class=\"line\"></span><br><span class=\"line\">## 不要使用下面方式安装</span><br><span class=\"line\"># curl -L https:&#x2F;&#x2F;get.daocloud.io&#x2F;docker&#x2F;compose&#x2F;releases&#x2F;download&#x2F;1.28.5&#x2F;docker-compose-&#96;uname -s&#96;-&#96;uname -m&#96; &gt; &#x2F;usr&#x2F;local&#x2F;bin&#x2F;docker-compose</span><br><span class=\"line\"># chmod +x &#x2F;usr&#x2F;local&#x2F;bin&#x2F;docker-compose</span><br><span class=\"line\"># ln -s &#x2F;usr&#x2F;local&#x2F;bin&#x2F;docker-compose &#x2F;usr&#x2F;bin&#x2F;docker-compose</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"安装ansible\"><a href=\"#安装ansible\" class=\"headerlink\" title=\"安装ansible\"></a>安装ansible</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># yum install epel-release</span><br><span class=\"line\"># yum install ansible</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"部署awx\"><a href=\"#部署awx\" class=\"headerlink\" title=\"部署awx\"></a>部署awx</h2><p>从18.0版开始，AWX Operator是安装AWX的首选方法。</p>\n<h3 id=\"下载-awx\"><a href=\"#下载-awx\" class=\"headerlink\" title=\"下载 awx\"></a>下载 awx</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># cd &#x2F;opt</span><br><span class=\"line\"># git clone https:&#x2F;&#x2F;github.com&#x2F;ansible&#x2F;awx.git  网络不好试试  https:&#x2F;&#x2F;github.com.cnpmjs.org&#x2F;ansible&#x2F;awx.git</span><br><span class=\"line\"># cd awx&#x2F;installer&#x2F;</span><br></pre></td></tr></table></figure>\n\n<p>修改配置 <code>inventory</code> 文件配置</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pg_password&#x3D;***</span><br><span class=\"line\">rabbitmq_password&#x3D;***</span><br><span class=\"line\">admin_password&#x3D;***</span><br><span class=\"line\">project_data_dir&#x3D;&#x2F;var&#x2F;lib&#x2F;awx&#x2F;projects</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"部署安装\"><a href=\"#部署安装\" class=\"headerlink\" title=\"部署安装\"></a>部署安装</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># ansible-playbook -i inventory install.yml</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"等待Docker容器启动\"><a href=\"#等待Docker容器启动\" class=\"headerlink\" title=\"等待Docker容器启动\"></a>等待Docker容器启动</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># docker ps -a</span><br></pre></td></tr></table></figure>\n\n\n<p>部署完成，浏览器访问<code>本机IP地址</code>，默认使用<code>80</code>端口</p>"},{"title":"Centos7安装bind9","date":"2021-02-25T01:50:00.000Z","_content":"  \n  \n摘要: centos7安装bind9\n<!-- more -->\n\n[TOC]\n\n## 编译前环境准备\n\n### 下载bind9\n[bind官网](https://www.isc.org/bind/)\n前往官网下载源码，当前有3个版本\n\n|VERSION\t|STATUS|\tRELEASE DATE|\tEOL DATE|\n|---|---|---|---|\n|9.17.10\t|Development\t|February 2021\t|TBD|\n|9.16.12\t|Current-Stable\t|February 2021\t|TBD|\n|9.11.28\t|Current-Stable, ESV\t|February 2021\t|December 2021|\n\n- Development 为开发版，不适用于生产环境\n- Current-Stable 稳定版本\n- Approaching EOL 即将停更版本\n- Current-Stable, ESV 带扩展功能的的稳定版本\n```\ncd /usr/local/src\nwget https://downloads.isc.org/isc/bind9/9.16.12/bind-9.16.12.tar.xz\n```\n\n## 编译安装\n\n### 安装依赖\n```\nyum install -y libuv libuv-devel libcap-devel pcre-devel zlib-devel gcc gcc-c++ autoconf automake make pcre-devel zlib-devel openssl-devel openldap-devel unixODBC-devel gcc libtool openssl  bind-utils python-pip  \n```\n```\npip install ply\n```\n解压\n```\ncd /usr/local/src\ntar -xvf bind-9.16.12.tar.xz\n```\n### 安装\n```\ncd bind-9.16.12\n./configure --prefix=/usr/local/bind9 --sysconfdir=/etc/named/ --enable-largefile --with-tuning=large --with-openssl\n```\n```\nmake && make install\n```\n\n### 编译错误处理\n\n`错误一`\n```\nconfigure: error: Python >= 2.7 or >= 3.2 and the PLY package are required for dnssec-keymgr and other Python-based tools. \nPLY may be available from your OS package manager as python-ply or python3-ply; it can also be installed via pip. To build without Python/PLY, use --without-python.\n```\n处理\n执行pip install ply安装ply，安装前要确保此时setuptools和pip已经安装，如果未安装则需要单独安装。如果不安装ply模块，bind在编译时会报错如下。\n```\npip install ply\n```\n\n`错误二`\n```\nchecking for libuv... checking for libuv >= 1.0.0... no\nconfigure: error: libuv not found\n```\n处理\n```\nyum install -y epel-release\nyum install libuv\nyum install libuv-devel\n```\n\n`错误三`\n```\nconfigure: error: sys/capability.h header is required for Linux capabilities support. Either install libcap or use --disable-linux-caps.\n```\n处理\n```\nyum install libcap-devel\n```\n\n\n### 添加环境变量\n```\nvim /etc/profile.d/named.sh\nexport PATH=/usr/local/bind9/bin:/usr/local/bind9/sbin:$PATH\n\n. /etc/profile.d/named.sh\n```\n\n### 导出库文件搜索路径\n```\n$ vim /etc/ld.so.conf.d/named.conf\n/usr/local/bind9/lib\n$ ldconfig -v\n```\n\n### 导出头文件搜索路径\n```\n$ ln -sv /usr/local/bind9/include /usr/include/named\n\n\"/usr/include/named\" -> \"/usr/local/bind9/include\"\n```\n\n### 导出帮助文档搜索路径（非必须）\n```\n$ vim /etc/man.config \nMANPATH /usr/local/bind9/share/man\n```\n\n\n\n## 配置\n\n### 准备\n\n\n创建服务专用账户named，禁止本地登陆户\n```\nuseradd -d /usr/local/bind9 -s /sbin/nologin named\n```\n\n接下来我们更改所有配置文件的用户为named用户\n```\nmkdir /run/named\nmkdir -p /var/named/{dynamic,data,zone}\n\n\n```\n\n在联网的情况下直接将查询根的结果导入根区域配置文件，我们在named.rfc1912.zones文件中配置了根文件named.ca\n\n```\n$ dig -t NS . > /var/named/named.ca\n```\n\n\n### 主配置\n```\n$ cd /etc/named\n$ vim named.conf\n\noptions {\n  listen-on port 53 { any; };\n  listen-on-v6 port 53 { ::1; };\n  directory \"/var/named\";   # zone配置根目录\n  dump-file \"/var/named/data/cache_dump.db\";\n  statistics-file \"/var/named/data/named_stats.txt\";\n  memstatistics-file \"/var/named/data/named_mem_stats.txt\";\n  allow-query { any; };\n  recursion yes; # 允许递归查询\n  allow-new-zones yes;  #允许添加zone\n  max-cache-size 70%;\n  dnssec-validation no;   # 指定是否提供使用dnssec认证的资源记录.默认为yes.\n\n  forward first;\n  forwarders {\n    114.114.114.114; # 电信DNS\n  };\n\n  /* Path to ISC DLV key */\n  bindkeys-file \"/etc/named/bind.keys\";\n\n  managed-keys-directory \"/var/named/dynamic\";\n\n  pid-file \"/run/named/named.pid\";\n  session-keyfile \"/run/named/session.key\";\n\n};\n\nlogging {\n  channel queries_log {\n    file \"data/named.run\" versions 3 size 300m; # 这里的路径是相对于上面的directory路径\n    print-time yes;                  # 日志文件每300MB切割一次\n    print-category yes;\n    print-severity yes;\n    severity info;\n  };\n\n  channel query-errors_log {\n    file \"data/query-errors.run\" versions 5 size 20m;\n    print-time yes;\n    print-category yes;\n    print-severity yes;\n    severity dynamic;\n  };\n\n  category queries { queries_log; };\n  category resolver { queries_log; };\n  category query-errors {query-errors_log; };\n};\n\n\nzone \".\" IN { # 根域名\n  type hint;\n  file \"named.ca\";\n};\n\n#include \"/etc/named/named.rfc1912.zones\";\n```\n\n### rndc配置\nrndc是一个管理程序，可以用它来刷新配置，停止服务，强制同步等\n```\nrndc-confgen  > /etc/named/rndc.conf\n```\n打开rndc.conf文件，找到# Use with the following in named.conf, adjusting the allow list as needed:注释，复制其下所有行到named.conf并放开注释。\n```\ntail -10 /etc/named/rndc.conf | head -9 | sed s/#\\ //g > named.conf\n```\n最终的named.conf文件像下面这样\n```\nkey \"rndc-key\" {\n  algorithm hmac-sha256;\n  secret \"...\";\n};\n\ncontrols {\n  inet 127.0.0.1 port 953\n  allow { 127.0.0.1; } keys { \"rndc-key\"; };\n};\n\noptions {\n  ...\n};\n\nlogging {\n  ...\n};\n\n\nzone \".\" IN { # 根\n  type hint;\n  file \"named.ca\";\n};\n\n#include \"/etc/named/named.rfc1912.zones\";\n```\n\n### zones 配置\n```\n$ vim /var/named/abc.com.zone\n\n$TTL 10M  ;time to live  信息存放在高速缓存中的时间长度，以秒为单位\n@       IN      SOA     abc.com.      admin.abc.com. (\n                        1   ;序列号\n                        1H  ;1小时后刷新\n                        5M  ;15分钟后重试\n                        7D  ;1星期后过期\n                        1D );否定缓存TTL为1天\n        IN      NS      ns.abc.com.\nns      IN      A       192.168.7.134\nwww       IN      A      192.168.7.133\n@         IN      A      192.168.7.133\napi       IN      A      192.168.7.133\na         IN      A      192.168.7.134\n```\n\n## 启动\n\n### 权限配置\n\n```\nchown -R named:named /usr/local/bind9/\nchown -R named:named /etc/named\nchown -R named:named /var/named/\nchown -R named:named /run/named\n```\n\n### 检查配置\n\n实时日志\n```\nnamed -u named -g\n```\n\n```\nvim  /usr/lib/systemd/system/named.service\n\n[Unit]\nDescription=Berkeley Internet Name Domain (DNS)\nWants=nss-lookup.target\nWants=named-setup-rndc.service\nBefore=nss-lookup.target\nAfter=network.target\nAfter=named-setup-rndc.service\n\n[Service]\nType=forking\nEnvironment=NAMEDCONF=/etc/named/named.conf\nEnvironmentFile=-/etc/sysconfig/named\nEnvironment=KRB5_KTNAME=/etc/named.keytab\nPIDFile=/run/named/named.pid\n\nExecStartPre=/bin/bash -c 'if [ ! \"$DISABLE_ZONE_CHECKING\" == \"yes\" ]; then /usr/local/bind9/sbin/named-checkconf -z \"$NAMEDCONF\"; else echo \"Checking of zone files is disabled\"; fi'\nExecStart=/usr/local/bind9/sbin/named -u named -c ${NAMEDCONF} $OPTIONS\n\nExecReload=/bin/sh -c '/usr/local/bind9/sbin/rndc reload > /dev/null 2>&1 || /bin/kill -HUP $MAINPID'\n\nExecStop=/bin/sh -c '/usr/local/bind9/sbin/rndc stop > /dev/null 2>&1 || /bin/kill -TERM $MAINPID'\n\nPrivateTmp=true\n\n[Install]\nWantedBy=multi-user.target\n\n```\n\n```\nsystemctl status named\nsystemctl enable named\nsystemctl start named\nsystemctl stop named\n```\n\n## 测试\n\n主配置文件\n```\nvim named.conf\n\nzone \"test.com\" IN {\n  type master;\n  file \"zone/test.com.zone\";\n  allow-update { none; };\n};\n```\n\n区域配置文件\n```\nvim /var/named/zone/test.com.zone\n\n$TTL      86400\n@     IN SOA      test.com root.test.com (\n                                  42                ; serial (d. adams)\n                                  3H                ; refresh\n                                  15M               ; retry\n                                  1W                ; expiry\n                                  1D )              ; minimum\n                IN NS           @\n                IN A            127.0.0.1\n                IN AAAA         ::1\nwww IN A 172.16.100.200\n```\n\n重启\n```\nsystemctl restart named\n```\n\n解析测试\n```\nnslookup \n\n> server 10.200.192.13\nDefault server: 10.200.192.13\nAddress: 10.200.192.13#53\n> www.test.com\nServer:\t\t10.200.192.13\nAddress:\t10.200.192.13#53\n\nName:\twww.test.com\nAddress: 172.16.100.200\n> exit\n\n```\n\n\n## rndc \n\nrndc（Remote Name Domain Controllerr）是一个远程管理bind的工具，通过这个工具可以在本地或者远程了解当前服务器的运行状况，也可以对服务器进行关闭、重载、刷新缓存、增加删除zone等操作。\n\n使用rndc可以在不停止DNS服务器工作的情况进行数据的更新，使修改后的配置文件生效。在实际情况下，DNS服务器是非常繁忙的，任何短时间的停顿都会给用户的使用带来影响。因此，使用rndc工具可以使DNS服务器更好地为用户提供服务。在使用rndc管理bind前需要使用rndc生成一对密钥文件，一半保存于rndc的配置文件中，另一半保存于bind主配置文件中。rndc的配置文件为/etc/rndc.conf，在CentOS或者RHEL中，rndc的密钥保存在/etc/rndc.key文件中。rndc默认监听在953号端口（TCP），其实在bind9中rndc默认就是可以使用，不需要配置密钥文件。\n\nrndc与DNS服务器实行连接时，需要通过数字证书进行认证，而不是传统的用户名/密码方式。在当前版本下，rndc和named都只支持HMAC-MD5认证算法，在通信两端使用预共享密钥。在当前版本的rndc 和 named中，唯一支持的认证算法是HMAC-MD5，在连接的两端使用共享密钥。它为命令请求和名字服务器的响应提供 TSIG类型的认证。所有经由通道发送的命令都必须被一个服务器所知道的 key_id 签名。为了生成双方都认可的密钥，可以使用rndc-confgen命令产生密钥和相应的配置，再把这些配置分别放入named.conf和rndc的配置文件rndc.conf中。\n\n\n### 更新key\n\n```\n生成 key 文件\nrndc-confgen -a\n\nwrote key file \"/etc/rndc.key\"\n```\n\n```\nrndc status\n\nrndc: connection to remote host closed\nThis may indicate that\n* the remote server is using an older version of the command protocol,\n* this host is not authorized to connect,\n* the clocks are not synchronized,\n* the key signing algorithm is incorrect, or\n* the key is invalid.\n\n```\n\n### 产生/etc/rndc.conf文件\n\n```\nrndc-confgen > /etc/rndc.conf  \n```\n\n### 配置 named.conf使用rndc秘钥\n```\ntail -10 /etc/named/rndc.conf | head -9 | sed s/#\\ //g >> named.conf\n```\n\n```\ncat /etc/named/named.conf \n\nkey \"rndc-key\" {\n    algorithm hmac-sha256;\n    secret \"1PX8tBVLFLrCcIhkcQ5r0t9hiPSihtakLkj3s2k3OeU=\";\n};\n\ncontrols {\n  inet 127.0.0.1 port 953\n  allow { 127.0.0.1; } keys { \"rndc-key\"; };\n};\n\n```\n\n### 测试 RNDC 设置\n```\nrndc status\n\nversion: BIND 9.16.12 (Stable Release) <id:aeb943d>\nrunning on hz01-base-dns-01: Linux x86_64 3.10.0-1160.25.1.el7.x86_64 #1 SMP Wed Apr 28 21:49:45 UTC 2021\nboot time: Thu, 03 Jun 2021 02:45:44 GMT\nlast configured: Thu, 03 Jun 2021 09:10:43 GMT\nconfiguration file: /etc/named/named.conf\nCPUs found: 4\nworker threads: 4\nUDP listeners per interface: 4\nnumber of zones: 105 (99 automatic)\ndebug level: 0\nxfers running: 0\nxfers deferred: 0\nsoa queries in progress: 0\nquery logging is ON\nrecursive clients: 0/900/1000\ntcp clients: 0/150\nTCP high-water: 2\nserver is up and running\n```\n\n\n## nsupdate \n\nnsupdate工具是一个交互式的命令工具, 对应的区配置部分需要配置allow-update语句:  allow-update { any; };\n```\nzone \"test.com\" {\n\ttype master;\n\tallow-update { any; };\n\tfile \"test.com.zone\";\n};\n```\n\n```\nnsupdate\n\n> server 127.0.0.1\n> zone test.com\n> update add xxx.test.com 300 A 3.3.3.3\n> update detale  abc.test.com 300 A\n> send\n> show\n> quit\n```\n\n### nsupdate 参数\n-d 调试模式。\n-k 从keyfile文件中读取密钥信息。\n-y keyname是密钥的名称,secret是以base64编码的密钥。\n-v 使用TCP协议进行nsupdate.默认是使用UDP协议。\n\n命令格式:\nserver servername [ port ]\n送请求到servername服务器的port端口.如果不指定servername,nsupdate将把请求发送给当前去的主DNS服务器.\n如:\nserver 192.168.36.54 53\n\nlocal address [ port ]           发送nsupdate请求时,使用的本地地址和端口.\nzone zonename                    指定需要更新的区名.\nclass classname                 指定默认类别.默认的类别是IN.\nkey name secret                 指定所有更新使用的密钥.\nprereq nxdomain domain-name               要求domain-name中不存在任何资源记录.\nprereq yxdomain domain-name                 要求domain-name存在,并且至少包含有一条记录.\nprereq nxrrset domain-name [ class ] type        要求domain-name中没有指定类别的资源记录.\nprereq yxrrset domain-name [ class ] type   要求存在一条指定的资源记录.类别和domain-name必须存在.\nupdate delete domain-name [ ttl ] [ class ] [ type [ data... ] ]     删除domain-name的资源记录.如果指定了type和data,仅删除匹配的记录.\n\nupdate add domain-name ttl [ class ] type data…      添加一条资源记录.\nshow      显示自send命令后,所有的要求信息和更新请求.\nsend     将要求信息和更新请求发送到DNS服务器.等同于输入一个空行.\n\n\n\n### 通过TSIG key实现nsupdate功能\n```\n1、使用` dnssec-keygen -a HMAC-MD5 -b 128 -n USER testkey `命令来生成密钥。\n  dnssec-keygen：用来生成更新密钥。\n    -a HMAC-MD5：采用HMAC-MD5加密算法。\n    -b 128：生成的密钥长度为128位。\n    -n USER testkey：密钥的用户名为testkey。\n\n2、密钥生成后，会在当前目录下自动生成两个密钥文件***.+157+xxx.key和***.+157+xxx.private。\n3、查看两个密钥文件的内容：\n  cat ***.+157+xxx.key\n  cat ***.+157+xxx.private\n4、通过同样的方法生成test2key。\n5、添加密钥信息到DNS主配置文件中 \n6、将test.com区域中的allow-update { none; }中的\"none\"改成\"key testkey\";\n  将\"none\"改成\"key testkey\"的意思是指明采用\"key testkey\"作为密钥的用户可以动态更新“t\n```\n例子:\n```\nview \"view-test\" in{\n\tmatch-clients{\n\t\tkey testkey;\n\t\tacl1;\n\t\t};//keytestkey;以及acl1;zone\"test.com\"{\n\ttype master;\n\tfile \"test.zone\";\n\tallow-update{\n\t\t\tkey testkey;\n\t\t};\n\t};\n};\n```\n\n```\nnsupdate 增删改查\nserver 192.168.0.49 53\n删除\n    删除NS记录\n        update delete huiselantian.com  IN NS ns2.huiselantian.com.\n        update delete huiselantian.com  IN NS ns3.huiselantian.com.\n        update delete huiselantian.com  IN NS ns4.huiselantian.com.\n        update delete huiselantian.com  IN NS ns5.huiselantian.com.\n    删除A记录\n        update delete ns2.huiselantian.com  A\n        update delete ns3.huiselantian.com  A\n        update delete ns4.huiselantian.com  A\n        update delete ns5.huiselantian.com  A\n增加\n    增加NS记录\n        update add huiselantian.com 600 IN NS ns2.huiselantian.com.\n        update add huiselantian.com 600 IN NS ns3.huiselantian.com.\n        update add huiselantian.com 600 IN NS ns4.huiselantian.com.    \n    增加A记录\n        update add ns3.huiselantian.com 600 IN A 192.168.0.236\n        update add ns4.huiselantian.com 600 IN A 192.168.0.237\n        update add ns5.huiselantian.com 600 IN A 192.168.1.125    \n查询：\n    查询NS记录\n         dig NS @192.168.0.49 huiselantian.com \n    查询A记录\n        dig A @192.168.0.49 ns1.huiselantian.com\n    查询SOA记录\n        dig SOA @192.168.0.49 huiselantian.com\n改：\n    先删除后新增\nsend\nnsupdate处理ns的时候(如不规范,会报错)\n    添加：\n        先添加A 再添加NS记录 \n    删除\n        先删除ns 再删除A记录\n\n```","source":"_posts/install/centos7安装bind9.md","raw":"---\ntitle: Centos7安装bind9\ndate: 2021-02-25 09:50\ncategories:\n- centos7\ntags:\n- dns\n---\n  \n  \n摘要: centos7安装bind9\n<!-- more -->\n\n[TOC]\n\n## 编译前环境准备\n\n### 下载bind9\n[bind官网](https://www.isc.org/bind/)\n前往官网下载源码，当前有3个版本\n\n|VERSION\t|STATUS|\tRELEASE DATE|\tEOL DATE|\n|---|---|---|---|\n|9.17.10\t|Development\t|February 2021\t|TBD|\n|9.16.12\t|Current-Stable\t|February 2021\t|TBD|\n|9.11.28\t|Current-Stable, ESV\t|February 2021\t|December 2021|\n\n- Development 为开发版，不适用于生产环境\n- Current-Stable 稳定版本\n- Approaching EOL 即将停更版本\n- Current-Stable, ESV 带扩展功能的的稳定版本\n```\ncd /usr/local/src\nwget https://downloads.isc.org/isc/bind9/9.16.12/bind-9.16.12.tar.xz\n```\n\n## 编译安装\n\n### 安装依赖\n```\nyum install -y libuv libuv-devel libcap-devel pcre-devel zlib-devel gcc gcc-c++ autoconf automake make pcre-devel zlib-devel openssl-devel openldap-devel unixODBC-devel gcc libtool openssl  bind-utils python-pip  \n```\n```\npip install ply\n```\n解压\n```\ncd /usr/local/src\ntar -xvf bind-9.16.12.tar.xz\n```\n### 安装\n```\ncd bind-9.16.12\n./configure --prefix=/usr/local/bind9 --sysconfdir=/etc/named/ --enable-largefile --with-tuning=large --with-openssl\n```\n```\nmake && make install\n```\n\n### 编译错误处理\n\n`错误一`\n```\nconfigure: error: Python >= 2.7 or >= 3.2 and the PLY package are required for dnssec-keymgr and other Python-based tools. \nPLY may be available from your OS package manager as python-ply or python3-ply; it can also be installed via pip. To build without Python/PLY, use --without-python.\n```\n处理\n执行pip install ply安装ply，安装前要确保此时setuptools和pip已经安装，如果未安装则需要单独安装。如果不安装ply模块，bind在编译时会报错如下。\n```\npip install ply\n```\n\n`错误二`\n```\nchecking for libuv... checking for libuv >= 1.0.0... no\nconfigure: error: libuv not found\n```\n处理\n```\nyum install -y epel-release\nyum install libuv\nyum install libuv-devel\n```\n\n`错误三`\n```\nconfigure: error: sys/capability.h header is required for Linux capabilities support. Either install libcap or use --disable-linux-caps.\n```\n处理\n```\nyum install libcap-devel\n```\n\n\n### 添加环境变量\n```\nvim /etc/profile.d/named.sh\nexport PATH=/usr/local/bind9/bin:/usr/local/bind9/sbin:$PATH\n\n. /etc/profile.d/named.sh\n```\n\n### 导出库文件搜索路径\n```\n$ vim /etc/ld.so.conf.d/named.conf\n/usr/local/bind9/lib\n$ ldconfig -v\n```\n\n### 导出头文件搜索路径\n```\n$ ln -sv /usr/local/bind9/include /usr/include/named\n\n\"/usr/include/named\" -> \"/usr/local/bind9/include\"\n```\n\n### 导出帮助文档搜索路径（非必须）\n```\n$ vim /etc/man.config \nMANPATH /usr/local/bind9/share/man\n```\n\n\n\n## 配置\n\n### 准备\n\n\n创建服务专用账户named，禁止本地登陆户\n```\nuseradd -d /usr/local/bind9 -s /sbin/nologin named\n```\n\n接下来我们更改所有配置文件的用户为named用户\n```\nmkdir /run/named\nmkdir -p /var/named/{dynamic,data,zone}\n\n\n```\n\n在联网的情况下直接将查询根的结果导入根区域配置文件，我们在named.rfc1912.zones文件中配置了根文件named.ca\n\n```\n$ dig -t NS . > /var/named/named.ca\n```\n\n\n### 主配置\n```\n$ cd /etc/named\n$ vim named.conf\n\noptions {\n  listen-on port 53 { any; };\n  listen-on-v6 port 53 { ::1; };\n  directory \"/var/named\";   # zone配置根目录\n  dump-file \"/var/named/data/cache_dump.db\";\n  statistics-file \"/var/named/data/named_stats.txt\";\n  memstatistics-file \"/var/named/data/named_mem_stats.txt\";\n  allow-query { any; };\n  recursion yes; # 允许递归查询\n  allow-new-zones yes;  #允许添加zone\n  max-cache-size 70%;\n  dnssec-validation no;   # 指定是否提供使用dnssec认证的资源记录.默认为yes.\n\n  forward first;\n  forwarders {\n    114.114.114.114; # 电信DNS\n  };\n\n  /* Path to ISC DLV key */\n  bindkeys-file \"/etc/named/bind.keys\";\n\n  managed-keys-directory \"/var/named/dynamic\";\n\n  pid-file \"/run/named/named.pid\";\n  session-keyfile \"/run/named/session.key\";\n\n};\n\nlogging {\n  channel queries_log {\n    file \"data/named.run\" versions 3 size 300m; # 这里的路径是相对于上面的directory路径\n    print-time yes;                  # 日志文件每300MB切割一次\n    print-category yes;\n    print-severity yes;\n    severity info;\n  };\n\n  channel query-errors_log {\n    file \"data/query-errors.run\" versions 5 size 20m;\n    print-time yes;\n    print-category yes;\n    print-severity yes;\n    severity dynamic;\n  };\n\n  category queries { queries_log; };\n  category resolver { queries_log; };\n  category query-errors {query-errors_log; };\n};\n\n\nzone \".\" IN { # 根域名\n  type hint;\n  file \"named.ca\";\n};\n\n#include \"/etc/named/named.rfc1912.zones\";\n```\n\n### rndc配置\nrndc是一个管理程序，可以用它来刷新配置，停止服务，强制同步等\n```\nrndc-confgen  > /etc/named/rndc.conf\n```\n打开rndc.conf文件，找到# Use with the following in named.conf, adjusting the allow list as needed:注释，复制其下所有行到named.conf并放开注释。\n```\ntail -10 /etc/named/rndc.conf | head -9 | sed s/#\\ //g > named.conf\n```\n最终的named.conf文件像下面这样\n```\nkey \"rndc-key\" {\n  algorithm hmac-sha256;\n  secret \"...\";\n};\n\ncontrols {\n  inet 127.0.0.1 port 953\n  allow { 127.0.0.1; } keys { \"rndc-key\"; };\n};\n\noptions {\n  ...\n};\n\nlogging {\n  ...\n};\n\n\nzone \".\" IN { # 根\n  type hint;\n  file \"named.ca\";\n};\n\n#include \"/etc/named/named.rfc1912.zones\";\n```\n\n### zones 配置\n```\n$ vim /var/named/abc.com.zone\n\n$TTL 10M  ;time to live  信息存放在高速缓存中的时间长度，以秒为单位\n@       IN      SOA     abc.com.      admin.abc.com. (\n                        1   ;序列号\n                        1H  ;1小时后刷新\n                        5M  ;15分钟后重试\n                        7D  ;1星期后过期\n                        1D );否定缓存TTL为1天\n        IN      NS      ns.abc.com.\nns      IN      A       192.168.7.134\nwww       IN      A      192.168.7.133\n@         IN      A      192.168.7.133\napi       IN      A      192.168.7.133\na         IN      A      192.168.7.134\n```\n\n## 启动\n\n### 权限配置\n\n```\nchown -R named:named /usr/local/bind9/\nchown -R named:named /etc/named\nchown -R named:named /var/named/\nchown -R named:named /run/named\n```\n\n### 检查配置\n\n实时日志\n```\nnamed -u named -g\n```\n\n```\nvim  /usr/lib/systemd/system/named.service\n\n[Unit]\nDescription=Berkeley Internet Name Domain (DNS)\nWants=nss-lookup.target\nWants=named-setup-rndc.service\nBefore=nss-lookup.target\nAfter=network.target\nAfter=named-setup-rndc.service\n\n[Service]\nType=forking\nEnvironment=NAMEDCONF=/etc/named/named.conf\nEnvironmentFile=-/etc/sysconfig/named\nEnvironment=KRB5_KTNAME=/etc/named.keytab\nPIDFile=/run/named/named.pid\n\nExecStartPre=/bin/bash -c 'if [ ! \"$DISABLE_ZONE_CHECKING\" == \"yes\" ]; then /usr/local/bind9/sbin/named-checkconf -z \"$NAMEDCONF\"; else echo \"Checking of zone files is disabled\"; fi'\nExecStart=/usr/local/bind9/sbin/named -u named -c ${NAMEDCONF} $OPTIONS\n\nExecReload=/bin/sh -c '/usr/local/bind9/sbin/rndc reload > /dev/null 2>&1 || /bin/kill -HUP $MAINPID'\n\nExecStop=/bin/sh -c '/usr/local/bind9/sbin/rndc stop > /dev/null 2>&1 || /bin/kill -TERM $MAINPID'\n\nPrivateTmp=true\n\n[Install]\nWantedBy=multi-user.target\n\n```\n\n```\nsystemctl status named\nsystemctl enable named\nsystemctl start named\nsystemctl stop named\n```\n\n## 测试\n\n主配置文件\n```\nvim named.conf\n\nzone \"test.com\" IN {\n  type master;\n  file \"zone/test.com.zone\";\n  allow-update { none; };\n};\n```\n\n区域配置文件\n```\nvim /var/named/zone/test.com.zone\n\n$TTL      86400\n@     IN SOA      test.com root.test.com (\n                                  42                ; serial (d. adams)\n                                  3H                ; refresh\n                                  15M               ; retry\n                                  1W                ; expiry\n                                  1D )              ; minimum\n                IN NS           @\n                IN A            127.0.0.1\n                IN AAAA         ::1\nwww IN A 172.16.100.200\n```\n\n重启\n```\nsystemctl restart named\n```\n\n解析测试\n```\nnslookup \n\n> server 10.200.192.13\nDefault server: 10.200.192.13\nAddress: 10.200.192.13#53\n> www.test.com\nServer:\t\t10.200.192.13\nAddress:\t10.200.192.13#53\n\nName:\twww.test.com\nAddress: 172.16.100.200\n> exit\n\n```\n\n\n## rndc \n\nrndc（Remote Name Domain Controllerr）是一个远程管理bind的工具，通过这个工具可以在本地或者远程了解当前服务器的运行状况，也可以对服务器进行关闭、重载、刷新缓存、增加删除zone等操作。\n\n使用rndc可以在不停止DNS服务器工作的情况进行数据的更新，使修改后的配置文件生效。在实际情况下，DNS服务器是非常繁忙的，任何短时间的停顿都会给用户的使用带来影响。因此，使用rndc工具可以使DNS服务器更好地为用户提供服务。在使用rndc管理bind前需要使用rndc生成一对密钥文件，一半保存于rndc的配置文件中，另一半保存于bind主配置文件中。rndc的配置文件为/etc/rndc.conf，在CentOS或者RHEL中，rndc的密钥保存在/etc/rndc.key文件中。rndc默认监听在953号端口（TCP），其实在bind9中rndc默认就是可以使用，不需要配置密钥文件。\n\nrndc与DNS服务器实行连接时，需要通过数字证书进行认证，而不是传统的用户名/密码方式。在当前版本下，rndc和named都只支持HMAC-MD5认证算法，在通信两端使用预共享密钥。在当前版本的rndc 和 named中，唯一支持的认证算法是HMAC-MD5，在连接的两端使用共享密钥。它为命令请求和名字服务器的响应提供 TSIG类型的认证。所有经由通道发送的命令都必须被一个服务器所知道的 key_id 签名。为了生成双方都认可的密钥，可以使用rndc-confgen命令产生密钥和相应的配置，再把这些配置分别放入named.conf和rndc的配置文件rndc.conf中。\n\n\n### 更新key\n\n```\n生成 key 文件\nrndc-confgen -a\n\nwrote key file \"/etc/rndc.key\"\n```\n\n```\nrndc status\n\nrndc: connection to remote host closed\nThis may indicate that\n* the remote server is using an older version of the command protocol,\n* this host is not authorized to connect,\n* the clocks are not synchronized,\n* the key signing algorithm is incorrect, or\n* the key is invalid.\n\n```\n\n### 产生/etc/rndc.conf文件\n\n```\nrndc-confgen > /etc/rndc.conf  \n```\n\n### 配置 named.conf使用rndc秘钥\n```\ntail -10 /etc/named/rndc.conf | head -9 | sed s/#\\ //g >> named.conf\n```\n\n```\ncat /etc/named/named.conf \n\nkey \"rndc-key\" {\n    algorithm hmac-sha256;\n    secret \"1PX8tBVLFLrCcIhkcQ5r0t9hiPSihtakLkj3s2k3OeU=\";\n};\n\ncontrols {\n  inet 127.0.0.1 port 953\n  allow { 127.0.0.1; } keys { \"rndc-key\"; };\n};\n\n```\n\n### 测试 RNDC 设置\n```\nrndc status\n\nversion: BIND 9.16.12 (Stable Release) <id:aeb943d>\nrunning on hz01-base-dns-01: Linux x86_64 3.10.0-1160.25.1.el7.x86_64 #1 SMP Wed Apr 28 21:49:45 UTC 2021\nboot time: Thu, 03 Jun 2021 02:45:44 GMT\nlast configured: Thu, 03 Jun 2021 09:10:43 GMT\nconfiguration file: /etc/named/named.conf\nCPUs found: 4\nworker threads: 4\nUDP listeners per interface: 4\nnumber of zones: 105 (99 automatic)\ndebug level: 0\nxfers running: 0\nxfers deferred: 0\nsoa queries in progress: 0\nquery logging is ON\nrecursive clients: 0/900/1000\ntcp clients: 0/150\nTCP high-water: 2\nserver is up and running\n```\n\n\n## nsupdate \n\nnsupdate工具是一个交互式的命令工具, 对应的区配置部分需要配置allow-update语句:  allow-update { any; };\n```\nzone \"test.com\" {\n\ttype master;\n\tallow-update { any; };\n\tfile \"test.com.zone\";\n};\n```\n\n```\nnsupdate\n\n> server 127.0.0.1\n> zone test.com\n> update add xxx.test.com 300 A 3.3.3.3\n> update detale  abc.test.com 300 A\n> send\n> show\n> quit\n```\n\n### nsupdate 参数\n-d 调试模式。\n-k 从keyfile文件中读取密钥信息。\n-y keyname是密钥的名称,secret是以base64编码的密钥。\n-v 使用TCP协议进行nsupdate.默认是使用UDP协议。\n\n命令格式:\nserver servername [ port ]\n送请求到servername服务器的port端口.如果不指定servername,nsupdate将把请求发送给当前去的主DNS服务器.\n如:\nserver 192.168.36.54 53\n\nlocal address [ port ]           发送nsupdate请求时,使用的本地地址和端口.\nzone zonename                    指定需要更新的区名.\nclass classname                 指定默认类别.默认的类别是IN.\nkey name secret                 指定所有更新使用的密钥.\nprereq nxdomain domain-name               要求domain-name中不存在任何资源记录.\nprereq yxdomain domain-name                 要求domain-name存在,并且至少包含有一条记录.\nprereq nxrrset domain-name [ class ] type        要求domain-name中没有指定类别的资源记录.\nprereq yxrrset domain-name [ class ] type   要求存在一条指定的资源记录.类别和domain-name必须存在.\nupdate delete domain-name [ ttl ] [ class ] [ type [ data... ] ]     删除domain-name的资源记录.如果指定了type和data,仅删除匹配的记录.\n\nupdate add domain-name ttl [ class ] type data…      添加一条资源记录.\nshow      显示自send命令后,所有的要求信息和更新请求.\nsend     将要求信息和更新请求发送到DNS服务器.等同于输入一个空行.\n\n\n\n### 通过TSIG key实现nsupdate功能\n```\n1、使用` dnssec-keygen -a HMAC-MD5 -b 128 -n USER testkey `命令来生成密钥。\n  dnssec-keygen：用来生成更新密钥。\n    -a HMAC-MD5：采用HMAC-MD5加密算法。\n    -b 128：生成的密钥长度为128位。\n    -n USER testkey：密钥的用户名为testkey。\n\n2、密钥生成后，会在当前目录下自动生成两个密钥文件***.+157+xxx.key和***.+157+xxx.private。\n3、查看两个密钥文件的内容：\n  cat ***.+157+xxx.key\n  cat ***.+157+xxx.private\n4、通过同样的方法生成test2key。\n5、添加密钥信息到DNS主配置文件中 \n6、将test.com区域中的allow-update { none; }中的\"none\"改成\"key testkey\";\n  将\"none\"改成\"key testkey\"的意思是指明采用\"key testkey\"作为密钥的用户可以动态更新“t\n```\n例子:\n```\nview \"view-test\" in{\n\tmatch-clients{\n\t\tkey testkey;\n\t\tacl1;\n\t\t};//keytestkey;以及acl1;zone\"test.com\"{\n\ttype master;\n\tfile \"test.zone\";\n\tallow-update{\n\t\t\tkey testkey;\n\t\t};\n\t};\n};\n```\n\n```\nnsupdate 增删改查\nserver 192.168.0.49 53\n删除\n    删除NS记录\n        update delete huiselantian.com  IN NS ns2.huiselantian.com.\n        update delete huiselantian.com  IN NS ns3.huiselantian.com.\n        update delete huiselantian.com  IN NS ns4.huiselantian.com.\n        update delete huiselantian.com  IN NS ns5.huiselantian.com.\n    删除A记录\n        update delete ns2.huiselantian.com  A\n        update delete ns3.huiselantian.com  A\n        update delete ns4.huiselantian.com  A\n        update delete ns5.huiselantian.com  A\n增加\n    增加NS记录\n        update add huiselantian.com 600 IN NS ns2.huiselantian.com.\n        update add huiselantian.com 600 IN NS ns3.huiselantian.com.\n        update add huiselantian.com 600 IN NS ns4.huiselantian.com.    \n    增加A记录\n        update add ns3.huiselantian.com 600 IN A 192.168.0.236\n        update add ns4.huiselantian.com 600 IN A 192.168.0.237\n        update add ns5.huiselantian.com 600 IN A 192.168.1.125    \n查询：\n    查询NS记录\n         dig NS @192.168.0.49 huiselantian.com \n    查询A记录\n        dig A @192.168.0.49 ns1.huiselantian.com\n    查询SOA记录\n        dig SOA @192.168.0.49 huiselantian.com\n改：\n    先删除后新增\nsend\nnsupdate处理ns的时候(如不规范,会报错)\n    添加：\n        先添加A 再添加NS记录 \n    删除\n        先删除ns 再删除A记录\n\n```","slug":"install/centos7安装bind9","published":1,"updated":"2021-09-10T04:22:57.185Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cku6979za003900uhep6qevr3","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><p>摘要: centos7安装bind9</p>\n<span id=\"more\"></span>\n\n<p>[TOC]</p>\n<h2 id=\"编译前环境准备\"><a href=\"#编译前环境准备\" class=\"headerlink\" title=\"编译前环境准备\"></a>编译前环境准备</h2><h3 id=\"下载bind9\"><a href=\"#下载bind9\" class=\"headerlink\" title=\"下载bind9\"></a>下载bind9</h3><p><a href=\"https://www.isc.org/bind/\">bind官网</a><br>前往官网下载源码，当前有3个版本</p>\n<table>\n<thead>\n<tr>\n<th>VERSION</th>\n<th>STATUS</th>\n<th>RELEASE DATE</th>\n<th>EOL DATE</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>9.17.10</td>\n<td>Development</td>\n<td>February 2021</td>\n<td>TBD</td>\n</tr>\n<tr>\n<td>9.16.12</td>\n<td>Current-Stable</td>\n<td>February 2021</td>\n<td>TBD</td>\n</tr>\n<tr>\n<td>9.11.28</td>\n<td>Current-Stable, ESV</td>\n<td>February 2021</td>\n<td>December 2021</td>\n</tr>\n</tbody></table>\n<ul>\n<li>Development 为开发版，不适用于生产环境</li>\n<li>Current-Stable 稳定版本</li>\n<li>Approaching EOL 即将停更版本</li>\n<li>Current-Stable, ESV 带扩展功能的的稳定版本<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd &#x2F;usr&#x2F;local&#x2F;src</span><br><span class=\"line\">wget https:&#x2F;&#x2F;downloads.isc.org&#x2F;isc&#x2F;bind9&#x2F;9.16.12&#x2F;bind-9.16.12.tar.xz</span><br></pre></td></tr></table></figure>\n\n</li>\n</ul>\n<h2 id=\"编译安装\"><a href=\"#编译安装\" class=\"headerlink\" title=\"编译安装\"></a>编译安装</h2><h3 id=\"安装依赖\"><a href=\"#安装依赖\" class=\"headerlink\" title=\"安装依赖\"></a>安装依赖</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install -y libuv libuv-devel libcap-devel pcre-devel zlib-devel gcc gcc-c++ autoconf automake make pcre-devel zlib-devel openssl-devel openldap-devel unixODBC-devel gcc libtool openssl  bind-utils python-pip  </span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pip install ply</span><br></pre></td></tr></table></figure>\n<p>解压</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd &#x2F;usr&#x2F;local&#x2F;src</span><br><span class=\"line\">tar -xvf bind-9.16.12.tar.xz</span><br></pre></td></tr></table></figure>\n<h3 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd bind-9.16.12</span><br><span class=\"line\">.&#x2F;configure --prefix&#x3D;&#x2F;usr&#x2F;local&#x2F;bind9 --sysconfdir&#x3D;&#x2F;etc&#x2F;named&#x2F; --enable-largefile --with-tuning&#x3D;large --with-openssl</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"编译错误处理\"><a href=\"#编译错误处理\" class=\"headerlink\" title=\"编译错误处理\"></a>编译错误处理</h3><p><code>错误一</code></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">configure: error: Python &gt;&#x3D; 2.7 or &gt;&#x3D; 3.2 and the PLY package are required for dnssec-keymgr and other Python-based tools. </span><br><span class=\"line\">PLY may be available from your OS package manager as python-ply or python3-ply; it can also be installed via pip. To build without Python&#x2F;PLY, use --without-python.</span><br></pre></td></tr></table></figure>\n<p>处理<br>执行pip install ply安装ply，安装前要确保此时setuptools和pip已经安装，如果未安装则需要单独安装。如果不安装ply模块，bind在编译时会报错如下。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pip install ply</span><br></pre></td></tr></table></figure>\n\n<p><code>错误二</code></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">checking for libuv... checking for libuv &gt;&#x3D; 1.0.0... no</span><br><span class=\"line\">configure: error: libuv not found</span><br></pre></td></tr></table></figure>\n<p>处理</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install -y epel-release</span><br><span class=\"line\">yum install libuv</span><br><span class=\"line\">yum install libuv-devel</span><br></pre></td></tr></table></figure>\n\n<p><code>错误三</code></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">configure: error: sys&#x2F;capability.h header is required for Linux capabilities support. Either install libcap or use --disable-linux-caps.</span><br></pre></td></tr></table></figure>\n<p>处理</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install libcap-devel</span><br></pre></td></tr></table></figure>\n\n\n<h3 id=\"添加环境变量\"><a href=\"#添加环境变量\" class=\"headerlink\" title=\"添加环境变量\"></a>添加环境变量</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim &#x2F;etc&#x2F;profile.d&#x2F;named.sh</span><br><span class=\"line\">export PATH&#x3D;&#x2F;usr&#x2F;local&#x2F;bind9&#x2F;bin:&#x2F;usr&#x2F;local&#x2F;bind9&#x2F;sbin:$PATH</span><br><span class=\"line\"></span><br><span class=\"line\">. &#x2F;etc&#x2F;profile.d&#x2F;named.sh</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"导出库文件搜索路径\"><a href=\"#导出库文件搜索路径\" class=\"headerlink\" title=\"导出库文件搜索路径\"></a>导出库文件搜索路径</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ vim &#x2F;etc&#x2F;ld.so.conf.d&#x2F;named.conf</span><br><span class=\"line\">&#x2F;usr&#x2F;local&#x2F;bind9&#x2F;lib</span><br><span class=\"line\">$ ldconfig -v</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"导出头文件搜索路径\"><a href=\"#导出头文件搜索路径\" class=\"headerlink\" title=\"导出头文件搜索路径\"></a>导出头文件搜索路径</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ ln -sv &#x2F;usr&#x2F;local&#x2F;bind9&#x2F;include &#x2F;usr&#x2F;include&#x2F;named</span><br><span class=\"line\"></span><br><span class=\"line\">&quot;&#x2F;usr&#x2F;include&#x2F;named&quot; -&gt; &quot;&#x2F;usr&#x2F;local&#x2F;bind9&#x2F;include&quot;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"导出帮助文档搜索路径（非必须）\"><a href=\"#导出帮助文档搜索路径（非必须）\" class=\"headerlink\" title=\"导出帮助文档搜索路径（非必须）\"></a>导出帮助文档搜索路径（非必须）</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ vim &#x2F;etc&#x2F;man.config </span><br><span class=\"line\">MANPATH &#x2F;usr&#x2F;local&#x2F;bind9&#x2F;share&#x2F;man</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"配置\"><a href=\"#配置\" class=\"headerlink\" title=\"配置\"></a>配置</h2><h3 id=\"准备\"><a href=\"#准备\" class=\"headerlink\" title=\"准备\"></a>准备</h3><p>创建服务专用账户named，禁止本地登陆户</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">useradd -d &#x2F;usr&#x2F;local&#x2F;bind9 -s &#x2F;sbin&#x2F;nologin named</span><br></pre></td></tr></table></figure>\n\n<p>接下来我们更改所有配置文件的用户为named用户</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir &#x2F;run&#x2F;named</span><br><span class=\"line\">mkdir -p &#x2F;var&#x2F;named&#x2F;&#123;dynamic,data,zone&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>在联网的情况下直接将查询根的结果导入根区域配置文件，我们在named.rfc1912.zones文件中配置了根文件named.ca</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ dig -t NS . &gt; &#x2F;var&#x2F;named&#x2F;named.ca</span><br></pre></td></tr></table></figure>\n\n\n<h3 id=\"主配置\"><a href=\"#主配置\" class=\"headerlink\" title=\"主配置\"></a>主配置</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ cd &#x2F;etc&#x2F;named</span><br><span class=\"line\">$ vim named.conf</span><br><span class=\"line\"></span><br><span class=\"line\">options &#123;</span><br><span class=\"line\">  listen-on port 53 &#123; any; &#125;;</span><br><span class=\"line\">  listen-on-v6 port 53 &#123; ::1; &#125;;</span><br><span class=\"line\">  directory &quot;&#x2F;var&#x2F;named&quot;;   # zone配置根目录</span><br><span class=\"line\">  dump-file &quot;&#x2F;var&#x2F;named&#x2F;data&#x2F;cache_dump.db&quot;;</span><br><span class=\"line\">  statistics-file &quot;&#x2F;var&#x2F;named&#x2F;data&#x2F;named_stats.txt&quot;;</span><br><span class=\"line\">  memstatistics-file &quot;&#x2F;var&#x2F;named&#x2F;data&#x2F;named_mem_stats.txt&quot;;</span><br><span class=\"line\">  allow-query &#123; any; &#125;;</span><br><span class=\"line\">  recursion yes; # 允许递归查询</span><br><span class=\"line\">  allow-new-zones yes;  #允许添加zone</span><br><span class=\"line\">  max-cache-size 70%;</span><br><span class=\"line\">  dnssec-validation no;   # 指定是否提供使用dnssec认证的资源记录.默认为yes.</span><br><span class=\"line\"></span><br><span class=\"line\">  forward first;</span><br><span class=\"line\">  forwarders &#123;</span><br><span class=\"line\">    114.114.114.114; # 电信DNS</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">  &#x2F;* Path to ISC DLV key *&#x2F;</span><br><span class=\"line\">  bindkeys-file &quot;&#x2F;etc&#x2F;named&#x2F;bind.keys&quot;;</span><br><span class=\"line\"></span><br><span class=\"line\">  managed-keys-directory &quot;&#x2F;var&#x2F;named&#x2F;dynamic&quot;;</span><br><span class=\"line\"></span><br><span class=\"line\">  pid-file &quot;&#x2F;run&#x2F;named&#x2F;named.pid&quot;;</span><br><span class=\"line\">  session-keyfile &quot;&#x2F;run&#x2F;named&#x2F;session.key&quot;;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">logging &#123;</span><br><span class=\"line\">  channel queries_log &#123;</span><br><span class=\"line\">    file &quot;data&#x2F;named.run&quot; versions 3 size 300m; # 这里的路径是相对于上面的directory路径</span><br><span class=\"line\">    print-time yes;                  # 日志文件每300MB切割一次</span><br><span class=\"line\">    print-category yes;</span><br><span class=\"line\">    print-severity yes;</span><br><span class=\"line\">    severity info;</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">  channel query-errors_log &#123;</span><br><span class=\"line\">    file &quot;data&#x2F;query-errors.run&quot; versions 5 size 20m;</span><br><span class=\"line\">    print-time yes;</span><br><span class=\"line\">    print-category yes;</span><br><span class=\"line\">    print-severity yes;</span><br><span class=\"line\">    severity dynamic;</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">  category queries &#123; queries_log; &#125;;</span><br><span class=\"line\">  category resolver &#123; queries_log; &#125;;</span><br><span class=\"line\">  category query-errors &#123;query-errors_log; &#125;;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">zone &quot;.&quot; IN &#123; # 根域名</span><br><span class=\"line\">  type hint;</span><br><span class=\"line\">  file &quot;named.ca&quot;;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">#include &quot;&#x2F;etc&#x2F;named&#x2F;named.rfc1912.zones&quot;;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"rndc配置\"><a href=\"#rndc配置\" class=\"headerlink\" title=\"rndc配置\"></a>rndc配置</h3><p>rndc是一个管理程序，可以用它来刷新配置，停止服务，强制同步等</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rndc-confgen  &gt; &#x2F;etc&#x2F;named&#x2F;rndc.conf</span><br></pre></td></tr></table></figure>\n<p>打开rndc.conf文件，找到# Use with the following in named.conf, adjusting the allow list as needed:注释，复制其下所有行到named.conf并放开注释。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tail -10 &#x2F;etc&#x2F;named&#x2F;rndc.conf | head -9 | sed s&#x2F;#\\ &#x2F;&#x2F;g &gt; named.conf</span><br></pre></td></tr></table></figure>\n<p>最终的named.conf文件像下面这样</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">key &quot;rndc-key&quot; &#123;</span><br><span class=\"line\">  algorithm hmac-sha256;</span><br><span class=\"line\">  secret &quot;...&quot;;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">controls &#123;</span><br><span class=\"line\">  inet 127.0.0.1 port 953</span><br><span class=\"line\">  allow &#123; 127.0.0.1; &#125; keys &#123; &quot;rndc-key&quot;; &#125;;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">options &#123;</span><br><span class=\"line\">  ...</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">logging &#123;</span><br><span class=\"line\">  ...</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">zone &quot;.&quot; IN &#123; # 根</span><br><span class=\"line\">  type hint;</span><br><span class=\"line\">  file &quot;named.ca&quot;;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">#include &quot;&#x2F;etc&#x2F;named&#x2F;named.rfc1912.zones&quot;;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"zones-配置\"><a href=\"#zones-配置\" class=\"headerlink\" title=\"zones 配置\"></a>zones 配置</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ vim &#x2F;var&#x2F;named&#x2F;abc.com.zone</span><br><span class=\"line\"></span><br><span class=\"line\">$TTL 10M  ;time to live  信息存放在高速缓存中的时间长度，以秒为单位</span><br><span class=\"line\">@       IN      SOA     abc.com.      admin.abc.com. (</span><br><span class=\"line\">                        1   ;序列号</span><br><span class=\"line\">                        1H  ;1小时后刷新</span><br><span class=\"line\">                        5M  ;15分钟后重试</span><br><span class=\"line\">                        7D  ;1星期后过期</span><br><span class=\"line\">                        1D );否定缓存TTL为1天</span><br><span class=\"line\">        IN      NS      ns.abc.com.</span><br><span class=\"line\">ns      IN      A       192.168.7.134</span><br><span class=\"line\">www       IN      A      192.168.7.133</span><br><span class=\"line\">@         IN      A      192.168.7.133</span><br><span class=\"line\">api       IN      A      192.168.7.133</span><br><span class=\"line\">a         IN      A      192.168.7.134</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"启动\"><a href=\"#启动\" class=\"headerlink\" title=\"启动\"></a>启动</h2><h3 id=\"权限配置\"><a href=\"#权限配置\" class=\"headerlink\" title=\"权限配置\"></a>权限配置</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">chown -R named:named &#x2F;usr&#x2F;local&#x2F;bind9&#x2F;</span><br><span class=\"line\">chown -R named:named &#x2F;etc&#x2F;named</span><br><span class=\"line\">chown -R named:named &#x2F;var&#x2F;named&#x2F;</span><br><span class=\"line\">chown -R named:named &#x2F;run&#x2F;named</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"检查配置\"><a href=\"#检查配置\" class=\"headerlink\" title=\"检查配置\"></a>检查配置</h3><p>实时日志</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">named -u named -g</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim  &#x2F;usr&#x2F;lib&#x2F;systemd&#x2F;system&#x2F;named.service</span><br><span class=\"line\"></span><br><span class=\"line\">[Unit]</span><br><span class=\"line\">Description&#x3D;Berkeley Internet Name Domain (DNS)</span><br><span class=\"line\">Wants&#x3D;nss-lookup.target</span><br><span class=\"line\">Wants&#x3D;named-setup-rndc.service</span><br><span class=\"line\">Before&#x3D;nss-lookup.target</span><br><span class=\"line\">After&#x3D;network.target</span><br><span class=\"line\">After&#x3D;named-setup-rndc.service</span><br><span class=\"line\"></span><br><span class=\"line\">[Service]</span><br><span class=\"line\">Type&#x3D;forking</span><br><span class=\"line\">Environment&#x3D;NAMEDCONF&#x3D;&#x2F;etc&#x2F;named&#x2F;named.conf</span><br><span class=\"line\">EnvironmentFile&#x3D;-&#x2F;etc&#x2F;sysconfig&#x2F;named</span><br><span class=\"line\">Environment&#x3D;KRB5_KTNAME&#x3D;&#x2F;etc&#x2F;named.keytab</span><br><span class=\"line\">PIDFile&#x3D;&#x2F;run&#x2F;named&#x2F;named.pid</span><br><span class=\"line\"></span><br><span class=\"line\">ExecStartPre&#x3D;&#x2F;bin&#x2F;bash -c &#39;if [ ! &quot;$DISABLE_ZONE_CHECKING&quot; &#x3D;&#x3D; &quot;yes&quot; ]; then &#x2F;usr&#x2F;local&#x2F;bind9&#x2F;sbin&#x2F;named-checkconf -z &quot;$NAMEDCONF&quot;; else echo &quot;Checking of zone files is disabled&quot;; fi&#39;</span><br><span class=\"line\">ExecStart&#x3D;&#x2F;usr&#x2F;local&#x2F;bind9&#x2F;sbin&#x2F;named -u named -c $&#123;NAMEDCONF&#125; $OPTIONS</span><br><span class=\"line\"></span><br><span class=\"line\">ExecReload&#x3D;&#x2F;bin&#x2F;sh -c &#39;&#x2F;usr&#x2F;local&#x2F;bind9&#x2F;sbin&#x2F;rndc reload &gt; &#x2F;dev&#x2F;null 2&gt;&amp;1 || &#x2F;bin&#x2F;kill -HUP $MAINPID&#39;</span><br><span class=\"line\"></span><br><span class=\"line\">ExecStop&#x3D;&#x2F;bin&#x2F;sh -c &#39;&#x2F;usr&#x2F;local&#x2F;bind9&#x2F;sbin&#x2F;rndc stop &gt; &#x2F;dev&#x2F;null 2&gt;&amp;1 || &#x2F;bin&#x2F;kill -TERM $MAINPID&#39;</span><br><span class=\"line\"></span><br><span class=\"line\">PrivateTmp&#x3D;true</span><br><span class=\"line\"></span><br><span class=\"line\">[Install]</span><br><span class=\"line\">WantedBy&#x3D;multi-user.target</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl status named</span><br><span class=\"line\">systemctl enable named</span><br><span class=\"line\">systemctl start named</span><br><span class=\"line\">systemctl stop named</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"测试\"><a href=\"#测试\" class=\"headerlink\" title=\"测试\"></a>测试</h2><p>主配置文件</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim named.conf</span><br><span class=\"line\"></span><br><span class=\"line\">zone &quot;test.com&quot; IN &#123;</span><br><span class=\"line\">  type master;</span><br><span class=\"line\">  file &quot;zone&#x2F;test.com.zone&quot;;</span><br><span class=\"line\">  allow-update &#123; none; &#125;;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<p>区域配置文件</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim &#x2F;var&#x2F;named&#x2F;zone&#x2F;test.com.zone</span><br><span class=\"line\"></span><br><span class=\"line\">$TTL      86400</span><br><span class=\"line\">@     IN SOA      test.com root.test.com (</span><br><span class=\"line\">                                  42                ; serial (d. adams)</span><br><span class=\"line\">                                  3H                ; refresh</span><br><span class=\"line\">                                  15M               ; retry</span><br><span class=\"line\">                                  1W                ; expiry</span><br><span class=\"line\">                                  1D )              ; minimum</span><br><span class=\"line\">                IN NS           @</span><br><span class=\"line\">                IN A            127.0.0.1</span><br><span class=\"line\">                IN AAAA         ::1</span><br><span class=\"line\">www IN A 172.16.100.200</span><br></pre></td></tr></table></figure>\n\n<p>重启</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl restart named</span><br></pre></td></tr></table></figure>\n\n<p>解析测试</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nslookup </span><br><span class=\"line\"></span><br><span class=\"line\">&gt; server 10.200.192.13</span><br><span class=\"line\">Default server: 10.200.192.13</span><br><span class=\"line\">Address: 10.200.192.13#53</span><br><span class=\"line\">&gt; www.test.com</span><br><span class=\"line\">Server:\t\t10.200.192.13</span><br><span class=\"line\">Address:\t10.200.192.13#53</span><br><span class=\"line\"></span><br><span class=\"line\">Name:\twww.test.com</span><br><span class=\"line\">Address: 172.16.100.200</span><br><span class=\"line\">&gt; exit</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"rndc\"><a href=\"#rndc\" class=\"headerlink\" title=\"rndc\"></a>rndc</h2><p>rndc（Remote Name Domain Controllerr）是一个远程管理bind的工具，通过这个工具可以在本地或者远程了解当前服务器的运行状况，也可以对服务器进行关闭、重载、刷新缓存、增加删除zone等操作。</p>\n<p>使用rndc可以在不停止DNS服务器工作的情况进行数据的更新，使修改后的配置文件生效。在实际情况下，DNS服务器是非常繁忙的，任何短时间的停顿都会给用户的使用带来影响。因此，使用rndc工具可以使DNS服务器更好地为用户提供服务。在使用rndc管理bind前需要使用rndc生成一对密钥文件，一半保存于rndc的配置文件中，另一半保存于bind主配置文件中。rndc的配置文件为/etc/rndc.conf，在CentOS或者RHEL中，rndc的密钥保存在/etc/rndc.key文件中。rndc默认监听在953号端口（TCP），其实在bind9中rndc默认就是可以使用，不需要配置密钥文件。</p>\n<p>rndc与DNS服务器实行连接时，需要通过数字证书进行认证，而不是传统的用户名/密码方式。在当前版本下，rndc和named都只支持HMAC-MD5认证算法，在通信两端使用预共享密钥。在当前版本的rndc 和 named中，唯一支持的认证算法是HMAC-MD5，在连接的两端使用共享密钥。它为命令请求和名字服务器的响应提供 TSIG类型的认证。所有经由通道发送的命令都必须被一个服务器所知道的 key_id 签名。为了生成双方都认可的密钥，可以使用rndc-confgen命令产生密钥和相应的配置，再把这些配置分别放入named.conf和rndc的配置文件rndc.conf中。</p>\n<h3 id=\"更新key\"><a href=\"#更新key\" class=\"headerlink\" title=\"更新key\"></a>更新key</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">生成 key 文件</span><br><span class=\"line\">rndc-confgen -a</span><br><span class=\"line\"></span><br><span class=\"line\">wrote key file &quot;&#x2F;etc&#x2F;rndc.key&quot;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rndc status</span><br><span class=\"line\"></span><br><span class=\"line\">rndc: connection to remote host closed</span><br><span class=\"line\">This may indicate that</span><br><span class=\"line\">* the remote server is using an older version of the command protocol,</span><br><span class=\"line\">* this host is not authorized to connect,</span><br><span class=\"line\">* the clocks are not synchronized,</span><br><span class=\"line\">* the key signing algorithm is incorrect, or</span><br><span class=\"line\">* the key is invalid.</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"产生-etc-rndc-conf文件\"><a href=\"#产生-etc-rndc-conf文件\" class=\"headerlink\" title=\"产生/etc/rndc.conf文件\"></a>产生/etc/rndc.conf文件</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rndc-confgen &gt; &#x2F;etc&#x2F;rndc.conf  </span><br></pre></td></tr></table></figure>\n\n<h3 id=\"配置-named-conf使用rndc秘钥\"><a href=\"#配置-named-conf使用rndc秘钥\" class=\"headerlink\" title=\"配置 named.conf使用rndc秘钥\"></a>配置 named.conf使用rndc秘钥</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tail -10 &#x2F;etc&#x2F;named&#x2F;rndc.conf | head -9 | sed s&#x2F;#\\ &#x2F;&#x2F;g &gt;&gt; named.conf</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cat &#x2F;etc&#x2F;named&#x2F;named.conf </span><br><span class=\"line\"></span><br><span class=\"line\">key &quot;rndc-key&quot; &#123;</span><br><span class=\"line\">    algorithm hmac-sha256;</span><br><span class=\"line\">    secret &quot;1PX8tBVLFLrCcIhkcQ5r0t9hiPSihtakLkj3s2k3OeU&#x3D;&quot;;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">controls &#123;</span><br><span class=\"line\">  inet 127.0.0.1 port 953</span><br><span class=\"line\">  allow &#123; 127.0.0.1; &#125; keys &#123; &quot;rndc-key&quot;; &#125;;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"测试-RNDC-设置\"><a href=\"#测试-RNDC-设置\" class=\"headerlink\" title=\"测试 RNDC 设置\"></a>测试 RNDC 设置</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rndc status</span><br><span class=\"line\"></span><br><span class=\"line\">version: BIND 9.16.12 (Stable Release) &lt;id:aeb943d&gt;</span><br><span class=\"line\">running on hz01-base-dns-01: Linux x86_64 3.10.0-1160.25.1.el7.x86_64 #1 SMP Wed Apr 28 21:49:45 UTC 2021</span><br><span class=\"line\">boot time: Thu, 03 Jun 2021 02:45:44 GMT</span><br><span class=\"line\">last configured: Thu, 03 Jun 2021 09:10:43 GMT</span><br><span class=\"line\">configuration file: &#x2F;etc&#x2F;named&#x2F;named.conf</span><br><span class=\"line\">CPUs found: 4</span><br><span class=\"line\">worker threads: 4</span><br><span class=\"line\">UDP listeners per interface: 4</span><br><span class=\"line\">number of zones: 105 (99 automatic)</span><br><span class=\"line\">debug level: 0</span><br><span class=\"line\">xfers running: 0</span><br><span class=\"line\">xfers deferred: 0</span><br><span class=\"line\">soa queries in progress: 0</span><br><span class=\"line\">query logging is ON</span><br><span class=\"line\">recursive clients: 0&#x2F;900&#x2F;1000</span><br><span class=\"line\">tcp clients: 0&#x2F;150</span><br><span class=\"line\">TCP high-water: 2</span><br><span class=\"line\">server is up and running</span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"nsupdate\"><a href=\"#nsupdate\" class=\"headerlink\" title=\"nsupdate\"></a>nsupdate</h2><p>nsupdate工具是一个交互式的命令工具, 对应的区配置部分需要配置allow-update语句:  allow-update { any; };</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">zone &quot;test.com&quot; &#123;</span><br><span class=\"line\">\ttype master;</span><br><span class=\"line\">\tallow-update &#123; any; &#125;;</span><br><span class=\"line\">\tfile &quot;test.com.zone&quot;;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nsupdate</span><br><span class=\"line\"></span><br><span class=\"line\">&gt; server 127.0.0.1</span><br><span class=\"line\">&gt; zone test.com</span><br><span class=\"line\">&gt; update add xxx.test.com 300 A 3.3.3.3</span><br><span class=\"line\">&gt; update detale  abc.test.com 300 A</span><br><span class=\"line\">&gt; send</span><br><span class=\"line\">&gt; show</span><br><span class=\"line\">&gt; quit</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"nsupdate-参数\"><a href=\"#nsupdate-参数\" class=\"headerlink\" title=\"nsupdate 参数\"></a>nsupdate 参数</h3><p>-d 调试模式。<br>-k 从keyfile文件中读取密钥信息。<br>-y keyname是密钥的名称,secret是以base64编码的密钥。<br>-v 使用TCP协议进行nsupdate.默认是使用UDP协议。</p>\n<p>命令格式:<br>server servername [ port ]<br>送请求到servername服务器的port端口.如果不指定servername,nsupdate将把请求发送给当前去的主DNS服务器.<br>如:<br>server 192.168.36.54 53</p>\n<p>local address [ port ]           发送nsupdate请求时,使用的本地地址和端口.<br>zone zonename                    指定需要更新的区名.<br>class classname                 指定默认类别.默认的类别是IN.<br>key name secret                 指定所有更新使用的密钥.<br>prereq nxdomain domain-name               要求domain-name中不存在任何资源记录.<br>prereq yxdomain domain-name                 要求domain-name存在,并且至少包含有一条记录.<br>prereq nxrrset domain-name [ class ] type        要求domain-name中没有指定类别的资源记录.<br>prereq yxrrset domain-name [ class ] type   要求存在一条指定的资源记录.类别和domain-name必须存在.<br>update delete domain-name [ ttl ] [ class ] [ type [ data… ] ]     删除domain-name的资源记录.如果指定了type和data,仅删除匹配的记录.</p>\n<p>update add domain-name ttl [ class ] type data…      添加一条资源记录.<br>show      显示自send命令后,所有的要求信息和更新请求.<br>send     将要求信息和更新请求发送到DNS服务器.等同于输入一个空行.</p>\n<h3 id=\"通过TSIG-key实现nsupdate功能\"><a href=\"#通过TSIG-key实现nsupdate功能\" class=\"headerlink\" title=\"通过TSIG key实现nsupdate功能\"></a>通过TSIG key实现nsupdate功能</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1、使用&#96; dnssec-keygen -a HMAC-MD5 -b 128 -n USER testkey &#96;命令来生成密钥。</span><br><span class=\"line\">  dnssec-keygen：用来生成更新密钥。</span><br><span class=\"line\">    -a HMAC-MD5：采用HMAC-MD5加密算法。</span><br><span class=\"line\">    -b 128：生成的密钥长度为128位。</span><br><span class=\"line\">    -n USER testkey：密钥的用户名为testkey。</span><br><span class=\"line\"></span><br><span class=\"line\">2、密钥生成后，会在当前目录下自动生成两个密钥文件***.+157+xxx.key和***.+157+xxx.private。</span><br><span class=\"line\">3、查看两个密钥文件的内容：</span><br><span class=\"line\">  cat ***.+157+xxx.key</span><br><span class=\"line\">  cat ***.+157+xxx.private</span><br><span class=\"line\">4、通过同样的方法生成test2key。</span><br><span class=\"line\">5、添加密钥信息到DNS主配置文件中 </span><br><span class=\"line\">6、将test.com区域中的allow-update &#123; none; &#125;中的&quot;none&quot;改成&quot;key testkey&quot;;</span><br><span class=\"line\">  将&quot;none&quot;改成&quot;key testkey&quot;的意思是指明采用&quot;key testkey&quot;作为密钥的用户可以动态更新“t</span><br></pre></td></tr></table></figure>\n<p>例子:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">view &quot;view-test&quot; in&#123;</span><br><span class=\"line\">\tmatch-clients&#123;</span><br><span class=\"line\">\t\tkey testkey;</span><br><span class=\"line\">\t\tacl1;</span><br><span class=\"line\">\t\t&#125;;&#x2F;&#x2F;keytestkey;以及acl1;zone&quot;test.com&quot;&#123;</span><br><span class=\"line\">\ttype master;</span><br><span class=\"line\">\tfile &quot;test.zone&quot;;</span><br><span class=\"line\">\tallow-update&#123;</span><br><span class=\"line\">\t\t\tkey testkey;</span><br><span class=\"line\">\t\t&#125;;</span><br><span class=\"line\">\t&#125;;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nsupdate 增删改查</span><br><span class=\"line\">server 192.168.0.49 53</span><br><span class=\"line\">删除</span><br><span class=\"line\">    删除NS记录</span><br><span class=\"line\">        update delete huiselantian.com  IN NS ns2.huiselantian.com.</span><br><span class=\"line\">        update delete huiselantian.com  IN NS ns3.huiselantian.com.</span><br><span class=\"line\">        update delete huiselantian.com  IN NS ns4.huiselantian.com.</span><br><span class=\"line\">        update delete huiselantian.com  IN NS ns5.huiselantian.com.</span><br><span class=\"line\">    删除A记录</span><br><span class=\"line\">        update delete ns2.huiselantian.com  A</span><br><span class=\"line\">        update delete ns3.huiselantian.com  A</span><br><span class=\"line\">        update delete ns4.huiselantian.com  A</span><br><span class=\"line\">        update delete ns5.huiselantian.com  A</span><br><span class=\"line\">增加</span><br><span class=\"line\">    增加NS记录</span><br><span class=\"line\">        update add huiselantian.com 600 IN NS ns2.huiselantian.com.</span><br><span class=\"line\">        update add huiselantian.com 600 IN NS ns3.huiselantian.com.</span><br><span class=\"line\">        update add huiselantian.com 600 IN NS ns4.huiselantian.com.    </span><br><span class=\"line\">    增加A记录</span><br><span class=\"line\">        update add ns3.huiselantian.com 600 IN A 192.168.0.236</span><br><span class=\"line\">        update add ns4.huiselantian.com 600 IN A 192.168.0.237</span><br><span class=\"line\">        update add ns5.huiselantian.com 600 IN A 192.168.1.125    </span><br><span class=\"line\">查询：</span><br><span class=\"line\">    查询NS记录</span><br><span class=\"line\">         dig NS @192.168.0.49 huiselantian.com </span><br><span class=\"line\">    查询A记录</span><br><span class=\"line\">        dig A @192.168.0.49 ns1.huiselantian.com</span><br><span class=\"line\">    查询SOA记录</span><br><span class=\"line\">        dig SOA @192.168.0.49 huiselantian.com</span><br><span class=\"line\">改：</span><br><span class=\"line\">    先删除后新增</span><br><span class=\"line\">send</span><br><span class=\"line\">nsupdate处理ns的时候(如不规范,会报错)</span><br><span class=\"line\">    添加：</span><br><span class=\"line\">        先添加A 再添加NS记录 </span><br><span class=\"line\">    删除</span><br><span class=\"line\">        先删除ns 再删除A记录</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"<p>摘要: centos7安装bind9</p>","more":"<p>[TOC]</p>\n<h2 id=\"编译前环境准备\"><a href=\"#编译前环境准备\" class=\"headerlink\" title=\"编译前环境准备\"></a>编译前环境准备</h2><h3 id=\"下载bind9\"><a href=\"#下载bind9\" class=\"headerlink\" title=\"下载bind9\"></a>下载bind9</h3><p><a href=\"https://www.isc.org/bind/\">bind官网</a><br>前往官网下载源码，当前有3个版本</p>\n<table>\n<thead>\n<tr>\n<th>VERSION</th>\n<th>STATUS</th>\n<th>RELEASE DATE</th>\n<th>EOL DATE</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>9.17.10</td>\n<td>Development</td>\n<td>February 2021</td>\n<td>TBD</td>\n</tr>\n<tr>\n<td>9.16.12</td>\n<td>Current-Stable</td>\n<td>February 2021</td>\n<td>TBD</td>\n</tr>\n<tr>\n<td>9.11.28</td>\n<td>Current-Stable, ESV</td>\n<td>February 2021</td>\n<td>December 2021</td>\n</tr>\n</tbody></table>\n<ul>\n<li>Development 为开发版，不适用于生产环境</li>\n<li>Current-Stable 稳定版本</li>\n<li>Approaching EOL 即将停更版本</li>\n<li>Current-Stable, ESV 带扩展功能的的稳定版本<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd &#x2F;usr&#x2F;local&#x2F;src</span><br><span class=\"line\">wget https:&#x2F;&#x2F;downloads.isc.org&#x2F;isc&#x2F;bind9&#x2F;9.16.12&#x2F;bind-9.16.12.tar.xz</span><br></pre></td></tr></table></figure>\n\n</li>\n</ul>\n<h2 id=\"编译安装\"><a href=\"#编译安装\" class=\"headerlink\" title=\"编译安装\"></a>编译安装</h2><h3 id=\"安装依赖\"><a href=\"#安装依赖\" class=\"headerlink\" title=\"安装依赖\"></a>安装依赖</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install -y libuv libuv-devel libcap-devel pcre-devel zlib-devel gcc gcc-c++ autoconf automake make pcre-devel zlib-devel openssl-devel openldap-devel unixODBC-devel gcc libtool openssl  bind-utils python-pip  </span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pip install ply</span><br></pre></td></tr></table></figure>\n<p>解压</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd &#x2F;usr&#x2F;local&#x2F;src</span><br><span class=\"line\">tar -xvf bind-9.16.12.tar.xz</span><br></pre></td></tr></table></figure>\n<h3 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd bind-9.16.12</span><br><span class=\"line\">.&#x2F;configure --prefix&#x3D;&#x2F;usr&#x2F;local&#x2F;bind9 --sysconfdir&#x3D;&#x2F;etc&#x2F;named&#x2F; --enable-largefile --with-tuning&#x3D;large --with-openssl</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"编译错误处理\"><a href=\"#编译错误处理\" class=\"headerlink\" title=\"编译错误处理\"></a>编译错误处理</h3><p><code>错误一</code></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">configure: error: Python &gt;&#x3D; 2.7 or &gt;&#x3D; 3.2 and the PLY package are required for dnssec-keymgr and other Python-based tools. </span><br><span class=\"line\">PLY may be available from your OS package manager as python-ply or python3-ply; it can also be installed via pip. To build without Python&#x2F;PLY, use --without-python.</span><br></pre></td></tr></table></figure>\n<p>处理<br>执行pip install ply安装ply，安装前要确保此时setuptools和pip已经安装，如果未安装则需要单独安装。如果不安装ply模块，bind在编译时会报错如下。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pip install ply</span><br></pre></td></tr></table></figure>\n\n<p><code>错误二</code></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">checking for libuv... checking for libuv &gt;&#x3D; 1.0.0... no</span><br><span class=\"line\">configure: error: libuv not found</span><br></pre></td></tr></table></figure>\n<p>处理</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install -y epel-release</span><br><span class=\"line\">yum install libuv</span><br><span class=\"line\">yum install libuv-devel</span><br></pre></td></tr></table></figure>\n\n<p><code>错误三</code></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">configure: error: sys&#x2F;capability.h header is required for Linux capabilities support. Either install libcap or use --disable-linux-caps.</span><br></pre></td></tr></table></figure>\n<p>处理</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install libcap-devel</span><br></pre></td></tr></table></figure>\n\n\n<h3 id=\"添加环境变量\"><a href=\"#添加环境变量\" class=\"headerlink\" title=\"添加环境变量\"></a>添加环境变量</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim &#x2F;etc&#x2F;profile.d&#x2F;named.sh</span><br><span class=\"line\">export PATH&#x3D;&#x2F;usr&#x2F;local&#x2F;bind9&#x2F;bin:&#x2F;usr&#x2F;local&#x2F;bind9&#x2F;sbin:$PATH</span><br><span class=\"line\"></span><br><span class=\"line\">. &#x2F;etc&#x2F;profile.d&#x2F;named.sh</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"导出库文件搜索路径\"><a href=\"#导出库文件搜索路径\" class=\"headerlink\" title=\"导出库文件搜索路径\"></a>导出库文件搜索路径</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ vim &#x2F;etc&#x2F;ld.so.conf.d&#x2F;named.conf</span><br><span class=\"line\">&#x2F;usr&#x2F;local&#x2F;bind9&#x2F;lib</span><br><span class=\"line\">$ ldconfig -v</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"导出头文件搜索路径\"><a href=\"#导出头文件搜索路径\" class=\"headerlink\" title=\"导出头文件搜索路径\"></a>导出头文件搜索路径</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ ln -sv &#x2F;usr&#x2F;local&#x2F;bind9&#x2F;include &#x2F;usr&#x2F;include&#x2F;named</span><br><span class=\"line\"></span><br><span class=\"line\">&quot;&#x2F;usr&#x2F;include&#x2F;named&quot; -&gt; &quot;&#x2F;usr&#x2F;local&#x2F;bind9&#x2F;include&quot;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"导出帮助文档搜索路径（非必须）\"><a href=\"#导出帮助文档搜索路径（非必须）\" class=\"headerlink\" title=\"导出帮助文档搜索路径（非必须）\"></a>导出帮助文档搜索路径（非必须）</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ vim &#x2F;etc&#x2F;man.config </span><br><span class=\"line\">MANPATH &#x2F;usr&#x2F;local&#x2F;bind9&#x2F;share&#x2F;man</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"配置\"><a href=\"#配置\" class=\"headerlink\" title=\"配置\"></a>配置</h2><h3 id=\"准备\"><a href=\"#准备\" class=\"headerlink\" title=\"准备\"></a>准备</h3><p>创建服务专用账户named，禁止本地登陆户</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">useradd -d &#x2F;usr&#x2F;local&#x2F;bind9 -s &#x2F;sbin&#x2F;nologin named</span><br></pre></td></tr></table></figure>\n\n<p>接下来我们更改所有配置文件的用户为named用户</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir &#x2F;run&#x2F;named</span><br><span class=\"line\">mkdir -p &#x2F;var&#x2F;named&#x2F;&#123;dynamic,data,zone&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>在联网的情况下直接将查询根的结果导入根区域配置文件，我们在named.rfc1912.zones文件中配置了根文件named.ca</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ dig -t NS . &gt; &#x2F;var&#x2F;named&#x2F;named.ca</span><br></pre></td></tr></table></figure>\n\n\n<h3 id=\"主配置\"><a href=\"#主配置\" class=\"headerlink\" title=\"主配置\"></a>主配置</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ cd &#x2F;etc&#x2F;named</span><br><span class=\"line\">$ vim named.conf</span><br><span class=\"line\"></span><br><span class=\"line\">options &#123;</span><br><span class=\"line\">  listen-on port 53 &#123; any; &#125;;</span><br><span class=\"line\">  listen-on-v6 port 53 &#123; ::1; &#125;;</span><br><span class=\"line\">  directory &quot;&#x2F;var&#x2F;named&quot;;   # zone配置根目录</span><br><span class=\"line\">  dump-file &quot;&#x2F;var&#x2F;named&#x2F;data&#x2F;cache_dump.db&quot;;</span><br><span class=\"line\">  statistics-file &quot;&#x2F;var&#x2F;named&#x2F;data&#x2F;named_stats.txt&quot;;</span><br><span class=\"line\">  memstatistics-file &quot;&#x2F;var&#x2F;named&#x2F;data&#x2F;named_mem_stats.txt&quot;;</span><br><span class=\"line\">  allow-query &#123; any; &#125;;</span><br><span class=\"line\">  recursion yes; # 允许递归查询</span><br><span class=\"line\">  allow-new-zones yes;  #允许添加zone</span><br><span class=\"line\">  max-cache-size 70%;</span><br><span class=\"line\">  dnssec-validation no;   # 指定是否提供使用dnssec认证的资源记录.默认为yes.</span><br><span class=\"line\"></span><br><span class=\"line\">  forward first;</span><br><span class=\"line\">  forwarders &#123;</span><br><span class=\"line\">    114.114.114.114; # 电信DNS</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">  &#x2F;* Path to ISC DLV key *&#x2F;</span><br><span class=\"line\">  bindkeys-file &quot;&#x2F;etc&#x2F;named&#x2F;bind.keys&quot;;</span><br><span class=\"line\"></span><br><span class=\"line\">  managed-keys-directory &quot;&#x2F;var&#x2F;named&#x2F;dynamic&quot;;</span><br><span class=\"line\"></span><br><span class=\"line\">  pid-file &quot;&#x2F;run&#x2F;named&#x2F;named.pid&quot;;</span><br><span class=\"line\">  session-keyfile &quot;&#x2F;run&#x2F;named&#x2F;session.key&quot;;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">logging &#123;</span><br><span class=\"line\">  channel queries_log &#123;</span><br><span class=\"line\">    file &quot;data&#x2F;named.run&quot; versions 3 size 300m; # 这里的路径是相对于上面的directory路径</span><br><span class=\"line\">    print-time yes;                  # 日志文件每300MB切割一次</span><br><span class=\"line\">    print-category yes;</span><br><span class=\"line\">    print-severity yes;</span><br><span class=\"line\">    severity info;</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">  channel query-errors_log &#123;</span><br><span class=\"line\">    file &quot;data&#x2F;query-errors.run&quot; versions 5 size 20m;</span><br><span class=\"line\">    print-time yes;</span><br><span class=\"line\">    print-category yes;</span><br><span class=\"line\">    print-severity yes;</span><br><span class=\"line\">    severity dynamic;</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">  category queries &#123; queries_log; &#125;;</span><br><span class=\"line\">  category resolver &#123; queries_log; &#125;;</span><br><span class=\"line\">  category query-errors &#123;query-errors_log; &#125;;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">zone &quot;.&quot; IN &#123; # 根域名</span><br><span class=\"line\">  type hint;</span><br><span class=\"line\">  file &quot;named.ca&quot;;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">#include &quot;&#x2F;etc&#x2F;named&#x2F;named.rfc1912.zones&quot;;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"rndc配置\"><a href=\"#rndc配置\" class=\"headerlink\" title=\"rndc配置\"></a>rndc配置</h3><p>rndc是一个管理程序，可以用它来刷新配置，停止服务，强制同步等</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rndc-confgen  &gt; &#x2F;etc&#x2F;named&#x2F;rndc.conf</span><br></pre></td></tr></table></figure>\n<p>打开rndc.conf文件，找到# Use with the following in named.conf, adjusting the allow list as needed:注释，复制其下所有行到named.conf并放开注释。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tail -10 &#x2F;etc&#x2F;named&#x2F;rndc.conf | head -9 | sed s&#x2F;#\\ &#x2F;&#x2F;g &gt; named.conf</span><br></pre></td></tr></table></figure>\n<p>最终的named.conf文件像下面这样</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">key &quot;rndc-key&quot; &#123;</span><br><span class=\"line\">  algorithm hmac-sha256;</span><br><span class=\"line\">  secret &quot;...&quot;;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">controls &#123;</span><br><span class=\"line\">  inet 127.0.0.1 port 953</span><br><span class=\"line\">  allow &#123; 127.0.0.1; &#125; keys &#123; &quot;rndc-key&quot;; &#125;;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">options &#123;</span><br><span class=\"line\">  ...</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">logging &#123;</span><br><span class=\"line\">  ...</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">zone &quot;.&quot; IN &#123; # 根</span><br><span class=\"line\">  type hint;</span><br><span class=\"line\">  file &quot;named.ca&quot;;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">#include &quot;&#x2F;etc&#x2F;named&#x2F;named.rfc1912.zones&quot;;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"zones-配置\"><a href=\"#zones-配置\" class=\"headerlink\" title=\"zones 配置\"></a>zones 配置</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ vim &#x2F;var&#x2F;named&#x2F;abc.com.zone</span><br><span class=\"line\"></span><br><span class=\"line\">$TTL 10M  ;time to live  信息存放在高速缓存中的时间长度，以秒为单位</span><br><span class=\"line\">@       IN      SOA     abc.com.      admin.abc.com. (</span><br><span class=\"line\">                        1   ;序列号</span><br><span class=\"line\">                        1H  ;1小时后刷新</span><br><span class=\"line\">                        5M  ;15分钟后重试</span><br><span class=\"line\">                        7D  ;1星期后过期</span><br><span class=\"line\">                        1D );否定缓存TTL为1天</span><br><span class=\"line\">        IN      NS      ns.abc.com.</span><br><span class=\"line\">ns      IN      A       192.168.7.134</span><br><span class=\"line\">www       IN      A      192.168.7.133</span><br><span class=\"line\">@         IN      A      192.168.7.133</span><br><span class=\"line\">api       IN      A      192.168.7.133</span><br><span class=\"line\">a         IN      A      192.168.7.134</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"启动\"><a href=\"#启动\" class=\"headerlink\" title=\"启动\"></a>启动</h2><h3 id=\"权限配置\"><a href=\"#权限配置\" class=\"headerlink\" title=\"权限配置\"></a>权限配置</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">chown -R named:named &#x2F;usr&#x2F;local&#x2F;bind9&#x2F;</span><br><span class=\"line\">chown -R named:named &#x2F;etc&#x2F;named</span><br><span class=\"line\">chown -R named:named &#x2F;var&#x2F;named&#x2F;</span><br><span class=\"line\">chown -R named:named &#x2F;run&#x2F;named</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"检查配置\"><a href=\"#检查配置\" class=\"headerlink\" title=\"检查配置\"></a>检查配置</h3><p>实时日志</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">named -u named -g</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim  &#x2F;usr&#x2F;lib&#x2F;systemd&#x2F;system&#x2F;named.service</span><br><span class=\"line\"></span><br><span class=\"line\">[Unit]</span><br><span class=\"line\">Description&#x3D;Berkeley Internet Name Domain (DNS)</span><br><span class=\"line\">Wants&#x3D;nss-lookup.target</span><br><span class=\"line\">Wants&#x3D;named-setup-rndc.service</span><br><span class=\"line\">Before&#x3D;nss-lookup.target</span><br><span class=\"line\">After&#x3D;network.target</span><br><span class=\"line\">After&#x3D;named-setup-rndc.service</span><br><span class=\"line\"></span><br><span class=\"line\">[Service]</span><br><span class=\"line\">Type&#x3D;forking</span><br><span class=\"line\">Environment&#x3D;NAMEDCONF&#x3D;&#x2F;etc&#x2F;named&#x2F;named.conf</span><br><span class=\"line\">EnvironmentFile&#x3D;-&#x2F;etc&#x2F;sysconfig&#x2F;named</span><br><span class=\"line\">Environment&#x3D;KRB5_KTNAME&#x3D;&#x2F;etc&#x2F;named.keytab</span><br><span class=\"line\">PIDFile&#x3D;&#x2F;run&#x2F;named&#x2F;named.pid</span><br><span class=\"line\"></span><br><span class=\"line\">ExecStartPre&#x3D;&#x2F;bin&#x2F;bash -c &#39;if [ ! &quot;$DISABLE_ZONE_CHECKING&quot; &#x3D;&#x3D; &quot;yes&quot; ]; then &#x2F;usr&#x2F;local&#x2F;bind9&#x2F;sbin&#x2F;named-checkconf -z &quot;$NAMEDCONF&quot;; else echo &quot;Checking of zone files is disabled&quot;; fi&#39;</span><br><span class=\"line\">ExecStart&#x3D;&#x2F;usr&#x2F;local&#x2F;bind9&#x2F;sbin&#x2F;named -u named -c $&#123;NAMEDCONF&#125; $OPTIONS</span><br><span class=\"line\"></span><br><span class=\"line\">ExecReload&#x3D;&#x2F;bin&#x2F;sh -c &#39;&#x2F;usr&#x2F;local&#x2F;bind9&#x2F;sbin&#x2F;rndc reload &gt; &#x2F;dev&#x2F;null 2&gt;&amp;1 || &#x2F;bin&#x2F;kill -HUP $MAINPID&#39;</span><br><span class=\"line\"></span><br><span class=\"line\">ExecStop&#x3D;&#x2F;bin&#x2F;sh -c &#39;&#x2F;usr&#x2F;local&#x2F;bind9&#x2F;sbin&#x2F;rndc stop &gt; &#x2F;dev&#x2F;null 2&gt;&amp;1 || &#x2F;bin&#x2F;kill -TERM $MAINPID&#39;</span><br><span class=\"line\"></span><br><span class=\"line\">PrivateTmp&#x3D;true</span><br><span class=\"line\"></span><br><span class=\"line\">[Install]</span><br><span class=\"line\">WantedBy&#x3D;multi-user.target</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl status named</span><br><span class=\"line\">systemctl enable named</span><br><span class=\"line\">systemctl start named</span><br><span class=\"line\">systemctl stop named</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"测试\"><a href=\"#测试\" class=\"headerlink\" title=\"测试\"></a>测试</h2><p>主配置文件</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim named.conf</span><br><span class=\"line\"></span><br><span class=\"line\">zone &quot;test.com&quot; IN &#123;</span><br><span class=\"line\">  type master;</span><br><span class=\"line\">  file &quot;zone&#x2F;test.com.zone&quot;;</span><br><span class=\"line\">  allow-update &#123; none; &#125;;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<p>区域配置文件</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim &#x2F;var&#x2F;named&#x2F;zone&#x2F;test.com.zone</span><br><span class=\"line\"></span><br><span class=\"line\">$TTL      86400</span><br><span class=\"line\">@     IN SOA      test.com root.test.com (</span><br><span class=\"line\">                                  42                ; serial (d. adams)</span><br><span class=\"line\">                                  3H                ; refresh</span><br><span class=\"line\">                                  15M               ; retry</span><br><span class=\"line\">                                  1W                ; expiry</span><br><span class=\"line\">                                  1D )              ; minimum</span><br><span class=\"line\">                IN NS           @</span><br><span class=\"line\">                IN A            127.0.0.1</span><br><span class=\"line\">                IN AAAA         ::1</span><br><span class=\"line\">www IN A 172.16.100.200</span><br></pre></td></tr></table></figure>\n\n<p>重启</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl restart named</span><br></pre></td></tr></table></figure>\n\n<p>解析测试</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nslookup </span><br><span class=\"line\"></span><br><span class=\"line\">&gt; server 10.200.192.13</span><br><span class=\"line\">Default server: 10.200.192.13</span><br><span class=\"line\">Address: 10.200.192.13#53</span><br><span class=\"line\">&gt; www.test.com</span><br><span class=\"line\">Server:\t\t10.200.192.13</span><br><span class=\"line\">Address:\t10.200.192.13#53</span><br><span class=\"line\"></span><br><span class=\"line\">Name:\twww.test.com</span><br><span class=\"line\">Address: 172.16.100.200</span><br><span class=\"line\">&gt; exit</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"rndc\"><a href=\"#rndc\" class=\"headerlink\" title=\"rndc\"></a>rndc</h2><p>rndc（Remote Name Domain Controllerr）是一个远程管理bind的工具，通过这个工具可以在本地或者远程了解当前服务器的运行状况，也可以对服务器进行关闭、重载、刷新缓存、增加删除zone等操作。</p>\n<p>使用rndc可以在不停止DNS服务器工作的情况进行数据的更新，使修改后的配置文件生效。在实际情况下，DNS服务器是非常繁忙的，任何短时间的停顿都会给用户的使用带来影响。因此，使用rndc工具可以使DNS服务器更好地为用户提供服务。在使用rndc管理bind前需要使用rndc生成一对密钥文件，一半保存于rndc的配置文件中，另一半保存于bind主配置文件中。rndc的配置文件为/etc/rndc.conf，在CentOS或者RHEL中，rndc的密钥保存在/etc/rndc.key文件中。rndc默认监听在953号端口（TCP），其实在bind9中rndc默认就是可以使用，不需要配置密钥文件。</p>\n<p>rndc与DNS服务器实行连接时，需要通过数字证书进行认证，而不是传统的用户名/密码方式。在当前版本下，rndc和named都只支持HMAC-MD5认证算法，在通信两端使用预共享密钥。在当前版本的rndc 和 named中，唯一支持的认证算法是HMAC-MD5，在连接的两端使用共享密钥。它为命令请求和名字服务器的响应提供 TSIG类型的认证。所有经由通道发送的命令都必须被一个服务器所知道的 key_id 签名。为了生成双方都认可的密钥，可以使用rndc-confgen命令产生密钥和相应的配置，再把这些配置分别放入named.conf和rndc的配置文件rndc.conf中。</p>\n<h3 id=\"更新key\"><a href=\"#更新key\" class=\"headerlink\" title=\"更新key\"></a>更新key</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">生成 key 文件</span><br><span class=\"line\">rndc-confgen -a</span><br><span class=\"line\"></span><br><span class=\"line\">wrote key file &quot;&#x2F;etc&#x2F;rndc.key&quot;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rndc status</span><br><span class=\"line\"></span><br><span class=\"line\">rndc: connection to remote host closed</span><br><span class=\"line\">This may indicate that</span><br><span class=\"line\">* the remote server is using an older version of the command protocol,</span><br><span class=\"line\">* this host is not authorized to connect,</span><br><span class=\"line\">* the clocks are not synchronized,</span><br><span class=\"line\">* the key signing algorithm is incorrect, or</span><br><span class=\"line\">* the key is invalid.</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"产生-etc-rndc-conf文件\"><a href=\"#产生-etc-rndc-conf文件\" class=\"headerlink\" title=\"产生/etc/rndc.conf文件\"></a>产生/etc/rndc.conf文件</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rndc-confgen &gt; &#x2F;etc&#x2F;rndc.conf  </span><br></pre></td></tr></table></figure>\n\n<h3 id=\"配置-named-conf使用rndc秘钥\"><a href=\"#配置-named-conf使用rndc秘钥\" class=\"headerlink\" title=\"配置 named.conf使用rndc秘钥\"></a>配置 named.conf使用rndc秘钥</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tail -10 &#x2F;etc&#x2F;named&#x2F;rndc.conf | head -9 | sed s&#x2F;#\\ &#x2F;&#x2F;g &gt;&gt; named.conf</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cat &#x2F;etc&#x2F;named&#x2F;named.conf </span><br><span class=\"line\"></span><br><span class=\"line\">key &quot;rndc-key&quot; &#123;</span><br><span class=\"line\">    algorithm hmac-sha256;</span><br><span class=\"line\">    secret &quot;1PX8tBVLFLrCcIhkcQ5r0t9hiPSihtakLkj3s2k3OeU&#x3D;&quot;;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">controls &#123;</span><br><span class=\"line\">  inet 127.0.0.1 port 953</span><br><span class=\"line\">  allow &#123; 127.0.0.1; &#125; keys &#123; &quot;rndc-key&quot;; &#125;;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"测试-RNDC-设置\"><a href=\"#测试-RNDC-设置\" class=\"headerlink\" title=\"测试 RNDC 设置\"></a>测试 RNDC 设置</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rndc status</span><br><span class=\"line\"></span><br><span class=\"line\">version: BIND 9.16.12 (Stable Release) &lt;id:aeb943d&gt;</span><br><span class=\"line\">running on hz01-base-dns-01: Linux x86_64 3.10.0-1160.25.1.el7.x86_64 #1 SMP Wed Apr 28 21:49:45 UTC 2021</span><br><span class=\"line\">boot time: Thu, 03 Jun 2021 02:45:44 GMT</span><br><span class=\"line\">last configured: Thu, 03 Jun 2021 09:10:43 GMT</span><br><span class=\"line\">configuration file: &#x2F;etc&#x2F;named&#x2F;named.conf</span><br><span class=\"line\">CPUs found: 4</span><br><span class=\"line\">worker threads: 4</span><br><span class=\"line\">UDP listeners per interface: 4</span><br><span class=\"line\">number of zones: 105 (99 automatic)</span><br><span class=\"line\">debug level: 0</span><br><span class=\"line\">xfers running: 0</span><br><span class=\"line\">xfers deferred: 0</span><br><span class=\"line\">soa queries in progress: 0</span><br><span class=\"line\">query logging is ON</span><br><span class=\"line\">recursive clients: 0&#x2F;900&#x2F;1000</span><br><span class=\"line\">tcp clients: 0&#x2F;150</span><br><span class=\"line\">TCP high-water: 2</span><br><span class=\"line\">server is up and running</span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"nsupdate\"><a href=\"#nsupdate\" class=\"headerlink\" title=\"nsupdate\"></a>nsupdate</h2><p>nsupdate工具是一个交互式的命令工具, 对应的区配置部分需要配置allow-update语句:  allow-update { any; };</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">zone &quot;test.com&quot; &#123;</span><br><span class=\"line\">\ttype master;</span><br><span class=\"line\">\tallow-update &#123; any; &#125;;</span><br><span class=\"line\">\tfile &quot;test.com.zone&quot;;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nsupdate</span><br><span class=\"line\"></span><br><span class=\"line\">&gt; server 127.0.0.1</span><br><span class=\"line\">&gt; zone test.com</span><br><span class=\"line\">&gt; update add xxx.test.com 300 A 3.3.3.3</span><br><span class=\"line\">&gt; update detale  abc.test.com 300 A</span><br><span class=\"line\">&gt; send</span><br><span class=\"line\">&gt; show</span><br><span class=\"line\">&gt; quit</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"nsupdate-参数\"><a href=\"#nsupdate-参数\" class=\"headerlink\" title=\"nsupdate 参数\"></a>nsupdate 参数</h3><p>-d 调试模式。<br>-k 从keyfile文件中读取密钥信息。<br>-y keyname是密钥的名称,secret是以base64编码的密钥。<br>-v 使用TCP协议进行nsupdate.默认是使用UDP协议。</p>\n<p>命令格式:<br>server servername [ port ]<br>送请求到servername服务器的port端口.如果不指定servername,nsupdate将把请求发送给当前去的主DNS服务器.<br>如:<br>server 192.168.36.54 53</p>\n<p>local address [ port ]           发送nsupdate请求时,使用的本地地址和端口.<br>zone zonename                    指定需要更新的区名.<br>class classname                 指定默认类别.默认的类别是IN.<br>key name secret                 指定所有更新使用的密钥.<br>prereq nxdomain domain-name               要求domain-name中不存在任何资源记录.<br>prereq yxdomain domain-name                 要求domain-name存在,并且至少包含有一条记录.<br>prereq nxrrset domain-name [ class ] type        要求domain-name中没有指定类别的资源记录.<br>prereq yxrrset domain-name [ class ] type   要求存在一条指定的资源记录.类别和domain-name必须存在.<br>update delete domain-name [ ttl ] [ class ] [ type [ data… ] ]     删除domain-name的资源记录.如果指定了type和data,仅删除匹配的记录.</p>\n<p>update add domain-name ttl [ class ] type data…      添加一条资源记录.<br>show      显示自send命令后,所有的要求信息和更新请求.<br>send     将要求信息和更新请求发送到DNS服务器.等同于输入一个空行.</p>\n<h3 id=\"通过TSIG-key实现nsupdate功能\"><a href=\"#通过TSIG-key实现nsupdate功能\" class=\"headerlink\" title=\"通过TSIG key实现nsupdate功能\"></a>通过TSIG key实现nsupdate功能</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1、使用&#96; dnssec-keygen -a HMAC-MD5 -b 128 -n USER testkey &#96;命令来生成密钥。</span><br><span class=\"line\">  dnssec-keygen：用来生成更新密钥。</span><br><span class=\"line\">    -a HMAC-MD5：采用HMAC-MD5加密算法。</span><br><span class=\"line\">    -b 128：生成的密钥长度为128位。</span><br><span class=\"line\">    -n USER testkey：密钥的用户名为testkey。</span><br><span class=\"line\"></span><br><span class=\"line\">2、密钥生成后，会在当前目录下自动生成两个密钥文件***.+157+xxx.key和***.+157+xxx.private。</span><br><span class=\"line\">3、查看两个密钥文件的内容：</span><br><span class=\"line\">  cat ***.+157+xxx.key</span><br><span class=\"line\">  cat ***.+157+xxx.private</span><br><span class=\"line\">4、通过同样的方法生成test2key。</span><br><span class=\"line\">5、添加密钥信息到DNS主配置文件中 </span><br><span class=\"line\">6、将test.com区域中的allow-update &#123; none; &#125;中的&quot;none&quot;改成&quot;key testkey&quot;;</span><br><span class=\"line\">  将&quot;none&quot;改成&quot;key testkey&quot;的意思是指明采用&quot;key testkey&quot;作为密钥的用户可以动态更新“t</span><br></pre></td></tr></table></figure>\n<p>例子:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">view &quot;view-test&quot; in&#123;</span><br><span class=\"line\">\tmatch-clients&#123;</span><br><span class=\"line\">\t\tkey testkey;</span><br><span class=\"line\">\t\tacl1;</span><br><span class=\"line\">\t\t&#125;;&#x2F;&#x2F;keytestkey;以及acl1;zone&quot;test.com&quot;&#123;</span><br><span class=\"line\">\ttype master;</span><br><span class=\"line\">\tfile &quot;test.zone&quot;;</span><br><span class=\"line\">\tallow-update&#123;</span><br><span class=\"line\">\t\t\tkey testkey;</span><br><span class=\"line\">\t\t&#125;;</span><br><span class=\"line\">\t&#125;;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nsupdate 增删改查</span><br><span class=\"line\">server 192.168.0.49 53</span><br><span class=\"line\">删除</span><br><span class=\"line\">    删除NS记录</span><br><span class=\"line\">        update delete huiselantian.com  IN NS ns2.huiselantian.com.</span><br><span class=\"line\">        update delete huiselantian.com  IN NS ns3.huiselantian.com.</span><br><span class=\"line\">        update delete huiselantian.com  IN NS ns4.huiselantian.com.</span><br><span class=\"line\">        update delete huiselantian.com  IN NS ns5.huiselantian.com.</span><br><span class=\"line\">    删除A记录</span><br><span class=\"line\">        update delete ns2.huiselantian.com  A</span><br><span class=\"line\">        update delete ns3.huiselantian.com  A</span><br><span class=\"line\">        update delete ns4.huiselantian.com  A</span><br><span class=\"line\">        update delete ns5.huiselantian.com  A</span><br><span class=\"line\">增加</span><br><span class=\"line\">    增加NS记录</span><br><span class=\"line\">        update add huiselantian.com 600 IN NS ns2.huiselantian.com.</span><br><span class=\"line\">        update add huiselantian.com 600 IN NS ns3.huiselantian.com.</span><br><span class=\"line\">        update add huiselantian.com 600 IN NS ns4.huiselantian.com.    </span><br><span class=\"line\">    增加A记录</span><br><span class=\"line\">        update add ns3.huiselantian.com 600 IN A 192.168.0.236</span><br><span class=\"line\">        update add ns4.huiselantian.com 600 IN A 192.168.0.237</span><br><span class=\"line\">        update add ns5.huiselantian.com 600 IN A 192.168.1.125    </span><br><span class=\"line\">查询：</span><br><span class=\"line\">    查询NS记录</span><br><span class=\"line\">         dig NS @192.168.0.49 huiselantian.com </span><br><span class=\"line\">    查询A记录</span><br><span class=\"line\">        dig A @192.168.0.49 ns1.huiselantian.com</span><br><span class=\"line\">    查询SOA记录</span><br><span class=\"line\">        dig SOA @192.168.0.49 huiselantian.com</span><br><span class=\"line\">改：</span><br><span class=\"line\">    先删除后新增</span><br><span class=\"line\">send</span><br><span class=\"line\">nsupdate处理ns的时候(如不规范,会报错)</span><br><span class=\"line\">    添加：</span><br><span class=\"line\">        先添加A 再添加NS记录 </span><br><span class=\"line\">    删除</span><br><span class=\"line\">        先删除ns 再删除A记录</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>"},{"title":"centos7安装confluence 6.12","date":"2021-03-15T08:16:00.000Z","_content":"  \n  \n摘要:centos7安装confluence 6.12 \n<!-- more -->\n\n\n## 环境\n```\ncentos 7.7\nJDK 1.8\nmysql 5.7(配置文件my.cnf中设置了UTF-8)\n```\n\n## 数据库初始化\n```\nMysql> SET GLOBAL tx_isolation='READ-COMMITTED';\nMysql> CREATE DATABASE confluence CHARACTER SET utf8 COLLATE utf8_bin;\nMysql> grant all on confluence.* to confluence@\"%\" identified by 'confluence';\nMysql> grant all on confluence.* to confluence@\"%\";\nMysql> FLUSH PRIVILEGES;\n```\n\n## 获取confluence\n```\nwget https://product-downloads.atlassian.com/software/confluence/downloads/atlassian-confluence-6.12.0-x64.bin\nchmod +x atlassian-confluence-6.12-x64.bin\n```\n\n## 安装\n```\n./atlassian-confluence-6.12.0-x64.bin\n```\n\n```\nUnpacking JRE ...\nStarting Installer ...\n\nThis will install Confluence 6.12.0 on your computer.\nOK [o, Enter], Cancel [c]\no       # 回车或按 o\nClick Next to continue, or Cancel to exit Setup.\n\nChoose the appropriate installation or upgrade option.\nPlease choose one of the following:\nExpress Install (uses default settings) [1], \nCustom Install (recommended for advanced users) [2, Enter], \nUpgrade an existing Confluence installation [3]\n1     # 选 1\n\nSee where Confluence will be installed and the settings that will be used.\nInstallation Directory: /opt/atlassian/confluence \nHome Directory: /var/atlassian/application-data/confluence \nHTTP Port: 8090 \nRMI Port: 8000 \nInstall as service: Yes \nInstall [i, Enter], Exit [e]\ni    # 回车 或按 i\n\nExtracting files ...\n\n\nPlease wait a few moments while we configure Confluence.\n\nInstallation of Confluence 6.12.0 is complete\nStart Confluence now?\nYes [y, Enter], No [n]\ny    # 回车 或按 y\n\nPlease wait a few moments while Confluence starts up.\nLaunching Confluence ...\n\nInstallation of Confluence 6.12.0 is complete\nYour installation of Confluence 6.12.0 is now ready and can be accessed via\nyour browser.\nConfluence 6.12.0 can be accessed at http://localhost:8090\nFinishing installation ...\n```\n\n## confluence控制\n```\ncd /opt/atlassian/confluence/bin/\n./stop-confluence.sh       # 停止\n./start-confluence.sh      # 启动\n```\n\n## 破解\n\n停止\n```\ncd /opt/atlassian/confluence/bin/\n./stop-confluence.sh       # 停止\n```\n替换文件 和上传 mysql-jdbc\n```\n\n```\n\n<hr>\n\n- 1： /opt/atlassian/confluence/confluence/WEB-INF/lib/atlassian-extras-decoder-v2-3.4.1.jar文件到本地\n- 2：本地重命名为atlassian-extras-2.4.jar\n- 3：打开破解工具confluence_keygen.jar（本地需先安装java）\n- 4：选择.patch!找atlassian-extras-2.4.jar打开\n- 5：可以看到atlassian-extras-2.4.jar和atlassian-extras-2.4.bak两个文件，这里atlassian-extras-2.4.jar已经是破解好的了，将atlassian-extras-2.4.jar名字改回来atlassian-extras-decoder-v2-3.4.1.jar\n- 6：将atlassian-extras-decoder-v2-3.4.1.jar上传到服务器原目录\n-----\n## web配置\n```\n浏览器访问http://localhost:8090\n\n1、右上角选择中文语言\n   选择 Production Installation\n2、下一步\n3、授权码\n复制服务器ID到confluence_keygen.jar 中的server ID，点击.gen!,将生成的key粘贴到浏览器\n4、选择我的数据库\n5、选择mysql,填入mysql连接信息\n6、选择空白站点\n7、选择 在confluence 中管理用户和组\n8、填写管理员账号信息\n\n```\n\n\n\n","source":"_posts/install/centos7安装confluence612.md","raw":"---\ntitle: centos7安装confluence 6.12\ndate: 2021-03-15 16:16\ncategories:\n- centos7\ntags:\n- confluence\n---\n  \n  \n摘要:centos7安装confluence 6.12 \n<!-- more -->\n\n\n## 环境\n```\ncentos 7.7\nJDK 1.8\nmysql 5.7(配置文件my.cnf中设置了UTF-8)\n```\n\n## 数据库初始化\n```\nMysql> SET GLOBAL tx_isolation='READ-COMMITTED';\nMysql> CREATE DATABASE confluence CHARACTER SET utf8 COLLATE utf8_bin;\nMysql> grant all on confluence.* to confluence@\"%\" identified by 'confluence';\nMysql> grant all on confluence.* to confluence@\"%\";\nMysql> FLUSH PRIVILEGES;\n```\n\n## 获取confluence\n```\nwget https://product-downloads.atlassian.com/software/confluence/downloads/atlassian-confluence-6.12.0-x64.bin\nchmod +x atlassian-confluence-6.12-x64.bin\n```\n\n## 安装\n```\n./atlassian-confluence-6.12.0-x64.bin\n```\n\n```\nUnpacking JRE ...\nStarting Installer ...\n\nThis will install Confluence 6.12.0 on your computer.\nOK [o, Enter], Cancel [c]\no       # 回车或按 o\nClick Next to continue, or Cancel to exit Setup.\n\nChoose the appropriate installation or upgrade option.\nPlease choose one of the following:\nExpress Install (uses default settings) [1], \nCustom Install (recommended for advanced users) [2, Enter], \nUpgrade an existing Confluence installation [3]\n1     # 选 1\n\nSee where Confluence will be installed and the settings that will be used.\nInstallation Directory: /opt/atlassian/confluence \nHome Directory: /var/atlassian/application-data/confluence \nHTTP Port: 8090 \nRMI Port: 8000 \nInstall as service: Yes \nInstall [i, Enter], Exit [e]\ni    # 回车 或按 i\n\nExtracting files ...\n\n\nPlease wait a few moments while we configure Confluence.\n\nInstallation of Confluence 6.12.0 is complete\nStart Confluence now?\nYes [y, Enter], No [n]\ny    # 回车 或按 y\n\nPlease wait a few moments while Confluence starts up.\nLaunching Confluence ...\n\nInstallation of Confluence 6.12.0 is complete\nYour installation of Confluence 6.12.0 is now ready and can be accessed via\nyour browser.\nConfluence 6.12.0 can be accessed at http://localhost:8090\nFinishing installation ...\n```\n\n## confluence控制\n```\ncd /opt/atlassian/confluence/bin/\n./stop-confluence.sh       # 停止\n./start-confluence.sh      # 启动\n```\n\n## 破解\n\n停止\n```\ncd /opt/atlassian/confluence/bin/\n./stop-confluence.sh       # 停止\n```\n替换文件 和上传 mysql-jdbc\n```\n\n```\n\n<hr>\n\n- 1： /opt/atlassian/confluence/confluence/WEB-INF/lib/atlassian-extras-decoder-v2-3.4.1.jar文件到本地\n- 2：本地重命名为atlassian-extras-2.4.jar\n- 3：打开破解工具confluence_keygen.jar（本地需先安装java）\n- 4：选择.patch!找atlassian-extras-2.4.jar打开\n- 5：可以看到atlassian-extras-2.4.jar和atlassian-extras-2.4.bak两个文件，这里atlassian-extras-2.4.jar已经是破解好的了，将atlassian-extras-2.4.jar名字改回来atlassian-extras-decoder-v2-3.4.1.jar\n- 6：将atlassian-extras-decoder-v2-3.4.1.jar上传到服务器原目录\n-----\n## web配置\n```\n浏览器访问http://localhost:8090\n\n1、右上角选择中文语言\n   选择 Production Installation\n2、下一步\n3、授权码\n复制服务器ID到confluence_keygen.jar 中的server ID，点击.gen!,将生成的key粘贴到浏览器\n4、选择我的数据库\n5、选择mysql,填入mysql连接信息\n6、选择空白站点\n7、选择 在confluence 中管理用户和组\n8、填写管理员账号信息\n\n```\n\n\n\n","slug":"install/centos7安装confluence612","published":1,"updated":"2021-06-18T08:07:11.192Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cku6979zb003d00uhgej2884m","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><p>摘要:centos7安装confluence 6.12 </p>\n<span id=\"more\"></span>\n\n\n<h2 id=\"环境\"><a href=\"#环境\" class=\"headerlink\" title=\"环境\"></a>环境</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">centos 7.7</span><br><span class=\"line\">JDK 1.8</span><br><span class=\"line\">mysql 5.7(配置文件my.cnf中设置了UTF-8)</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"数据库初始化\"><a href=\"#数据库初始化\" class=\"headerlink\" title=\"数据库初始化\"></a>数据库初始化</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Mysql&gt; SET GLOBAL tx_isolation&#x3D;&#39;READ-COMMITTED&#39;;</span><br><span class=\"line\">Mysql&gt; CREATE DATABASE confluence CHARACTER SET utf8 COLLATE utf8_bin;</span><br><span class=\"line\">Mysql&gt; grant all on confluence.* to confluence@&quot;%&quot; identified by &#39;confluence&#39;;</span><br><span class=\"line\">Mysql&gt; grant all on confluence.* to confluence@&quot;%&quot;;</span><br><span class=\"line\">Mysql&gt; FLUSH PRIVILEGES;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"获取confluence\"><a href=\"#获取confluence\" class=\"headerlink\" title=\"获取confluence\"></a>获取confluence</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget https:&#x2F;&#x2F;product-downloads.atlassian.com&#x2F;software&#x2F;confluence&#x2F;downloads&#x2F;atlassian-confluence-6.12.0-x64.bin</span><br><span class=\"line\">chmod +x atlassian-confluence-6.12-x64.bin</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">.&#x2F;atlassian-confluence-6.12.0-x64.bin</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Unpacking JRE ...</span><br><span class=\"line\">Starting Installer ...</span><br><span class=\"line\"></span><br><span class=\"line\">This will install Confluence 6.12.0 on your computer.</span><br><span class=\"line\">OK [o, Enter], Cancel [c]</span><br><span class=\"line\">o       # 回车或按 o</span><br><span class=\"line\">Click Next to continue, or Cancel to exit Setup.</span><br><span class=\"line\"></span><br><span class=\"line\">Choose the appropriate installation or upgrade option.</span><br><span class=\"line\">Please choose one of the following:</span><br><span class=\"line\">Express Install (uses default settings) [1], </span><br><span class=\"line\">Custom Install (recommended for advanced users) [2, Enter], </span><br><span class=\"line\">Upgrade an existing Confluence installation [3]</span><br><span class=\"line\">1     # 选 1</span><br><span class=\"line\"></span><br><span class=\"line\">See where Confluence will be installed and the settings that will be used.</span><br><span class=\"line\">Installation Directory: &#x2F;opt&#x2F;atlassian&#x2F;confluence </span><br><span class=\"line\">Home Directory: &#x2F;var&#x2F;atlassian&#x2F;application-data&#x2F;confluence </span><br><span class=\"line\">HTTP Port: 8090 </span><br><span class=\"line\">RMI Port: 8000 </span><br><span class=\"line\">Install as service: Yes </span><br><span class=\"line\">Install [i, Enter], Exit [e]</span><br><span class=\"line\">i    # 回车 或按 i</span><br><span class=\"line\"></span><br><span class=\"line\">Extracting files ...</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">Please wait a few moments while we configure Confluence.</span><br><span class=\"line\"></span><br><span class=\"line\">Installation of Confluence 6.12.0 is complete</span><br><span class=\"line\">Start Confluence now?</span><br><span class=\"line\">Yes [y, Enter], No [n]</span><br><span class=\"line\">y    # 回车 或按 y</span><br><span class=\"line\"></span><br><span class=\"line\">Please wait a few moments while Confluence starts up.</span><br><span class=\"line\">Launching Confluence ...</span><br><span class=\"line\"></span><br><span class=\"line\">Installation of Confluence 6.12.0 is complete</span><br><span class=\"line\">Your installation of Confluence 6.12.0 is now ready and can be accessed via</span><br><span class=\"line\">your browser.</span><br><span class=\"line\">Confluence 6.12.0 can be accessed at http:&#x2F;&#x2F;localhost:8090</span><br><span class=\"line\">Finishing installation ...</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"confluence控制\"><a href=\"#confluence控制\" class=\"headerlink\" title=\"confluence控制\"></a>confluence控制</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd &#x2F;opt&#x2F;atlassian&#x2F;confluence&#x2F;bin&#x2F;</span><br><span class=\"line\">.&#x2F;stop-confluence.sh       # 停止</span><br><span class=\"line\">.&#x2F;start-confluence.sh      # 启动</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"破解\"><a href=\"#破解\" class=\"headerlink\" title=\"破解\"></a>破解</h2><p>停止</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd &#x2F;opt&#x2F;atlassian&#x2F;confluence&#x2F;bin&#x2F;</span><br><span class=\"line\">.&#x2F;stop-confluence.sh       # 停止</span><br></pre></td></tr></table></figure>\n<p>替换文件 和上传 mysql-jdbc</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<hr>\n\n<ul>\n<li>1： /opt/atlassian/confluence/confluence/WEB-INF/lib/atlassian-extras-decoder-v2-3.4.1.jar文件到本地</li>\n<li>2：本地重命名为atlassian-extras-2.4.jar</li>\n<li>3：打开破解工具confluence_keygen.jar（本地需先安装java）</li>\n<li>4：选择.patch!找atlassian-extras-2.4.jar打开</li>\n<li>5：可以看到atlassian-extras-2.4.jar和atlassian-extras-2.4.bak两个文件，这里atlassian-extras-2.4.jar已经是破解好的了，将atlassian-extras-2.4.jar名字改回来atlassian-extras-decoder-v2-3.4.1.jar</li>\n<li>6：将atlassian-extras-decoder-v2-3.4.1.jar上传到服务器原目录</li>\n</ul>\n<hr>\n<h2 id=\"web配置\"><a href=\"#web配置\" class=\"headerlink\" title=\"web配置\"></a>web配置</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">浏览器访问http:&#x2F;&#x2F;localhost:8090</span><br><span class=\"line\"></span><br><span class=\"line\">1、右上角选择中文语言</span><br><span class=\"line\">   选择 Production Installation</span><br><span class=\"line\">2、下一步</span><br><span class=\"line\">3、授权码</span><br><span class=\"line\">复制服务器ID到confluence_keygen.jar 中的server ID，点击.gen!,将生成的key粘贴到浏览器</span><br><span class=\"line\">4、选择我的数据库</span><br><span class=\"line\">5、选择mysql,填入mysql连接信息</span><br><span class=\"line\">6、选择空白站点</span><br><span class=\"line\">7、选择 在confluence 中管理用户和组</span><br><span class=\"line\">8、填写管理员账号信息</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n","site":{"data":{}},"excerpt":"<p>摘要:centos7安装confluence 6.12 </p>","more":"<h2 id=\"环境\"><a href=\"#环境\" class=\"headerlink\" title=\"环境\"></a>环境</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">centos 7.7</span><br><span class=\"line\">JDK 1.8</span><br><span class=\"line\">mysql 5.7(配置文件my.cnf中设置了UTF-8)</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"数据库初始化\"><a href=\"#数据库初始化\" class=\"headerlink\" title=\"数据库初始化\"></a>数据库初始化</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Mysql&gt; SET GLOBAL tx_isolation&#x3D;&#39;READ-COMMITTED&#39;;</span><br><span class=\"line\">Mysql&gt; CREATE DATABASE confluence CHARACTER SET utf8 COLLATE utf8_bin;</span><br><span class=\"line\">Mysql&gt; grant all on confluence.* to confluence@&quot;%&quot; identified by &#39;confluence&#39;;</span><br><span class=\"line\">Mysql&gt; grant all on confluence.* to confluence@&quot;%&quot;;</span><br><span class=\"line\">Mysql&gt; FLUSH PRIVILEGES;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"获取confluence\"><a href=\"#获取confluence\" class=\"headerlink\" title=\"获取confluence\"></a>获取confluence</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget https:&#x2F;&#x2F;product-downloads.atlassian.com&#x2F;software&#x2F;confluence&#x2F;downloads&#x2F;atlassian-confluence-6.12.0-x64.bin</span><br><span class=\"line\">chmod +x atlassian-confluence-6.12-x64.bin</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">.&#x2F;atlassian-confluence-6.12.0-x64.bin</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Unpacking JRE ...</span><br><span class=\"line\">Starting Installer ...</span><br><span class=\"line\"></span><br><span class=\"line\">This will install Confluence 6.12.0 on your computer.</span><br><span class=\"line\">OK [o, Enter], Cancel [c]</span><br><span class=\"line\">o       # 回车或按 o</span><br><span class=\"line\">Click Next to continue, or Cancel to exit Setup.</span><br><span class=\"line\"></span><br><span class=\"line\">Choose the appropriate installation or upgrade option.</span><br><span class=\"line\">Please choose one of the following:</span><br><span class=\"line\">Express Install (uses default settings) [1], </span><br><span class=\"line\">Custom Install (recommended for advanced users) [2, Enter], </span><br><span class=\"line\">Upgrade an existing Confluence installation [3]</span><br><span class=\"line\">1     # 选 1</span><br><span class=\"line\"></span><br><span class=\"line\">See where Confluence will be installed and the settings that will be used.</span><br><span class=\"line\">Installation Directory: &#x2F;opt&#x2F;atlassian&#x2F;confluence </span><br><span class=\"line\">Home Directory: &#x2F;var&#x2F;atlassian&#x2F;application-data&#x2F;confluence </span><br><span class=\"line\">HTTP Port: 8090 </span><br><span class=\"line\">RMI Port: 8000 </span><br><span class=\"line\">Install as service: Yes </span><br><span class=\"line\">Install [i, Enter], Exit [e]</span><br><span class=\"line\">i    # 回车 或按 i</span><br><span class=\"line\"></span><br><span class=\"line\">Extracting files ...</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">Please wait a few moments while we configure Confluence.</span><br><span class=\"line\"></span><br><span class=\"line\">Installation of Confluence 6.12.0 is complete</span><br><span class=\"line\">Start Confluence now?</span><br><span class=\"line\">Yes [y, Enter], No [n]</span><br><span class=\"line\">y    # 回车 或按 y</span><br><span class=\"line\"></span><br><span class=\"line\">Please wait a few moments while Confluence starts up.</span><br><span class=\"line\">Launching Confluence ...</span><br><span class=\"line\"></span><br><span class=\"line\">Installation of Confluence 6.12.0 is complete</span><br><span class=\"line\">Your installation of Confluence 6.12.0 is now ready and can be accessed via</span><br><span class=\"line\">your browser.</span><br><span class=\"line\">Confluence 6.12.0 can be accessed at http:&#x2F;&#x2F;localhost:8090</span><br><span class=\"line\">Finishing installation ...</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"confluence控制\"><a href=\"#confluence控制\" class=\"headerlink\" title=\"confluence控制\"></a>confluence控制</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd &#x2F;opt&#x2F;atlassian&#x2F;confluence&#x2F;bin&#x2F;</span><br><span class=\"line\">.&#x2F;stop-confluence.sh       # 停止</span><br><span class=\"line\">.&#x2F;start-confluence.sh      # 启动</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"破解\"><a href=\"#破解\" class=\"headerlink\" title=\"破解\"></a>破解</h2><p>停止</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd &#x2F;opt&#x2F;atlassian&#x2F;confluence&#x2F;bin&#x2F;</span><br><span class=\"line\">.&#x2F;stop-confluence.sh       # 停止</span><br></pre></td></tr></table></figure>\n<p>替换文件 和上传 mysql-jdbc</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<hr>\n\n<ul>\n<li>1： /opt/atlassian/confluence/confluence/WEB-INF/lib/atlassian-extras-decoder-v2-3.4.1.jar文件到本地</li>\n<li>2：本地重命名为atlassian-extras-2.4.jar</li>\n<li>3：打开破解工具confluence_keygen.jar（本地需先安装java）</li>\n<li>4：选择.patch!找atlassian-extras-2.4.jar打开</li>\n<li>5：可以看到atlassian-extras-2.4.jar和atlassian-extras-2.4.bak两个文件，这里atlassian-extras-2.4.jar已经是破解好的了，将atlassian-extras-2.4.jar名字改回来atlassian-extras-decoder-v2-3.4.1.jar</li>\n<li>6：将atlassian-extras-decoder-v2-3.4.1.jar上传到服务器原目录</li>\n</ul>\n<hr>\n<h2 id=\"web配置\"><a href=\"#web配置\" class=\"headerlink\" title=\"web配置\"></a>web配置</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">浏览器访问http:&#x2F;&#x2F;localhost:8090</span><br><span class=\"line\"></span><br><span class=\"line\">1、右上角选择中文语言</span><br><span class=\"line\">   选择 Production Installation</span><br><span class=\"line\">2、下一步</span><br><span class=\"line\">3、授权码</span><br><span class=\"line\">复制服务器ID到confluence_keygen.jar 中的server ID，点击.gen!,将生成的key粘贴到浏览器</span><br><span class=\"line\">4、选择我的数据库</span><br><span class=\"line\">5、选择mysql,填入mysql连接信息</span><br><span class=\"line\">6、选择空白站点</span><br><span class=\"line\">7、选择 在confluence 中管理用户和组</span><br><span class=\"line\">8、填写管理员账号信息</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>"},{"title":"centos7安装kafka集群","date":"2021-07-24T07:29:00.000Z","_content":"\t\n\t\n摘要: centos7安装kafka集群\n<!-- more -->\n\n\n\n## 集群模式\n\n10.200.75.180\n10.200.75.181\n10.200.75.182\n\n\n### 创建目录\n```\nmkdir -p /opt/kafka\n```\n\n### 下载安装包\n\n```\ncurl -O https://apache.website-solution.net/kafka/2.8.0/kafka_2.12-2.8.0.tgz\ntar xvf kafka_2.12-2.8.0.tgz -C /opt/kafka/\n\n```\n### 配置环境变量\n\n将 `kafka_2.12-2.8.0/bin` 添加到`path`，以方便访问\n```\nvi /etc/profile\n```\n在末尾添加：\n```\nKAFKA_HOME=/opt/kafka/kafka_2.12-2.8.0\nPATH=$PATH:$KAFKA_HOME/bin\n```\n\n### 创建目录\n```\nmkdir -p /opt/kafka/kafka_2.12-2.8.0/mylog\n```\n\n### 修改jvm 配置文件，开启jmx 监控\n\nvim bin/kafka-server-start.sh\n```\n# 修改29 行\nexport KAFKA_HEAP_OPTS=\"-Xmx6G -Xms6G\"\nexport JMX_PORT=\"9999\"\n```\n\n### 修改kafka01 配置文件\n\n```\nvim /opt/kafka/kafka_2.12-2.8.0/config/server.properties\n\nbroker.id=1\nport=9091\nhost.name=10.200.75.180\nnum.network.threads=3\nnum.io.threads=8\nsocket.send.buffer.bytes=102400\nsocket.receive.buffer.bytes=102400\nsocket.request.max.bytes=104857600\nlog.dirs=/opt/kafka/kafka_2.12-2.8.0/mylog\nnum.partitions=1\nnum.recovery.threads.per.data.dir=1\nlog.retention.hours=168\nlog.segment.bytes=1073741824\nlog.retention.check.interval.ms=300000\nlog.cleaner.enable=false\nzookeeper.connect=10.200.75.177:2180,10.200.75.178:2180,10.200.75.179:2180\nzookeeper.connection.timeout.ms=6000\n\n```\n\n### 修改kafka02 配置文件\n\n```\nvim /opt/kafka/kafka_2.12-2.8.0/config/server.properties\n\nbroker.id=2\nport=9091\nhost.name=10.200.75.181\nnum.network.threads=3\nnum.io.threads=8\nsocket.send.buffer.bytes=102400\nsocket.receive.buffer.bytes=102400\nsocket.request.max.bytes=104857600\nlog.dirs=/opt/kafka/kafka_2.12-2.8.0/mylog\nnum.partitions=1\nnum.recovery.threads.per.data.dir=1\nlog.retention.hours=168\nlog.segment.bytes=1073741824\nlog.retention.check.interval.ms=300000\nlog.cleaner.enable=false\nzookeeper.connect=10.200.75.177:2180,10.200.75.178:2180,10.200.75.179:2180\nzookeeper.connection.timeout.ms=6000\n\n```\n\n\n\n### 修改kafka03 配置文件\n\n```\nvim /opt/kafka/kafka_2.12-2.8.0/config/server.properties\n\nbroker.id=3\nport=9091\nhost.name=10.200.75.182\nnum.network.threads=3\nnum.io.threads=8\nsocket.send.buffer.bytes=102400\nsocket.receive.buffer.bytes=102400\nsocket.request.max.bytes=104857600\nlog.dirs=/opt/kafka/kafka_2.12-2.8.0/mylog\nnum.partitions=1\nnum.recovery.threads.per.data.dir=1\nlog.retention.hours=168\nlog.segment.bytes=1073741824\nlog.retention.check.interval.ms=300000\nlog.cleaner.enable=false\nzookeeper.connect=10.200.75.177:2180,10.200.75.178:2180,10.200.75.179:2180\nzookeeper.connection.timeout.ms=6000\n\n```\n\n## systemctl 管理kafka\n```\ncat > /usr/lib/systemd/system/kafka.service <<\"EOF\"\n[Unit]\nDescription=Apache Kafka server\nAfter=network.target  zookeeper.service\n\n[Service]\nType=simple\nEnvironment=JAVA_HOME=/opt/jdk1.8.0_161\nUser=root\nGroup=root\nExecStart=/opt/kafka/kafka_2.12-2.8.0/bin/kafka-server-start.sh /opt/kafka/kafka_2.12-2.8.0/config/server.properties\nExecStop=/opt/kafka/kafka_2.12-2.8.0/bin/kafka-server-stop.sh\nRestart=on-failure\n\n[Install]\nWantedBy=multi-user.target\nEOF\n```\n\n```\nsystemctl daemon-reload\nsystemctl start kafka\n\nsystemctl enable kafka\nsystemctl is-enabled kafka\n```\n\n\n### 定期清理日志\n```\ncat > /opt/kafka/kafka_2.12-2.8.0/bin/clean_kafka_logs.sh << \"EOF\"\n#!/bin/bash\nfind /opt/kafka/kafka_2.12-2.8.0/logs/ -type f -mtime +7|xargs rm -rf\nEOF\n\nchmod +x /opt/kafka/kafka_2.12-2.8.0/bin/clean_kafka_logs.sh\n\n\n执行crontab -e，加入一行\n0 0 * * * /bin/bash /opt/kafka/kafka_2.12-2.8.0/bin/clean_kafka_logs.sh\n```\n\n\n操作日志清理脚本\n```\n#!/usr/bin/env bash\n#  @author  Yakir.King\n#  @date  2020/8/3 20:14\n# \n\n# 清除多余日志\n# 清除规则\n## 1、保留个数，kafka默认按照小时保存日志，每小时保存一个，约定保留文件个数，默认72个\n## 2、保留时间，默认保存72小时\n## 3、保存大小，为避免服务出问题导致频繁刷日志，将 磁盘撑满，每个文件保留大小均不可超过1G，超过1G的文件将被清理。\n###   3.1 为保留出问题的现场，所以需要保留第一个超过1G的文件。\n\n# 保留文件个数，默认72\nRETAIN_FILES_NUM=72\n\n# 保留文件时间，默认72小时，单位：小时\nRETAIN_FILES_TIME=72\n\n# 保存文件大小，默认1G，单位：M\nRETAIN_FILE_MB=1024\n\n# 日志保存目录\nLOG_DIR=/opt/kafka/kafka_2.12-2.8.0/logs\n\n# 保留个数方法，由于日志按照小时保存，所以使用保留时间方法即可。\nfunction retain_files_num() {\n\techo \"\"\n }\n# 保留时间方法\n# 传入参数为日志文件前缀，如server.log.2020-08-01-11 传入参数为server\nfunction retain_files_date(){\n    for file_name in $* ; do\n        FILE_NAME=${file_name}\n        # 确认给定时间之前的时间\n        DELETE_DATE=`date +%Y-%m-%d-%H -d \"${RETAIN_FILES_TIME} hours ago\"`\n        # 获取所有日志，将日志的时间戳获取\n        # 遍历所有日志文件，截取日志文件的时间戳部分，与delete_date对比，小于等于这个时间的，删除。\n        for log_file in `ls -1 ${LOG_DIR}/${FILE_NAME}.log.20*`;do\n            LOG_FILE_DATE=`ls -1 ${log_file} | awk -F . '{print $(NF)}'`\n            if [[ ${LOG_FILE_DATE} < ${DELETE_DATE} ]]; then\n                echo \"当前日志文件：${log_file}, 保存时间已超过${RETAIN_FILES_TIME}个小时，删除中……\"\n                rm -f ${LOG_DIR}/${log_file}\n            fi\n        done\n\tdone\n}\n\n# 保存大小方法\n# 传入参数为日志文件前缀，如server.log.2020-08-01-11 传入参数为server\nfunction retain_files_size(){\n    for file_name in $* ; do\n        FILE_NAME=${file_name}\n        # 判断出文件大小\n        # 判断超过1G的文件个数，超过两个删除新文件（保留旧的文件，事件现场）。\n        BIG_FILE_NUM=`ls -lh ${LOG_DIR}/${FILE_NAME}.log.20* | grep -v total | grep G | wc -l `\n        if [[ ${BIG_FILE_NUM} > 1 ]];then\n            flag=1\n            for log_file in `ls -lh ${LOG_DIR}/${FILE_NAME}.log.20* | grep -v total | grep G | awk '{print $(NF)}'` ;do\n                if [[ ${flag} -gt 1 ]] ;then\n                    echo \"当前日志文件：${log_file}, 大小已超过${RETAIN_FILE_MB}M，删除中……\"\n                    rm -f ${LOG_DIR}/${log_file}\n                fi\n                ((flag++))\n            done\n        fi\n        if [[ ${BIG_FILE_NUM} == 1 ]];then\n            echo \"剩余1个超过${RETAIN_FILE_MB}M的文件，请检查文件过大内容，如有问题解决问题后清除。\"\n        fi\n        echo \"${LOG_DIR}/${FILE_NAME}.log的保留文件大小正常\"\n    done\n}\n\n# 执行保留时间方法\nretain_files_date server controller kafka-authorizer kafka-request log-cleaner state-change\n# 执行保留大小方法\nretain_files_size server controller kafka-authorizer kafka-request log-cleaner state-change\n\n```\n\n```\n1 */1 * * * /bin/bash ${script_home}/oplogs_cleaner.sh >> oplogs_cleaner.log 2>&1\n```","source":"_posts/install/centos7安装kafka.md","raw":"---\ntitle: centos7安装kafka集群\ndate: 2021-07-24 15:29\ncategories:\n- Linux\ntags:\n- kafka\n---\n\t\n\t\n摘要: centos7安装kafka集群\n<!-- more -->\n\n\n\n## 集群模式\n\n10.200.75.180\n10.200.75.181\n10.200.75.182\n\n\n### 创建目录\n```\nmkdir -p /opt/kafka\n```\n\n### 下载安装包\n\n```\ncurl -O https://apache.website-solution.net/kafka/2.8.0/kafka_2.12-2.8.0.tgz\ntar xvf kafka_2.12-2.8.0.tgz -C /opt/kafka/\n\n```\n### 配置环境变量\n\n将 `kafka_2.12-2.8.0/bin` 添加到`path`，以方便访问\n```\nvi /etc/profile\n```\n在末尾添加：\n```\nKAFKA_HOME=/opt/kafka/kafka_2.12-2.8.0\nPATH=$PATH:$KAFKA_HOME/bin\n```\n\n### 创建目录\n```\nmkdir -p /opt/kafka/kafka_2.12-2.8.0/mylog\n```\n\n### 修改jvm 配置文件，开启jmx 监控\n\nvim bin/kafka-server-start.sh\n```\n# 修改29 行\nexport KAFKA_HEAP_OPTS=\"-Xmx6G -Xms6G\"\nexport JMX_PORT=\"9999\"\n```\n\n### 修改kafka01 配置文件\n\n```\nvim /opt/kafka/kafka_2.12-2.8.0/config/server.properties\n\nbroker.id=1\nport=9091\nhost.name=10.200.75.180\nnum.network.threads=3\nnum.io.threads=8\nsocket.send.buffer.bytes=102400\nsocket.receive.buffer.bytes=102400\nsocket.request.max.bytes=104857600\nlog.dirs=/opt/kafka/kafka_2.12-2.8.0/mylog\nnum.partitions=1\nnum.recovery.threads.per.data.dir=1\nlog.retention.hours=168\nlog.segment.bytes=1073741824\nlog.retention.check.interval.ms=300000\nlog.cleaner.enable=false\nzookeeper.connect=10.200.75.177:2180,10.200.75.178:2180,10.200.75.179:2180\nzookeeper.connection.timeout.ms=6000\n\n```\n\n### 修改kafka02 配置文件\n\n```\nvim /opt/kafka/kafka_2.12-2.8.0/config/server.properties\n\nbroker.id=2\nport=9091\nhost.name=10.200.75.181\nnum.network.threads=3\nnum.io.threads=8\nsocket.send.buffer.bytes=102400\nsocket.receive.buffer.bytes=102400\nsocket.request.max.bytes=104857600\nlog.dirs=/opt/kafka/kafka_2.12-2.8.0/mylog\nnum.partitions=1\nnum.recovery.threads.per.data.dir=1\nlog.retention.hours=168\nlog.segment.bytes=1073741824\nlog.retention.check.interval.ms=300000\nlog.cleaner.enable=false\nzookeeper.connect=10.200.75.177:2180,10.200.75.178:2180,10.200.75.179:2180\nzookeeper.connection.timeout.ms=6000\n\n```\n\n\n\n### 修改kafka03 配置文件\n\n```\nvim /opt/kafka/kafka_2.12-2.8.0/config/server.properties\n\nbroker.id=3\nport=9091\nhost.name=10.200.75.182\nnum.network.threads=3\nnum.io.threads=8\nsocket.send.buffer.bytes=102400\nsocket.receive.buffer.bytes=102400\nsocket.request.max.bytes=104857600\nlog.dirs=/opt/kafka/kafka_2.12-2.8.0/mylog\nnum.partitions=1\nnum.recovery.threads.per.data.dir=1\nlog.retention.hours=168\nlog.segment.bytes=1073741824\nlog.retention.check.interval.ms=300000\nlog.cleaner.enable=false\nzookeeper.connect=10.200.75.177:2180,10.200.75.178:2180,10.200.75.179:2180\nzookeeper.connection.timeout.ms=6000\n\n```\n\n## systemctl 管理kafka\n```\ncat > /usr/lib/systemd/system/kafka.service <<\"EOF\"\n[Unit]\nDescription=Apache Kafka server\nAfter=network.target  zookeeper.service\n\n[Service]\nType=simple\nEnvironment=JAVA_HOME=/opt/jdk1.8.0_161\nUser=root\nGroup=root\nExecStart=/opt/kafka/kafka_2.12-2.8.0/bin/kafka-server-start.sh /opt/kafka/kafka_2.12-2.8.0/config/server.properties\nExecStop=/opt/kafka/kafka_2.12-2.8.0/bin/kafka-server-stop.sh\nRestart=on-failure\n\n[Install]\nWantedBy=multi-user.target\nEOF\n```\n\n```\nsystemctl daemon-reload\nsystemctl start kafka\n\nsystemctl enable kafka\nsystemctl is-enabled kafka\n```\n\n\n### 定期清理日志\n```\ncat > /opt/kafka/kafka_2.12-2.8.0/bin/clean_kafka_logs.sh << \"EOF\"\n#!/bin/bash\nfind /opt/kafka/kafka_2.12-2.8.0/logs/ -type f -mtime +7|xargs rm -rf\nEOF\n\nchmod +x /opt/kafka/kafka_2.12-2.8.0/bin/clean_kafka_logs.sh\n\n\n执行crontab -e，加入一行\n0 0 * * * /bin/bash /opt/kafka/kafka_2.12-2.8.0/bin/clean_kafka_logs.sh\n```\n\n\n操作日志清理脚本\n```\n#!/usr/bin/env bash\n#  @author  Yakir.King\n#  @date  2020/8/3 20:14\n# \n\n# 清除多余日志\n# 清除规则\n## 1、保留个数，kafka默认按照小时保存日志，每小时保存一个，约定保留文件个数，默认72个\n## 2、保留时间，默认保存72小时\n## 3、保存大小，为避免服务出问题导致频繁刷日志，将 磁盘撑满，每个文件保留大小均不可超过1G，超过1G的文件将被清理。\n###   3.1 为保留出问题的现场，所以需要保留第一个超过1G的文件。\n\n# 保留文件个数，默认72\nRETAIN_FILES_NUM=72\n\n# 保留文件时间，默认72小时，单位：小时\nRETAIN_FILES_TIME=72\n\n# 保存文件大小，默认1G，单位：M\nRETAIN_FILE_MB=1024\n\n# 日志保存目录\nLOG_DIR=/opt/kafka/kafka_2.12-2.8.0/logs\n\n# 保留个数方法，由于日志按照小时保存，所以使用保留时间方法即可。\nfunction retain_files_num() {\n\techo \"\"\n }\n# 保留时间方法\n# 传入参数为日志文件前缀，如server.log.2020-08-01-11 传入参数为server\nfunction retain_files_date(){\n    for file_name in $* ; do\n        FILE_NAME=${file_name}\n        # 确认给定时间之前的时间\n        DELETE_DATE=`date +%Y-%m-%d-%H -d \"${RETAIN_FILES_TIME} hours ago\"`\n        # 获取所有日志，将日志的时间戳获取\n        # 遍历所有日志文件，截取日志文件的时间戳部分，与delete_date对比，小于等于这个时间的，删除。\n        for log_file in `ls -1 ${LOG_DIR}/${FILE_NAME}.log.20*`;do\n            LOG_FILE_DATE=`ls -1 ${log_file} | awk -F . '{print $(NF)}'`\n            if [[ ${LOG_FILE_DATE} < ${DELETE_DATE} ]]; then\n                echo \"当前日志文件：${log_file}, 保存时间已超过${RETAIN_FILES_TIME}个小时，删除中……\"\n                rm -f ${LOG_DIR}/${log_file}\n            fi\n        done\n\tdone\n}\n\n# 保存大小方法\n# 传入参数为日志文件前缀，如server.log.2020-08-01-11 传入参数为server\nfunction retain_files_size(){\n    for file_name in $* ; do\n        FILE_NAME=${file_name}\n        # 判断出文件大小\n        # 判断超过1G的文件个数，超过两个删除新文件（保留旧的文件，事件现场）。\n        BIG_FILE_NUM=`ls -lh ${LOG_DIR}/${FILE_NAME}.log.20* | grep -v total | grep G | wc -l `\n        if [[ ${BIG_FILE_NUM} > 1 ]];then\n            flag=1\n            for log_file in `ls -lh ${LOG_DIR}/${FILE_NAME}.log.20* | grep -v total | grep G | awk '{print $(NF)}'` ;do\n                if [[ ${flag} -gt 1 ]] ;then\n                    echo \"当前日志文件：${log_file}, 大小已超过${RETAIN_FILE_MB}M，删除中……\"\n                    rm -f ${LOG_DIR}/${log_file}\n                fi\n                ((flag++))\n            done\n        fi\n        if [[ ${BIG_FILE_NUM} == 1 ]];then\n            echo \"剩余1个超过${RETAIN_FILE_MB}M的文件，请检查文件过大内容，如有问题解决问题后清除。\"\n        fi\n        echo \"${LOG_DIR}/${FILE_NAME}.log的保留文件大小正常\"\n    done\n}\n\n# 执行保留时间方法\nretain_files_date server controller kafka-authorizer kafka-request log-cleaner state-change\n# 执行保留大小方法\nretain_files_size server controller kafka-authorizer kafka-request log-cleaner state-change\n\n```\n\n```\n1 */1 * * * /bin/bash ${script_home}/oplogs_cleaner.sh >> oplogs_cleaner.log 2>&1\n```","slug":"install/centos7安装kafka","published":1,"updated":"2021-09-24T02:19:37.751Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cku6979zc003g00uh2lumerfk","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><p>摘要: centos7安装kafka集群</p>\n<span id=\"more\"></span>\n\n\n\n<h2 id=\"集群模式\"><a href=\"#集群模式\" class=\"headerlink\" title=\"集群模式\"></a>集群模式</h2><p>10.200.75.180<br>10.200.75.181<br>10.200.75.182</p>\n<h3 id=\"创建目录\"><a href=\"#创建目录\" class=\"headerlink\" title=\"创建目录\"></a>创建目录</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir -p &#x2F;opt&#x2F;kafka</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"下载安装包\"><a href=\"#下载安装包\" class=\"headerlink\" title=\"下载安装包\"></a>下载安装包</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -O https:&#x2F;&#x2F;apache.website-solution.net&#x2F;kafka&#x2F;2.8.0&#x2F;kafka_2.12-2.8.0.tgz</span><br><span class=\"line\">tar xvf kafka_2.12-2.8.0.tgz -C &#x2F;opt&#x2F;kafka&#x2F;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h3 id=\"配置环境变量\"><a href=\"#配置环境变量\" class=\"headerlink\" title=\"配置环境变量\"></a>配置环境变量</h3><p>将 <code>kafka_2.12-2.8.0/bin</code> 添加到<code>path</code>，以方便访问</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vi &#x2F;etc&#x2F;profile</span><br></pre></td></tr></table></figure>\n<p>在末尾添加：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">KAFKA_HOME&#x3D;&#x2F;opt&#x2F;kafka&#x2F;kafka_2.12-2.8.0</span><br><span class=\"line\">PATH&#x3D;$PATH:$KAFKA_HOME&#x2F;bin</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"创建目录-1\"><a href=\"#创建目录-1\" class=\"headerlink\" title=\"创建目录\"></a>创建目录</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir -p &#x2F;opt&#x2F;kafka&#x2F;kafka_2.12-2.8.0&#x2F;mylog</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"修改jvm-配置文件，开启jmx-监控\"><a href=\"#修改jvm-配置文件，开启jmx-监控\" class=\"headerlink\" title=\"修改jvm 配置文件，开启jmx 监控\"></a>修改jvm 配置文件，开启jmx 监控</h3><p>vim bin/kafka-server-start.sh</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 修改29 行</span><br><span class=\"line\">export KAFKA_HEAP_OPTS&#x3D;&quot;-Xmx6G -Xms6G&quot;</span><br><span class=\"line\">export JMX_PORT&#x3D;&quot;9999&quot;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"修改kafka01-配置文件\"><a href=\"#修改kafka01-配置文件\" class=\"headerlink\" title=\"修改kafka01 配置文件\"></a>修改kafka01 配置文件</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim &#x2F;opt&#x2F;kafka&#x2F;kafka_2.12-2.8.0&#x2F;config&#x2F;server.properties</span><br><span class=\"line\"></span><br><span class=\"line\">broker.id&#x3D;1</span><br><span class=\"line\">port&#x3D;9091</span><br><span class=\"line\">host.name&#x3D;10.200.75.180</span><br><span class=\"line\">num.network.threads&#x3D;3</span><br><span class=\"line\">num.io.threads&#x3D;8</span><br><span class=\"line\">socket.send.buffer.bytes&#x3D;102400</span><br><span class=\"line\">socket.receive.buffer.bytes&#x3D;102400</span><br><span class=\"line\">socket.request.max.bytes&#x3D;104857600</span><br><span class=\"line\">log.dirs&#x3D;&#x2F;opt&#x2F;kafka&#x2F;kafka_2.12-2.8.0&#x2F;mylog</span><br><span class=\"line\">num.partitions&#x3D;1</span><br><span class=\"line\">num.recovery.threads.per.data.dir&#x3D;1</span><br><span class=\"line\">log.retention.hours&#x3D;168</span><br><span class=\"line\">log.segment.bytes&#x3D;1073741824</span><br><span class=\"line\">log.retention.check.interval.ms&#x3D;300000</span><br><span class=\"line\">log.cleaner.enable&#x3D;false</span><br><span class=\"line\">zookeeper.connect&#x3D;10.200.75.177:2180,10.200.75.178:2180,10.200.75.179:2180</span><br><span class=\"line\">zookeeper.connection.timeout.ms&#x3D;6000</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"修改kafka02-配置文件\"><a href=\"#修改kafka02-配置文件\" class=\"headerlink\" title=\"修改kafka02 配置文件\"></a>修改kafka02 配置文件</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim &#x2F;opt&#x2F;kafka&#x2F;kafka_2.12-2.8.0&#x2F;config&#x2F;server.properties</span><br><span class=\"line\"></span><br><span class=\"line\">broker.id&#x3D;2</span><br><span class=\"line\">port&#x3D;9091</span><br><span class=\"line\">host.name&#x3D;10.200.75.181</span><br><span class=\"line\">num.network.threads&#x3D;3</span><br><span class=\"line\">num.io.threads&#x3D;8</span><br><span class=\"line\">socket.send.buffer.bytes&#x3D;102400</span><br><span class=\"line\">socket.receive.buffer.bytes&#x3D;102400</span><br><span class=\"line\">socket.request.max.bytes&#x3D;104857600</span><br><span class=\"line\">log.dirs&#x3D;&#x2F;opt&#x2F;kafka&#x2F;kafka_2.12-2.8.0&#x2F;mylog</span><br><span class=\"line\">num.partitions&#x3D;1</span><br><span class=\"line\">num.recovery.threads.per.data.dir&#x3D;1</span><br><span class=\"line\">log.retention.hours&#x3D;168</span><br><span class=\"line\">log.segment.bytes&#x3D;1073741824</span><br><span class=\"line\">log.retention.check.interval.ms&#x3D;300000</span><br><span class=\"line\">log.cleaner.enable&#x3D;false</span><br><span class=\"line\">zookeeper.connect&#x3D;10.200.75.177:2180,10.200.75.178:2180,10.200.75.179:2180</span><br><span class=\"line\">zookeeper.connection.timeout.ms&#x3D;6000</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"修改kafka03-配置文件\"><a href=\"#修改kafka03-配置文件\" class=\"headerlink\" title=\"修改kafka03 配置文件\"></a>修改kafka03 配置文件</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim &#x2F;opt&#x2F;kafka&#x2F;kafka_2.12-2.8.0&#x2F;config&#x2F;server.properties</span><br><span class=\"line\"></span><br><span class=\"line\">broker.id&#x3D;3</span><br><span class=\"line\">port&#x3D;9091</span><br><span class=\"line\">host.name&#x3D;10.200.75.182</span><br><span class=\"line\">num.network.threads&#x3D;3</span><br><span class=\"line\">num.io.threads&#x3D;8</span><br><span class=\"line\">socket.send.buffer.bytes&#x3D;102400</span><br><span class=\"line\">socket.receive.buffer.bytes&#x3D;102400</span><br><span class=\"line\">socket.request.max.bytes&#x3D;104857600</span><br><span class=\"line\">log.dirs&#x3D;&#x2F;opt&#x2F;kafka&#x2F;kafka_2.12-2.8.0&#x2F;mylog</span><br><span class=\"line\">num.partitions&#x3D;1</span><br><span class=\"line\">num.recovery.threads.per.data.dir&#x3D;1</span><br><span class=\"line\">log.retention.hours&#x3D;168</span><br><span class=\"line\">log.segment.bytes&#x3D;1073741824</span><br><span class=\"line\">log.retention.check.interval.ms&#x3D;300000</span><br><span class=\"line\">log.cleaner.enable&#x3D;false</span><br><span class=\"line\">zookeeper.connect&#x3D;10.200.75.177:2180,10.200.75.178:2180,10.200.75.179:2180</span><br><span class=\"line\">zookeeper.connection.timeout.ms&#x3D;6000</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"systemctl-管理kafka\"><a href=\"#systemctl-管理kafka\" class=\"headerlink\" title=\"systemctl 管理kafka\"></a>systemctl 管理kafka</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cat &gt; &#x2F;usr&#x2F;lib&#x2F;systemd&#x2F;system&#x2F;kafka.service &lt;&lt;&quot;EOF&quot;</span><br><span class=\"line\">[Unit]</span><br><span class=\"line\">Description&#x3D;Apache Kafka server</span><br><span class=\"line\">After&#x3D;network.target  zookeeper.service</span><br><span class=\"line\"></span><br><span class=\"line\">[Service]</span><br><span class=\"line\">Type&#x3D;simple</span><br><span class=\"line\">Environment&#x3D;JAVA_HOME&#x3D;&#x2F;opt&#x2F;jdk1.8.0_161</span><br><span class=\"line\">User&#x3D;root</span><br><span class=\"line\">Group&#x3D;root</span><br><span class=\"line\">ExecStart&#x3D;&#x2F;opt&#x2F;kafka&#x2F;kafka_2.12-2.8.0&#x2F;bin&#x2F;kafka-server-start.sh &#x2F;opt&#x2F;kafka&#x2F;kafka_2.12-2.8.0&#x2F;config&#x2F;server.properties</span><br><span class=\"line\">ExecStop&#x3D;&#x2F;opt&#x2F;kafka&#x2F;kafka_2.12-2.8.0&#x2F;bin&#x2F;kafka-server-stop.sh</span><br><span class=\"line\">Restart&#x3D;on-failure</span><br><span class=\"line\"></span><br><span class=\"line\">[Install]</span><br><span class=\"line\">WantedBy&#x3D;multi-user.target</span><br><span class=\"line\">EOF</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl daemon-reload</span><br><span class=\"line\">systemctl start kafka</span><br><span class=\"line\"></span><br><span class=\"line\">systemctl enable kafka</span><br><span class=\"line\">systemctl is-enabled kafka</span><br></pre></td></tr></table></figure>\n\n\n<h3 id=\"定期清理日志\"><a href=\"#定期清理日志\" class=\"headerlink\" title=\"定期清理日志\"></a>定期清理日志</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cat &gt; &#x2F;opt&#x2F;kafka&#x2F;kafka_2.12-2.8.0&#x2F;bin&#x2F;clean_kafka_logs.sh &lt;&lt; &quot;EOF&quot;</span><br><span class=\"line\">#!&#x2F;bin&#x2F;bash</span><br><span class=\"line\">find &#x2F;opt&#x2F;kafka&#x2F;kafka_2.12-2.8.0&#x2F;logs&#x2F; -type f -mtime +7|xargs rm -rf</span><br><span class=\"line\">EOF</span><br><span class=\"line\"></span><br><span class=\"line\">chmod +x &#x2F;opt&#x2F;kafka&#x2F;kafka_2.12-2.8.0&#x2F;bin&#x2F;clean_kafka_logs.sh</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">执行crontab -e，加入一行</span><br><span class=\"line\">0 0 * * * &#x2F;bin&#x2F;bash &#x2F;opt&#x2F;kafka&#x2F;kafka_2.12-2.8.0&#x2F;bin&#x2F;clean_kafka_logs.sh</span><br></pre></td></tr></table></figure>\n\n\n<p>操作日志清理脚本</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#!&#x2F;usr&#x2F;bin&#x2F;env bash</span><br><span class=\"line\">#  @author  Yakir.King</span><br><span class=\"line\">#  @date  2020&#x2F;8&#x2F;3 20:14</span><br><span class=\"line\"># </span><br><span class=\"line\"></span><br><span class=\"line\"># 清除多余日志</span><br><span class=\"line\"># 清除规则</span><br><span class=\"line\">## 1、保留个数，kafka默认按照小时保存日志，每小时保存一个，约定保留文件个数，默认72个</span><br><span class=\"line\">## 2、保留时间，默认保存72小时</span><br><span class=\"line\">## 3、保存大小，为避免服务出问题导致频繁刷日志，将 磁盘撑满，每个文件保留大小均不可超过1G，超过1G的文件将被清理。</span><br><span class=\"line\">###   3.1 为保留出问题的现场，所以需要保留第一个超过1G的文件。</span><br><span class=\"line\"></span><br><span class=\"line\"># 保留文件个数，默认72</span><br><span class=\"line\">RETAIN_FILES_NUM&#x3D;72</span><br><span class=\"line\"></span><br><span class=\"line\"># 保留文件时间，默认72小时，单位：小时</span><br><span class=\"line\">RETAIN_FILES_TIME&#x3D;72</span><br><span class=\"line\"></span><br><span class=\"line\"># 保存文件大小，默认1G，单位：M</span><br><span class=\"line\">RETAIN_FILE_MB&#x3D;1024</span><br><span class=\"line\"></span><br><span class=\"line\"># 日志保存目录</span><br><span class=\"line\">LOG_DIR&#x3D;&#x2F;opt&#x2F;kafka&#x2F;kafka_2.12-2.8.0&#x2F;logs</span><br><span class=\"line\"></span><br><span class=\"line\"># 保留个数方法，由于日志按照小时保存，所以使用保留时间方法即可。</span><br><span class=\"line\">function retain_files_num() &#123;</span><br><span class=\"line\">\techo &quot;&quot;</span><br><span class=\"line\"> &#125;</span><br><span class=\"line\"># 保留时间方法</span><br><span class=\"line\"># 传入参数为日志文件前缀，如server.log.2020-08-01-11 传入参数为server</span><br><span class=\"line\">function retain_files_date()&#123;</span><br><span class=\"line\">    for file_name in $* ; do</span><br><span class=\"line\">        FILE_NAME&#x3D;$&#123;file_name&#125;</span><br><span class=\"line\">        # 确认给定时间之前的时间</span><br><span class=\"line\">        DELETE_DATE&#x3D;&#96;date +%Y-%m-%d-%H -d &quot;$&#123;RETAIN_FILES_TIME&#125; hours ago&quot;&#96;</span><br><span class=\"line\">        # 获取所有日志，将日志的时间戳获取</span><br><span class=\"line\">        # 遍历所有日志文件，截取日志文件的时间戳部分，与delete_date对比，小于等于这个时间的，删除。</span><br><span class=\"line\">        for log_file in &#96;ls -1 $&#123;LOG_DIR&#125;&#x2F;$&#123;FILE_NAME&#125;.log.20*&#96;;do</span><br><span class=\"line\">            LOG_FILE_DATE&#x3D;&#96;ls -1 $&#123;log_file&#125; | awk -F . &#39;&#123;print $(NF)&#125;&#39;&#96;</span><br><span class=\"line\">            if [[ $&#123;LOG_FILE_DATE&#125; &lt; $&#123;DELETE_DATE&#125; ]]; then</span><br><span class=\"line\">                echo &quot;当前日志文件：$&#123;log_file&#125;, 保存时间已超过$&#123;RETAIN_FILES_TIME&#125;个小时，删除中……&quot;</span><br><span class=\"line\">                rm -f $&#123;LOG_DIR&#125;&#x2F;$&#123;log_file&#125;</span><br><span class=\"line\">            fi</span><br><span class=\"line\">        done</span><br><span class=\"line\">\tdone</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"># 保存大小方法</span><br><span class=\"line\"># 传入参数为日志文件前缀，如server.log.2020-08-01-11 传入参数为server</span><br><span class=\"line\">function retain_files_size()&#123;</span><br><span class=\"line\">    for file_name in $* ; do</span><br><span class=\"line\">        FILE_NAME&#x3D;$&#123;file_name&#125;</span><br><span class=\"line\">        # 判断出文件大小</span><br><span class=\"line\">        # 判断超过1G的文件个数，超过两个删除新文件（保留旧的文件，事件现场）。</span><br><span class=\"line\">        BIG_FILE_NUM&#x3D;&#96;ls -lh $&#123;LOG_DIR&#125;&#x2F;$&#123;FILE_NAME&#125;.log.20* | grep -v total | grep G | wc -l &#96;</span><br><span class=\"line\">        if [[ $&#123;BIG_FILE_NUM&#125; &gt; 1 ]];then</span><br><span class=\"line\">            flag&#x3D;1</span><br><span class=\"line\">            for log_file in &#96;ls -lh $&#123;LOG_DIR&#125;&#x2F;$&#123;FILE_NAME&#125;.log.20* | grep -v total | grep G | awk &#39;&#123;print $(NF)&#125;&#39;&#96; ;do</span><br><span class=\"line\">                if [[ $&#123;flag&#125; -gt 1 ]] ;then</span><br><span class=\"line\">                    echo &quot;当前日志文件：$&#123;log_file&#125;, 大小已超过$&#123;RETAIN_FILE_MB&#125;M，删除中……&quot;</span><br><span class=\"line\">                    rm -f $&#123;LOG_DIR&#125;&#x2F;$&#123;log_file&#125;</span><br><span class=\"line\">                fi</span><br><span class=\"line\">                ((flag++))</span><br><span class=\"line\">            done</span><br><span class=\"line\">        fi</span><br><span class=\"line\">        if [[ $&#123;BIG_FILE_NUM&#125; &#x3D;&#x3D; 1 ]];then</span><br><span class=\"line\">            echo &quot;剩余1个超过$&#123;RETAIN_FILE_MB&#125;M的文件，请检查文件过大内容，如有问题解决问题后清除。&quot;</span><br><span class=\"line\">        fi</span><br><span class=\"line\">        echo &quot;$&#123;LOG_DIR&#125;&#x2F;$&#123;FILE_NAME&#125;.log的保留文件大小正常&quot;</span><br><span class=\"line\">    done</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"># 执行保留时间方法</span><br><span class=\"line\">retain_files_date server controller kafka-authorizer kafka-request log-cleaner state-change</span><br><span class=\"line\"># 执行保留大小方法</span><br><span class=\"line\">retain_files_size server controller kafka-authorizer kafka-request log-cleaner state-change</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1 *&#x2F;1 * * * &#x2F;bin&#x2F;bash $&#123;script_home&#125;&#x2F;oplogs_cleaner.sh &gt;&gt; oplogs_cleaner.log 2&gt;&amp;1</span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"<p>摘要: centos7安装kafka集群</p>","more":"<h2 id=\"集群模式\"><a href=\"#集群模式\" class=\"headerlink\" title=\"集群模式\"></a>集群模式</h2><p>10.200.75.180<br>10.200.75.181<br>10.200.75.182</p>\n<h3 id=\"创建目录\"><a href=\"#创建目录\" class=\"headerlink\" title=\"创建目录\"></a>创建目录</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir -p &#x2F;opt&#x2F;kafka</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"下载安装包\"><a href=\"#下载安装包\" class=\"headerlink\" title=\"下载安装包\"></a>下载安装包</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -O https:&#x2F;&#x2F;apache.website-solution.net&#x2F;kafka&#x2F;2.8.0&#x2F;kafka_2.12-2.8.0.tgz</span><br><span class=\"line\">tar xvf kafka_2.12-2.8.0.tgz -C &#x2F;opt&#x2F;kafka&#x2F;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h3 id=\"配置环境变量\"><a href=\"#配置环境变量\" class=\"headerlink\" title=\"配置环境变量\"></a>配置环境变量</h3><p>将 <code>kafka_2.12-2.8.0/bin</code> 添加到<code>path</code>，以方便访问</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vi &#x2F;etc&#x2F;profile</span><br></pre></td></tr></table></figure>\n<p>在末尾添加：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">KAFKA_HOME&#x3D;&#x2F;opt&#x2F;kafka&#x2F;kafka_2.12-2.8.0</span><br><span class=\"line\">PATH&#x3D;$PATH:$KAFKA_HOME&#x2F;bin</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"创建目录-1\"><a href=\"#创建目录-1\" class=\"headerlink\" title=\"创建目录\"></a>创建目录</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir -p &#x2F;opt&#x2F;kafka&#x2F;kafka_2.12-2.8.0&#x2F;mylog</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"修改jvm-配置文件，开启jmx-监控\"><a href=\"#修改jvm-配置文件，开启jmx-监控\" class=\"headerlink\" title=\"修改jvm 配置文件，开启jmx 监控\"></a>修改jvm 配置文件，开启jmx 监控</h3><p>vim bin/kafka-server-start.sh</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 修改29 行</span><br><span class=\"line\">export KAFKA_HEAP_OPTS&#x3D;&quot;-Xmx6G -Xms6G&quot;</span><br><span class=\"line\">export JMX_PORT&#x3D;&quot;9999&quot;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"修改kafka01-配置文件\"><a href=\"#修改kafka01-配置文件\" class=\"headerlink\" title=\"修改kafka01 配置文件\"></a>修改kafka01 配置文件</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim &#x2F;opt&#x2F;kafka&#x2F;kafka_2.12-2.8.0&#x2F;config&#x2F;server.properties</span><br><span class=\"line\"></span><br><span class=\"line\">broker.id&#x3D;1</span><br><span class=\"line\">port&#x3D;9091</span><br><span class=\"line\">host.name&#x3D;10.200.75.180</span><br><span class=\"line\">num.network.threads&#x3D;3</span><br><span class=\"line\">num.io.threads&#x3D;8</span><br><span class=\"line\">socket.send.buffer.bytes&#x3D;102400</span><br><span class=\"line\">socket.receive.buffer.bytes&#x3D;102400</span><br><span class=\"line\">socket.request.max.bytes&#x3D;104857600</span><br><span class=\"line\">log.dirs&#x3D;&#x2F;opt&#x2F;kafka&#x2F;kafka_2.12-2.8.0&#x2F;mylog</span><br><span class=\"line\">num.partitions&#x3D;1</span><br><span class=\"line\">num.recovery.threads.per.data.dir&#x3D;1</span><br><span class=\"line\">log.retention.hours&#x3D;168</span><br><span class=\"line\">log.segment.bytes&#x3D;1073741824</span><br><span class=\"line\">log.retention.check.interval.ms&#x3D;300000</span><br><span class=\"line\">log.cleaner.enable&#x3D;false</span><br><span class=\"line\">zookeeper.connect&#x3D;10.200.75.177:2180,10.200.75.178:2180,10.200.75.179:2180</span><br><span class=\"line\">zookeeper.connection.timeout.ms&#x3D;6000</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"修改kafka02-配置文件\"><a href=\"#修改kafka02-配置文件\" class=\"headerlink\" title=\"修改kafka02 配置文件\"></a>修改kafka02 配置文件</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim &#x2F;opt&#x2F;kafka&#x2F;kafka_2.12-2.8.0&#x2F;config&#x2F;server.properties</span><br><span class=\"line\"></span><br><span class=\"line\">broker.id&#x3D;2</span><br><span class=\"line\">port&#x3D;9091</span><br><span class=\"line\">host.name&#x3D;10.200.75.181</span><br><span class=\"line\">num.network.threads&#x3D;3</span><br><span class=\"line\">num.io.threads&#x3D;8</span><br><span class=\"line\">socket.send.buffer.bytes&#x3D;102400</span><br><span class=\"line\">socket.receive.buffer.bytes&#x3D;102400</span><br><span class=\"line\">socket.request.max.bytes&#x3D;104857600</span><br><span class=\"line\">log.dirs&#x3D;&#x2F;opt&#x2F;kafka&#x2F;kafka_2.12-2.8.0&#x2F;mylog</span><br><span class=\"line\">num.partitions&#x3D;1</span><br><span class=\"line\">num.recovery.threads.per.data.dir&#x3D;1</span><br><span class=\"line\">log.retention.hours&#x3D;168</span><br><span class=\"line\">log.segment.bytes&#x3D;1073741824</span><br><span class=\"line\">log.retention.check.interval.ms&#x3D;300000</span><br><span class=\"line\">log.cleaner.enable&#x3D;false</span><br><span class=\"line\">zookeeper.connect&#x3D;10.200.75.177:2180,10.200.75.178:2180,10.200.75.179:2180</span><br><span class=\"line\">zookeeper.connection.timeout.ms&#x3D;6000</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"修改kafka03-配置文件\"><a href=\"#修改kafka03-配置文件\" class=\"headerlink\" title=\"修改kafka03 配置文件\"></a>修改kafka03 配置文件</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim &#x2F;opt&#x2F;kafka&#x2F;kafka_2.12-2.8.0&#x2F;config&#x2F;server.properties</span><br><span class=\"line\"></span><br><span class=\"line\">broker.id&#x3D;3</span><br><span class=\"line\">port&#x3D;9091</span><br><span class=\"line\">host.name&#x3D;10.200.75.182</span><br><span class=\"line\">num.network.threads&#x3D;3</span><br><span class=\"line\">num.io.threads&#x3D;8</span><br><span class=\"line\">socket.send.buffer.bytes&#x3D;102400</span><br><span class=\"line\">socket.receive.buffer.bytes&#x3D;102400</span><br><span class=\"line\">socket.request.max.bytes&#x3D;104857600</span><br><span class=\"line\">log.dirs&#x3D;&#x2F;opt&#x2F;kafka&#x2F;kafka_2.12-2.8.0&#x2F;mylog</span><br><span class=\"line\">num.partitions&#x3D;1</span><br><span class=\"line\">num.recovery.threads.per.data.dir&#x3D;1</span><br><span class=\"line\">log.retention.hours&#x3D;168</span><br><span class=\"line\">log.segment.bytes&#x3D;1073741824</span><br><span class=\"line\">log.retention.check.interval.ms&#x3D;300000</span><br><span class=\"line\">log.cleaner.enable&#x3D;false</span><br><span class=\"line\">zookeeper.connect&#x3D;10.200.75.177:2180,10.200.75.178:2180,10.200.75.179:2180</span><br><span class=\"line\">zookeeper.connection.timeout.ms&#x3D;6000</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"systemctl-管理kafka\"><a href=\"#systemctl-管理kafka\" class=\"headerlink\" title=\"systemctl 管理kafka\"></a>systemctl 管理kafka</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cat &gt; &#x2F;usr&#x2F;lib&#x2F;systemd&#x2F;system&#x2F;kafka.service &lt;&lt;&quot;EOF&quot;</span><br><span class=\"line\">[Unit]</span><br><span class=\"line\">Description&#x3D;Apache Kafka server</span><br><span class=\"line\">After&#x3D;network.target  zookeeper.service</span><br><span class=\"line\"></span><br><span class=\"line\">[Service]</span><br><span class=\"line\">Type&#x3D;simple</span><br><span class=\"line\">Environment&#x3D;JAVA_HOME&#x3D;&#x2F;opt&#x2F;jdk1.8.0_161</span><br><span class=\"line\">User&#x3D;root</span><br><span class=\"line\">Group&#x3D;root</span><br><span class=\"line\">ExecStart&#x3D;&#x2F;opt&#x2F;kafka&#x2F;kafka_2.12-2.8.0&#x2F;bin&#x2F;kafka-server-start.sh &#x2F;opt&#x2F;kafka&#x2F;kafka_2.12-2.8.0&#x2F;config&#x2F;server.properties</span><br><span class=\"line\">ExecStop&#x3D;&#x2F;opt&#x2F;kafka&#x2F;kafka_2.12-2.8.0&#x2F;bin&#x2F;kafka-server-stop.sh</span><br><span class=\"line\">Restart&#x3D;on-failure</span><br><span class=\"line\"></span><br><span class=\"line\">[Install]</span><br><span class=\"line\">WantedBy&#x3D;multi-user.target</span><br><span class=\"line\">EOF</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl daemon-reload</span><br><span class=\"line\">systemctl start kafka</span><br><span class=\"line\"></span><br><span class=\"line\">systemctl enable kafka</span><br><span class=\"line\">systemctl is-enabled kafka</span><br></pre></td></tr></table></figure>\n\n\n<h3 id=\"定期清理日志\"><a href=\"#定期清理日志\" class=\"headerlink\" title=\"定期清理日志\"></a>定期清理日志</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cat &gt; &#x2F;opt&#x2F;kafka&#x2F;kafka_2.12-2.8.0&#x2F;bin&#x2F;clean_kafka_logs.sh &lt;&lt; &quot;EOF&quot;</span><br><span class=\"line\">#!&#x2F;bin&#x2F;bash</span><br><span class=\"line\">find &#x2F;opt&#x2F;kafka&#x2F;kafka_2.12-2.8.0&#x2F;logs&#x2F; -type f -mtime +7|xargs rm -rf</span><br><span class=\"line\">EOF</span><br><span class=\"line\"></span><br><span class=\"line\">chmod +x &#x2F;opt&#x2F;kafka&#x2F;kafka_2.12-2.8.0&#x2F;bin&#x2F;clean_kafka_logs.sh</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">执行crontab -e，加入一行</span><br><span class=\"line\">0 0 * * * &#x2F;bin&#x2F;bash &#x2F;opt&#x2F;kafka&#x2F;kafka_2.12-2.8.0&#x2F;bin&#x2F;clean_kafka_logs.sh</span><br></pre></td></tr></table></figure>\n\n\n<p>操作日志清理脚本</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#!&#x2F;usr&#x2F;bin&#x2F;env bash</span><br><span class=\"line\">#  @author  Yakir.King</span><br><span class=\"line\">#  @date  2020&#x2F;8&#x2F;3 20:14</span><br><span class=\"line\"># </span><br><span class=\"line\"></span><br><span class=\"line\"># 清除多余日志</span><br><span class=\"line\"># 清除规则</span><br><span class=\"line\">## 1、保留个数，kafka默认按照小时保存日志，每小时保存一个，约定保留文件个数，默认72个</span><br><span class=\"line\">## 2、保留时间，默认保存72小时</span><br><span class=\"line\">## 3、保存大小，为避免服务出问题导致频繁刷日志，将 磁盘撑满，每个文件保留大小均不可超过1G，超过1G的文件将被清理。</span><br><span class=\"line\">###   3.1 为保留出问题的现场，所以需要保留第一个超过1G的文件。</span><br><span class=\"line\"></span><br><span class=\"line\"># 保留文件个数，默认72</span><br><span class=\"line\">RETAIN_FILES_NUM&#x3D;72</span><br><span class=\"line\"></span><br><span class=\"line\"># 保留文件时间，默认72小时，单位：小时</span><br><span class=\"line\">RETAIN_FILES_TIME&#x3D;72</span><br><span class=\"line\"></span><br><span class=\"line\"># 保存文件大小，默认1G，单位：M</span><br><span class=\"line\">RETAIN_FILE_MB&#x3D;1024</span><br><span class=\"line\"></span><br><span class=\"line\"># 日志保存目录</span><br><span class=\"line\">LOG_DIR&#x3D;&#x2F;opt&#x2F;kafka&#x2F;kafka_2.12-2.8.0&#x2F;logs</span><br><span class=\"line\"></span><br><span class=\"line\"># 保留个数方法，由于日志按照小时保存，所以使用保留时间方法即可。</span><br><span class=\"line\">function retain_files_num() &#123;</span><br><span class=\"line\">\techo &quot;&quot;</span><br><span class=\"line\"> &#125;</span><br><span class=\"line\"># 保留时间方法</span><br><span class=\"line\"># 传入参数为日志文件前缀，如server.log.2020-08-01-11 传入参数为server</span><br><span class=\"line\">function retain_files_date()&#123;</span><br><span class=\"line\">    for file_name in $* ; do</span><br><span class=\"line\">        FILE_NAME&#x3D;$&#123;file_name&#125;</span><br><span class=\"line\">        # 确认给定时间之前的时间</span><br><span class=\"line\">        DELETE_DATE&#x3D;&#96;date +%Y-%m-%d-%H -d &quot;$&#123;RETAIN_FILES_TIME&#125; hours ago&quot;&#96;</span><br><span class=\"line\">        # 获取所有日志，将日志的时间戳获取</span><br><span class=\"line\">        # 遍历所有日志文件，截取日志文件的时间戳部分，与delete_date对比，小于等于这个时间的，删除。</span><br><span class=\"line\">        for log_file in &#96;ls -1 $&#123;LOG_DIR&#125;&#x2F;$&#123;FILE_NAME&#125;.log.20*&#96;;do</span><br><span class=\"line\">            LOG_FILE_DATE&#x3D;&#96;ls -1 $&#123;log_file&#125; | awk -F . &#39;&#123;print $(NF)&#125;&#39;&#96;</span><br><span class=\"line\">            if [[ $&#123;LOG_FILE_DATE&#125; &lt; $&#123;DELETE_DATE&#125; ]]; then</span><br><span class=\"line\">                echo &quot;当前日志文件：$&#123;log_file&#125;, 保存时间已超过$&#123;RETAIN_FILES_TIME&#125;个小时，删除中……&quot;</span><br><span class=\"line\">                rm -f $&#123;LOG_DIR&#125;&#x2F;$&#123;log_file&#125;</span><br><span class=\"line\">            fi</span><br><span class=\"line\">        done</span><br><span class=\"line\">\tdone</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"># 保存大小方法</span><br><span class=\"line\"># 传入参数为日志文件前缀，如server.log.2020-08-01-11 传入参数为server</span><br><span class=\"line\">function retain_files_size()&#123;</span><br><span class=\"line\">    for file_name in $* ; do</span><br><span class=\"line\">        FILE_NAME&#x3D;$&#123;file_name&#125;</span><br><span class=\"line\">        # 判断出文件大小</span><br><span class=\"line\">        # 判断超过1G的文件个数，超过两个删除新文件（保留旧的文件，事件现场）。</span><br><span class=\"line\">        BIG_FILE_NUM&#x3D;&#96;ls -lh $&#123;LOG_DIR&#125;&#x2F;$&#123;FILE_NAME&#125;.log.20* | grep -v total | grep G | wc -l &#96;</span><br><span class=\"line\">        if [[ $&#123;BIG_FILE_NUM&#125; &gt; 1 ]];then</span><br><span class=\"line\">            flag&#x3D;1</span><br><span class=\"line\">            for log_file in &#96;ls -lh $&#123;LOG_DIR&#125;&#x2F;$&#123;FILE_NAME&#125;.log.20* | grep -v total | grep G | awk &#39;&#123;print $(NF)&#125;&#39;&#96; ;do</span><br><span class=\"line\">                if [[ $&#123;flag&#125; -gt 1 ]] ;then</span><br><span class=\"line\">                    echo &quot;当前日志文件：$&#123;log_file&#125;, 大小已超过$&#123;RETAIN_FILE_MB&#125;M，删除中……&quot;</span><br><span class=\"line\">                    rm -f $&#123;LOG_DIR&#125;&#x2F;$&#123;log_file&#125;</span><br><span class=\"line\">                fi</span><br><span class=\"line\">                ((flag++))</span><br><span class=\"line\">            done</span><br><span class=\"line\">        fi</span><br><span class=\"line\">        if [[ $&#123;BIG_FILE_NUM&#125; &#x3D;&#x3D; 1 ]];then</span><br><span class=\"line\">            echo &quot;剩余1个超过$&#123;RETAIN_FILE_MB&#125;M的文件，请检查文件过大内容，如有问题解决问题后清除。&quot;</span><br><span class=\"line\">        fi</span><br><span class=\"line\">        echo &quot;$&#123;LOG_DIR&#125;&#x2F;$&#123;FILE_NAME&#125;.log的保留文件大小正常&quot;</span><br><span class=\"line\">    done</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"># 执行保留时间方法</span><br><span class=\"line\">retain_files_date server controller kafka-authorizer kafka-request log-cleaner state-change</span><br><span class=\"line\"># 执行保留大小方法</span><br><span class=\"line\">retain_files_size server controller kafka-authorizer kafka-request log-cleaner state-change</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1 *&#x2F;1 * * * &#x2F;bin&#x2F;bash $&#123;script_home&#125;&#x2F;oplogs_cleaner.sh &gt;&gt; oplogs_cleaner.log 2&gt;&amp;1</span><br></pre></td></tr></table></figure>"},{"title":"centos7 快速启动kafkacenter","date":"2021-07-24T09:20:00.000Z","_content":"\t\n\t\n摘要: center7 快速启动kafkacenter\n<!-- more -->\n\n### 以官方文档为主\n\n### 目录创建\n```\nmkdir -p /opt/kafkaCenter/{elasticsearch/{data,config,plugins},kafkaCenter/config,mysql/{db,logs}}\n```\n\nes配置文件放在 /opt/kafkaCenter/elasticsearch/config/elasticsearch.yml\nKafkaCenter 配置文件放在 /opt/kafkaCenter/kafkaCenter/config/application.properties\n\n### es配置文件 \n```\nelasticsearch.yml\n\n#集群名\ncluster.name: \"elasticsearch\"\n# 允许外部网络访问\nnetwork.host: 0.0.0.0\n#支持跨域\nhttp.cors.enabled: true\n#支持所有域名\nhttp.cors.allow-origin: \"*\"\n# 关闭xpack安全校验，在kibana中使用就不需要输入账号密码\nxpack.security.enabled: false\n```\n\n\n### 创建 docker.compose.yml\n```\nvim /opt/kafkaCenter/docker-compose.yml\n\n\nversion: '2'\nservices: \n  mysql:\n    restart: always\n    image: mysql:5.7.16\n    container_name: mysql-server\n    volumes:\n      - /opt/kafkaCenter/mysql/db:/var/lib/mysql\n      - /opt/kafkaCenter/mysql/logs:/var/log/mysql\n    ports:\n      - 3306:3306\n    environment:\n      - MYSQL_ROOT_PASSWORD=abc123456\n\n  elasticsearch:\n    container_name: elasticsearch\n    image: elasticsearch:7.10.1\n    ports:\n      - \"9200:9200\"\n    volumes:\n      - /opt/kafkaCenter/elasticsearch/config/elasticsearch.yml:/usr/share/elasticsearch/config/elasticsearch.yml\n      - /opt/kafkaCenter/elasticsearch/data:/usr/share/elasticsearch/data\n      - /opt/kafkaCenter/elasticsearch/plugins:/usr/share/elasticsearch/plugins\n    environment:\n      - discovery.type=single-node\n      - http.port=9200\n      - http.cors.enabled=true\n      - http.cors.allow-origin=*\n      - http.cors.allow-headers=X-Requested-With,X-Auth-Token,Content-Type,Content-Length,Authorization\n      - http.cors.allow-credentials=false\n      - bootstrap.memory_lock=true\n      - 'ES_JAVA_OPTS=-Xms512m -Xmx2048m'\n      - \"COMPOSE_PROJECT_NAME=elasticsearch-server\"\n    restart: always\n\n  kafkaCenter:\n    restart: always\n    image: xaecbd/kafka-center:2.3.0\n    container_name: kafka-center\n    volumes:\n      - /opt/kafkaCenter/kafkaCenter/config/application.properties:/opt/app/kafka-center/config/application.properties\n    ports:\n      - 8080:8080\n      - 8000:8000\n    depends_on:\n      - mysql\n      - elasticsearch\n\n```\n\n### 启动 \n```\ndocker-compose up -d\n```\n\nmysql 导入表结构\n\n官方脚本地址，官方sql脚本中部分 sql 语句缺少 ; 结束，需要自己补全，不然脚本会运行错误\n```\nhttps://xaecbd.github.io/KafkaCenter/KafkaCenter-Core/sql/table_script.sql\n```\n\n配置文件导入\n官方 应用配置\n```\nhttps://xaecbd.github.io/KafkaCenter/KafkaCenter-Core/src/main/resources/application.properties\n```\n修改应用配置中的 mysql 信息，如果，localhost找不到，修改为ip:port\n\n\n\n### 错误处理\n\nelasticsearch启动报错\n\n```\nElasticsearchException[failed to bind service]; nested: AccessDeniedException[/usr/share/elasticsearch/data/nodes];\nLikely root cause: java.nio.file.AccessDeniedException: /usr/share/elasticsearch/data/nodes\n```\n\ndata 目录授权\n```\nchmod 777 /opt/kafkaCenter/elasticsearch/data\n```\n\n\n### 重启 \n```\ndocker-compose down \ndocker-compose up -d\n```\n\n\n### 未解决的报错\n\n暂时不影响使用\n```\n2021-07-24 09:36:01,325 ERROR [pool-2-thread-3] AlertaService: get virtual-email-groups has error.\njava.lang.IllegalArgumentException: URI is not absolute\n\tat java.net.URI.toURL(URI.java:1088)\n\tat org.springframework.http.client.SimpleClientHttpRequestFactory.createRequest(SimpleClientHttpRequestFactory.java:145)\n\tat org.springframework.http.client.support.HttpAccessor.createRequest(HttpAccessor.java:124)\n\tat org.springframework.web.client.RestTemplate.doExecute(RestTemplate.java:735)\n\tat org.springframework.web.client.RestTemplate.execute(RestTemplate.java:674)\n\tat org.springframework.web.client.RestTemplate.getForObject(RestTemplate.java:315)\n\tat org.nesc.ec.bigdata.service.AlertaService.getAlarmGroupMap(AlertaService.java:75)\n\tat org.nesc.ec.bigdata.job.CollectConsumerLagJob.watchAlert(CollectConsumerLagJob.java:121)\n\tat org.nesc.ec.bigdata.job.CollectConsumerLagJob.collectConsumerLag(CollectConsumerLagJob.java:83)\n\tat org.nesc.ec.bigdata.job.InitRunJob.lambda$runCollectConsumerLagJob$0(InitRunJob.java:69)\n\tat java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)\n\tat java.util.concurrent.FutureTask.runAndReset(FutureTask.java:308)\n\tat java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$301(ScheduledThreadPoolExecutor.java:180)\n\tat java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:294)\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)\n\tat java.lang.Thread.run(Thread.java:748)\n```\n","source":"_posts/install/centos7安装kafkacenter.md","raw":"---\ntitle: centos7 快速启动kafkacenter\ndate: 2021-07-24 17:20\ncategories:\n- linux\ntags:\n- kafka\n- kafkacenter\n---\n\t\n\t\n摘要: center7 快速启动kafkacenter\n<!-- more -->\n\n### 以官方文档为主\n\n### 目录创建\n```\nmkdir -p /opt/kafkaCenter/{elasticsearch/{data,config,plugins},kafkaCenter/config,mysql/{db,logs}}\n```\n\nes配置文件放在 /opt/kafkaCenter/elasticsearch/config/elasticsearch.yml\nKafkaCenter 配置文件放在 /opt/kafkaCenter/kafkaCenter/config/application.properties\n\n### es配置文件 \n```\nelasticsearch.yml\n\n#集群名\ncluster.name: \"elasticsearch\"\n# 允许外部网络访问\nnetwork.host: 0.0.0.0\n#支持跨域\nhttp.cors.enabled: true\n#支持所有域名\nhttp.cors.allow-origin: \"*\"\n# 关闭xpack安全校验，在kibana中使用就不需要输入账号密码\nxpack.security.enabled: false\n```\n\n\n### 创建 docker.compose.yml\n```\nvim /opt/kafkaCenter/docker-compose.yml\n\n\nversion: '2'\nservices: \n  mysql:\n    restart: always\n    image: mysql:5.7.16\n    container_name: mysql-server\n    volumes:\n      - /opt/kafkaCenter/mysql/db:/var/lib/mysql\n      - /opt/kafkaCenter/mysql/logs:/var/log/mysql\n    ports:\n      - 3306:3306\n    environment:\n      - MYSQL_ROOT_PASSWORD=abc123456\n\n  elasticsearch:\n    container_name: elasticsearch\n    image: elasticsearch:7.10.1\n    ports:\n      - \"9200:9200\"\n    volumes:\n      - /opt/kafkaCenter/elasticsearch/config/elasticsearch.yml:/usr/share/elasticsearch/config/elasticsearch.yml\n      - /opt/kafkaCenter/elasticsearch/data:/usr/share/elasticsearch/data\n      - /opt/kafkaCenter/elasticsearch/plugins:/usr/share/elasticsearch/plugins\n    environment:\n      - discovery.type=single-node\n      - http.port=9200\n      - http.cors.enabled=true\n      - http.cors.allow-origin=*\n      - http.cors.allow-headers=X-Requested-With,X-Auth-Token,Content-Type,Content-Length,Authorization\n      - http.cors.allow-credentials=false\n      - bootstrap.memory_lock=true\n      - 'ES_JAVA_OPTS=-Xms512m -Xmx2048m'\n      - \"COMPOSE_PROJECT_NAME=elasticsearch-server\"\n    restart: always\n\n  kafkaCenter:\n    restart: always\n    image: xaecbd/kafka-center:2.3.0\n    container_name: kafka-center\n    volumes:\n      - /opt/kafkaCenter/kafkaCenter/config/application.properties:/opt/app/kafka-center/config/application.properties\n    ports:\n      - 8080:8080\n      - 8000:8000\n    depends_on:\n      - mysql\n      - elasticsearch\n\n```\n\n### 启动 \n```\ndocker-compose up -d\n```\n\nmysql 导入表结构\n\n官方脚本地址，官方sql脚本中部分 sql 语句缺少 ; 结束，需要自己补全，不然脚本会运行错误\n```\nhttps://xaecbd.github.io/KafkaCenter/KafkaCenter-Core/sql/table_script.sql\n```\n\n配置文件导入\n官方 应用配置\n```\nhttps://xaecbd.github.io/KafkaCenter/KafkaCenter-Core/src/main/resources/application.properties\n```\n修改应用配置中的 mysql 信息，如果，localhost找不到，修改为ip:port\n\n\n\n### 错误处理\n\nelasticsearch启动报错\n\n```\nElasticsearchException[failed to bind service]; nested: AccessDeniedException[/usr/share/elasticsearch/data/nodes];\nLikely root cause: java.nio.file.AccessDeniedException: /usr/share/elasticsearch/data/nodes\n```\n\ndata 目录授权\n```\nchmod 777 /opt/kafkaCenter/elasticsearch/data\n```\n\n\n### 重启 \n```\ndocker-compose down \ndocker-compose up -d\n```\n\n\n### 未解决的报错\n\n暂时不影响使用\n```\n2021-07-24 09:36:01,325 ERROR [pool-2-thread-3] AlertaService: get virtual-email-groups has error.\njava.lang.IllegalArgumentException: URI is not absolute\n\tat java.net.URI.toURL(URI.java:1088)\n\tat org.springframework.http.client.SimpleClientHttpRequestFactory.createRequest(SimpleClientHttpRequestFactory.java:145)\n\tat org.springframework.http.client.support.HttpAccessor.createRequest(HttpAccessor.java:124)\n\tat org.springframework.web.client.RestTemplate.doExecute(RestTemplate.java:735)\n\tat org.springframework.web.client.RestTemplate.execute(RestTemplate.java:674)\n\tat org.springframework.web.client.RestTemplate.getForObject(RestTemplate.java:315)\n\tat org.nesc.ec.bigdata.service.AlertaService.getAlarmGroupMap(AlertaService.java:75)\n\tat org.nesc.ec.bigdata.job.CollectConsumerLagJob.watchAlert(CollectConsumerLagJob.java:121)\n\tat org.nesc.ec.bigdata.job.CollectConsumerLagJob.collectConsumerLag(CollectConsumerLagJob.java:83)\n\tat org.nesc.ec.bigdata.job.InitRunJob.lambda$runCollectConsumerLagJob$0(InitRunJob.java:69)\n\tat java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)\n\tat java.util.concurrent.FutureTask.runAndReset(FutureTask.java:308)\n\tat java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$301(ScheduledThreadPoolExecutor.java:180)\n\tat java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:294)\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)\n\tat java.lang.Thread.run(Thread.java:748)\n```\n","slug":"install/centos7安装kafkacenter","published":1,"updated":"2021-07-28T07:44:05.628Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cku6979zd003j00uhdrlqd8l3","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><p>摘要: center7 快速启动kafkacenter</p>\n<span id=\"more\"></span>\n\n<h3 id=\"以官方文档为主\"><a href=\"#以官方文档为主\" class=\"headerlink\" title=\"以官方文档为主\"></a>以官方文档为主</h3><h3 id=\"目录创建\"><a href=\"#目录创建\" class=\"headerlink\" title=\"目录创建\"></a>目录创建</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir -p &#x2F;opt&#x2F;kafkaCenter&#x2F;&#123;elasticsearch&#x2F;&#123;data,config,plugins&#125;,kafkaCenter&#x2F;config,mysql&#x2F;&#123;db,logs&#125;&#125;</span><br></pre></td></tr></table></figure>\n\n<p>es配置文件放在 /opt/kafkaCenter/elasticsearch/config/elasticsearch.yml<br>KafkaCenter 配置文件放在 /opt/kafkaCenter/kafkaCenter/config/application.properties</p>\n<h3 id=\"es配置文件\"><a href=\"#es配置文件\" class=\"headerlink\" title=\"es配置文件\"></a>es配置文件</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">elasticsearch.yml</span><br><span class=\"line\"></span><br><span class=\"line\">#集群名</span><br><span class=\"line\">cluster.name: &quot;elasticsearch&quot;</span><br><span class=\"line\"># 允许外部网络访问</span><br><span class=\"line\">network.host: 0.0.0.0</span><br><span class=\"line\">#支持跨域</span><br><span class=\"line\">http.cors.enabled: true</span><br><span class=\"line\">#支持所有域名</span><br><span class=\"line\">http.cors.allow-origin: &quot;*&quot;</span><br><span class=\"line\"># 关闭xpack安全校验，在kibana中使用就不需要输入账号密码</span><br><span class=\"line\">xpack.security.enabled: false</span><br></pre></td></tr></table></figure>\n\n\n<h3 id=\"创建-docker-compose-yml\"><a href=\"#创建-docker-compose-yml\" class=\"headerlink\" title=\"创建 docker.compose.yml\"></a>创建 docker.compose.yml</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim &#x2F;opt&#x2F;kafkaCenter&#x2F;docker-compose.yml</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">version: &#39;2&#39;</span><br><span class=\"line\">services: </span><br><span class=\"line\">  mysql:</span><br><span class=\"line\">    restart: always</span><br><span class=\"line\">    image: mysql:5.7.16</span><br><span class=\"line\">    container_name: mysql-server</span><br><span class=\"line\">    volumes:</span><br><span class=\"line\">      - &#x2F;opt&#x2F;kafkaCenter&#x2F;mysql&#x2F;db:&#x2F;var&#x2F;lib&#x2F;mysql</span><br><span class=\"line\">      - &#x2F;opt&#x2F;kafkaCenter&#x2F;mysql&#x2F;logs:&#x2F;var&#x2F;log&#x2F;mysql</span><br><span class=\"line\">    ports:</span><br><span class=\"line\">      - 3306:3306</span><br><span class=\"line\">    environment:</span><br><span class=\"line\">      - MYSQL_ROOT_PASSWORD&#x3D;abc123456</span><br><span class=\"line\"></span><br><span class=\"line\">  elasticsearch:</span><br><span class=\"line\">    container_name: elasticsearch</span><br><span class=\"line\">    image: elasticsearch:7.10.1</span><br><span class=\"line\">    ports:</span><br><span class=\"line\">      - &quot;9200:9200&quot;</span><br><span class=\"line\">    volumes:</span><br><span class=\"line\">      - &#x2F;opt&#x2F;kafkaCenter&#x2F;elasticsearch&#x2F;config&#x2F;elasticsearch.yml:&#x2F;usr&#x2F;share&#x2F;elasticsearch&#x2F;config&#x2F;elasticsearch.yml</span><br><span class=\"line\">      - &#x2F;opt&#x2F;kafkaCenter&#x2F;elasticsearch&#x2F;data:&#x2F;usr&#x2F;share&#x2F;elasticsearch&#x2F;data</span><br><span class=\"line\">      - &#x2F;opt&#x2F;kafkaCenter&#x2F;elasticsearch&#x2F;plugins:&#x2F;usr&#x2F;share&#x2F;elasticsearch&#x2F;plugins</span><br><span class=\"line\">    environment:</span><br><span class=\"line\">      - discovery.type&#x3D;single-node</span><br><span class=\"line\">      - http.port&#x3D;9200</span><br><span class=\"line\">      - http.cors.enabled&#x3D;true</span><br><span class=\"line\">      - http.cors.allow-origin&#x3D;*</span><br><span class=\"line\">      - http.cors.allow-headers&#x3D;X-Requested-With,X-Auth-Token,Content-Type,Content-Length,Authorization</span><br><span class=\"line\">      - http.cors.allow-credentials&#x3D;false</span><br><span class=\"line\">      - bootstrap.memory_lock&#x3D;true</span><br><span class=\"line\">      - &#39;ES_JAVA_OPTS&#x3D;-Xms512m -Xmx2048m&#39;</span><br><span class=\"line\">      - &quot;COMPOSE_PROJECT_NAME&#x3D;elasticsearch-server&quot;</span><br><span class=\"line\">    restart: always</span><br><span class=\"line\"></span><br><span class=\"line\">  kafkaCenter:</span><br><span class=\"line\">    restart: always</span><br><span class=\"line\">    image: xaecbd&#x2F;kafka-center:2.3.0</span><br><span class=\"line\">    container_name: kafka-center</span><br><span class=\"line\">    volumes:</span><br><span class=\"line\">      - &#x2F;opt&#x2F;kafkaCenter&#x2F;kafkaCenter&#x2F;config&#x2F;application.properties:&#x2F;opt&#x2F;app&#x2F;kafka-center&#x2F;config&#x2F;application.properties</span><br><span class=\"line\">    ports:</span><br><span class=\"line\">      - 8080:8080</span><br><span class=\"line\">      - 8000:8000</span><br><span class=\"line\">    depends_on:</span><br><span class=\"line\">      - mysql</span><br><span class=\"line\">      - elasticsearch</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"启动\"><a href=\"#启动\" class=\"headerlink\" title=\"启动\"></a>启动</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker-compose up -d</span><br></pre></td></tr></table></figure>\n\n<p>mysql 导入表结构</p>\n<p>官方脚本地址，官方sql脚本中部分 sql 语句缺少 ; 结束，需要自己补全，不然脚本会运行错误</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">https:&#x2F;&#x2F;xaecbd.github.io&#x2F;KafkaCenter&#x2F;KafkaCenter-Core&#x2F;sql&#x2F;table_script.sql</span><br></pre></td></tr></table></figure>\n\n<p>配置文件导入<br>官方 应用配置</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">https:&#x2F;&#x2F;xaecbd.github.io&#x2F;KafkaCenter&#x2F;KafkaCenter-Core&#x2F;src&#x2F;main&#x2F;resources&#x2F;application.properties</span><br></pre></td></tr></table></figure>\n<p>修改应用配置中的 mysql 信息，如果，localhost找不到，修改为ip:port</p>\n<h3 id=\"错误处理\"><a href=\"#错误处理\" class=\"headerlink\" title=\"错误处理\"></a>错误处理</h3><p>elasticsearch启动报错</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ElasticsearchException[failed to bind service]; nested: AccessDeniedException[&#x2F;usr&#x2F;share&#x2F;elasticsearch&#x2F;data&#x2F;nodes];</span><br><span class=\"line\">Likely root cause: java.nio.file.AccessDeniedException: &#x2F;usr&#x2F;share&#x2F;elasticsearch&#x2F;data&#x2F;nodes</span><br></pre></td></tr></table></figure>\n\n<p>data 目录授权</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">chmod 777 &#x2F;opt&#x2F;kafkaCenter&#x2F;elasticsearch&#x2F;data</span><br></pre></td></tr></table></figure>\n\n\n<h3 id=\"重启\"><a href=\"#重启\" class=\"headerlink\" title=\"重启\"></a>重启</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker-compose down </span><br><span class=\"line\">docker-compose up -d</span><br></pre></td></tr></table></figure>\n\n\n<h3 id=\"未解决的报错\"><a href=\"#未解决的报错\" class=\"headerlink\" title=\"未解决的报错\"></a>未解决的报错</h3><p>暂时不影响使用</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">2021-07-24 09:36:01,325 ERROR [pool-2-thread-3] AlertaService: get virtual-email-groups has error.</span><br><span class=\"line\">java.lang.IllegalArgumentException: URI is not absolute</span><br><span class=\"line\">\tat java.net.URI.toURL(URI.java:1088)</span><br><span class=\"line\">\tat org.springframework.http.client.SimpleClientHttpRequestFactory.createRequest(SimpleClientHttpRequestFactory.java:145)</span><br><span class=\"line\">\tat org.springframework.http.client.support.HttpAccessor.createRequest(HttpAccessor.java:124)</span><br><span class=\"line\">\tat org.springframework.web.client.RestTemplate.doExecute(RestTemplate.java:735)</span><br><span class=\"line\">\tat org.springframework.web.client.RestTemplate.execute(RestTemplate.java:674)</span><br><span class=\"line\">\tat org.springframework.web.client.RestTemplate.getForObject(RestTemplate.java:315)</span><br><span class=\"line\">\tat org.nesc.ec.bigdata.service.AlertaService.getAlarmGroupMap(AlertaService.java:75)</span><br><span class=\"line\">\tat org.nesc.ec.bigdata.job.CollectConsumerLagJob.watchAlert(CollectConsumerLagJob.java:121)</span><br><span class=\"line\">\tat org.nesc.ec.bigdata.job.CollectConsumerLagJob.collectConsumerLag(CollectConsumerLagJob.java:83)</span><br><span class=\"line\">\tat org.nesc.ec.bigdata.job.InitRunJob.lambda$runCollectConsumerLagJob$0(InitRunJob.java:69)</span><br><span class=\"line\">\tat java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)</span><br><span class=\"line\">\tat java.util.concurrent.FutureTask.runAndReset(FutureTask.java:308)</span><br><span class=\"line\">\tat java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$301(ScheduledThreadPoolExecutor.java:180)</span><br><span class=\"line\">\tat java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:294)</span><br><span class=\"line\">\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)</span><br><span class=\"line\">\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)</span><br><span class=\"line\">\tat java.lang.Thread.run(Thread.java:748)</span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"<p>摘要: center7 快速启动kafkacenter</p>","more":"<h3 id=\"以官方文档为主\"><a href=\"#以官方文档为主\" class=\"headerlink\" title=\"以官方文档为主\"></a>以官方文档为主</h3><h3 id=\"目录创建\"><a href=\"#目录创建\" class=\"headerlink\" title=\"目录创建\"></a>目录创建</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir -p &#x2F;opt&#x2F;kafkaCenter&#x2F;&#123;elasticsearch&#x2F;&#123;data,config,plugins&#125;,kafkaCenter&#x2F;config,mysql&#x2F;&#123;db,logs&#125;&#125;</span><br></pre></td></tr></table></figure>\n\n<p>es配置文件放在 /opt/kafkaCenter/elasticsearch/config/elasticsearch.yml<br>KafkaCenter 配置文件放在 /opt/kafkaCenter/kafkaCenter/config/application.properties</p>\n<h3 id=\"es配置文件\"><a href=\"#es配置文件\" class=\"headerlink\" title=\"es配置文件\"></a>es配置文件</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">elasticsearch.yml</span><br><span class=\"line\"></span><br><span class=\"line\">#集群名</span><br><span class=\"line\">cluster.name: &quot;elasticsearch&quot;</span><br><span class=\"line\"># 允许外部网络访问</span><br><span class=\"line\">network.host: 0.0.0.0</span><br><span class=\"line\">#支持跨域</span><br><span class=\"line\">http.cors.enabled: true</span><br><span class=\"line\">#支持所有域名</span><br><span class=\"line\">http.cors.allow-origin: &quot;*&quot;</span><br><span class=\"line\"># 关闭xpack安全校验，在kibana中使用就不需要输入账号密码</span><br><span class=\"line\">xpack.security.enabled: false</span><br></pre></td></tr></table></figure>\n\n\n<h3 id=\"创建-docker-compose-yml\"><a href=\"#创建-docker-compose-yml\" class=\"headerlink\" title=\"创建 docker.compose.yml\"></a>创建 docker.compose.yml</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim &#x2F;opt&#x2F;kafkaCenter&#x2F;docker-compose.yml</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">version: &#39;2&#39;</span><br><span class=\"line\">services: </span><br><span class=\"line\">  mysql:</span><br><span class=\"line\">    restart: always</span><br><span class=\"line\">    image: mysql:5.7.16</span><br><span class=\"line\">    container_name: mysql-server</span><br><span class=\"line\">    volumes:</span><br><span class=\"line\">      - &#x2F;opt&#x2F;kafkaCenter&#x2F;mysql&#x2F;db:&#x2F;var&#x2F;lib&#x2F;mysql</span><br><span class=\"line\">      - &#x2F;opt&#x2F;kafkaCenter&#x2F;mysql&#x2F;logs:&#x2F;var&#x2F;log&#x2F;mysql</span><br><span class=\"line\">    ports:</span><br><span class=\"line\">      - 3306:3306</span><br><span class=\"line\">    environment:</span><br><span class=\"line\">      - MYSQL_ROOT_PASSWORD&#x3D;abc123456</span><br><span class=\"line\"></span><br><span class=\"line\">  elasticsearch:</span><br><span class=\"line\">    container_name: elasticsearch</span><br><span class=\"line\">    image: elasticsearch:7.10.1</span><br><span class=\"line\">    ports:</span><br><span class=\"line\">      - &quot;9200:9200&quot;</span><br><span class=\"line\">    volumes:</span><br><span class=\"line\">      - &#x2F;opt&#x2F;kafkaCenter&#x2F;elasticsearch&#x2F;config&#x2F;elasticsearch.yml:&#x2F;usr&#x2F;share&#x2F;elasticsearch&#x2F;config&#x2F;elasticsearch.yml</span><br><span class=\"line\">      - &#x2F;opt&#x2F;kafkaCenter&#x2F;elasticsearch&#x2F;data:&#x2F;usr&#x2F;share&#x2F;elasticsearch&#x2F;data</span><br><span class=\"line\">      - &#x2F;opt&#x2F;kafkaCenter&#x2F;elasticsearch&#x2F;plugins:&#x2F;usr&#x2F;share&#x2F;elasticsearch&#x2F;plugins</span><br><span class=\"line\">    environment:</span><br><span class=\"line\">      - discovery.type&#x3D;single-node</span><br><span class=\"line\">      - http.port&#x3D;9200</span><br><span class=\"line\">      - http.cors.enabled&#x3D;true</span><br><span class=\"line\">      - http.cors.allow-origin&#x3D;*</span><br><span class=\"line\">      - http.cors.allow-headers&#x3D;X-Requested-With,X-Auth-Token,Content-Type,Content-Length,Authorization</span><br><span class=\"line\">      - http.cors.allow-credentials&#x3D;false</span><br><span class=\"line\">      - bootstrap.memory_lock&#x3D;true</span><br><span class=\"line\">      - &#39;ES_JAVA_OPTS&#x3D;-Xms512m -Xmx2048m&#39;</span><br><span class=\"line\">      - &quot;COMPOSE_PROJECT_NAME&#x3D;elasticsearch-server&quot;</span><br><span class=\"line\">    restart: always</span><br><span class=\"line\"></span><br><span class=\"line\">  kafkaCenter:</span><br><span class=\"line\">    restart: always</span><br><span class=\"line\">    image: xaecbd&#x2F;kafka-center:2.3.0</span><br><span class=\"line\">    container_name: kafka-center</span><br><span class=\"line\">    volumes:</span><br><span class=\"line\">      - &#x2F;opt&#x2F;kafkaCenter&#x2F;kafkaCenter&#x2F;config&#x2F;application.properties:&#x2F;opt&#x2F;app&#x2F;kafka-center&#x2F;config&#x2F;application.properties</span><br><span class=\"line\">    ports:</span><br><span class=\"line\">      - 8080:8080</span><br><span class=\"line\">      - 8000:8000</span><br><span class=\"line\">    depends_on:</span><br><span class=\"line\">      - mysql</span><br><span class=\"line\">      - elasticsearch</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"启动\"><a href=\"#启动\" class=\"headerlink\" title=\"启动\"></a>启动</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker-compose up -d</span><br></pre></td></tr></table></figure>\n\n<p>mysql 导入表结构</p>\n<p>官方脚本地址，官方sql脚本中部分 sql 语句缺少 ; 结束，需要自己补全，不然脚本会运行错误</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">https:&#x2F;&#x2F;xaecbd.github.io&#x2F;KafkaCenter&#x2F;KafkaCenter-Core&#x2F;sql&#x2F;table_script.sql</span><br></pre></td></tr></table></figure>\n\n<p>配置文件导入<br>官方 应用配置</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">https:&#x2F;&#x2F;xaecbd.github.io&#x2F;KafkaCenter&#x2F;KafkaCenter-Core&#x2F;src&#x2F;main&#x2F;resources&#x2F;application.properties</span><br></pre></td></tr></table></figure>\n<p>修改应用配置中的 mysql 信息，如果，localhost找不到，修改为ip:port</p>\n<h3 id=\"错误处理\"><a href=\"#错误处理\" class=\"headerlink\" title=\"错误处理\"></a>错误处理</h3><p>elasticsearch启动报错</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ElasticsearchException[failed to bind service]; nested: AccessDeniedException[&#x2F;usr&#x2F;share&#x2F;elasticsearch&#x2F;data&#x2F;nodes];</span><br><span class=\"line\">Likely root cause: java.nio.file.AccessDeniedException: &#x2F;usr&#x2F;share&#x2F;elasticsearch&#x2F;data&#x2F;nodes</span><br></pre></td></tr></table></figure>\n\n<p>data 目录授权</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">chmod 777 &#x2F;opt&#x2F;kafkaCenter&#x2F;elasticsearch&#x2F;data</span><br></pre></td></tr></table></figure>\n\n\n<h3 id=\"重启\"><a href=\"#重启\" class=\"headerlink\" title=\"重启\"></a>重启</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker-compose down </span><br><span class=\"line\">docker-compose up -d</span><br></pre></td></tr></table></figure>\n\n\n<h3 id=\"未解决的报错\"><a href=\"#未解决的报错\" class=\"headerlink\" title=\"未解决的报错\"></a>未解决的报错</h3><p>暂时不影响使用</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">2021-07-24 09:36:01,325 ERROR [pool-2-thread-3] AlertaService: get virtual-email-groups has error.</span><br><span class=\"line\">java.lang.IllegalArgumentException: URI is not absolute</span><br><span class=\"line\">\tat java.net.URI.toURL(URI.java:1088)</span><br><span class=\"line\">\tat org.springframework.http.client.SimpleClientHttpRequestFactory.createRequest(SimpleClientHttpRequestFactory.java:145)</span><br><span class=\"line\">\tat org.springframework.http.client.support.HttpAccessor.createRequest(HttpAccessor.java:124)</span><br><span class=\"line\">\tat org.springframework.web.client.RestTemplate.doExecute(RestTemplate.java:735)</span><br><span class=\"line\">\tat org.springframework.web.client.RestTemplate.execute(RestTemplate.java:674)</span><br><span class=\"line\">\tat org.springframework.web.client.RestTemplate.getForObject(RestTemplate.java:315)</span><br><span class=\"line\">\tat org.nesc.ec.bigdata.service.AlertaService.getAlarmGroupMap(AlertaService.java:75)</span><br><span class=\"line\">\tat org.nesc.ec.bigdata.job.CollectConsumerLagJob.watchAlert(CollectConsumerLagJob.java:121)</span><br><span class=\"line\">\tat org.nesc.ec.bigdata.job.CollectConsumerLagJob.collectConsumerLag(CollectConsumerLagJob.java:83)</span><br><span class=\"line\">\tat org.nesc.ec.bigdata.job.InitRunJob.lambda$runCollectConsumerLagJob$0(InitRunJob.java:69)</span><br><span class=\"line\">\tat java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)</span><br><span class=\"line\">\tat java.util.concurrent.FutureTask.runAndReset(FutureTask.java:308)</span><br><span class=\"line\">\tat java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$301(ScheduledThreadPoolExecutor.java:180)</span><br><span class=\"line\">\tat java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:294)</span><br><span class=\"line\">\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)</span><br><span class=\"line\">\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)</span><br><span class=\"line\">\tat java.lang.Thread.run(Thread.java:748)</span><br></pre></td></tr></table></figure>"},{"title":"centos7 安装mongodb4.4","date":"2021-07-24T11:13:00.000Z","_content":"\t\n\t\n摘要: centos7 安装mongodb4.4\n<!-- more -->\n\n\n## 下载\n```\nhttps://www.mongodb.com/try/download/community\n```\n\n## 解压\n```\ntar xf mongodb-linux-x86_64-rhel70-4.4.7.tgz -C /opt/mongodb/\n```\n\n## 创建目录\n```\ncd /opt/mongodb/mongodb-linux-x86_64-rhel70-4.4.7/bin/\nmkdir logs config data\n```\n\n## systemc 管理\n```\nvim /lib/systemd/system/mongodb.service\n\n\n[Unit] \n   \nDescription=mongodb  \nAfter=network.target remote-fs.target nss-lookup.target \n   \n[Service] \nType=forking \nExecStart=/opt/mongodb/mongodb-linux-x86_64-rhel70-4.4.7/bin/mongod --config  /opt/mongodb/mongodb-linux-x86_64-rhel70-4.4.7/config/mongodb.conf\nExecReload=/bin/kill -s HUP $MAINPID \nExecStop=/opt/mongodb/mongodb-linux-x86_64-rhel70-4.4.7/bin/mongod --shutdown --config  /opt/mongodb/mongodb-linux-x86_64-rhel70-4.4.7/config/mongodb.conf\nPrivateTmp=true\n     \n[Install] \nWantedBy=multi-user.target\n\n```\n\nvim config/mongodb.conf\n```\nsystemLog:\n  destination: file\n  path: /opt/mongodb/mongodb-linux-x86_64-rhel70-4.4.7/logs/mongod.log\n  logAppend: true\n\tquiet: true\nprocessManagement:\n  fork: true\n  pidFilePath: \"/opt/mongodb/mongodb-linux-x86_64-rhel70-4.4.7/data/mongod.pid\"\nnet:\n  port: 27017\n  http:\n    enabled: true\nstorage:\n  dbPath: \"/opt/mongodb/mongodb-linux-x86_64-rhel70-4.4.7/data\"\n  engine: wiredTiger\n  wiredTiger:\n    engineConfig:\n      cacheSizeGB: 1\n      directoryForIndexes: true\n    collectionConfig:\n      blockCompressor: zlib\n    indexConfig:\n      prefixCompression: true\n  journal:\n    enabled: true\n  directoryPerDB: true\nsecurity:\n  authorization: enabled      # 开启关闭验证\n```\n\n\n```\nsystemctl daemon-reload\nsystemctl start mongodb\n\nsystemctl enable mongodb\nsystemctl is-enabled mongodb\n```","source":"_posts/install/centos7安装mongodb.md","raw":"---\ntitle: centos7 安装mongodb4.4\ndate: 2021-07-24 19:13\ncategories:\n- linux\ntags:\n- mongodb\n---\n\t\n\t\n摘要: centos7 安装mongodb4.4\n<!-- more -->\n\n\n## 下载\n```\nhttps://www.mongodb.com/try/download/community\n```\n\n## 解压\n```\ntar xf mongodb-linux-x86_64-rhel70-4.4.7.tgz -C /opt/mongodb/\n```\n\n## 创建目录\n```\ncd /opt/mongodb/mongodb-linux-x86_64-rhel70-4.4.7/bin/\nmkdir logs config data\n```\n\n## systemc 管理\n```\nvim /lib/systemd/system/mongodb.service\n\n\n[Unit] \n   \nDescription=mongodb  \nAfter=network.target remote-fs.target nss-lookup.target \n   \n[Service] \nType=forking \nExecStart=/opt/mongodb/mongodb-linux-x86_64-rhel70-4.4.7/bin/mongod --config  /opt/mongodb/mongodb-linux-x86_64-rhel70-4.4.7/config/mongodb.conf\nExecReload=/bin/kill -s HUP $MAINPID \nExecStop=/opt/mongodb/mongodb-linux-x86_64-rhel70-4.4.7/bin/mongod --shutdown --config  /opt/mongodb/mongodb-linux-x86_64-rhel70-4.4.7/config/mongodb.conf\nPrivateTmp=true\n     \n[Install] \nWantedBy=multi-user.target\n\n```\n\nvim config/mongodb.conf\n```\nsystemLog:\n  destination: file\n  path: /opt/mongodb/mongodb-linux-x86_64-rhel70-4.4.7/logs/mongod.log\n  logAppend: true\n\tquiet: true\nprocessManagement:\n  fork: true\n  pidFilePath: \"/opt/mongodb/mongodb-linux-x86_64-rhel70-4.4.7/data/mongod.pid\"\nnet:\n  port: 27017\n  http:\n    enabled: true\nstorage:\n  dbPath: \"/opt/mongodb/mongodb-linux-x86_64-rhel70-4.4.7/data\"\n  engine: wiredTiger\n  wiredTiger:\n    engineConfig:\n      cacheSizeGB: 1\n      directoryForIndexes: true\n    collectionConfig:\n      blockCompressor: zlib\n    indexConfig:\n      prefixCompression: true\n  journal:\n    enabled: true\n  directoryPerDB: true\nsecurity:\n  authorization: enabled      # 开启关闭验证\n```\n\n\n```\nsystemctl daemon-reload\nsystemctl start mongodb\n\nsystemctl enable mongodb\nsystemctl is-enabled mongodb\n```","slug":"install/centos7安装mongodb","published":1,"updated":"2021-07-24T11:35:28.640Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cku6979ze003m00uhcvl50pjz","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><p>摘要: centos7 安装mongodb4.4</p>\n<span id=\"more\"></span>\n\n\n<h2 id=\"下载\"><a href=\"#下载\" class=\"headerlink\" title=\"下载\"></a>下载</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">https:&#x2F;&#x2F;www.mongodb.com&#x2F;try&#x2F;download&#x2F;community</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"解压\"><a href=\"#解压\" class=\"headerlink\" title=\"解压\"></a>解压</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tar xf mongodb-linux-x86_64-rhel70-4.4.7.tgz -C &#x2F;opt&#x2F;mongodb&#x2F;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"创建目录\"><a href=\"#创建目录\" class=\"headerlink\" title=\"创建目录\"></a>创建目录</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd &#x2F;opt&#x2F;mongodb&#x2F;mongodb-linux-x86_64-rhel70-4.4.7&#x2F;bin&#x2F;</span><br><span class=\"line\">mkdir logs config data</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"systemc-管理\"><a href=\"#systemc-管理\" class=\"headerlink\" title=\"systemc 管理\"></a>systemc 管理</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim &#x2F;lib&#x2F;systemd&#x2F;system&#x2F;mongodb.service</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">[Unit] </span><br><span class=\"line\">   </span><br><span class=\"line\">Description&#x3D;mongodb  </span><br><span class=\"line\">After&#x3D;network.target remote-fs.target nss-lookup.target </span><br><span class=\"line\">   </span><br><span class=\"line\">[Service] </span><br><span class=\"line\">Type&#x3D;forking </span><br><span class=\"line\">ExecStart&#x3D;&#x2F;opt&#x2F;mongodb&#x2F;mongodb-linux-x86_64-rhel70-4.4.7&#x2F;bin&#x2F;mongod --config  &#x2F;opt&#x2F;mongodb&#x2F;mongodb-linux-x86_64-rhel70-4.4.7&#x2F;config&#x2F;mongodb.conf</span><br><span class=\"line\">ExecReload&#x3D;&#x2F;bin&#x2F;kill -s HUP $MAINPID </span><br><span class=\"line\">ExecStop&#x3D;&#x2F;opt&#x2F;mongodb&#x2F;mongodb-linux-x86_64-rhel70-4.4.7&#x2F;bin&#x2F;mongod --shutdown --config  &#x2F;opt&#x2F;mongodb&#x2F;mongodb-linux-x86_64-rhel70-4.4.7&#x2F;config&#x2F;mongodb.conf</span><br><span class=\"line\">PrivateTmp&#x3D;true</span><br><span class=\"line\">     </span><br><span class=\"line\">[Install] </span><br><span class=\"line\">WantedBy&#x3D;multi-user.target</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>vim config/mongodb.conf</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemLog:</span><br><span class=\"line\">  destination: file</span><br><span class=\"line\">  path: &#x2F;opt&#x2F;mongodb&#x2F;mongodb-linux-x86_64-rhel70-4.4.7&#x2F;logs&#x2F;mongod.log</span><br><span class=\"line\">  logAppend: true</span><br><span class=\"line\">\tquiet: true</span><br><span class=\"line\">processManagement:</span><br><span class=\"line\">  fork: true</span><br><span class=\"line\">  pidFilePath: &quot;&#x2F;opt&#x2F;mongodb&#x2F;mongodb-linux-x86_64-rhel70-4.4.7&#x2F;data&#x2F;mongod.pid&quot;</span><br><span class=\"line\">net:</span><br><span class=\"line\">  port: 27017</span><br><span class=\"line\">  http:</span><br><span class=\"line\">    enabled: true</span><br><span class=\"line\">storage:</span><br><span class=\"line\">  dbPath: &quot;&#x2F;opt&#x2F;mongodb&#x2F;mongodb-linux-x86_64-rhel70-4.4.7&#x2F;data&quot;</span><br><span class=\"line\">  engine: wiredTiger</span><br><span class=\"line\">  wiredTiger:</span><br><span class=\"line\">    engineConfig:</span><br><span class=\"line\">      cacheSizeGB: 1</span><br><span class=\"line\">      directoryForIndexes: true</span><br><span class=\"line\">    collectionConfig:</span><br><span class=\"line\">      blockCompressor: zlib</span><br><span class=\"line\">    indexConfig:</span><br><span class=\"line\">      prefixCompression: true</span><br><span class=\"line\">  journal:</span><br><span class=\"line\">    enabled: true</span><br><span class=\"line\">  directoryPerDB: true</span><br><span class=\"line\">security:</span><br><span class=\"line\">  authorization: enabled      # 开启关闭验证</span><br></pre></td></tr></table></figure>\n\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl daemon-reload</span><br><span class=\"line\">systemctl start mongodb</span><br><span class=\"line\"></span><br><span class=\"line\">systemctl enable mongodb</span><br><span class=\"line\">systemctl is-enabled mongodb</span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"<p>摘要: centos7 安装mongodb4.4</p>","more":"<h2 id=\"下载\"><a href=\"#下载\" class=\"headerlink\" title=\"下载\"></a>下载</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">https:&#x2F;&#x2F;www.mongodb.com&#x2F;try&#x2F;download&#x2F;community</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"解压\"><a href=\"#解压\" class=\"headerlink\" title=\"解压\"></a>解压</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tar xf mongodb-linux-x86_64-rhel70-4.4.7.tgz -C &#x2F;opt&#x2F;mongodb&#x2F;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"创建目录\"><a href=\"#创建目录\" class=\"headerlink\" title=\"创建目录\"></a>创建目录</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd &#x2F;opt&#x2F;mongodb&#x2F;mongodb-linux-x86_64-rhel70-4.4.7&#x2F;bin&#x2F;</span><br><span class=\"line\">mkdir logs config data</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"systemc-管理\"><a href=\"#systemc-管理\" class=\"headerlink\" title=\"systemc 管理\"></a>systemc 管理</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim &#x2F;lib&#x2F;systemd&#x2F;system&#x2F;mongodb.service</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">[Unit] </span><br><span class=\"line\">   </span><br><span class=\"line\">Description&#x3D;mongodb  </span><br><span class=\"line\">After&#x3D;network.target remote-fs.target nss-lookup.target </span><br><span class=\"line\">   </span><br><span class=\"line\">[Service] </span><br><span class=\"line\">Type&#x3D;forking </span><br><span class=\"line\">ExecStart&#x3D;&#x2F;opt&#x2F;mongodb&#x2F;mongodb-linux-x86_64-rhel70-4.4.7&#x2F;bin&#x2F;mongod --config  &#x2F;opt&#x2F;mongodb&#x2F;mongodb-linux-x86_64-rhel70-4.4.7&#x2F;config&#x2F;mongodb.conf</span><br><span class=\"line\">ExecReload&#x3D;&#x2F;bin&#x2F;kill -s HUP $MAINPID </span><br><span class=\"line\">ExecStop&#x3D;&#x2F;opt&#x2F;mongodb&#x2F;mongodb-linux-x86_64-rhel70-4.4.7&#x2F;bin&#x2F;mongod --shutdown --config  &#x2F;opt&#x2F;mongodb&#x2F;mongodb-linux-x86_64-rhel70-4.4.7&#x2F;config&#x2F;mongodb.conf</span><br><span class=\"line\">PrivateTmp&#x3D;true</span><br><span class=\"line\">     </span><br><span class=\"line\">[Install] </span><br><span class=\"line\">WantedBy&#x3D;multi-user.target</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>vim config/mongodb.conf</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemLog:</span><br><span class=\"line\">  destination: file</span><br><span class=\"line\">  path: &#x2F;opt&#x2F;mongodb&#x2F;mongodb-linux-x86_64-rhel70-4.4.7&#x2F;logs&#x2F;mongod.log</span><br><span class=\"line\">  logAppend: true</span><br><span class=\"line\">\tquiet: true</span><br><span class=\"line\">processManagement:</span><br><span class=\"line\">  fork: true</span><br><span class=\"line\">  pidFilePath: &quot;&#x2F;opt&#x2F;mongodb&#x2F;mongodb-linux-x86_64-rhel70-4.4.7&#x2F;data&#x2F;mongod.pid&quot;</span><br><span class=\"line\">net:</span><br><span class=\"line\">  port: 27017</span><br><span class=\"line\">  http:</span><br><span class=\"line\">    enabled: true</span><br><span class=\"line\">storage:</span><br><span class=\"line\">  dbPath: &quot;&#x2F;opt&#x2F;mongodb&#x2F;mongodb-linux-x86_64-rhel70-4.4.7&#x2F;data&quot;</span><br><span class=\"line\">  engine: wiredTiger</span><br><span class=\"line\">  wiredTiger:</span><br><span class=\"line\">    engineConfig:</span><br><span class=\"line\">      cacheSizeGB: 1</span><br><span class=\"line\">      directoryForIndexes: true</span><br><span class=\"line\">    collectionConfig:</span><br><span class=\"line\">      blockCompressor: zlib</span><br><span class=\"line\">    indexConfig:</span><br><span class=\"line\">      prefixCompression: true</span><br><span class=\"line\">  journal:</span><br><span class=\"line\">    enabled: true</span><br><span class=\"line\">  directoryPerDB: true</span><br><span class=\"line\">security:</span><br><span class=\"line\">  authorization: enabled      # 开启关闭验证</span><br></pre></td></tr></table></figure>\n\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl daemon-reload</span><br><span class=\"line\">systemctl start mongodb</span><br><span class=\"line\"></span><br><span class=\"line\">systemctl enable mongodb</span><br><span class=\"line\">systemctl is-enabled mongodb</span><br></pre></td></tr></table></figure>"},{"title":"centos7安装mysql","date":"2021-07-28T06:15:00.000Z","_content":"\t\n\t\n摘要: centos7安装mysql\n<!-- more -->\n\n\n\n## 创建目录\n```\nmkdir -p /data/\n```\n\n## 获取mysql\n```\ncurl -O https://downloads.mysql.com/archives/get/p/23/file/mysql-5.7.24-linux-glibc2.12-x86_64.tar.gz\n```\n\n## 创建用户和用户组\n```\nuseradd -M -s /sbin/nologin mysql\n```\n\n## \n```\nyum remove mariadb-libs-5.5.68-1.el7.x86_64 -y\n\nyum install libaio -y\n```\n\n\n## 解压mysql \n```\ntar -xvzf mysql-5.7.24-linux-glibc2.12-x86_64.tar.gz\nln -s /opt/soft/mysql-5.7.26-linux-glibc2.12-x86_64 /opt/mysql\nln -s /opt/mysql/bin/mysql /usr/bin/mysql\n```\n\n## 创建目录\n```\nmkdir /opt/mysql/{data,binlog,logs,tmp,var}\n```\n\n## 初始化mysql,  这里会生成一个初始的临时密码，需要记录下来\n```\n./mysqld --initialize --user=mysql --basedir=/opt/mysql/ --datadir=/opt/mysql/data/ --lc_messages_dir=/opt/mysql/share --lc_messages=en_US\n\n\n2021-07-29T10:08:10.580290Z 0 [Warning] TIMESTAMP with implicit DEFAULT value is deprecated. Please use --explicit_defaults_for_timestamp server option (see documentation for more details).\n2021-07-29T10:08:12.397039Z 0 [Warning] InnoDB: New log files created, LSN=45790\n2021-07-29T10:08:12.475903Z 0 [Warning] InnoDB: Creating foreign key constraint system tables.\n2021-07-29T10:08:12.535095Z 0 [Warning] No existing UUID has been found, so we assume that this is the first time that this server has been started. Generating a new UUID: e20cf3d5-f054-11eb-b9fd-5254dc08bf38.\n2021-07-29T10:08:12.537662Z 0 [Warning] Gtid table is not ready to be used. Table 'mysql.gtid_executed' cannot be opened.\n2021-07-29T10:08:12.538134Z 1 [Note] A temporary password is generated for root@localhost: Nohso!AUs1ex\n\n```\n记录下密码\n\n\n## 编辑my.cnf\n```\nvim /etc/my.cnf\n\n[mysqld]\nbasedir=/opt/mysql/\ndatadir=/opt/mysql/data/\nsocket=/opt/mysql/data/mysql.sock\n \n[client]\nport=3306\nsocket=/opt/mysql/data/mysql.sock\n```\n\n### bms  my.cnf\n```\n[mysql]\nport=3306\ndefault-character-set=utf8mb4\nno-auto-rehash\n\n[client]\nport=3306\nsocket=/opt/mysql/var/mysql.sock\n\n[mysqld]\n#dir\nbasedir=/opt/mysql\ndatadir=/opt/mysql/data\ntmpdir=/opt/mysql/tmp\nlog-error=/opt/mysql/logs/alert.log\nlog_error_verbosity=1\nslow_query_log_file=/opt/mysql/logs/slow.log\ngeneral_log_file=/opt/mysql/logs/general.log\nsocket=/opt/mysql/var/mysql.sock\nuser=mysql\nsql_mode=strict_trans_tables\nperformance_schema=1\n\n#innodb\ninnodb_data_home_dir=/opt/mysql/data\ninnodb_log_group_home_dir=/opt/mysql/data\ninnodb_data_file_path=ibdata1:10M:autoextend\ninnodb_buffer_pool_size=1G\ninnodb_buffer_pool_instances=4\ninnodb_log_files_in_group=2\ninnodb_log_file_size=1G\ninnodb_log_buffer_size=200M\ninnodb_flush_log_at_trx_commit=1\ninnodb_max_dirty_pages_pct=60\ninnodb_io_capacity=1000\ninnodb_thread_concurrency=16\ninnodb_read_io_threads=8\ninnodb_write_io_threads=8\ninnodb_open_files=60000\ninnodb_file_format=Barracuda\ninnodb_file_per_table=1\n#innodb_flush_method=O_DIRECT\ninnodb_change_buffering=inserts\ninnodb_adaptive_flushing=1\ninnodb_old_blocks_time=1000\ninnodb_stats_on_metadata=0\ninnodb_read_ahead_threshold=0\ninnodb_use_native_aio=0\ninnodb_lock_wait_timeout=5\ninnodb_rollback_on_timeout=0\ninnodb_purge_threads=4\ninnodb_strict_mode=1\ntransaction-isolation=READ-COMMITTED\n\n#myisam\nkey_buffer_size=64M\nmyisam_sort_buffer_size=64M\nconcurrent_insert=2\ndelayed_insert_timeout=300\n\n#binlog\nlog-bin=/opt/mysql/binlog/mysql-bin\nserver_id=151\nbinlog_cache_size=32K\nmax_binlog_cache_size=2G\nmax_binlog_size=500M\nbinlog-format=ROW\nsync_binlog=1000\nlog-slave-updates=1\nexpire_logs_days=8\n\n#server\ndefault-storage-engine=INNODB\ncharacter-set-server=utf8mb4\nlower_case_table_names=1\nskip-external-locking\nopen_files_limit=65536\nsafe-user-create\nlocal-infile=1\n#sqlmod=\"STRICT_ALL_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE\"\n\nlog_slow_admin_statements=1\nlog_warnings=1\nlong_query_time=1\nslow_query_log=1\ngeneral_log=0\n\nquery_cache_type=0\nquery_cache_limit=1M\nquery_cache_min_res_unit=1K\n\ntable_definition_cache=65536\n\nthread_stack=512K\nthread_cache_size=256\nread_rnd_buffer_size=128K\nsort_buffer_size=256K\njoin_buffer_size=128K\nread_buffer_size=128K\n\nport=3306\n#skip-name-resolve\nskip-ssl\nmax_connections=4500\nmax_user_connections=4000\nmax_connect_errors=65536\nmax_allowed_packet=128M\nconnect_timeout=8\nnet_read_timeout=30\nnet_write_timeout=60\nback_log=1024\n\nexplicit_defaults_for_timestamp=true\n\ndefault-time_zone='+8:00'\nlog_timestamps = system\n```\n\n\n## 授权\n```\nchown -R mysql /opt/mysql/*\n```\n\n```\nvim /etc/security/limits.conf\n\n## 增加\nmysql hard nofile 65535\nmysql soft nofile 65535\n```\n\n## 创建systemd管理项\n```\nvim /usr/lib/systemd/system/mysqld.service\n\n\n[Unit]\nDescription=MySQL Server\nDocumentation=mysqld\nDocumentation=http://dev.mysql.com/doc/refman/en/using-systemd.html\nAfter=network.target\nAfter=syslog.target\n[Install]\nWantedBy=multi-user.target\n[Service]\nUser=mysql\nGroup=mysql\nExecStart=/opt/mysql/bin/mysqld --defaults-file=/etc/my.cnf\nLimitNOFILE = 65535\n\n```\n\n```\nsystemctl daemon-reload\n\nsystemctl start mysqld.service\nsystemctl status mysqld.service\nsystemctl enable mysqld.service\n```\n\n\n## 设置mysql远程访问，输入之前生成的临时密码\n修改临时密码\n```\n./mysql -uroot -p\n\nALTER USER USER() IDENTIFIED BY 'yF!kFXFd!hc9mZbB';\n```\n\n设置root远程访问\n\n```\nuse mysql\nGRANT ALL PRIVILEGES ON *.* TO'root'@'%' IDENTIFIED BY'pHE8HXGteTBw' WITH GRANT OPTION;\nFLUSH PRIVILEGES;\n```\n","source":"_posts/install/centos7安装mysql.md","raw":"---\ntitle: centos7安装mysql\ndate: 2021-07-28 14:15\ncategories:\n- linux\ntags:\n- mysql\n---\n\t\n\t\n摘要: centos7安装mysql\n<!-- more -->\n\n\n\n## 创建目录\n```\nmkdir -p /data/\n```\n\n## 获取mysql\n```\ncurl -O https://downloads.mysql.com/archives/get/p/23/file/mysql-5.7.24-linux-glibc2.12-x86_64.tar.gz\n```\n\n## 创建用户和用户组\n```\nuseradd -M -s /sbin/nologin mysql\n```\n\n## \n```\nyum remove mariadb-libs-5.5.68-1.el7.x86_64 -y\n\nyum install libaio -y\n```\n\n\n## 解压mysql \n```\ntar -xvzf mysql-5.7.24-linux-glibc2.12-x86_64.tar.gz\nln -s /opt/soft/mysql-5.7.26-linux-glibc2.12-x86_64 /opt/mysql\nln -s /opt/mysql/bin/mysql /usr/bin/mysql\n```\n\n## 创建目录\n```\nmkdir /opt/mysql/{data,binlog,logs,tmp,var}\n```\n\n## 初始化mysql,  这里会生成一个初始的临时密码，需要记录下来\n```\n./mysqld --initialize --user=mysql --basedir=/opt/mysql/ --datadir=/opt/mysql/data/ --lc_messages_dir=/opt/mysql/share --lc_messages=en_US\n\n\n2021-07-29T10:08:10.580290Z 0 [Warning] TIMESTAMP with implicit DEFAULT value is deprecated. Please use --explicit_defaults_for_timestamp server option (see documentation for more details).\n2021-07-29T10:08:12.397039Z 0 [Warning] InnoDB: New log files created, LSN=45790\n2021-07-29T10:08:12.475903Z 0 [Warning] InnoDB: Creating foreign key constraint system tables.\n2021-07-29T10:08:12.535095Z 0 [Warning] No existing UUID has been found, so we assume that this is the first time that this server has been started. Generating a new UUID: e20cf3d5-f054-11eb-b9fd-5254dc08bf38.\n2021-07-29T10:08:12.537662Z 0 [Warning] Gtid table is not ready to be used. Table 'mysql.gtid_executed' cannot be opened.\n2021-07-29T10:08:12.538134Z 1 [Note] A temporary password is generated for root@localhost: Nohso!AUs1ex\n\n```\n记录下密码\n\n\n## 编辑my.cnf\n```\nvim /etc/my.cnf\n\n[mysqld]\nbasedir=/opt/mysql/\ndatadir=/opt/mysql/data/\nsocket=/opt/mysql/data/mysql.sock\n \n[client]\nport=3306\nsocket=/opt/mysql/data/mysql.sock\n```\n\n### bms  my.cnf\n```\n[mysql]\nport=3306\ndefault-character-set=utf8mb4\nno-auto-rehash\n\n[client]\nport=3306\nsocket=/opt/mysql/var/mysql.sock\n\n[mysqld]\n#dir\nbasedir=/opt/mysql\ndatadir=/opt/mysql/data\ntmpdir=/opt/mysql/tmp\nlog-error=/opt/mysql/logs/alert.log\nlog_error_verbosity=1\nslow_query_log_file=/opt/mysql/logs/slow.log\ngeneral_log_file=/opt/mysql/logs/general.log\nsocket=/opt/mysql/var/mysql.sock\nuser=mysql\nsql_mode=strict_trans_tables\nperformance_schema=1\n\n#innodb\ninnodb_data_home_dir=/opt/mysql/data\ninnodb_log_group_home_dir=/opt/mysql/data\ninnodb_data_file_path=ibdata1:10M:autoextend\ninnodb_buffer_pool_size=1G\ninnodb_buffer_pool_instances=4\ninnodb_log_files_in_group=2\ninnodb_log_file_size=1G\ninnodb_log_buffer_size=200M\ninnodb_flush_log_at_trx_commit=1\ninnodb_max_dirty_pages_pct=60\ninnodb_io_capacity=1000\ninnodb_thread_concurrency=16\ninnodb_read_io_threads=8\ninnodb_write_io_threads=8\ninnodb_open_files=60000\ninnodb_file_format=Barracuda\ninnodb_file_per_table=1\n#innodb_flush_method=O_DIRECT\ninnodb_change_buffering=inserts\ninnodb_adaptive_flushing=1\ninnodb_old_blocks_time=1000\ninnodb_stats_on_metadata=0\ninnodb_read_ahead_threshold=0\ninnodb_use_native_aio=0\ninnodb_lock_wait_timeout=5\ninnodb_rollback_on_timeout=0\ninnodb_purge_threads=4\ninnodb_strict_mode=1\ntransaction-isolation=READ-COMMITTED\n\n#myisam\nkey_buffer_size=64M\nmyisam_sort_buffer_size=64M\nconcurrent_insert=2\ndelayed_insert_timeout=300\n\n#binlog\nlog-bin=/opt/mysql/binlog/mysql-bin\nserver_id=151\nbinlog_cache_size=32K\nmax_binlog_cache_size=2G\nmax_binlog_size=500M\nbinlog-format=ROW\nsync_binlog=1000\nlog-slave-updates=1\nexpire_logs_days=8\n\n#server\ndefault-storage-engine=INNODB\ncharacter-set-server=utf8mb4\nlower_case_table_names=1\nskip-external-locking\nopen_files_limit=65536\nsafe-user-create\nlocal-infile=1\n#sqlmod=\"STRICT_ALL_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE\"\n\nlog_slow_admin_statements=1\nlog_warnings=1\nlong_query_time=1\nslow_query_log=1\ngeneral_log=0\n\nquery_cache_type=0\nquery_cache_limit=1M\nquery_cache_min_res_unit=1K\n\ntable_definition_cache=65536\n\nthread_stack=512K\nthread_cache_size=256\nread_rnd_buffer_size=128K\nsort_buffer_size=256K\njoin_buffer_size=128K\nread_buffer_size=128K\n\nport=3306\n#skip-name-resolve\nskip-ssl\nmax_connections=4500\nmax_user_connections=4000\nmax_connect_errors=65536\nmax_allowed_packet=128M\nconnect_timeout=8\nnet_read_timeout=30\nnet_write_timeout=60\nback_log=1024\n\nexplicit_defaults_for_timestamp=true\n\ndefault-time_zone='+8:00'\nlog_timestamps = system\n```\n\n\n## 授权\n```\nchown -R mysql /opt/mysql/*\n```\n\n```\nvim /etc/security/limits.conf\n\n## 增加\nmysql hard nofile 65535\nmysql soft nofile 65535\n```\n\n## 创建systemd管理项\n```\nvim /usr/lib/systemd/system/mysqld.service\n\n\n[Unit]\nDescription=MySQL Server\nDocumentation=mysqld\nDocumentation=http://dev.mysql.com/doc/refman/en/using-systemd.html\nAfter=network.target\nAfter=syslog.target\n[Install]\nWantedBy=multi-user.target\n[Service]\nUser=mysql\nGroup=mysql\nExecStart=/opt/mysql/bin/mysqld --defaults-file=/etc/my.cnf\nLimitNOFILE = 65535\n\n```\n\n```\nsystemctl daemon-reload\n\nsystemctl start mysqld.service\nsystemctl status mysqld.service\nsystemctl enable mysqld.service\n```\n\n\n## 设置mysql远程访问，输入之前生成的临时密码\n修改临时密码\n```\n./mysql -uroot -p\n\nALTER USER USER() IDENTIFIED BY 'yF!kFXFd!hc9mZbB';\n```\n\n设置root远程访问\n\n```\nuse mysql\nGRANT ALL PRIVILEGES ON *.* TO'root'@'%' IDENTIFIED BY'pHE8HXGteTBw' WITH GRANT OPTION;\nFLUSH PRIVILEGES;\n```\n","slug":"install/centos7安装mysql","published":1,"updated":"2021-07-30T07:36:23.977Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cku6979zf003p00uh20i54w5c","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><p>摘要: centos7安装mysql</p>\n<span id=\"more\"></span>\n\n\n\n<h2 id=\"创建目录\"><a href=\"#创建目录\" class=\"headerlink\" title=\"创建目录\"></a>创建目录</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir -p &#x2F;data&#x2F;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"获取mysql\"><a href=\"#获取mysql\" class=\"headerlink\" title=\"获取mysql\"></a>获取mysql</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -O https:&#x2F;&#x2F;downloads.mysql.com&#x2F;archives&#x2F;get&#x2F;p&#x2F;23&#x2F;file&#x2F;mysql-5.7.24-linux-glibc2.12-x86_64.tar.gz</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"创建用户和用户组\"><a href=\"#创建用户和用户组\" class=\"headerlink\" title=\"创建用户和用户组\"></a>创建用户和用户组</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">useradd -M -s &#x2F;sbin&#x2F;nologin mysql</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum remove mariadb-libs-5.5.68-1.el7.x86_64 -y</span><br><span class=\"line\"></span><br><span class=\"line\">yum install libaio -y</span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"解压mysql\"><a href=\"#解压mysql\" class=\"headerlink\" title=\"解压mysql\"></a>解压mysql</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tar -xvzf mysql-5.7.24-linux-glibc2.12-x86_64.tar.gz</span><br><span class=\"line\">ln -s &#x2F;opt&#x2F;soft&#x2F;mysql-5.7.26-linux-glibc2.12-x86_64 &#x2F;opt&#x2F;mysql</span><br><span class=\"line\">ln -s &#x2F;opt&#x2F;mysql&#x2F;bin&#x2F;mysql &#x2F;usr&#x2F;bin&#x2F;mysql</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"创建目录-1\"><a href=\"#创建目录-1\" class=\"headerlink\" title=\"创建目录\"></a>创建目录</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir &#x2F;opt&#x2F;mysql&#x2F;&#123;data,binlog,logs,tmp,var&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"初始化mysql-这里会生成一个初始的临时密码，需要记录下来\"><a href=\"#初始化mysql-这里会生成一个初始的临时密码，需要记录下来\" class=\"headerlink\" title=\"初始化mysql,  这里会生成一个初始的临时密码，需要记录下来\"></a>初始化mysql,  这里会生成一个初始的临时密码，需要记录下来</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">.&#x2F;mysqld --initialize --user&#x3D;mysql --basedir&#x3D;&#x2F;opt&#x2F;mysql&#x2F; --datadir&#x3D;&#x2F;opt&#x2F;mysql&#x2F;data&#x2F; --lc_messages_dir&#x3D;&#x2F;opt&#x2F;mysql&#x2F;share --lc_messages&#x3D;en_US</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">2021-07-29T10:08:10.580290Z 0 [Warning] TIMESTAMP with implicit DEFAULT value is deprecated. Please use --explicit_defaults_for_timestamp server option (see documentation for more details).</span><br><span class=\"line\">2021-07-29T10:08:12.397039Z 0 [Warning] InnoDB: New log files created, LSN&#x3D;45790</span><br><span class=\"line\">2021-07-29T10:08:12.475903Z 0 [Warning] InnoDB: Creating foreign key constraint system tables.</span><br><span class=\"line\">2021-07-29T10:08:12.535095Z 0 [Warning] No existing UUID has been found, so we assume that this is the first time that this server has been started. Generating a new UUID: e20cf3d5-f054-11eb-b9fd-5254dc08bf38.</span><br><span class=\"line\">2021-07-29T10:08:12.537662Z 0 [Warning] Gtid table is not ready to be used. Table &#39;mysql.gtid_executed&#39; cannot be opened.</span><br><span class=\"line\">2021-07-29T10:08:12.538134Z 1 [Note] A temporary password is generated for root@localhost: Nohso!AUs1ex</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>记录下密码</p>\n<h2 id=\"编辑my-cnf\"><a href=\"#编辑my-cnf\" class=\"headerlink\" title=\"编辑my.cnf\"></a>编辑my.cnf</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim &#x2F;etc&#x2F;my.cnf</span><br><span class=\"line\"></span><br><span class=\"line\">[mysqld]</span><br><span class=\"line\">basedir&#x3D;&#x2F;opt&#x2F;mysql&#x2F;</span><br><span class=\"line\">datadir&#x3D;&#x2F;opt&#x2F;mysql&#x2F;data&#x2F;</span><br><span class=\"line\">socket&#x3D;&#x2F;opt&#x2F;mysql&#x2F;data&#x2F;mysql.sock</span><br><span class=\"line\"> </span><br><span class=\"line\">[client]</span><br><span class=\"line\">port&#x3D;3306</span><br><span class=\"line\">socket&#x3D;&#x2F;opt&#x2F;mysql&#x2F;data&#x2F;mysql.sock</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"bms-my-cnf\"><a href=\"#bms-my-cnf\" class=\"headerlink\" title=\"bms  my.cnf\"></a>bms  my.cnf</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[mysql]</span><br><span class=\"line\">port&#x3D;3306</span><br><span class=\"line\">default-character-set&#x3D;utf8mb4</span><br><span class=\"line\">no-auto-rehash</span><br><span class=\"line\"></span><br><span class=\"line\">[client]</span><br><span class=\"line\">port&#x3D;3306</span><br><span class=\"line\">socket&#x3D;&#x2F;opt&#x2F;mysql&#x2F;var&#x2F;mysql.sock</span><br><span class=\"line\"></span><br><span class=\"line\">[mysqld]</span><br><span class=\"line\">#dir</span><br><span class=\"line\">basedir&#x3D;&#x2F;opt&#x2F;mysql</span><br><span class=\"line\">datadir&#x3D;&#x2F;opt&#x2F;mysql&#x2F;data</span><br><span class=\"line\">tmpdir&#x3D;&#x2F;opt&#x2F;mysql&#x2F;tmp</span><br><span class=\"line\">log-error&#x3D;&#x2F;opt&#x2F;mysql&#x2F;logs&#x2F;alert.log</span><br><span class=\"line\">log_error_verbosity&#x3D;1</span><br><span class=\"line\">slow_query_log_file&#x3D;&#x2F;opt&#x2F;mysql&#x2F;logs&#x2F;slow.log</span><br><span class=\"line\">general_log_file&#x3D;&#x2F;opt&#x2F;mysql&#x2F;logs&#x2F;general.log</span><br><span class=\"line\">socket&#x3D;&#x2F;opt&#x2F;mysql&#x2F;var&#x2F;mysql.sock</span><br><span class=\"line\">user&#x3D;mysql</span><br><span class=\"line\">sql_mode&#x3D;strict_trans_tables</span><br><span class=\"line\">performance_schema&#x3D;1</span><br><span class=\"line\"></span><br><span class=\"line\">#innodb</span><br><span class=\"line\">innodb_data_home_dir&#x3D;&#x2F;opt&#x2F;mysql&#x2F;data</span><br><span class=\"line\">innodb_log_group_home_dir&#x3D;&#x2F;opt&#x2F;mysql&#x2F;data</span><br><span class=\"line\">innodb_data_file_path&#x3D;ibdata1:10M:autoextend</span><br><span class=\"line\">innodb_buffer_pool_size&#x3D;1G</span><br><span class=\"line\">innodb_buffer_pool_instances&#x3D;4</span><br><span class=\"line\">innodb_log_files_in_group&#x3D;2</span><br><span class=\"line\">innodb_log_file_size&#x3D;1G</span><br><span class=\"line\">innodb_log_buffer_size&#x3D;200M</span><br><span class=\"line\">innodb_flush_log_at_trx_commit&#x3D;1</span><br><span class=\"line\">innodb_max_dirty_pages_pct&#x3D;60</span><br><span class=\"line\">innodb_io_capacity&#x3D;1000</span><br><span class=\"line\">innodb_thread_concurrency&#x3D;16</span><br><span class=\"line\">innodb_read_io_threads&#x3D;8</span><br><span class=\"line\">innodb_write_io_threads&#x3D;8</span><br><span class=\"line\">innodb_open_files&#x3D;60000</span><br><span class=\"line\">innodb_file_format&#x3D;Barracuda</span><br><span class=\"line\">innodb_file_per_table&#x3D;1</span><br><span class=\"line\">#innodb_flush_method&#x3D;O_DIRECT</span><br><span class=\"line\">innodb_change_buffering&#x3D;inserts</span><br><span class=\"line\">innodb_adaptive_flushing&#x3D;1</span><br><span class=\"line\">innodb_old_blocks_time&#x3D;1000</span><br><span class=\"line\">innodb_stats_on_metadata&#x3D;0</span><br><span class=\"line\">innodb_read_ahead_threshold&#x3D;0</span><br><span class=\"line\">innodb_use_native_aio&#x3D;0</span><br><span class=\"line\">innodb_lock_wait_timeout&#x3D;5</span><br><span class=\"line\">innodb_rollback_on_timeout&#x3D;0</span><br><span class=\"line\">innodb_purge_threads&#x3D;4</span><br><span class=\"line\">innodb_strict_mode&#x3D;1</span><br><span class=\"line\">transaction-isolation&#x3D;READ-COMMITTED</span><br><span class=\"line\"></span><br><span class=\"line\">#myisam</span><br><span class=\"line\">key_buffer_size&#x3D;64M</span><br><span class=\"line\">myisam_sort_buffer_size&#x3D;64M</span><br><span class=\"line\">concurrent_insert&#x3D;2</span><br><span class=\"line\">delayed_insert_timeout&#x3D;300</span><br><span class=\"line\"></span><br><span class=\"line\">#binlog</span><br><span class=\"line\">log-bin&#x3D;&#x2F;opt&#x2F;mysql&#x2F;binlog&#x2F;mysql-bin</span><br><span class=\"line\">server_id&#x3D;151</span><br><span class=\"line\">binlog_cache_size&#x3D;32K</span><br><span class=\"line\">max_binlog_cache_size&#x3D;2G</span><br><span class=\"line\">max_binlog_size&#x3D;500M</span><br><span class=\"line\">binlog-format&#x3D;ROW</span><br><span class=\"line\">sync_binlog&#x3D;1000</span><br><span class=\"line\">log-slave-updates&#x3D;1</span><br><span class=\"line\">expire_logs_days&#x3D;8</span><br><span class=\"line\"></span><br><span class=\"line\">#server</span><br><span class=\"line\">default-storage-engine&#x3D;INNODB</span><br><span class=\"line\">character-set-server&#x3D;utf8mb4</span><br><span class=\"line\">lower_case_table_names&#x3D;1</span><br><span class=\"line\">skip-external-locking</span><br><span class=\"line\">open_files_limit&#x3D;65536</span><br><span class=\"line\">safe-user-create</span><br><span class=\"line\">local-infile&#x3D;1</span><br><span class=\"line\">#sqlmod&#x3D;&quot;STRICT_ALL_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">log_slow_admin_statements&#x3D;1</span><br><span class=\"line\">log_warnings&#x3D;1</span><br><span class=\"line\">long_query_time&#x3D;1</span><br><span class=\"line\">slow_query_log&#x3D;1</span><br><span class=\"line\">general_log&#x3D;0</span><br><span class=\"line\"></span><br><span class=\"line\">query_cache_type&#x3D;0</span><br><span class=\"line\">query_cache_limit&#x3D;1M</span><br><span class=\"line\">query_cache_min_res_unit&#x3D;1K</span><br><span class=\"line\"></span><br><span class=\"line\">table_definition_cache&#x3D;65536</span><br><span class=\"line\"></span><br><span class=\"line\">thread_stack&#x3D;512K</span><br><span class=\"line\">thread_cache_size&#x3D;256</span><br><span class=\"line\">read_rnd_buffer_size&#x3D;128K</span><br><span class=\"line\">sort_buffer_size&#x3D;256K</span><br><span class=\"line\">join_buffer_size&#x3D;128K</span><br><span class=\"line\">read_buffer_size&#x3D;128K</span><br><span class=\"line\"></span><br><span class=\"line\">port&#x3D;3306</span><br><span class=\"line\">#skip-name-resolve</span><br><span class=\"line\">skip-ssl</span><br><span class=\"line\">max_connections&#x3D;4500</span><br><span class=\"line\">max_user_connections&#x3D;4000</span><br><span class=\"line\">max_connect_errors&#x3D;65536</span><br><span class=\"line\">max_allowed_packet&#x3D;128M</span><br><span class=\"line\">connect_timeout&#x3D;8</span><br><span class=\"line\">net_read_timeout&#x3D;30</span><br><span class=\"line\">net_write_timeout&#x3D;60</span><br><span class=\"line\">back_log&#x3D;1024</span><br><span class=\"line\"></span><br><span class=\"line\">explicit_defaults_for_timestamp&#x3D;true</span><br><span class=\"line\"></span><br><span class=\"line\">default-time_zone&#x3D;&#39;+8:00&#39;</span><br><span class=\"line\">log_timestamps &#x3D; system</span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"授权\"><a href=\"#授权\" class=\"headerlink\" title=\"授权\"></a>授权</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">chown -R mysql &#x2F;opt&#x2F;mysql&#x2F;*</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim &#x2F;etc&#x2F;security&#x2F;limits.conf</span><br><span class=\"line\"></span><br><span class=\"line\">## 增加</span><br><span class=\"line\">mysql hard nofile 65535</span><br><span class=\"line\">mysql soft nofile 65535</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"创建systemd管理项\"><a href=\"#创建systemd管理项\" class=\"headerlink\" title=\"创建systemd管理项\"></a>创建systemd管理项</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim &#x2F;usr&#x2F;lib&#x2F;systemd&#x2F;system&#x2F;mysqld.service</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">[Unit]</span><br><span class=\"line\">Description&#x3D;MySQL Server</span><br><span class=\"line\">Documentation&#x3D;mysqld</span><br><span class=\"line\">Documentation&#x3D;http:&#x2F;&#x2F;dev.mysql.com&#x2F;doc&#x2F;refman&#x2F;en&#x2F;using-systemd.html</span><br><span class=\"line\">After&#x3D;network.target</span><br><span class=\"line\">After&#x3D;syslog.target</span><br><span class=\"line\">[Install]</span><br><span class=\"line\">WantedBy&#x3D;multi-user.target</span><br><span class=\"line\">[Service]</span><br><span class=\"line\">User&#x3D;mysql</span><br><span class=\"line\">Group&#x3D;mysql</span><br><span class=\"line\">ExecStart&#x3D;&#x2F;opt&#x2F;mysql&#x2F;bin&#x2F;mysqld --defaults-file&#x3D;&#x2F;etc&#x2F;my.cnf</span><br><span class=\"line\">LimitNOFILE &#x3D; 65535</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl daemon-reload</span><br><span class=\"line\"></span><br><span class=\"line\">systemctl start mysqld.service</span><br><span class=\"line\">systemctl status mysqld.service</span><br><span class=\"line\">systemctl enable mysqld.service</span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"设置mysql远程访问，输入之前生成的临时密码\"><a href=\"#设置mysql远程访问，输入之前生成的临时密码\" class=\"headerlink\" title=\"设置mysql远程访问，输入之前生成的临时密码\"></a>设置mysql远程访问，输入之前生成的临时密码</h2><p>修改临时密码</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">.&#x2F;mysql -uroot -p</span><br><span class=\"line\"></span><br><span class=\"line\">ALTER USER USER() IDENTIFIED BY &#39;yF!kFXFd!hc9mZbB&#39;;</span><br></pre></td></tr></table></figure>\n\n<p>设置root远程访问</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">use mysql</span><br><span class=\"line\">GRANT ALL PRIVILEGES ON *.* TO&#39;root&#39;@&#39;%&#39; IDENTIFIED BY&#39;pHE8HXGteTBw&#39; WITH GRANT OPTION;</span><br><span class=\"line\">FLUSH PRIVILEGES;</span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"<p>摘要: centos7安装mysql</p>","more":"<h2 id=\"创建目录\"><a href=\"#创建目录\" class=\"headerlink\" title=\"创建目录\"></a>创建目录</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir -p &#x2F;data&#x2F;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"获取mysql\"><a href=\"#获取mysql\" class=\"headerlink\" title=\"获取mysql\"></a>获取mysql</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -O https:&#x2F;&#x2F;downloads.mysql.com&#x2F;archives&#x2F;get&#x2F;p&#x2F;23&#x2F;file&#x2F;mysql-5.7.24-linux-glibc2.12-x86_64.tar.gz</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"创建用户和用户组\"><a href=\"#创建用户和用户组\" class=\"headerlink\" title=\"创建用户和用户组\"></a>创建用户和用户组</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">useradd -M -s &#x2F;sbin&#x2F;nologin mysql</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum remove mariadb-libs-5.5.68-1.el7.x86_64 -y</span><br><span class=\"line\"></span><br><span class=\"line\">yum install libaio -y</span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"解压mysql\"><a href=\"#解压mysql\" class=\"headerlink\" title=\"解压mysql\"></a>解压mysql</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tar -xvzf mysql-5.7.24-linux-glibc2.12-x86_64.tar.gz</span><br><span class=\"line\">ln -s &#x2F;opt&#x2F;soft&#x2F;mysql-5.7.26-linux-glibc2.12-x86_64 &#x2F;opt&#x2F;mysql</span><br><span class=\"line\">ln -s &#x2F;opt&#x2F;mysql&#x2F;bin&#x2F;mysql &#x2F;usr&#x2F;bin&#x2F;mysql</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"创建目录-1\"><a href=\"#创建目录-1\" class=\"headerlink\" title=\"创建目录\"></a>创建目录</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir &#x2F;opt&#x2F;mysql&#x2F;&#123;data,binlog,logs,tmp,var&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"初始化mysql-这里会生成一个初始的临时密码，需要记录下来\"><a href=\"#初始化mysql-这里会生成一个初始的临时密码，需要记录下来\" class=\"headerlink\" title=\"初始化mysql,  这里会生成一个初始的临时密码，需要记录下来\"></a>初始化mysql,  这里会生成一个初始的临时密码，需要记录下来</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">.&#x2F;mysqld --initialize --user&#x3D;mysql --basedir&#x3D;&#x2F;opt&#x2F;mysql&#x2F; --datadir&#x3D;&#x2F;opt&#x2F;mysql&#x2F;data&#x2F; --lc_messages_dir&#x3D;&#x2F;opt&#x2F;mysql&#x2F;share --lc_messages&#x3D;en_US</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">2021-07-29T10:08:10.580290Z 0 [Warning] TIMESTAMP with implicit DEFAULT value is deprecated. Please use --explicit_defaults_for_timestamp server option (see documentation for more details).</span><br><span class=\"line\">2021-07-29T10:08:12.397039Z 0 [Warning] InnoDB: New log files created, LSN&#x3D;45790</span><br><span class=\"line\">2021-07-29T10:08:12.475903Z 0 [Warning] InnoDB: Creating foreign key constraint system tables.</span><br><span class=\"line\">2021-07-29T10:08:12.535095Z 0 [Warning] No existing UUID has been found, so we assume that this is the first time that this server has been started. Generating a new UUID: e20cf3d5-f054-11eb-b9fd-5254dc08bf38.</span><br><span class=\"line\">2021-07-29T10:08:12.537662Z 0 [Warning] Gtid table is not ready to be used. Table &#39;mysql.gtid_executed&#39; cannot be opened.</span><br><span class=\"line\">2021-07-29T10:08:12.538134Z 1 [Note] A temporary password is generated for root@localhost: Nohso!AUs1ex</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>记录下密码</p>\n<h2 id=\"编辑my-cnf\"><a href=\"#编辑my-cnf\" class=\"headerlink\" title=\"编辑my.cnf\"></a>编辑my.cnf</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim &#x2F;etc&#x2F;my.cnf</span><br><span class=\"line\"></span><br><span class=\"line\">[mysqld]</span><br><span class=\"line\">basedir&#x3D;&#x2F;opt&#x2F;mysql&#x2F;</span><br><span class=\"line\">datadir&#x3D;&#x2F;opt&#x2F;mysql&#x2F;data&#x2F;</span><br><span class=\"line\">socket&#x3D;&#x2F;opt&#x2F;mysql&#x2F;data&#x2F;mysql.sock</span><br><span class=\"line\"> </span><br><span class=\"line\">[client]</span><br><span class=\"line\">port&#x3D;3306</span><br><span class=\"line\">socket&#x3D;&#x2F;opt&#x2F;mysql&#x2F;data&#x2F;mysql.sock</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"bms-my-cnf\"><a href=\"#bms-my-cnf\" class=\"headerlink\" title=\"bms  my.cnf\"></a>bms  my.cnf</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[mysql]</span><br><span class=\"line\">port&#x3D;3306</span><br><span class=\"line\">default-character-set&#x3D;utf8mb4</span><br><span class=\"line\">no-auto-rehash</span><br><span class=\"line\"></span><br><span class=\"line\">[client]</span><br><span class=\"line\">port&#x3D;3306</span><br><span class=\"line\">socket&#x3D;&#x2F;opt&#x2F;mysql&#x2F;var&#x2F;mysql.sock</span><br><span class=\"line\"></span><br><span class=\"line\">[mysqld]</span><br><span class=\"line\">#dir</span><br><span class=\"line\">basedir&#x3D;&#x2F;opt&#x2F;mysql</span><br><span class=\"line\">datadir&#x3D;&#x2F;opt&#x2F;mysql&#x2F;data</span><br><span class=\"line\">tmpdir&#x3D;&#x2F;opt&#x2F;mysql&#x2F;tmp</span><br><span class=\"line\">log-error&#x3D;&#x2F;opt&#x2F;mysql&#x2F;logs&#x2F;alert.log</span><br><span class=\"line\">log_error_verbosity&#x3D;1</span><br><span class=\"line\">slow_query_log_file&#x3D;&#x2F;opt&#x2F;mysql&#x2F;logs&#x2F;slow.log</span><br><span class=\"line\">general_log_file&#x3D;&#x2F;opt&#x2F;mysql&#x2F;logs&#x2F;general.log</span><br><span class=\"line\">socket&#x3D;&#x2F;opt&#x2F;mysql&#x2F;var&#x2F;mysql.sock</span><br><span class=\"line\">user&#x3D;mysql</span><br><span class=\"line\">sql_mode&#x3D;strict_trans_tables</span><br><span class=\"line\">performance_schema&#x3D;1</span><br><span class=\"line\"></span><br><span class=\"line\">#innodb</span><br><span class=\"line\">innodb_data_home_dir&#x3D;&#x2F;opt&#x2F;mysql&#x2F;data</span><br><span class=\"line\">innodb_log_group_home_dir&#x3D;&#x2F;opt&#x2F;mysql&#x2F;data</span><br><span class=\"line\">innodb_data_file_path&#x3D;ibdata1:10M:autoextend</span><br><span class=\"line\">innodb_buffer_pool_size&#x3D;1G</span><br><span class=\"line\">innodb_buffer_pool_instances&#x3D;4</span><br><span class=\"line\">innodb_log_files_in_group&#x3D;2</span><br><span class=\"line\">innodb_log_file_size&#x3D;1G</span><br><span class=\"line\">innodb_log_buffer_size&#x3D;200M</span><br><span class=\"line\">innodb_flush_log_at_trx_commit&#x3D;1</span><br><span class=\"line\">innodb_max_dirty_pages_pct&#x3D;60</span><br><span class=\"line\">innodb_io_capacity&#x3D;1000</span><br><span class=\"line\">innodb_thread_concurrency&#x3D;16</span><br><span class=\"line\">innodb_read_io_threads&#x3D;8</span><br><span class=\"line\">innodb_write_io_threads&#x3D;8</span><br><span class=\"line\">innodb_open_files&#x3D;60000</span><br><span class=\"line\">innodb_file_format&#x3D;Barracuda</span><br><span class=\"line\">innodb_file_per_table&#x3D;1</span><br><span class=\"line\">#innodb_flush_method&#x3D;O_DIRECT</span><br><span class=\"line\">innodb_change_buffering&#x3D;inserts</span><br><span class=\"line\">innodb_adaptive_flushing&#x3D;1</span><br><span class=\"line\">innodb_old_blocks_time&#x3D;1000</span><br><span class=\"line\">innodb_stats_on_metadata&#x3D;0</span><br><span class=\"line\">innodb_read_ahead_threshold&#x3D;0</span><br><span class=\"line\">innodb_use_native_aio&#x3D;0</span><br><span class=\"line\">innodb_lock_wait_timeout&#x3D;5</span><br><span class=\"line\">innodb_rollback_on_timeout&#x3D;0</span><br><span class=\"line\">innodb_purge_threads&#x3D;4</span><br><span class=\"line\">innodb_strict_mode&#x3D;1</span><br><span class=\"line\">transaction-isolation&#x3D;READ-COMMITTED</span><br><span class=\"line\"></span><br><span class=\"line\">#myisam</span><br><span class=\"line\">key_buffer_size&#x3D;64M</span><br><span class=\"line\">myisam_sort_buffer_size&#x3D;64M</span><br><span class=\"line\">concurrent_insert&#x3D;2</span><br><span class=\"line\">delayed_insert_timeout&#x3D;300</span><br><span class=\"line\"></span><br><span class=\"line\">#binlog</span><br><span class=\"line\">log-bin&#x3D;&#x2F;opt&#x2F;mysql&#x2F;binlog&#x2F;mysql-bin</span><br><span class=\"line\">server_id&#x3D;151</span><br><span class=\"line\">binlog_cache_size&#x3D;32K</span><br><span class=\"line\">max_binlog_cache_size&#x3D;2G</span><br><span class=\"line\">max_binlog_size&#x3D;500M</span><br><span class=\"line\">binlog-format&#x3D;ROW</span><br><span class=\"line\">sync_binlog&#x3D;1000</span><br><span class=\"line\">log-slave-updates&#x3D;1</span><br><span class=\"line\">expire_logs_days&#x3D;8</span><br><span class=\"line\"></span><br><span class=\"line\">#server</span><br><span class=\"line\">default-storage-engine&#x3D;INNODB</span><br><span class=\"line\">character-set-server&#x3D;utf8mb4</span><br><span class=\"line\">lower_case_table_names&#x3D;1</span><br><span class=\"line\">skip-external-locking</span><br><span class=\"line\">open_files_limit&#x3D;65536</span><br><span class=\"line\">safe-user-create</span><br><span class=\"line\">local-infile&#x3D;1</span><br><span class=\"line\">#sqlmod&#x3D;&quot;STRICT_ALL_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">log_slow_admin_statements&#x3D;1</span><br><span class=\"line\">log_warnings&#x3D;1</span><br><span class=\"line\">long_query_time&#x3D;1</span><br><span class=\"line\">slow_query_log&#x3D;1</span><br><span class=\"line\">general_log&#x3D;0</span><br><span class=\"line\"></span><br><span class=\"line\">query_cache_type&#x3D;0</span><br><span class=\"line\">query_cache_limit&#x3D;1M</span><br><span class=\"line\">query_cache_min_res_unit&#x3D;1K</span><br><span class=\"line\"></span><br><span class=\"line\">table_definition_cache&#x3D;65536</span><br><span class=\"line\"></span><br><span class=\"line\">thread_stack&#x3D;512K</span><br><span class=\"line\">thread_cache_size&#x3D;256</span><br><span class=\"line\">read_rnd_buffer_size&#x3D;128K</span><br><span class=\"line\">sort_buffer_size&#x3D;256K</span><br><span class=\"line\">join_buffer_size&#x3D;128K</span><br><span class=\"line\">read_buffer_size&#x3D;128K</span><br><span class=\"line\"></span><br><span class=\"line\">port&#x3D;3306</span><br><span class=\"line\">#skip-name-resolve</span><br><span class=\"line\">skip-ssl</span><br><span class=\"line\">max_connections&#x3D;4500</span><br><span class=\"line\">max_user_connections&#x3D;4000</span><br><span class=\"line\">max_connect_errors&#x3D;65536</span><br><span class=\"line\">max_allowed_packet&#x3D;128M</span><br><span class=\"line\">connect_timeout&#x3D;8</span><br><span class=\"line\">net_read_timeout&#x3D;30</span><br><span class=\"line\">net_write_timeout&#x3D;60</span><br><span class=\"line\">back_log&#x3D;1024</span><br><span class=\"line\"></span><br><span class=\"line\">explicit_defaults_for_timestamp&#x3D;true</span><br><span class=\"line\"></span><br><span class=\"line\">default-time_zone&#x3D;&#39;+8:00&#39;</span><br><span class=\"line\">log_timestamps &#x3D; system</span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"授权\"><a href=\"#授权\" class=\"headerlink\" title=\"授权\"></a>授权</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">chown -R mysql &#x2F;opt&#x2F;mysql&#x2F;*</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim &#x2F;etc&#x2F;security&#x2F;limits.conf</span><br><span class=\"line\"></span><br><span class=\"line\">## 增加</span><br><span class=\"line\">mysql hard nofile 65535</span><br><span class=\"line\">mysql soft nofile 65535</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"创建systemd管理项\"><a href=\"#创建systemd管理项\" class=\"headerlink\" title=\"创建systemd管理项\"></a>创建systemd管理项</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim &#x2F;usr&#x2F;lib&#x2F;systemd&#x2F;system&#x2F;mysqld.service</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">[Unit]</span><br><span class=\"line\">Description&#x3D;MySQL Server</span><br><span class=\"line\">Documentation&#x3D;mysqld</span><br><span class=\"line\">Documentation&#x3D;http:&#x2F;&#x2F;dev.mysql.com&#x2F;doc&#x2F;refman&#x2F;en&#x2F;using-systemd.html</span><br><span class=\"line\">After&#x3D;network.target</span><br><span class=\"line\">After&#x3D;syslog.target</span><br><span class=\"line\">[Install]</span><br><span class=\"line\">WantedBy&#x3D;multi-user.target</span><br><span class=\"line\">[Service]</span><br><span class=\"line\">User&#x3D;mysql</span><br><span class=\"line\">Group&#x3D;mysql</span><br><span class=\"line\">ExecStart&#x3D;&#x2F;opt&#x2F;mysql&#x2F;bin&#x2F;mysqld --defaults-file&#x3D;&#x2F;etc&#x2F;my.cnf</span><br><span class=\"line\">LimitNOFILE &#x3D; 65535</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl daemon-reload</span><br><span class=\"line\"></span><br><span class=\"line\">systemctl start mysqld.service</span><br><span class=\"line\">systemctl status mysqld.service</span><br><span class=\"line\">systemctl enable mysqld.service</span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"设置mysql远程访问，输入之前生成的临时密码\"><a href=\"#设置mysql远程访问，输入之前生成的临时密码\" class=\"headerlink\" title=\"设置mysql远程访问，输入之前生成的临时密码\"></a>设置mysql远程访问，输入之前生成的临时密码</h2><p>修改临时密码</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">.&#x2F;mysql -uroot -p</span><br><span class=\"line\"></span><br><span class=\"line\">ALTER USER USER() IDENTIFIED BY &#39;yF!kFXFd!hc9mZbB&#39;;</span><br></pre></td></tr></table></figure>\n\n<p>设置root远程访问</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">use mysql</span><br><span class=\"line\">GRANT ALL PRIVILEGES ON *.* TO&#39;root&#39;@&#39;%&#39; IDENTIFIED BY&#39;pHE8HXGteTBw&#39; WITH GRANT OPTION;</span><br><span class=\"line\">FLUSH PRIVILEGES;</span><br></pre></td></tr></table></figure>"},{"title":"centos7安装mysql5.7","date":"2021-03-15T07:57:00.000Z","_content":"\n\n摘要: centos7安装mysql5.7\n<!-- more -->\n\n## 获取mysql5.7\n```\nhttps://cdn.mysql.com/archives/mysql-5.7/mysql-5.7.23-linux-glibc2.12-x86_64.tar.gz\n```\n连接可能或失效，从官网获取最新下载地址\n\n[官网地址](https://downloads.mysql.com/archives/community/)\n\n\n## 安装\n### 创建mysql用户\n```\nuseradd -M -s /sbin/nologin  mysql\n```\n### 创建mysql 目录\n```\nmkdir -p /opt/data/mysql\n\nchown mysql /opt/data/mysql\n```\n\n### 配置文件\n```\nvim /etc/my.cnf\n[mysqld]\nbind-address=0.0.0.0\nport=3306\nuser=mysql\nbasedir=/opt/soft/mysql\ndatadir=/opt/data/mysql\nsocket=/opt/data/mysql/mysql.sock\nlog-error=/opt/data/mysql/mysql.err\npid-file=/opt/data/mysql/mysql.pid\n#character config\ncharacter_set_server=utf8mb4\nsymbolic-links=0\nexplicit_defaults_for_timestamp=true\n!includedir /etc/my.cnf.d\n```\n\n\n### 初始化\n```\ncd /opt/soft/mysql\n./bin/mysqld --defaults-file=/etc/my.cnf --basedir=/opt/soft/mysql/ --datadir=/opt/data/mysql/ --user=mysql --initialize\n```\n\n### 查看密码\n```\ncat /opt/data/mysql/mysql.err\n```\n\n### 启动mysql\n```\ncp /opt/soft/mysql/support-files/mysql.server /etc/init.d/mysql\nservice mysql start\n```\n\n### 修改密码\n```\nSET PASSWORD = PASSWORD('123456');\nALTER USER 'root'@'localhost' PASSWORD EXPIRE NEVER;\nFLUSH PRIVILEGES; \n```\n\n### 远程登录\n```\nuse mysql                                            #访问mysql库\nupdate user set host = '%' where user = 'root';      #使root能再任何host访问\nFLUSH PRIVILEGES;  \n```\n\n\n### 软连接\n```\nln -s  /usr/local/mysql/bin/mysql    /usr/bin\n```\n\n","source":"_posts/install/centos7安装mysql57.md","raw":"---\ntitle: centos7安装mysql5.7\ndate: 2021-03-15 15:57\ncategories:\n- centos7\ntags:\n- mysql\n---\n\n\n摘要: centos7安装mysql5.7\n<!-- more -->\n\n## 获取mysql5.7\n```\nhttps://cdn.mysql.com/archives/mysql-5.7/mysql-5.7.23-linux-glibc2.12-x86_64.tar.gz\n```\n连接可能或失效，从官网获取最新下载地址\n\n[官网地址](https://downloads.mysql.com/archives/community/)\n\n\n## 安装\n### 创建mysql用户\n```\nuseradd -M -s /sbin/nologin  mysql\n```\n### 创建mysql 目录\n```\nmkdir -p /opt/data/mysql\n\nchown mysql /opt/data/mysql\n```\n\n### 配置文件\n```\nvim /etc/my.cnf\n[mysqld]\nbind-address=0.0.0.0\nport=3306\nuser=mysql\nbasedir=/opt/soft/mysql\ndatadir=/opt/data/mysql\nsocket=/opt/data/mysql/mysql.sock\nlog-error=/opt/data/mysql/mysql.err\npid-file=/opt/data/mysql/mysql.pid\n#character config\ncharacter_set_server=utf8mb4\nsymbolic-links=0\nexplicit_defaults_for_timestamp=true\n!includedir /etc/my.cnf.d\n```\n\n\n### 初始化\n```\ncd /opt/soft/mysql\n./bin/mysqld --defaults-file=/etc/my.cnf --basedir=/opt/soft/mysql/ --datadir=/opt/data/mysql/ --user=mysql --initialize\n```\n\n### 查看密码\n```\ncat /opt/data/mysql/mysql.err\n```\n\n### 启动mysql\n```\ncp /opt/soft/mysql/support-files/mysql.server /etc/init.d/mysql\nservice mysql start\n```\n\n### 修改密码\n```\nSET PASSWORD = PASSWORD('123456');\nALTER USER 'root'@'localhost' PASSWORD EXPIRE NEVER;\nFLUSH PRIVILEGES; \n```\n\n### 远程登录\n```\nuse mysql                                            #访问mysql库\nupdate user set host = '%' where user = 'root';      #使root能再任何host访问\nFLUSH PRIVILEGES;  \n```\n\n\n### 软连接\n```\nln -s  /usr/local/mysql/bin/mysql    /usr/bin\n```\n\n","slug":"install/centos7安装mysql57","published":1,"updated":"2021-06-18T08:07:11.192Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cku6979zg003t00uhhpuacb5k","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><p>摘要: centos7安装mysql5.7</p>\n<span id=\"more\"></span>\n\n<h2 id=\"获取mysql5-7\"><a href=\"#获取mysql5-7\" class=\"headerlink\" title=\"获取mysql5.7\"></a>获取mysql5.7</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">https:&#x2F;&#x2F;cdn.mysql.com&#x2F;archives&#x2F;mysql-5.7&#x2F;mysql-5.7.23-linux-glibc2.12-x86_64.tar.gz</span><br></pre></td></tr></table></figure>\n<p>连接可能或失效，从官网获取最新下载地址</p>\n<p><a href=\"https://downloads.mysql.com/archives/community/\">官网地址</a></p>\n<h2 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h2><h3 id=\"创建mysql用户\"><a href=\"#创建mysql用户\" class=\"headerlink\" title=\"创建mysql用户\"></a>创建mysql用户</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">useradd -M -s &#x2F;sbin&#x2F;nologin  mysql</span><br></pre></td></tr></table></figure>\n<h3 id=\"创建mysql-目录\"><a href=\"#创建mysql-目录\" class=\"headerlink\" title=\"创建mysql 目录\"></a>创建mysql 目录</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir -p &#x2F;opt&#x2F;data&#x2F;mysql</span><br><span class=\"line\"></span><br><span class=\"line\">chown mysql &#x2F;opt&#x2F;data&#x2F;mysql</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"配置文件\"><a href=\"#配置文件\" class=\"headerlink\" title=\"配置文件\"></a>配置文件</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim &#x2F;etc&#x2F;my.cnf</span><br><span class=\"line\">[mysqld]</span><br><span class=\"line\">bind-address&#x3D;0.0.0.0</span><br><span class=\"line\">port&#x3D;3306</span><br><span class=\"line\">user&#x3D;mysql</span><br><span class=\"line\">basedir&#x3D;&#x2F;opt&#x2F;soft&#x2F;mysql</span><br><span class=\"line\">datadir&#x3D;&#x2F;opt&#x2F;data&#x2F;mysql</span><br><span class=\"line\">socket&#x3D;&#x2F;opt&#x2F;data&#x2F;mysql&#x2F;mysql.sock</span><br><span class=\"line\">log-error&#x3D;&#x2F;opt&#x2F;data&#x2F;mysql&#x2F;mysql.err</span><br><span class=\"line\">pid-file&#x3D;&#x2F;opt&#x2F;data&#x2F;mysql&#x2F;mysql.pid</span><br><span class=\"line\">#character config</span><br><span class=\"line\">character_set_server&#x3D;utf8mb4</span><br><span class=\"line\">symbolic-links&#x3D;0</span><br><span class=\"line\">explicit_defaults_for_timestamp&#x3D;true</span><br><span class=\"line\">!includedir &#x2F;etc&#x2F;my.cnf.d</span><br></pre></td></tr></table></figure>\n\n\n<h3 id=\"初始化\"><a href=\"#初始化\" class=\"headerlink\" title=\"初始化\"></a>初始化</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd &#x2F;opt&#x2F;soft&#x2F;mysql</span><br><span class=\"line\">.&#x2F;bin&#x2F;mysqld --defaults-file&#x3D;&#x2F;etc&#x2F;my.cnf --basedir&#x3D;&#x2F;opt&#x2F;soft&#x2F;mysql&#x2F; --datadir&#x3D;&#x2F;opt&#x2F;data&#x2F;mysql&#x2F; --user&#x3D;mysql --initialize</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"查看密码\"><a href=\"#查看密码\" class=\"headerlink\" title=\"查看密码\"></a>查看密码</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cat &#x2F;opt&#x2F;data&#x2F;mysql&#x2F;mysql.err</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"启动mysql\"><a href=\"#启动mysql\" class=\"headerlink\" title=\"启动mysql\"></a>启动mysql</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cp &#x2F;opt&#x2F;soft&#x2F;mysql&#x2F;support-files&#x2F;mysql.server &#x2F;etc&#x2F;init.d&#x2F;mysql</span><br><span class=\"line\">service mysql start</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"修改密码\"><a href=\"#修改密码\" class=\"headerlink\" title=\"修改密码\"></a>修改密码</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">SET PASSWORD &#x3D; PASSWORD(&#39;123456&#39;);</span><br><span class=\"line\">ALTER USER &#39;root&#39;@&#39;localhost&#39; PASSWORD EXPIRE NEVER;</span><br><span class=\"line\">FLUSH PRIVILEGES; </span><br></pre></td></tr></table></figure>\n\n<h3 id=\"远程登录\"><a href=\"#远程登录\" class=\"headerlink\" title=\"远程登录\"></a>远程登录</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">use mysql                                            #访问mysql库</span><br><span class=\"line\">update user set host &#x3D; &#39;%&#39; where user &#x3D; &#39;root&#39;;      #使root能再任何host访问</span><br><span class=\"line\">FLUSH PRIVILEGES;  </span><br></pre></td></tr></table></figure>\n\n\n<h3 id=\"软连接\"><a href=\"#软连接\" class=\"headerlink\" title=\"软连接\"></a>软连接</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ln -s  &#x2F;usr&#x2F;local&#x2F;mysql&#x2F;bin&#x2F;mysql    &#x2F;usr&#x2F;bin</span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"<p>摘要: centos7安装mysql5.7</p>","more":"<h2 id=\"获取mysql5-7\"><a href=\"#获取mysql5-7\" class=\"headerlink\" title=\"获取mysql5.7\"></a>获取mysql5.7</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">https:&#x2F;&#x2F;cdn.mysql.com&#x2F;archives&#x2F;mysql-5.7&#x2F;mysql-5.7.23-linux-glibc2.12-x86_64.tar.gz</span><br></pre></td></tr></table></figure>\n<p>连接可能或失效，从官网获取最新下载地址</p>\n<p><a href=\"https://downloads.mysql.com/archives/community/\">官网地址</a></p>\n<h2 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h2><h3 id=\"创建mysql用户\"><a href=\"#创建mysql用户\" class=\"headerlink\" title=\"创建mysql用户\"></a>创建mysql用户</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">useradd -M -s &#x2F;sbin&#x2F;nologin  mysql</span><br></pre></td></tr></table></figure>\n<h3 id=\"创建mysql-目录\"><a href=\"#创建mysql-目录\" class=\"headerlink\" title=\"创建mysql 目录\"></a>创建mysql 目录</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir -p &#x2F;opt&#x2F;data&#x2F;mysql</span><br><span class=\"line\"></span><br><span class=\"line\">chown mysql &#x2F;opt&#x2F;data&#x2F;mysql</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"配置文件\"><a href=\"#配置文件\" class=\"headerlink\" title=\"配置文件\"></a>配置文件</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim &#x2F;etc&#x2F;my.cnf</span><br><span class=\"line\">[mysqld]</span><br><span class=\"line\">bind-address&#x3D;0.0.0.0</span><br><span class=\"line\">port&#x3D;3306</span><br><span class=\"line\">user&#x3D;mysql</span><br><span class=\"line\">basedir&#x3D;&#x2F;opt&#x2F;soft&#x2F;mysql</span><br><span class=\"line\">datadir&#x3D;&#x2F;opt&#x2F;data&#x2F;mysql</span><br><span class=\"line\">socket&#x3D;&#x2F;opt&#x2F;data&#x2F;mysql&#x2F;mysql.sock</span><br><span class=\"line\">log-error&#x3D;&#x2F;opt&#x2F;data&#x2F;mysql&#x2F;mysql.err</span><br><span class=\"line\">pid-file&#x3D;&#x2F;opt&#x2F;data&#x2F;mysql&#x2F;mysql.pid</span><br><span class=\"line\">#character config</span><br><span class=\"line\">character_set_server&#x3D;utf8mb4</span><br><span class=\"line\">symbolic-links&#x3D;0</span><br><span class=\"line\">explicit_defaults_for_timestamp&#x3D;true</span><br><span class=\"line\">!includedir &#x2F;etc&#x2F;my.cnf.d</span><br></pre></td></tr></table></figure>\n\n\n<h3 id=\"初始化\"><a href=\"#初始化\" class=\"headerlink\" title=\"初始化\"></a>初始化</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd &#x2F;opt&#x2F;soft&#x2F;mysql</span><br><span class=\"line\">.&#x2F;bin&#x2F;mysqld --defaults-file&#x3D;&#x2F;etc&#x2F;my.cnf --basedir&#x3D;&#x2F;opt&#x2F;soft&#x2F;mysql&#x2F; --datadir&#x3D;&#x2F;opt&#x2F;data&#x2F;mysql&#x2F; --user&#x3D;mysql --initialize</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"查看密码\"><a href=\"#查看密码\" class=\"headerlink\" title=\"查看密码\"></a>查看密码</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cat &#x2F;opt&#x2F;data&#x2F;mysql&#x2F;mysql.err</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"启动mysql\"><a href=\"#启动mysql\" class=\"headerlink\" title=\"启动mysql\"></a>启动mysql</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cp &#x2F;opt&#x2F;soft&#x2F;mysql&#x2F;support-files&#x2F;mysql.server &#x2F;etc&#x2F;init.d&#x2F;mysql</span><br><span class=\"line\">service mysql start</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"修改密码\"><a href=\"#修改密码\" class=\"headerlink\" title=\"修改密码\"></a>修改密码</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">SET PASSWORD &#x3D; PASSWORD(&#39;123456&#39;);</span><br><span class=\"line\">ALTER USER &#39;root&#39;@&#39;localhost&#39; PASSWORD EXPIRE NEVER;</span><br><span class=\"line\">FLUSH PRIVILEGES; </span><br></pre></td></tr></table></figure>\n\n<h3 id=\"远程登录\"><a href=\"#远程登录\" class=\"headerlink\" title=\"远程登录\"></a>远程登录</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">use mysql                                            #访问mysql库</span><br><span class=\"line\">update user set host &#x3D; &#39;%&#39; where user &#x3D; &#39;root&#39;;      #使root能再任何host访问</span><br><span class=\"line\">FLUSH PRIVILEGES;  </span><br></pre></td></tr></table></figure>\n\n\n<h3 id=\"软连接\"><a href=\"#软连接\" class=\"headerlink\" title=\"软连接\"></a>软连接</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ln -s  &#x2F;usr&#x2F;local&#x2F;mysql&#x2F;bin&#x2F;mysql    &#x2F;usr&#x2F;bin</span><br></pre></td></tr></table></figure>"},{"title":"centos7 普通用户下安装nginx","date":"2021-09-28T07:21:00.000Z","_content":"\t\n\t\n摘要: centos7 普通用户下安装nginx\n<!-- more -->\n\n## 依赖包依然需要离线下载 \n\n### 下载nginx\n```\nhttp://nginx.org/en/download.html\n```\n### zlib下载地址：  \n```\nhttp://www.zlib.net/\n```\n\n### prce下载地址\n注意别下pcre2\n```\nftp://ftp.pcre.org/pub/pcre/\n```\n\n### openssl下载地址\n```\nhttp://www.openssl.org\n```\n\n## 安装\n```\nmkdir soft\nmkdir apps\n\nmv *.gz soft \n```\n### 解压安装 pcre \n```\ntar xf pcre-8.45.tar.gz\ncd pcre-8.45\n./configure --prefix=/home/baseuser/apps/pcre\nmake && make install\n```\n\n### 解压安装 zlib\n```\ntar xf zlib-1.2.11.tar.gz\ncd zlib-1.2.11\n./configure --prefix=/home/baseuser/apps/zlib\nmake && make install\n```\n### nginx\n两个依赖都装好后，可以开始正式的nginx编译前检查\n\n```\ntar xf nginx-1.20.1.tar.gz\ncd nginx-1.20.1/\n./configure --prefix=/home/baseuser/apps/nginx --with-http_stub_status_module --with-pcre=/home/baseuser/soft/pcre-8.45 --with-zlib=/home/baseuser/soft/zlib-1.2.11\n\n检查ok，编译和安装一般没问题：\n\nmake && make install\n```\n\n## 启动\n```\ncd /home/baseuser/apps/nginx/sbin\nsbin/nginx \n\nnginx: [emerg] bind() to 0.0.0.0:80 failed (13: Permission denied)\n　　报错原因：在linux下，普通用户只能用1024以上的端口，而1024以内的端口只能由root用户才可以使用，所以这里80端口只能由root才能使用。\n```\n\n\n\n\n\n\n","source":"_posts/install/centos7安装nginx.md","raw":"---\ntitle: centos7 普通用户下安装nginx\ndate: 2021-09-28 15:21\ncategories:\n- linux\ntags:\n- nginx\n---\n\t\n\t\n摘要: centos7 普通用户下安装nginx\n<!-- more -->\n\n## 依赖包依然需要离线下载 \n\n### 下载nginx\n```\nhttp://nginx.org/en/download.html\n```\n### zlib下载地址：  \n```\nhttp://www.zlib.net/\n```\n\n### prce下载地址\n注意别下pcre2\n```\nftp://ftp.pcre.org/pub/pcre/\n```\n\n### openssl下载地址\n```\nhttp://www.openssl.org\n```\n\n## 安装\n```\nmkdir soft\nmkdir apps\n\nmv *.gz soft \n```\n### 解压安装 pcre \n```\ntar xf pcre-8.45.tar.gz\ncd pcre-8.45\n./configure --prefix=/home/baseuser/apps/pcre\nmake && make install\n```\n\n### 解压安装 zlib\n```\ntar xf zlib-1.2.11.tar.gz\ncd zlib-1.2.11\n./configure --prefix=/home/baseuser/apps/zlib\nmake && make install\n```\n### nginx\n两个依赖都装好后，可以开始正式的nginx编译前检查\n\n```\ntar xf nginx-1.20.1.tar.gz\ncd nginx-1.20.1/\n./configure --prefix=/home/baseuser/apps/nginx --with-http_stub_status_module --with-pcre=/home/baseuser/soft/pcre-8.45 --with-zlib=/home/baseuser/soft/zlib-1.2.11\n\n检查ok，编译和安装一般没问题：\n\nmake && make install\n```\n\n## 启动\n```\ncd /home/baseuser/apps/nginx/sbin\nsbin/nginx \n\nnginx: [emerg] bind() to 0.0.0.0:80 failed (13: Permission denied)\n　　报错原因：在linux下，普通用户只能用1024以上的端口，而1024以内的端口只能由root用户才可以使用，所以这里80端口只能由root才能使用。\n```\n\n\n\n\n\n\n","slug":"install/centos7安装nginx","published":1,"updated":"2021-09-28T09:46:21.333Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cku6979zi003w00uh7ai1b5nc","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><p>摘要: centos7 普通用户下安装nginx</p>\n<span id=\"more\"></span>\n\n<h2 id=\"依赖包依然需要离线下载\"><a href=\"#依赖包依然需要离线下载\" class=\"headerlink\" title=\"依赖包依然需要离线下载\"></a>依赖包依然需要离线下载</h2><h3 id=\"下载nginx\"><a href=\"#下载nginx\" class=\"headerlink\" title=\"下载nginx\"></a>下载nginx</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">http:&#x2F;&#x2F;nginx.org&#x2F;en&#x2F;download.html</span><br></pre></td></tr></table></figure>\n<h3 id=\"zlib下载地址：\"><a href=\"#zlib下载地址：\" class=\"headerlink\" title=\"zlib下载地址：\"></a>zlib下载地址：</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">http:&#x2F;&#x2F;www.zlib.net&#x2F;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"prce下载地址\"><a href=\"#prce下载地址\" class=\"headerlink\" title=\"prce下载地址\"></a>prce下载地址</h3><p>注意别下pcre2</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ftp:&#x2F;&#x2F;ftp.pcre.org&#x2F;pub&#x2F;pcre&#x2F;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"openssl下载地址\"><a href=\"#openssl下载地址\" class=\"headerlink\" title=\"openssl下载地址\"></a>openssl下载地址</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">http:&#x2F;&#x2F;www.openssl.org</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir soft</span><br><span class=\"line\">mkdir apps</span><br><span class=\"line\"></span><br><span class=\"line\">mv *.gz soft </span><br></pre></td></tr></table></figure>\n<h3 id=\"解压安装-pcre\"><a href=\"#解压安装-pcre\" class=\"headerlink\" title=\"解压安装 pcre\"></a>解压安装 pcre</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tar xf pcre-8.45.tar.gz</span><br><span class=\"line\">cd pcre-8.45</span><br><span class=\"line\">.&#x2F;configure --prefix&#x3D;&#x2F;home&#x2F;baseuser&#x2F;apps&#x2F;pcre</span><br><span class=\"line\">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"解压安装-zlib\"><a href=\"#解压安装-zlib\" class=\"headerlink\" title=\"解压安装 zlib\"></a>解压安装 zlib</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tar xf zlib-1.2.11.tar.gz</span><br><span class=\"line\">cd zlib-1.2.11</span><br><span class=\"line\">.&#x2F;configure --prefix&#x3D;&#x2F;home&#x2F;baseuser&#x2F;apps&#x2F;zlib</span><br><span class=\"line\">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>\n<h3 id=\"nginx\"><a href=\"#nginx\" class=\"headerlink\" title=\"nginx\"></a>nginx</h3><p>两个依赖都装好后，可以开始正式的nginx编译前检查</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tar xf nginx-1.20.1.tar.gz</span><br><span class=\"line\">cd nginx-1.20.1&#x2F;</span><br><span class=\"line\">.&#x2F;configure --prefix&#x3D;&#x2F;home&#x2F;baseuser&#x2F;apps&#x2F;nginx --with-http_stub_status_module --with-pcre&#x3D;&#x2F;home&#x2F;baseuser&#x2F;soft&#x2F;pcre-8.45 --with-zlib&#x3D;&#x2F;home&#x2F;baseuser&#x2F;soft&#x2F;zlib-1.2.11</span><br><span class=\"line\"></span><br><span class=\"line\">检查ok，编译和安装一般没问题：</span><br><span class=\"line\"></span><br><span class=\"line\">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"启动\"><a href=\"#启动\" class=\"headerlink\" title=\"启动\"></a>启动</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd &#x2F;home&#x2F;baseuser&#x2F;apps&#x2F;nginx&#x2F;sbin</span><br><span class=\"line\">sbin&#x2F;nginx </span><br><span class=\"line\"></span><br><span class=\"line\">nginx: [emerg] bind() to 0.0.0.0:80 failed (13: Permission denied)</span><br><span class=\"line\">　　报错原因：在linux下，普通用户只能用1024以上的端口，而1024以内的端口只能由root用户才可以使用，所以这里80端口只能由root才能使用。</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n\n","site":{"data":{}},"excerpt":"<p>摘要: centos7 普通用户下安装nginx</p>","more":"<h2 id=\"依赖包依然需要离线下载\"><a href=\"#依赖包依然需要离线下载\" class=\"headerlink\" title=\"依赖包依然需要离线下载\"></a>依赖包依然需要离线下载</h2><h3 id=\"下载nginx\"><a href=\"#下载nginx\" class=\"headerlink\" title=\"下载nginx\"></a>下载nginx</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">http:&#x2F;&#x2F;nginx.org&#x2F;en&#x2F;download.html</span><br></pre></td></tr></table></figure>\n<h3 id=\"zlib下载地址：\"><a href=\"#zlib下载地址：\" class=\"headerlink\" title=\"zlib下载地址：\"></a>zlib下载地址：</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">http:&#x2F;&#x2F;www.zlib.net&#x2F;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"prce下载地址\"><a href=\"#prce下载地址\" class=\"headerlink\" title=\"prce下载地址\"></a>prce下载地址</h3><p>注意别下pcre2</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ftp:&#x2F;&#x2F;ftp.pcre.org&#x2F;pub&#x2F;pcre&#x2F;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"openssl下载地址\"><a href=\"#openssl下载地址\" class=\"headerlink\" title=\"openssl下载地址\"></a>openssl下载地址</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">http:&#x2F;&#x2F;www.openssl.org</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir soft</span><br><span class=\"line\">mkdir apps</span><br><span class=\"line\"></span><br><span class=\"line\">mv *.gz soft </span><br></pre></td></tr></table></figure>\n<h3 id=\"解压安装-pcre\"><a href=\"#解压安装-pcre\" class=\"headerlink\" title=\"解压安装 pcre\"></a>解压安装 pcre</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tar xf pcre-8.45.tar.gz</span><br><span class=\"line\">cd pcre-8.45</span><br><span class=\"line\">.&#x2F;configure --prefix&#x3D;&#x2F;home&#x2F;baseuser&#x2F;apps&#x2F;pcre</span><br><span class=\"line\">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"解压安装-zlib\"><a href=\"#解压安装-zlib\" class=\"headerlink\" title=\"解压安装 zlib\"></a>解压安装 zlib</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tar xf zlib-1.2.11.tar.gz</span><br><span class=\"line\">cd zlib-1.2.11</span><br><span class=\"line\">.&#x2F;configure --prefix&#x3D;&#x2F;home&#x2F;baseuser&#x2F;apps&#x2F;zlib</span><br><span class=\"line\">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>\n<h3 id=\"nginx\"><a href=\"#nginx\" class=\"headerlink\" title=\"nginx\"></a>nginx</h3><p>两个依赖都装好后，可以开始正式的nginx编译前检查</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tar xf nginx-1.20.1.tar.gz</span><br><span class=\"line\">cd nginx-1.20.1&#x2F;</span><br><span class=\"line\">.&#x2F;configure --prefix&#x3D;&#x2F;home&#x2F;baseuser&#x2F;apps&#x2F;nginx --with-http_stub_status_module --with-pcre&#x3D;&#x2F;home&#x2F;baseuser&#x2F;soft&#x2F;pcre-8.45 --with-zlib&#x3D;&#x2F;home&#x2F;baseuser&#x2F;soft&#x2F;zlib-1.2.11</span><br><span class=\"line\"></span><br><span class=\"line\">检查ok，编译和安装一般没问题：</span><br><span class=\"line\"></span><br><span class=\"line\">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"启动\"><a href=\"#启动\" class=\"headerlink\" title=\"启动\"></a>启动</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd &#x2F;home&#x2F;baseuser&#x2F;apps&#x2F;nginx&#x2F;sbin</span><br><span class=\"line\">sbin&#x2F;nginx </span><br><span class=\"line\"></span><br><span class=\"line\">nginx: [emerg] bind() to 0.0.0.0:80 failed (13: Permission denied)</span><br><span class=\"line\">　　报错原因：在linux下，普通用户只能用1024以上的端口，而1024以内的端口只能由root用户才可以使用，所以这里80端口只能由root才能使用。</span><br></pre></td></tr></table></figure>"},{"title":"Centos7安装python3","date":"2020-12-12T07:32:00.000Z","_content":"  \n  \n摘要:  Centos7 安装pyhton3 环境\n<!-- more -->\n\n\n### 依赖准备\n```\nyum -y groupinstall \"Development tools\"\nyum -y install zlib-devel bzip2-devel openssl-devel ncurses-devel sqlite-devel readline-devel tk-devel gdbm-devel db4-devel libpcap-devel xz-devel\nyum install -y libffi-devel zlib1g-dev\nyum install zlib* -y\n```\n\n\n### python3下载页面\n```\nhttps://www.python.org/downloads/source/\n```\n```\nwget https://www.python.org/ftp/python/3.9.0/Python-3.9.0.tar.xz\n```\n\n`注意`： gcc 4.8.5不适用于编译Python3.8 及以上版本，但是可以编译Python 3.7。 使用GCC9.2来编译Python3.9\n```\ntar -xvJf  Python-3.9.0.tar.xz\n```\n创建编译安装目录\n```\nmkdir /usr/local/python3 \n```\n\n### 安装\n```\ncd Python-3.9.0\n./configure --prefix=/usr/local/python3 --enable-optimizations --with-ssl\n\n#第一个指定安装的路径,不指定的话,安装过程中可能软件所需要的文件复制到其他不同目录,删除软件很不方便,复制软件也不方便.\n#第二个可以提高python10%-20%代码运行速度.\n#第三个是为了安装pip需要用到ssl,后面报错会有提到.\n\nmake && make install\n```\n\n创建软链接\n```\nln -s /usr/local/python3/bin/python3 /usr/local/bin/python3\nln -s /usr/local/python3/bin/pip3 /usr/local/bin/pip3\n```\n\n验证是否成功\n```\npython3 -V\npip3 -V\n```\n\n### 修改pip 源\n```\ncd ~\nmkdir .pip\ncd .pip\nvim pip.conf\n\n#进入后添加以下内容,保存退出.\n[global]\nindex-url = https://mirrors.aliyun.com/pypi/simple\n```\n\n### 修改pipenv安装源\n\n在自己的虚拟环境中找到Pipfile文件,将其中的url = \"https://pypi.org/simple\" 修改为你需要的国内镜像,如 https://mirrors.aliyun.com/pypi/simple/\n```\n[root@localhost myproject]# vim Pipfile \n\n\n[[source]]\nname = \"pypi\"\nurl = \"https://pypi.org/simple\" # 改为url = \"https://mirrors.aliyun.com/pypi/simple/\"\nverify_ssl = true\n\n[dev-packages] #这里是开发环境专属包,使用pipenv install --dev package来安装专属开发环境的包\n\n[packages] # 全部环境的通用包,安装在这里.\n\n[requires]\npython_version = \"3.9\"\n```\n\n### 报错处理\n\n```\nzipimport.ZipImportError: can't decompress data; zlib not available Makefile:1099: recipe for target 'install' failed make: *** [install] Error 1\n```\n解决方式\n```\nyum -y install zlib1g-dev\n```\n\n```\nModuleNotFoundError: No module named '_ctypes'\n```\n解决方式\n```\nyum -y install libffi-devel\n```\n\n\n### 配置python 项目环境\n\n\n#### 创建python3 项目环境\n```\ncd /opt\npython3 -m venv py3\n\n```\n\n#### 创建项目目录\n```\ncd /opt/\nmkdir myapp\nsource /opt/py3/bin/activate\n```\n\n#### 自动激活项目环境\n```\ncd /opt/\ngit clone https://github.com/kennethreitz/autoenv.git\n\n# 进入项目路径\ncd myapp\nvim .env\nsource /opt/py3/bin/activate\n\n# 在环境变量添加\necho \"source /opt/autoenv/activate.sh\" >> /root/.bashrc\n\n```\n\n\n\n\n\n","source":"_posts/install/centos7安装python3.md","raw":"---\ntitle: Centos7安装python3\ndate: 2020-12-12 15:32\ncategories:\n- centos7\ntags:\n- python\n---\n  \n  \n摘要:  Centos7 安装pyhton3 环境\n<!-- more -->\n\n\n### 依赖准备\n```\nyum -y groupinstall \"Development tools\"\nyum -y install zlib-devel bzip2-devel openssl-devel ncurses-devel sqlite-devel readline-devel tk-devel gdbm-devel db4-devel libpcap-devel xz-devel\nyum install -y libffi-devel zlib1g-dev\nyum install zlib* -y\n```\n\n\n### python3下载页面\n```\nhttps://www.python.org/downloads/source/\n```\n```\nwget https://www.python.org/ftp/python/3.9.0/Python-3.9.0.tar.xz\n```\n\n`注意`： gcc 4.8.5不适用于编译Python3.8 及以上版本，但是可以编译Python 3.7。 使用GCC9.2来编译Python3.9\n```\ntar -xvJf  Python-3.9.0.tar.xz\n```\n创建编译安装目录\n```\nmkdir /usr/local/python3 \n```\n\n### 安装\n```\ncd Python-3.9.0\n./configure --prefix=/usr/local/python3 --enable-optimizations --with-ssl\n\n#第一个指定安装的路径,不指定的话,安装过程中可能软件所需要的文件复制到其他不同目录,删除软件很不方便,复制软件也不方便.\n#第二个可以提高python10%-20%代码运行速度.\n#第三个是为了安装pip需要用到ssl,后面报错会有提到.\n\nmake && make install\n```\n\n创建软链接\n```\nln -s /usr/local/python3/bin/python3 /usr/local/bin/python3\nln -s /usr/local/python3/bin/pip3 /usr/local/bin/pip3\n```\n\n验证是否成功\n```\npython3 -V\npip3 -V\n```\n\n### 修改pip 源\n```\ncd ~\nmkdir .pip\ncd .pip\nvim pip.conf\n\n#进入后添加以下内容,保存退出.\n[global]\nindex-url = https://mirrors.aliyun.com/pypi/simple\n```\n\n### 修改pipenv安装源\n\n在自己的虚拟环境中找到Pipfile文件,将其中的url = \"https://pypi.org/simple\" 修改为你需要的国内镜像,如 https://mirrors.aliyun.com/pypi/simple/\n```\n[root@localhost myproject]# vim Pipfile \n\n\n[[source]]\nname = \"pypi\"\nurl = \"https://pypi.org/simple\" # 改为url = \"https://mirrors.aliyun.com/pypi/simple/\"\nverify_ssl = true\n\n[dev-packages] #这里是开发环境专属包,使用pipenv install --dev package来安装专属开发环境的包\n\n[packages] # 全部环境的通用包,安装在这里.\n\n[requires]\npython_version = \"3.9\"\n```\n\n### 报错处理\n\n```\nzipimport.ZipImportError: can't decompress data; zlib not available Makefile:1099: recipe for target 'install' failed make: *** [install] Error 1\n```\n解决方式\n```\nyum -y install zlib1g-dev\n```\n\n```\nModuleNotFoundError: No module named '_ctypes'\n```\n解决方式\n```\nyum -y install libffi-devel\n```\n\n\n### 配置python 项目环境\n\n\n#### 创建python3 项目环境\n```\ncd /opt\npython3 -m venv py3\n\n```\n\n#### 创建项目目录\n```\ncd /opt/\nmkdir myapp\nsource /opt/py3/bin/activate\n```\n\n#### 自动激活项目环境\n```\ncd /opt/\ngit clone https://github.com/kennethreitz/autoenv.git\n\n# 进入项目路径\ncd myapp\nvim .env\nsource /opt/py3/bin/activate\n\n# 在环境变量添加\necho \"source /opt/autoenv/activate.sh\" >> /root/.bashrc\n\n```\n\n\n\n\n\n","slug":"install/centos7安装python3","published":1,"updated":"2021-06-18T08:07:11.193Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cku6979zk003z00uhfrhles9m","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><p>摘要:  Centos7 安装pyhton3 环境</p>\n<span id=\"more\"></span>\n\n\n<h3 id=\"依赖准备\"><a href=\"#依赖准备\" class=\"headerlink\" title=\"依赖准备\"></a>依赖准备</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum -y groupinstall &quot;Development tools&quot;</span><br><span class=\"line\">yum -y install zlib-devel bzip2-devel openssl-devel ncurses-devel sqlite-devel readline-devel tk-devel gdbm-devel db4-devel libpcap-devel xz-devel</span><br><span class=\"line\">yum install -y libffi-devel zlib1g-dev</span><br><span class=\"line\">yum install zlib* -y</span><br></pre></td></tr></table></figure>\n\n\n<h3 id=\"python3下载页面\"><a href=\"#python3下载页面\" class=\"headerlink\" title=\"python3下载页面\"></a>python3下载页面</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">https:&#x2F;&#x2F;www.python.org&#x2F;downloads&#x2F;source&#x2F;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget https:&#x2F;&#x2F;www.python.org&#x2F;ftp&#x2F;python&#x2F;3.9.0&#x2F;Python-3.9.0.tar.xz</span><br></pre></td></tr></table></figure>\n\n<p><code>注意</code>： gcc 4.8.5不适用于编译Python3.8 及以上版本，但是可以编译Python 3.7。 使用GCC9.2来编译Python3.9</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tar -xvJf  Python-3.9.0.tar.xz</span><br></pre></td></tr></table></figure>\n<p>创建编译安装目录</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir &#x2F;usr&#x2F;local&#x2F;python3 </span><br></pre></td></tr></table></figure>\n\n<h3 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd Python-3.9.0</span><br><span class=\"line\">.&#x2F;configure --prefix&#x3D;&#x2F;usr&#x2F;local&#x2F;python3 --enable-optimizations --with-ssl</span><br><span class=\"line\"></span><br><span class=\"line\">#第一个指定安装的路径,不指定的话,安装过程中可能软件所需要的文件复制到其他不同目录,删除软件很不方便,复制软件也不方便.</span><br><span class=\"line\">#第二个可以提高python10%-20%代码运行速度.</span><br><span class=\"line\">#第三个是为了安装pip需要用到ssl,后面报错会有提到.</span><br><span class=\"line\"></span><br><span class=\"line\">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>\n\n<p>创建软链接</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ln -s &#x2F;usr&#x2F;local&#x2F;python3&#x2F;bin&#x2F;python3 &#x2F;usr&#x2F;local&#x2F;bin&#x2F;python3</span><br><span class=\"line\">ln -s &#x2F;usr&#x2F;local&#x2F;python3&#x2F;bin&#x2F;pip3 &#x2F;usr&#x2F;local&#x2F;bin&#x2F;pip3</span><br></pre></td></tr></table></figure>\n\n<p>验证是否成功</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">python3 -V</span><br><span class=\"line\">pip3 -V</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"修改pip-源\"><a href=\"#修改pip-源\" class=\"headerlink\" title=\"修改pip 源\"></a>修改pip 源</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd ~</span><br><span class=\"line\">mkdir .pip</span><br><span class=\"line\">cd .pip</span><br><span class=\"line\">vim pip.conf</span><br><span class=\"line\"></span><br><span class=\"line\">#进入后添加以下内容,保存退出.</span><br><span class=\"line\">[global]</span><br><span class=\"line\">index-url &#x3D; https:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;pypi&#x2F;simple</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"修改pipenv安装源\"><a href=\"#修改pipenv安装源\" class=\"headerlink\" title=\"修改pipenv安装源\"></a>修改pipenv安装源</h3><p>在自己的虚拟环境中找到Pipfile文件,将其中的url = “<a href=\"https://pypi.org/simple&quot;\">https://pypi.org/simple&quot;</a> 修改为你需要的国内镜像,如 <a href=\"https://mirrors.aliyun.com/pypi/simple/\">https://mirrors.aliyun.com/pypi/simple/</a></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost myproject]# vim Pipfile </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">[[source]]</span><br><span class=\"line\">name &#x3D; &quot;pypi&quot;</span><br><span class=\"line\">url &#x3D; &quot;https:&#x2F;&#x2F;pypi.org&#x2F;simple&quot; # 改为url &#x3D; &quot;https:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;pypi&#x2F;simple&#x2F;&quot;</span><br><span class=\"line\">verify_ssl &#x3D; true</span><br><span class=\"line\"></span><br><span class=\"line\">[dev-packages] #这里是开发环境专属包,使用pipenv install --dev package来安装专属开发环境的包</span><br><span class=\"line\"></span><br><span class=\"line\">[packages] # 全部环境的通用包,安装在这里.</span><br><span class=\"line\"></span><br><span class=\"line\">[requires]</span><br><span class=\"line\">python_version &#x3D; &quot;3.9&quot;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"报错处理\"><a href=\"#报错处理\" class=\"headerlink\" title=\"报错处理\"></a>报错处理</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">zipimport.ZipImportError: can&#39;t decompress data; zlib not available Makefile:1099: recipe for target &#39;install&#39; failed make: *** [install] Error 1</span><br></pre></td></tr></table></figure>\n<p>解决方式</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum -y install zlib1g-dev</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ModuleNotFoundError: No module named &#39;_ctypes&#39;</span><br></pre></td></tr></table></figure>\n<p>解决方式</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum -y install libffi-devel</span><br></pre></td></tr></table></figure>\n\n\n<h3 id=\"配置python-项目环境\"><a href=\"#配置python-项目环境\" class=\"headerlink\" title=\"配置python 项目环境\"></a>配置python 项目环境</h3><h4 id=\"创建python3-项目环境\"><a href=\"#创建python3-项目环境\" class=\"headerlink\" title=\"创建python3 项目环境\"></a>创建python3 项目环境</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd &#x2F;opt</span><br><span class=\"line\">python3 -m venv py3</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"创建项目目录\"><a href=\"#创建项目目录\" class=\"headerlink\" title=\"创建项目目录\"></a>创建项目目录</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd &#x2F;opt&#x2F;</span><br><span class=\"line\">mkdir myapp</span><br><span class=\"line\">source &#x2F;opt&#x2F;py3&#x2F;bin&#x2F;activate</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"自动激活项目环境\"><a href=\"#自动激活项目环境\" class=\"headerlink\" title=\"自动激活项目环境\"></a>自动激活项目环境</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd &#x2F;opt&#x2F;</span><br><span class=\"line\">git clone https:&#x2F;&#x2F;github.com&#x2F;kennethreitz&#x2F;autoenv.git</span><br><span class=\"line\"></span><br><span class=\"line\"># 进入项目路径</span><br><span class=\"line\">cd myapp</span><br><span class=\"line\">vim .env</span><br><span class=\"line\">source &#x2F;opt&#x2F;py3&#x2F;bin&#x2F;activate</span><br><span class=\"line\"></span><br><span class=\"line\"># 在环境变量添加</span><br><span class=\"line\">echo &quot;source &#x2F;opt&#x2F;autoenv&#x2F;activate.sh&quot; &gt;&gt; &#x2F;root&#x2F;.bashrc</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n\n\n","site":{"data":{}},"excerpt":"<p>摘要:  Centos7 安装pyhton3 环境</p>","more":"<h3 id=\"依赖准备\"><a href=\"#依赖准备\" class=\"headerlink\" title=\"依赖准备\"></a>依赖准备</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum -y groupinstall &quot;Development tools&quot;</span><br><span class=\"line\">yum -y install zlib-devel bzip2-devel openssl-devel ncurses-devel sqlite-devel readline-devel tk-devel gdbm-devel db4-devel libpcap-devel xz-devel</span><br><span class=\"line\">yum install -y libffi-devel zlib1g-dev</span><br><span class=\"line\">yum install zlib* -y</span><br></pre></td></tr></table></figure>\n\n\n<h3 id=\"python3下载页面\"><a href=\"#python3下载页面\" class=\"headerlink\" title=\"python3下载页面\"></a>python3下载页面</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">https:&#x2F;&#x2F;www.python.org&#x2F;downloads&#x2F;source&#x2F;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget https:&#x2F;&#x2F;www.python.org&#x2F;ftp&#x2F;python&#x2F;3.9.0&#x2F;Python-3.9.0.tar.xz</span><br></pre></td></tr></table></figure>\n\n<p><code>注意</code>： gcc 4.8.5不适用于编译Python3.8 及以上版本，但是可以编译Python 3.7。 使用GCC9.2来编译Python3.9</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tar -xvJf  Python-3.9.0.tar.xz</span><br></pre></td></tr></table></figure>\n<p>创建编译安装目录</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir &#x2F;usr&#x2F;local&#x2F;python3 </span><br></pre></td></tr></table></figure>\n\n<h3 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd Python-3.9.0</span><br><span class=\"line\">.&#x2F;configure --prefix&#x3D;&#x2F;usr&#x2F;local&#x2F;python3 --enable-optimizations --with-ssl</span><br><span class=\"line\"></span><br><span class=\"line\">#第一个指定安装的路径,不指定的话,安装过程中可能软件所需要的文件复制到其他不同目录,删除软件很不方便,复制软件也不方便.</span><br><span class=\"line\">#第二个可以提高python10%-20%代码运行速度.</span><br><span class=\"line\">#第三个是为了安装pip需要用到ssl,后面报错会有提到.</span><br><span class=\"line\"></span><br><span class=\"line\">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>\n\n<p>创建软链接</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ln -s &#x2F;usr&#x2F;local&#x2F;python3&#x2F;bin&#x2F;python3 &#x2F;usr&#x2F;local&#x2F;bin&#x2F;python3</span><br><span class=\"line\">ln -s &#x2F;usr&#x2F;local&#x2F;python3&#x2F;bin&#x2F;pip3 &#x2F;usr&#x2F;local&#x2F;bin&#x2F;pip3</span><br></pre></td></tr></table></figure>\n\n<p>验证是否成功</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">python3 -V</span><br><span class=\"line\">pip3 -V</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"修改pip-源\"><a href=\"#修改pip-源\" class=\"headerlink\" title=\"修改pip 源\"></a>修改pip 源</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd ~</span><br><span class=\"line\">mkdir .pip</span><br><span class=\"line\">cd .pip</span><br><span class=\"line\">vim pip.conf</span><br><span class=\"line\"></span><br><span class=\"line\">#进入后添加以下内容,保存退出.</span><br><span class=\"line\">[global]</span><br><span class=\"line\">index-url &#x3D; https:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;pypi&#x2F;simple</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"修改pipenv安装源\"><a href=\"#修改pipenv安装源\" class=\"headerlink\" title=\"修改pipenv安装源\"></a>修改pipenv安装源</h3><p>在自己的虚拟环境中找到Pipfile文件,将其中的url = “<a href=\"https://pypi.org/simple&quot;\">https://pypi.org/simple&quot;</a> 修改为你需要的国内镜像,如 <a href=\"https://mirrors.aliyun.com/pypi/simple/\">https://mirrors.aliyun.com/pypi/simple/</a></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost myproject]# vim Pipfile </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">[[source]]</span><br><span class=\"line\">name &#x3D; &quot;pypi&quot;</span><br><span class=\"line\">url &#x3D; &quot;https:&#x2F;&#x2F;pypi.org&#x2F;simple&quot; # 改为url &#x3D; &quot;https:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;pypi&#x2F;simple&#x2F;&quot;</span><br><span class=\"line\">verify_ssl &#x3D; true</span><br><span class=\"line\"></span><br><span class=\"line\">[dev-packages] #这里是开发环境专属包,使用pipenv install --dev package来安装专属开发环境的包</span><br><span class=\"line\"></span><br><span class=\"line\">[packages] # 全部环境的通用包,安装在这里.</span><br><span class=\"line\"></span><br><span class=\"line\">[requires]</span><br><span class=\"line\">python_version &#x3D; &quot;3.9&quot;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"报错处理\"><a href=\"#报错处理\" class=\"headerlink\" title=\"报错处理\"></a>报错处理</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">zipimport.ZipImportError: can&#39;t decompress data; zlib not available Makefile:1099: recipe for target &#39;install&#39; failed make: *** [install] Error 1</span><br></pre></td></tr></table></figure>\n<p>解决方式</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum -y install zlib1g-dev</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ModuleNotFoundError: No module named &#39;_ctypes&#39;</span><br></pre></td></tr></table></figure>\n<p>解决方式</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum -y install libffi-devel</span><br></pre></td></tr></table></figure>\n\n\n<h3 id=\"配置python-项目环境\"><a href=\"#配置python-项目环境\" class=\"headerlink\" title=\"配置python 项目环境\"></a>配置python 项目环境</h3><h4 id=\"创建python3-项目环境\"><a href=\"#创建python3-项目环境\" class=\"headerlink\" title=\"创建python3 项目环境\"></a>创建python3 项目环境</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd &#x2F;opt</span><br><span class=\"line\">python3 -m venv py3</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"创建项目目录\"><a href=\"#创建项目目录\" class=\"headerlink\" title=\"创建项目目录\"></a>创建项目目录</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd &#x2F;opt&#x2F;</span><br><span class=\"line\">mkdir myapp</span><br><span class=\"line\">source &#x2F;opt&#x2F;py3&#x2F;bin&#x2F;activate</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"自动激活项目环境\"><a href=\"#自动激活项目环境\" class=\"headerlink\" title=\"自动激活项目环境\"></a>自动激活项目环境</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd &#x2F;opt&#x2F;</span><br><span class=\"line\">git clone https:&#x2F;&#x2F;github.com&#x2F;kennethreitz&#x2F;autoenv.git</span><br><span class=\"line\"></span><br><span class=\"line\"># 进入项目路径</span><br><span class=\"line\">cd myapp</span><br><span class=\"line\">vim .env</span><br><span class=\"line\">source &#x2F;opt&#x2F;py3&#x2F;bin&#x2F;activate</span><br><span class=\"line\"></span><br><span class=\"line\"># 在环境变量添加</span><br><span class=\"line\">echo &quot;source &#x2F;opt&#x2F;autoenv&#x2F;activate.sh&quot; &gt;&gt; &#x2F;root&#x2F;.bashrc</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>"},{"title":"centos7安装RabbitMQ","date":"2021-07-29T08:00:00.000Z","_content":"\t\n\t\n摘要: Centos7下安装RabbitMQ\n<!-- more -->\n\n\n## erlang 与 rabbitmq对应关系\n```\nhttps://www.rabbitmq.com/which-erlang.html\n```\n\n## 获取 erlang\n\n```\n\nhttps://github.com/rabbitmq/erlang-rpm/releases\n\n\n```\n\n\n## 获取 rabbitmq\n\n```\nhttps://www.rabbitmq.com/\n\n下载页面\nhttps://www.rabbitmq.com/download.html\n\nhttps://www.rabbitmq.com/install-rpm.html\n```\n\n## 安装\n```\nyum install erlang-20.3-1.el7.centos.x86_64.rpm -y\nyum install rabbitmq-server-3.7.8-1.el7.noarch.rpm -y\n```\n\n## 修改配置文件\n\n```\n# 目录需要创建\nmkdir /usr/local/rabbitmq\ncp /usr/share/doc/rabbitmq-server-3.7.8/rabbitmq.config.example /usr/local/rabbitmq/rabbitmq.config\n```\n\n修改配置文件,允许远程访问\n```\nvim rabbitmq.config\n\n%%{loopback_users, []},\n修改为\n\n{loopback_users, []}\n```\n\n\n## 启动rabbitmq插件管理\n```\nrabbitmq-plugins enable rabbitmq_management\n```\n\n## 启动RabbitMQ\n```\nsystemctl start rabbitmq-server # 启动rabbitmq服务\nsystemctl restart rabbitmq-server # 重启服务\nsystemctl stop rabbitmq-server  # 停止服务\n```\n\n## 访问web管理界面\n输入你的 ip:15672\n进入如下界面\n用户名是：guest\n密码也是：guest\n\n\n##  查看服务启动状态\n```\nrabbitmqctl status\n```\n\n## 查询安装默认的用户\n```\nrabbitmqctl list_users\n```\n\n## 配置用户\n```\nrabbitmqctl add_user ttx ttx2011\nrabbitmqctl list_users\nrabbitmqctl set_user_tags ttx administrator\nrabbitmqctl set_permissions -p \"/\" ttx \".*\" \".*\" \".*\"\n```","source":"_posts/install/centos7安装rabbitmq.md","raw":"---\ntitle: centos7安装RabbitMQ\ndate: 2021-07-29 16:00\ncategories:\n- linux\ntags:\n- rabbitmq\n---\n\t\n\t\n摘要: Centos7下安装RabbitMQ\n<!-- more -->\n\n\n## erlang 与 rabbitmq对应关系\n```\nhttps://www.rabbitmq.com/which-erlang.html\n```\n\n## 获取 erlang\n\n```\n\nhttps://github.com/rabbitmq/erlang-rpm/releases\n\n\n```\n\n\n## 获取 rabbitmq\n\n```\nhttps://www.rabbitmq.com/\n\n下载页面\nhttps://www.rabbitmq.com/download.html\n\nhttps://www.rabbitmq.com/install-rpm.html\n```\n\n## 安装\n```\nyum install erlang-20.3-1.el7.centos.x86_64.rpm -y\nyum install rabbitmq-server-3.7.8-1.el7.noarch.rpm -y\n```\n\n## 修改配置文件\n\n```\n# 目录需要创建\nmkdir /usr/local/rabbitmq\ncp /usr/share/doc/rabbitmq-server-3.7.8/rabbitmq.config.example /usr/local/rabbitmq/rabbitmq.config\n```\n\n修改配置文件,允许远程访问\n```\nvim rabbitmq.config\n\n%%{loopback_users, []},\n修改为\n\n{loopback_users, []}\n```\n\n\n## 启动rabbitmq插件管理\n```\nrabbitmq-plugins enable rabbitmq_management\n```\n\n## 启动RabbitMQ\n```\nsystemctl start rabbitmq-server # 启动rabbitmq服务\nsystemctl restart rabbitmq-server # 重启服务\nsystemctl stop rabbitmq-server  # 停止服务\n```\n\n## 访问web管理界面\n输入你的 ip:15672\n进入如下界面\n用户名是：guest\n密码也是：guest\n\n\n##  查看服务启动状态\n```\nrabbitmqctl status\n```\n\n## 查询安装默认的用户\n```\nrabbitmqctl list_users\n```\n\n## 配置用户\n```\nrabbitmqctl add_user ttx ttx2011\nrabbitmqctl list_users\nrabbitmqctl set_user_tags ttx administrator\nrabbitmqctl set_permissions -p \"/\" ttx \".*\" \".*\" \".*\"\n```","slug":"install/centos7安装rabbitmq","published":1,"updated":"2021-07-29T09:28:57.873Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cku6979zm004300uhc37n130f","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><p>摘要: Centos7下安装RabbitMQ</p>\n<span id=\"more\"></span>\n\n\n<h2 id=\"erlang-与-rabbitmq对应关系\"><a href=\"#erlang-与-rabbitmq对应关系\" class=\"headerlink\" title=\"erlang 与 rabbitmq对应关系\"></a>erlang 与 rabbitmq对应关系</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">https:&#x2F;&#x2F;www.rabbitmq.com&#x2F;which-erlang.html</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"获取-erlang\"><a href=\"#获取-erlang\" class=\"headerlink\" title=\"获取 erlang\"></a>获取 erlang</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">https:&#x2F;&#x2F;github.com&#x2F;rabbitmq&#x2F;erlang-rpm&#x2F;releases</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"获取-rabbitmq\"><a href=\"#获取-rabbitmq\" class=\"headerlink\" title=\"获取 rabbitmq\"></a>获取 rabbitmq</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">https:&#x2F;&#x2F;www.rabbitmq.com&#x2F;</span><br><span class=\"line\"></span><br><span class=\"line\">下载页面</span><br><span class=\"line\">https:&#x2F;&#x2F;www.rabbitmq.com&#x2F;download.html</span><br><span class=\"line\"></span><br><span class=\"line\">https:&#x2F;&#x2F;www.rabbitmq.com&#x2F;install-rpm.html</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install erlang-20.3-1.el7.centos.x86_64.rpm -y</span><br><span class=\"line\">yum install rabbitmq-server-3.7.8-1.el7.noarch.rpm -y</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"修改配置文件\"><a href=\"#修改配置文件\" class=\"headerlink\" title=\"修改配置文件\"></a>修改配置文件</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 目录需要创建</span><br><span class=\"line\">mkdir &#x2F;usr&#x2F;local&#x2F;rabbitmq</span><br><span class=\"line\">cp &#x2F;usr&#x2F;share&#x2F;doc&#x2F;rabbitmq-server-3.7.8&#x2F;rabbitmq.config.example &#x2F;usr&#x2F;local&#x2F;rabbitmq&#x2F;rabbitmq.config</span><br></pre></td></tr></table></figure>\n\n<p>修改配置文件,允许远程访问</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim rabbitmq.config</span><br><span class=\"line\"></span><br><span class=\"line\">%%&#123;loopback_users, []&#125;,</span><br><span class=\"line\">修改为</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;loopback_users, []&#125;</span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"启动rabbitmq插件管理\"><a href=\"#启动rabbitmq插件管理\" class=\"headerlink\" title=\"启动rabbitmq插件管理\"></a>启动rabbitmq插件管理</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rabbitmq-plugins enable rabbitmq_management</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"启动RabbitMQ\"><a href=\"#启动RabbitMQ\" class=\"headerlink\" title=\"启动RabbitMQ\"></a>启动RabbitMQ</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl start rabbitmq-server # 启动rabbitmq服务</span><br><span class=\"line\">systemctl restart rabbitmq-server # 重启服务</span><br><span class=\"line\">systemctl stop rabbitmq-server  # 停止服务</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"访问web管理界面\"><a href=\"#访问web管理界面\" class=\"headerlink\" title=\"访问web管理界面\"></a>访问web管理界面</h2><p>输入你的 ip:15672<br>进入如下界面<br>用户名是：guest<br>密码也是：guest</p>\n<h2 id=\"查看服务启动状态\"><a href=\"#查看服务启动状态\" class=\"headerlink\" title=\"查看服务启动状态\"></a>查看服务启动状态</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rabbitmqctl status</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"查询安装默认的用户\"><a href=\"#查询安装默认的用户\" class=\"headerlink\" title=\"查询安装默认的用户\"></a>查询安装默认的用户</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rabbitmqctl list_users</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"配置用户\"><a href=\"#配置用户\" class=\"headerlink\" title=\"配置用户\"></a>配置用户</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rabbitmqctl add_user ttx ttx2011</span><br><span class=\"line\">rabbitmqctl list_users</span><br><span class=\"line\">rabbitmqctl set_user_tags ttx administrator</span><br><span class=\"line\">rabbitmqctl set_permissions -p &quot;&#x2F;&quot; ttx &quot;.*&quot; &quot;.*&quot; &quot;.*&quot;</span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"<p>摘要: Centos7下安装RabbitMQ</p>","more":"<h2 id=\"erlang-与-rabbitmq对应关系\"><a href=\"#erlang-与-rabbitmq对应关系\" class=\"headerlink\" title=\"erlang 与 rabbitmq对应关系\"></a>erlang 与 rabbitmq对应关系</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">https:&#x2F;&#x2F;www.rabbitmq.com&#x2F;which-erlang.html</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"获取-erlang\"><a href=\"#获取-erlang\" class=\"headerlink\" title=\"获取 erlang\"></a>获取 erlang</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">https:&#x2F;&#x2F;github.com&#x2F;rabbitmq&#x2F;erlang-rpm&#x2F;releases</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"获取-rabbitmq\"><a href=\"#获取-rabbitmq\" class=\"headerlink\" title=\"获取 rabbitmq\"></a>获取 rabbitmq</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">https:&#x2F;&#x2F;www.rabbitmq.com&#x2F;</span><br><span class=\"line\"></span><br><span class=\"line\">下载页面</span><br><span class=\"line\">https:&#x2F;&#x2F;www.rabbitmq.com&#x2F;download.html</span><br><span class=\"line\"></span><br><span class=\"line\">https:&#x2F;&#x2F;www.rabbitmq.com&#x2F;install-rpm.html</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install erlang-20.3-1.el7.centos.x86_64.rpm -y</span><br><span class=\"line\">yum install rabbitmq-server-3.7.8-1.el7.noarch.rpm -y</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"修改配置文件\"><a href=\"#修改配置文件\" class=\"headerlink\" title=\"修改配置文件\"></a>修改配置文件</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 目录需要创建</span><br><span class=\"line\">mkdir &#x2F;usr&#x2F;local&#x2F;rabbitmq</span><br><span class=\"line\">cp &#x2F;usr&#x2F;share&#x2F;doc&#x2F;rabbitmq-server-3.7.8&#x2F;rabbitmq.config.example &#x2F;usr&#x2F;local&#x2F;rabbitmq&#x2F;rabbitmq.config</span><br></pre></td></tr></table></figure>\n\n<p>修改配置文件,允许远程访问</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim rabbitmq.config</span><br><span class=\"line\"></span><br><span class=\"line\">%%&#123;loopback_users, []&#125;,</span><br><span class=\"line\">修改为</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;loopback_users, []&#125;</span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"启动rabbitmq插件管理\"><a href=\"#启动rabbitmq插件管理\" class=\"headerlink\" title=\"启动rabbitmq插件管理\"></a>启动rabbitmq插件管理</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rabbitmq-plugins enable rabbitmq_management</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"启动RabbitMQ\"><a href=\"#启动RabbitMQ\" class=\"headerlink\" title=\"启动RabbitMQ\"></a>启动RabbitMQ</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl start rabbitmq-server # 启动rabbitmq服务</span><br><span class=\"line\">systemctl restart rabbitmq-server # 重启服务</span><br><span class=\"line\">systemctl stop rabbitmq-server  # 停止服务</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"访问web管理界面\"><a href=\"#访问web管理界面\" class=\"headerlink\" title=\"访问web管理界面\"></a>访问web管理界面</h2><p>输入你的 ip:15672<br>进入如下界面<br>用户名是：guest<br>密码也是：guest</p>\n<h2 id=\"查看服务启动状态\"><a href=\"#查看服务启动状态\" class=\"headerlink\" title=\"查看服务启动状态\"></a>查看服务启动状态</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rabbitmqctl status</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"查询安装默认的用户\"><a href=\"#查询安装默认的用户\" class=\"headerlink\" title=\"查询安装默认的用户\"></a>查询安装默认的用户</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rabbitmqctl list_users</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"配置用户\"><a href=\"#配置用户\" class=\"headerlink\" title=\"配置用户\"></a>配置用户</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rabbitmqctl add_user ttx ttx2011</span><br><span class=\"line\">rabbitmqctl list_users</span><br><span class=\"line\">rabbitmqctl set_user_tags ttx administrator</span><br><span class=\"line\">rabbitmqctl set_permissions -p &quot;&#x2F;&quot; ttx &quot;.*&quot; &quot;.*&quot; &quot;.*&quot;</span><br></pre></td></tr></table></figure>"},{"title":"centos7安装redis集群","date":"2021-07-29T01:22:00.000Z","_content":"\t\n\t\n摘要: centos7 安装redis集群\n<!-- more -->\n\n\n## 主机\n|主机|端口|\n|---|---|\n|10.200.75.193|6379|\n|10.200.75.193|6380|\n|10.200.75.194|6379|\n|10.200.75.194|6380|\n|10.200.75.195|6379|\n|10.200.75.195|6380|\n\n\n\n## 目录创建\n```\nmkdir -p /opt/{redis,soft}\n```\n## 编译安装\n```\nmake\nmake install PREFIX=/usr/local/redis\n```\n\n\n## redis解压\n```\ncd /opt/soft\n\ntar xvf redis-4.0.10.tar.gz -C /opt/redis/\nmv redis-4.0.10  redis-6379\ncp -rf redis-6379 redis-6380\n```\n\n## 目录创建\n```\nmkdir redis-6379/{conf,data,logs}\nmkdir redis-6380/{conf,data,logs}\n```\n\n## 配置文件\n```\nvim  redis-6379/conf/redis.conf\n\n# 允许访问地址\nbind 0.0.0.0\n# 关闭保护模式\nprotected-mode no\n# 端口\nport 6379\n# 设置tcp的backlog\ntcp-backlog 511\n# 当客户端闲置多长时间后关闭连接，如果指定为0，表示永不关闭：\ntimeout 0\n# 设置检测客户端网络中断时间间隔，单位为秒，如果设置为0，则不检测，建议设置为60：\ntcp-keepalive 0\n# 后台运行\ndaemonize yes\nsupervised no\n# 后台运行时，redis默认会把pid写入/var/run/redis.pid文件\npidfile /var/run/redis_6379.pid\n# 指定日志记录级别，redis总共支持四个级别：debug、verbose、notice、warning\nloglevel notice\n# 日志输出路径\nlogfile \"/opt/redis/redis-6379/logs/redis.log\"\n# 设置数据库数量，默认值为16，默认当前数据库为0\ndatabases 16\n# 指定在多长时间内，有多少次更新操作，就将数据同步到数据文件，可以多个条件配合\nsave 900 1\nsave 300 10\nsave 60 10000\n# \nstop-writes-on-bgsave-error yes\n# 指定存储至本地数据库时是否压缩数据，默认为yes，redis采用LZF压缩，如果为了节省CPU时间，可以关闭该选项，但会导致数据库文件变得巨大\nrdbcompression yes\nrdbchecksum yes\n# 指定本地数据库文件名\ndbfilename dump.rdb\n# 配置数据目录  \ndir /opt/redis/redis-6379/data\nslave-serve-stale-data yes\nslave-read-only yes\nrepl-diskless-sync no\nrepl-diskless-sync-delay 5\nrepl-disable-tcp-nodelay no\nslave-priority 100\n# 默认redis使用的是rdb方式持久化，这种方式在许多应用中已经足够用了，\n# 但是redis如果中途宕机，会导致可能有几分钟的数据丢失，\n# 根据save来策略进行持久化，Append Only File是另一种持久化方式，可以提供更好的持久化特性，\n# Redis会把每次写入的数据在接收后都写入 appendonly.aof 文件，\n# 每次启动时Redis都会先把这个文件的数据读入内存里，先忽略RDB文件。\nappendonly yes\n# 指定更新日志文件名\nappendfilename \"appendonly.aof\"\n# 指定更新日志条件，共有3个可选值：\n# no：表示等操作系统进行数据缓存同步到磁盘（快）；\n# always：表示每次更新操作后手动调用fsync()将数据写到磁盘（慢，安全）；\n# everysec：表示每秒同步一次（折中，默认值）\nappendfsync everysec\nno-appendfsync-on-rewrite no\nauto-aof-rewrite-percentage 100\nauto-aof-rewrite-min-size 64mb\naof-load-truncated yes\nlua-time-limit 5000\n# 是否开启集群\ncluster-enabled yes\n# 集群配置文件的名称，每个节点都有一个集群相关的配置文件，持久化保存集群的信息，\n# 这个文件并不需要手动配置，这个配置文件有Redis生成并更新，\n# 每个Redis集群节点需要一个单独的配置文件，请确保与实例运行的系统中配置文件名称不冲突。\ncluster-config-file master-01.conf\n# 节点互连超时的阀值。集群节点超时毫秒数\ncluster-node-timeout 5000\nslowlog-log-slower-than 10000\nslowlog-max-len 128\nlatency-monitor-threshold 0\nnotify-keyspace-events \"\"\nhash-max-ziplist-entries 512\nhash-max-ziplist-value 64\nlist-max-ziplist-size -2\nlist-compress-depth 0\nset-max-intset-entries 512\nzset-max-ziplist-entries 128\nzset-max-ziplist-value 64\nhll-sparse-max-bytes 3000\nactiverehashing yes\nclient-output-buffer-limit normal 0 0 0\nclient-output-buffer-limit slave 256mb 64mb 60\nclient-output-buffer-limit pubsub 32mb 8mb 60\nhz 10\naof-rewrite-incremental-fsync yes\n\n```\n\n\n```\nvim  redis-6380/conf/redis.conf\n\n# 允许访问地址\nbind 0.0.0.0\n# 关闭保护模式\nprotected-mode no\n# 端口\nport 6380\n# 设置tcp的backlog\ntcp-backlog 511\n# 当客户端闲置多长时间后关闭连接，如果指定为0，表示永不关闭：\ntimeout 0\n# 设置检测客户端网络中断时间间隔，单位为秒，如果设置为0，则不检测，建议设置为60：\ntcp-keepalive 0\n# 后台运行\ndaemonize yes\nsupervised no\n# 后台运行时，redis默认会把pid写入/var/run/redis.pid文件\npidfile /var/run/redis_6380.pid\n# 指定日志记录级别，redis总共支持四个级别：debug、verbose、notice、warning\nloglevel notice\n# 日志输出路径\nlogfile \"/opt/redis/redis-6380/logs/redis.log\"\n# 设置数据库数量，默认值为16，默认当前数据库为0\ndatabases 16\n# 指定在多长时间内，有多少次更新操作，就将数据同步到数据文件，可以多个条件配合\nsave 900 1\nsave 300 10\nsave 60 10000\n# \nstop-writes-on-bgsave-error yes\n# 指定存储至本地数据库时是否压缩数据，默认为yes，redis采用LZF压缩，如果为了节省CPU时间，可以关闭该选项，但会导致数据库文件变得巨大\nrdbcompression yes\nrdbchecksum yes\n# 指定本地数据库文件名\ndbfilename dump.rdb\n# 配置数据目录  \ndir /opt/redis/redis-6380/data\nslave-serve-stale-data yes\nslave-read-only yes\nrepl-diskless-sync no\nrepl-diskless-sync-delay 5\nrepl-disable-tcp-nodelay no\nslave-priority 100\n# 默认redis使用的是rdb方式持久化，这种方式在许多应用中已经足够用了，\n# 但是redis如果中途宕机，会导致可能有几分钟的数据丢失，\n# 根据save来策略进行持久化，Append Only File是另一种持久化方式，可以提供更好的持久化特性，\n# Redis会把每次写入的数据在接收后都写入 appendonly.aof 文件，\n# 每次启动时Redis都会先把这个文件的数据读入内存里，先忽略RDB文件。\nappendonly yes\n# 指定更新日志文件名\nappendfilename \"appendonly.aof\"\n# 指定更新日志条件，共有3个可选值：\n# no：表示等操作系统进行数据缓存同步到磁盘（快）；\n# always：表示每次更新操作后手动调用fsync()将数据写到磁盘（慢，安全）；\n# everysec：表示每秒同步一次（折中，默认值）\nappendfsync everysec\nno-appendfsync-on-rewrite no\nauto-aof-rewrite-percentage 100\nauto-aof-rewrite-min-size 64mb\naof-load-truncated yes\nlua-time-limit 5000\n# 是否开启集群\ncluster-enabled yes\n# 集群配置文件的名称，每个节点都有一个集群相关的配置文件，持久化保存集群的信息，\n# 这个文件并不需要手动配置，这个配置文件有Redis生成并更新，\n# 每个Redis集群节点需要一个单独的配置文件，请确保与实例运行的系统中配置文件名称不冲突。\ncluster-config-file slave-01.conf   ##  修改此处\n# 节点互连超时的阀值。集群节点超时毫秒数\ncluster-node-timeout 5000\nslowlog-log-slower-than 10000\nslowlog-max-len 128\nlatency-monitor-threshold 0\nnotify-keyspace-events \"\"\nhash-max-ziplist-entries 512\nhash-max-ziplist-value 64\nlist-max-ziplist-size -2\nlist-compress-depth 0\nset-max-intset-entries 512\nzset-max-ziplist-entries 128\nzset-max-ziplist-value 64\nhll-sparse-max-bytes 3000\nactiverehashing yes\nclient-output-buffer-limit normal 0 0 0\nclient-output-buffer-limit slave 256mb 64mb 60\nclient-output-buffer-limit pubsub 32mb 8mb 60\nhz 10\naof-rewrite-incremental-fsync yes\n\n```\n\n\n## systemctl管理\n```\nvim /lib/systemd/system/redis-6379.service\n\n[Unit]\nDescription=redis.server\nAfter=network.target\n\n[Service]\nType=forking\nPIDFILE=/var/run/redis_6379.pid\nExecStart=/opt/redis/redis-6379/bin/redis-server /opt/redis/redis-6379/conf/redis.conf\nExecRepload=/bin/kill -s HUP $MAINPID\nExecStop=/bin/kill -s QUIT $MAINPID\nPrivateTmp=true\n[Install]\nWantedBy=multi-user.target\n```\n\n```\nvim /lib/systemd/system/redis-6380.service\n\n\n[Unit]\nDescription=redis.server\nAfter=network.target\n\n[Service]\nType=forking\nPIDFILE=/var/run/redis_6380.pid\nExecStart=/opt/redis/redis-6380/bin/redis-server /opt/redis/redis-6380/conf/redis.conf\nExecRepload=/bin/kill -s HUP $MAINPID\nExecStop=/bin/kill -s QUIT $MAINPID\nPrivateTmp=true\n[Install]\nWantedBy=multi-user.target\n\n```\n\n## systemctl管理\n```\nsystemctl daemon-reload\n\n# 启动redis服务\nsystemctl start redis-6379.service\nsystemctl start redis-6380.service\n\n# 停止redis服务\nsystemctl stop redis-6379.service\nsystemctl stop redis-6380.service\n\n# 重启redis服务\nsystemctl restart redis-6379.service\nsystemctl restart redis-6380.service\n\n# 查看redis服务当前状态\nsystemctl status redis-6379.service\nsystemctl status redis-6380.service\n\n# 设置redis服务开机自启动\nsystemctl enable redis-6379.service\nsystemctl enable redis-6380.service\n\n# 停止redis服务开机自启动\nsystemctl disable redis.service\n```\n\n## 加入集群\n```\n/opt/redis/redis-6379/src/redis-trib.rb create --replicas 1 10.200.75.193:6379 10.200.75.193:6380 10.200.75.194:6379 10.200.75.194:6380 10.200.75.195:6379 10.200.75.195:6380\n```\n\n## redis-cluster集群关系\n```\n./redis-cli -h 10.200.75.193 -p 6379 -c cluster nodes\n\n./redis-cli -h 10.200.75.193 -p 6379 -c cluster slots | xargs -n8 | awk '{print $3\":\"$4\"->\"$6\":\"$7}' | sort -nk2 -t ':' | uniq\n\n10.200.75.193:6379->10.200.75.194:6380\n10.200.75.194:6379->10.200.75.195:6380\n10.200.75.195:6379->10.200.75.193:6380\n\n```","source":"_posts/install/centos7安装redis-cluster.md","raw":"---\ntitle: centos7安装redis集群\ndate: 2021-07-29 09:22\ncategories:\n- linux\ntags:\n- redis\n- redis-cluster\n---\n\t\n\t\n摘要: centos7 安装redis集群\n<!-- more -->\n\n\n## 主机\n|主机|端口|\n|---|---|\n|10.200.75.193|6379|\n|10.200.75.193|6380|\n|10.200.75.194|6379|\n|10.200.75.194|6380|\n|10.200.75.195|6379|\n|10.200.75.195|6380|\n\n\n\n## 目录创建\n```\nmkdir -p /opt/{redis,soft}\n```\n## 编译安装\n```\nmake\nmake install PREFIX=/usr/local/redis\n```\n\n\n## redis解压\n```\ncd /opt/soft\n\ntar xvf redis-4.0.10.tar.gz -C /opt/redis/\nmv redis-4.0.10  redis-6379\ncp -rf redis-6379 redis-6380\n```\n\n## 目录创建\n```\nmkdir redis-6379/{conf,data,logs}\nmkdir redis-6380/{conf,data,logs}\n```\n\n## 配置文件\n```\nvim  redis-6379/conf/redis.conf\n\n# 允许访问地址\nbind 0.0.0.0\n# 关闭保护模式\nprotected-mode no\n# 端口\nport 6379\n# 设置tcp的backlog\ntcp-backlog 511\n# 当客户端闲置多长时间后关闭连接，如果指定为0，表示永不关闭：\ntimeout 0\n# 设置检测客户端网络中断时间间隔，单位为秒，如果设置为0，则不检测，建议设置为60：\ntcp-keepalive 0\n# 后台运行\ndaemonize yes\nsupervised no\n# 后台运行时，redis默认会把pid写入/var/run/redis.pid文件\npidfile /var/run/redis_6379.pid\n# 指定日志记录级别，redis总共支持四个级别：debug、verbose、notice、warning\nloglevel notice\n# 日志输出路径\nlogfile \"/opt/redis/redis-6379/logs/redis.log\"\n# 设置数据库数量，默认值为16，默认当前数据库为0\ndatabases 16\n# 指定在多长时间内，有多少次更新操作，就将数据同步到数据文件，可以多个条件配合\nsave 900 1\nsave 300 10\nsave 60 10000\n# \nstop-writes-on-bgsave-error yes\n# 指定存储至本地数据库时是否压缩数据，默认为yes，redis采用LZF压缩，如果为了节省CPU时间，可以关闭该选项，但会导致数据库文件变得巨大\nrdbcompression yes\nrdbchecksum yes\n# 指定本地数据库文件名\ndbfilename dump.rdb\n# 配置数据目录  \ndir /opt/redis/redis-6379/data\nslave-serve-stale-data yes\nslave-read-only yes\nrepl-diskless-sync no\nrepl-diskless-sync-delay 5\nrepl-disable-tcp-nodelay no\nslave-priority 100\n# 默认redis使用的是rdb方式持久化，这种方式在许多应用中已经足够用了，\n# 但是redis如果中途宕机，会导致可能有几分钟的数据丢失，\n# 根据save来策略进行持久化，Append Only File是另一种持久化方式，可以提供更好的持久化特性，\n# Redis会把每次写入的数据在接收后都写入 appendonly.aof 文件，\n# 每次启动时Redis都会先把这个文件的数据读入内存里，先忽略RDB文件。\nappendonly yes\n# 指定更新日志文件名\nappendfilename \"appendonly.aof\"\n# 指定更新日志条件，共有3个可选值：\n# no：表示等操作系统进行数据缓存同步到磁盘（快）；\n# always：表示每次更新操作后手动调用fsync()将数据写到磁盘（慢，安全）；\n# everysec：表示每秒同步一次（折中，默认值）\nappendfsync everysec\nno-appendfsync-on-rewrite no\nauto-aof-rewrite-percentage 100\nauto-aof-rewrite-min-size 64mb\naof-load-truncated yes\nlua-time-limit 5000\n# 是否开启集群\ncluster-enabled yes\n# 集群配置文件的名称，每个节点都有一个集群相关的配置文件，持久化保存集群的信息，\n# 这个文件并不需要手动配置，这个配置文件有Redis生成并更新，\n# 每个Redis集群节点需要一个单独的配置文件，请确保与实例运行的系统中配置文件名称不冲突。\ncluster-config-file master-01.conf\n# 节点互连超时的阀值。集群节点超时毫秒数\ncluster-node-timeout 5000\nslowlog-log-slower-than 10000\nslowlog-max-len 128\nlatency-monitor-threshold 0\nnotify-keyspace-events \"\"\nhash-max-ziplist-entries 512\nhash-max-ziplist-value 64\nlist-max-ziplist-size -2\nlist-compress-depth 0\nset-max-intset-entries 512\nzset-max-ziplist-entries 128\nzset-max-ziplist-value 64\nhll-sparse-max-bytes 3000\nactiverehashing yes\nclient-output-buffer-limit normal 0 0 0\nclient-output-buffer-limit slave 256mb 64mb 60\nclient-output-buffer-limit pubsub 32mb 8mb 60\nhz 10\naof-rewrite-incremental-fsync yes\n\n```\n\n\n```\nvim  redis-6380/conf/redis.conf\n\n# 允许访问地址\nbind 0.0.0.0\n# 关闭保护模式\nprotected-mode no\n# 端口\nport 6380\n# 设置tcp的backlog\ntcp-backlog 511\n# 当客户端闲置多长时间后关闭连接，如果指定为0，表示永不关闭：\ntimeout 0\n# 设置检测客户端网络中断时间间隔，单位为秒，如果设置为0，则不检测，建议设置为60：\ntcp-keepalive 0\n# 后台运行\ndaemonize yes\nsupervised no\n# 后台运行时，redis默认会把pid写入/var/run/redis.pid文件\npidfile /var/run/redis_6380.pid\n# 指定日志记录级别，redis总共支持四个级别：debug、verbose、notice、warning\nloglevel notice\n# 日志输出路径\nlogfile \"/opt/redis/redis-6380/logs/redis.log\"\n# 设置数据库数量，默认值为16，默认当前数据库为0\ndatabases 16\n# 指定在多长时间内，有多少次更新操作，就将数据同步到数据文件，可以多个条件配合\nsave 900 1\nsave 300 10\nsave 60 10000\n# \nstop-writes-on-bgsave-error yes\n# 指定存储至本地数据库时是否压缩数据，默认为yes，redis采用LZF压缩，如果为了节省CPU时间，可以关闭该选项，但会导致数据库文件变得巨大\nrdbcompression yes\nrdbchecksum yes\n# 指定本地数据库文件名\ndbfilename dump.rdb\n# 配置数据目录  \ndir /opt/redis/redis-6380/data\nslave-serve-stale-data yes\nslave-read-only yes\nrepl-diskless-sync no\nrepl-diskless-sync-delay 5\nrepl-disable-tcp-nodelay no\nslave-priority 100\n# 默认redis使用的是rdb方式持久化，这种方式在许多应用中已经足够用了，\n# 但是redis如果中途宕机，会导致可能有几分钟的数据丢失，\n# 根据save来策略进行持久化，Append Only File是另一种持久化方式，可以提供更好的持久化特性，\n# Redis会把每次写入的数据在接收后都写入 appendonly.aof 文件，\n# 每次启动时Redis都会先把这个文件的数据读入内存里，先忽略RDB文件。\nappendonly yes\n# 指定更新日志文件名\nappendfilename \"appendonly.aof\"\n# 指定更新日志条件，共有3个可选值：\n# no：表示等操作系统进行数据缓存同步到磁盘（快）；\n# always：表示每次更新操作后手动调用fsync()将数据写到磁盘（慢，安全）；\n# everysec：表示每秒同步一次（折中，默认值）\nappendfsync everysec\nno-appendfsync-on-rewrite no\nauto-aof-rewrite-percentage 100\nauto-aof-rewrite-min-size 64mb\naof-load-truncated yes\nlua-time-limit 5000\n# 是否开启集群\ncluster-enabled yes\n# 集群配置文件的名称，每个节点都有一个集群相关的配置文件，持久化保存集群的信息，\n# 这个文件并不需要手动配置，这个配置文件有Redis生成并更新，\n# 每个Redis集群节点需要一个单独的配置文件，请确保与实例运行的系统中配置文件名称不冲突。\ncluster-config-file slave-01.conf   ##  修改此处\n# 节点互连超时的阀值。集群节点超时毫秒数\ncluster-node-timeout 5000\nslowlog-log-slower-than 10000\nslowlog-max-len 128\nlatency-monitor-threshold 0\nnotify-keyspace-events \"\"\nhash-max-ziplist-entries 512\nhash-max-ziplist-value 64\nlist-max-ziplist-size -2\nlist-compress-depth 0\nset-max-intset-entries 512\nzset-max-ziplist-entries 128\nzset-max-ziplist-value 64\nhll-sparse-max-bytes 3000\nactiverehashing yes\nclient-output-buffer-limit normal 0 0 0\nclient-output-buffer-limit slave 256mb 64mb 60\nclient-output-buffer-limit pubsub 32mb 8mb 60\nhz 10\naof-rewrite-incremental-fsync yes\n\n```\n\n\n## systemctl管理\n```\nvim /lib/systemd/system/redis-6379.service\n\n[Unit]\nDescription=redis.server\nAfter=network.target\n\n[Service]\nType=forking\nPIDFILE=/var/run/redis_6379.pid\nExecStart=/opt/redis/redis-6379/bin/redis-server /opt/redis/redis-6379/conf/redis.conf\nExecRepload=/bin/kill -s HUP $MAINPID\nExecStop=/bin/kill -s QUIT $MAINPID\nPrivateTmp=true\n[Install]\nWantedBy=multi-user.target\n```\n\n```\nvim /lib/systemd/system/redis-6380.service\n\n\n[Unit]\nDescription=redis.server\nAfter=network.target\n\n[Service]\nType=forking\nPIDFILE=/var/run/redis_6380.pid\nExecStart=/opt/redis/redis-6380/bin/redis-server /opt/redis/redis-6380/conf/redis.conf\nExecRepload=/bin/kill -s HUP $MAINPID\nExecStop=/bin/kill -s QUIT $MAINPID\nPrivateTmp=true\n[Install]\nWantedBy=multi-user.target\n\n```\n\n## systemctl管理\n```\nsystemctl daemon-reload\n\n# 启动redis服务\nsystemctl start redis-6379.service\nsystemctl start redis-6380.service\n\n# 停止redis服务\nsystemctl stop redis-6379.service\nsystemctl stop redis-6380.service\n\n# 重启redis服务\nsystemctl restart redis-6379.service\nsystemctl restart redis-6380.service\n\n# 查看redis服务当前状态\nsystemctl status redis-6379.service\nsystemctl status redis-6380.service\n\n# 设置redis服务开机自启动\nsystemctl enable redis-6379.service\nsystemctl enable redis-6380.service\n\n# 停止redis服务开机自启动\nsystemctl disable redis.service\n```\n\n## 加入集群\n```\n/opt/redis/redis-6379/src/redis-trib.rb create --replicas 1 10.200.75.193:6379 10.200.75.193:6380 10.200.75.194:6379 10.200.75.194:6380 10.200.75.195:6379 10.200.75.195:6380\n```\n\n## redis-cluster集群关系\n```\n./redis-cli -h 10.200.75.193 -p 6379 -c cluster nodes\n\n./redis-cli -h 10.200.75.193 -p 6379 -c cluster slots | xargs -n8 | awk '{print $3\":\"$4\"->\"$6\":\"$7}' | sort -nk2 -t ':' | uniq\n\n10.200.75.193:6379->10.200.75.194:6380\n10.200.75.194:6379->10.200.75.195:6380\n10.200.75.195:6379->10.200.75.193:6380\n\n```","slug":"install/centos7安装redis-cluster","published":1,"updated":"2021-07-29T06:54:59.645Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cku6979zn004700uh50ky5k8d","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><p>摘要: centos7 安装redis集群</p>\n<span id=\"more\"></span>\n\n\n<h2 id=\"主机\"><a href=\"#主机\" class=\"headerlink\" title=\"主机\"></a>主机</h2><table>\n<thead>\n<tr>\n<th>主机</th>\n<th>端口</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>10.200.75.193</td>\n<td>6379</td>\n</tr>\n<tr>\n<td>10.200.75.193</td>\n<td>6380</td>\n</tr>\n<tr>\n<td>10.200.75.194</td>\n<td>6379</td>\n</tr>\n<tr>\n<td>10.200.75.194</td>\n<td>6380</td>\n</tr>\n<tr>\n<td>10.200.75.195</td>\n<td>6379</td>\n</tr>\n<tr>\n<td>10.200.75.195</td>\n<td>6380</td>\n</tr>\n</tbody></table>\n<h2 id=\"目录创建\"><a href=\"#目录创建\" class=\"headerlink\" title=\"目录创建\"></a>目录创建</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir -p &#x2F;opt&#x2F;&#123;redis,soft&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"编译安装\"><a href=\"#编译安装\" class=\"headerlink\" title=\"编译安装\"></a>编译安装</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">make</span><br><span class=\"line\">make install PREFIX&#x3D;&#x2F;usr&#x2F;local&#x2F;redis</span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"redis解压\"><a href=\"#redis解压\" class=\"headerlink\" title=\"redis解压\"></a>redis解压</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd &#x2F;opt&#x2F;soft</span><br><span class=\"line\"></span><br><span class=\"line\">tar xvf redis-4.0.10.tar.gz -C &#x2F;opt&#x2F;redis&#x2F;</span><br><span class=\"line\">mv redis-4.0.10  redis-6379</span><br><span class=\"line\">cp -rf redis-6379 redis-6380</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"目录创建-1\"><a href=\"#目录创建-1\" class=\"headerlink\" title=\"目录创建\"></a>目录创建</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir redis-6379&#x2F;&#123;conf,data,logs&#125;</span><br><span class=\"line\">mkdir redis-6380&#x2F;&#123;conf,data,logs&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"配置文件\"><a href=\"#配置文件\" class=\"headerlink\" title=\"配置文件\"></a>配置文件</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim  redis-6379&#x2F;conf&#x2F;redis.conf</span><br><span class=\"line\"></span><br><span class=\"line\"># 允许访问地址</span><br><span class=\"line\">bind 0.0.0.0</span><br><span class=\"line\"># 关闭保护模式</span><br><span class=\"line\">protected-mode no</span><br><span class=\"line\"># 端口</span><br><span class=\"line\">port 6379</span><br><span class=\"line\"># 设置tcp的backlog</span><br><span class=\"line\">tcp-backlog 511</span><br><span class=\"line\"># 当客户端闲置多长时间后关闭连接，如果指定为0，表示永不关闭：</span><br><span class=\"line\">timeout 0</span><br><span class=\"line\"># 设置检测客户端网络中断时间间隔，单位为秒，如果设置为0，则不检测，建议设置为60：</span><br><span class=\"line\">tcp-keepalive 0</span><br><span class=\"line\"># 后台运行</span><br><span class=\"line\">daemonize yes</span><br><span class=\"line\">supervised no</span><br><span class=\"line\"># 后台运行时，redis默认会把pid写入&#x2F;var&#x2F;run&#x2F;redis.pid文件</span><br><span class=\"line\">pidfile &#x2F;var&#x2F;run&#x2F;redis_6379.pid</span><br><span class=\"line\"># 指定日志记录级别，redis总共支持四个级别：debug、verbose、notice、warning</span><br><span class=\"line\">loglevel notice</span><br><span class=\"line\"># 日志输出路径</span><br><span class=\"line\">logfile &quot;&#x2F;opt&#x2F;redis&#x2F;redis-6379&#x2F;logs&#x2F;redis.log&quot;</span><br><span class=\"line\"># 设置数据库数量，默认值为16，默认当前数据库为0</span><br><span class=\"line\">databases 16</span><br><span class=\"line\"># 指定在多长时间内，有多少次更新操作，就将数据同步到数据文件，可以多个条件配合</span><br><span class=\"line\">save 900 1</span><br><span class=\"line\">save 300 10</span><br><span class=\"line\">save 60 10000</span><br><span class=\"line\"># </span><br><span class=\"line\">stop-writes-on-bgsave-error yes</span><br><span class=\"line\"># 指定存储至本地数据库时是否压缩数据，默认为yes，redis采用LZF压缩，如果为了节省CPU时间，可以关闭该选项，但会导致数据库文件变得巨大</span><br><span class=\"line\">rdbcompression yes</span><br><span class=\"line\">rdbchecksum yes</span><br><span class=\"line\"># 指定本地数据库文件名</span><br><span class=\"line\">dbfilename dump.rdb</span><br><span class=\"line\"># 配置数据目录  </span><br><span class=\"line\">dir &#x2F;opt&#x2F;redis&#x2F;redis-6379&#x2F;data</span><br><span class=\"line\">slave-serve-stale-data yes</span><br><span class=\"line\">slave-read-only yes</span><br><span class=\"line\">repl-diskless-sync no</span><br><span class=\"line\">repl-diskless-sync-delay 5</span><br><span class=\"line\">repl-disable-tcp-nodelay no</span><br><span class=\"line\">slave-priority 100</span><br><span class=\"line\"># 默认redis使用的是rdb方式持久化，这种方式在许多应用中已经足够用了，</span><br><span class=\"line\"># 但是redis如果中途宕机，会导致可能有几分钟的数据丢失，</span><br><span class=\"line\"># 根据save来策略进行持久化，Append Only File是另一种持久化方式，可以提供更好的持久化特性，</span><br><span class=\"line\"># Redis会把每次写入的数据在接收后都写入 appendonly.aof 文件，</span><br><span class=\"line\"># 每次启动时Redis都会先把这个文件的数据读入内存里，先忽略RDB文件。</span><br><span class=\"line\">appendonly yes</span><br><span class=\"line\"># 指定更新日志文件名</span><br><span class=\"line\">appendfilename &quot;appendonly.aof&quot;</span><br><span class=\"line\"># 指定更新日志条件，共有3个可选值：</span><br><span class=\"line\"># no：表示等操作系统进行数据缓存同步到磁盘（快）；</span><br><span class=\"line\"># always：表示每次更新操作后手动调用fsync()将数据写到磁盘（慢，安全）；</span><br><span class=\"line\"># everysec：表示每秒同步一次（折中，默认值）</span><br><span class=\"line\">appendfsync everysec</span><br><span class=\"line\">no-appendfsync-on-rewrite no</span><br><span class=\"line\">auto-aof-rewrite-percentage 100</span><br><span class=\"line\">auto-aof-rewrite-min-size 64mb</span><br><span class=\"line\">aof-load-truncated yes</span><br><span class=\"line\">lua-time-limit 5000</span><br><span class=\"line\"># 是否开启集群</span><br><span class=\"line\">cluster-enabled yes</span><br><span class=\"line\"># 集群配置文件的名称，每个节点都有一个集群相关的配置文件，持久化保存集群的信息，</span><br><span class=\"line\"># 这个文件并不需要手动配置，这个配置文件有Redis生成并更新，</span><br><span class=\"line\"># 每个Redis集群节点需要一个单独的配置文件，请确保与实例运行的系统中配置文件名称不冲突。</span><br><span class=\"line\">cluster-config-file master-01.conf</span><br><span class=\"line\"># 节点互连超时的阀值。集群节点超时毫秒数</span><br><span class=\"line\">cluster-node-timeout 5000</span><br><span class=\"line\">slowlog-log-slower-than 10000</span><br><span class=\"line\">slowlog-max-len 128</span><br><span class=\"line\">latency-monitor-threshold 0</span><br><span class=\"line\">notify-keyspace-events &quot;&quot;</span><br><span class=\"line\">hash-max-ziplist-entries 512</span><br><span class=\"line\">hash-max-ziplist-value 64</span><br><span class=\"line\">list-max-ziplist-size -2</span><br><span class=\"line\">list-compress-depth 0</span><br><span class=\"line\">set-max-intset-entries 512</span><br><span class=\"line\">zset-max-ziplist-entries 128</span><br><span class=\"line\">zset-max-ziplist-value 64</span><br><span class=\"line\">hll-sparse-max-bytes 3000</span><br><span class=\"line\">activerehashing yes</span><br><span class=\"line\">client-output-buffer-limit normal 0 0 0</span><br><span class=\"line\">client-output-buffer-limit slave 256mb 64mb 60</span><br><span class=\"line\">client-output-buffer-limit pubsub 32mb 8mb 60</span><br><span class=\"line\">hz 10</span><br><span class=\"line\">aof-rewrite-incremental-fsync yes</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim  redis-6380&#x2F;conf&#x2F;redis.conf</span><br><span class=\"line\"></span><br><span class=\"line\"># 允许访问地址</span><br><span class=\"line\">bind 0.0.0.0</span><br><span class=\"line\"># 关闭保护模式</span><br><span class=\"line\">protected-mode no</span><br><span class=\"line\"># 端口</span><br><span class=\"line\">port 6380</span><br><span class=\"line\"># 设置tcp的backlog</span><br><span class=\"line\">tcp-backlog 511</span><br><span class=\"line\"># 当客户端闲置多长时间后关闭连接，如果指定为0，表示永不关闭：</span><br><span class=\"line\">timeout 0</span><br><span class=\"line\"># 设置检测客户端网络中断时间间隔，单位为秒，如果设置为0，则不检测，建议设置为60：</span><br><span class=\"line\">tcp-keepalive 0</span><br><span class=\"line\"># 后台运行</span><br><span class=\"line\">daemonize yes</span><br><span class=\"line\">supervised no</span><br><span class=\"line\"># 后台运行时，redis默认会把pid写入&#x2F;var&#x2F;run&#x2F;redis.pid文件</span><br><span class=\"line\">pidfile &#x2F;var&#x2F;run&#x2F;redis_6380.pid</span><br><span class=\"line\"># 指定日志记录级别，redis总共支持四个级别：debug、verbose、notice、warning</span><br><span class=\"line\">loglevel notice</span><br><span class=\"line\"># 日志输出路径</span><br><span class=\"line\">logfile &quot;&#x2F;opt&#x2F;redis&#x2F;redis-6380&#x2F;logs&#x2F;redis.log&quot;</span><br><span class=\"line\"># 设置数据库数量，默认值为16，默认当前数据库为0</span><br><span class=\"line\">databases 16</span><br><span class=\"line\"># 指定在多长时间内，有多少次更新操作，就将数据同步到数据文件，可以多个条件配合</span><br><span class=\"line\">save 900 1</span><br><span class=\"line\">save 300 10</span><br><span class=\"line\">save 60 10000</span><br><span class=\"line\"># </span><br><span class=\"line\">stop-writes-on-bgsave-error yes</span><br><span class=\"line\"># 指定存储至本地数据库时是否压缩数据，默认为yes，redis采用LZF压缩，如果为了节省CPU时间，可以关闭该选项，但会导致数据库文件变得巨大</span><br><span class=\"line\">rdbcompression yes</span><br><span class=\"line\">rdbchecksum yes</span><br><span class=\"line\"># 指定本地数据库文件名</span><br><span class=\"line\">dbfilename dump.rdb</span><br><span class=\"line\"># 配置数据目录  </span><br><span class=\"line\">dir &#x2F;opt&#x2F;redis&#x2F;redis-6380&#x2F;data</span><br><span class=\"line\">slave-serve-stale-data yes</span><br><span class=\"line\">slave-read-only yes</span><br><span class=\"line\">repl-diskless-sync no</span><br><span class=\"line\">repl-diskless-sync-delay 5</span><br><span class=\"line\">repl-disable-tcp-nodelay no</span><br><span class=\"line\">slave-priority 100</span><br><span class=\"line\"># 默认redis使用的是rdb方式持久化，这种方式在许多应用中已经足够用了，</span><br><span class=\"line\"># 但是redis如果中途宕机，会导致可能有几分钟的数据丢失，</span><br><span class=\"line\"># 根据save来策略进行持久化，Append Only File是另一种持久化方式，可以提供更好的持久化特性，</span><br><span class=\"line\"># Redis会把每次写入的数据在接收后都写入 appendonly.aof 文件，</span><br><span class=\"line\"># 每次启动时Redis都会先把这个文件的数据读入内存里，先忽略RDB文件。</span><br><span class=\"line\">appendonly yes</span><br><span class=\"line\"># 指定更新日志文件名</span><br><span class=\"line\">appendfilename &quot;appendonly.aof&quot;</span><br><span class=\"line\"># 指定更新日志条件，共有3个可选值：</span><br><span class=\"line\"># no：表示等操作系统进行数据缓存同步到磁盘（快）；</span><br><span class=\"line\"># always：表示每次更新操作后手动调用fsync()将数据写到磁盘（慢，安全）；</span><br><span class=\"line\"># everysec：表示每秒同步一次（折中，默认值）</span><br><span class=\"line\">appendfsync everysec</span><br><span class=\"line\">no-appendfsync-on-rewrite no</span><br><span class=\"line\">auto-aof-rewrite-percentage 100</span><br><span class=\"line\">auto-aof-rewrite-min-size 64mb</span><br><span class=\"line\">aof-load-truncated yes</span><br><span class=\"line\">lua-time-limit 5000</span><br><span class=\"line\"># 是否开启集群</span><br><span class=\"line\">cluster-enabled yes</span><br><span class=\"line\"># 集群配置文件的名称，每个节点都有一个集群相关的配置文件，持久化保存集群的信息，</span><br><span class=\"line\"># 这个文件并不需要手动配置，这个配置文件有Redis生成并更新，</span><br><span class=\"line\"># 每个Redis集群节点需要一个单独的配置文件，请确保与实例运行的系统中配置文件名称不冲突。</span><br><span class=\"line\">cluster-config-file slave-01.conf   ##  修改此处</span><br><span class=\"line\"># 节点互连超时的阀值。集群节点超时毫秒数</span><br><span class=\"line\">cluster-node-timeout 5000</span><br><span class=\"line\">slowlog-log-slower-than 10000</span><br><span class=\"line\">slowlog-max-len 128</span><br><span class=\"line\">latency-monitor-threshold 0</span><br><span class=\"line\">notify-keyspace-events &quot;&quot;</span><br><span class=\"line\">hash-max-ziplist-entries 512</span><br><span class=\"line\">hash-max-ziplist-value 64</span><br><span class=\"line\">list-max-ziplist-size -2</span><br><span class=\"line\">list-compress-depth 0</span><br><span class=\"line\">set-max-intset-entries 512</span><br><span class=\"line\">zset-max-ziplist-entries 128</span><br><span class=\"line\">zset-max-ziplist-value 64</span><br><span class=\"line\">hll-sparse-max-bytes 3000</span><br><span class=\"line\">activerehashing yes</span><br><span class=\"line\">client-output-buffer-limit normal 0 0 0</span><br><span class=\"line\">client-output-buffer-limit slave 256mb 64mb 60</span><br><span class=\"line\">client-output-buffer-limit pubsub 32mb 8mb 60</span><br><span class=\"line\">hz 10</span><br><span class=\"line\">aof-rewrite-incremental-fsync yes</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"systemctl管理\"><a href=\"#systemctl管理\" class=\"headerlink\" title=\"systemctl管理\"></a>systemctl管理</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim &#x2F;lib&#x2F;systemd&#x2F;system&#x2F;redis-6379.service</span><br><span class=\"line\"></span><br><span class=\"line\">[Unit]</span><br><span class=\"line\">Description&#x3D;redis.server</span><br><span class=\"line\">After&#x3D;network.target</span><br><span class=\"line\"></span><br><span class=\"line\">[Service]</span><br><span class=\"line\">Type&#x3D;forking</span><br><span class=\"line\">PIDFILE&#x3D;&#x2F;var&#x2F;run&#x2F;redis_6379.pid</span><br><span class=\"line\">ExecStart&#x3D;&#x2F;opt&#x2F;redis&#x2F;redis-6379&#x2F;bin&#x2F;redis-server &#x2F;opt&#x2F;redis&#x2F;redis-6379&#x2F;conf&#x2F;redis.conf</span><br><span class=\"line\">ExecRepload&#x3D;&#x2F;bin&#x2F;kill -s HUP $MAINPID</span><br><span class=\"line\">ExecStop&#x3D;&#x2F;bin&#x2F;kill -s QUIT $MAINPID</span><br><span class=\"line\">PrivateTmp&#x3D;true</span><br><span class=\"line\">[Install]</span><br><span class=\"line\">WantedBy&#x3D;multi-user.target</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim &#x2F;lib&#x2F;systemd&#x2F;system&#x2F;redis-6380.service</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">[Unit]</span><br><span class=\"line\">Description&#x3D;redis.server</span><br><span class=\"line\">After&#x3D;network.target</span><br><span class=\"line\"></span><br><span class=\"line\">[Service]</span><br><span class=\"line\">Type&#x3D;forking</span><br><span class=\"line\">PIDFILE&#x3D;&#x2F;var&#x2F;run&#x2F;redis_6380.pid</span><br><span class=\"line\">ExecStart&#x3D;&#x2F;opt&#x2F;redis&#x2F;redis-6380&#x2F;bin&#x2F;redis-server &#x2F;opt&#x2F;redis&#x2F;redis-6380&#x2F;conf&#x2F;redis.conf</span><br><span class=\"line\">ExecRepload&#x3D;&#x2F;bin&#x2F;kill -s HUP $MAINPID</span><br><span class=\"line\">ExecStop&#x3D;&#x2F;bin&#x2F;kill -s QUIT $MAINPID</span><br><span class=\"line\">PrivateTmp&#x3D;true</span><br><span class=\"line\">[Install]</span><br><span class=\"line\">WantedBy&#x3D;multi-user.target</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"systemctl管理-1\"><a href=\"#systemctl管理-1\" class=\"headerlink\" title=\"systemctl管理\"></a>systemctl管理</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl daemon-reload</span><br><span class=\"line\"></span><br><span class=\"line\"># 启动redis服务</span><br><span class=\"line\">systemctl start redis-6379.service</span><br><span class=\"line\">systemctl start redis-6380.service</span><br><span class=\"line\"></span><br><span class=\"line\"># 停止redis服务</span><br><span class=\"line\">systemctl stop redis-6379.service</span><br><span class=\"line\">systemctl stop redis-6380.service</span><br><span class=\"line\"></span><br><span class=\"line\"># 重启redis服务</span><br><span class=\"line\">systemctl restart redis-6379.service</span><br><span class=\"line\">systemctl restart redis-6380.service</span><br><span class=\"line\"></span><br><span class=\"line\"># 查看redis服务当前状态</span><br><span class=\"line\">systemctl status redis-6379.service</span><br><span class=\"line\">systemctl status redis-6380.service</span><br><span class=\"line\"></span><br><span class=\"line\"># 设置redis服务开机自启动</span><br><span class=\"line\">systemctl enable redis-6379.service</span><br><span class=\"line\">systemctl enable redis-6380.service</span><br><span class=\"line\"></span><br><span class=\"line\"># 停止redis服务开机自启动</span><br><span class=\"line\">systemctl disable redis.service</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"加入集群\"><a href=\"#加入集群\" class=\"headerlink\" title=\"加入集群\"></a>加入集群</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;opt&#x2F;redis&#x2F;redis-6379&#x2F;src&#x2F;redis-trib.rb create --replicas 1 10.200.75.193:6379 10.200.75.193:6380 10.200.75.194:6379 10.200.75.194:6380 10.200.75.195:6379 10.200.75.195:6380</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"redis-cluster集群关系\"><a href=\"#redis-cluster集群关系\" class=\"headerlink\" title=\"redis-cluster集群关系\"></a>redis-cluster集群关系</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">.&#x2F;redis-cli -h 10.200.75.193 -p 6379 -c cluster nodes</span><br><span class=\"line\"></span><br><span class=\"line\">.&#x2F;redis-cli -h 10.200.75.193 -p 6379 -c cluster slots | xargs -n8 | awk &#39;&#123;print $3&quot;:&quot;$4&quot;-&gt;&quot;$6&quot;:&quot;$7&#125;&#39; | sort -nk2 -t &#39;:&#39; | uniq</span><br><span class=\"line\"></span><br><span class=\"line\">10.200.75.193:6379-&gt;10.200.75.194:6380</span><br><span class=\"line\">10.200.75.194:6379-&gt;10.200.75.195:6380</span><br><span class=\"line\">10.200.75.195:6379-&gt;10.200.75.193:6380</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"<p>摘要: centos7 安装redis集群</p>","more":"<h2 id=\"主机\"><a href=\"#主机\" class=\"headerlink\" title=\"主机\"></a>主机</h2><table>\n<thead>\n<tr>\n<th>主机</th>\n<th>端口</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>10.200.75.193</td>\n<td>6379</td>\n</tr>\n<tr>\n<td>10.200.75.193</td>\n<td>6380</td>\n</tr>\n<tr>\n<td>10.200.75.194</td>\n<td>6379</td>\n</tr>\n<tr>\n<td>10.200.75.194</td>\n<td>6380</td>\n</tr>\n<tr>\n<td>10.200.75.195</td>\n<td>6379</td>\n</tr>\n<tr>\n<td>10.200.75.195</td>\n<td>6380</td>\n</tr>\n</tbody></table>\n<h2 id=\"目录创建\"><a href=\"#目录创建\" class=\"headerlink\" title=\"目录创建\"></a>目录创建</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir -p &#x2F;opt&#x2F;&#123;redis,soft&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"编译安装\"><a href=\"#编译安装\" class=\"headerlink\" title=\"编译安装\"></a>编译安装</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">make</span><br><span class=\"line\">make install PREFIX&#x3D;&#x2F;usr&#x2F;local&#x2F;redis</span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"redis解压\"><a href=\"#redis解压\" class=\"headerlink\" title=\"redis解压\"></a>redis解压</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd &#x2F;opt&#x2F;soft</span><br><span class=\"line\"></span><br><span class=\"line\">tar xvf redis-4.0.10.tar.gz -C &#x2F;opt&#x2F;redis&#x2F;</span><br><span class=\"line\">mv redis-4.0.10  redis-6379</span><br><span class=\"line\">cp -rf redis-6379 redis-6380</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"目录创建-1\"><a href=\"#目录创建-1\" class=\"headerlink\" title=\"目录创建\"></a>目录创建</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir redis-6379&#x2F;&#123;conf,data,logs&#125;</span><br><span class=\"line\">mkdir redis-6380&#x2F;&#123;conf,data,logs&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"配置文件\"><a href=\"#配置文件\" class=\"headerlink\" title=\"配置文件\"></a>配置文件</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim  redis-6379&#x2F;conf&#x2F;redis.conf</span><br><span class=\"line\"></span><br><span class=\"line\"># 允许访问地址</span><br><span class=\"line\">bind 0.0.0.0</span><br><span class=\"line\"># 关闭保护模式</span><br><span class=\"line\">protected-mode no</span><br><span class=\"line\"># 端口</span><br><span class=\"line\">port 6379</span><br><span class=\"line\"># 设置tcp的backlog</span><br><span class=\"line\">tcp-backlog 511</span><br><span class=\"line\"># 当客户端闲置多长时间后关闭连接，如果指定为0，表示永不关闭：</span><br><span class=\"line\">timeout 0</span><br><span class=\"line\"># 设置检测客户端网络中断时间间隔，单位为秒，如果设置为0，则不检测，建议设置为60：</span><br><span class=\"line\">tcp-keepalive 0</span><br><span class=\"line\"># 后台运行</span><br><span class=\"line\">daemonize yes</span><br><span class=\"line\">supervised no</span><br><span class=\"line\"># 后台运行时，redis默认会把pid写入&#x2F;var&#x2F;run&#x2F;redis.pid文件</span><br><span class=\"line\">pidfile &#x2F;var&#x2F;run&#x2F;redis_6379.pid</span><br><span class=\"line\"># 指定日志记录级别，redis总共支持四个级别：debug、verbose、notice、warning</span><br><span class=\"line\">loglevel notice</span><br><span class=\"line\"># 日志输出路径</span><br><span class=\"line\">logfile &quot;&#x2F;opt&#x2F;redis&#x2F;redis-6379&#x2F;logs&#x2F;redis.log&quot;</span><br><span class=\"line\"># 设置数据库数量，默认值为16，默认当前数据库为0</span><br><span class=\"line\">databases 16</span><br><span class=\"line\"># 指定在多长时间内，有多少次更新操作，就将数据同步到数据文件，可以多个条件配合</span><br><span class=\"line\">save 900 1</span><br><span class=\"line\">save 300 10</span><br><span class=\"line\">save 60 10000</span><br><span class=\"line\"># </span><br><span class=\"line\">stop-writes-on-bgsave-error yes</span><br><span class=\"line\"># 指定存储至本地数据库时是否压缩数据，默认为yes，redis采用LZF压缩，如果为了节省CPU时间，可以关闭该选项，但会导致数据库文件变得巨大</span><br><span class=\"line\">rdbcompression yes</span><br><span class=\"line\">rdbchecksum yes</span><br><span class=\"line\"># 指定本地数据库文件名</span><br><span class=\"line\">dbfilename dump.rdb</span><br><span class=\"line\"># 配置数据目录  </span><br><span class=\"line\">dir &#x2F;opt&#x2F;redis&#x2F;redis-6379&#x2F;data</span><br><span class=\"line\">slave-serve-stale-data yes</span><br><span class=\"line\">slave-read-only yes</span><br><span class=\"line\">repl-diskless-sync no</span><br><span class=\"line\">repl-diskless-sync-delay 5</span><br><span class=\"line\">repl-disable-tcp-nodelay no</span><br><span class=\"line\">slave-priority 100</span><br><span class=\"line\"># 默认redis使用的是rdb方式持久化，这种方式在许多应用中已经足够用了，</span><br><span class=\"line\"># 但是redis如果中途宕机，会导致可能有几分钟的数据丢失，</span><br><span class=\"line\"># 根据save来策略进行持久化，Append Only File是另一种持久化方式，可以提供更好的持久化特性，</span><br><span class=\"line\"># Redis会把每次写入的数据在接收后都写入 appendonly.aof 文件，</span><br><span class=\"line\"># 每次启动时Redis都会先把这个文件的数据读入内存里，先忽略RDB文件。</span><br><span class=\"line\">appendonly yes</span><br><span class=\"line\"># 指定更新日志文件名</span><br><span class=\"line\">appendfilename &quot;appendonly.aof&quot;</span><br><span class=\"line\"># 指定更新日志条件，共有3个可选值：</span><br><span class=\"line\"># no：表示等操作系统进行数据缓存同步到磁盘（快）；</span><br><span class=\"line\"># always：表示每次更新操作后手动调用fsync()将数据写到磁盘（慢，安全）；</span><br><span class=\"line\"># everysec：表示每秒同步一次（折中，默认值）</span><br><span class=\"line\">appendfsync everysec</span><br><span class=\"line\">no-appendfsync-on-rewrite no</span><br><span class=\"line\">auto-aof-rewrite-percentage 100</span><br><span class=\"line\">auto-aof-rewrite-min-size 64mb</span><br><span class=\"line\">aof-load-truncated yes</span><br><span class=\"line\">lua-time-limit 5000</span><br><span class=\"line\"># 是否开启集群</span><br><span class=\"line\">cluster-enabled yes</span><br><span class=\"line\"># 集群配置文件的名称，每个节点都有一个集群相关的配置文件，持久化保存集群的信息，</span><br><span class=\"line\"># 这个文件并不需要手动配置，这个配置文件有Redis生成并更新，</span><br><span class=\"line\"># 每个Redis集群节点需要一个单独的配置文件，请确保与实例运行的系统中配置文件名称不冲突。</span><br><span class=\"line\">cluster-config-file master-01.conf</span><br><span class=\"line\"># 节点互连超时的阀值。集群节点超时毫秒数</span><br><span class=\"line\">cluster-node-timeout 5000</span><br><span class=\"line\">slowlog-log-slower-than 10000</span><br><span class=\"line\">slowlog-max-len 128</span><br><span class=\"line\">latency-monitor-threshold 0</span><br><span class=\"line\">notify-keyspace-events &quot;&quot;</span><br><span class=\"line\">hash-max-ziplist-entries 512</span><br><span class=\"line\">hash-max-ziplist-value 64</span><br><span class=\"line\">list-max-ziplist-size -2</span><br><span class=\"line\">list-compress-depth 0</span><br><span class=\"line\">set-max-intset-entries 512</span><br><span class=\"line\">zset-max-ziplist-entries 128</span><br><span class=\"line\">zset-max-ziplist-value 64</span><br><span class=\"line\">hll-sparse-max-bytes 3000</span><br><span class=\"line\">activerehashing yes</span><br><span class=\"line\">client-output-buffer-limit normal 0 0 0</span><br><span class=\"line\">client-output-buffer-limit slave 256mb 64mb 60</span><br><span class=\"line\">client-output-buffer-limit pubsub 32mb 8mb 60</span><br><span class=\"line\">hz 10</span><br><span class=\"line\">aof-rewrite-incremental-fsync yes</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim  redis-6380&#x2F;conf&#x2F;redis.conf</span><br><span class=\"line\"></span><br><span class=\"line\"># 允许访问地址</span><br><span class=\"line\">bind 0.0.0.0</span><br><span class=\"line\"># 关闭保护模式</span><br><span class=\"line\">protected-mode no</span><br><span class=\"line\"># 端口</span><br><span class=\"line\">port 6380</span><br><span class=\"line\"># 设置tcp的backlog</span><br><span class=\"line\">tcp-backlog 511</span><br><span class=\"line\"># 当客户端闲置多长时间后关闭连接，如果指定为0，表示永不关闭：</span><br><span class=\"line\">timeout 0</span><br><span class=\"line\"># 设置检测客户端网络中断时间间隔，单位为秒，如果设置为0，则不检测，建议设置为60：</span><br><span class=\"line\">tcp-keepalive 0</span><br><span class=\"line\"># 后台运行</span><br><span class=\"line\">daemonize yes</span><br><span class=\"line\">supervised no</span><br><span class=\"line\"># 后台运行时，redis默认会把pid写入&#x2F;var&#x2F;run&#x2F;redis.pid文件</span><br><span class=\"line\">pidfile &#x2F;var&#x2F;run&#x2F;redis_6380.pid</span><br><span class=\"line\"># 指定日志记录级别，redis总共支持四个级别：debug、verbose、notice、warning</span><br><span class=\"line\">loglevel notice</span><br><span class=\"line\"># 日志输出路径</span><br><span class=\"line\">logfile &quot;&#x2F;opt&#x2F;redis&#x2F;redis-6380&#x2F;logs&#x2F;redis.log&quot;</span><br><span class=\"line\"># 设置数据库数量，默认值为16，默认当前数据库为0</span><br><span class=\"line\">databases 16</span><br><span class=\"line\"># 指定在多长时间内，有多少次更新操作，就将数据同步到数据文件，可以多个条件配合</span><br><span class=\"line\">save 900 1</span><br><span class=\"line\">save 300 10</span><br><span class=\"line\">save 60 10000</span><br><span class=\"line\"># </span><br><span class=\"line\">stop-writes-on-bgsave-error yes</span><br><span class=\"line\"># 指定存储至本地数据库时是否压缩数据，默认为yes，redis采用LZF压缩，如果为了节省CPU时间，可以关闭该选项，但会导致数据库文件变得巨大</span><br><span class=\"line\">rdbcompression yes</span><br><span class=\"line\">rdbchecksum yes</span><br><span class=\"line\"># 指定本地数据库文件名</span><br><span class=\"line\">dbfilename dump.rdb</span><br><span class=\"line\"># 配置数据目录  </span><br><span class=\"line\">dir &#x2F;opt&#x2F;redis&#x2F;redis-6380&#x2F;data</span><br><span class=\"line\">slave-serve-stale-data yes</span><br><span class=\"line\">slave-read-only yes</span><br><span class=\"line\">repl-diskless-sync no</span><br><span class=\"line\">repl-diskless-sync-delay 5</span><br><span class=\"line\">repl-disable-tcp-nodelay no</span><br><span class=\"line\">slave-priority 100</span><br><span class=\"line\"># 默认redis使用的是rdb方式持久化，这种方式在许多应用中已经足够用了，</span><br><span class=\"line\"># 但是redis如果中途宕机，会导致可能有几分钟的数据丢失，</span><br><span class=\"line\"># 根据save来策略进行持久化，Append Only File是另一种持久化方式，可以提供更好的持久化特性，</span><br><span class=\"line\"># Redis会把每次写入的数据在接收后都写入 appendonly.aof 文件，</span><br><span class=\"line\"># 每次启动时Redis都会先把这个文件的数据读入内存里，先忽略RDB文件。</span><br><span class=\"line\">appendonly yes</span><br><span class=\"line\"># 指定更新日志文件名</span><br><span class=\"line\">appendfilename &quot;appendonly.aof&quot;</span><br><span class=\"line\"># 指定更新日志条件，共有3个可选值：</span><br><span class=\"line\"># no：表示等操作系统进行数据缓存同步到磁盘（快）；</span><br><span class=\"line\"># always：表示每次更新操作后手动调用fsync()将数据写到磁盘（慢，安全）；</span><br><span class=\"line\"># everysec：表示每秒同步一次（折中，默认值）</span><br><span class=\"line\">appendfsync everysec</span><br><span class=\"line\">no-appendfsync-on-rewrite no</span><br><span class=\"line\">auto-aof-rewrite-percentage 100</span><br><span class=\"line\">auto-aof-rewrite-min-size 64mb</span><br><span class=\"line\">aof-load-truncated yes</span><br><span class=\"line\">lua-time-limit 5000</span><br><span class=\"line\"># 是否开启集群</span><br><span class=\"line\">cluster-enabled yes</span><br><span class=\"line\"># 集群配置文件的名称，每个节点都有一个集群相关的配置文件，持久化保存集群的信息，</span><br><span class=\"line\"># 这个文件并不需要手动配置，这个配置文件有Redis生成并更新，</span><br><span class=\"line\"># 每个Redis集群节点需要一个单独的配置文件，请确保与实例运行的系统中配置文件名称不冲突。</span><br><span class=\"line\">cluster-config-file slave-01.conf   ##  修改此处</span><br><span class=\"line\"># 节点互连超时的阀值。集群节点超时毫秒数</span><br><span class=\"line\">cluster-node-timeout 5000</span><br><span class=\"line\">slowlog-log-slower-than 10000</span><br><span class=\"line\">slowlog-max-len 128</span><br><span class=\"line\">latency-monitor-threshold 0</span><br><span class=\"line\">notify-keyspace-events &quot;&quot;</span><br><span class=\"line\">hash-max-ziplist-entries 512</span><br><span class=\"line\">hash-max-ziplist-value 64</span><br><span class=\"line\">list-max-ziplist-size -2</span><br><span class=\"line\">list-compress-depth 0</span><br><span class=\"line\">set-max-intset-entries 512</span><br><span class=\"line\">zset-max-ziplist-entries 128</span><br><span class=\"line\">zset-max-ziplist-value 64</span><br><span class=\"line\">hll-sparse-max-bytes 3000</span><br><span class=\"line\">activerehashing yes</span><br><span class=\"line\">client-output-buffer-limit normal 0 0 0</span><br><span class=\"line\">client-output-buffer-limit slave 256mb 64mb 60</span><br><span class=\"line\">client-output-buffer-limit pubsub 32mb 8mb 60</span><br><span class=\"line\">hz 10</span><br><span class=\"line\">aof-rewrite-incremental-fsync yes</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"systemctl管理\"><a href=\"#systemctl管理\" class=\"headerlink\" title=\"systemctl管理\"></a>systemctl管理</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim &#x2F;lib&#x2F;systemd&#x2F;system&#x2F;redis-6379.service</span><br><span class=\"line\"></span><br><span class=\"line\">[Unit]</span><br><span class=\"line\">Description&#x3D;redis.server</span><br><span class=\"line\">After&#x3D;network.target</span><br><span class=\"line\"></span><br><span class=\"line\">[Service]</span><br><span class=\"line\">Type&#x3D;forking</span><br><span class=\"line\">PIDFILE&#x3D;&#x2F;var&#x2F;run&#x2F;redis_6379.pid</span><br><span class=\"line\">ExecStart&#x3D;&#x2F;opt&#x2F;redis&#x2F;redis-6379&#x2F;bin&#x2F;redis-server &#x2F;opt&#x2F;redis&#x2F;redis-6379&#x2F;conf&#x2F;redis.conf</span><br><span class=\"line\">ExecRepload&#x3D;&#x2F;bin&#x2F;kill -s HUP $MAINPID</span><br><span class=\"line\">ExecStop&#x3D;&#x2F;bin&#x2F;kill -s QUIT $MAINPID</span><br><span class=\"line\">PrivateTmp&#x3D;true</span><br><span class=\"line\">[Install]</span><br><span class=\"line\">WantedBy&#x3D;multi-user.target</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim &#x2F;lib&#x2F;systemd&#x2F;system&#x2F;redis-6380.service</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">[Unit]</span><br><span class=\"line\">Description&#x3D;redis.server</span><br><span class=\"line\">After&#x3D;network.target</span><br><span class=\"line\"></span><br><span class=\"line\">[Service]</span><br><span class=\"line\">Type&#x3D;forking</span><br><span class=\"line\">PIDFILE&#x3D;&#x2F;var&#x2F;run&#x2F;redis_6380.pid</span><br><span class=\"line\">ExecStart&#x3D;&#x2F;opt&#x2F;redis&#x2F;redis-6380&#x2F;bin&#x2F;redis-server &#x2F;opt&#x2F;redis&#x2F;redis-6380&#x2F;conf&#x2F;redis.conf</span><br><span class=\"line\">ExecRepload&#x3D;&#x2F;bin&#x2F;kill -s HUP $MAINPID</span><br><span class=\"line\">ExecStop&#x3D;&#x2F;bin&#x2F;kill -s QUIT $MAINPID</span><br><span class=\"line\">PrivateTmp&#x3D;true</span><br><span class=\"line\">[Install]</span><br><span class=\"line\">WantedBy&#x3D;multi-user.target</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"systemctl管理-1\"><a href=\"#systemctl管理-1\" class=\"headerlink\" title=\"systemctl管理\"></a>systemctl管理</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl daemon-reload</span><br><span class=\"line\"></span><br><span class=\"line\"># 启动redis服务</span><br><span class=\"line\">systemctl start redis-6379.service</span><br><span class=\"line\">systemctl start redis-6380.service</span><br><span class=\"line\"></span><br><span class=\"line\"># 停止redis服务</span><br><span class=\"line\">systemctl stop redis-6379.service</span><br><span class=\"line\">systemctl stop redis-6380.service</span><br><span class=\"line\"></span><br><span class=\"line\"># 重启redis服务</span><br><span class=\"line\">systemctl restart redis-6379.service</span><br><span class=\"line\">systemctl restart redis-6380.service</span><br><span class=\"line\"></span><br><span class=\"line\"># 查看redis服务当前状态</span><br><span class=\"line\">systemctl status redis-6379.service</span><br><span class=\"line\">systemctl status redis-6380.service</span><br><span class=\"line\"></span><br><span class=\"line\"># 设置redis服务开机自启动</span><br><span class=\"line\">systemctl enable redis-6379.service</span><br><span class=\"line\">systemctl enable redis-6380.service</span><br><span class=\"line\"></span><br><span class=\"line\"># 停止redis服务开机自启动</span><br><span class=\"line\">systemctl disable redis.service</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"加入集群\"><a href=\"#加入集群\" class=\"headerlink\" title=\"加入集群\"></a>加入集群</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;opt&#x2F;redis&#x2F;redis-6379&#x2F;src&#x2F;redis-trib.rb create --replicas 1 10.200.75.193:6379 10.200.75.193:6380 10.200.75.194:6379 10.200.75.194:6380 10.200.75.195:6379 10.200.75.195:6380</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"redis-cluster集群关系\"><a href=\"#redis-cluster集群关系\" class=\"headerlink\" title=\"redis-cluster集群关系\"></a>redis-cluster集群关系</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">.&#x2F;redis-cli -h 10.200.75.193 -p 6379 -c cluster nodes</span><br><span class=\"line\"></span><br><span class=\"line\">.&#x2F;redis-cli -h 10.200.75.193 -p 6379 -c cluster slots | xargs -n8 | awk &#39;&#123;print $3&quot;:&quot;$4&quot;-&gt;&quot;$6&quot;:&quot;$7&#125;&#39; | sort -nk2 -t &#39;:&#39; | uniq</span><br><span class=\"line\"></span><br><span class=\"line\">10.200.75.193:6379-&gt;10.200.75.194:6380</span><br><span class=\"line\">10.200.75.194:6379-&gt;10.200.75.195:6380</span><br><span class=\"line\">10.200.75.195:6379-&gt;10.200.75.193:6380</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>"},{"title":"centos7安装redis5","date":"2021-01-14T06:29:00.000Z","_content":"\n摘要: centos7 源码安装redis5\n<!-- more -->\n\n## 下载Redis\n从[Redis官网](https://redis.io/download)下载后上传CentOS目录`/usr/local`, 当然, 你也可以使用wget命令下载\n```\nwget http://download.redis.io/releases/redis-5.0.3.tar.gz\n```\n\n## 安装编译环境\n```\nyum -y install gcc-c++\n```\n\n## 安装及配置Redis\n\n### 安装Redis\n```\n# 解压\ncd /usr/local\ntar -zxvf redis-5.0.8.tar.gz\n\n# 编译Redis\ncd redis-5.0.8\nmake\n\n# 在`/usr/local/`下创建多个文件夹\nmkdir -p /usr/local/redis/{etc,data}\n\n# 安装Redis, 将Redis安装在/usr/local/redis目录下\nmake PREFIX=/usr/local/redis install\n\n# 复制redis.conf配置文件到/usr/local/redis/etc目录下\ncp redis.conf /usr/local/redis/etc\n\n# 添加环境变量, 任何目录下都可以使用redis-server、redis-cli等等\nvim /etc/profile\n# 最后面添加\nexport PATH=$PATH:/usr/local/redis/bin\n\n```\n\n### 修改配置文件\n```\n# 打开配置文件\ncd /usr/local/redis\nvim redis.conf\n\n# 修改后台启动, 默认为daemonize no, 修改为daemonize yes\ndaemonize yes\n\n# 客户端闲置多长时间后断开连接, 默认为0关闭此功能, 修改为300                                      \ntimeout 300\n\n# 设置密码, 默认被注释, 取消注释修改为自定义密码(我的是123456)\nrequirepass 123456\n\n# 监听ip, 允许访问的ip, 默认为127.0.0.1, 修改为0.0.0.0(允许所有服务器ip访问)或者注释掉\nbind 0.0.0.0\n\n# 指定监听端口, 默认为6379, 此处我保持默认\nport 6379\n\n# 修改AOF及RBD存放路径, 默认为./, 修改为/usr/local/redis/data\ndir /usr/local/redis/data\n\n# 修改log存放路径, 默认为\"\", 修改为\"/usr/local/redis/data/redis_6379.log\"\nlogfile \"/usr/local/redis/data/redis_6379.log\"\n\n```\n\n## 启动Redis\n```\n# 启动\nredis-server /usr/local/redis/etc/redis.conf\n\n# 查看Redis是否启动\nps -ef | grep redis\n\n# CentOS本地查看\nredis-cli\n# 输入配置密码即可\nauth 123456\n\n# 远程则自行使用工具查看\n```\n\n### 添加系统服务与开机自启\n\n添加文件\n```\n# 新建文件\nvim /lib/systemd/system/redis.service\n```\n\n```\n# 添加内容\n[Unit]\nDescription=redis.server\nAfter=network.target\n\n[Service]\nType=forking\nPIDFILE=/var/run/redis_6379.pid\nExecStart=/usr/local/redis/bin/redis-server /usr/local/redis/etc/redis.conf\nExecRepload=/bin/kill -s HUP $MAINPID\nExecStop=/bin/kill -s QUIT $MAINPID\nPrivateTmp=true\n\n[Install]\nWantedBy=multi-user.target\n\n```\n\n```\nsystemctl daemon-reload\n\n# 启动redis服务\nsystemctl start redis.service\n\n# 停止redis服务\nsystemctl stop redis.service\n\n# 重启redis服务\nsystemctl restart redis.service\n\n# 查看redis服务当前状态\nsystemctl status redis.service\n\n# 设置redis服务开机自启动\nsystemctl enable redis.service\n\n# 停止redis服务开机自启动\nsystemctl disable redis.service\n```\n\n","source":"_posts/install/centos7安装redis5.md","raw":"---\ntitle: centos7安装redis5\ndate: 2021-01-14 14:29\ncategories:\n- centos7\ntags:\n- redis\n---\n\n摘要: centos7 源码安装redis5\n<!-- more -->\n\n## 下载Redis\n从[Redis官网](https://redis.io/download)下载后上传CentOS目录`/usr/local`, 当然, 你也可以使用wget命令下载\n```\nwget http://download.redis.io/releases/redis-5.0.3.tar.gz\n```\n\n## 安装编译环境\n```\nyum -y install gcc-c++\n```\n\n## 安装及配置Redis\n\n### 安装Redis\n```\n# 解压\ncd /usr/local\ntar -zxvf redis-5.0.8.tar.gz\n\n# 编译Redis\ncd redis-5.0.8\nmake\n\n# 在`/usr/local/`下创建多个文件夹\nmkdir -p /usr/local/redis/{etc,data}\n\n# 安装Redis, 将Redis安装在/usr/local/redis目录下\nmake PREFIX=/usr/local/redis install\n\n# 复制redis.conf配置文件到/usr/local/redis/etc目录下\ncp redis.conf /usr/local/redis/etc\n\n# 添加环境变量, 任何目录下都可以使用redis-server、redis-cli等等\nvim /etc/profile\n# 最后面添加\nexport PATH=$PATH:/usr/local/redis/bin\n\n```\n\n### 修改配置文件\n```\n# 打开配置文件\ncd /usr/local/redis\nvim redis.conf\n\n# 修改后台启动, 默认为daemonize no, 修改为daemonize yes\ndaemonize yes\n\n# 客户端闲置多长时间后断开连接, 默认为0关闭此功能, 修改为300                                      \ntimeout 300\n\n# 设置密码, 默认被注释, 取消注释修改为自定义密码(我的是123456)\nrequirepass 123456\n\n# 监听ip, 允许访问的ip, 默认为127.0.0.1, 修改为0.0.0.0(允许所有服务器ip访问)或者注释掉\nbind 0.0.0.0\n\n# 指定监听端口, 默认为6379, 此处我保持默认\nport 6379\n\n# 修改AOF及RBD存放路径, 默认为./, 修改为/usr/local/redis/data\ndir /usr/local/redis/data\n\n# 修改log存放路径, 默认为\"\", 修改为\"/usr/local/redis/data/redis_6379.log\"\nlogfile \"/usr/local/redis/data/redis_6379.log\"\n\n```\n\n## 启动Redis\n```\n# 启动\nredis-server /usr/local/redis/etc/redis.conf\n\n# 查看Redis是否启动\nps -ef | grep redis\n\n# CentOS本地查看\nredis-cli\n# 输入配置密码即可\nauth 123456\n\n# 远程则自行使用工具查看\n```\n\n### 添加系统服务与开机自启\n\n添加文件\n```\n# 新建文件\nvim /lib/systemd/system/redis.service\n```\n\n```\n# 添加内容\n[Unit]\nDescription=redis.server\nAfter=network.target\n\n[Service]\nType=forking\nPIDFILE=/var/run/redis_6379.pid\nExecStart=/usr/local/redis/bin/redis-server /usr/local/redis/etc/redis.conf\nExecRepload=/bin/kill -s HUP $MAINPID\nExecStop=/bin/kill -s QUIT $MAINPID\nPrivateTmp=true\n\n[Install]\nWantedBy=multi-user.target\n\n```\n\n```\nsystemctl daemon-reload\n\n# 启动redis服务\nsystemctl start redis.service\n\n# 停止redis服务\nsystemctl stop redis.service\n\n# 重启redis服务\nsystemctl restart redis.service\n\n# 查看redis服务当前状态\nsystemctl status redis.service\n\n# 设置redis服务开机自启动\nsystemctl enable redis.service\n\n# 停止redis服务开机自启动\nsystemctl disable redis.service\n```\n\n","slug":"install/centos7安装redis5","published":1,"updated":"2021-07-29T02:39:24.859Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cku6979zo004b00uh5jxx6uq3","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><p>摘要: centos7 源码安装redis5</p>\n<span id=\"more\"></span>\n\n<h2 id=\"下载Redis\"><a href=\"#下载Redis\" class=\"headerlink\" title=\"下载Redis\"></a>下载Redis</h2><p>从<a href=\"https://redis.io/download\">Redis官网</a>下载后上传CentOS目录<code>/usr/local</code>, 当然, 你也可以使用wget命令下载</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget http:&#x2F;&#x2F;download.redis.io&#x2F;releases&#x2F;redis-5.0.3.tar.gz</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"安装编译环境\"><a href=\"#安装编译环境\" class=\"headerlink\" title=\"安装编译环境\"></a>安装编译环境</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum -y install gcc-c++</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"安装及配置Redis\"><a href=\"#安装及配置Redis\" class=\"headerlink\" title=\"安装及配置Redis\"></a>安装及配置Redis</h2><h3 id=\"安装Redis\"><a href=\"#安装Redis\" class=\"headerlink\" title=\"安装Redis\"></a>安装Redis</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 解压</span><br><span class=\"line\">cd &#x2F;usr&#x2F;local</span><br><span class=\"line\">tar -zxvf redis-5.0.8.tar.gz</span><br><span class=\"line\"></span><br><span class=\"line\"># 编译Redis</span><br><span class=\"line\">cd redis-5.0.8</span><br><span class=\"line\">make</span><br><span class=\"line\"></span><br><span class=\"line\"># 在&#96;&#x2F;usr&#x2F;local&#x2F;&#96;下创建多个文件夹</span><br><span class=\"line\">mkdir -p &#x2F;usr&#x2F;local&#x2F;redis&#x2F;&#123;etc,data&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"># 安装Redis, 将Redis安装在&#x2F;usr&#x2F;local&#x2F;redis目录下</span><br><span class=\"line\">make PREFIX&#x3D;&#x2F;usr&#x2F;local&#x2F;redis install</span><br><span class=\"line\"></span><br><span class=\"line\"># 复制redis.conf配置文件到&#x2F;usr&#x2F;local&#x2F;redis&#x2F;etc目录下</span><br><span class=\"line\">cp redis.conf &#x2F;usr&#x2F;local&#x2F;redis&#x2F;etc</span><br><span class=\"line\"></span><br><span class=\"line\"># 添加环境变量, 任何目录下都可以使用redis-server、redis-cli等等</span><br><span class=\"line\">vim &#x2F;etc&#x2F;profile</span><br><span class=\"line\"># 最后面添加</span><br><span class=\"line\">export PATH&#x3D;$PATH:&#x2F;usr&#x2F;local&#x2F;redis&#x2F;bin</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"修改配置文件\"><a href=\"#修改配置文件\" class=\"headerlink\" title=\"修改配置文件\"></a>修改配置文件</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 打开配置文件</span><br><span class=\"line\">cd &#x2F;usr&#x2F;local&#x2F;redis</span><br><span class=\"line\">vim redis.conf</span><br><span class=\"line\"></span><br><span class=\"line\"># 修改后台启动, 默认为daemonize no, 修改为daemonize yes</span><br><span class=\"line\">daemonize yes</span><br><span class=\"line\"></span><br><span class=\"line\"># 客户端闲置多长时间后断开连接, 默认为0关闭此功能, 修改为300                                      </span><br><span class=\"line\">timeout 300</span><br><span class=\"line\"></span><br><span class=\"line\"># 设置密码, 默认被注释, 取消注释修改为自定义密码(我的是123456)</span><br><span class=\"line\">requirepass 123456</span><br><span class=\"line\"></span><br><span class=\"line\"># 监听ip, 允许访问的ip, 默认为127.0.0.1, 修改为0.0.0.0(允许所有服务器ip访问)或者注释掉</span><br><span class=\"line\">bind 0.0.0.0</span><br><span class=\"line\"></span><br><span class=\"line\"># 指定监听端口, 默认为6379, 此处我保持默认</span><br><span class=\"line\">port 6379</span><br><span class=\"line\"></span><br><span class=\"line\"># 修改AOF及RBD存放路径, 默认为.&#x2F;, 修改为&#x2F;usr&#x2F;local&#x2F;redis&#x2F;data</span><br><span class=\"line\">dir &#x2F;usr&#x2F;local&#x2F;redis&#x2F;data</span><br><span class=\"line\"></span><br><span class=\"line\"># 修改log存放路径, 默认为&quot;&quot;, 修改为&quot;&#x2F;usr&#x2F;local&#x2F;redis&#x2F;data&#x2F;redis_6379.log&quot;</span><br><span class=\"line\">logfile &quot;&#x2F;usr&#x2F;local&#x2F;redis&#x2F;data&#x2F;redis_6379.log&quot;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"启动Redis\"><a href=\"#启动Redis\" class=\"headerlink\" title=\"启动Redis\"></a>启动Redis</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 启动</span><br><span class=\"line\">redis-server &#x2F;usr&#x2F;local&#x2F;redis&#x2F;etc&#x2F;redis.conf</span><br><span class=\"line\"></span><br><span class=\"line\"># 查看Redis是否启动</span><br><span class=\"line\">ps -ef | grep redis</span><br><span class=\"line\"></span><br><span class=\"line\"># CentOS本地查看</span><br><span class=\"line\">redis-cli</span><br><span class=\"line\"># 输入配置密码即可</span><br><span class=\"line\">auth 123456</span><br><span class=\"line\"></span><br><span class=\"line\"># 远程则自行使用工具查看</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"添加系统服务与开机自启\"><a href=\"#添加系统服务与开机自启\" class=\"headerlink\" title=\"添加系统服务与开机自启\"></a>添加系统服务与开机自启</h3><p>添加文件</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 新建文件</span><br><span class=\"line\">vim &#x2F;lib&#x2F;systemd&#x2F;system&#x2F;redis.service</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 添加内容</span><br><span class=\"line\">[Unit]</span><br><span class=\"line\">Description&#x3D;redis.server</span><br><span class=\"line\">After&#x3D;network.target</span><br><span class=\"line\"></span><br><span class=\"line\">[Service]</span><br><span class=\"line\">Type&#x3D;forking</span><br><span class=\"line\">PIDFILE&#x3D;&#x2F;var&#x2F;run&#x2F;redis_6379.pid</span><br><span class=\"line\">ExecStart&#x3D;&#x2F;usr&#x2F;local&#x2F;redis&#x2F;bin&#x2F;redis-server &#x2F;usr&#x2F;local&#x2F;redis&#x2F;etc&#x2F;redis.conf</span><br><span class=\"line\">ExecRepload&#x3D;&#x2F;bin&#x2F;kill -s HUP $MAINPID</span><br><span class=\"line\">ExecStop&#x3D;&#x2F;bin&#x2F;kill -s QUIT $MAINPID</span><br><span class=\"line\">PrivateTmp&#x3D;true</span><br><span class=\"line\"></span><br><span class=\"line\">[Install]</span><br><span class=\"line\">WantedBy&#x3D;multi-user.target</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl daemon-reload</span><br><span class=\"line\"></span><br><span class=\"line\"># 启动redis服务</span><br><span class=\"line\">systemctl start redis.service</span><br><span class=\"line\"></span><br><span class=\"line\"># 停止redis服务</span><br><span class=\"line\">systemctl stop redis.service</span><br><span class=\"line\"></span><br><span class=\"line\"># 重启redis服务</span><br><span class=\"line\">systemctl restart redis.service</span><br><span class=\"line\"></span><br><span class=\"line\"># 查看redis服务当前状态</span><br><span class=\"line\">systemctl status redis.service</span><br><span class=\"line\"></span><br><span class=\"line\"># 设置redis服务开机自启动</span><br><span class=\"line\">systemctl enable redis.service</span><br><span class=\"line\"></span><br><span class=\"line\"># 停止redis服务开机自启动</span><br><span class=\"line\">systemctl disable redis.service</span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"<p>摘要: centos7 源码安装redis5</p>","more":"<h2 id=\"下载Redis\"><a href=\"#下载Redis\" class=\"headerlink\" title=\"下载Redis\"></a>下载Redis</h2><p>从<a href=\"https://redis.io/download\">Redis官网</a>下载后上传CentOS目录<code>/usr/local</code>, 当然, 你也可以使用wget命令下载</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget http:&#x2F;&#x2F;download.redis.io&#x2F;releases&#x2F;redis-5.0.3.tar.gz</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"安装编译环境\"><a href=\"#安装编译环境\" class=\"headerlink\" title=\"安装编译环境\"></a>安装编译环境</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum -y install gcc-c++</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"安装及配置Redis\"><a href=\"#安装及配置Redis\" class=\"headerlink\" title=\"安装及配置Redis\"></a>安装及配置Redis</h2><h3 id=\"安装Redis\"><a href=\"#安装Redis\" class=\"headerlink\" title=\"安装Redis\"></a>安装Redis</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 解压</span><br><span class=\"line\">cd &#x2F;usr&#x2F;local</span><br><span class=\"line\">tar -zxvf redis-5.0.8.tar.gz</span><br><span class=\"line\"></span><br><span class=\"line\"># 编译Redis</span><br><span class=\"line\">cd redis-5.0.8</span><br><span class=\"line\">make</span><br><span class=\"line\"></span><br><span class=\"line\"># 在&#96;&#x2F;usr&#x2F;local&#x2F;&#96;下创建多个文件夹</span><br><span class=\"line\">mkdir -p &#x2F;usr&#x2F;local&#x2F;redis&#x2F;&#123;etc,data&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"># 安装Redis, 将Redis安装在&#x2F;usr&#x2F;local&#x2F;redis目录下</span><br><span class=\"line\">make PREFIX&#x3D;&#x2F;usr&#x2F;local&#x2F;redis install</span><br><span class=\"line\"></span><br><span class=\"line\"># 复制redis.conf配置文件到&#x2F;usr&#x2F;local&#x2F;redis&#x2F;etc目录下</span><br><span class=\"line\">cp redis.conf &#x2F;usr&#x2F;local&#x2F;redis&#x2F;etc</span><br><span class=\"line\"></span><br><span class=\"line\"># 添加环境变量, 任何目录下都可以使用redis-server、redis-cli等等</span><br><span class=\"line\">vim &#x2F;etc&#x2F;profile</span><br><span class=\"line\"># 最后面添加</span><br><span class=\"line\">export PATH&#x3D;$PATH:&#x2F;usr&#x2F;local&#x2F;redis&#x2F;bin</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"修改配置文件\"><a href=\"#修改配置文件\" class=\"headerlink\" title=\"修改配置文件\"></a>修改配置文件</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 打开配置文件</span><br><span class=\"line\">cd &#x2F;usr&#x2F;local&#x2F;redis</span><br><span class=\"line\">vim redis.conf</span><br><span class=\"line\"></span><br><span class=\"line\"># 修改后台启动, 默认为daemonize no, 修改为daemonize yes</span><br><span class=\"line\">daemonize yes</span><br><span class=\"line\"></span><br><span class=\"line\"># 客户端闲置多长时间后断开连接, 默认为0关闭此功能, 修改为300                                      </span><br><span class=\"line\">timeout 300</span><br><span class=\"line\"></span><br><span class=\"line\"># 设置密码, 默认被注释, 取消注释修改为自定义密码(我的是123456)</span><br><span class=\"line\">requirepass 123456</span><br><span class=\"line\"></span><br><span class=\"line\"># 监听ip, 允许访问的ip, 默认为127.0.0.1, 修改为0.0.0.0(允许所有服务器ip访问)或者注释掉</span><br><span class=\"line\">bind 0.0.0.0</span><br><span class=\"line\"></span><br><span class=\"line\"># 指定监听端口, 默认为6379, 此处我保持默认</span><br><span class=\"line\">port 6379</span><br><span class=\"line\"></span><br><span class=\"line\"># 修改AOF及RBD存放路径, 默认为.&#x2F;, 修改为&#x2F;usr&#x2F;local&#x2F;redis&#x2F;data</span><br><span class=\"line\">dir &#x2F;usr&#x2F;local&#x2F;redis&#x2F;data</span><br><span class=\"line\"></span><br><span class=\"line\"># 修改log存放路径, 默认为&quot;&quot;, 修改为&quot;&#x2F;usr&#x2F;local&#x2F;redis&#x2F;data&#x2F;redis_6379.log&quot;</span><br><span class=\"line\">logfile &quot;&#x2F;usr&#x2F;local&#x2F;redis&#x2F;data&#x2F;redis_6379.log&quot;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"启动Redis\"><a href=\"#启动Redis\" class=\"headerlink\" title=\"启动Redis\"></a>启动Redis</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 启动</span><br><span class=\"line\">redis-server &#x2F;usr&#x2F;local&#x2F;redis&#x2F;etc&#x2F;redis.conf</span><br><span class=\"line\"></span><br><span class=\"line\"># 查看Redis是否启动</span><br><span class=\"line\">ps -ef | grep redis</span><br><span class=\"line\"></span><br><span class=\"line\"># CentOS本地查看</span><br><span class=\"line\">redis-cli</span><br><span class=\"line\"># 输入配置密码即可</span><br><span class=\"line\">auth 123456</span><br><span class=\"line\"></span><br><span class=\"line\"># 远程则自行使用工具查看</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"添加系统服务与开机自启\"><a href=\"#添加系统服务与开机自启\" class=\"headerlink\" title=\"添加系统服务与开机自启\"></a>添加系统服务与开机自启</h3><p>添加文件</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 新建文件</span><br><span class=\"line\">vim &#x2F;lib&#x2F;systemd&#x2F;system&#x2F;redis.service</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 添加内容</span><br><span class=\"line\">[Unit]</span><br><span class=\"line\">Description&#x3D;redis.server</span><br><span class=\"line\">After&#x3D;network.target</span><br><span class=\"line\"></span><br><span class=\"line\">[Service]</span><br><span class=\"line\">Type&#x3D;forking</span><br><span class=\"line\">PIDFILE&#x3D;&#x2F;var&#x2F;run&#x2F;redis_6379.pid</span><br><span class=\"line\">ExecStart&#x3D;&#x2F;usr&#x2F;local&#x2F;redis&#x2F;bin&#x2F;redis-server &#x2F;usr&#x2F;local&#x2F;redis&#x2F;etc&#x2F;redis.conf</span><br><span class=\"line\">ExecRepload&#x3D;&#x2F;bin&#x2F;kill -s HUP $MAINPID</span><br><span class=\"line\">ExecStop&#x3D;&#x2F;bin&#x2F;kill -s QUIT $MAINPID</span><br><span class=\"line\">PrivateTmp&#x3D;true</span><br><span class=\"line\"></span><br><span class=\"line\">[Install]</span><br><span class=\"line\">WantedBy&#x3D;multi-user.target</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl daemon-reload</span><br><span class=\"line\"></span><br><span class=\"line\"># 启动redis服务</span><br><span class=\"line\">systemctl start redis.service</span><br><span class=\"line\"></span><br><span class=\"line\"># 停止redis服务</span><br><span class=\"line\">systemctl stop redis.service</span><br><span class=\"line\"></span><br><span class=\"line\"># 重启redis服务</span><br><span class=\"line\">systemctl restart redis.service</span><br><span class=\"line\"></span><br><span class=\"line\"># 查看redis服务当前状态</span><br><span class=\"line\">systemctl status redis.service</span><br><span class=\"line\"></span><br><span class=\"line\"># 设置redis服务开机自启动</span><br><span class=\"line\">systemctl enable redis.service</span><br><span class=\"line\"></span><br><span class=\"line\"># 停止redis服务开机自启动</span><br><span class=\"line\">systemctl disable redis.service</span><br></pre></td></tr></table></figure>"},{"title":"centos7安装redismanager","date":"2021-07-28T07:08:00.000Z","_content":"\t\n\t\n摘要: centos7安装redismanager\n<!-- more -->\n\n\n## 创建目录\n```\nmkdir -p /opt/redismanager/{mysql/{db,logs},redismanager}\n```\n\n\n## docker-compose.yml\n```\nvim /opt/redismanager/docker-compose.yml\n\n\nversion: '2'\nservices: \n  mysql:\n    restart: always\n    image: mysql:5.7.16\n    container_name: mysql-server\n    volumes:\n      - /opt/kafkaCenter/mysql/db:/var/lib/mysql\n      - /opt/kafkaCenter/mysql/logs:/var/log/mysql\n    ports:\n      - 3306:3306\n    environment:\n      - MYSQL_ROOT_PASSWORD=abc123456\n\n  redis-manager:\n    restart: always\n    image: reasonduan/redis-manager\n    container_name: redis-manager\n\t\tenvironment:\n\t\t  - DATASOURCE_DATABASE='redis_manager'\n\t\t\t- DATASOURCE_URL='jdbc:mysql://127.0.0.1:3306/redis_manager?useUnicode=true&characterEncoding=utf-8&serverTimezone=GMT%2b8'\n\t\t\t- DATASOURCE_USERNAME='root'\n\t\t\t- DATASOURCE_PASSWORD='abc123456'\n    ports:\n      - 8182:8182\n    depends_on:\n      - mysql\n\n```\n\n## 数据库创建\n```\nCREATE DATABASE `redis_manager` DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci;\n```\n\n## 重启\n```\n```","source":"_posts/install/centos7安装redismanager.md","raw":"---\ntitle: centos7安装redismanager\ndate: 2021-07-28 15:08\ncategories:\n- linux\ntags:\n- redis\n---\n\t\n\t\n摘要: centos7安装redismanager\n<!-- more -->\n\n\n## 创建目录\n```\nmkdir -p /opt/redismanager/{mysql/{db,logs},redismanager}\n```\n\n\n## docker-compose.yml\n```\nvim /opt/redismanager/docker-compose.yml\n\n\nversion: '2'\nservices: \n  mysql:\n    restart: always\n    image: mysql:5.7.16\n    container_name: mysql-server\n    volumes:\n      - /opt/kafkaCenter/mysql/db:/var/lib/mysql\n      - /opt/kafkaCenter/mysql/logs:/var/log/mysql\n    ports:\n      - 3306:3306\n    environment:\n      - MYSQL_ROOT_PASSWORD=abc123456\n\n  redis-manager:\n    restart: always\n    image: reasonduan/redis-manager\n    container_name: redis-manager\n\t\tenvironment:\n\t\t  - DATASOURCE_DATABASE='redis_manager'\n\t\t\t- DATASOURCE_URL='jdbc:mysql://127.0.0.1:3306/redis_manager?useUnicode=true&characterEncoding=utf-8&serverTimezone=GMT%2b8'\n\t\t\t- DATASOURCE_USERNAME='root'\n\t\t\t- DATASOURCE_PASSWORD='abc123456'\n    ports:\n      - 8182:8182\n    depends_on:\n      - mysql\n\n```\n\n## 数据库创建\n```\nCREATE DATABASE `redis_manager` DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci;\n```\n\n## 重启\n```\n```","slug":"install/centos7安装redismanager","published":1,"updated":"2021-07-28T07:24:21.348Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cku6979zq004f00uhgj9ob1fp","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><p>摘要: centos7安装redismanager</p>\n<span id=\"more\"></span>\n\n\n<h2 id=\"创建目录\"><a href=\"#创建目录\" class=\"headerlink\" title=\"创建目录\"></a>创建目录</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir -p &#x2F;opt&#x2F;redismanager&#x2F;&#123;mysql&#x2F;&#123;db,logs&#125;,redismanager&#125;</span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"docker-compose-yml\"><a href=\"#docker-compose-yml\" class=\"headerlink\" title=\"docker-compose.yml\"></a>docker-compose.yml</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim &#x2F;opt&#x2F;redismanager&#x2F;docker-compose.yml</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">version: &#39;2&#39;</span><br><span class=\"line\">services: </span><br><span class=\"line\">  mysql:</span><br><span class=\"line\">    restart: always</span><br><span class=\"line\">    image: mysql:5.7.16</span><br><span class=\"line\">    container_name: mysql-server</span><br><span class=\"line\">    volumes:</span><br><span class=\"line\">      - &#x2F;opt&#x2F;kafkaCenter&#x2F;mysql&#x2F;db:&#x2F;var&#x2F;lib&#x2F;mysql</span><br><span class=\"line\">      - &#x2F;opt&#x2F;kafkaCenter&#x2F;mysql&#x2F;logs:&#x2F;var&#x2F;log&#x2F;mysql</span><br><span class=\"line\">    ports:</span><br><span class=\"line\">      - 3306:3306</span><br><span class=\"line\">    environment:</span><br><span class=\"line\">      - MYSQL_ROOT_PASSWORD&#x3D;abc123456</span><br><span class=\"line\"></span><br><span class=\"line\">  redis-manager:</span><br><span class=\"line\">    restart: always</span><br><span class=\"line\">    image: reasonduan&#x2F;redis-manager</span><br><span class=\"line\">    container_name: redis-manager</span><br><span class=\"line\">\t\tenvironment:</span><br><span class=\"line\">\t\t  - DATASOURCE_DATABASE&#x3D;&#39;redis_manager&#39;</span><br><span class=\"line\">\t\t\t- DATASOURCE_URL&#x3D;&#39;jdbc:mysql:&#x2F;&#x2F;127.0.0.1:3306&#x2F;redis_manager?useUnicode&#x3D;true&amp;characterEncoding&#x3D;utf-8&amp;serverTimezone&#x3D;GMT%2b8&#39;</span><br><span class=\"line\">\t\t\t- DATASOURCE_USERNAME&#x3D;&#39;root&#39;</span><br><span class=\"line\">\t\t\t- DATASOURCE_PASSWORD&#x3D;&#39;abc123456&#39;</span><br><span class=\"line\">    ports:</span><br><span class=\"line\">      - 8182:8182</span><br><span class=\"line\">    depends_on:</span><br><span class=\"line\">      - mysql</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"数据库创建\"><a href=\"#数据库创建\" class=\"headerlink\" title=\"数据库创建\"></a>数据库创建</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">CREATE DATABASE &#96;redis_manager&#96; DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"重启\"><a href=\"#重启\" class=\"headerlink\" title=\"重启\"></a>重启</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"<p>摘要: centos7安装redismanager</p>","more":"<h2 id=\"创建目录\"><a href=\"#创建目录\" class=\"headerlink\" title=\"创建目录\"></a>创建目录</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir -p &#x2F;opt&#x2F;redismanager&#x2F;&#123;mysql&#x2F;&#123;db,logs&#125;,redismanager&#125;</span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"docker-compose-yml\"><a href=\"#docker-compose-yml\" class=\"headerlink\" title=\"docker-compose.yml\"></a>docker-compose.yml</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim &#x2F;opt&#x2F;redismanager&#x2F;docker-compose.yml</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">version: &#39;2&#39;</span><br><span class=\"line\">services: </span><br><span class=\"line\">  mysql:</span><br><span class=\"line\">    restart: always</span><br><span class=\"line\">    image: mysql:5.7.16</span><br><span class=\"line\">    container_name: mysql-server</span><br><span class=\"line\">    volumes:</span><br><span class=\"line\">      - &#x2F;opt&#x2F;kafkaCenter&#x2F;mysql&#x2F;db:&#x2F;var&#x2F;lib&#x2F;mysql</span><br><span class=\"line\">      - &#x2F;opt&#x2F;kafkaCenter&#x2F;mysql&#x2F;logs:&#x2F;var&#x2F;log&#x2F;mysql</span><br><span class=\"line\">    ports:</span><br><span class=\"line\">      - 3306:3306</span><br><span class=\"line\">    environment:</span><br><span class=\"line\">      - MYSQL_ROOT_PASSWORD&#x3D;abc123456</span><br><span class=\"line\"></span><br><span class=\"line\">  redis-manager:</span><br><span class=\"line\">    restart: always</span><br><span class=\"line\">    image: reasonduan&#x2F;redis-manager</span><br><span class=\"line\">    container_name: redis-manager</span><br><span class=\"line\">\t\tenvironment:</span><br><span class=\"line\">\t\t  - DATASOURCE_DATABASE&#x3D;&#39;redis_manager&#39;</span><br><span class=\"line\">\t\t\t- DATASOURCE_URL&#x3D;&#39;jdbc:mysql:&#x2F;&#x2F;127.0.0.1:3306&#x2F;redis_manager?useUnicode&#x3D;true&amp;characterEncoding&#x3D;utf-8&amp;serverTimezone&#x3D;GMT%2b8&#39;</span><br><span class=\"line\">\t\t\t- DATASOURCE_USERNAME&#x3D;&#39;root&#39;</span><br><span class=\"line\">\t\t\t- DATASOURCE_PASSWORD&#x3D;&#39;abc123456&#39;</span><br><span class=\"line\">    ports:</span><br><span class=\"line\">      - 8182:8182</span><br><span class=\"line\">    depends_on:</span><br><span class=\"line\">      - mysql</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"数据库创建\"><a href=\"#数据库创建\" class=\"headerlink\" title=\"数据库创建\"></a>数据库创建</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">CREATE DATABASE &#96;redis_manager&#96; DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"重启\"><a href=\"#重启\" class=\"headerlink\" title=\"重启\"></a>重启</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br></pre></td></tr></table></figure>"},{"title":"centos7安装ruby","date":"2021-07-29T05:52:00.000Z","_content":"\t\n\t\n摘要: centos7安装ruby\n<!-- more -->\n\n\n## 安装编译依赖工具\n```\nyum install gcc\nyum install gcc-c++\nyum install gdbm-devel\nyum install readline-devel\nyum install openssl-devel\n```\n\n## 编译安装ruby\n```\ncd /usr/local/ruby-2.7.0\n\n./configure --prefix=/usr/local/ruby --enable-shared\nmake && make install\n```\n\n","source":"_posts/install/centos7安装ruby.md","raw":"---\ntitle: centos7安装ruby\ndate: 2021-07-29 13:52\ncategories:\n- linux\ntags:\n- ruby\n---\n\t\n\t\n摘要: centos7安装ruby\n<!-- more -->\n\n\n## 安装编译依赖工具\n```\nyum install gcc\nyum install gcc-c++\nyum install gdbm-devel\nyum install readline-devel\nyum install openssl-devel\n```\n\n## 编译安装ruby\n```\ncd /usr/local/ruby-2.7.0\n\n./configure --prefix=/usr/local/ruby --enable-shared\nmake && make install\n```\n\n","slug":"install/centos7安装ruby","published":1,"updated":"2021-07-29T07:44:37.633Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cku6979zr004i00uhenw72b8f","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><p>摘要: centos7安装ruby</p>\n<span id=\"more\"></span>\n\n\n<h2 id=\"安装编译依赖工具\"><a href=\"#安装编译依赖工具\" class=\"headerlink\" title=\"安装编译依赖工具\"></a>安装编译依赖工具</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install gcc</span><br><span class=\"line\">yum install gcc-c++</span><br><span class=\"line\">yum install gdbm-devel</span><br><span class=\"line\">yum install readline-devel</span><br><span class=\"line\">yum install openssl-devel</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"编译安装ruby\"><a href=\"#编译安装ruby\" class=\"headerlink\" title=\"编译安装ruby\"></a>编译安装ruby</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd &#x2F;usr&#x2F;local&#x2F;ruby-2.7.0</span><br><span class=\"line\"></span><br><span class=\"line\">.&#x2F;configure --prefix&#x3D;&#x2F;usr&#x2F;local&#x2F;ruby --enable-shared</span><br><span class=\"line\">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"<p>摘要: centos7安装ruby</p>","more":"<h2 id=\"安装编译依赖工具\"><a href=\"#安装编译依赖工具\" class=\"headerlink\" title=\"安装编译依赖工具\"></a>安装编译依赖工具</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install gcc</span><br><span class=\"line\">yum install gcc-c++</span><br><span class=\"line\">yum install gdbm-devel</span><br><span class=\"line\">yum install readline-devel</span><br><span class=\"line\">yum install openssl-devel</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"编译安装ruby\"><a href=\"#编译安装ruby\" class=\"headerlink\" title=\"编译安装ruby\"></a>编译安装ruby</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd &#x2F;usr&#x2F;local&#x2F;ruby-2.7.0</span><br><span class=\"line\"></span><br><span class=\"line\">.&#x2F;configure --prefix&#x3D;&#x2F;usr&#x2F;local&#x2F;ruby --enable-shared</span><br><span class=\"line\">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>"},{"title":"centos7安装sentry","date":"2021-06-21T01:39:00.000Z","_content":"\t\n\t\n摘要: cenos7安装sentry\n<!-- more -->\n\n\nSentry 的管理后台是基于 Python Django 开发的。这个管理后台由背后的 Postgres 数据库（管理后台默认的数据库，后续会以 Postgres 代指管理后台数据库并进行分享）、ClickHouse（存数据特征的数据库）、relay、kafka、redis 等一些基础服务或由 Sentry 官方维护的总共 23 个服务支撑运行。可见的是，如果独立的部署和维护这 23 个服务将是异常复杂和困难的。幸运的是，官方提供了基于 docker 镜像的一键部署实现 [getsentry/onpremise](https://github.com/getsentry/onpremise)。\n\n这种部署方式依赖于 Docker 19.03.6+ 和 Compose 1.24.1+\n\n## 准备工作\n### 安装docker \nDocker 是可以用来构建和容器化应用的开源容器化技术。\n\n##### 安装依赖\n```\nsudo yum install -y yum-utils device-mapper-persistent-data lvm2\n```\n\n##### 添加docker下载仓库\n```\nsudo yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo\n```\n\n##### 安装docker-ce\n```\nsudo yum install docker-ce\n```\n\n##### 启动docker-ce\n```\nsudo systemctl start docker\n```\n\n##### 验证\n```\nsudo docker --version\nsudo docker run hello-world\n```\n\n\n### 安装docker-compose \nCompose 是用于配置和运行多 Docker 应用的工具，可以通过一个配置文件配置应用的所有服务，并一键创建和运行这些服务。\n\n```\ncurl -L https://get.daocloud.io/docker/compose/releases/download/1.29.2/docker-compose-`uname -s`-`uname -m` > /usr/local/bin/docker-compose\n\nchmod +x /usr/local/bin/docker-compose\n\n## github\n\nsudo curl -L \"https://github.com/docker/compose/releases/download/1.23.2/docker-compose-$(uname -s)-$(uname -m)\" -o /usr/local/bin/docker-compose\n\nsudo chmod +x /usr/local/bin/docker-compose\n\nln -s /usr/local/bin/docker-compose /usr/bin/docker-compose\n\ndocker-compose --version\n```\n\n#### docker 镜像加速\n\n方式一： 在后续部署的过程中，需要拉取大量镜像，官方源拉取较慢，可以修改 docker 镜像源，修改或生成 /etc/docker/daemon.json 文件：\n```\n{\n    \"registry-mirrors\": [\n        \"https://1nj0zren.mirror.aliyuncs.com\",\n        \"https://docker.mirrors.ustc.edu.cn\",\n        \"http://f1361db2.m.daocloud.io\",\n        \"https://registry.docker-cn.com\"\n    ]\n}\n```\n\n方式二：配置docker代理\n```\nmkdir -p /etc/systemd/system/docker.service.d\nvim /etc/systemd/system/docker.service.d/http-proxy.conf\n\n[Service]\nEnvironment=\"HTTP_PROXY=socket5://172.16.100.86:7890\"\nEnvironment=\"HTTPS_PROXY=socket5://172.16.100.86:7890\"\nEnvironment=\"NO_PROXY=localhost,127.0.0.1,docker-registry.example.com,.corp\"\n\n```\n\n然后重新加载配置，并重启 docker 服务：\n```\nsudo systemctl daemon-reload\nsudo systemctl restart docker\n```\n\n## 一键部署\n\n\n在 onpremise 的根路径下有一个 install.sh 文件，只需要执行此脚本即可完成快速部署，脚本运行的过程中，大致会经历以下步骤：\n```\n1、环境检查\n2、生成服务配置\n3、docker volume 数据卷创建（可理解为 docker 运行的应用的数据存储路径的创建）\n4、拉取和升级基础镜像\n5、构建镜像\n6、服务初始化\n7、设置管理员账号（如果跳过此步，可手动创建）\n```\n\n\n\n\n","source":"_posts/install/centos7安装sentry.md","raw":"---\ntitle: centos7安装sentry\ndate: 2021-06-21 09:39\ncategories:\n- centos\ntags:\n- sentry\n---\n\t\n\t\n摘要: cenos7安装sentry\n<!-- more -->\n\n\nSentry 的管理后台是基于 Python Django 开发的。这个管理后台由背后的 Postgres 数据库（管理后台默认的数据库，后续会以 Postgres 代指管理后台数据库并进行分享）、ClickHouse（存数据特征的数据库）、relay、kafka、redis 等一些基础服务或由 Sentry 官方维护的总共 23 个服务支撑运行。可见的是，如果独立的部署和维护这 23 个服务将是异常复杂和困难的。幸运的是，官方提供了基于 docker 镜像的一键部署实现 [getsentry/onpremise](https://github.com/getsentry/onpremise)。\n\n这种部署方式依赖于 Docker 19.03.6+ 和 Compose 1.24.1+\n\n## 准备工作\n### 安装docker \nDocker 是可以用来构建和容器化应用的开源容器化技术。\n\n##### 安装依赖\n```\nsudo yum install -y yum-utils device-mapper-persistent-data lvm2\n```\n\n##### 添加docker下载仓库\n```\nsudo yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo\n```\n\n##### 安装docker-ce\n```\nsudo yum install docker-ce\n```\n\n##### 启动docker-ce\n```\nsudo systemctl start docker\n```\n\n##### 验证\n```\nsudo docker --version\nsudo docker run hello-world\n```\n\n\n### 安装docker-compose \nCompose 是用于配置和运行多 Docker 应用的工具，可以通过一个配置文件配置应用的所有服务，并一键创建和运行这些服务。\n\n```\ncurl -L https://get.daocloud.io/docker/compose/releases/download/1.29.2/docker-compose-`uname -s`-`uname -m` > /usr/local/bin/docker-compose\n\nchmod +x /usr/local/bin/docker-compose\n\n## github\n\nsudo curl -L \"https://github.com/docker/compose/releases/download/1.23.2/docker-compose-$(uname -s)-$(uname -m)\" -o /usr/local/bin/docker-compose\n\nsudo chmod +x /usr/local/bin/docker-compose\n\nln -s /usr/local/bin/docker-compose /usr/bin/docker-compose\n\ndocker-compose --version\n```\n\n#### docker 镜像加速\n\n方式一： 在后续部署的过程中，需要拉取大量镜像，官方源拉取较慢，可以修改 docker 镜像源，修改或生成 /etc/docker/daemon.json 文件：\n```\n{\n    \"registry-mirrors\": [\n        \"https://1nj0zren.mirror.aliyuncs.com\",\n        \"https://docker.mirrors.ustc.edu.cn\",\n        \"http://f1361db2.m.daocloud.io\",\n        \"https://registry.docker-cn.com\"\n    ]\n}\n```\n\n方式二：配置docker代理\n```\nmkdir -p /etc/systemd/system/docker.service.d\nvim /etc/systemd/system/docker.service.d/http-proxy.conf\n\n[Service]\nEnvironment=\"HTTP_PROXY=socket5://172.16.100.86:7890\"\nEnvironment=\"HTTPS_PROXY=socket5://172.16.100.86:7890\"\nEnvironment=\"NO_PROXY=localhost,127.0.0.1,docker-registry.example.com,.corp\"\n\n```\n\n然后重新加载配置，并重启 docker 服务：\n```\nsudo systemctl daemon-reload\nsudo systemctl restart docker\n```\n\n## 一键部署\n\n\n在 onpremise 的根路径下有一个 install.sh 文件，只需要执行此脚本即可完成快速部署，脚本运行的过程中，大致会经历以下步骤：\n```\n1、环境检查\n2、生成服务配置\n3、docker volume 数据卷创建（可理解为 docker 运行的应用的数据存储路径的创建）\n4、拉取和升级基础镜像\n5、构建镜像\n6、服务初始化\n7、设置管理员账号（如果跳过此步，可手动创建）\n```\n\n\n\n\n","slug":"install/centos7安装sentry","published":1,"updated":"2021-06-21T08:45:32.441Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cku6979zs004l00uh4hamc5uq","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><p>摘要: cenos7安装sentry</p>\n<span id=\"more\"></span>\n\n\n<p>Sentry 的管理后台是基于 Python Django 开发的。这个管理后台由背后的 Postgres 数据库（管理后台默认的数据库，后续会以 Postgres 代指管理后台数据库并进行分享）、ClickHouse（存数据特征的数据库）、relay、kafka、redis 等一些基础服务或由 Sentry 官方维护的总共 23 个服务支撑运行。可见的是，如果独立的部署和维护这 23 个服务将是异常复杂和困难的。幸运的是，官方提供了基于 docker 镜像的一键部署实现 <a href=\"https://github.com/getsentry/onpremise\">getsentry/onpremise</a>。</p>\n<p>这种部署方式依赖于 Docker 19.03.6+ 和 Compose 1.24.1+</p>\n<h2 id=\"准备工作\"><a href=\"#准备工作\" class=\"headerlink\" title=\"准备工作\"></a>准备工作</h2><h3 id=\"安装docker\"><a href=\"#安装docker\" class=\"headerlink\" title=\"安装docker\"></a>安装docker</h3><p>Docker 是可以用来构建和容器化应用的开源容器化技术。</p>\n<h5 id=\"安装依赖\"><a href=\"#安装依赖\" class=\"headerlink\" title=\"安装依赖\"></a>安装依赖</h5><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo yum install -y yum-utils device-mapper-persistent-data lvm2</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"添加docker下载仓库\"><a href=\"#添加docker下载仓库\" class=\"headerlink\" title=\"添加docker下载仓库\"></a>添加docker下载仓库</h5><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo yum-config-manager --add-repo https:&#x2F;&#x2F;download.docker.com&#x2F;linux&#x2F;centos&#x2F;docker-ce.repo</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"安装docker-ce\"><a href=\"#安装docker-ce\" class=\"headerlink\" title=\"安装docker-ce\"></a>安装docker-ce</h5><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo yum install docker-ce</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"启动docker-ce\"><a href=\"#启动docker-ce\" class=\"headerlink\" title=\"启动docker-ce\"></a>启动docker-ce</h5><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo systemctl start docker</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"验证\"><a href=\"#验证\" class=\"headerlink\" title=\"验证\"></a>验证</h5><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo docker --version</span><br><span class=\"line\">sudo docker run hello-world</span><br></pre></td></tr></table></figure>\n\n\n<h3 id=\"安装docker-compose\"><a href=\"#安装docker-compose\" class=\"headerlink\" title=\"安装docker-compose\"></a>安装docker-compose</h3><p>Compose 是用于配置和运行多 Docker 应用的工具，可以通过一个配置文件配置应用的所有服务，并一键创建和运行这些服务。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -L https:&#x2F;&#x2F;get.daocloud.io&#x2F;docker&#x2F;compose&#x2F;releases&#x2F;download&#x2F;1.29.2&#x2F;docker-compose-&#96;uname -s&#96;-&#96;uname -m&#96; &gt; &#x2F;usr&#x2F;local&#x2F;bin&#x2F;docker-compose</span><br><span class=\"line\"></span><br><span class=\"line\">chmod +x &#x2F;usr&#x2F;local&#x2F;bin&#x2F;docker-compose</span><br><span class=\"line\"></span><br><span class=\"line\">## github</span><br><span class=\"line\"></span><br><span class=\"line\">sudo curl -L &quot;https:&#x2F;&#x2F;github.com&#x2F;docker&#x2F;compose&#x2F;releases&#x2F;download&#x2F;1.23.2&#x2F;docker-compose-$(uname -s)-$(uname -m)&quot; -o &#x2F;usr&#x2F;local&#x2F;bin&#x2F;docker-compose</span><br><span class=\"line\"></span><br><span class=\"line\">sudo chmod +x &#x2F;usr&#x2F;local&#x2F;bin&#x2F;docker-compose</span><br><span class=\"line\"></span><br><span class=\"line\">ln -s &#x2F;usr&#x2F;local&#x2F;bin&#x2F;docker-compose &#x2F;usr&#x2F;bin&#x2F;docker-compose</span><br><span class=\"line\"></span><br><span class=\"line\">docker-compose --version</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"docker-镜像加速\"><a href=\"#docker-镜像加速\" class=\"headerlink\" title=\"docker 镜像加速\"></a>docker 镜像加速</h4><p>方式一： 在后续部署的过程中，需要拉取大量镜像，官方源拉取较慢，可以修改 docker 镜像源，修改或生成 /etc/docker/daemon.json 文件：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">    &quot;registry-mirrors&quot;: [</span><br><span class=\"line\">        &quot;https:&#x2F;&#x2F;1nj0zren.mirror.aliyuncs.com&quot;,</span><br><span class=\"line\">        &quot;https:&#x2F;&#x2F;docker.mirrors.ustc.edu.cn&quot;,</span><br><span class=\"line\">        &quot;http:&#x2F;&#x2F;f1361db2.m.daocloud.io&quot;,</span><br><span class=\"line\">        &quot;https:&#x2F;&#x2F;registry.docker-cn.com&quot;</span><br><span class=\"line\">    ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>方式二：配置docker代理</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir -p &#x2F;etc&#x2F;systemd&#x2F;system&#x2F;docker.service.d</span><br><span class=\"line\">vim &#x2F;etc&#x2F;systemd&#x2F;system&#x2F;docker.service.d&#x2F;http-proxy.conf</span><br><span class=\"line\"></span><br><span class=\"line\">[Service]</span><br><span class=\"line\">Environment&#x3D;&quot;HTTP_PROXY&#x3D;socket5:&#x2F;&#x2F;172.16.100.86:7890&quot;</span><br><span class=\"line\">Environment&#x3D;&quot;HTTPS_PROXY&#x3D;socket5:&#x2F;&#x2F;172.16.100.86:7890&quot;</span><br><span class=\"line\">Environment&#x3D;&quot;NO_PROXY&#x3D;localhost,127.0.0.1,docker-registry.example.com,.corp&quot;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>然后重新加载配置，并重启 docker 服务：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo systemctl daemon-reload</span><br><span class=\"line\">sudo systemctl restart docker</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"一键部署\"><a href=\"#一键部署\" class=\"headerlink\" title=\"一键部署\"></a>一键部署</h2><p>在 onpremise 的根路径下有一个 install.sh 文件，只需要执行此脚本即可完成快速部署，脚本运行的过程中，大致会经历以下步骤：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1、环境检查</span><br><span class=\"line\">2、生成服务配置</span><br><span class=\"line\">3、docker volume 数据卷创建（可理解为 docker 运行的应用的数据存储路径的创建）</span><br><span class=\"line\">4、拉取和升级基础镜像</span><br><span class=\"line\">5、构建镜像</span><br><span class=\"line\">6、服务初始化</span><br><span class=\"line\">7、设置管理员账号（如果跳过此步，可手动创建）</span><br></pre></td></tr></table></figure>\n\n\n\n\n","site":{"data":{}},"excerpt":"<p>摘要: cenos7安装sentry</p>","more":"<p>Sentry 的管理后台是基于 Python Django 开发的。这个管理后台由背后的 Postgres 数据库（管理后台默认的数据库，后续会以 Postgres 代指管理后台数据库并进行分享）、ClickHouse（存数据特征的数据库）、relay、kafka、redis 等一些基础服务或由 Sentry 官方维护的总共 23 个服务支撑运行。可见的是，如果独立的部署和维护这 23 个服务将是异常复杂和困难的。幸运的是，官方提供了基于 docker 镜像的一键部署实现 <a href=\"https://github.com/getsentry/onpremise\">getsentry/onpremise</a>。</p>\n<p>这种部署方式依赖于 Docker 19.03.6+ 和 Compose 1.24.1+</p>\n<h2 id=\"准备工作\"><a href=\"#准备工作\" class=\"headerlink\" title=\"准备工作\"></a>准备工作</h2><h3 id=\"安装docker\"><a href=\"#安装docker\" class=\"headerlink\" title=\"安装docker\"></a>安装docker</h3><p>Docker 是可以用来构建和容器化应用的开源容器化技术。</p>\n<h5 id=\"安装依赖\"><a href=\"#安装依赖\" class=\"headerlink\" title=\"安装依赖\"></a>安装依赖</h5><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo yum install -y yum-utils device-mapper-persistent-data lvm2</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"添加docker下载仓库\"><a href=\"#添加docker下载仓库\" class=\"headerlink\" title=\"添加docker下载仓库\"></a>添加docker下载仓库</h5><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo yum-config-manager --add-repo https:&#x2F;&#x2F;download.docker.com&#x2F;linux&#x2F;centos&#x2F;docker-ce.repo</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"安装docker-ce\"><a href=\"#安装docker-ce\" class=\"headerlink\" title=\"安装docker-ce\"></a>安装docker-ce</h5><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo yum install docker-ce</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"启动docker-ce\"><a href=\"#启动docker-ce\" class=\"headerlink\" title=\"启动docker-ce\"></a>启动docker-ce</h5><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo systemctl start docker</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"验证\"><a href=\"#验证\" class=\"headerlink\" title=\"验证\"></a>验证</h5><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo docker --version</span><br><span class=\"line\">sudo docker run hello-world</span><br></pre></td></tr></table></figure>\n\n\n<h3 id=\"安装docker-compose\"><a href=\"#安装docker-compose\" class=\"headerlink\" title=\"安装docker-compose\"></a>安装docker-compose</h3><p>Compose 是用于配置和运行多 Docker 应用的工具，可以通过一个配置文件配置应用的所有服务，并一键创建和运行这些服务。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -L https:&#x2F;&#x2F;get.daocloud.io&#x2F;docker&#x2F;compose&#x2F;releases&#x2F;download&#x2F;1.29.2&#x2F;docker-compose-&#96;uname -s&#96;-&#96;uname -m&#96; &gt; &#x2F;usr&#x2F;local&#x2F;bin&#x2F;docker-compose</span><br><span class=\"line\"></span><br><span class=\"line\">chmod +x &#x2F;usr&#x2F;local&#x2F;bin&#x2F;docker-compose</span><br><span class=\"line\"></span><br><span class=\"line\">## github</span><br><span class=\"line\"></span><br><span class=\"line\">sudo curl -L &quot;https:&#x2F;&#x2F;github.com&#x2F;docker&#x2F;compose&#x2F;releases&#x2F;download&#x2F;1.23.2&#x2F;docker-compose-$(uname -s)-$(uname -m)&quot; -o &#x2F;usr&#x2F;local&#x2F;bin&#x2F;docker-compose</span><br><span class=\"line\"></span><br><span class=\"line\">sudo chmod +x &#x2F;usr&#x2F;local&#x2F;bin&#x2F;docker-compose</span><br><span class=\"line\"></span><br><span class=\"line\">ln -s &#x2F;usr&#x2F;local&#x2F;bin&#x2F;docker-compose &#x2F;usr&#x2F;bin&#x2F;docker-compose</span><br><span class=\"line\"></span><br><span class=\"line\">docker-compose --version</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"docker-镜像加速\"><a href=\"#docker-镜像加速\" class=\"headerlink\" title=\"docker 镜像加速\"></a>docker 镜像加速</h4><p>方式一： 在后续部署的过程中，需要拉取大量镜像，官方源拉取较慢，可以修改 docker 镜像源，修改或生成 /etc/docker/daemon.json 文件：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">    &quot;registry-mirrors&quot;: [</span><br><span class=\"line\">        &quot;https:&#x2F;&#x2F;1nj0zren.mirror.aliyuncs.com&quot;,</span><br><span class=\"line\">        &quot;https:&#x2F;&#x2F;docker.mirrors.ustc.edu.cn&quot;,</span><br><span class=\"line\">        &quot;http:&#x2F;&#x2F;f1361db2.m.daocloud.io&quot;,</span><br><span class=\"line\">        &quot;https:&#x2F;&#x2F;registry.docker-cn.com&quot;</span><br><span class=\"line\">    ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>方式二：配置docker代理</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir -p &#x2F;etc&#x2F;systemd&#x2F;system&#x2F;docker.service.d</span><br><span class=\"line\">vim &#x2F;etc&#x2F;systemd&#x2F;system&#x2F;docker.service.d&#x2F;http-proxy.conf</span><br><span class=\"line\"></span><br><span class=\"line\">[Service]</span><br><span class=\"line\">Environment&#x3D;&quot;HTTP_PROXY&#x3D;socket5:&#x2F;&#x2F;172.16.100.86:7890&quot;</span><br><span class=\"line\">Environment&#x3D;&quot;HTTPS_PROXY&#x3D;socket5:&#x2F;&#x2F;172.16.100.86:7890&quot;</span><br><span class=\"line\">Environment&#x3D;&quot;NO_PROXY&#x3D;localhost,127.0.0.1,docker-registry.example.com,.corp&quot;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>然后重新加载配置，并重启 docker 服务：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo systemctl daemon-reload</span><br><span class=\"line\">sudo systemctl restart docker</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"一键部署\"><a href=\"#一键部署\" class=\"headerlink\" title=\"一键部署\"></a>一键部署</h2><p>在 onpremise 的根路径下有一个 install.sh 文件，只需要执行此脚本即可完成快速部署，脚本运行的过程中，大致会经历以下步骤：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1、环境检查</span><br><span class=\"line\">2、生成服务配置</span><br><span class=\"line\">3、docker volume 数据卷创建（可理解为 docker 运行的应用的数据存储路径的创建）</span><br><span class=\"line\">4、拉取和升级基础镜像</span><br><span class=\"line\">5、构建镜像</span><br><span class=\"line\">6、服务初始化</span><br><span class=\"line\">7、设置管理员账号（如果跳过此步，可手动创建）</span><br></pre></td></tr></table></figure>"},{"title":"centos7安装zk集群","date":"2021-07-24T06:34:00.000Z","_content":"\t\n\t\n摘要: centos7 安装zookeeper集群\n<!-- more -->\n\n|服务器编号\t|服务器 IP 地址 |\tLF 通信端口 |\tLF 选举端口\t| 客户端端口|\t\n|---|---|---|---|---|\n|1\t|10.200.75.177\t|2010\t|6008|\t2180|\n|2\t|10.200.75.178\t|2010\t|6008|\t2180|\n|3\t|10.200.75.179\t|2010\t|6008|\t2180|\n\n\n目录创建\n```\nmkdir -p /opt/zookeeper/\n```\n\n```\ntar xf apache-zookeeper-3.7.0-bin.tar.gz -C /opt/zookeeper/\n```\n\nmylog、mydata\n\n目录创建\n```\nmkdir -p /opt/zookeeper/apache-zookeeper-3.7.0-bin/{mylog,mydata}\n```\n\n配置JVM, java.env 文件需要创建\nvim conf/java.env\n```\n#!/bin/sh\nexport JAVA_HOME=/opt/jdk1.8.0_161/\nexport JVMFLAGS=\"-Xms512m -Xmx4096m $JVMFLAGS\"\n```\n\n\n配置文件\n\nvim conf/zoo.cfg\n```\n# tickTime:客户端与服务器、服务器与服务器之间维持心跳的时间间隔,也就是每一个 tickTime 会发送一次心跳,单位为毫秒\ntickTime=2000\n# initLimit:集群中 Leader 和 Follow 初始化连接时最多能容忍的心跳数\n# 也就是初始化过程中,如果 Leader 和 Follow 在 (10*tickTime)ms的时间内还没有连接上,则认为连接失败\ninitLimit=10\n# syncLimit:同步通信实现, Leader 和 Follow 服务器之间发送请求和接收应答最多能容忍的心跳数\n# 也就是 Leader 和 Follow 如果发送的请求在 (5*tickTime)的时间没没有应答,那么就认为 Leader 和 Follow 之间连接失败\nsyncLimit=5\n# 自定义的 zookeeper 数据存放目录\ndataDir=/opt/zookeeper/apache-zookeeper-3.7.0-bin/mydata\n# 自定义的 zookeeper 的日志存放目录\ndataLogDir=/opt/zookeeper/apache-zookeeper-3.7.0-bin/mylog\n# 客户端连接的端口\nclientPort=2180\n# Zookeeper集群中节点个数一般为奇数个(>=3),若集群中 Master 挂掉,剩余节点个数在半数以上时,就可以推举新的主节点,继续对外提供服务\n# Zookeeper集群配置项的格式比较特殊,具体规则如下: server:N=YYYY:A:B\n# N:表示服务器编号,例如 0、1、2......\n# YYYY:表示服务器的IP地址.\n# A:为LF的通信端口,表示该服务器与集群中的 Leader 交换信息的端口\n# B:为选举端口,表示选举新 Leader 时,服务器之间相互通信的端口(当 Leader 挂掉时,其它的服务器会相互通信,选择出新的 Leader)\n# 一般来说,集群中的 A 和 B 都是一样的,只有伪集群的时候 A 和 B 才不一样\nserver.1=10.200.75.177:2010:6008\nserver.2=10.200.75.178:2010:6008\nserver.3=10.200.75.179:2010:6008\n```\n\n\n新建 myid 文件,并编辑 myid 文件,并且在里面写入对应的 server 的数字\n```\necho \"1\" > /opt/zookeeper/apache-zookeeper-3.7.0-bin/mydata/myid\necho \"2\" > /opt/zookeeper/apache-zookeeper-3.7.0-bin/mydata/myid\necho \"3\" > /opt/zookeeper/apache-zookeeper-3.7.0-bin/mydata/myid\n```\n\nzk启动文件\n```\nvim /lib/systemd/system/zookeeper.service\n\n[Unit]\nDescription=Zookeeper\nRequires=network.target\nAfter=network.target\n\n[Service]\nType=forking\nEnvironment=JAVA_HOME=/opt/jdk1.8.0_161\nWorkingDirectory=/opt/zookeeper/apache-zookeeper-3.7.0-bin\nExecStart=/opt/zookeeper/apache-zookeeper-3.7.0-bin/bin/zkServer.sh start /opt/zookeeper/apache-zookeeper-3.7.0-bin/conf/zoo.cfg\nExecStop=/opt/zookeeper/apache-zookeeper-3.7.0-bin/bin/zkServer.sh stop /opt/zookeeper/apache-zookeeper-3.7.0-bin/conf/zoo.cfg\nExecReload=/opt/zookeeper/apache-zookeeper-3.7.0-bin/bin/zkServer.sh restart /opt/zookeeper/apache-zookeeper-3.7.0-bin/conf/zoo.cfg\nRestart=always\nRestartSec=10\nTimeoutSec=360\n\n[Install]\nWantedBy=multi-user.target\n```\n\n```\nsystemctl daemon-reload\nsystemctl start zookeeper\n\nsystemctl enable zookeeper\nsystemctl is-enabled zookeeper\n```\n\n查找集群状态\n```\n/opt/zookeeper/apache-zookeeper-3.7.0-bin/bin\n\n./zkServer.sh status\n```\n\n测试链接zookeeper\n```\n/opt/zookeeper/apache-zookeeper-3.7.0-bin/bin\n\n./zkCli.sh -server 10.200.75.177:2180\n```","source":"_posts/install/centos7安装zookeeper.md","raw":"---\ntitle: centos7安装zk集群\ndate: 2021-07-24 14:34\ncategories:\n- Linux\ntags:\n- zookeeper\n---\n\t\n\t\n摘要: centos7 安装zookeeper集群\n<!-- more -->\n\n|服务器编号\t|服务器 IP 地址 |\tLF 通信端口 |\tLF 选举端口\t| 客户端端口|\t\n|---|---|---|---|---|\n|1\t|10.200.75.177\t|2010\t|6008|\t2180|\n|2\t|10.200.75.178\t|2010\t|6008|\t2180|\n|3\t|10.200.75.179\t|2010\t|6008|\t2180|\n\n\n目录创建\n```\nmkdir -p /opt/zookeeper/\n```\n\n```\ntar xf apache-zookeeper-3.7.0-bin.tar.gz -C /opt/zookeeper/\n```\n\nmylog、mydata\n\n目录创建\n```\nmkdir -p /opt/zookeeper/apache-zookeeper-3.7.0-bin/{mylog,mydata}\n```\n\n配置JVM, java.env 文件需要创建\nvim conf/java.env\n```\n#!/bin/sh\nexport JAVA_HOME=/opt/jdk1.8.0_161/\nexport JVMFLAGS=\"-Xms512m -Xmx4096m $JVMFLAGS\"\n```\n\n\n配置文件\n\nvim conf/zoo.cfg\n```\n# tickTime:客户端与服务器、服务器与服务器之间维持心跳的时间间隔,也就是每一个 tickTime 会发送一次心跳,单位为毫秒\ntickTime=2000\n# initLimit:集群中 Leader 和 Follow 初始化连接时最多能容忍的心跳数\n# 也就是初始化过程中,如果 Leader 和 Follow 在 (10*tickTime)ms的时间内还没有连接上,则认为连接失败\ninitLimit=10\n# syncLimit:同步通信实现, Leader 和 Follow 服务器之间发送请求和接收应答最多能容忍的心跳数\n# 也就是 Leader 和 Follow 如果发送的请求在 (5*tickTime)的时间没没有应答,那么就认为 Leader 和 Follow 之间连接失败\nsyncLimit=5\n# 自定义的 zookeeper 数据存放目录\ndataDir=/opt/zookeeper/apache-zookeeper-3.7.0-bin/mydata\n# 自定义的 zookeeper 的日志存放目录\ndataLogDir=/opt/zookeeper/apache-zookeeper-3.7.0-bin/mylog\n# 客户端连接的端口\nclientPort=2180\n# Zookeeper集群中节点个数一般为奇数个(>=3),若集群中 Master 挂掉,剩余节点个数在半数以上时,就可以推举新的主节点,继续对外提供服务\n# Zookeeper集群配置项的格式比较特殊,具体规则如下: server:N=YYYY:A:B\n# N:表示服务器编号,例如 0、1、2......\n# YYYY:表示服务器的IP地址.\n# A:为LF的通信端口,表示该服务器与集群中的 Leader 交换信息的端口\n# B:为选举端口,表示选举新 Leader 时,服务器之间相互通信的端口(当 Leader 挂掉时,其它的服务器会相互通信,选择出新的 Leader)\n# 一般来说,集群中的 A 和 B 都是一样的,只有伪集群的时候 A 和 B 才不一样\nserver.1=10.200.75.177:2010:6008\nserver.2=10.200.75.178:2010:6008\nserver.3=10.200.75.179:2010:6008\n```\n\n\n新建 myid 文件,并编辑 myid 文件,并且在里面写入对应的 server 的数字\n```\necho \"1\" > /opt/zookeeper/apache-zookeeper-3.7.0-bin/mydata/myid\necho \"2\" > /opt/zookeeper/apache-zookeeper-3.7.0-bin/mydata/myid\necho \"3\" > /opt/zookeeper/apache-zookeeper-3.7.0-bin/mydata/myid\n```\n\nzk启动文件\n```\nvim /lib/systemd/system/zookeeper.service\n\n[Unit]\nDescription=Zookeeper\nRequires=network.target\nAfter=network.target\n\n[Service]\nType=forking\nEnvironment=JAVA_HOME=/opt/jdk1.8.0_161\nWorkingDirectory=/opt/zookeeper/apache-zookeeper-3.7.0-bin\nExecStart=/opt/zookeeper/apache-zookeeper-3.7.0-bin/bin/zkServer.sh start /opt/zookeeper/apache-zookeeper-3.7.0-bin/conf/zoo.cfg\nExecStop=/opt/zookeeper/apache-zookeeper-3.7.0-bin/bin/zkServer.sh stop /opt/zookeeper/apache-zookeeper-3.7.0-bin/conf/zoo.cfg\nExecReload=/opt/zookeeper/apache-zookeeper-3.7.0-bin/bin/zkServer.sh restart /opt/zookeeper/apache-zookeeper-3.7.0-bin/conf/zoo.cfg\nRestart=always\nRestartSec=10\nTimeoutSec=360\n\n[Install]\nWantedBy=multi-user.target\n```\n\n```\nsystemctl daemon-reload\nsystemctl start zookeeper\n\nsystemctl enable zookeeper\nsystemctl is-enabled zookeeper\n```\n\n查找集群状态\n```\n/opt/zookeeper/apache-zookeeper-3.7.0-bin/bin\n\n./zkServer.sh status\n```\n\n测试链接zookeeper\n```\n/opt/zookeeper/apache-zookeeper-3.7.0-bin/bin\n\n./zkCli.sh -server 10.200.75.177:2180\n```","slug":"install/centos7安装zookeeper","published":1,"updated":"2021-07-24T07:52:20.110Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cku6979zt004o00uh8mkc6jni","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><p>摘要: centos7 安装zookeeper集群</p>\n<span id=\"more\"></span>\n\n<table>\n<thead>\n<tr>\n<th>服务器编号</th>\n<th>服务器 IP 地址</th>\n<th>LF 通信端口</th>\n<th>LF 选举端口</th>\n<th>客户端端口</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>1</td>\n<td>10.200.75.177</td>\n<td>2010</td>\n<td>6008</td>\n<td>2180</td>\n</tr>\n<tr>\n<td>2</td>\n<td>10.200.75.178</td>\n<td>2010</td>\n<td>6008</td>\n<td>2180</td>\n</tr>\n<tr>\n<td>3</td>\n<td>10.200.75.179</td>\n<td>2010</td>\n<td>6008</td>\n<td>2180</td>\n</tr>\n</tbody></table>\n<p>目录创建</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir -p &#x2F;opt&#x2F;zookeeper&#x2F;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tar xf apache-zookeeper-3.7.0-bin.tar.gz -C &#x2F;opt&#x2F;zookeeper&#x2F;</span><br></pre></td></tr></table></figure>\n\n<p>mylog、mydata</p>\n<p>目录创建</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir -p &#x2F;opt&#x2F;zookeeper&#x2F;apache-zookeeper-3.7.0-bin&#x2F;&#123;mylog,mydata&#125;</span><br></pre></td></tr></table></figure>\n\n<p>配置JVM, java.env 文件需要创建<br>vim conf/java.env</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#!&#x2F;bin&#x2F;sh</span><br><span class=\"line\">export JAVA_HOME&#x3D;&#x2F;opt&#x2F;jdk1.8.0_161&#x2F;</span><br><span class=\"line\">export JVMFLAGS&#x3D;&quot;-Xms512m -Xmx4096m $JVMFLAGS&quot;</span><br></pre></td></tr></table></figure>\n\n\n<p>配置文件</p>\n<p>vim conf/zoo.cfg</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># tickTime:客户端与服务器、服务器与服务器之间维持心跳的时间间隔,也就是每一个 tickTime 会发送一次心跳,单位为毫秒</span><br><span class=\"line\">tickTime&#x3D;2000</span><br><span class=\"line\"># initLimit:集群中 Leader 和 Follow 初始化连接时最多能容忍的心跳数</span><br><span class=\"line\"># 也就是初始化过程中,如果 Leader 和 Follow 在 (10*tickTime)ms的时间内还没有连接上,则认为连接失败</span><br><span class=\"line\">initLimit&#x3D;10</span><br><span class=\"line\"># syncLimit:同步通信实现, Leader 和 Follow 服务器之间发送请求和接收应答最多能容忍的心跳数</span><br><span class=\"line\"># 也就是 Leader 和 Follow 如果发送的请求在 (5*tickTime)的时间没没有应答,那么就认为 Leader 和 Follow 之间连接失败</span><br><span class=\"line\">syncLimit&#x3D;5</span><br><span class=\"line\"># 自定义的 zookeeper 数据存放目录</span><br><span class=\"line\">dataDir&#x3D;&#x2F;opt&#x2F;zookeeper&#x2F;apache-zookeeper-3.7.0-bin&#x2F;mydata</span><br><span class=\"line\"># 自定义的 zookeeper 的日志存放目录</span><br><span class=\"line\">dataLogDir&#x3D;&#x2F;opt&#x2F;zookeeper&#x2F;apache-zookeeper-3.7.0-bin&#x2F;mylog</span><br><span class=\"line\"># 客户端连接的端口</span><br><span class=\"line\">clientPort&#x3D;2180</span><br><span class=\"line\"># Zookeeper集群中节点个数一般为奇数个(&gt;&#x3D;3),若集群中 Master 挂掉,剩余节点个数在半数以上时,就可以推举新的主节点,继续对外提供服务</span><br><span class=\"line\"># Zookeeper集群配置项的格式比较特殊,具体规则如下: server:N&#x3D;YYYY:A:B</span><br><span class=\"line\"># N:表示服务器编号,例如 0、1、2......</span><br><span class=\"line\"># YYYY:表示服务器的IP地址.</span><br><span class=\"line\"># A:为LF的通信端口,表示该服务器与集群中的 Leader 交换信息的端口</span><br><span class=\"line\"># B:为选举端口,表示选举新 Leader 时,服务器之间相互通信的端口(当 Leader 挂掉时,其它的服务器会相互通信,选择出新的 Leader)</span><br><span class=\"line\"># 一般来说,集群中的 A 和 B 都是一样的,只有伪集群的时候 A 和 B 才不一样</span><br><span class=\"line\">server.1&#x3D;10.200.75.177:2010:6008</span><br><span class=\"line\">server.2&#x3D;10.200.75.178:2010:6008</span><br><span class=\"line\">server.3&#x3D;10.200.75.179:2010:6008</span><br></pre></td></tr></table></figure>\n\n\n<p>新建 myid 文件,并编辑 myid 文件,并且在里面写入对应的 server 的数字</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">echo &quot;1&quot; &gt; &#x2F;opt&#x2F;zookeeper&#x2F;apache-zookeeper-3.7.0-bin&#x2F;mydata&#x2F;myid</span><br><span class=\"line\">echo &quot;2&quot; &gt; &#x2F;opt&#x2F;zookeeper&#x2F;apache-zookeeper-3.7.0-bin&#x2F;mydata&#x2F;myid</span><br><span class=\"line\">echo &quot;3&quot; &gt; &#x2F;opt&#x2F;zookeeper&#x2F;apache-zookeeper-3.7.0-bin&#x2F;mydata&#x2F;myid</span><br></pre></td></tr></table></figure>\n\n<p>zk启动文件</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim &#x2F;lib&#x2F;systemd&#x2F;system&#x2F;zookeeper.service</span><br><span class=\"line\"></span><br><span class=\"line\">[Unit]</span><br><span class=\"line\">Description&#x3D;Zookeeper</span><br><span class=\"line\">Requires&#x3D;network.target</span><br><span class=\"line\">After&#x3D;network.target</span><br><span class=\"line\"></span><br><span class=\"line\">[Service]</span><br><span class=\"line\">Type&#x3D;forking</span><br><span class=\"line\">Environment&#x3D;JAVA_HOME&#x3D;&#x2F;opt&#x2F;jdk1.8.0_161</span><br><span class=\"line\">WorkingDirectory&#x3D;&#x2F;opt&#x2F;zookeeper&#x2F;apache-zookeeper-3.7.0-bin</span><br><span class=\"line\">ExecStart&#x3D;&#x2F;opt&#x2F;zookeeper&#x2F;apache-zookeeper-3.7.0-bin&#x2F;bin&#x2F;zkServer.sh start &#x2F;opt&#x2F;zookeeper&#x2F;apache-zookeeper-3.7.0-bin&#x2F;conf&#x2F;zoo.cfg</span><br><span class=\"line\">ExecStop&#x3D;&#x2F;opt&#x2F;zookeeper&#x2F;apache-zookeeper-3.7.0-bin&#x2F;bin&#x2F;zkServer.sh stop &#x2F;opt&#x2F;zookeeper&#x2F;apache-zookeeper-3.7.0-bin&#x2F;conf&#x2F;zoo.cfg</span><br><span class=\"line\">ExecReload&#x3D;&#x2F;opt&#x2F;zookeeper&#x2F;apache-zookeeper-3.7.0-bin&#x2F;bin&#x2F;zkServer.sh restart &#x2F;opt&#x2F;zookeeper&#x2F;apache-zookeeper-3.7.0-bin&#x2F;conf&#x2F;zoo.cfg</span><br><span class=\"line\">Restart&#x3D;always</span><br><span class=\"line\">RestartSec&#x3D;10</span><br><span class=\"line\">TimeoutSec&#x3D;360</span><br><span class=\"line\"></span><br><span class=\"line\">[Install]</span><br><span class=\"line\">WantedBy&#x3D;multi-user.target</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl daemon-reload</span><br><span class=\"line\">systemctl start zookeeper</span><br><span class=\"line\"></span><br><span class=\"line\">systemctl enable zookeeper</span><br><span class=\"line\">systemctl is-enabled zookeeper</span><br></pre></td></tr></table></figure>\n\n<p>查找集群状态</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;opt&#x2F;zookeeper&#x2F;apache-zookeeper-3.7.0-bin&#x2F;bin</span><br><span class=\"line\"></span><br><span class=\"line\">.&#x2F;zkServer.sh status</span><br></pre></td></tr></table></figure>\n\n<p>测试链接zookeeper</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;opt&#x2F;zookeeper&#x2F;apache-zookeeper-3.7.0-bin&#x2F;bin</span><br><span class=\"line\"></span><br><span class=\"line\">.&#x2F;zkCli.sh -server 10.200.75.177:2180</span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"<p>摘要: centos7 安装zookeeper集群</p>","more":"<table>\n<thead>\n<tr>\n<th>服务器编号</th>\n<th>服务器 IP 地址</th>\n<th>LF 通信端口</th>\n<th>LF 选举端口</th>\n<th>客户端端口</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>1</td>\n<td>10.200.75.177</td>\n<td>2010</td>\n<td>6008</td>\n<td>2180</td>\n</tr>\n<tr>\n<td>2</td>\n<td>10.200.75.178</td>\n<td>2010</td>\n<td>6008</td>\n<td>2180</td>\n</tr>\n<tr>\n<td>3</td>\n<td>10.200.75.179</td>\n<td>2010</td>\n<td>6008</td>\n<td>2180</td>\n</tr>\n</tbody></table>\n<p>目录创建</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir -p &#x2F;opt&#x2F;zookeeper&#x2F;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tar xf apache-zookeeper-3.7.0-bin.tar.gz -C &#x2F;opt&#x2F;zookeeper&#x2F;</span><br></pre></td></tr></table></figure>\n\n<p>mylog、mydata</p>\n<p>目录创建</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir -p &#x2F;opt&#x2F;zookeeper&#x2F;apache-zookeeper-3.7.0-bin&#x2F;&#123;mylog,mydata&#125;</span><br></pre></td></tr></table></figure>\n\n<p>配置JVM, java.env 文件需要创建<br>vim conf/java.env</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#!&#x2F;bin&#x2F;sh</span><br><span class=\"line\">export JAVA_HOME&#x3D;&#x2F;opt&#x2F;jdk1.8.0_161&#x2F;</span><br><span class=\"line\">export JVMFLAGS&#x3D;&quot;-Xms512m -Xmx4096m $JVMFLAGS&quot;</span><br></pre></td></tr></table></figure>\n\n\n<p>配置文件</p>\n<p>vim conf/zoo.cfg</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># tickTime:客户端与服务器、服务器与服务器之间维持心跳的时间间隔,也就是每一个 tickTime 会发送一次心跳,单位为毫秒</span><br><span class=\"line\">tickTime&#x3D;2000</span><br><span class=\"line\"># initLimit:集群中 Leader 和 Follow 初始化连接时最多能容忍的心跳数</span><br><span class=\"line\"># 也就是初始化过程中,如果 Leader 和 Follow 在 (10*tickTime)ms的时间内还没有连接上,则认为连接失败</span><br><span class=\"line\">initLimit&#x3D;10</span><br><span class=\"line\"># syncLimit:同步通信实现, Leader 和 Follow 服务器之间发送请求和接收应答最多能容忍的心跳数</span><br><span class=\"line\"># 也就是 Leader 和 Follow 如果发送的请求在 (5*tickTime)的时间没没有应答,那么就认为 Leader 和 Follow 之间连接失败</span><br><span class=\"line\">syncLimit&#x3D;5</span><br><span class=\"line\"># 自定义的 zookeeper 数据存放目录</span><br><span class=\"line\">dataDir&#x3D;&#x2F;opt&#x2F;zookeeper&#x2F;apache-zookeeper-3.7.0-bin&#x2F;mydata</span><br><span class=\"line\"># 自定义的 zookeeper 的日志存放目录</span><br><span class=\"line\">dataLogDir&#x3D;&#x2F;opt&#x2F;zookeeper&#x2F;apache-zookeeper-3.7.0-bin&#x2F;mylog</span><br><span class=\"line\"># 客户端连接的端口</span><br><span class=\"line\">clientPort&#x3D;2180</span><br><span class=\"line\"># Zookeeper集群中节点个数一般为奇数个(&gt;&#x3D;3),若集群中 Master 挂掉,剩余节点个数在半数以上时,就可以推举新的主节点,继续对外提供服务</span><br><span class=\"line\"># Zookeeper集群配置项的格式比较特殊,具体规则如下: server:N&#x3D;YYYY:A:B</span><br><span class=\"line\"># N:表示服务器编号,例如 0、1、2......</span><br><span class=\"line\"># YYYY:表示服务器的IP地址.</span><br><span class=\"line\"># A:为LF的通信端口,表示该服务器与集群中的 Leader 交换信息的端口</span><br><span class=\"line\"># B:为选举端口,表示选举新 Leader 时,服务器之间相互通信的端口(当 Leader 挂掉时,其它的服务器会相互通信,选择出新的 Leader)</span><br><span class=\"line\"># 一般来说,集群中的 A 和 B 都是一样的,只有伪集群的时候 A 和 B 才不一样</span><br><span class=\"line\">server.1&#x3D;10.200.75.177:2010:6008</span><br><span class=\"line\">server.2&#x3D;10.200.75.178:2010:6008</span><br><span class=\"line\">server.3&#x3D;10.200.75.179:2010:6008</span><br></pre></td></tr></table></figure>\n\n\n<p>新建 myid 文件,并编辑 myid 文件,并且在里面写入对应的 server 的数字</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">echo &quot;1&quot; &gt; &#x2F;opt&#x2F;zookeeper&#x2F;apache-zookeeper-3.7.0-bin&#x2F;mydata&#x2F;myid</span><br><span class=\"line\">echo &quot;2&quot; &gt; &#x2F;opt&#x2F;zookeeper&#x2F;apache-zookeeper-3.7.0-bin&#x2F;mydata&#x2F;myid</span><br><span class=\"line\">echo &quot;3&quot; &gt; &#x2F;opt&#x2F;zookeeper&#x2F;apache-zookeeper-3.7.0-bin&#x2F;mydata&#x2F;myid</span><br></pre></td></tr></table></figure>\n\n<p>zk启动文件</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim &#x2F;lib&#x2F;systemd&#x2F;system&#x2F;zookeeper.service</span><br><span class=\"line\"></span><br><span class=\"line\">[Unit]</span><br><span class=\"line\">Description&#x3D;Zookeeper</span><br><span class=\"line\">Requires&#x3D;network.target</span><br><span class=\"line\">After&#x3D;network.target</span><br><span class=\"line\"></span><br><span class=\"line\">[Service]</span><br><span class=\"line\">Type&#x3D;forking</span><br><span class=\"line\">Environment&#x3D;JAVA_HOME&#x3D;&#x2F;opt&#x2F;jdk1.8.0_161</span><br><span class=\"line\">WorkingDirectory&#x3D;&#x2F;opt&#x2F;zookeeper&#x2F;apache-zookeeper-3.7.0-bin</span><br><span class=\"line\">ExecStart&#x3D;&#x2F;opt&#x2F;zookeeper&#x2F;apache-zookeeper-3.7.0-bin&#x2F;bin&#x2F;zkServer.sh start &#x2F;opt&#x2F;zookeeper&#x2F;apache-zookeeper-3.7.0-bin&#x2F;conf&#x2F;zoo.cfg</span><br><span class=\"line\">ExecStop&#x3D;&#x2F;opt&#x2F;zookeeper&#x2F;apache-zookeeper-3.7.0-bin&#x2F;bin&#x2F;zkServer.sh stop &#x2F;opt&#x2F;zookeeper&#x2F;apache-zookeeper-3.7.0-bin&#x2F;conf&#x2F;zoo.cfg</span><br><span class=\"line\">ExecReload&#x3D;&#x2F;opt&#x2F;zookeeper&#x2F;apache-zookeeper-3.7.0-bin&#x2F;bin&#x2F;zkServer.sh restart &#x2F;opt&#x2F;zookeeper&#x2F;apache-zookeeper-3.7.0-bin&#x2F;conf&#x2F;zoo.cfg</span><br><span class=\"line\">Restart&#x3D;always</span><br><span class=\"line\">RestartSec&#x3D;10</span><br><span class=\"line\">TimeoutSec&#x3D;360</span><br><span class=\"line\"></span><br><span class=\"line\">[Install]</span><br><span class=\"line\">WantedBy&#x3D;multi-user.target</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl daemon-reload</span><br><span class=\"line\">systemctl start zookeeper</span><br><span class=\"line\"></span><br><span class=\"line\">systemctl enable zookeeper</span><br><span class=\"line\">systemctl is-enabled zookeeper</span><br></pre></td></tr></table></figure>\n\n<p>查找集群状态</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;opt&#x2F;zookeeper&#x2F;apache-zookeeper-3.7.0-bin&#x2F;bin</span><br><span class=\"line\"></span><br><span class=\"line\">.&#x2F;zkServer.sh status</span><br></pre></td></tr></table></figure>\n\n<p>测试链接zookeeper</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;opt&#x2F;zookeeper&#x2F;apache-zookeeper-3.7.0-bin&#x2F;bin</span><br><span class=\"line\"></span><br><span class=\"line\">.&#x2F;zkCli.sh -server 10.200.75.177:2180</span><br></pre></td></tr></table></figure>"},{"title":"centos7自动安装更新","date":"2021-05-06T01:30:00.000Z","_content":"  \n  \n摘要: centos7安装更新\n<!-- more -->\n\n## 配置yum 源\n\n备份本地源\n```\nmv /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo_bak\n```\n获取阿里源配置文件\n```\nwget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo\n```\n更新epel仓库\n```\nwget -O /etc/yum.repos.d/epel.repo http://mirrors.aliyun.com/repo/epel-7.repo\n```\n更新cache\n```\nyum makecache\n```\n\n## 更新\n```\nyum update -y   # yum -y update (会更新软件、内核、系统版本), 更新系统内核、需要重启系统才会生效\n```\n\n## 自动安装安全更新\n```\nyum install yum-cron -y\n```\n配置 yum-cron\nvim  /etc/yum/yum-cron.conf\n```\nupdate_cmd = security\nupdate_messages = yes\ndownload_updates = yes \napply_updates = yes\n```\n\n## 启动\n执行命令\"systemctl start yum-cron\" 启动yum-cron\n```\nsystemctl start yum-cron\n```\n开机自动启动\n```\nsystemctl enable yum-cron\n```\n","source":"_posts/install/centos7安装更新.md","raw":"---\ntitle: centos7自动安装更新\ndate: 2021-05-06 09:30\ncategories:\n- centos7\ntags:\n- yum\n---\n  \n  \n摘要: centos7安装更新\n<!-- more -->\n\n## 配置yum 源\n\n备份本地源\n```\nmv /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo_bak\n```\n获取阿里源配置文件\n```\nwget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo\n```\n更新epel仓库\n```\nwget -O /etc/yum.repos.d/epel.repo http://mirrors.aliyun.com/repo/epel-7.repo\n```\n更新cache\n```\nyum makecache\n```\n\n## 更新\n```\nyum update -y   # yum -y update (会更新软件、内核、系统版本), 更新系统内核、需要重启系统才会生效\n```\n\n## 自动安装安全更新\n```\nyum install yum-cron -y\n```\n配置 yum-cron\nvim  /etc/yum/yum-cron.conf\n```\nupdate_cmd = security\nupdate_messages = yes\ndownload_updates = yes \napply_updates = yes\n```\n\n## 启动\n执行命令\"systemctl start yum-cron\" 启动yum-cron\n```\nsystemctl start yum-cron\n```\n开机自动启动\n```\nsystemctl enable yum-cron\n```\n","slug":"install/centos7安装更新","published":1,"updated":"2021-07-22T07:26:47.379Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cku6979zu004r00uheqiygnzr","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><p>摘要: centos7安装更新</p>\n<span id=\"more\"></span>\n\n<h2 id=\"配置yum-源\"><a href=\"#配置yum-源\" class=\"headerlink\" title=\"配置yum 源\"></a>配置yum 源</h2><p>备份本地源</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mv &#x2F;etc&#x2F;yum.repos.d&#x2F;CentOS-Base.repo &#x2F;etc&#x2F;yum.repos.d&#x2F;CentOS-Base.repo_bak</span><br></pre></td></tr></table></figure>\n<p>获取阿里源配置文件</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget -O &#x2F;etc&#x2F;yum.repos.d&#x2F;CentOS-Base.repo http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;repo&#x2F;Centos-7.repo</span><br></pre></td></tr></table></figure>\n<p>更新epel仓库</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget -O &#x2F;etc&#x2F;yum.repos.d&#x2F;epel.repo http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;repo&#x2F;epel-7.repo</span><br></pre></td></tr></table></figure>\n<p>更新cache</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum makecache</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"更新\"><a href=\"#更新\" class=\"headerlink\" title=\"更新\"></a>更新</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum update -y   # yum -y update (会更新软件、内核、系统版本), 更新系统内核、需要重启系统才会生效</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"自动安装安全更新\"><a href=\"#自动安装安全更新\" class=\"headerlink\" title=\"自动安装安全更新\"></a>自动安装安全更新</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install yum-cron -y</span><br></pre></td></tr></table></figure>\n<p>配置 yum-cron<br>vim  /etc/yum/yum-cron.conf</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">update_cmd &#x3D; security</span><br><span class=\"line\">update_messages &#x3D; yes</span><br><span class=\"line\">download_updates &#x3D; yes </span><br><span class=\"line\">apply_updates &#x3D; yes</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"启动\"><a href=\"#启动\" class=\"headerlink\" title=\"启动\"></a>启动</h2><p>执行命令”systemctl start yum-cron” 启动yum-cron</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl start yum-cron</span><br></pre></td></tr></table></figure>\n<p>开机自动启动</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl enable yum-cron</span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"<p>摘要: centos7安装更新</p>","more":"<h2 id=\"配置yum-源\"><a href=\"#配置yum-源\" class=\"headerlink\" title=\"配置yum 源\"></a>配置yum 源</h2><p>备份本地源</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mv &#x2F;etc&#x2F;yum.repos.d&#x2F;CentOS-Base.repo &#x2F;etc&#x2F;yum.repos.d&#x2F;CentOS-Base.repo_bak</span><br></pre></td></tr></table></figure>\n<p>获取阿里源配置文件</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget -O &#x2F;etc&#x2F;yum.repos.d&#x2F;CentOS-Base.repo http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;repo&#x2F;Centos-7.repo</span><br></pre></td></tr></table></figure>\n<p>更新epel仓库</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget -O &#x2F;etc&#x2F;yum.repos.d&#x2F;epel.repo http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;repo&#x2F;epel-7.repo</span><br></pre></td></tr></table></figure>\n<p>更新cache</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum makecache</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"更新\"><a href=\"#更新\" class=\"headerlink\" title=\"更新\"></a>更新</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum update -y   # yum -y update (会更新软件、内核、系统版本), 更新系统内核、需要重启系统才会生效</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"自动安装安全更新\"><a href=\"#自动安装安全更新\" class=\"headerlink\" title=\"自动安装安全更新\"></a>自动安装安全更新</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install yum-cron -y</span><br></pre></td></tr></table></figure>\n<p>配置 yum-cron<br>vim  /etc/yum/yum-cron.conf</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">update_cmd &#x3D; security</span><br><span class=\"line\">update_messages &#x3D; yes</span><br><span class=\"line\">download_updates &#x3D; yes </span><br><span class=\"line\">apply_updates &#x3D; yes</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"启动\"><a href=\"#启动\" class=\"headerlink\" title=\"启动\"></a>启动</h2><p>执行命令”systemctl start yum-cron” 启动yum-cron</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl start yum-cron</span><br></pre></td></tr></table></figure>\n<p>开机自动启动</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl enable yum-cron</span><br></pre></td></tr></table></figure>"},{"title":"cento7虚拟机模板制作","date":"2021-05-08T02:10:00.000Z","_content":"  \n  \n摘要: 系统镜像模板的制作\n<!-- more -->\n\n\n## 安装QEMU Guest Agent\n```\n# 安装qemu agent\n dnf install -y qemu-guest-agent\n 或\n apt-get install qemu-guest-agent\n 或\n yum install qemu-guest-agent\n\n reboot\n```\n\n安装重启后，确保在[概要]中可以看到对应IP信息，如果无法看到对应IP信息，说明QEMU Guest Agent未启用，需要在[选项]中启用。(需要虚拟化平台支持)\n\n\n## 系统初始化设置\n```\n# 更新系统\ndnf update\n\n# 设置首次登录强制修改密码\nchage -d0 root\n\n# 删除网卡配置文件\nrm -rf /etc/sysconfig/network-scripts/ifcfg-ens*\n\n# 删除SSH私钥，不同系统私钥从严格意思上来说应该不同，所以删除后，重启系统会自动生成全新的私钥\nrm -rf /etc/ssh/ssh_host_*\n\n# 修改machine-id，machine-id为系统的唯一性ID，每台服务器系统应该唯一，用于解决系统ID冲突，我们需要重置机器ID。先删除现有/etc/machine-id文件，然后在/etc/profile文件最后添加systemd-machine-id-setup命令，开机后会通过systemd-machine-id-setup命令生成全新的machine-id。如果/etc/machine-id文件存在，systemd-machine-id-setup命令就不会再重新创建新的机器ID。\nrm -rf /etc/machine-id\necho \"systemd-machine-id-setup\" >> /etc/profile\n\n# 清理系统日志\nsystemctl stop systemd-journald.socket\nfind /var/log -type f -exec rm -rf {} \\;\n\n# 设置持久化保存日志的目录\nmkdir -p /var/log/journal\n\n# 清除历史命令\necho /dev/null > ~/.bash_history ; history -c\n\n# 关闭系统\nsystemctl poweroff\n```\n\n\n系统就封装完成了，这时候只需要在Proxmox VE右击对应虚拟机转换成模板即可。此方法不仅仅适用于Proxmox VE，对于Hyper-v\\ESXI\\OpenStack\\oVirt同样适用，只是Hyper-v与ESXI安装的代理软件包不同而已，如：vm-tools\\增强会话等。通过模板的构建，可以极大提高我们部署系统的速度。下篇预告：在Rocky Linux 8.3 RC1 上安装Docker CE。\n不同的虚拟化平台需要安装不同的代理软件包","source":"_posts/install/centos7模板制作.md","raw":"---\ntitle: cento7虚拟机模板制作\ndate: 2021-05-08 10:10\ncategories:\n- centos7\ntags:\n- centos7\n---\n  \n  \n摘要: 系统镜像模板的制作\n<!-- more -->\n\n\n## 安装QEMU Guest Agent\n```\n# 安装qemu agent\n dnf install -y qemu-guest-agent\n 或\n apt-get install qemu-guest-agent\n 或\n yum install qemu-guest-agent\n\n reboot\n```\n\n安装重启后，确保在[概要]中可以看到对应IP信息，如果无法看到对应IP信息，说明QEMU Guest Agent未启用，需要在[选项]中启用。(需要虚拟化平台支持)\n\n\n## 系统初始化设置\n```\n# 更新系统\ndnf update\n\n# 设置首次登录强制修改密码\nchage -d0 root\n\n# 删除网卡配置文件\nrm -rf /etc/sysconfig/network-scripts/ifcfg-ens*\n\n# 删除SSH私钥，不同系统私钥从严格意思上来说应该不同，所以删除后，重启系统会自动生成全新的私钥\nrm -rf /etc/ssh/ssh_host_*\n\n# 修改machine-id，machine-id为系统的唯一性ID，每台服务器系统应该唯一，用于解决系统ID冲突，我们需要重置机器ID。先删除现有/etc/machine-id文件，然后在/etc/profile文件最后添加systemd-machine-id-setup命令，开机后会通过systemd-machine-id-setup命令生成全新的machine-id。如果/etc/machine-id文件存在，systemd-machine-id-setup命令就不会再重新创建新的机器ID。\nrm -rf /etc/machine-id\necho \"systemd-machine-id-setup\" >> /etc/profile\n\n# 清理系统日志\nsystemctl stop systemd-journald.socket\nfind /var/log -type f -exec rm -rf {} \\;\n\n# 设置持久化保存日志的目录\nmkdir -p /var/log/journal\n\n# 清除历史命令\necho /dev/null > ~/.bash_history ; history -c\n\n# 关闭系统\nsystemctl poweroff\n```\n\n\n系统就封装完成了，这时候只需要在Proxmox VE右击对应虚拟机转换成模板即可。此方法不仅仅适用于Proxmox VE，对于Hyper-v\\ESXI\\OpenStack\\oVirt同样适用，只是Hyper-v与ESXI安装的代理软件包不同而已，如：vm-tools\\增强会话等。通过模板的构建，可以极大提高我们部署系统的速度。下篇预告：在Rocky Linux 8.3 RC1 上安装Docker CE。\n不同的虚拟化平台需要安装不同的代理软件包","slug":"install/centos7模板制作","published":1,"updated":"2021-06-18T08:07:11.193Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cku6979zv004u00uh6tmn8ql5","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><p>摘要: 系统镜像模板的制作</p>\n<span id=\"more\"></span>\n\n\n<h2 id=\"安装QEMU-Guest-Agent\"><a href=\"#安装QEMU-Guest-Agent\" class=\"headerlink\" title=\"安装QEMU Guest Agent\"></a>安装QEMU Guest Agent</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 安装qemu agent</span><br><span class=\"line\"> dnf install -y qemu-guest-agent</span><br><span class=\"line\"> 或</span><br><span class=\"line\"> apt-get install qemu-guest-agent</span><br><span class=\"line\"> 或</span><br><span class=\"line\"> yum install qemu-guest-agent</span><br><span class=\"line\"></span><br><span class=\"line\"> reboot</span><br></pre></td></tr></table></figure>\n\n<p>安装重启后，确保在[概要]中可以看到对应IP信息，如果无法看到对应IP信息，说明QEMU Guest Agent未启用，需要在[选项]中启用。(需要虚拟化平台支持)</p>\n<h2 id=\"系统初始化设置\"><a href=\"#系统初始化设置\" class=\"headerlink\" title=\"系统初始化设置\"></a>系统初始化设置</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 更新系统</span><br><span class=\"line\">dnf update</span><br><span class=\"line\"></span><br><span class=\"line\"># 设置首次登录强制修改密码</span><br><span class=\"line\">chage -d0 root</span><br><span class=\"line\"></span><br><span class=\"line\"># 删除网卡配置文件</span><br><span class=\"line\">rm -rf &#x2F;etc&#x2F;sysconfig&#x2F;network-scripts&#x2F;ifcfg-ens*</span><br><span class=\"line\"></span><br><span class=\"line\"># 删除SSH私钥，不同系统私钥从严格意思上来说应该不同，所以删除后，重启系统会自动生成全新的私钥</span><br><span class=\"line\">rm -rf &#x2F;etc&#x2F;ssh&#x2F;ssh_host_*</span><br><span class=\"line\"></span><br><span class=\"line\"># 修改machine-id，machine-id为系统的唯一性ID，每台服务器系统应该唯一，用于解决系统ID冲突，我们需要重置机器ID。先删除现有&#x2F;etc&#x2F;machine-id文件，然后在&#x2F;etc&#x2F;profile文件最后添加systemd-machine-id-setup命令，开机后会通过systemd-machine-id-setup命令生成全新的machine-id。如果&#x2F;etc&#x2F;machine-id文件存在，systemd-machine-id-setup命令就不会再重新创建新的机器ID。</span><br><span class=\"line\">rm -rf &#x2F;etc&#x2F;machine-id</span><br><span class=\"line\">echo &quot;systemd-machine-id-setup&quot; &gt;&gt; &#x2F;etc&#x2F;profile</span><br><span class=\"line\"></span><br><span class=\"line\"># 清理系统日志</span><br><span class=\"line\">systemctl stop systemd-journald.socket</span><br><span class=\"line\">find &#x2F;var&#x2F;log -type f -exec rm -rf &#123;&#125; \\;</span><br><span class=\"line\"></span><br><span class=\"line\"># 设置持久化保存日志的目录</span><br><span class=\"line\">mkdir -p &#x2F;var&#x2F;log&#x2F;journal</span><br><span class=\"line\"></span><br><span class=\"line\"># 清除历史命令</span><br><span class=\"line\">echo &#x2F;dev&#x2F;null &gt; ~&#x2F;.bash_history ; history -c</span><br><span class=\"line\"></span><br><span class=\"line\"># 关闭系统</span><br><span class=\"line\">systemctl poweroff</span><br></pre></td></tr></table></figure>\n\n\n<p>系统就封装完成了，这时候只需要在Proxmox VE右击对应虚拟机转换成模板即可。此方法不仅仅适用于Proxmox VE，对于Hyper-v\\ESXI\\OpenStack\\oVirt同样适用，只是Hyper-v与ESXI安装的代理软件包不同而已，如：vm-tools\\增强会话等。通过模板的构建，可以极大提高我们部署系统的速度。下篇预告：在Rocky Linux 8.3 RC1 上安装Docker CE。<br>不同的虚拟化平台需要安装不同的代理软件包</p>\n","site":{"data":{}},"excerpt":"<p>摘要: 系统镜像模板的制作</p>","more":"<h2 id=\"安装QEMU-Guest-Agent\"><a href=\"#安装QEMU-Guest-Agent\" class=\"headerlink\" title=\"安装QEMU Guest Agent\"></a>安装QEMU Guest Agent</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 安装qemu agent</span><br><span class=\"line\"> dnf install -y qemu-guest-agent</span><br><span class=\"line\"> 或</span><br><span class=\"line\"> apt-get install qemu-guest-agent</span><br><span class=\"line\"> 或</span><br><span class=\"line\"> yum install qemu-guest-agent</span><br><span class=\"line\"></span><br><span class=\"line\"> reboot</span><br></pre></td></tr></table></figure>\n\n<p>安装重启后，确保在[概要]中可以看到对应IP信息，如果无法看到对应IP信息，说明QEMU Guest Agent未启用，需要在[选项]中启用。(需要虚拟化平台支持)</p>\n<h2 id=\"系统初始化设置\"><a href=\"#系统初始化设置\" class=\"headerlink\" title=\"系统初始化设置\"></a>系统初始化设置</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 更新系统</span><br><span class=\"line\">dnf update</span><br><span class=\"line\"></span><br><span class=\"line\"># 设置首次登录强制修改密码</span><br><span class=\"line\">chage -d0 root</span><br><span class=\"line\"></span><br><span class=\"line\"># 删除网卡配置文件</span><br><span class=\"line\">rm -rf &#x2F;etc&#x2F;sysconfig&#x2F;network-scripts&#x2F;ifcfg-ens*</span><br><span class=\"line\"></span><br><span class=\"line\"># 删除SSH私钥，不同系统私钥从严格意思上来说应该不同，所以删除后，重启系统会自动生成全新的私钥</span><br><span class=\"line\">rm -rf &#x2F;etc&#x2F;ssh&#x2F;ssh_host_*</span><br><span class=\"line\"></span><br><span class=\"line\"># 修改machine-id，machine-id为系统的唯一性ID，每台服务器系统应该唯一，用于解决系统ID冲突，我们需要重置机器ID。先删除现有&#x2F;etc&#x2F;machine-id文件，然后在&#x2F;etc&#x2F;profile文件最后添加systemd-machine-id-setup命令，开机后会通过systemd-machine-id-setup命令生成全新的machine-id。如果&#x2F;etc&#x2F;machine-id文件存在，systemd-machine-id-setup命令就不会再重新创建新的机器ID。</span><br><span class=\"line\">rm -rf &#x2F;etc&#x2F;machine-id</span><br><span class=\"line\">echo &quot;systemd-machine-id-setup&quot; &gt;&gt; &#x2F;etc&#x2F;profile</span><br><span class=\"line\"></span><br><span class=\"line\"># 清理系统日志</span><br><span class=\"line\">systemctl stop systemd-journald.socket</span><br><span class=\"line\">find &#x2F;var&#x2F;log -type f -exec rm -rf &#123;&#125; \\;</span><br><span class=\"line\"></span><br><span class=\"line\"># 设置持久化保存日志的目录</span><br><span class=\"line\">mkdir -p &#x2F;var&#x2F;log&#x2F;journal</span><br><span class=\"line\"></span><br><span class=\"line\"># 清除历史命令</span><br><span class=\"line\">echo &#x2F;dev&#x2F;null &gt; ~&#x2F;.bash_history ; history -c</span><br><span class=\"line\"></span><br><span class=\"line\"># 关闭系统</span><br><span class=\"line\">systemctl poweroff</span><br></pre></td></tr></table></figure>\n\n\n<p>系统就封装完成了，这时候只需要在Proxmox VE右击对应虚拟机转换成模板即可。此方法不仅仅适用于Proxmox VE，对于Hyper-v\\ESXI\\OpenStack\\oVirt同样适用，只是Hyper-v与ESXI安装的代理软件包不同而已，如：vm-tools\\增强会话等。通过模板的构建，可以极大提高我们部署系统的速度。下篇预告：在Rocky Linux 8.3 RC1 上安装Docker CE。<br>不同的虚拟化平台需要安装不同的代理软件包</p>"},{"title":"k8s 故障","date":"2020-01-09T03:00:00.000Z","_content":"\n# 删除K8s Namespace时卡在Terminating状态\n\n想要删除K8s里的一个Namespace，结果删除了所有该Namespace资源之后使用`kubectl delete namespace test`发现删除不掉，一直卡在`Terminating`状态，使用`--force`参数依然无法删除，报错:\n\n```\nError from server (Conflict): Operation cannot be fulfilled on namespaces \"test\": The system is ensuring all content is removed from this namespace. Upon completion, this namespace will automatically be purged by the system.\n```\n\n\n\n先运行   `kubectl get namespace test -o json > tmp.json` ，拿到当前namespace描述，然后打开`tmp.json`，删除其中的`spec`字段。因为这边的K8s集群是带认证的，所以又新开了窗口运行`kubectl proxy`跑一个API代理在本地的8081端口。最后运行\n\n```bash\ncurl -k -H \"Content-Type: application/json\" -X PUT --data-binary @tmp.json http://127.0.0.1:8080/api/v1/namespaces/test/finalize\n```\n\n查看 api 地址\n\n```\n# kubectl cluster-info\n\nKubernetes master is running at http://localhost:8080\nCoreDNS is running at http://localhost:8080/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy\nkubernetes-dashboard is running at http://localhost:8080/api/v1/namespaces/kube-system/services/kubernetes-dashboard/proxy\n```\n\n","source":"_posts/k8s/k8s故障.md","raw":"---\ntitle:  k8s 故障\ndate: 2020-01-09 11:00:00\ncategories: \n- k8s\ntags:\n- k8s\n---\n\n# 删除K8s Namespace时卡在Terminating状态\n\n想要删除K8s里的一个Namespace，结果删除了所有该Namespace资源之后使用`kubectl delete namespace test`发现删除不掉，一直卡在`Terminating`状态，使用`--force`参数依然无法删除，报错:\n\n```\nError from server (Conflict): Operation cannot be fulfilled on namespaces \"test\": The system is ensuring all content is removed from this namespace. Upon completion, this namespace will automatically be purged by the system.\n```\n\n\n\n先运行   `kubectl get namespace test -o json > tmp.json` ，拿到当前namespace描述，然后打开`tmp.json`，删除其中的`spec`字段。因为这边的K8s集群是带认证的，所以又新开了窗口运行`kubectl proxy`跑一个API代理在本地的8081端口。最后运行\n\n```bash\ncurl -k -H \"Content-Type: application/json\" -X PUT --data-binary @tmp.json http://127.0.0.1:8080/api/v1/namespaces/test/finalize\n```\n\n查看 api 地址\n\n```\n# kubectl cluster-info\n\nKubernetes master is running at http://localhost:8080\nCoreDNS is running at http://localhost:8080/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy\nkubernetes-dashboard is running at http://localhost:8080/api/v1/namespaces/kube-system/services/kubernetes-dashboard/proxy\n```\n\n","slug":"k8s/k8s故障","published":1,"updated":"2021-06-18T08:07:11.194Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cku6979zw004z00uh7wdyh7na","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><h1 id=\"删除K8s-Namespace时卡在Terminating状态\"><a href=\"#删除K8s-Namespace时卡在Terminating状态\" class=\"headerlink\" title=\"删除K8s Namespace时卡在Terminating状态\"></a>删除K8s Namespace时卡在Terminating状态</h1><p>想要删除K8s里的一个Namespace，结果删除了所有该Namespace资源之后使用<code>kubectl delete namespace test</code>发现删除不掉，一直卡在<code>Terminating</code>状态，使用<code>--force</code>参数依然无法删除，报错:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Error from server (Conflict): Operation cannot be fulfilled on namespaces &quot;test&quot;: The system is ensuring all content is removed from this namespace. Upon completion, this namespace will automatically be purged by the system.</span><br></pre></td></tr></table></figure>\n\n\n\n<p>先运行   <code>kubectl get namespace test -o json &gt; tmp.json</code> ，拿到当前namespace描述，然后打开<code>tmp.json</code>，删除其中的<code>spec</code>字段。因为这边的K8s集群是带认证的，所以又新开了窗口运行<code>kubectl proxy</code>跑一个API代理在本地的8081端口。最后运行</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -k -H <span class=\"string\">&quot;Content-Type: application/json&quot;</span> -X PUT --data-binary @tmp.json http://127.0.0.1:8080/api/v1/namespaces/<span class=\"built_in\">test</span>/finalize</span><br></pre></td></tr></table></figure>\n\n<p>查看 api 地址</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># kubectl cluster-info</span><br><span class=\"line\"></span><br><span class=\"line\">Kubernetes master is running at http:&#x2F;&#x2F;localhost:8080</span><br><span class=\"line\">CoreDNS is running at http:&#x2F;&#x2F;localhost:8080&#x2F;api&#x2F;v1&#x2F;namespaces&#x2F;kube-system&#x2F;services&#x2F;kube-dns:dns&#x2F;proxy</span><br><span class=\"line\">kubernetes-dashboard is running at http:&#x2F;&#x2F;localhost:8080&#x2F;api&#x2F;v1&#x2F;namespaces&#x2F;kube-system&#x2F;services&#x2F;kubernetes-dashboard&#x2F;proxy</span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"删除K8s-Namespace时卡在Terminating状态\"><a href=\"#删除K8s-Namespace时卡在Terminating状态\" class=\"headerlink\" title=\"删除K8s Namespace时卡在Terminating状态\"></a>删除K8s Namespace时卡在Terminating状态</h1><p>想要删除K8s里的一个Namespace，结果删除了所有该Namespace资源之后使用<code>kubectl delete namespace test</code>发现删除不掉，一直卡在<code>Terminating</code>状态，使用<code>--force</code>参数依然无法删除，报错:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Error from server (Conflict): Operation cannot be fulfilled on namespaces &quot;test&quot;: The system is ensuring all content is removed from this namespace. Upon completion, this namespace will automatically be purged by the system.</span><br></pre></td></tr></table></figure>\n\n\n\n<p>先运行   <code>kubectl get namespace test -o json &gt; tmp.json</code> ，拿到当前namespace描述，然后打开<code>tmp.json</code>，删除其中的<code>spec</code>字段。因为这边的K8s集群是带认证的，所以又新开了窗口运行<code>kubectl proxy</code>跑一个API代理在本地的8081端口。最后运行</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -k -H <span class=\"string\">&quot;Content-Type: application/json&quot;</span> -X PUT --data-binary @tmp.json http://127.0.0.1:8080/api/v1/namespaces/<span class=\"built_in\">test</span>/finalize</span><br></pre></td></tr></table></figure>\n\n<p>查看 api 地址</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># kubectl cluster-info</span><br><span class=\"line\"></span><br><span class=\"line\">Kubernetes master is running at http:&#x2F;&#x2F;localhost:8080</span><br><span class=\"line\">CoreDNS is running at http:&#x2F;&#x2F;localhost:8080&#x2F;api&#x2F;v1&#x2F;namespaces&#x2F;kube-system&#x2F;services&#x2F;kube-dns:dns&#x2F;proxy</span><br><span class=\"line\">kubernetes-dashboard is running at http:&#x2F;&#x2F;localhost:8080&#x2F;api&#x2F;v1&#x2F;namespaces&#x2F;kube-system&#x2F;services&#x2F;kubernetes-dashboard&#x2F;proxy</span><br></pre></td></tr></table></figure>\n\n"},{"title":"ldap安装部署","date":"2020-03-02T06:00:00.000Z","_content":"\n\n\n### 环境准备\n\n#### 1、yum 仓库\n\n```\nwget http://mirrors.aliyun.com/repo/Centos-7.repo\ncp Centos-7.repo /etc/yum.repos.d/\ncd /etc/yum.repos.d/\nmv CentOS-Base.repo CentOS-Base.repo.bak\nmv Centos-7.repo CentOS-Base.repo\n\n(如果找不到软件包，重新设置一下yum源)\nyum localinstall http://rpms.famillecollet.com/enterprise/remi-release-7.rpm\n\nyum clean all\nyum makecache\n```\n\n#### 2、关闭防火墙\n\n```bash\nsed -i '/SELINUX/s/enforcing/disabled/' /etc/selinux/config && setenforce 0 && systemctl disable firewalld.service && systemctl stop firewalld.service && shutdown -r now\n```\n\n\n\n### 安装oepnldap\n\n```bash\nyum -y install openldap compat-openldap openldap-clients openldap-servers openldap-servers-sql openldap-devel migrationtools\n```\n\n查看openldap版本\n\n```\nslapd -VV\n\n@(#) $OpenLDAP: slapd 2.4.44 (Jan 29 2019 17:42:45) $\n\tmockbuild@x86-01.bsys.centos.org:/builddir/build/BUILD/openldap-2.4.44/openldap-2.4.44/servers/slapd\n```\n\n\n\n### 配置openldap\n\n#### 1、方式一，配置openldap管理员\n\n##### a、 这里我配置密码为123456\n\n```\n#slappasswd -s 123456\n\n{SSHA}y34sWhOnwBeR2hUBbTida1U/7s0S63sB\n```\n\n生成的密码字段保存下来\n\n##### b、修改olcDatabase={2}hdb.ldif文件\n\n```\nvim /etc/openldap/slapd.d/cn=config/olcDatabase={2}hdb.ldif\n\n修改olcDatabase={2}hdb.ldif文件,对于该文件增加一行\nolcRootPW: {SSHA}y34sWhOnwBeR2hUBbTida1U/7s0S63sB\n，然后修改域信息：\nolcSuffix: dc=ops,dc=com\nolcRootDN: cn=admin,dc=ops,dc=com\n\n修改后如下\n-----------------------------------------\n# AUTO-GENERATED FILE - DO NOT EDIT!! Use ldapmodify.\n# CRC32 505f2856\ndn: olcDatabase={2}hdb\nobjectClass: olcDatabaseConfig\nobjectClass: olcHdbConfig\nolcDatabase: {2}hdb\nolcDbDirectory: /var/lib/ldap\nolcSuffix: dc=ops,dc=com\nolcRootDN: cn=admin,dc=ops,dc=com\nolcDbIndex: objectClass eq,pres\nolcDbIndex: ou,cn,mail,surname,givenname eq,pres,sub\nstructuralObjectClass: olcHdbConfig\nentryUUID: 9773d930-f089-1039-88b1-3ff9195b4b09\ncreatorsName: cn=config\ncreateTimestamp: 20200302042528Z\nentryCSN: 20200302042528.964500Z#000000#000#000000\nmodifiersName: cn=config\nmodifyTimestamp: 20200302042528Z\nolcRootPW: {SSHA}y34sWhOnwBeR2hUBbTida1U/7s0S63sB\n```\n\n**注意**：`其中cn=adm in中的admin表示OpenLDAP管理员的用户名，而olcRootPW表示OpenLDAP管理员的密码`。\n\n##### c、修改olcDatabase={1}monitor.ldif文件\n\n```\n修改olcDatabase={1}monitor.ldif文件，如下：\nvim /etc/openldap/slapd.d/cn=config/olcDatabase\\=\\{1\\}monitor.ldif\n\nolcAccess: {0}to * by dn.base=\"gidNumber=0+uidNumber=0,cn=peercred,cn=extern\n al,cn=auth\" read by dn.base=\"cn=admin,dc=ops,dc=com\" read by * none\n\n```\n\n注意：该修改中的dn.base是修改OpenLDAP的管理员的相关信息的。\n验证OpenLDAP的基本配置，使用如下命令：\n\n```\n5e5cb0fe ldif_read_file: checksum error on \"/etc/openldap/slapd.d/cn=config/olcDatabase={1}monitor.ldif\"\n5e5cb0fe ldif_read_file: checksum error on \"/etc/openldap/slapd.d/cn=config/olcDatabase={2}hdb.ldif\"\nconfig file testing succeeded\n```\n\n上面的`checksum error `报错不用管, 只要配置文件测试succeeded成功就行\n\n\n\n##### d、修改文件权限\n\n```\nchown  -R ldap.ldap /etc/openldap/\nchown  -R ldap.ldap /var/lib/ldap/\n```\n\n##### e、启动服务\n\n```\nsystemctl enable slapd\nsystemctl start slapd\nsystemctl status slapd\n```\n\n\n\n验证服务\nOpenLDAP默认监听的端口是389，下面我们来看下是不是389端口，如下：\n\n```\ntcp        0      0 0.0.0.0:389             0.0.0.0:*               LISTEN      1472/slapd          \ntcp6       0      0 :::389                  :::*                    LISTEN      1472/slapd \n```\n\n#### 2、方式二，创建olcRootDN作为管理员账号(推荐)\n\n看到前面两个配置文件，官方不推荐我们直接修改配置文件，而是通过`ldapmodify`来更新配置。\n\n类似于update by pk, 这里的pk就是dn了。\n\n##### a、建rootdn.ldif\n\n```\ndn: olcDatabase={2}hdb,cn=config\nchangetype: modify\nreplace: olcRootDN\nolcRootDN: cn=admin,dc=demo,dc=com\n-\nreplace: olcSuffix\nolcSuffix: dc=demo,dc=com\n-\nreplace: olcRootPW\nolcRootPW: <pass>\n```\n\n- 修改olcRootDN， 设置为我们的admin: cn=admin,dc=demo,dc=com\n- 修改olcSuffix， 设置为我们的域名dc=demo,dc=com\n- 修改olcRootPW， 设置我们的admin密码, 这个需要加密，所以暂时放一个占位符，等下替换\n- changetype变更类型， replace表示替换， add表示增加。\n\n**cn=config**是全局配置，必须包含`objectClass: olcGlobal`.\n\n\n\n##### b、然后创建changeroot.sh\n\n```\nadmin_pass=`slappasswd -s admin`\necho \"admin pass is:  ${admin_pass}\"\nsed \"s!<pass>!${admin_pass}!g\"   rootdn.ldif > tmp.ldif\n\necho \"备份默认配置\"\n\ncp /etc/openldap/slapd.d/cn\\=config/olcDatabase\\=\\{2\\}hdb.ldif /etc/openldap/slapd.d/cn\\=config/olcDatabase\\=\\{2\\}hdb.ldif.bak\n\necho \"将要修改的内容：\"\ncat tmp.ldif\n\nldapmodify -Q -Y EXTERNAL -H ldapi:/// -f tmp.ldif\n\necho \"修改后的变化\"\ndiff /etc/openldap/slapd.d/cn\\=config/olcDatabase\\=\\{2\\}hdb.ldif /etc/openldap/slapd.d/cn\\=config/olcDatabase\\=\\{2\\}hdb.ldif.bak\n```\n\n- `slappasswd -s admin` 获取加密后的密码\n- 备份原始文件\n- ldapmodify 更新命令， -H指定host，这里`ldapi:///`表示IPC (Unix-domain socket)协议， -f指定变更的内容。 命令文档: http://man7.org/linux/man-pages/man1/ldapmodify.1.html\n\n使用脚本进行变更，而不是直接命令行交互式变更，这样可以更容易梳理变更逻辑, 而且可以重复使用。\n\n\n\n\n\n### 配置OpenLDAP数据库\n\n##### a、OpenLDAP默认使用的数据库是BerkeleyDB，现在来开始配置OpenLDAP数据库\n\n```\ncp /usr/share/openldap-servers/DB_CONFIG.example /var/lib/ldap/DB_CONFIG\nchown ldap:ldap -R /var/lib/ldap\nchmod 700 -R /var/lib/ldap\nll /var/lib/ldap/\n```\n\n注意：/var/lib/ldap/就是BerkeleyDB数据库默认存储的路径。\n\n##### b、导入基本Schema\n\n```\nldapadd -Y EXTERNAL -H ldapi:/// -f /etc/openldap/schema/cosine.ldif\nldapadd -Y EXTERNAL -H ldapi:/// -f /etc/openldap/schema/nis.ldif\nldapadd -Y EXTERNAL -H ldapi:/// -f /etc/openldap/schema/inetorgperson.ldif\n```\n\n##### c、修改migrate_common.ph文件\n\nmigrate_common.ph文件主要是用于生成ldif文件使用，修改migrate_common.ph文件\n\n```\nvim /usr/share/migrationtools/migrate_common.ph    71行左右\n\n$DEFAULT_MAIL_DOMAIN = “ops.com”;\n$DEFAULT_BASE = “dc=ops,dc=com”;\n$EXTENDED_SCHEMA = 1;\n```\n\n\n\n#### 添加我们的base组织结构\n\n创建文件base.ldif\n\n```\ndn: dc=ops,dc=com\nobjectClass: top\nobjectClass: dcObject\nobjectClass: organization\no: ldap测试组织\ndc: demo\n\ndn: cn=admin,dc=ops,dc=com\nobjectClass: organizationalRole\ncn: Manager\ndescription: 组织管理人\n\ndn: ou=People,dc=demo,dc=com\nobjectClass: organizationalUnit\nou: People\n\ndn: ou=Group,dc=demo,dc=com\nobjectClass: organizationalUnit\nou: Group\n\n```\n\n使用`ldapadd`添加base:\n\n```\nldapadd -x -D cn=admin,dc=demo,dc=com -w admin -f base.ldif \n```\n\n使用`ldapsearch`来检查内容\n\n```\n[root@a1791f1044ba data]# ldapsearch -x -D cn=admin,dc=ops,dc=com -w 123456 -b \"dc=ops,dc=com\"\n# extended LDIF\n#\n# LDAPv3\n# base <dc=demo,dc=com> with scope subtree\n# filter: (objectclass=*)\n# requesting: ALL\n#\n\n# ops.com\ndn: dc=ops,dc=com\nobjectClass: top\nobjectClass: dcObject\nobjectClass: organization\no:: bGRhcOa1i+ivlee7hOe7hw==\ndc: demo\n\n# Manager, demo.com\ndn: cn=Manager,dc=demo,dc=com\nobjectClass: organizationalRole\ncn: Manager\ndescription:: 57uE57uH566h55CG5Lq6\n\n# People, demo.com\ndn: ou=People,dc=demo,dc=com\nobjectClass: organizationalUnit\nou: People\n\n# Group, demo.com\ndn: ou=Group,dc=demo,dc=com\nobjectClass: organizationalUnit\nou: Group\n\n# search result\nsearch: 2\nresult: 0 Success\n\n# numResponses: 5\n# numEntries: 4\n```\n\n#### 添加用户\n\n添加人员对应的是树的叶子节点，使用的  `oebjectClass： inetOrgPerson`。\n\n添加组织部门对应的是目录，使用的  `objectClass: organizationalUnit`.","source":"_posts/ldap/ldap部署.md","raw":"---\ntitle: ldap安装部署\ndate: 2020-03-02 14:00:00\ncategories: \n- ldap\ntags:\n- ldap\n---\n\n\n\n### 环境准备\n\n#### 1、yum 仓库\n\n```\nwget http://mirrors.aliyun.com/repo/Centos-7.repo\ncp Centos-7.repo /etc/yum.repos.d/\ncd /etc/yum.repos.d/\nmv CentOS-Base.repo CentOS-Base.repo.bak\nmv Centos-7.repo CentOS-Base.repo\n\n(如果找不到软件包，重新设置一下yum源)\nyum localinstall http://rpms.famillecollet.com/enterprise/remi-release-7.rpm\n\nyum clean all\nyum makecache\n```\n\n#### 2、关闭防火墙\n\n```bash\nsed -i '/SELINUX/s/enforcing/disabled/' /etc/selinux/config && setenforce 0 && systemctl disable firewalld.service && systemctl stop firewalld.service && shutdown -r now\n```\n\n\n\n### 安装oepnldap\n\n```bash\nyum -y install openldap compat-openldap openldap-clients openldap-servers openldap-servers-sql openldap-devel migrationtools\n```\n\n查看openldap版本\n\n```\nslapd -VV\n\n@(#) $OpenLDAP: slapd 2.4.44 (Jan 29 2019 17:42:45) $\n\tmockbuild@x86-01.bsys.centos.org:/builddir/build/BUILD/openldap-2.4.44/openldap-2.4.44/servers/slapd\n```\n\n\n\n### 配置openldap\n\n#### 1、方式一，配置openldap管理员\n\n##### a、 这里我配置密码为123456\n\n```\n#slappasswd -s 123456\n\n{SSHA}y34sWhOnwBeR2hUBbTida1U/7s0S63sB\n```\n\n生成的密码字段保存下来\n\n##### b、修改olcDatabase={2}hdb.ldif文件\n\n```\nvim /etc/openldap/slapd.d/cn=config/olcDatabase={2}hdb.ldif\n\n修改olcDatabase={2}hdb.ldif文件,对于该文件增加一行\nolcRootPW: {SSHA}y34sWhOnwBeR2hUBbTida1U/7s0S63sB\n，然后修改域信息：\nolcSuffix: dc=ops,dc=com\nolcRootDN: cn=admin,dc=ops,dc=com\n\n修改后如下\n-----------------------------------------\n# AUTO-GENERATED FILE - DO NOT EDIT!! Use ldapmodify.\n# CRC32 505f2856\ndn: olcDatabase={2}hdb\nobjectClass: olcDatabaseConfig\nobjectClass: olcHdbConfig\nolcDatabase: {2}hdb\nolcDbDirectory: /var/lib/ldap\nolcSuffix: dc=ops,dc=com\nolcRootDN: cn=admin,dc=ops,dc=com\nolcDbIndex: objectClass eq,pres\nolcDbIndex: ou,cn,mail,surname,givenname eq,pres,sub\nstructuralObjectClass: olcHdbConfig\nentryUUID: 9773d930-f089-1039-88b1-3ff9195b4b09\ncreatorsName: cn=config\ncreateTimestamp: 20200302042528Z\nentryCSN: 20200302042528.964500Z#000000#000#000000\nmodifiersName: cn=config\nmodifyTimestamp: 20200302042528Z\nolcRootPW: {SSHA}y34sWhOnwBeR2hUBbTida1U/7s0S63sB\n```\n\n**注意**：`其中cn=adm in中的admin表示OpenLDAP管理员的用户名，而olcRootPW表示OpenLDAP管理员的密码`。\n\n##### c、修改olcDatabase={1}monitor.ldif文件\n\n```\n修改olcDatabase={1}monitor.ldif文件，如下：\nvim /etc/openldap/slapd.d/cn=config/olcDatabase\\=\\{1\\}monitor.ldif\n\nolcAccess: {0}to * by dn.base=\"gidNumber=0+uidNumber=0,cn=peercred,cn=extern\n al,cn=auth\" read by dn.base=\"cn=admin,dc=ops,dc=com\" read by * none\n\n```\n\n注意：该修改中的dn.base是修改OpenLDAP的管理员的相关信息的。\n验证OpenLDAP的基本配置，使用如下命令：\n\n```\n5e5cb0fe ldif_read_file: checksum error on \"/etc/openldap/slapd.d/cn=config/olcDatabase={1}monitor.ldif\"\n5e5cb0fe ldif_read_file: checksum error on \"/etc/openldap/slapd.d/cn=config/olcDatabase={2}hdb.ldif\"\nconfig file testing succeeded\n```\n\n上面的`checksum error `报错不用管, 只要配置文件测试succeeded成功就行\n\n\n\n##### d、修改文件权限\n\n```\nchown  -R ldap.ldap /etc/openldap/\nchown  -R ldap.ldap /var/lib/ldap/\n```\n\n##### e、启动服务\n\n```\nsystemctl enable slapd\nsystemctl start slapd\nsystemctl status slapd\n```\n\n\n\n验证服务\nOpenLDAP默认监听的端口是389，下面我们来看下是不是389端口，如下：\n\n```\ntcp        0      0 0.0.0.0:389             0.0.0.0:*               LISTEN      1472/slapd          \ntcp6       0      0 :::389                  :::*                    LISTEN      1472/slapd \n```\n\n#### 2、方式二，创建olcRootDN作为管理员账号(推荐)\n\n看到前面两个配置文件，官方不推荐我们直接修改配置文件，而是通过`ldapmodify`来更新配置。\n\n类似于update by pk, 这里的pk就是dn了。\n\n##### a、建rootdn.ldif\n\n```\ndn: olcDatabase={2}hdb,cn=config\nchangetype: modify\nreplace: olcRootDN\nolcRootDN: cn=admin,dc=demo,dc=com\n-\nreplace: olcSuffix\nolcSuffix: dc=demo,dc=com\n-\nreplace: olcRootPW\nolcRootPW: <pass>\n```\n\n- 修改olcRootDN， 设置为我们的admin: cn=admin,dc=demo,dc=com\n- 修改olcSuffix， 设置为我们的域名dc=demo,dc=com\n- 修改olcRootPW， 设置我们的admin密码, 这个需要加密，所以暂时放一个占位符，等下替换\n- changetype变更类型， replace表示替换， add表示增加。\n\n**cn=config**是全局配置，必须包含`objectClass: olcGlobal`.\n\n\n\n##### b、然后创建changeroot.sh\n\n```\nadmin_pass=`slappasswd -s admin`\necho \"admin pass is:  ${admin_pass}\"\nsed \"s!<pass>!${admin_pass}!g\"   rootdn.ldif > tmp.ldif\n\necho \"备份默认配置\"\n\ncp /etc/openldap/slapd.d/cn\\=config/olcDatabase\\=\\{2\\}hdb.ldif /etc/openldap/slapd.d/cn\\=config/olcDatabase\\=\\{2\\}hdb.ldif.bak\n\necho \"将要修改的内容：\"\ncat tmp.ldif\n\nldapmodify -Q -Y EXTERNAL -H ldapi:/// -f tmp.ldif\n\necho \"修改后的变化\"\ndiff /etc/openldap/slapd.d/cn\\=config/olcDatabase\\=\\{2\\}hdb.ldif /etc/openldap/slapd.d/cn\\=config/olcDatabase\\=\\{2\\}hdb.ldif.bak\n```\n\n- `slappasswd -s admin` 获取加密后的密码\n- 备份原始文件\n- ldapmodify 更新命令， -H指定host，这里`ldapi:///`表示IPC (Unix-domain socket)协议， -f指定变更的内容。 命令文档: http://man7.org/linux/man-pages/man1/ldapmodify.1.html\n\n使用脚本进行变更，而不是直接命令行交互式变更，这样可以更容易梳理变更逻辑, 而且可以重复使用。\n\n\n\n\n\n### 配置OpenLDAP数据库\n\n##### a、OpenLDAP默认使用的数据库是BerkeleyDB，现在来开始配置OpenLDAP数据库\n\n```\ncp /usr/share/openldap-servers/DB_CONFIG.example /var/lib/ldap/DB_CONFIG\nchown ldap:ldap -R /var/lib/ldap\nchmod 700 -R /var/lib/ldap\nll /var/lib/ldap/\n```\n\n注意：/var/lib/ldap/就是BerkeleyDB数据库默认存储的路径。\n\n##### b、导入基本Schema\n\n```\nldapadd -Y EXTERNAL -H ldapi:/// -f /etc/openldap/schema/cosine.ldif\nldapadd -Y EXTERNAL -H ldapi:/// -f /etc/openldap/schema/nis.ldif\nldapadd -Y EXTERNAL -H ldapi:/// -f /etc/openldap/schema/inetorgperson.ldif\n```\n\n##### c、修改migrate_common.ph文件\n\nmigrate_common.ph文件主要是用于生成ldif文件使用，修改migrate_common.ph文件\n\n```\nvim /usr/share/migrationtools/migrate_common.ph    71行左右\n\n$DEFAULT_MAIL_DOMAIN = “ops.com”;\n$DEFAULT_BASE = “dc=ops,dc=com”;\n$EXTENDED_SCHEMA = 1;\n```\n\n\n\n#### 添加我们的base组织结构\n\n创建文件base.ldif\n\n```\ndn: dc=ops,dc=com\nobjectClass: top\nobjectClass: dcObject\nobjectClass: organization\no: ldap测试组织\ndc: demo\n\ndn: cn=admin,dc=ops,dc=com\nobjectClass: organizationalRole\ncn: Manager\ndescription: 组织管理人\n\ndn: ou=People,dc=demo,dc=com\nobjectClass: organizationalUnit\nou: People\n\ndn: ou=Group,dc=demo,dc=com\nobjectClass: organizationalUnit\nou: Group\n\n```\n\n使用`ldapadd`添加base:\n\n```\nldapadd -x -D cn=admin,dc=demo,dc=com -w admin -f base.ldif \n```\n\n使用`ldapsearch`来检查内容\n\n```\n[root@a1791f1044ba data]# ldapsearch -x -D cn=admin,dc=ops,dc=com -w 123456 -b \"dc=ops,dc=com\"\n# extended LDIF\n#\n# LDAPv3\n# base <dc=demo,dc=com> with scope subtree\n# filter: (objectclass=*)\n# requesting: ALL\n#\n\n# ops.com\ndn: dc=ops,dc=com\nobjectClass: top\nobjectClass: dcObject\nobjectClass: organization\no:: bGRhcOa1i+ivlee7hOe7hw==\ndc: demo\n\n# Manager, demo.com\ndn: cn=Manager,dc=demo,dc=com\nobjectClass: organizationalRole\ncn: Manager\ndescription:: 57uE57uH566h55CG5Lq6\n\n# People, demo.com\ndn: ou=People,dc=demo,dc=com\nobjectClass: organizationalUnit\nou: People\n\n# Group, demo.com\ndn: ou=Group,dc=demo,dc=com\nobjectClass: organizationalUnit\nou: Group\n\n# search result\nsearch: 2\nresult: 0 Success\n\n# numResponses: 5\n# numEntries: 4\n```\n\n#### 添加用户\n\n添加人员对应的是树的叶子节点，使用的  `oebjectClass： inetOrgPerson`。\n\n添加组织部门对应的是目录，使用的  `objectClass: organizationalUnit`.","slug":"ldap/ldap部署","published":1,"updated":"2021-06-18T08:07:11.196Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cku6979zx005200uh2rbl8cct","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><h3 id=\"环境准备\"><a href=\"#环境准备\" class=\"headerlink\" title=\"环境准备\"></a>环境准备</h3><h4 id=\"1、yum-仓库\"><a href=\"#1、yum-仓库\" class=\"headerlink\" title=\"1、yum 仓库\"></a>1、yum 仓库</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;repo&#x2F;Centos-7.repo</span><br><span class=\"line\">cp Centos-7.repo &#x2F;etc&#x2F;yum.repos.d&#x2F;</span><br><span class=\"line\">cd &#x2F;etc&#x2F;yum.repos.d&#x2F;</span><br><span class=\"line\">mv CentOS-Base.repo CentOS-Base.repo.bak</span><br><span class=\"line\">mv Centos-7.repo CentOS-Base.repo</span><br><span class=\"line\"></span><br><span class=\"line\">(如果找不到软件包，重新设置一下yum源)</span><br><span class=\"line\">yum localinstall http:&#x2F;&#x2F;rpms.famillecollet.com&#x2F;enterprise&#x2F;remi-release-7.rpm</span><br><span class=\"line\"></span><br><span class=\"line\">yum clean all</span><br><span class=\"line\">yum makecache</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"2、关闭防火墙\"><a href=\"#2、关闭防火墙\" class=\"headerlink\" title=\"2、关闭防火墙\"></a>2、关闭防火墙</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sed -i <span class=\"string\">&#x27;/SELINUX/s/enforcing/disabled/&#x27;</span> /etc/selinux/config &amp;&amp; setenforce 0 &amp;&amp; systemctl <span class=\"built_in\">disable</span> firewalld.service &amp;&amp; systemctl stop firewalld.service &amp;&amp; shutdown -r now</span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"安装oepnldap\"><a href=\"#安装oepnldap\" class=\"headerlink\" title=\"安装oepnldap\"></a>安装oepnldap</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum -y install openldap compat-openldap openldap-clients openldap-servers openldap-servers-sql openldap-devel migrationtools</span><br></pre></td></tr></table></figure>\n\n<p>查看openldap版本</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">slapd -VV</span><br><span class=\"line\"></span><br><span class=\"line\">@(#) $OpenLDAP: slapd 2.4.44 (Jan 29 2019 17:42:45) $</span><br><span class=\"line\">\tmockbuild@x86-01.bsys.centos.org:&#x2F;builddir&#x2F;build&#x2F;BUILD&#x2F;openldap-2.4.44&#x2F;openldap-2.4.44&#x2F;servers&#x2F;slapd</span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"配置openldap\"><a href=\"#配置openldap\" class=\"headerlink\" title=\"配置openldap\"></a>配置openldap</h3><h4 id=\"1、方式一，配置openldap管理员\"><a href=\"#1、方式一，配置openldap管理员\" class=\"headerlink\" title=\"1、方式一，配置openldap管理员\"></a>1、方式一，配置openldap管理员</h4><h5 id=\"a、-这里我配置密码为123456\"><a href=\"#a、-这里我配置密码为123456\" class=\"headerlink\" title=\"a、 这里我配置密码为123456\"></a>a、 这里我配置密码为123456</h5><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#slappasswd -s 123456</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;SSHA&#125;y34sWhOnwBeR2hUBbTida1U&#x2F;7s0S63sB</span><br></pre></td></tr></table></figure>\n\n<p>生成的密码字段保存下来</p>\n<h5 id=\"b、修改olcDatabase-2-hdb-ldif文件\"><a href=\"#b、修改olcDatabase-2-hdb-ldif文件\" class=\"headerlink\" title=\"b、修改olcDatabase={2}hdb.ldif文件\"></a>b、修改olcDatabase={2}hdb.ldif文件</h5><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim &#x2F;etc&#x2F;openldap&#x2F;slapd.d&#x2F;cn&#x3D;config&#x2F;olcDatabase&#x3D;&#123;2&#125;hdb.ldif</span><br><span class=\"line\"></span><br><span class=\"line\">修改olcDatabase&#x3D;&#123;2&#125;hdb.ldif文件,对于该文件增加一行</span><br><span class=\"line\">olcRootPW: &#123;SSHA&#125;y34sWhOnwBeR2hUBbTida1U&#x2F;7s0S63sB</span><br><span class=\"line\">，然后修改域信息：</span><br><span class=\"line\">olcSuffix: dc&#x3D;ops,dc&#x3D;com</span><br><span class=\"line\">olcRootDN: cn&#x3D;admin,dc&#x3D;ops,dc&#x3D;com</span><br><span class=\"line\"></span><br><span class=\"line\">修改后如下</span><br><span class=\"line\">-----------------------------------------</span><br><span class=\"line\"># AUTO-GENERATED FILE - DO NOT EDIT!! Use ldapmodify.</span><br><span class=\"line\"># CRC32 505f2856</span><br><span class=\"line\">dn: olcDatabase&#x3D;&#123;2&#125;hdb</span><br><span class=\"line\">objectClass: olcDatabaseConfig</span><br><span class=\"line\">objectClass: olcHdbConfig</span><br><span class=\"line\">olcDatabase: &#123;2&#125;hdb</span><br><span class=\"line\">olcDbDirectory: &#x2F;var&#x2F;lib&#x2F;ldap</span><br><span class=\"line\">olcSuffix: dc&#x3D;ops,dc&#x3D;com</span><br><span class=\"line\">olcRootDN: cn&#x3D;admin,dc&#x3D;ops,dc&#x3D;com</span><br><span class=\"line\">olcDbIndex: objectClass eq,pres</span><br><span class=\"line\">olcDbIndex: ou,cn,mail,surname,givenname eq,pres,sub</span><br><span class=\"line\">structuralObjectClass: olcHdbConfig</span><br><span class=\"line\">entryUUID: 9773d930-f089-1039-88b1-3ff9195b4b09</span><br><span class=\"line\">creatorsName: cn&#x3D;config</span><br><span class=\"line\">createTimestamp: 20200302042528Z</span><br><span class=\"line\">entryCSN: 20200302042528.964500Z#000000#000#000000</span><br><span class=\"line\">modifiersName: cn&#x3D;config</span><br><span class=\"line\">modifyTimestamp: 20200302042528Z</span><br><span class=\"line\">olcRootPW: &#123;SSHA&#125;y34sWhOnwBeR2hUBbTida1U&#x2F;7s0S63sB</span><br></pre></td></tr></table></figure>\n\n<p><strong>注意</strong>：<code>其中cn=adm in中的admin表示OpenLDAP管理员的用户名，而olcRootPW表示OpenLDAP管理员的密码</code>。</p>\n<h5 id=\"c、修改olcDatabase-1-monitor-ldif文件\"><a href=\"#c、修改olcDatabase-1-monitor-ldif文件\" class=\"headerlink\" title=\"c、修改olcDatabase={1}monitor.ldif文件\"></a>c、修改olcDatabase={1}monitor.ldif文件</h5><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">修改olcDatabase&#x3D;&#123;1&#125;monitor.ldif文件，如下：</span><br><span class=\"line\">vim &#x2F;etc&#x2F;openldap&#x2F;slapd.d&#x2F;cn&#x3D;config&#x2F;olcDatabase\\&#x3D;\\&#123;1\\&#125;monitor.ldif</span><br><span class=\"line\"></span><br><span class=\"line\">olcAccess: &#123;0&#125;to * by dn.base&#x3D;&quot;gidNumber&#x3D;0+uidNumber&#x3D;0,cn&#x3D;peercred,cn&#x3D;extern</span><br><span class=\"line\"> al,cn&#x3D;auth&quot; read by dn.base&#x3D;&quot;cn&#x3D;admin,dc&#x3D;ops,dc&#x3D;com&quot; read by * none</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>注意：该修改中的dn.base是修改OpenLDAP的管理员的相关信息的。<br>验证OpenLDAP的基本配置，使用如下命令：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">5e5cb0fe ldif_read_file: checksum error on &quot;&#x2F;etc&#x2F;openldap&#x2F;slapd.d&#x2F;cn&#x3D;config&#x2F;olcDatabase&#x3D;&#123;1&#125;monitor.ldif&quot;</span><br><span class=\"line\">5e5cb0fe ldif_read_file: checksum error on &quot;&#x2F;etc&#x2F;openldap&#x2F;slapd.d&#x2F;cn&#x3D;config&#x2F;olcDatabase&#x3D;&#123;2&#125;hdb.ldif&quot;</span><br><span class=\"line\">config file testing succeeded</span><br></pre></td></tr></table></figure>\n\n<p>上面的<code>checksum error </code>报错不用管, 只要配置文件测试succeeded成功就行</p>\n<h5 id=\"d、修改文件权限\"><a href=\"#d、修改文件权限\" class=\"headerlink\" title=\"d、修改文件权限\"></a>d、修改文件权限</h5><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">chown  -R ldap.ldap &#x2F;etc&#x2F;openldap&#x2F;</span><br><span class=\"line\">chown  -R ldap.ldap &#x2F;var&#x2F;lib&#x2F;ldap&#x2F;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"e、启动服务\"><a href=\"#e、启动服务\" class=\"headerlink\" title=\"e、启动服务\"></a>e、启动服务</h5><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl enable slapd</span><br><span class=\"line\">systemctl start slapd</span><br><span class=\"line\">systemctl status slapd</span><br></pre></td></tr></table></figure>\n\n\n\n<p>验证服务<br>OpenLDAP默认监听的端口是389，下面我们来看下是不是389端口，如下：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tcp        0      0 0.0.0.0:389             0.0.0.0:*               LISTEN      1472&#x2F;slapd          </span><br><span class=\"line\">tcp6       0      0 :::389                  :::*                    LISTEN      1472&#x2F;slapd </span><br></pre></td></tr></table></figure>\n\n<h4 id=\"2、方式二，创建olcRootDN作为管理员账号-推荐\"><a href=\"#2、方式二，创建olcRootDN作为管理员账号-推荐\" class=\"headerlink\" title=\"2、方式二，创建olcRootDN作为管理员账号(推荐)\"></a>2、方式二，创建olcRootDN作为管理员账号(推荐)</h4><p>看到前面两个配置文件，官方不推荐我们直接修改配置文件，而是通过<code>ldapmodify</code>来更新配置。</p>\n<p>类似于update by pk, 这里的pk就是dn了。</p>\n<h5 id=\"a、建rootdn-ldif\"><a href=\"#a、建rootdn-ldif\" class=\"headerlink\" title=\"a、建rootdn.ldif\"></a>a、建rootdn.ldif</h5><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">dn: olcDatabase&#x3D;&#123;2&#125;hdb,cn&#x3D;config</span><br><span class=\"line\">changetype: modify</span><br><span class=\"line\">replace: olcRootDN</span><br><span class=\"line\">olcRootDN: cn&#x3D;admin,dc&#x3D;demo,dc&#x3D;com</span><br><span class=\"line\">-</span><br><span class=\"line\">replace: olcSuffix</span><br><span class=\"line\">olcSuffix: dc&#x3D;demo,dc&#x3D;com</span><br><span class=\"line\">-</span><br><span class=\"line\">replace: olcRootPW</span><br><span class=\"line\">olcRootPW: &lt;pass&gt;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>修改olcRootDN， 设置为我们的admin: cn=admin,dc=demo,dc=com</li>\n<li>修改olcSuffix， 设置为我们的域名dc=demo,dc=com</li>\n<li>修改olcRootPW， 设置我们的admin密码, 这个需要加密，所以暂时放一个占位符，等下替换</li>\n<li>changetype变更类型， replace表示替换， add表示增加。</li>\n</ul>\n<p><strong>cn=config</strong>是全局配置，必须包含<code>objectClass: olcGlobal</code>.</p>\n<h5 id=\"b、然后创建changeroot-sh\"><a href=\"#b、然后创建changeroot-sh\" class=\"headerlink\" title=\"b、然后创建changeroot.sh\"></a>b、然后创建changeroot.sh</h5><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">admin_pass&#x3D;&#96;slappasswd -s admin&#96;</span><br><span class=\"line\">echo &quot;admin pass is:  $&#123;admin_pass&#125;&quot;</span><br><span class=\"line\">sed &quot;s!&lt;pass&gt;!$&#123;admin_pass&#125;!g&quot;   rootdn.ldif &gt; tmp.ldif</span><br><span class=\"line\"></span><br><span class=\"line\">echo &quot;备份默认配置&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">cp &#x2F;etc&#x2F;openldap&#x2F;slapd.d&#x2F;cn\\&#x3D;config&#x2F;olcDatabase\\&#x3D;\\&#123;2\\&#125;hdb.ldif &#x2F;etc&#x2F;openldap&#x2F;slapd.d&#x2F;cn\\&#x3D;config&#x2F;olcDatabase\\&#x3D;\\&#123;2\\&#125;hdb.ldif.bak</span><br><span class=\"line\"></span><br><span class=\"line\">echo &quot;将要修改的内容：&quot;</span><br><span class=\"line\">cat tmp.ldif</span><br><span class=\"line\"></span><br><span class=\"line\">ldapmodify -Q -Y EXTERNAL -H ldapi:&#x2F;&#x2F;&#x2F; -f tmp.ldif</span><br><span class=\"line\"></span><br><span class=\"line\">echo &quot;修改后的变化&quot;</span><br><span class=\"line\">diff &#x2F;etc&#x2F;openldap&#x2F;slapd.d&#x2F;cn\\&#x3D;config&#x2F;olcDatabase\\&#x3D;\\&#123;2\\&#125;hdb.ldif &#x2F;etc&#x2F;openldap&#x2F;slapd.d&#x2F;cn\\&#x3D;config&#x2F;olcDatabase\\&#x3D;\\&#123;2\\&#125;hdb.ldif.bak</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><code>slappasswd -s admin</code> 获取加密后的密码</li>\n<li>备份原始文件</li>\n<li>ldapmodify 更新命令， -H指定host，这里<code>ldapi:///</code>表示IPC (Unix-domain socket)协议， -f指定变更的内容。 命令文档: <a href=\"http://man7.org/linux/man-pages/man1/ldapmodify.1.html\">http://man7.org/linux/man-pages/man1/ldapmodify.1.html</a></li>\n</ul>\n<p>使用脚本进行变更，而不是直接命令行交互式变更，这样可以更容易梳理变更逻辑, 而且可以重复使用。</p>\n<h3 id=\"配置OpenLDAP数据库\"><a href=\"#配置OpenLDAP数据库\" class=\"headerlink\" title=\"配置OpenLDAP数据库\"></a>配置OpenLDAP数据库</h3><h5 id=\"a、OpenLDAP默认使用的数据库是BerkeleyDB，现在来开始配置OpenLDAP数据库\"><a href=\"#a、OpenLDAP默认使用的数据库是BerkeleyDB，现在来开始配置OpenLDAP数据库\" class=\"headerlink\" title=\"a、OpenLDAP默认使用的数据库是BerkeleyDB，现在来开始配置OpenLDAP数据库\"></a>a、OpenLDAP默认使用的数据库是BerkeleyDB，现在来开始配置OpenLDAP数据库</h5><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cp &#x2F;usr&#x2F;share&#x2F;openldap-servers&#x2F;DB_CONFIG.example &#x2F;var&#x2F;lib&#x2F;ldap&#x2F;DB_CONFIG</span><br><span class=\"line\">chown ldap:ldap -R &#x2F;var&#x2F;lib&#x2F;ldap</span><br><span class=\"line\">chmod 700 -R &#x2F;var&#x2F;lib&#x2F;ldap</span><br><span class=\"line\">ll &#x2F;var&#x2F;lib&#x2F;ldap&#x2F;</span><br></pre></td></tr></table></figure>\n\n<p>注意：/var/lib/ldap/就是BerkeleyDB数据库默认存储的路径。</p>\n<h5 id=\"b、导入基本Schema\"><a href=\"#b、导入基本Schema\" class=\"headerlink\" title=\"b、导入基本Schema\"></a>b、导入基本Schema</h5><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ldapadd -Y EXTERNAL -H ldapi:&#x2F;&#x2F;&#x2F; -f &#x2F;etc&#x2F;openldap&#x2F;schema&#x2F;cosine.ldif</span><br><span class=\"line\">ldapadd -Y EXTERNAL -H ldapi:&#x2F;&#x2F;&#x2F; -f &#x2F;etc&#x2F;openldap&#x2F;schema&#x2F;nis.ldif</span><br><span class=\"line\">ldapadd -Y EXTERNAL -H ldapi:&#x2F;&#x2F;&#x2F; -f &#x2F;etc&#x2F;openldap&#x2F;schema&#x2F;inetorgperson.ldif</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"c、修改migrate-common-ph文件\"><a href=\"#c、修改migrate-common-ph文件\" class=\"headerlink\" title=\"c、修改migrate_common.ph文件\"></a>c、修改migrate_common.ph文件</h5><p>migrate_common.ph文件主要是用于生成ldif文件使用，修改migrate_common.ph文件</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim &#x2F;usr&#x2F;share&#x2F;migrationtools&#x2F;migrate_common.ph    71行左右</span><br><span class=\"line\"></span><br><span class=\"line\">$DEFAULT_MAIL_DOMAIN &#x3D; “ops.com”;</span><br><span class=\"line\">$DEFAULT_BASE &#x3D; “dc&#x3D;ops,dc&#x3D;com”;</span><br><span class=\"line\">$EXTENDED_SCHEMA &#x3D; 1;</span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"添加我们的base组织结构\"><a href=\"#添加我们的base组织结构\" class=\"headerlink\" title=\"添加我们的base组织结构\"></a>添加我们的base组织结构</h4><p>创建文件base.ldif</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">dn: dc&#x3D;ops,dc&#x3D;com</span><br><span class=\"line\">objectClass: top</span><br><span class=\"line\">objectClass: dcObject</span><br><span class=\"line\">objectClass: organization</span><br><span class=\"line\">o: ldap测试组织</span><br><span class=\"line\">dc: demo</span><br><span class=\"line\"></span><br><span class=\"line\">dn: cn&#x3D;admin,dc&#x3D;ops,dc&#x3D;com</span><br><span class=\"line\">objectClass: organizationalRole</span><br><span class=\"line\">cn: Manager</span><br><span class=\"line\">description: 组织管理人</span><br><span class=\"line\"></span><br><span class=\"line\">dn: ou&#x3D;People,dc&#x3D;demo,dc&#x3D;com</span><br><span class=\"line\">objectClass: organizationalUnit</span><br><span class=\"line\">ou: People</span><br><span class=\"line\"></span><br><span class=\"line\">dn: ou&#x3D;Group,dc&#x3D;demo,dc&#x3D;com</span><br><span class=\"line\">objectClass: organizationalUnit</span><br><span class=\"line\">ou: Group</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>使用<code>ldapadd</code>添加base:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ldapadd -x -D cn&#x3D;admin,dc&#x3D;demo,dc&#x3D;com -w admin -f base.ldif </span><br></pre></td></tr></table></figure>\n\n<p>使用<code>ldapsearch</code>来检查内容</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@a1791f1044ba data]# ldapsearch -x -D cn&#x3D;admin,dc&#x3D;ops,dc&#x3D;com -w 123456 -b &quot;dc&#x3D;ops,dc&#x3D;com&quot;</span><br><span class=\"line\"># extended LDIF</span><br><span class=\"line\">#</span><br><span class=\"line\"># LDAPv3</span><br><span class=\"line\"># base &lt;dc&#x3D;demo,dc&#x3D;com&gt; with scope subtree</span><br><span class=\"line\"># filter: (objectclass&#x3D;*)</span><br><span class=\"line\"># requesting: ALL</span><br><span class=\"line\">#</span><br><span class=\"line\"></span><br><span class=\"line\"># ops.com</span><br><span class=\"line\">dn: dc&#x3D;ops,dc&#x3D;com</span><br><span class=\"line\">objectClass: top</span><br><span class=\"line\">objectClass: dcObject</span><br><span class=\"line\">objectClass: organization</span><br><span class=\"line\">o:: bGRhcOa1i+ivlee7hOe7hw&#x3D;&#x3D;</span><br><span class=\"line\">dc: demo</span><br><span class=\"line\"></span><br><span class=\"line\"># Manager, demo.com</span><br><span class=\"line\">dn: cn&#x3D;Manager,dc&#x3D;demo,dc&#x3D;com</span><br><span class=\"line\">objectClass: organizationalRole</span><br><span class=\"line\">cn: Manager</span><br><span class=\"line\">description:: 57uE57uH566h55CG5Lq6</span><br><span class=\"line\"></span><br><span class=\"line\"># People, demo.com</span><br><span class=\"line\">dn: ou&#x3D;People,dc&#x3D;demo,dc&#x3D;com</span><br><span class=\"line\">objectClass: organizationalUnit</span><br><span class=\"line\">ou: People</span><br><span class=\"line\"></span><br><span class=\"line\"># Group, demo.com</span><br><span class=\"line\">dn: ou&#x3D;Group,dc&#x3D;demo,dc&#x3D;com</span><br><span class=\"line\">objectClass: organizationalUnit</span><br><span class=\"line\">ou: Group</span><br><span class=\"line\"></span><br><span class=\"line\"># search result</span><br><span class=\"line\">search: 2</span><br><span class=\"line\">result: 0 Success</span><br><span class=\"line\"></span><br><span class=\"line\"># numResponses: 5</span><br><span class=\"line\"># numEntries: 4</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"添加用户\"><a href=\"#添加用户\" class=\"headerlink\" title=\"添加用户\"></a>添加用户</h4><p>添加人员对应的是树的叶子节点，使用的  <code>oebjectClass： inetOrgPerson</code>。</p>\n<p>添加组织部门对应的是目录，使用的  <code>objectClass: organizationalUnit</code>.</p>\n","site":{"data":{}},"excerpt":"","more":"<h3 id=\"环境准备\"><a href=\"#环境准备\" class=\"headerlink\" title=\"环境准备\"></a>环境准备</h3><h4 id=\"1、yum-仓库\"><a href=\"#1、yum-仓库\" class=\"headerlink\" title=\"1、yum 仓库\"></a>1、yum 仓库</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;repo&#x2F;Centos-7.repo</span><br><span class=\"line\">cp Centos-7.repo &#x2F;etc&#x2F;yum.repos.d&#x2F;</span><br><span class=\"line\">cd &#x2F;etc&#x2F;yum.repos.d&#x2F;</span><br><span class=\"line\">mv CentOS-Base.repo CentOS-Base.repo.bak</span><br><span class=\"line\">mv Centos-7.repo CentOS-Base.repo</span><br><span class=\"line\"></span><br><span class=\"line\">(如果找不到软件包，重新设置一下yum源)</span><br><span class=\"line\">yum localinstall http:&#x2F;&#x2F;rpms.famillecollet.com&#x2F;enterprise&#x2F;remi-release-7.rpm</span><br><span class=\"line\"></span><br><span class=\"line\">yum clean all</span><br><span class=\"line\">yum makecache</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"2、关闭防火墙\"><a href=\"#2、关闭防火墙\" class=\"headerlink\" title=\"2、关闭防火墙\"></a>2、关闭防火墙</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sed -i <span class=\"string\">&#x27;/SELINUX/s/enforcing/disabled/&#x27;</span> /etc/selinux/config &amp;&amp; setenforce 0 &amp;&amp; systemctl <span class=\"built_in\">disable</span> firewalld.service &amp;&amp; systemctl stop firewalld.service &amp;&amp; shutdown -r now</span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"安装oepnldap\"><a href=\"#安装oepnldap\" class=\"headerlink\" title=\"安装oepnldap\"></a>安装oepnldap</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum -y install openldap compat-openldap openldap-clients openldap-servers openldap-servers-sql openldap-devel migrationtools</span><br></pre></td></tr></table></figure>\n\n<p>查看openldap版本</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">slapd -VV</span><br><span class=\"line\"></span><br><span class=\"line\">@(#) $OpenLDAP: slapd 2.4.44 (Jan 29 2019 17:42:45) $</span><br><span class=\"line\">\tmockbuild@x86-01.bsys.centos.org:&#x2F;builddir&#x2F;build&#x2F;BUILD&#x2F;openldap-2.4.44&#x2F;openldap-2.4.44&#x2F;servers&#x2F;slapd</span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"配置openldap\"><a href=\"#配置openldap\" class=\"headerlink\" title=\"配置openldap\"></a>配置openldap</h3><h4 id=\"1、方式一，配置openldap管理员\"><a href=\"#1、方式一，配置openldap管理员\" class=\"headerlink\" title=\"1、方式一，配置openldap管理员\"></a>1、方式一，配置openldap管理员</h4><h5 id=\"a、-这里我配置密码为123456\"><a href=\"#a、-这里我配置密码为123456\" class=\"headerlink\" title=\"a、 这里我配置密码为123456\"></a>a、 这里我配置密码为123456</h5><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#slappasswd -s 123456</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;SSHA&#125;y34sWhOnwBeR2hUBbTida1U&#x2F;7s0S63sB</span><br></pre></td></tr></table></figure>\n\n<p>生成的密码字段保存下来</p>\n<h5 id=\"b、修改olcDatabase-2-hdb-ldif文件\"><a href=\"#b、修改olcDatabase-2-hdb-ldif文件\" class=\"headerlink\" title=\"b、修改olcDatabase={2}hdb.ldif文件\"></a>b、修改olcDatabase={2}hdb.ldif文件</h5><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim &#x2F;etc&#x2F;openldap&#x2F;slapd.d&#x2F;cn&#x3D;config&#x2F;olcDatabase&#x3D;&#123;2&#125;hdb.ldif</span><br><span class=\"line\"></span><br><span class=\"line\">修改olcDatabase&#x3D;&#123;2&#125;hdb.ldif文件,对于该文件增加一行</span><br><span class=\"line\">olcRootPW: &#123;SSHA&#125;y34sWhOnwBeR2hUBbTida1U&#x2F;7s0S63sB</span><br><span class=\"line\">，然后修改域信息：</span><br><span class=\"line\">olcSuffix: dc&#x3D;ops,dc&#x3D;com</span><br><span class=\"line\">olcRootDN: cn&#x3D;admin,dc&#x3D;ops,dc&#x3D;com</span><br><span class=\"line\"></span><br><span class=\"line\">修改后如下</span><br><span class=\"line\">-----------------------------------------</span><br><span class=\"line\"># AUTO-GENERATED FILE - DO NOT EDIT!! Use ldapmodify.</span><br><span class=\"line\"># CRC32 505f2856</span><br><span class=\"line\">dn: olcDatabase&#x3D;&#123;2&#125;hdb</span><br><span class=\"line\">objectClass: olcDatabaseConfig</span><br><span class=\"line\">objectClass: olcHdbConfig</span><br><span class=\"line\">olcDatabase: &#123;2&#125;hdb</span><br><span class=\"line\">olcDbDirectory: &#x2F;var&#x2F;lib&#x2F;ldap</span><br><span class=\"line\">olcSuffix: dc&#x3D;ops,dc&#x3D;com</span><br><span class=\"line\">olcRootDN: cn&#x3D;admin,dc&#x3D;ops,dc&#x3D;com</span><br><span class=\"line\">olcDbIndex: objectClass eq,pres</span><br><span class=\"line\">olcDbIndex: ou,cn,mail,surname,givenname eq,pres,sub</span><br><span class=\"line\">structuralObjectClass: olcHdbConfig</span><br><span class=\"line\">entryUUID: 9773d930-f089-1039-88b1-3ff9195b4b09</span><br><span class=\"line\">creatorsName: cn&#x3D;config</span><br><span class=\"line\">createTimestamp: 20200302042528Z</span><br><span class=\"line\">entryCSN: 20200302042528.964500Z#000000#000#000000</span><br><span class=\"line\">modifiersName: cn&#x3D;config</span><br><span class=\"line\">modifyTimestamp: 20200302042528Z</span><br><span class=\"line\">olcRootPW: &#123;SSHA&#125;y34sWhOnwBeR2hUBbTida1U&#x2F;7s0S63sB</span><br></pre></td></tr></table></figure>\n\n<p><strong>注意</strong>：<code>其中cn=adm in中的admin表示OpenLDAP管理员的用户名，而olcRootPW表示OpenLDAP管理员的密码</code>。</p>\n<h5 id=\"c、修改olcDatabase-1-monitor-ldif文件\"><a href=\"#c、修改olcDatabase-1-monitor-ldif文件\" class=\"headerlink\" title=\"c、修改olcDatabase={1}monitor.ldif文件\"></a>c、修改olcDatabase={1}monitor.ldif文件</h5><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">修改olcDatabase&#x3D;&#123;1&#125;monitor.ldif文件，如下：</span><br><span class=\"line\">vim &#x2F;etc&#x2F;openldap&#x2F;slapd.d&#x2F;cn&#x3D;config&#x2F;olcDatabase\\&#x3D;\\&#123;1\\&#125;monitor.ldif</span><br><span class=\"line\"></span><br><span class=\"line\">olcAccess: &#123;0&#125;to * by dn.base&#x3D;&quot;gidNumber&#x3D;0+uidNumber&#x3D;0,cn&#x3D;peercred,cn&#x3D;extern</span><br><span class=\"line\"> al,cn&#x3D;auth&quot; read by dn.base&#x3D;&quot;cn&#x3D;admin,dc&#x3D;ops,dc&#x3D;com&quot; read by * none</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>注意：该修改中的dn.base是修改OpenLDAP的管理员的相关信息的。<br>验证OpenLDAP的基本配置，使用如下命令：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">5e5cb0fe ldif_read_file: checksum error on &quot;&#x2F;etc&#x2F;openldap&#x2F;slapd.d&#x2F;cn&#x3D;config&#x2F;olcDatabase&#x3D;&#123;1&#125;monitor.ldif&quot;</span><br><span class=\"line\">5e5cb0fe ldif_read_file: checksum error on &quot;&#x2F;etc&#x2F;openldap&#x2F;slapd.d&#x2F;cn&#x3D;config&#x2F;olcDatabase&#x3D;&#123;2&#125;hdb.ldif&quot;</span><br><span class=\"line\">config file testing succeeded</span><br></pre></td></tr></table></figure>\n\n<p>上面的<code>checksum error </code>报错不用管, 只要配置文件测试succeeded成功就行</p>\n<h5 id=\"d、修改文件权限\"><a href=\"#d、修改文件权限\" class=\"headerlink\" title=\"d、修改文件权限\"></a>d、修改文件权限</h5><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">chown  -R ldap.ldap &#x2F;etc&#x2F;openldap&#x2F;</span><br><span class=\"line\">chown  -R ldap.ldap &#x2F;var&#x2F;lib&#x2F;ldap&#x2F;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"e、启动服务\"><a href=\"#e、启动服务\" class=\"headerlink\" title=\"e、启动服务\"></a>e、启动服务</h5><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl enable slapd</span><br><span class=\"line\">systemctl start slapd</span><br><span class=\"line\">systemctl status slapd</span><br></pre></td></tr></table></figure>\n\n\n\n<p>验证服务<br>OpenLDAP默认监听的端口是389，下面我们来看下是不是389端口，如下：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tcp        0      0 0.0.0.0:389             0.0.0.0:*               LISTEN      1472&#x2F;slapd          </span><br><span class=\"line\">tcp6       0      0 :::389                  :::*                    LISTEN      1472&#x2F;slapd </span><br></pre></td></tr></table></figure>\n\n<h4 id=\"2、方式二，创建olcRootDN作为管理员账号-推荐\"><a href=\"#2、方式二，创建olcRootDN作为管理员账号-推荐\" class=\"headerlink\" title=\"2、方式二，创建olcRootDN作为管理员账号(推荐)\"></a>2、方式二，创建olcRootDN作为管理员账号(推荐)</h4><p>看到前面两个配置文件，官方不推荐我们直接修改配置文件，而是通过<code>ldapmodify</code>来更新配置。</p>\n<p>类似于update by pk, 这里的pk就是dn了。</p>\n<h5 id=\"a、建rootdn-ldif\"><a href=\"#a、建rootdn-ldif\" class=\"headerlink\" title=\"a、建rootdn.ldif\"></a>a、建rootdn.ldif</h5><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">dn: olcDatabase&#x3D;&#123;2&#125;hdb,cn&#x3D;config</span><br><span class=\"line\">changetype: modify</span><br><span class=\"line\">replace: olcRootDN</span><br><span class=\"line\">olcRootDN: cn&#x3D;admin,dc&#x3D;demo,dc&#x3D;com</span><br><span class=\"line\">-</span><br><span class=\"line\">replace: olcSuffix</span><br><span class=\"line\">olcSuffix: dc&#x3D;demo,dc&#x3D;com</span><br><span class=\"line\">-</span><br><span class=\"line\">replace: olcRootPW</span><br><span class=\"line\">olcRootPW: &lt;pass&gt;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>修改olcRootDN， 设置为我们的admin: cn=admin,dc=demo,dc=com</li>\n<li>修改olcSuffix， 设置为我们的域名dc=demo,dc=com</li>\n<li>修改olcRootPW， 设置我们的admin密码, 这个需要加密，所以暂时放一个占位符，等下替换</li>\n<li>changetype变更类型， replace表示替换， add表示增加。</li>\n</ul>\n<p><strong>cn=config</strong>是全局配置，必须包含<code>objectClass: olcGlobal</code>.</p>\n<h5 id=\"b、然后创建changeroot-sh\"><a href=\"#b、然后创建changeroot-sh\" class=\"headerlink\" title=\"b、然后创建changeroot.sh\"></a>b、然后创建changeroot.sh</h5><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">admin_pass&#x3D;&#96;slappasswd -s admin&#96;</span><br><span class=\"line\">echo &quot;admin pass is:  $&#123;admin_pass&#125;&quot;</span><br><span class=\"line\">sed &quot;s!&lt;pass&gt;!$&#123;admin_pass&#125;!g&quot;   rootdn.ldif &gt; tmp.ldif</span><br><span class=\"line\"></span><br><span class=\"line\">echo &quot;备份默认配置&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">cp &#x2F;etc&#x2F;openldap&#x2F;slapd.d&#x2F;cn\\&#x3D;config&#x2F;olcDatabase\\&#x3D;\\&#123;2\\&#125;hdb.ldif &#x2F;etc&#x2F;openldap&#x2F;slapd.d&#x2F;cn\\&#x3D;config&#x2F;olcDatabase\\&#x3D;\\&#123;2\\&#125;hdb.ldif.bak</span><br><span class=\"line\"></span><br><span class=\"line\">echo &quot;将要修改的内容：&quot;</span><br><span class=\"line\">cat tmp.ldif</span><br><span class=\"line\"></span><br><span class=\"line\">ldapmodify -Q -Y EXTERNAL -H ldapi:&#x2F;&#x2F;&#x2F; -f tmp.ldif</span><br><span class=\"line\"></span><br><span class=\"line\">echo &quot;修改后的变化&quot;</span><br><span class=\"line\">diff &#x2F;etc&#x2F;openldap&#x2F;slapd.d&#x2F;cn\\&#x3D;config&#x2F;olcDatabase\\&#x3D;\\&#123;2\\&#125;hdb.ldif &#x2F;etc&#x2F;openldap&#x2F;slapd.d&#x2F;cn\\&#x3D;config&#x2F;olcDatabase\\&#x3D;\\&#123;2\\&#125;hdb.ldif.bak</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><code>slappasswd -s admin</code> 获取加密后的密码</li>\n<li>备份原始文件</li>\n<li>ldapmodify 更新命令， -H指定host，这里<code>ldapi:///</code>表示IPC (Unix-domain socket)协议， -f指定变更的内容。 命令文档: <a href=\"http://man7.org/linux/man-pages/man1/ldapmodify.1.html\">http://man7.org/linux/man-pages/man1/ldapmodify.1.html</a></li>\n</ul>\n<p>使用脚本进行变更，而不是直接命令行交互式变更，这样可以更容易梳理变更逻辑, 而且可以重复使用。</p>\n<h3 id=\"配置OpenLDAP数据库\"><a href=\"#配置OpenLDAP数据库\" class=\"headerlink\" title=\"配置OpenLDAP数据库\"></a>配置OpenLDAP数据库</h3><h5 id=\"a、OpenLDAP默认使用的数据库是BerkeleyDB，现在来开始配置OpenLDAP数据库\"><a href=\"#a、OpenLDAP默认使用的数据库是BerkeleyDB，现在来开始配置OpenLDAP数据库\" class=\"headerlink\" title=\"a、OpenLDAP默认使用的数据库是BerkeleyDB，现在来开始配置OpenLDAP数据库\"></a>a、OpenLDAP默认使用的数据库是BerkeleyDB，现在来开始配置OpenLDAP数据库</h5><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cp &#x2F;usr&#x2F;share&#x2F;openldap-servers&#x2F;DB_CONFIG.example &#x2F;var&#x2F;lib&#x2F;ldap&#x2F;DB_CONFIG</span><br><span class=\"line\">chown ldap:ldap -R &#x2F;var&#x2F;lib&#x2F;ldap</span><br><span class=\"line\">chmod 700 -R &#x2F;var&#x2F;lib&#x2F;ldap</span><br><span class=\"line\">ll &#x2F;var&#x2F;lib&#x2F;ldap&#x2F;</span><br></pre></td></tr></table></figure>\n\n<p>注意：/var/lib/ldap/就是BerkeleyDB数据库默认存储的路径。</p>\n<h5 id=\"b、导入基本Schema\"><a href=\"#b、导入基本Schema\" class=\"headerlink\" title=\"b、导入基本Schema\"></a>b、导入基本Schema</h5><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ldapadd -Y EXTERNAL -H ldapi:&#x2F;&#x2F;&#x2F; -f &#x2F;etc&#x2F;openldap&#x2F;schema&#x2F;cosine.ldif</span><br><span class=\"line\">ldapadd -Y EXTERNAL -H ldapi:&#x2F;&#x2F;&#x2F; -f &#x2F;etc&#x2F;openldap&#x2F;schema&#x2F;nis.ldif</span><br><span class=\"line\">ldapadd -Y EXTERNAL -H ldapi:&#x2F;&#x2F;&#x2F; -f &#x2F;etc&#x2F;openldap&#x2F;schema&#x2F;inetorgperson.ldif</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"c、修改migrate-common-ph文件\"><a href=\"#c、修改migrate-common-ph文件\" class=\"headerlink\" title=\"c、修改migrate_common.ph文件\"></a>c、修改migrate_common.ph文件</h5><p>migrate_common.ph文件主要是用于生成ldif文件使用，修改migrate_common.ph文件</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim &#x2F;usr&#x2F;share&#x2F;migrationtools&#x2F;migrate_common.ph    71行左右</span><br><span class=\"line\"></span><br><span class=\"line\">$DEFAULT_MAIL_DOMAIN &#x3D; “ops.com”;</span><br><span class=\"line\">$DEFAULT_BASE &#x3D; “dc&#x3D;ops,dc&#x3D;com”;</span><br><span class=\"line\">$EXTENDED_SCHEMA &#x3D; 1;</span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"添加我们的base组织结构\"><a href=\"#添加我们的base组织结构\" class=\"headerlink\" title=\"添加我们的base组织结构\"></a>添加我们的base组织结构</h4><p>创建文件base.ldif</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">dn: dc&#x3D;ops,dc&#x3D;com</span><br><span class=\"line\">objectClass: top</span><br><span class=\"line\">objectClass: dcObject</span><br><span class=\"line\">objectClass: organization</span><br><span class=\"line\">o: ldap测试组织</span><br><span class=\"line\">dc: demo</span><br><span class=\"line\"></span><br><span class=\"line\">dn: cn&#x3D;admin,dc&#x3D;ops,dc&#x3D;com</span><br><span class=\"line\">objectClass: organizationalRole</span><br><span class=\"line\">cn: Manager</span><br><span class=\"line\">description: 组织管理人</span><br><span class=\"line\"></span><br><span class=\"line\">dn: ou&#x3D;People,dc&#x3D;demo,dc&#x3D;com</span><br><span class=\"line\">objectClass: organizationalUnit</span><br><span class=\"line\">ou: People</span><br><span class=\"line\"></span><br><span class=\"line\">dn: ou&#x3D;Group,dc&#x3D;demo,dc&#x3D;com</span><br><span class=\"line\">objectClass: organizationalUnit</span><br><span class=\"line\">ou: Group</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>使用<code>ldapadd</code>添加base:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ldapadd -x -D cn&#x3D;admin,dc&#x3D;demo,dc&#x3D;com -w admin -f base.ldif </span><br></pre></td></tr></table></figure>\n\n<p>使用<code>ldapsearch</code>来检查内容</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@a1791f1044ba data]# ldapsearch -x -D cn&#x3D;admin,dc&#x3D;ops,dc&#x3D;com -w 123456 -b &quot;dc&#x3D;ops,dc&#x3D;com&quot;</span><br><span class=\"line\"># extended LDIF</span><br><span class=\"line\">#</span><br><span class=\"line\"># LDAPv3</span><br><span class=\"line\"># base &lt;dc&#x3D;demo,dc&#x3D;com&gt; with scope subtree</span><br><span class=\"line\"># filter: (objectclass&#x3D;*)</span><br><span class=\"line\"># requesting: ALL</span><br><span class=\"line\">#</span><br><span class=\"line\"></span><br><span class=\"line\"># ops.com</span><br><span class=\"line\">dn: dc&#x3D;ops,dc&#x3D;com</span><br><span class=\"line\">objectClass: top</span><br><span class=\"line\">objectClass: dcObject</span><br><span class=\"line\">objectClass: organization</span><br><span class=\"line\">o:: bGRhcOa1i+ivlee7hOe7hw&#x3D;&#x3D;</span><br><span class=\"line\">dc: demo</span><br><span class=\"line\"></span><br><span class=\"line\"># Manager, demo.com</span><br><span class=\"line\">dn: cn&#x3D;Manager,dc&#x3D;demo,dc&#x3D;com</span><br><span class=\"line\">objectClass: organizationalRole</span><br><span class=\"line\">cn: Manager</span><br><span class=\"line\">description:: 57uE57uH566h55CG5Lq6</span><br><span class=\"line\"></span><br><span class=\"line\"># People, demo.com</span><br><span class=\"line\">dn: ou&#x3D;People,dc&#x3D;demo,dc&#x3D;com</span><br><span class=\"line\">objectClass: organizationalUnit</span><br><span class=\"line\">ou: People</span><br><span class=\"line\"></span><br><span class=\"line\"># Group, demo.com</span><br><span class=\"line\">dn: ou&#x3D;Group,dc&#x3D;demo,dc&#x3D;com</span><br><span class=\"line\">objectClass: organizationalUnit</span><br><span class=\"line\">ou: Group</span><br><span class=\"line\"></span><br><span class=\"line\"># search result</span><br><span class=\"line\">search: 2</span><br><span class=\"line\">result: 0 Success</span><br><span class=\"line\"></span><br><span class=\"line\"># numResponses: 5</span><br><span class=\"line\"># numEntries: 4</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"添加用户\"><a href=\"#添加用户\" class=\"headerlink\" title=\"添加用户\"></a>添加用户</h4><p>添加人员对应的是树的叶子节点，使用的  <code>oebjectClass： inetOrgPerson</code>。</p>\n<p>添加组织部门对应的是目录，使用的  <code>objectClass: organizationalUnit</code>.</p>\n"},{"title":"centos7 双网卡配置","date":"2021-08-16T07:59:00.000Z","_content":"\t\n\t\n摘要: centos7双网卡配置\n<!-- more -->\n\n## 前言\n有个需求是要在服务器上配置双网卡、双IP、双网卡\n一般在多网卡的网络访问关系中我们通常根据目标IP地址段来添加静态路由表，在主机系统配置层面这个需求一般都比较简单也不需要使用非常复杂的命令\n\n\n## 静态路由表和策略路由的区别\n通常我们维护静态路由表会手工填写所有IP地址段的路由规则，使用命令或者写入配置文件永久生效，先以Windows/Linux/AIX常用方法为例\n\n```\n#Windows静态路由\n--键入 route -p add [目标] [mask <网络掩码>] [网关] [metric <度量值>] [if <接口>]\nroute print\nroute delete\nroute -p add 172.16.19.0 mask 255.255.255.0 198.15.0.1\n\n#RHEL静态路由\nvi /etc/sysconfig/network\ndefault via 192.168.3.1 dev eth0\n10.211.6.0/24 via 192.168.3.1 dev eth0\n10.0.0.0/8 via 10.212.52.1 dev eth1\n\n#SuSE静态路由\nvi /etc/sysconfig/network/routes\ndefault 192.168.3.1 - -\n10.211.6.0 192.168.3.1 255.255.255.0 eth0\n10.0.0.0 10.212.52.1 255.0.0.0 eth1\n\n#AIX静态路由\nsmitty mkroute\n172.20.14.0/24 gw 172.23.14.254\n```\n\n这种办法针对少量的规则还可以轻松应对，但规则一旦增加麻烦也就接踵而至，网段地址不断变化就必须及时更新路由表，否则其他用户就无法访问。如果可以根据用户访问进来的路径设定策略路由就会方便很多，而rt_tables就是为此而生。\n\n\n## rt_tables\nrt_tables 简单来说就是通过给表的命名使得管理简单化。\n\n大部分人习惯直接将路由表优先级号码直接作为表的名称来使用，这样做的好处是非常直观和简明的表达了表所在优先级的位置，但是当表的优先级结构出现变动时，我们对巨大的路由表的修改就显得很烦琐和费事了。\n\n在/etc/iproute2/目录下,有这么一个文件rt_tables,只要对它进行改动，我们将很容易的完成路由表优先级结构的变动。(数值越小优先级别越高)\n\n当路由表的优先级发生变化的时候，我们只需要编辑/etc/iproute2/rt_tables这个文件就可以直接改变路由表的优先级次序。\n\n```\ncat /etc/iproute2/rt_tables\n\n#\n# reserved values\n#\n255    local\n254    main\n253    default\n0    unspec\n#\n# local\n#\n#1    inr.ruhep\n```\n\nLinux最多可以支持255张路由表，其中有3张表是内置的：\n```\n表255 本地路由表（Local table） 本地接口地址，广播地址，已及NAT地址都放在这个表。该路由表由系统自动维护，管理员不能直接修改。\n\n表254 主路由表（Main table） 如果没有指明路由所属的表，所有的路由都默认都放在这个表里，一般来说，旧的路由工具（如route）所添加的路由都会加到这个表。一般是普通的路由。\n\n表253 默认路由表 （Default table） 一般来说默认的路由都放在这张表，但是如果特别指明放的也可以是所有的网关路由。\n```\n表 0 保留。\n\n## 策略性路由应用及分析(iproute2)\n### 策略性路由\n策略性是指对于IP包的路由是以网络管理员根据需要定下的一些策略为主要依据进行路由的。例如我们可以有这样的策略：“所有来直自网A的包，选择X路径；其他选择Y路径”，或者是“所有TOS为A的包选择路径F；其他选者路径K”。\n\nCisco 的网络操作系统 (Cisco IOS) 从11.0开始就采用新的策略性路由机制。而Linux是在内核2.1开始采用策略性路由机制的。策略性路由机制与传统的路由算法相比主要是引入了多路由表以及规则的概念。\n\n### 多路由表（multiple Routing Tables）\n传统的路由算法是仅使用一张路由表的。但是在有些情形底下，我们是需要使用多路由表的。例如一个子网通过一个路由器与外界相连，路由器与外界有两条线路相连，其中一条的速度比较快，一条的速度比较慢。对于子网内的大多数用户来说对速度并没有特殊的要求，所以可以让他们用比较慢的路由；但是子网内有一些特殊的用户却是对速度的要求比较苛刻，所以他们需要使用速度比较快的路由。如果使用一张路由表上述要求是无法实现的，而如果根据源地址或其它参数，对不同的用户使用不同的路由表，这样就可以大大提高路由器的性能。\n\n### 规则（rule）\n规则是策略性的关键性的新的概念。我们可以用自然语言这样描述规则，例如我门可以指定这样的规则：\n\n- 规则一：“所有来自192.16.152.24的IP包，使用路由表10， 本规则的优先级别是1500”\n\n- 规则二：“所有的包，使用路由表253，本规则的优先级别是32767”\n\n我们可以看到，规则包含3个要素：\n\n- 什么样的包，将应用本规则（所谓的SELECTOR，可能是filter更能反映其作用）；\n\n- 符合本规则的包将对其采取什么动作（ACTION），例如用那个表；\n\n- 本规则的优先级别。优先级别越高的规则越先匹配（数值越小优先级别越高）。\n\n\n\n## 环境配置\n服务器A和B为双网卡，操作系统为 rhel_7.1_64\n\n|网卡显示名称 |\tIP地址\t| 子网掩码 |\t网关 |\t备注| \n|---|---|---|---|\n|ens192\t| 172.31.192.201 |\t255.255.255.0 |\t172.31.192.1\t| 服务器A|\n|ens224 |\t10.200.88.201 |\t255.255.252.0 |\t10.200.88.1 |\t服务器A |\n|ens192\t| 172.31.192.202 | 255.255.255.0 | 172.31.192.1 | 服务器B |\n|ens224 |\t10.200.88.202 | 255.255.252.0 | 10.200.88.1 | 服务器B |\n| /\t| 172.25.168.44 |\t255.255.255.0 |\t172.25.168.254 |\t接入测试|\n\n\n### 网络配置，以服务器A为例，注意注释默认网关\nvim /etc/sysconfig/network-scripts/ifcfg-ens192\n```\nDEVICE=ens192\nONBOOT=yes\nBOOTPROTO=static\nTYPE=Ethernet\nIPADDR=172.31.192.201\nNETMASK=255.255.255.0\n#GATEWAY=172.31.192.1\n```\n\ncat /etc/sysconfig/network-scripts/ifcfg-ens224\n```\nDEVICE=ens224\nONBOOT=yes\nBOOTPROTO=static\nTYPE=Ethernet\nIPADDR=10.200.88.201\nNETMASK=255.255.252.0\n#GATEWAY=10.200.88.1\n```\n\n## 策略路由配置\n注意配置名称一定要吻合,\n手动添加静态路由, 从哪里进来就从哪里出去, 本机出去的走默认网关\n```\n#编辑rt_tables ,  自定义, 不重复即可\necho \"172 net172 \" >> /etc/iproute2/rt_tables\necho \"10 net10 \" >> /etc/iproute2/rt_tables\n\n\n#清空net172路由表\nip route flush table net172\n\n# 添加一个路由规则到 net172 表，这条规则是 net172 这个路由表中数据包默认使用源 IP 172.31.192.201 通过 ens192 走网关 172.31.192.1\nip route add default via 172.31.192.1 dev ens192 src 172.31.192.201 table net172\n\n#来自 172.31.192.201 的数据包，使用 net172 路由表的路由规则\nip rule add from 172.31.192.201 table net172\n\n#清空 net10 路由表\nip route flush table net10\n\n#添加一个路由规则到 net10 表，这条规则是 net10 这个路由表中数据包默认使用源 IP \t10.200.88.201 通过 ens224 走网关 \t10.200.88.1\nip route add default via \t10.200.88.1 dev ens224 src \t10.200.88.201 table net10\n\n#来自 \t10.200.88.201 的数据包，使用 net10 路由表的路由规则\nip rule add from \t10.200.88.201 table net10\n\n#添加默认网关\nroute add default gw \t10.200.88.1\n\n```\n\n重启会失效！！！\n\n\n#如果需要自启动生效可以写进配置文件也可以加入rc.local\n```\nvi /etc/rc.local\n\nip route flush table net172\nip route add default via 172.31.192.1 dev ens4f0 src 172.31.192.201 table net172\nip rule add from 172.31.192.201 table net172\nip route flush table net10\nip route add default via 10.200.88.1 dev ens9f0 src 10.200.88.201 table net10\nip rule add from 10.200.88.201 table net10\nroute add default gw 10.200.88.1\n```\n\n\n## 查看路由表\n```\nroute -n\n\nKernel IP routing table\nDestination     Gateway         Genmask         Flags Metric Ref    Use Iface\n169.254.0.0     0.0.0.0         255.255.0.0     U     1006   0        0 ens192\n169.254.0.0     0.0.0.0         255.255.0.0     U     1008   0        0 ens224\n169.254.0.0     0.0.0.0         255.255.0.0     U     1014   0        0 br-ex\n169.254.0.0     0.0.0.0         255.255.0.0     U     1015   0        0 br-int\n172.31.192.0    0.0.0.0         255.255.255.0   U     0      0        0 ens192\n10.200.88.0    0.0.0.0         255.255.252.0   U     0      0        0 ens224\n\n#在接入测试服务器上验证连通性\nping 172.31.192.201\nping 172.31.196.1\n\n```\n\n","source":"_posts/linux/centos7双网卡.md","raw":"---\ntitle: centos7 双网卡配置\ndate: 2021-08-16 15:59\ncategories:\n- linux\ntags:\n- network\n---\n\t\n\t\n摘要: centos7双网卡配置\n<!-- more -->\n\n## 前言\n有个需求是要在服务器上配置双网卡、双IP、双网卡\n一般在多网卡的网络访问关系中我们通常根据目标IP地址段来添加静态路由表，在主机系统配置层面这个需求一般都比较简单也不需要使用非常复杂的命令\n\n\n## 静态路由表和策略路由的区别\n通常我们维护静态路由表会手工填写所有IP地址段的路由规则，使用命令或者写入配置文件永久生效，先以Windows/Linux/AIX常用方法为例\n\n```\n#Windows静态路由\n--键入 route -p add [目标] [mask <网络掩码>] [网关] [metric <度量值>] [if <接口>]\nroute print\nroute delete\nroute -p add 172.16.19.0 mask 255.255.255.0 198.15.0.1\n\n#RHEL静态路由\nvi /etc/sysconfig/network\ndefault via 192.168.3.1 dev eth0\n10.211.6.0/24 via 192.168.3.1 dev eth0\n10.0.0.0/8 via 10.212.52.1 dev eth1\n\n#SuSE静态路由\nvi /etc/sysconfig/network/routes\ndefault 192.168.3.1 - -\n10.211.6.0 192.168.3.1 255.255.255.0 eth0\n10.0.0.0 10.212.52.1 255.0.0.0 eth1\n\n#AIX静态路由\nsmitty mkroute\n172.20.14.0/24 gw 172.23.14.254\n```\n\n这种办法针对少量的规则还可以轻松应对，但规则一旦增加麻烦也就接踵而至，网段地址不断变化就必须及时更新路由表，否则其他用户就无法访问。如果可以根据用户访问进来的路径设定策略路由就会方便很多，而rt_tables就是为此而生。\n\n\n## rt_tables\nrt_tables 简单来说就是通过给表的命名使得管理简单化。\n\n大部分人习惯直接将路由表优先级号码直接作为表的名称来使用，这样做的好处是非常直观和简明的表达了表所在优先级的位置，但是当表的优先级结构出现变动时，我们对巨大的路由表的修改就显得很烦琐和费事了。\n\n在/etc/iproute2/目录下,有这么一个文件rt_tables,只要对它进行改动，我们将很容易的完成路由表优先级结构的变动。(数值越小优先级别越高)\n\n当路由表的优先级发生变化的时候，我们只需要编辑/etc/iproute2/rt_tables这个文件就可以直接改变路由表的优先级次序。\n\n```\ncat /etc/iproute2/rt_tables\n\n#\n# reserved values\n#\n255    local\n254    main\n253    default\n0    unspec\n#\n# local\n#\n#1    inr.ruhep\n```\n\nLinux最多可以支持255张路由表，其中有3张表是内置的：\n```\n表255 本地路由表（Local table） 本地接口地址，广播地址，已及NAT地址都放在这个表。该路由表由系统自动维护，管理员不能直接修改。\n\n表254 主路由表（Main table） 如果没有指明路由所属的表，所有的路由都默认都放在这个表里，一般来说，旧的路由工具（如route）所添加的路由都会加到这个表。一般是普通的路由。\n\n表253 默认路由表 （Default table） 一般来说默认的路由都放在这张表，但是如果特别指明放的也可以是所有的网关路由。\n```\n表 0 保留。\n\n## 策略性路由应用及分析(iproute2)\n### 策略性路由\n策略性是指对于IP包的路由是以网络管理员根据需要定下的一些策略为主要依据进行路由的。例如我们可以有这样的策略：“所有来直自网A的包，选择X路径；其他选择Y路径”，或者是“所有TOS为A的包选择路径F；其他选者路径K”。\n\nCisco 的网络操作系统 (Cisco IOS) 从11.0开始就采用新的策略性路由机制。而Linux是在内核2.1开始采用策略性路由机制的。策略性路由机制与传统的路由算法相比主要是引入了多路由表以及规则的概念。\n\n### 多路由表（multiple Routing Tables）\n传统的路由算法是仅使用一张路由表的。但是在有些情形底下，我们是需要使用多路由表的。例如一个子网通过一个路由器与外界相连，路由器与外界有两条线路相连，其中一条的速度比较快，一条的速度比较慢。对于子网内的大多数用户来说对速度并没有特殊的要求，所以可以让他们用比较慢的路由；但是子网内有一些特殊的用户却是对速度的要求比较苛刻，所以他们需要使用速度比较快的路由。如果使用一张路由表上述要求是无法实现的，而如果根据源地址或其它参数，对不同的用户使用不同的路由表，这样就可以大大提高路由器的性能。\n\n### 规则（rule）\n规则是策略性的关键性的新的概念。我们可以用自然语言这样描述规则，例如我门可以指定这样的规则：\n\n- 规则一：“所有来自192.16.152.24的IP包，使用路由表10， 本规则的优先级别是1500”\n\n- 规则二：“所有的包，使用路由表253，本规则的优先级别是32767”\n\n我们可以看到，规则包含3个要素：\n\n- 什么样的包，将应用本规则（所谓的SELECTOR，可能是filter更能反映其作用）；\n\n- 符合本规则的包将对其采取什么动作（ACTION），例如用那个表；\n\n- 本规则的优先级别。优先级别越高的规则越先匹配（数值越小优先级别越高）。\n\n\n\n## 环境配置\n服务器A和B为双网卡，操作系统为 rhel_7.1_64\n\n|网卡显示名称 |\tIP地址\t| 子网掩码 |\t网关 |\t备注| \n|---|---|---|---|\n|ens192\t| 172.31.192.201 |\t255.255.255.0 |\t172.31.192.1\t| 服务器A|\n|ens224 |\t10.200.88.201 |\t255.255.252.0 |\t10.200.88.1 |\t服务器A |\n|ens192\t| 172.31.192.202 | 255.255.255.0 | 172.31.192.1 | 服务器B |\n|ens224 |\t10.200.88.202 | 255.255.252.0 | 10.200.88.1 | 服务器B |\n| /\t| 172.25.168.44 |\t255.255.255.0 |\t172.25.168.254 |\t接入测试|\n\n\n### 网络配置，以服务器A为例，注意注释默认网关\nvim /etc/sysconfig/network-scripts/ifcfg-ens192\n```\nDEVICE=ens192\nONBOOT=yes\nBOOTPROTO=static\nTYPE=Ethernet\nIPADDR=172.31.192.201\nNETMASK=255.255.255.0\n#GATEWAY=172.31.192.1\n```\n\ncat /etc/sysconfig/network-scripts/ifcfg-ens224\n```\nDEVICE=ens224\nONBOOT=yes\nBOOTPROTO=static\nTYPE=Ethernet\nIPADDR=10.200.88.201\nNETMASK=255.255.252.0\n#GATEWAY=10.200.88.1\n```\n\n## 策略路由配置\n注意配置名称一定要吻合,\n手动添加静态路由, 从哪里进来就从哪里出去, 本机出去的走默认网关\n```\n#编辑rt_tables ,  自定义, 不重复即可\necho \"172 net172 \" >> /etc/iproute2/rt_tables\necho \"10 net10 \" >> /etc/iproute2/rt_tables\n\n\n#清空net172路由表\nip route flush table net172\n\n# 添加一个路由规则到 net172 表，这条规则是 net172 这个路由表中数据包默认使用源 IP 172.31.192.201 通过 ens192 走网关 172.31.192.1\nip route add default via 172.31.192.1 dev ens192 src 172.31.192.201 table net172\n\n#来自 172.31.192.201 的数据包，使用 net172 路由表的路由规则\nip rule add from 172.31.192.201 table net172\n\n#清空 net10 路由表\nip route flush table net10\n\n#添加一个路由规则到 net10 表，这条规则是 net10 这个路由表中数据包默认使用源 IP \t10.200.88.201 通过 ens224 走网关 \t10.200.88.1\nip route add default via \t10.200.88.1 dev ens224 src \t10.200.88.201 table net10\n\n#来自 \t10.200.88.201 的数据包，使用 net10 路由表的路由规则\nip rule add from \t10.200.88.201 table net10\n\n#添加默认网关\nroute add default gw \t10.200.88.1\n\n```\n\n重启会失效！！！\n\n\n#如果需要自启动生效可以写进配置文件也可以加入rc.local\n```\nvi /etc/rc.local\n\nip route flush table net172\nip route add default via 172.31.192.1 dev ens4f0 src 172.31.192.201 table net172\nip rule add from 172.31.192.201 table net172\nip route flush table net10\nip route add default via 10.200.88.1 dev ens9f0 src 10.200.88.201 table net10\nip rule add from 10.200.88.201 table net10\nroute add default gw 10.200.88.1\n```\n\n\n## 查看路由表\n```\nroute -n\n\nKernel IP routing table\nDestination     Gateway         Genmask         Flags Metric Ref    Use Iface\n169.254.0.0     0.0.0.0         255.255.0.0     U     1006   0        0 ens192\n169.254.0.0     0.0.0.0         255.255.0.0     U     1008   0        0 ens224\n169.254.0.0     0.0.0.0         255.255.0.0     U     1014   0        0 br-ex\n169.254.0.0     0.0.0.0         255.255.0.0     U     1015   0        0 br-int\n172.31.192.0    0.0.0.0         255.255.255.0   U     0      0        0 ens192\n10.200.88.0    0.0.0.0         255.255.252.0   U     0      0        0 ens224\n\n#在接入测试服务器上验证连通性\nping 172.31.192.201\nping 172.31.196.1\n\n```\n\n","slug":"linux/centos7双网卡","published":1,"updated":"2021-08-16T09:28:09.811Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cku6979zz005600uh1dn0bvbc","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><p>摘要: centos7双网卡配置</p>\n<span id=\"more\"></span>\n\n<h2 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h2><p>有个需求是要在服务器上配置双网卡、双IP、双网卡<br>一般在多网卡的网络访问关系中我们通常根据目标IP地址段来添加静态路由表，在主机系统配置层面这个需求一般都比较简单也不需要使用非常复杂的命令</p>\n<h2 id=\"静态路由表和策略路由的区别\"><a href=\"#静态路由表和策略路由的区别\" class=\"headerlink\" title=\"静态路由表和策略路由的区别\"></a>静态路由表和策略路由的区别</h2><p>通常我们维护静态路由表会手工填写所有IP地址段的路由规则，使用命令或者写入配置文件永久生效，先以Windows/Linux/AIX常用方法为例</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#Windows静态路由</span><br><span class=\"line\">--键入 route -p add [目标] [mask &lt;网络掩码&gt;] [网关] [metric &lt;度量值&gt;] [if &lt;接口&gt;]</span><br><span class=\"line\">route print</span><br><span class=\"line\">route delete</span><br><span class=\"line\">route -p add 172.16.19.0 mask 255.255.255.0 198.15.0.1</span><br><span class=\"line\"></span><br><span class=\"line\">#RHEL静态路由</span><br><span class=\"line\">vi &#x2F;etc&#x2F;sysconfig&#x2F;network</span><br><span class=\"line\">default via 192.168.3.1 dev eth0</span><br><span class=\"line\">10.211.6.0&#x2F;24 via 192.168.3.1 dev eth0</span><br><span class=\"line\">10.0.0.0&#x2F;8 via 10.212.52.1 dev eth1</span><br><span class=\"line\"></span><br><span class=\"line\">#SuSE静态路由</span><br><span class=\"line\">vi &#x2F;etc&#x2F;sysconfig&#x2F;network&#x2F;routes</span><br><span class=\"line\">default 192.168.3.1 - -</span><br><span class=\"line\">10.211.6.0 192.168.3.1 255.255.255.0 eth0</span><br><span class=\"line\">10.0.0.0 10.212.52.1 255.0.0.0 eth1</span><br><span class=\"line\"></span><br><span class=\"line\">#AIX静态路由</span><br><span class=\"line\">smitty mkroute</span><br><span class=\"line\">172.20.14.0&#x2F;24 gw 172.23.14.254</span><br></pre></td></tr></table></figure>\n\n<p>这种办法针对少量的规则还可以轻松应对，但规则一旦增加麻烦也就接踵而至，网段地址不断变化就必须及时更新路由表，否则其他用户就无法访问。如果可以根据用户访问进来的路径设定策略路由就会方便很多，而rt_tables就是为此而生。</p>\n<h2 id=\"rt-tables\"><a href=\"#rt-tables\" class=\"headerlink\" title=\"rt_tables\"></a>rt_tables</h2><p>rt_tables 简单来说就是通过给表的命名使得管理简单化。</p>\n<p>大部分人习惯直接将路由表优先级号码直接作为表的名称来使用，这样做的好处是非常直观和简明的表达了表所在优先级的位置，但是当表的优先级结构出现变动时，我们对巨大的路由表的修改就显得很烦琐和费事了。</p>\n<p>在/etc/iproute2/目录下,有这么一个文件rt_tables,只要对它进行改动，我们将很容易的完成路由表优先级结构的变动。(数值越小优先级别越高)</p>\n<p>当路由表的优先级发生变化的时候，我们只需要编辑/etc/iproute2/rt_tables这个文件就可以直接改变路由表的优先级次序。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cat &#x2F;etc&#x2F;iproute2&#x2F;rt_tables</span><br><span class=\"line\"></span><br><span class=\"line\">#</span><br><span class=\"line\"># reserved values</span><br><span class=\"line\">#</span><br><span class=\"line\">255    local</span><br><span class=\"line\">254    main</span><br><span class=\"line\">253    default</span><br><span class=\"line\">0    unspec</span><br><span class=\"line\">#</span><br><span class=\"line\"># local</span><br><span class=\"line\">#</span><br><span class=\"line\">#1    inr.ruhep</span><br></pre></td></tr></table></figure>\n\n<p>Linux最多可以支持255张路由表，其中有3张表是内置的：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">表255 本地路由表（Local table） 本地接口地址，广播地址，已及NAT地址都放在这个表。该路由表由系统自动维护，管理员不能直接修改。</span><br><span class=\"line\"></span><br><span class=\"line\">表254 主路由表（Main table） 如果没有指明路由所属的表，所有的路由都默认都放在这个表里，一般来说，旧的路由工具（如route）所添加的路由都会加到这个表。一般是普通的路由。</span><br><span class=\"line\"></span><br><span class=\"line\">表253 默认路由表 （Default table） 一般来说默认的路由都放在这张表，但是如果特别指明放的也可以是所有的网关路由。</span><br></pre></td></tr></table></figure>\n<p>表 0 保留。</p>\n<h2 id=\"策略性路由应用及分析-iproute2\"><a href=\"#策略性路由应用及分析-iproute2\" class=\"headerlink\" title=\"策略性路由应用及分析(iproute2)\"></a>策略性路由应用及分析(iproute2)</h2><h3 id=\"策略性路由\"><a href=\"#策略性路由\" class=\"headerlink\" title=\"策略性路由\"></a>策略性路由</h3><p>策略性是指对于IP包的路由是以网络管理员根据需要定下的一些策略为主要依据进行路由的。例如我们可以有这样的策略：“所有来直自网A的包，选择X路径；其他选择Y路径”，或者是“所有TOS为A的包选择路径F；其他选者路径K”。</p>\n<p>Cisco 的网络操作系统 (Cisco IOS) 从11.0开始就采用新的策略性路由机制。而Linux是在内核2.1开始采用策略性路由机制的。策略性路由机制与传统的路由算法相比主要是引入了多路由表以及规则的概念。</p>\n<h3 id=\"多路由表（multiple-Routing-Tables）\"><a href=\"#多路由表（multiple-Routing-Tables）\" class=\"headerlink\" title=\"多路由表（multiple Routing Tables）\"></a>多路由表（multiple Routing Tables）</h3><p>传统的路由算法是仅使用一张路由表的。但是在有些情形底下，我们是需要使用多路由表的。例如一个子网通过一个路由器与外界相连，路由器与外界有两条线路相连，其中一条的速度比较快，一条的速度比较慢。对于子网内的大多数用户来说对速度并没有特殊的要求，所以可以让他们用比较慢的路由；但是子网内有一些特殊的用户却是对速度的要求比较苛刻，所以他们需要使用速度比较快的路由。如果使用一张路由表上述要求是无法实现的，而如果根据源地址或其它参数，对不同的用户使用不同的路由表，这样就可以大大提高路由器的性能。</p>\n<h3 id=\"规则（rule）\"><a href=\"#规则（rule）\" class=\"headerlink\" title=\"规则（rule）\"></a>规则（rule）</h3><p>规则是策略性的关键性的新的概念。我们可以用自然语言这样描述规则，例如我门可以指定这样的规则：</p>\n<ul>\n<li><p>规则一：“所有来自192.16.152.24的IP包，使用路由表10， 本规则的优先级别是1500”</p>\n</li>\n<li><p>规则二：“所有的包，使用路由表253，本规则的优先级别是32767”</p>\n</li>\n</ul>\n<p>我们可以看到，规则包含3个要素：</p>\n<ul>\n<li><p>什么样的包，将应用本规则（所谓的SELECTOR，可能是filter更能反映其作用）；</p>\n</li>\n<li><p>符合本规则的包将对其采取什么动作（ACTION），例如用那个表；</p>\n</li>\n<li><p>本规则的优先级别。优先级别越高的规则越先匹配（数值越小优先级别越高）。</p>\n</li>\n</ul>\n<h2 id=\"环境配置\"><a href=\"#环境配置\" class=\"headerlink\" title=\"环境配置\"></a>环境配置</h2><p>服务器A和B为双网卡，操作系统为 rhel_7.1_64</p>\n<p>|网卡显示名称 |    IP地址    | 子网掩码 |    网关 |    备注|<br>|—|—|—|—|<br>|ens192    | 172.31.192.201 |    255.255.255.0 |    172.31.192.1    | 服务器A|<br>|ens224 |    10.200.88.201 |    255.255.252.0 |    10.200.88.1 |    服务器A |<br>|ens192    | 172.31.192.202 | 255.255.255.0 | 172.31.192.1 | 服务器B |<br>|ens224 |    10.200.88.202 | 255.255.252.0 | 10.200.88.1 | 服务器B |<br>| /    | 172.25.168.44 |    255.255.255.0 |    172.25.168.254 |    接入测试|</p>\n<h3 id=\"网络配置，以服务器A为例，注意注释默认网关\"><a href=\"#网络配置，以服务器A为例，注意注释默认网关\" class=\"headerlink\" title=\"网络配置，以服务器A为例，注意注释默认网关\"></a>网络配置，以服务器A为例，注意注释默认网关</h3><p>vim /etc/sysconfig/network-scripts/ifcfg-ens192</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">DEVICE&#x3D;ens192</span><br><span class=\"line\">ONBOOT&#x3D;yes</span><br><span class=\"line\">BOOTPROTO&#x3D;static</span><br><span class=\"line\">TYPE&#x3D;Ethernet</span><br><span class=\"line\">IPADDR&#x3D;172.31.192.201</span><br><span class=\"line\">NETMASK&#x3D;255.255.255.0</span><br><span class=\"line\">#GATEWAY&#x3D;172.31.192.1</span><br></pre></td></tr></table></figure>\n\n<p>cat /etc/sysconfig/network-scripts/ifcfg-ens224</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">DEVICE&#x3D;ens224</span><br><span class=\"line\">ONBOOT&#x3D;yes</span><br><span class=\"line\">BOOTPROTO&#x3D;static</span><br><span class=\"line\">TYPE&#x3D;Ethernet</span><br><span class=\"line\">IPADDR&#x3D;10.200.88.201</span><br><span class=\"line\">NETMASK&#x3D;255.255.252.0</span><br><span class=\"line\">#GATEWAY&#x3D;10.200.88.1</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"策略路由配置\"><a href=\"#策略路由配置\" class=\"headerlink\" title=\"策略路由配置\"></a>策略路由配置</h2><p>注意配置名称一定要吻合,<br>手动添加静态路由, 从哪里进来就从哪里出去, 本机出去的走默认网关</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#编辑rt_tables ,  自定义, 不重复即可</span><br><span class=\"line\">echo &quot;172 net172 &quot; &gt;&gt; &#x2F;etc&#x2F;iproute2&#x2F;rt_tables</span><br><span class=\"line\">echo &quot;10 net10 &quot; &gt;&gt; &#x2F;etc&#x2F;iproute2&#x2F;rt_tables</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">#清空net172路由表</span><br><span class=\"line\">ip route flush table net172</span><br><span class=\"line\"></span><br><span class=\"line\"># 添加一个路由规则到 net172 表，这条规则是 net172 这个路由表中数据包默认使用源 IP 172.31.192.201 通过 ens192 走网关 172.31.192.1</span><br><span class=\"line\">ip route add default via 172.31.192.1 dev ens192 src 172.31.192.201 table net172</span><br><span class=\"line\"></span><br><span class=\"line\">#来自 172.31.192.201 的数据包，使用 net172 路由表的路由规则</span><br><span class=\"line\">ip rule add from 172.31.192.201 table net172</span><br><span class=\"line\"></span><br><span class=\"line\">#清空 net10 路由表</span><br><span class=\"line\">ip route flush table net10</span><br><span class=\"line\"></span><br><span class=\"line\">#添加一个路由规则到 net10 表，这条规则是 net10 这个路由表中数据包默认使用源 IP \t10.200.88.201 通过 ens224 走网关 \t10.200.88.1</span><br><span class=\"line\">ip route add default via \t10.200.88.1 dev ens224 src \t10.200.88.201 table net10</span><br><span class=\"line\"></span><br><span class=\"line\">#来自 \t10.200.88.201 的数据包，使用 net10 路由表的路由规则</span><br><span class=\"line\">ip rule add from \t10.200.88.201 table net10</span><br><span class=\"line\"></span><br><span class=\"line\">#添加默认网关</span><br><span class=\"line\">route add default gw \t10.200.88.1</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>重启会失效！！！</p>\n<p>#如果需要自启动生效可以写进配置文件也可以加入rc.local</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vi &#x2F;etc&#x2F;rc.local</span><br><span class=\"line\"></span><br><span class=\"line\">ip route flush table net172</span><br><span class=\"line\">ip route add default via 172.31.192.1 dev ens4f0 src 172.31.192.201 table net172</span><br><span class=\"line\">ip rule add from 172.31.192.201 table net172</span><br><span class=\"line\">ip route flush table net10</span><br><span class=\"line\">ip route add default via 10.200.88.1 dev ens9f0 src 10.200.88.201 table net10</span><br><span class=\"line\">ip rule add from 10.200.88.201 table net10</span><br><span class=\"line\">route add default gw 10.200.88.1</span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"查看路由表\"><a href=\"#查看路由表\" class=\"headerlink\" title=\"查看路由表\"></a>查看路由表</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">route -n</span><br><span class=\"line\"></span><br><span class=\"line\">Kernel IP routing table</span><br><span class=\"line\">Destination     Gateway         Genmask         Flags Metric Ref    Use Iface</span><br><span class=\"line\">169.254.0.0     0.0.0.0         255.255.0.0     U     1006   0        0 ens192</span><br><span class=\"line\">169.254.0.0     0.0.0.0         255.255.0.0     U     1008   0        0 ens224</span><br><span class=\"line\">169.254.0.0     0.0.0.0         255.255.0.0     U     1014   0        0 br-ex</span><br><span class=\"line\">169.254.0.0     0.0.0.0         255.255.0.0     U     1015   0        0 br-int</span><br><span class=\"line\">172.31.192.0    0.0.0.0         255.255.255.0   U     0      0        0 ens192</span><br><span class=\"line\">10.200.88.0    0.0.0.0         255.255.252.0   U     0      0        0 ens224</span><br><span class=\"line\"></span><br><span class=\"line\">#在接入测试服务器上验证连通性</span><br><span class=\"line\">ping 172.31.192.201</span><br><span class=\"line\">ping 172.31.196.1</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"<p>摘要: centos7双网卡配置</p>","more":"<h2 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h2><p>有个需求是要在服务器上配置双网卡、双IP、双网卡<br>一般在多网卡的网络访问关系中我们通常根据目标IP地址段来添加静态路由表，在主机系统配置层面这个需求一般都比较简单也不需要使用非常复杂的命令</p>\n<h2 id=\"静态路由表和策略路由的区别\"><a href=\"#静态路由表和策略路由的区别\" class=\"headerlink\" title=\"静态路由表和策略路由的区别\"></a>静态路由表和策略路由的区别</h2><p>通常我们维护静态路由表会手工填写所有IP地址段的路由规则，使用命令或者写入配置文件永久生效，先以Windows/Linux/AIX常用方法为例</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#Windows静态路由</span><br><span class=\"line\">--键入 route -p add [目标] [mask &lt;网络掩码&gt;] [网关] [metric &lt;度量值&gt;] [if &lt;接口&gt;]</span><br><span class=\"line\">route print</span><br><span class=\"line\">route delete</span><br><span class=\"line\">route -p add 172.16.19.0 mask 255.255.255.0 198.15.0.1</span><br><span class=\"line\"></span><br><span class=\"line\">#RHEL静态路由</span><br><span class=\"line\">vi &#x2F;etc&#x2F;sysconfig&#x2F;network</span><br><span class=\"line\">default via 192.168.3.1 dev eth0</span><br><span class=\"line\">10.211.6.0&#x2F;24 via 192.168.3.1 dev eth0</span><br><span class=\"line\">10.0.0.0&#x2F;8 via 10.212.52.1 dev eth1</span><br><span class=\"line\"></span><br><span class=\"line\">#SuSE静态路由</span><br><span class=\"line\">vi &#x2F;etc&#x2F;sysconfig&#x2F;network&#x2F;routes</span><br><span class=\"line\">default 192.168.3.1 - -</span><br><span class=\"line\">10.211.6.0 192.168.3.1 255.255.255.0 eth0</span><br><span class=\"line\">10.0.0.0 10.212.52.1 255.0.0.0 eth1</span><br><span class=\"line\"></span><br><span class=\"line\">#AIX静态路由</span><br><span class=\"line\">smitty mkroute</span><br><span class=\"line\">172.20.14.0&#x2F;24 gw 172.23.14.254</span><br></pre></td></tr></table></figure>\n\n<p>这种办法针对少量的规则还可以轻松应对，但规则一旦增加麻烦也就接踵而至，网段地址不断变化就必须及时更新路由表，否则其他用户就无法访问。如果可以根据用户访问进来的路径设定策略路由就会方便很多，而rt_tables就是为此而生。</p>\n<h2 id=\"rt-tables\"><a href=\"#rt-tables\" class=\"headerlink\" title=\"rt_tables\"></a>rt_tables</h2><p>rt_tables 简单来说就是通过给表的命名使得管理简单化。</p>\n<p>大部分人习惯直接将路由表优先级号码直接作为表的名称来使用，这样做的好处是非常直观和简明的表达了表所在优先级的位置，但是当表的优先级结构出现变动时，我们对巨大的路由表的修改就显得很烦琐和费事了。</p>\n<p>在/etc/iproute2/目录下,有这么一个文件rt_tables,只要对它进行改动，我们将很容易的完成路由表优先级结构的变动。(数值越小优先级别越高)</p>\n<p>当路由表的优先级发生变化的时候，我们只需要编辑/etc/iproute2/rt_tables这个文件就可以直接改变路由表的优先级次序。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cat &#x2F;etc&#x2F;iproute2&#x2F;rt_tables</span><br><span class=\"line\"></span><br><span class=\"line\">#</span><br><span class=\"line\"># reserved values</span><br><span class=\"line\">#</span><br><span class=\"line\">255    local</span><br><span class=\"line\">254    main</span><br><span class=\"line\">253    default</span><br><span class=\"line\">0    unspec</span><br><span class=\"line\">#</span><br><span class=\"line\"># local</span><br><span class=\"line\">#</span><br><span class=\"line\">#1    inr.ruhep</span><br></pre></td></tr></table></figure>\n\n<p>Linux最多可以支持255张路由表，其中有3张表是内置的：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">表255 本地路由表（Local table） 本地接口地址，广播地址，已及NAT地址都放在这个表。该路由表由系统自动维护，管理员不能直接修改。</span><br><span class=\"line\"></span><br><span class=\"line\">表254 主路由表（Main table） 如果没有指明路由所属的表，所有的路由都默认都放在这个表里，一般来说，旧的路由工具（如route）所添加的路由都会加到这个表。一般是普通的路由。</span><br><span class=\"line\"></span><br><span class=\"line\">表253 默认路由表 （Default table） 一般来说默认的路由都放在这张表，但是如果特别指明放的也可以是所有的网关路由。</span><br></pre></td></tr></table></figure>\n<p>表 0 保留。</p>\n<h2 id=\"策略性路由应用及分析-iproute2\"><a href=\"#策略性路由应用及分析-iproute2\" class=\"headerlink\" title=\"策略性路由应用及分析(iproute2)\"></a>策略性路由应用及分析(iproute2)</h2><h3 id=\"策略性路由\"><a href=\"#策略性路由\" class=\"headerlink\" title=\"策略性路由\"></a>策略性路由</h3><p>策略性是指对于IP包的路由是以网络管理员根据需要定下的一些策略为主要依据进行路由的。例如我们可以有这样的策略：“所有来直自网A的包，选择X路径；其他选择Y路径”，或者是“所有TOS为A的包选择路径F；其他选者路径K”。</p>\n<p>Cisco 的网络操作系统 (Cisco IOS) 从11.0开始就采用新的策略性路由机制。而Linux是在内核2.1开始采用策略性路由机制的。策略性路由机制与传统的路由算法相比主要是引入了多路由表以及规则的概念。</p>\n<h3 id=\"多路由表（multiple-Routing-Tables）\"><a href=\"#多路由表（multiple-Routing-Tables）\" class=\"headerlink\" title=\"多路由表（multiple Routing Tables）\"></a>多路由表（multiple Routing Tables）</h3><p>传统的路由算法是仅使用一张路由表的。但是在有些情形底下，我们是需要使用多路由表的。例如一个子网通过一个路由器与外界相连，路由器与外界有两条线路相连，其中一条的速度比较快，一条的速度比较慢。对于子网内的大多数用户来说对速度并没有特殊的要求，所以可以让他们用比较慢的路由；但是子网内有一些特殊的用户却是对速度的要求比较苛刻，所以他们需要使用速度比较快的路由。如果使用一张路由表上述要求是无法实现的，而如果根据源地址或其它参数，对不同的用户使用不同的路由表，这样就可以大大提高路由器的性能。</p>\n<h3 id=\"规则（rule）\"><a href=\"#规则（rule）\" class=\"headerlink\" title=\"规则（rule）\"></a>规则（rule）</h3><p>规则是策略性的关键性的新的概念。我们可以用自然语言这样描述规则，例如我门可以指定这样的规则：</p>\n<ul>\n<li><p>规则一：“所有来自192.16.152.24的IP包，使用路由表10， 本规则的优先级别是1500”</p>\n</li>\n<li><p>规则二：“所有的包，使用路由表253，本规则的优先级别是32767”</p>\n</li>\n</ul>\n<p>我们可以看到，规则包含3个要素：</p>\n<ul>\n<li><p>什么样的包，将应用本规则（所谓的SELECTOR，可能是filter更能反映其作用）；</p>\n</li>\n<li><p>符合本规则的包将对其采取什么动作（ACTION），例如用那个表；</p>\n</li>\n<li><p>本规则的优先级别。优先级别越高的规则越先匹配（数值越小优先级别越高）。</p>\n</li>\n</ul>\n<h2 id=\"环境配置\"><a href=\"#环境配置\" class=\"headerlink\" title=\"环境配置\"></a>环境配置</h2><p>服务器A和B为双网卡，操作系统为 rhel_7.1_64</p>\n<p>|网卡显示名称 |    IP地址    | 子网掩码 |    网关 |    备注|<br>|—|—|—|—|<br>|ens192    | 172.31.192.201 |    255.255.255.0 |    172.31.192.1    | 服务器A|<br>|ens224 |    10.200.88.201 |    255.255.252.0 |    10.200.88.1 |    服务器A |<br>|ens192    | 172.31.192.202 | 255.255.255.0 | 172.31.192.1 | 服务器B |<br>|ens224 |    10.200.88.202 | 255.255.252.0 | 10.200.88.1 | 服务器B |<br>| /    | 172.25.168.44 |    255.255.255.0 |    172.25.168.254 |    接入测试|</p>\n<h3 id=\"网络配置，以服务器A为例，注意注释默认网关\"><a href=\"#网络配置，以服务器A为例，注意注释默认网关\" class=\"headerlink\" title=\"网络配置，以服务器A为例，注意注释默认网关\"></a>网络配置，以服务器A为例，注意注释默认网关</h3><p>vim /etc/sysconfig/network-scripts/ifcfg-ens192</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">DEVICE&#x3D;ens192</span><br><span class=\"line\">ONBOOT&#x3D;yes</span><br><span class=\"line\">BOOTPROTO&#x3D;static</span><br><span class=\"line\">TYPE&#x3D;Ethernet</span><br><span class=\"line\">IPADDR&#x3D;172.31.192.201</span><br><span class=\"line\">NETMASK&#x3D;255.255.255.0</span><br><span class=\"line\">#GATEWAY&#x3D;172.31.192.1</span><br></pre></td></tr></table></figure>\n\n<p>cat /etc/sysconfig/network-scripts/ifcfg-ens224</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">DEVICE&#x3D;ens224</span><br><span class=\"line\">ONBOOT&#x3D;yes</span><br><span class=\"line\">BOOTPROTO&#x3D;static</span><br><span class=\"line\">TYPE&#x3D;Ethernet</span><br><span class=\"line\">IPADDR&#x3D;10.200.88.201</span><br><span class=\"line\">NETMASK&#x3D;255.255.252.0</span><br><span class=\"line\">#GATEWAY&#x3D;10.200.88.1</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"策略路由配置\"><a href=\"#策略路由配置\" class=\"headerlink\" title=\"策略路由配置\"></a>策略路由配置</h2><p>注意配置名称一定要吻合,<br>手动添加静态路由, 从哪里进来就从哪里出去, 本机出去的走默认网关</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#编辑rt_tables ,  自定义, 不重复即可</span><br><span class=\"line\">echo &quot;172 net172 &quot; &gt;&gt; &#x2F;etc&#x2F;iproute2&#x2F;rt_tables</span><br><span class=\"line\">echo &quot;10 net10 &quot; &gt;&gt; &#x2F;etc&#x2F;iproute2&#x2F;rt_tables</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">#清空net172路由表</span><br><span class=\"line\">ip route flush table net172</span><br><span class=\"line\"></span><br><span class=\"line\"># 添加一个路由规则到 net172 表，这条规则是 net172 这个路由表中数据包默认使用源 IP 172.31.192.201 通过 ens192 走网关 172.31.192.1</span><br><span class=\"line\">ip route add default via 172.31.192.1 dev ens192 src 172.31.192.201 table net172</span><br><span class=\"line\"></span><br><span class=\"line\">#来自 172.31.192.201 的数据包，使用 net172 路由表的路由规则</span><br><span class=\"line\">ip rule add from 172.31.192.201 table net172</span><br><span class=\"line\"></span><br><span class=\"line\">#清空 net10 路由表</span><br><span class=\"line\">ip route flush table net10</span><br><span class=\"line\"></span><br><span class=\"line\">#添加一个路由规则到 net10 表，这条规则是 net10 这个路由表中数据包默认使用源 IP \t10.200.88.201 通过 ens224 走网关 \t10.200.88.1</span><br><span class=\"line\">ip route add default via \t10.200.88.1 dev ens224 src \t10.200.88.201 table net10</span><br><span class=\"line\"></span><br><span class=\"line\">#来自 \t10.200.88.201 的数据包，使用 net10 路由表的路由规则</span><br><span class=\"line\">ip rule add from \t10.200.88.201 table net10</span><br><span class=\"line\"></span><br><span class=\"line\">#添加默认网关</span><br><span class=\"line\">route add default gw \t10.200.88.1</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>重启会失效！！！</p>\n<p>#如果需要自启动生效可以写进配置文件也可以加入rc.local</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vi &#x2F;etc&#x2F;rc.local</span><br><span class=\"line\"></span><br><span class=\"line\">ip route flush table net172</span><br><span class=\"line\">ip route add default via 172.31.192.1 dev ens4f0 src 172.31.192.201 table net172</span><br><span class=\"line\">ip rule add from 172.31.192.201 table net172</span><br><span class=\"line\">ip route flush table net10</span><br><span class=\"line\">ip route add default via 10.200.88.1 dev ens9f0 src 10.200.88.201 table net10</span><br><span class=\"line\">ip rule add from 10.200.88.201 table net10</span><br><span class=\"line\">route add default gw 10.200.88.1</span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"查看路由表\"><a href=\"#查看路由表\" class=\"headerlink\" title=\"查看路由表\"></a>查看路由表</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">route -n</span><br><span class=\"line\"></span><br><span class=\"line\">Kernel IP routing table</span><br><span class=\"line\">Destination     Gateway         Genmask         Flags Metric Ref    Use Iface</span><br><span class=\"line\">169.254.0.0     0.0.0.0         255.255.0.0     U     1006   0        0 ens192</span><br><span class=\"line\">169.254.0.0     0.0.0.0         255.255.0.0     U     1008   0        0 ens224</span><br><span class=\"line\">169.254.0.0     0.0.0.0         255.255.0.0     U     1014   0        0 br-ex</span><br><span class=\"line\">169.254.0.0     0.0.0.0         255.255.0.0     U     1015   0        0 br-int</span><br><span class=\"line\">172.31.192.0    0.0.0.0         255.255.255.0   U     0      0        0 ens192</span><br><span class=\"line\">10.200.88.0    0.0.0.0         255.255.252.0   U     0      0        0 ens224</span><br><span class=\"line\"></span><br><span class=\"line\">#在接入测试服务器上验证连通性</span><br><span class=\"line\">ping 172.31.192.201</span><br><span class=\"line\">ping 172.31.196.1</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>"},{"title":"linux 非lvm分区扩容","date":"2021-09-17T03:24:00.000Z","_content":"\t\n\t\n摘要: linux 非lvm分区扩容\n<!-- more -->\n\n## 背景：\n硬盘从200G扩容到500G\n\n## 操作步骤：\n安装growpart 工具\n```\nyum install cloud-utils-growpart \n```\n\n\n扩容/data目录步骤如下。\n\n一、查看vdc云盘大小为200G，目录/data为20G\n```\n# lsblk\nNAME   MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT\nvda    253:0    0  100G  0 disk \n└─vda1 253:1    0  100G  0 part /\nvdb    253:16   0    8G  0 disk [SWAP]\nvdc    253:32   0  500G  0 disk \n└─vdc1 253:33   0  200G  0 part /data\n```\n\n二、使用growpart工具扩容分区vdc1\n```\n# growpart /dev/vdc 1\nCHANGED: partition=1 start=2048 old: size=419428352 end=419430400 new: size=1048573919 end=1048575967\n```\n\n三、扩容文件系统\n```\n# xfs_growfs /dev/vdc1\n\nmeta-data=/dev/vdc1              isize=512    agcount=4, agsize=13107136 blks\n         =                       sectsz=512   attr=2, projid32bit=1\n         =                       crc=1        finobt=0 spinodes=0\ndata     =                       bsize=4096   blocks=52428544, imaxpct=25\n         =                       sunit=0      swidth=0 blks\nnaming   =version 2              bsize=4096   ascii-ci=0 ftype=1\nlog      =internal               bsize=4096   blocks=25599, version=2\n         =                       sectsz=512   sunit=0 blks, lazy-count=1\nrealtime =none                   extsz=4096   blocks=0, rtextents=0\ndata blocks changed from 52428544 to 131071739\n\n```\n\n查看扩容结果\n```\n# lsblk\nNAME   MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT\nvda    253:0    0  100G  0 disk \n└─vda1 253:1    0  100G  0 part /\nvdb    253:16   0    8G  0 disk [SWAP]\nvdc    253:32   0  500G  0 disk \n└─vdc1 253:33   0  500G  0 part /data\n```\n...\n```\n# df -h\nFilesystem      Size  Used Avail Use% Mounted on\ndevtmpfs        7.8G     0  7.8G   0% /dev\ntmpfs           7.8G     0  7.8G   0% /dev/shm\ntmpfs           7.8G   17M  7.8G   1% /run\ntmpfs           7.8G     0  7.8G   0% /sys/fs/cgroup\n/dev/vda1        99G   79G   15G  85% /\n/dev/vdc1       500G  186G  315G  38% /data\ntmpfs           1.6G     0  1.6G   0% /run/user/1002\n```\n\n\n## 总结：\n1、先扩容云硬盘大小\n\n2、growpart工具扩容分区\n\n3、xfs_growfs（用于XFS文件系统）或者resize2fs命令（用户ext2/ext3/ext4）扩容文件系统","source":"_posts/linux/linux非lvm扩容.md","raw":"---\ntitle: linux 非lvm分区扩容\ndate: 2021-09-17 11:24\ncategories:\n- linux\ntags:\n- linux\n---\n\t\n\t\n摘要: linux 非lvm分区扩容\n<!-- more -->\n\n## 背景：\n硬盘从200G扩容到500G\n\n## 操作步骤：\n安装growpart 工具\n```\nyum install cloud-utils-growpart \n```\n\n\n扩容/data目录步骤如下。\n\n一、查看vdc云盘大小为200G，目录/data为20G\n```\n# lsblk\nNAME   MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT\nvda    253:0    0  100G  0 disk \n└─vda1 253:1    0  100G  0 part /\nvdb    253:16   0    8G  0 disk [SWAP]\nvdc    253:32   0  500G  0 disk \n└─vdc1 253:33   0  200G  0 part /data\n```\n\n二、使用growpart工具扩容分区vdc1\n```\n# growpart /dev/vdc 1\nCHANGED: partition=1 start=2048 old: size=419428352 end=419430400 new: size=1048573919 end=1048575967\n```\n\n三、扩容文件系统\n```\n# xfs_growfs /dev/vdc1\n\nmeta-data=/dev/vdc1              isize=512    agcount=4, agsize=13107136 blks\n         =                       sectsz=512   attr=2, projid32bit=1\n         =                       crc=1        finobt=0 spinodes=0\ndata     =                       bsize=4096   blocks=52428544, imaxpct=25\n         =                       sunit=0      swidth=0 blks\nnaming   =version 2              bsize=4096   ascii-ci=0 ftype=1\nlog      =internal               bsize=4096   blocks=25599, version=2\n         =                       sectsz=512   sunit=0 blks, lazy-count=1\nrealtime =none                   extsz=4096   blocks=0, rtextents=0\ndata blocks changed from 52428544 to 131071739\n\n```\n\n查看扩容结果\n```\n# lsblk\nNAME   MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT\nvda    253:0    0  100G  0 disk \n└─vda1 253:1    0  100G  0 part /\nvdb    253:16   0    8G  0 disk [SWAP]\nvdc    253:32   0  500G  0 disk \n└─vdc1 253:33   0  500G  0 part /data\n```\n...\n```\n# df -h\nFilesystem      Size  Used Avail Use% Mounted on\ndevtmpfs        7.8G     0  7.8G   0% /dev\ntmpfs           7.8G     0  7.8G   0% /dev/shm\ntmpfs           7.8G   17M  7.8G   1% /run\ntmpfs           7.8G     0  7.8G   0% /sys/fs/cgroup\n/dev/vda1        99G   79G   15G  85% /\n/dev/vdc1       500G  186G  315G  38% /data\ntmpfs           1.6G     0  1.6G   0% /run/user/1002\n```\n\n\n## 总结：\n1、先扩容云硬盘大小\n\n2、growpart工具扩容分区\n\n3、xfs_growfs（用于XFS文件系统）或者resize2fs命令（用户ext2/ext3/ext4）扩容文件系统","slug":"linux/linux非lvm扩容","published":1,"updated":"2021-09-29T09:45:48.541Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cku697a01005900uh7eiabm7f","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><p>摘要: linux 非lvm分区扩容</p>\n<span id=\"more\"></span>\n\n<h2 id=\"背景：\"><a href=\"#背景：\" class=\"headerlink\" title=\"背景：\"></a>背景：</h2><p>硬盘从200G扩容到500G</p>\n<h2 id=\"操作步骤：\"><a href=\"#操作步骤：\" class=\"headerlink\" title=\"操作步骤：\"></a>操作步骤：</h2><p>安装growpart 工具</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install cloud-utils-growpart </span><br></pre></td></tr></table></figure>\n\n\n<p>扩容/data目录步骤如下。</p>\n<p>一、查看vdc云盘大小为200G，目录/data为20G</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># lsblk</span><br><span class=\"line\">NAME   MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT</span><br><span class=\"line\">vda    253:0    0  100G  0 disk </span><br><span class=\"line\">└─vda1 253:1    0  100G  0 part &#x2F;</span><br><span class=\"line\">vdb    253:16   0    8G  0 disk [SWAP]</span><br><span class=\"line\">vdc    253:32   0  500G  0 disk </span><br><span class=\"line\">└─vdc1 253:33   0  200G  0 part &#x2F;data</span><br></pre></td></tr></table></figure>\n\n<p>二、使用growpart工具扩容分区vdc1</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># growpart &#x2F;dev&#x2F;vdc 1</span><br><span class=\"line\">CHANGED: partition&#x3D;1 start&#x3D;2048 old: size&#x3D;419428352 end&#x3D;419430400 new: size&#x3D;1048573919 end&#x3D;1048575967</span><br></pre></td></tr></table></figure>\n\n<p>三、扩容文件系统</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># xfs_growfs &#x2F;dev&#x2F;vdc1</span><br><span class=\"line\"></span><br><span class=\"line\">meta-data&#x3D;&#x2F;dev&#x2F;vdc1              isize&#x3D;512    agcount&#x3D;4, agsize&#x3D;13107136 blks</span><br><span class=\"line\">         &#x3D;                       sectsz&#x3D;512   attr&#x3D;2, projid32bit&#x3D;1</span><br><span class=\"line\">         &#x3D;                       crc&#x3D;1        finobt&#x3D;0 spinodes&#x3D;0</span><br><span class=\"line\">data     &#x3D;                       bsize&#x3D;4096   blocks&#x3D;52428544, imaxpct&#x3D;25</span><br><span class=\"line\">         &#x3D;                       sunit&#x3D;0      swidth&#x3D;0 blks</span><br><span class=\"line\">naming   &#x3D;version 2              bsize&#x3D;4096   ascii-ci&#x3D;0 ftype&#x3D;1</span><br><span class=\"line\">log      &#x3D;internal               bsize&#x3D;4096   blocks&#x3D;25599, version&#x3D;2</span><br><span class=\"line\">         &#x3D;                       sectsz&#x3D;512   sunit&#x3D;0 blks, lazy-count&#x3D;1</span><br><span class=\"line\">realtime &#x3D;none                   extsz&#x3D;4096   blocks&#x3D;0, rtextents&#x3D;0</span><br><span class=\"line\">data blocks changed from 52428544 to 131071739</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>查看扩容结果</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># lsblk</span><br><span class=\"line\">NAME   MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT</span><br><span class=\"line\">vda    253:0    0  100G  0 disk </span><br><span class=\"line\">└─vda1 253:1    0  100G  0 part &#x2F;</span><br><span class=\"line\">vdb    253:16   0    8G  0 disk [SWAP]</span><br><span class=\"line\">vdc    253:32   0  500G  0 disk </span><br><span class=\"line\">└─vdc1 253:33   0  500G  0 part &#x2F;data</span><br></pre></td></tr></table></figure>\n<p>…</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># df -h</span><br><span class=\"line\">Filesystem      Size  Used Avail Use% Mounted on</span><br><span class=\"line\">devtmpfs        7.8G     0  7.8G   0% &#x2F;dev</span><br><span class=\"line\">tmpfs           7.8G     0  7.8G   0% &#x2F;dev&#x2F;shm</span><br><span class=\"line\">tmpfs           7.8G   17M  7.8G   1% &#x2F;run</span><br><span class=\"line\">tmpfs           7.8G     0  7.8G   0% &#x2F;sys&#x2F;fs&#x2F;cgroup</span><br><span class=\"line\">&#x2F;dev&#x2F;vda1        99G   79G   15G  85% &#x2F;</span><br><span class=\"line\">&#x2F;dev&#x2F;vdc1       500G  186G  315G  38% &#x2F;data</span><br><span class=\"line\">tmpfs           1.6G     0  1.6G   0% &#x2F;run&#x2F;user&#x2F;1002</span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"总结：\"><a href=\"#总结：\" class=\"headerlink\" title=\"总结：\"></a>总结：</h2><p>1、先扩容云硬盘大小</p>\n<p>2、growpart工具扩容分区</p>\n<p>3、xfs_growfs（用于XFS文件系统）或者resize2fs命令（用户ext2/ext3/ext4）扩容文件系统</p>\n","site":{"data":{}},"excerpt":"<p>摘要: linux 非lvm分区扩容</p>","more":"<h2 id=\"背景：\"><a href=\"#背景：\" class=\"headerlink\" title=\"背景：\"></a>背景：</h2><p>硬盘从200G扩容到500G</p>\n<h2 id=\"操作步骤：\"><a href=\"#操作步骤：\" class=\"headerlink\" title=\"操作步骤：\"></a>操作步骤：</h2><p>安装growpart 工具</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install cloud-utils-growpart </span><br></pre></td></tr></table></figure>\n\n\n<p>扩容/data目录步骤如下。</p>\n<p>一、查看vdc云盘大小为200G，目录/data为20G</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># lsblk</span><br><span class=\"line\">NAME   MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT</span><br><span class=\"line\">vda    253:0    0  100G  0 disk </span><br><span class=\"line\">└─vda1 253:1    0  100G  0 part &#x2F;</span><br><span class=\"line\">vdb    253:16   0    8G  0 disk [SWAP]</span><br><span class=\"line\">vdc    253:32   0  500G  0 disk </span><br><span class=\"line\">└─vdc1 253:33   0  200G  0 part &#x2F;data</span><br></pre></td></tr></table></figure>\n\n<p>二、使用growpart工具扩容分区vdc1</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># growpart &#x2F;dev&#x2F;vdc 1</span><br><span class=\"line\">CHANGED: partition&#x3D;1 start&#x3D;2048 old: size&#x3D;419428352 end&#x3D;419430400 new: size&#x3D;1048573919 end&#x3D;1048575967</span><br></pre></td></tr></table></figure>\n\n<p>三、扩容文件系统</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># xfs_growfs &#x2F;dev&#x2F;vdc1</span><br><span class=\"line\"></span><br><span class=\"line\">meta-data&#x3D;&#x2F;dev&#x2F;vdc1              isize&#x3D;512    agcount&#x3D;4, agsize&#x3D;13107136 blks</span><br><span class=\"line\">         &#x3D;                       sectsz&#x3D;512   attr&#x3D;2, projid32bit&#x3D;1</span><br><span class=\"line\">         &#x3D;                       crc&#x3D;1        finobt&#x3D;0 spinodes&#x3D;0</span><br><span class=\"line\">data     &#x3D;                       bsize&#x3D;4096   blocks&#x3D;52428544, imaxpct&#x3D;25</span><br><span class=\"line\">         &#x3D;                       sunit&#x3D;0      swidth&#x3D;0 blks</span><br><span class=\"line\">naming   &#x3D;version 2              bsize&#x3D;4096   ascii-ci&#x3D;0 ftype&#x3D;1</span><br><span class=\"line\">log      &#x3D;internal               bsize&#x3D;4096   blocks&#x3D;25599, version&#x3D;2</span><br><span class=\"line\">         &#x3D;                       sectsz&#x3D;512   sunit&#x3D;0 blks, lazy-count&#x3D;1</span><br><span class=\"line\">realtime &#x3D;none                   extsz&#x3D;4096   blocks&#x3D;0, rtextents&#x3D;0</span><br><span class=\"line\">data blocks changed from 52428544 to 131071739</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>查看扩容结果</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># lsblk</span><br><span class=\"line\">NAME   MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT</span><br><span class=\"line\">vda    253:0    0  100G  0 disk </span><br><span class=\"line\">└─vda1 253:1    0  100G  0 part &#x2F;</span><br><span class=\"line\">vdb    253:16   0    8G  0 disk [SWAP]</span><br><span class=\"line\">vdc    253:32   0  500G  0 disk </span><br><span class=\"line\">└─vdc1 253:33   0  500G  0 part &#x2F;data</span><br></pre></td></tr></table></figure>\n<p>…</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># df -h</span><br><span class=\"line\">Filesystem      Size  Used Avail Use% Mounted on</span><br><span class=\"line\">devtmpfs        7.8G     0  7.8G   0% &#x2F;dev</span><br><span class=\"line\">tmpfs           7.8G     0  7.8G   0% &#x2F;dev&#x2F;shm</span><br><span class=\"line\">tmpfs           7.8G   17M  7.8G   1% &#x2F;run</span><br><span class=\"line\">tmpfs           7.8G     0  7.8G   0% &#x2F;sys&#x2F;fs&#x2F;cgroup</span><br><span class=\"line\">&#x2F;dev&#x2F;vda1        99G   79G   15G  85% &#x2F;</span><br><span class=\"line\">&#x2F;dev&#x2F;vdc1       500G  186G  315G  38% &#x2F;data</span><br><span class=\"line\">tmpfs           1.6G     0  1.6G   0% &#x2F;run&#x2F;user&#x2F;1002</span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"总结：\"><a href=\"#总结：\" class=\"headerlink\" title=\"总结：\"></a>总结：</h2><p>1、先扩容云硬盘大小</p>\n<p>2、growpart工具扩容分区</p>\n<p>3、xfs_growfs（用于XFS文件系统）或者resize2fs命令（用户ext2/ext3/ext4）扩容文件系统</p>"},{"title":"ssh 免密登陆脚本","date":"2021-08-19T02:25:00.000Z","_content":"\n\n摘要: ssh免密登陆\n<!-- more -->\n\nsssh.sh\n\n```\n#!/bin/bash\n\ncat hosts.txt | while read var_host; do\nvar_host_name=`echo \"${var_host}\" | awk '{print $1}'` && echo \"${var_host_name}\"\n#var_host_password=`echo \"${var_host}\" | awk '{print $2}'` && echo \"${var_host_password}\"\n# 定义密码\nvar_host_password=vUIMrQPJ7xeJZf8I\n/usr/bin/expect <<END\nspawn ssh-copy-id ${var_host_name}\nexpect {\n\"*(yes/no)?\" {send \"yes\\r\";exp_continue}\n\"*password:\" {send \"${var_host_password}\\r\";exp_continue}\nexpect eof\n}\nEND\nssh ${var_host_name} <<END\nsed -r -i -e '/^[ \\t]*#[ \\t]* ForwardAgent /c ForwardAgent yes' /etc/ssh/ssh_config\nservice sshd reload\nEND\ndone\n```\n\nhost.txt \n```\nroot@39.108.253.201\n```\n","source":"_posts/linux/ssh免登陆.md","raw":"---\ntitle: ssh 免密登陆脚本\ndate: 2021-08-19 10:25\ncategories:\n- linux\ntags:\n- ssh\n---\n\n\n摘要: ssh免密登陆\n<!-- more -->\n\nsssh.sh\n\n```\n#!/bin/bash\n\ncat hosts.txt | while read var_host; do\nvar_host_name=`echo \"${var_host}\" | awk '{print $1}'` && echo \"${var_host_name}\"\n#var_host_password=`echo \"${var_host}\" | awk '{print $2}'` && echo \"${var_host_password}\"\n# 定义密码\nvar_host_password=vUIMrQPJ7xeJZf8I\n/usr/bin/expect <<END\nspawn ssh-copy-id ${var_host_name}\nexpect {\n\"*(yes/no)?\" {send \"yes\\r\";exp_continue}\n\"*password:\" {send \"${var_host_password}\\r\";exp_continue}\nexpect eof\n}\nEND\nssh ${var_host_name} <<END\nsed -r -i -e '/^[ \\t]*#[ \\t]* ForwardAgent /c ForwardAgent yes' /etc/ssh/ssh_config\nservice sshd reload\nEND\ndone\n```\n\nhost.txt \n```\nroot@39.108.253.201\n```\n","slug":"linux/ssh免登陆","published":1,"updated":"2021-08-19T02:44:06.470Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cku697a05005b00uhh3vp9xc8","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><p>摘要: ssh免密登陆</p>\n<span id=\"more\"></span>\n\n<p>sssh.sh</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#!&#x2F;bin&#x2F;bash</span><br><span class=\"line\"></span><br><span class=\"line\">cat hosts.txt | while read var_host; do</span><br><span class=\"line\">var_host_name&#x3D;&#96;echo &quot;$&#123;var_host&#125;&quot; | awk &#39;&#123;print $1&#125;&#39;&#96; &amp;&amp; echo &quot;$&#123;var_host_name&#125;&quot;</span><br><span class=\"line\">#var_host_password&#x3D;&#96;echo &quot;$&#123;var_host&#125;&quot; | awk &#39;&#123;print $2&#125;&#39;&#96; &amp;&amp; echo &quot;$&#123;var_host_password&#125;&quot;</span><br><span class=\"line\"># 定义密码</span><br><span class=\"line\">var_host_password&#x3D;vUIMrQPJ7xeJZf8I</span><br><span class=\"line\">&#x2F;usr&#x2F;bin&#x2F;expect &lt;&lt;END</span><br><span class=\"line\">spawn ssh-copy-id $&#123;var_host_name&#125;</span><br><span class=\"line\">expect &#123;</span><br><span class=\"line\">&quot;*(yes&#x2F;no)?&quot; &#123;send &quot;yes\\r&quot;;exp_continue&#125;</span><br><span class=\"line\">&quot;*password:&quot; &#123;send &quot;$&#123;var_host_password&#125;\\r&quot;;exp_continue&#125;</span><br><span class=\"line\">expect eof</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">END</span><br><span class=\"line\">ssh $&#123;var_host_name&#125; &lt;&lt;END</span><br><span class=\"line\">sed -r -i -e &#39;&#x2F;^[ \\t]*#[ \\t]* ForwardAgent &#x2F;c ForwardAgent yes&#39; &#x2F;etc&#x2F;ssh&#x2F;ssh_config</span><br><span class=\"line\">service sshd reload</span><br><span class=\"line\">END</span><br><span class=\"line\">done</span><br></pre></td></tr></table></figure>\n\n<p>host.txt </p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">root@39.108.253.201</span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"<p>摘要: ssh免密登陆</p>","more":"<p>sssh.sh</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#!&#x2F;bin&#x2F;bash</span><br><span class=\"line\"></span><br><span class=\"line\">cat hosts.txt | while read var_host; do</span><br><span class=\"line\">var_host_name&#x3D;&#96;echo &quot;$&#123;var_host&#125;&quot; | awk &#39;&#123;print $1&#125;&#39;&#96; &amp;&amp; echo &quot;$&#123;var_host_name&#125;&quot;</span><br><span class=\"line\">#var_host_password&#x3D;&#96;echo &quot;$&#123;var_host&#125;&quot; | awk &#39;&#123;print $2&#125;&#39;&#96; &amp;&amp; echo &quot;$&#123;var_host_password&#125;&quot;</span><br><span class=\"line\"># 定义密码</span><br><span class=\"line\">var_host_password&#x3D;vUIMrQPJ7xeJZf8I</span><br><span class=\"line\">&#x2F;usr&#x2F;bin&#x2F;expect &lt;&lt;END</span><br><span class=\"line\">spawn ssh-copy-id $&#123;var_host_name&#125;</span><br><span class=\"line\">expect &#123;</span><br><span class=\"line\">&quot;*(yes&#x2F;no)?&quot; &#123;send &quot;yes\\r&quot;;exp_continue&#125;</span><br><span class=\"line\">&quot;*password:&quot; &#123;send &quot;$&#123;var_host_password&#125;\\r&quot;;exp_continue&#125;</span><br><span class=\"line\">expect eof</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">END</span><br><span class=\"line\">ssh $&#123;var_host_name&#125; &lt;&lt;END</span><br><span class=\"line\">sed -r -i -e &#39;&#x2F;^[ \\t]*#[ \\t]* ForwardAgent &#x2F;c ForwardAgent yes&#39; &#x2F;etc&#x2F;ssh&#x2F;ssh_config</span><br><span class=\"line\">service sshd reload</span><br><span class=\"line\">END</span><br><span class=\"line\">done</span><br></pre></td></tr></table></figure>\n\n<p>host.txt </p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">root@39.108.253.201</span><br></pre></td></tr></table></figure>"},{"title":"whiptail简单使用","date":"2021-09-29T01:40:00.000Z","_content":"\t\n\t\n摘要: desc\n<!-- more -->\n\n```\n#!/bin/bash\n# Version 1.0\n# AUTHOR:Xin23 http://weibo.com/231988\nPV() {\n\tNextLine() {\n\t\techo ' '\n\t}\n\tSplit() {\n\t\techo '-----------------------------------------------------------------------'\n\t}\n\tEchoTitle() {\n\t\techo \"--------$Title-----------------------------------------\"\n\t}\n\tShowPVFirstMenu() {\n\t\techo '\n       Physical Volumn Main Menu\n       Input Number To Choose!\n       Create Physical Volumn ...... 1\n       Remove Physical Volumn ...... 2\n       Change Physical Volumn ...... 3\n       Show   Physical Volumn ...... 4\n       Scan   Physical Volumn ...... 5\n       Exit                   ...... 6'\n\t\tNextLine\n\t}\n\tGetChoice() {\n\t\tread -p '       Input Your Choice: ' Var\n\t\tNextLine\n\t}\n\tConfirmOperate() {\n\t\tNextLine\n\t\techo \"  Continue               ...... y\n       Return                 ...... n\"\n\t\tNextLine\n\t\tGetChoice\n\t\tNextLine\n\t\tRun\n\t}\n\tRun() {\n\t\tif [ $Var == y ]; then\n\t\t\t$Parameter $Disk\n\t\telif [ $Var == n ]; then\n\t\t\tSplit\n\t\t\tPV\n\t\telse\n\t\t\tConfirmOperate\n\t\tfi\n\t}\n\tChooseDisk() {\n\t\tread -p \"       Please Choose Disk:    (Example: /dev/sdc)       \" Disk\n\t\tNextLine\n\t}\n\tPVChange() {\n\t\techo '  Which Operate You Want To do ?  '\n\t\tNextLine\n\t\techo '        ENABLE  Allocatable    ...... y\n       DISABLE Allocatable    ...... n'\n\t\tNextLine\n\t\tGetChoice\n\t}\n\tCheckPVChange() {\n\t\tif [ $Var == y ]; then\n\t\t\tParameter='pvchange -x y'\n\t\telif [ $Var == n ]; then\n\t\t\tParameter='pvchange -x n'\n\t\telse\n\t\t\tPVChange\n\t\tfi\n\t}\n\tPVShow() {\n\t\techo '  Which Physical Volumn You Want To Show ?        '\n\t\tNextLine\n\t\techo '          All    Physical Volumn ...... 1\n       Single Physical Volumn ...... 2'\n\t\tNextLine\n\t\tGetChoice\n\t}\n\tCheckPVShow() {\n\t\tif [ $Var -eq 1 ]; then\n\t\t\tpvdisplay\n\t\telif [ $Var -eq 2 ]; then\n\t\t\tpvdisplay $Disk\n\t\tfi\n\t}\n\tTestPVShow() {\n\t\tif [ $Var -eq 1 ]; then\n\t\t\tDisk=All\n\t\telif [ $Var -eq 2 ]; then\n\t\t\tEchoTitle\n\t\t\tNextLine\n\t\t\tChooseDisk\n\t\tfi\n\t}\n\n\tShowPVFirstMenu\n\tGetChoice\n\tcase $Var in\n\t\"1\")\n\t\tTitle='Create Physical Volumn'\n\t\tParameter=pvcreate\n\t\tEchoTitle\n\t\tNextLine\n\t\tChooseDisk\n\t\techo \"  Disk $Disk Will Be Convert To Physical Volumn\"\n\t\tConfirmOperate\n\t\tStatus=0\n\t\t;;\n\t\"2\")\n\t\tTitle='Remove Physical Volumn'\n\t\tEchoTitle\n\t\tParameter=pvremove\n\t\tNextLine\n\t\tChooseDisk\n\t\techo \"  Disk $Disk Will Be Remove From Physical Volumn\"\n\t\tConfirmOperate\n\t\tStatus=0\n\t\t;;\n\t\"3\")\n\t\tTitle='Change Physical Volumn'\n\t\tEchoTitle\n\t\tNextLine\n\t\tPVChange\n\t\tCheckPVChange\n\t\tNextLine\n\t\tChooseDisk\n\t\techo \"  Physical Volumn $Disk Will Be Change\"\n\t\tConfirmOperate\n\t\tStatus=0\n\t\t;;\n\t\"4\")\n\t\tTitle='Show   Physical Volumn'\n\t\tEchoTitle\n\t\tNextLine\n\t\tPVShow\n\t\tNextLine\n\t\tTestPVShow\n\t\techo \"  Physical Volumn $Disk Will Be Show\"\n\t\tNextLine\n\t\tCheckPVShow\n\t\tStatus=0\n\t\t;;\n\t\"5\")\n\t\tTitle='Scan   Physical Volumn'\n\t\tEchoTitle\n\t\tNextLine\n\t\tpvscan\n\t\tStatus=0\n\t\t;;\n\t\"6\")\n\t\texit 0\n\t\t;;\n\t*)\n\t\techo '  Input Error,Retype!'\n\t\tPV\n\t\t;;\n\tesac\n\tNeedContinue() {\n\t\tif [ $Status -eq 0 ]; then\n\t\t\tNextLine\n\t\t\tSplit\n\t\t\tPV\n\t\tfi\n\t}\n\tNeedContinue\n}\n\nPV\n\n```\n\n----------------------\n\n```\n#!/bin/bash\n# Version 1.0\n# AUTHOR:\n\n#显示分组中的服务器\nview_args() {\n\tascription=$(whiptail --title \"归属项目设置\" --inputbox \"该项目所属项目组\" 10 60 3>&1 1>&2 2>&3)\n\tif [ $? -eq 1 ];then\n\t\t\twhiptail --title \"提示！\" --msgbox \"欢迎您再次使用初始化脚本.\" 10 60\n\t\t\texit 1\n\tfi\n\tpname=$(whiptail --title \"项目设置\" --inputbox \"项目名称\" 10 60 3>&1 1>&2 2>&3)\n\t\tif [ $? -eq 1 ];then\n\t\t\twhiptail --title \"提示！\" --msgbox \"欢迎您再次使用初始化脚本.\" 10 60\n\t\t\texit 1\n\tfi\n\tgit_url=$(whiptail --title \"项目GIT地址\" --inputbox \"Git地址\" 10 60 3>&1 1>&2 2>&3)\n\t\tif [ $? -eq 1 ];then\n\t\t\twhiptail --title \"提示！\" --msgbox \"欢迎您再次使用初始化脚本.\" 10 60\n\t\t\texit 1\n\tfi\n\tenv=$(whiptail --title \"项目环境设置\" --inputbox \"请您输入该项目的环境\" 10 60 3>&1 1>&2 2>&3)\n\t\tif [ $? -eq 1 ];then\n\t\t\twhiptail --title \"提示！\" --msgbox \"欢迎您再次使用初始化脚本.\" 10 60\n\t\t\texit 1\n\tfi\n\ttype=$(whiptail --title \"项目类型设置\" --menu \"请您选择该项目的类型\" 10 60 4 \\\n\t\t\"Frontnd\" \"前端项目\" \\\n\t\t\"BackEnd\" \"后端项目\" 3>&1 1>&2 2>&3)\n\t\t\tif [ $? -eq 1 ];then\n\t\t\twhiptail --title \"提示！\" --msgbox \"欢迎您再次使用初始化脚本.\" 10 60\n\t\t\texit 1\n\tfi\n\troot_project_path=$(whiptail --title \"项目环境设置\" --inputbox \"部署脚本根目录\" 10 60 \"/tmp/deploy\" 3>&1 1>&2 2>&3)\n\t\tif [ $? -eq 1 ];then\n\t\t\twhiptail --title \"提示！\" --msgbox \"欢迎您再次使用初始化脚本.\" 10 60\n\t\t\texit 1\n\tfi\n\tback_dir=$(whiptail --title \"项目环境设置\" --inputbox \"项目备份路径\" 10 60 \"/ztocwst/back\" 3>&1 1>&2 2>&3)\n\t\tif [ $? -eq 1 ];then\n\t\t\twhiptail --title \"提示！\" --msgbox \"欢迎您再次使用初始化脚本.\" 10 60\n\t\t\texit 1\n\tfi\n}\n\nview_project() {\n\n\tif [ ${type} == \"Frontnd\" ]; then\n\t\techo \"\"\n\t\tfed_project_cmd=$(whiptail --title \"前端项目设置\" --inputbox \"前端项目编译命令\" 10 60 3>&1 1>&2 2>&3)\n\t\t\tif [ $? -eq 1 ];then\n\t\t\twhiptail --title \"提示！\" --msgbox \"欢迎您再次使用初始化脚本.\" 10 60\n\t\t\texit 1\n\tfi\n\t\tproject_out=$(whiptail --title \"前端项目设置\" --inputbox \"前端项目编译输出路径\" 10 60 \"dist\" 3>&1 1>&2 2>&3)\n\t\t\tif [ $? -eq 1 ];then\n\t\t\twhiptail --title \"提示！\" --msgbox \"欢迎您再次使用初始化脚本.\" 10 60\n\t\t\texit 1\n\tfi\n\t\tsite_root=$(whiptail --title \"前端项目设置\" --inputbox \"前端项目Nginx指向路径\" 10 60 \"/ztocwst/nginx/www\" 3>&1 1>&2 2>&3)\n\t\t\tif [ $? -eq 1 ];then\n\t\t\twhiptail --title \"提示！\" --msgbox \"欢迎您再次使用初始化脚本.\" 10 60\n\t\t\texit 1\n\tfi\n\t\tdomain_name=$(whiptail --title \"前端项目设置\" --inputbox \"前端项目Nginx域名\" 10 60 3>&1 1>&2 2>&3)\n\t\t\tif [ $? -eq 1 ];then\n\t\t\twhiptail --title \"提示！\" --msgbox \"欢迎您再次使用初始化脚本.\" 10 60\n\t\t\texit 1\n\tfi\n\telse\n\t\techo \"\"\n\t\tproject_cmd=$(whiptail --title \"后端项目设置\" --inputbox \"后端项目编译命令\" 10 60 3>&1 1>&2 2>&3)\n\t\t\tif [ $? -eq 1 ];then\n\t\t\twhiptail --title \"提示！\" --msgbox \"欢迎您再次使用初始化脚本.\" 10 60\n\t\t\texit 1\n\tfi\n\t\tproject_out=$(whiptail --title \"后端项目设置\" --inputbox \"后端项目编译输出路径\" 10 60 3>&1 1>&2 2>&3)\n\t\t\tif [ $? -eq 1 ];then\n\t\t\twhiptail --title \"提示！\" --msgbox \"欢迎您再次使用初始化脚本.\" 10 60\n\t\t\texit 1\n\tfi\n\t\tsrc_project_path=$(whiptail --title \"后端项目设置\" --inputbox \"后端项目路径\" 10 60 \"/ztocwst/service\" 3>&1 1>&2 2>&3)\n\t\t\tif [ $? -eq 1 ];then\n\t\t\twhiptail --title \"提示！\" --msgbox \"欢迎您再次使用初始化脚本.\" 10 60\n\t\t\texit 1\n\tfi\n\tfi\n\n}\n\noutconfig() {\n\tif [ ${type} == \"Frontnd\" ]; then\n\t\techo \"\"\n\t\tmv vars.yml vars.yml-$(date +%Y%m%d%H%M)\ncat > vars.yml <<EOF\n# *项目环境\nenv: \"${env}\"\n\n# *项目类型  fed- , tomcat# 前端项目使用\ntype: \"fed-\"  \n\n# *归属项目\nascription: \"${ascription}\"\n\n# *名称\npname: \"${pname}\"\n\n# 域名\ndomain_name: \"${domain_name}\"\n\n# 前端项目 编译命令\nfed_project_cmd: ${fed_project_cmd}\n\n# *项目git地址\ngit_url:  \"${git_url}\"\n\n# *输出路径前端一般是 dist\nproject_out: \"${project_out}\"\n\n# 项目脚本路径\nlocal_project_path: \"{{ root_project_path }}/{{ ascription }}/{{ env }}/{{ project_name }}\"\n\n# 项目名称\nproject_name: \"{{ type }}{{ env }}-ztocwst-{{ ascription }}-{{ pname }}\"\n\n\n# nginx www路径\nsite_root: \"${site_root}\"\n\n##############  全局参数\n# 部署脚本根目录\nroot_project_path: \"${root_project_path}\"\n\n# 备份路径\nback_dir: \"${back_dir}\"\n\nEOF\n\n\telse\n\t\techo \"\"\n\t\tmv vars.yml vars.yml-$(date +%Y%m%d%H%M)\ncat > vars.yml <<EOF\n# *项目环境\nenv: \"${env}\"\n\n# *项目类型  fed- , tomcat\ntype: \"\"\n\n\n# *归属项目\nascription: \"${ascription}\"\n\n# *名称\npname: \"${pname}\"\n\n\n# *后端编译命令\nproject_cmd: \"${project_cmd}\"\n\n\n# *项目git地址\ngit_url:  \"${git_url}\"\n\n# *编译输出路径\nproject_out: \"${project_out}\"\n\n\n# 项目脚本路径\nlocal_project_path: \"{{ root_project_path }}/{{ ascription }}/{{ env }}/{{ project_name }}\"\n\n# 项目名称\nproject_name: \"{{ type }}{{ env }}-ztocwst-{{ ascription }}-{{ pname }}\"\n\n\n\n##############  全局参数\n# 部署脚本根目录\nroot_project_path: \"${root_project_path}\"\n\n# 备份路径\nback_dir: \"${back_dir}\"\n\n# 后端目标服务器项目路径\nsrc_project_path: \"${src_project_path}\"\n\nEOF\n\n\tfi\n}\n\n\nmain(){\n\tview_args\n\tview_project\n\toutconfig\n}\n\nmain\n```\n\n-----------------\n\n```\n#!/bin/bash\nfunction Prompt(){\n(whiptail --title \"IP地址更改(yes/no)\" --yesno \"您是否需要重新配置IP地址？\" 10 60)\n    if [ $? -eq 0 ];then\n        ip_check\n    else\n        whiptail --title \"Nginx提示！\" --msgbox \"欢迎您再次使用Nginx一键安装服务.\" 10 60\n        exit 1\n    fi\n}\n\nfunction ip_check(){\nIP=$(whiptail --title \"IP地址设置\" --inputbox \"请您输入您的IP地址\" 10 60  3>&1 1>&2 2>&3)\n    VALID_CHECK=$(echo $IP|awk -F. '$1<=255&&$2<=255&&$3<=255&&$4<=255{print \"yes\"}')\n        if echo $IP|grep -E \"^[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}$\" >/dev/null; then\n            if [[ \"$VALID_CHECK\" == \"yes\" ]]; then\n                whiptail --title \"IP地址合法提示！\" --msgbox \"您输入的IP地址正确，点击OK进行下一步配置！.\" 10 60\n            fi\n        else\n                whiptail --title \"IP地址错误提示！\" --msgbox \"您输入的IP地址可能有误,请您检查后再次输入！.\" 10 60\n                Prompt\n        fi\n}\n\nfunction install_nginx(){\n(whiptail --title \"安装 Nginx？(yes/no)\" --yesno \"你是否需要安装Nginx？\" 10 60)\n    if [ $? -eq 0 ];then\n            {\n                sleep 1\n                echo 5\n                apt-get update >/dev/null\n                sleep 1\n                echo 10\n                sudo apt-get -y install  build-essential >/dev/null &\n                sleep 1\n                echo 30\n                sudo apt-get -y install openssl libssl-dev >/dev/null &\n                sleep 1\n                echo 50\n                sudo apt-get -y install libpcre3 libpcre3-dev >/dev/null &\n                sleep 1\n                echo 70\n                sudo apt-get -y install zlib1g-dev >/dev/null &\n                sleep 1\n                echo 90\n                wget -q  http://nginx.org/download/nginx-1.12.2.tar.gz >/dev/null  \n                sleep 1\n                echo 95\n                useradd -M -s /sbin/nologin nginx &\n                tar zxf /root/nginx-1.12.2.tar.gz && cd /root/nginx-1.12.2/ && \n                ./configure --prefix=/usr/local/nginx --with-http_dav_module --with-http_stub_status_module --with-http_addition_module --with-http_sub_module  --with-http_flv_module --with-http_mp4_module --with-pcre --with-http_ssl_module --with-http_gzip_static_module  --user=nginx >/dev/null && make >/dev/null && make install >/dev/null\n                /usr/local/nginx/sbin/nginx &>/dev/null &\n                sleep 100\n            } |  whiptail --gauge \"正在安装Nginx,过程可能需要几分钟请稍后..........\" 6 60 0 &&  whiptail --title \"Nginx安装成功提示！！！\" --msgbox \"恭喜您Nginx安装成功，请您访问：http://$IP:80, 感谢使用~~~\" 10 60 \n    else\n        whiptail --title \"Nginx提示！！！\" --msgbox \"感谢使用~~~\" 10 60\n        exit 1\n    fi\n}\n\nfunction mail(){\n    ip_check\n    install_nginx\n}\n\nmail\n\n```","source":"_posts/linux/whiptail简单使用.md","raw":"---\ntitle: whiptail简单使用\ndate: 2021-09-29 09:40\ncategories:\n- linux\ntags:\n- whiptail\n---\n\t\n\t\n摘要: desc\n<!-- more -->\n\n```\n#!/bin/bash\n# Version 1.0\n# AUTHOR:Xin23 http://weibo.com/231988\nPV() {\n\tNextLine() {\n\t\techo ' '\n\t}\n\tSplit() {\n\t\techo '-----------------------------------------------------------------------'\n\t}\n\tEchoTitle() {\n\t\techo \"--------$Title-----------------------------------------\"\n\t}\n\tShowPVFirstMenu() {\n\t\techo '\n       Physical Volumn Main Menu\n       Input Number To Choose!\n       Create Physical Volumn ...... 1\n       Remove Physical Volumn ...... 2\n       Change Physical Volumn ...... 3\n       Show   Physical Volumn ...... 4\n       Scan   Physical Volumn ...... 5\n       Exit                   ...... 6'\n\t\tNextLine\n\t}\n\tGetChoice() {\n\t\tread -p '       Input Your Choice: ' Var\n\t\tNextLine\n\t}\n\tConfirmOperate() {\n\t\tNextLine\n\t\techo \"  Continue               ...... y\n       Return                 ...... n\"\n\t\tNextLine\n\t\tGetChoice\n\t\tNextLine\n\t\tRun\n\t}\n\tRun() {\n\t\tif [ $Var == y ]; then\n\t\t\t$Parameter $Disk\n\t\telif [ $Var == n ]; then\n\t\t\tSplit\n\t\t\tPV\n\t\telse\n\t\t\tConfirmOperate\n\t\tfi\n\t}\n\tChooseDisk() {\n\t\tread -p \"       Please Choose Disk:    (Example: /dev/sdc)       \" Disk\n\t\tNextLine\n\t}\n\tPVChange() {\n\t\techo '  Which Operate You Want To do ?  '\n\t\tNextLine\n\t\techo '        ENABLE  Allocatable    ...... y\n       DISABLE Allocatable    ...... n'\n\t\tNextLine\n\t\tGetChoice\n\t}\n\tCheckPVChange() {\n\t\tif [ $Var == y ]; then\n\t\t\tParameter='pvchange -x y'\n\t\telif [ $Var == n ]; then\n\t\t\tParameter='pvchange -x n'\n\t\telse\n\t\t\tPVChange\n\t\tfi\n\t}\n\tPVShow() {\n\t\techo '  Which Physical Volumn You Want To Show ?        '\n\t\tNextLine\n\t\techo '          All    Physical Volumn ...... 1\n       Single Physical Volumn ...... 2'\n\t\tNextLine\n\t\tGetChoice\n\t}\n\tCheckPVShow() {\n\t\tif [ $Var -eq 1 ]; then\n\t\t\tpvdisplay\n\t\telif [ $Var -eq 2 ]; then\n\t\t\tpvdisplay $Disk\n\t\tfi\n\t}\n\tTestPVShow() {\n\t\tif [ $Var -eq 1 ]; then\n\t\t\tDisk=All\n\t\telif [ $Var -eq 2 ]; then\n\t\t\tEchoTitle\n\t\t\tNextLine\n\t\t\tChooseDisk\n\t\tfi\n\t}\n\n\tShowPVFirstMenu\n\tGetChoice\n\tcase $Var in\n\t\"1\")\n\t\tTitle='Create Physical Volumn'\n\t\tParameter=pvcreate\n\t\tEchoTitle\n\t\tNextLine\n\t\tChooseDisk\n\t\techo \"  Disk $Disk Will Be Convert To Physical Volumn\"\n\t\tConfirmOperate\n\t\tStatus=0\n\t\t;;\n\t\"2\")\n\t\tTitle='Remove Physical Volumn'\n\t\tEchoTitle\n\t\tParameter=pvremove\n\t\tNextLine\n\t\tChooseDisk\n\t\techo \"  Disk $Disk Will Be Remove From Physical Volumn\"\n\t\tConfirmOperate\n\t\tStatus=0\n\t\t;;\n\t\"3\")\n\t\tTitle='Change Physical Volumn'\n\t\tEchoTitle\n\t\tNextLine\n\t\tPVChange\n\t\tCheckPVChange\n\t\tNextLine\n\t\tChooseDisk\n\t\techo \"  Physical Volumn $Disk Will Be Change\"\n\t\tConfirmOperate\n\t\tStatus=0\n\t\t;;\n\t\"4\")\n\t\tTitle='Show   Physical Volumn'\n\t\tEchoTitle\n\t\tNextLine\n\t\tPVShow\n\t\tNextLine\n\t\tTestPVShow\n\t\techo \"  Physical Volumn $Disk Will Be Show\"\n\t\tNextLine\n\t\tCheckPVShow\n\t\tStatus=0\n\t\t;;\n\t\"5\")\n\t\tTitle='Scan   Physical Volumn'\n\t\tEchoTitle\n\t\tNextLine\n\t\tpvscan\n\t\tStatus=0\n\t\t;;\n\t\"6\")\n\t\texit 0\n\t\t;;\n\t*)\n\t\techo '  Input Error,Retype!'\n\t\tPV\n\t\t;;\n\tesac\n\tNeedContinue() {\n\t\tif [ $Status -eq 0 ]; then\n\t\t\tNextLine\n\t\t\tSplit\n\t\t\tPV\n\t\tfi\n\t}\n\tNeedContinue\n}\n\nPV\n\n```\n\n----------------------\n\n```\n#!/bin/bash\n# Version 1.0\n# AUTHOR:\n\n#显示分组中的服务器\nview_args() {\n\tascription=$(whiptail --title \"归属项目设置\" --inputbox \"该项目所属项目组\" 10 60 3>&1 1>&2 2>&3)\n\tif [ $? -eq 1 ];then\n\t\t\twhiptail --title \"提示！\" --msgbox \"欢迎您再次使用初始化脚本.\" 10 60\n\t\t\texit 1\n\tfi\n\tpname=$(whiptail --title \"项目设置\" --inputbox \"项目名称\" 10 60 3>&1 1>&2 2>&3)\n\t\tif [ $? -eq 1 ];then\n\t\t\twhiptail --title \"提示！\" --msgbox \"欢迎您再次使用初始化脚本.\" 10 60\n\t\t\texit 1\n\tfi\n\tgit_url=$(whiptail --title \"项目GIT地址\" --inputbox \"Git地址\" 10 60 3>&1 1>&2 2>&3)\n\t\tif [ $? -eq 1 ];then\n\t\t\twhiptail --title \"提示！\" --msgbox \"欢迎您再次使用初始化脚本.\" 10 60\n\t\t\texit 1\n\tfi\n\tenv=$(whiptail --title \"项目环境设置\" --inputbox \"请您输入该项目的环境\" 10 60 3>&1 1>&2 2>&3)\n\t\tif [ $? -eq 1 ];then\n\t\t\twhiptail --title \"提示！\" --msgbox \"欢迎您再次使用初始化脚本.\" 10 60\n\t\t\texit 1\n\tfi\n\ttype=$(whiptail --title \"项目类型设置\" --menu \"请您选择该项目的类型\" 10 60 4 \\\n\t\t\"Frontnd\" \"前端项目\" \\\n\t\t\"BackEnd\" \"后端项目\" 3>&1 1>&2 2>&3)\n\t\t\tif [ $? -eq 1 ];then\n\t\t\twhiptail --title \"提示！\" --msgbox \"欢迎您再次使用初始化脚本.\" 10 60\n\t\t\texit 1\n\tfi\n\troot_project_path=$(whiptail --title \"项目环境设置\" --inputbox \"部署脚本根目录\" 10 60 \"/tmp/deploy\" 3>&1 1>&2 2>&3)\n\t\tif [ $? -eq 1 ];then\n\t\t\twhiptail --title \"提示！\" --msgbox \"欢迎您再次使用初始化脚本.\" 10 60\n\t\t\texit 1\n\tfi\n\tback_dir=$(whiptail --title \"项目环境设置\" --inputbox \"项目备份路径\" 10 60 \"/ztocwst/back\" 3>&1 1>&2 2>&3)\n\t\tif [ $? -eq 1 ];then\n\t\t\twhiptail --title \"提示！\" --msgbox \"欢迎您再次使用初始化脚本.\" 10 60\n\t\t\texit 1\n\tfi\n}\n\nview_project() {\n\n\tif [ ${type} == \"Frontnd\" ]; then\n\t\techo \"\"\n\t\tfed_project_cmd=$(whiptail --title \"前端项目设置\" --inputbox \"前端项目编译命令\" 10 60 3>&1 1>&2 2>&3)\n\t\t\tif [ $? -eq 1 ];then\n\t\t\twhiptail --title \"提示！\" --msgbox \"欢迎您再次使用初始化脚本.\" 10 60\n\t\t\texit 1\n\tfi\n\t\tproject_out=$(whiptail --title \"前端项目设置\" --inputbox \"前端项目编译输出路径\" 10 60 \"dist\" 3>&1 1>&2 2>&3)\n\t\t\tif [ $? -eq 1 ];then\n\t\t\twhiptail --title \"提示！\" --msgbox \"欢迎您再次使用初始化脚本.\" 10 60\n\t\t\texit 1\n\tfi\n\t\tsite_root=$(whiptail --title \"前端项目设置\" --inputbox \"前端项目Nginx指向路径\" 10 60 \"/ztocwst/nginx/www\" 3>&1 1>&2 2>&3)\n\t\t\tif [ $? -eq 1 ];then\n\t\t\twhiptail --title \"提示！\" --msgbox \"欢迎您再次使用初始化脚本.\" 10 60\n\t\t\texit 1\n\tfi\n\t\tdomain_name=$(whiptail --title \"前端项目设置\" --inputbox \"前端项目Nginx域名\" 10 60 3>&1 1>&2 2>&3)\n\t\t\tif [ $? -eq 1 ];then\n\t\t\twhiptail --title \"提示！\" --msgbox \"欢迎您再次使用初始化脚本.\" 10 60\n\t\t\texit 1\n\tfi\n\telse\n\t\techo \"\"\n\t\tproject_cmd=$(whiptail --title \"后端项目设置\" --inputbox \"后端项目编译命令\" 10 60 3>&1 1>&2 2>&3)\n\t\t\tif [ $? -eq 1 ];then\n\t\t\twhiptail --title \"提示！\" --msgbox \"欢迎您再次使用初始化脚本.\" 10 60\n\t\t\texit 1\n\tfi\n\t\tproject_out=$(whiptail --title \"后端项目设置\" --inputbox \"后端项目编译输出路径\" 10 60 3>&1 1>&2 2>&3)\n\t\t\tif [ $? -eq 1 ];then\n\t\t\twhiptail --title \"提示！\" --msgbox \"欢迎您再次使用初始化脚本.\" 10 60\n\t\t\texit 1\n\tfi\n\t\tsrc_project_path=$(whiptail --title \"后端项目设置\" --inputbox \"后端项目路径\" 10 60 \"/ztocwst/service\" 3>&1 1>&2 2>&3)\n\t\t\tif [ $? -eq 1 ];then\n\t\t\twhiptail --title \"提示！\" --msgbox \"欢迎您再次使用初始化脚本.\" 10 60\n\t\t\texit 1\n\tfi\n\tfi\n\n}\n\noutconfig() {\n\tif [ ${type} == \"Frontnd\" ]; then\n\t\techo \"\"\n\t\tmv vars.yml vars.yml-$(date +%Y%m%d%H%M)\ncat > vars.yml <<EOF\n# *项目环境\nenv: \"${env}\"\n\n# *项目类型  fed- , tomcat# 前端项目使用\ntype: \"fed-\"  \n\n# *归属项目\nascription: \"${ascription}\"\n\n# *名称\npname: \"${pname}\"\n\n# 域名\ndomain_name: \"${domain_name}\"\n\n# 前端项目 编译命令\nfed_project_cmd: ${fed_project_cmd}\n\n# *项目git地址\ngit_url:  \"${git_url}\"\n\n# *输出路径前端一般是 dist\nproject_out: \"${project_out}\"\n\n# 项目脚本路径\nlocal_project_path: \"{{ root_project_path }}/{{ ascription }}/{{ env }}/{{ project_name }}\"\n\n# 项目名称\nproject_name: \"{{ type }}{{ env }}-ztocwst-{{ ascription }}-{{ pname }}\"\n\n\n# nginx www路径\nsite_root: \"${site_root}\"\n\n##############  全局参数\n# 部署脚本根目录\nroot_project_path: \"${root_project_path}\"\n\n# 备份路径\nback_dir: \"${back_dir}\"\n\nEOF\n\n\telse\n\t\techo \"\"\n\t\tmv vars.yml vars.yml-$(date +%Y%m%d%H%M)\ncat > vars.yml <<EOF\n# *项目环境\nenv: \"${env}\"\n\n# *项目类型  fed- , tomcat\ntype: \"\"\n\n\n# *归属项目\nascription: \"${ascription}\"\n\n# *名称\npname: \"${pname}\"\n\n\n# *后端编译命令\nproject_cmd: \"${project_cmd}\"\n\n\n# *项目git地址\ngit_url:  \"${git_url}\"\n\n# *编译输出路径\nproject_out: \"${project_out}\"\n\n\n# 项目脚本路径\nlocal_project_path: \"{{ root_project_path }}/{{ ascription }}/{{ env }}/{{ project_name }}\"\n\n# 项目名称\nproject_name: \"{{ type }}{{ env }}-ztocwst-{{ ascription }}-{{ pname }}\"\n\n\n\n##############  全局参数\n# 部署脚本根目录\nroot_project_path: \"${root_project_path}\"\n\n# 备份路径\nback_dir: \"${back_dir}\"\n\n# 后端目标服务器项目路径\nsrc_project_path: \"${src_project_path}\"\n\nEOF\n\n\tfi\n}\n\n\nmain(){\n\tview_args\n\tview_project\n\toutconfig\n}\n\nmain\n```\n\n-----------------\n\n```\n#!/bin/bash\nfunction Prompt(){\n(whiptail --title \"IP地址更改(yes/no)\" --yesno \"您是否需要重新配置IP地址？\" 10 60)\n    if [ $? -eq 0 ];then\n        ip_check\n    else\n        whiptail --title \"Nginx提示！\" --msgbox \"欢迎您再次使用Nginx一键安装服务.\" 10 60\n        exit 1\n    fi\n}\n\nfunction ip_check(){\nIP=$(whiptail --title \"IP地址设置\" --inputbox \"请您输入您的IP地址\" 10 60  3>&1 1>&2 2>&3)\n    VALID_CHECK=$(echo $IP|awk -F. '$1<=255&&$2<=255&&$3<=255&&$4<=255{print \"yes\"}')\n        if echo $IP|grep -E \"^[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}$\" >/dev/null; then\n            if [[ \"$VALID_CHECK\" == \"yes\" ]]; then\n                whiptail --title \"IP地址合法提示！\" --msgbox \"您输入的IP地址正确，点击OK进行下一步配置！.\" 10 60\n            fi\n        else\n                whiptail --title \"IP地址错误提示！\" --msgbox \"您输入的IP地址可能有误,请您检查后再次输入！.\" 10 60\n                Prompt\n        fi\n}\n\nfunction install_nginx(){\n(whiptail --title \"安装 Nginx？(yes/no)\" --yesno \"你是否需要安装Nginx？\" 10 60)\n    if [ $? -eq 0 ];then\n            {\n                sleep 1\n                echo 5\n                apt-get update >/dev/null\n                sleep 1\n                echo 10\n                sudo apt-get -y install  build-essential >/dev/null &\n                sleep 1\n                echo 30\n                sudo apt-get -y install openssl libssl-dev >/dev/null &\n                sleep 1\n                echo 50\n                sudo apt-get -y install libpcre3 libpcre3-dev >/dev/null &\n                sleep 1\n                echo 70\n                sudo apt-get -y install zlib1g-dev >/dev/null &\n                sleep 1\n                echo 90\n                wget -q  http://nginx.org/download/nginx-1.12.2.tar.gz >/dev/null  \n                sleep 1\n                echo 95\n                useradd -M -s /sbin/nologin nginx &\n                tar zxf /root/nginx-1.12.2.tar.gz && cd /root/nginx-1.12.2/ && \n                ./configure --prefix=/usr/local/nginx --with-http_dav_module --with-http_stub_status_module --with-http_addition_module --with-http_sub_module  --with-http_flv_module --with-http_mp4_module --with-pcre --with-http_ssl_module --with-http_gzip_static_module  --user=nginx >/dev/null && make >/dev/null && make install >/dev/null\n                /usr/local/nginx/sbin/nginx &>/dev/null &\n                sleep 100\n            } |  whiptail --gauge \"正在安装Nginx,过程可能需要几分钟请稍后..........\" 6 60 0 &&  whiptail --title \"Nginx安装成功提示！！！\" --msgbox \"恭喜您Nginx安装成功，请您访问：http://$IP:80, 感谢使用~~~\" 10 60 \n    else\n        whiptail --title \"Nginx提示！！！\" --msgbox \"感谢使用~~~\" 10 60\n        exit 1\n    fi\n}\n\nfunction mail(){\n    ip_check\n    install_nginx\n}\n\nmail\n\n```","slug":"linux/whiptail简单使用","published":1,"updated":"2021-09-29T01:41:37.401Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cku697a07005f00uh0acfgj75","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><p>摘要: desc</p>\n<span id=\"more\"></span>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#!&#x2F;bin&#x2F;bash</span><br><span class=\"line\"># Version 1.0</span><br><span class=\"line\"># AUTHOR:Xin23 http:&#x2F;&#x2F;weibo.com&#x2F;231988</span><br><span class=\"line\">PV() &#123;</span><br><span class=\"line\">\tNextLine() &#123;</span><br><span class=\"line\">\t\techo &#39; &#39;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tSplit() &#123;</span><br><span class=\"line\">\t\techo &#39;-----------------------------------------------------------------------&#39;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tEchoTitle() &#123;</span><br><span class=\"line\">\t\techo &quot;--------$Title-----------------------------------------&quot;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tShowPVFirstMenu() &#123;</span><br><span class=\"line\">\t\techo &#39;</span><br><span class=\"line\">       Physical Volumn Main Menu</span><br><span class=\"line\">       Input Number To Choose!</span><br><span class=\"line\">       Create Physical Volumn ...... 1</span><br><span class=\"line\">       Remove Physical Volumn ...... 2</span><br><span class=\"line\">       Change Physical Volumn ...... 3</span><br><span class=\"line\">       Show   Physical Volumn ...... 4</span><br><span class=\"line\">       Scan   Physical Volumn ...... 5</span><br><span class=\"line\">       Exit                   ...... 6&#39;</span><br><span class=\"line\">\t\tNextLine</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tGetChoice() &#123;</span><br><span class=\"line\">\t\tread -p &#39;       Input Your Choice: &#39; Var</span><br><span class=\"line\">\t\tNextLine</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tConfirmOperate() &#123;</span><br><span class=\"line\">\t\tNextLine</span><br><span class=\"line\">\t\techo &quot;  Continue               ...... y</span><br><span class=\"line\">       Return                 ...... n&quot;</span><br><span class=\"line\">\t\tNextLine</span><br><span class=\"line\">\t\tGetChoice</span><br><span class=\"line\">\t\tNextLine</span><br><span class=\"line\">\t\tRun</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tRun() &#123;</span><br><span class=\"line\">\t\tif [ $Var &#x3D;&#x3D; y ]; then</span><br><span class=\"line\">\t\t\t$Parameter $Disk</span><br><span class=\"line\">\t\telif [ $Var &#x3D;&#x3D; n ]; then</span><br><span class=\"line\">\t\t\tSplit</span><br><span class=\"line\">\t\t\tPV</span><br><span class=\"line\">\t\telse</span><br><span class=\"line\">\t\t\tConfirmOperate</span><br><span class=\"line\">\t\tfi</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tChooseDisk() &#123;</span><br><span class=\"line\">\t\tread -p &quot;       Please Choose Disk:    (Example: &#x2F;dev&#x2F;sdc)       &quot; Disk</span><br><span class=\"line\">\t\tNextLine</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tPVChange() &#123;</span><br><span class=\"line\">\t\techo &#39;  Which Operate You Want To do ?  &#39;</span><br><span class=\"line\">\t\tNextLine</span><br><span class=\"line\">\t\techo &#39;        ENABLE  Allocatable    ...... y</span><br><span class=\"line\">       DISABLE Allocatable    ...... n&#39;</span><br><span class=\"line\">\t\tNextLine</span><br><span class=\"line\">\t\tGetChoice</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tCheckPVChange() &#123;</span><br><span class=\"line\">\t\tif [ $Var &#x3D;&#x3D; y ]; then</span><br><span class=\"line\">\t\t\tParameter&#x3D;&#39;pvchange -x y&#39;</span><br><span class=\"line\">\t\telif [ $Var &#x3D;&#x3D; n ]; then</span><br><span class=\"line\">\t\t\tParameter&#x3D;&#39;pvchange -x n&#39;</span><br><span class=\"line\">\t\telse</span><br><span class=\"line\">\t\t\tPVChange</span><br><span class=\"line\">\t\tfi</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tPVShow() &#123;</span><br><span class=\"line\">\t\techo &#39;  Which Physical Volumn You Want To Show ?        &#39;</span><br><span class=\"line\">\t\tNextLine</span><br><span class=\"line\">\t\techo &#39;          All    Physical Volumn ...... 1</span><br><span class=\"line\">       Single Physical Volumn ...... 2&#39;</span><br><span class=\"line\">\t\tNextLine</span><br><span class=\"line\">\t\tGetChoice</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tCheckPVShow() &#123;</span><br><span class=\"line\">\t\tif [ $Var -eq 1 ]; then</span><br><span class=\"line\">\t\t\tpvdisplay</span><br><span class=\"line\">\t\telif [ $Var -eq 2 ]; then</span><br><span class=\"line\">\t\t\tpvdisplay $Disk</span><br><span class=\"line\">\t\tfi</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tTestPVShow() &#123;</span><br><span class=\"line\">\t\tif [ $Var -eq 1 ]; then</span><br><span class=\"line\">\t\t\tDisk&#x3D;All</span><br><span class=\"line\">\t\telif [ $Var -eq 2 ]; then</span><br><span class=\"line\">\t\t\tEchoTitle</span><br><span class=\"line\">\t\t\tNextLine</span><br><span class=\"line\">\t\t\tChooseDisk</span><br><span class=\"line\">\t\tfi</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\tShowPVFirstMenu</span><br><span class=\"line\">\tGetChoice</span><br><span class=\"line\">\tcase $Var in</span><br><span class=\"line\">\t&quot;1&quot;)</span><br><span class=\"line\">\t\tTitle&#x3D;&#39;Create Physical Volumn&#39;</span><br><span class=\"line\">\t\tParameter&#x3D;pvcreate</span><br><span class=\"line\">\t\tEchoTitle</span><br><span class=\"line\">\t\tNextLine</span><br><span class=\"line\">\t\tChooseDisk</span><br><span class=\"line\">\t\techo &quot;  Disk $Disk Will Be Convert To Physical Volumn&quot;</span><br><span class=\"line\">\t\tConfirmOperate</span><br><span class=\"line\">\t\tStatus&#x3D;0</span><br><span class=\"line\">\t\t;;</span><br><span class=\"line\">\t&quot;2&quot;)</span><br><span class=\"line\">\t\tTitle&#x3D;&#39;Remove Physical Volumn&#39;</span><br><span class=\"line\">\t\tEchoTitle</span><br><span class=\"line\">\t\tParameter&#x3D;pvremove</span><br><span class=\"line\">\t\tNextLine</span><br><span class=\"line\">\t\tChooseDisk</span><br><span class=\"line\">\t\techo &quot;  Disk $Disk Will Be Remove From Physical Volumn&quot;</span><br><span class=\"line\">\t\tConfirmOperate</span><br><span class=\"line\">\t\tStatus&#x3D;0</span><br><span class=\"line\">\t\t;;</span><br><span class=\"line\">\t&quot;3&quot;)</span><br><span class=\"line\">\t\tTitle&#x3D;&#39;Change Physical Volumn&#39;</span><br><span class=\"line\">\t\tEchoTitle</span><br><span class=\"line\">\t\tNextLine</span><br><span class=\"line\">\t\tPVChange</span><br><span class=\"line\">\t\tCheckPVChange</span><br><span class=\"line\">\t\tNextLine</span><br><span class=\"line\">\t\tChooseDisk</span><br><span class=\"line\">\t\techo &quot;  Physical Volumn $Disk Will Be Change&quot;</span><br><span class=\"line\">\t\tConfirmOperate</span><br><span class=\"line\">\t\tStatus&#x3D;0</span><br><span class=\"line\">\t\t;;</span><br><span class=\"line\">\t&quot;4&quot;)</span><br><span class=\"line\">\t\tTitle&#x3D;&#39;Show   Physical Volumn&#39;</span><br><span class=\"line\">\t\tEchoTitle</span><br><span class=\"line\">\t\tNextLine</span><br><span class=\"line\">\t\tPVShow</span><br><span class=\"line\">\t\tNextLine</span><br><span class=\"line\">\t\tTestPVShow</span><br><span class=\"line\">\t\techo &quot;  Physical Volumn $Disk Will Be Show&quot;</span><br><span class=\"line\">\t\tNextLine</span><br><span class=\"line\">\t\tCheckPVShow</span><br><span class=\"line\">\t\tStatus&#x3D;0</span><br><span class=\"line\">\t\t;;</span><br><span class=\"line\">\t&quot;5&quot;)</span><br><span class=\"line\">\t\tTitle&#x3D;&#39;Scan   Physical Volumn&#39;</span><br><span class=\"line\">\t\tEchoTitle</span><br><span class=\"line\">\t\tNextLine</span><br><span class=\"line\">\t\tpvscan</span><br><span class=\"line\">\t\tStatus&#x3D;0</span><br><span class=\"line\">\t\t;;</span><br><span class=\"line\">\t&quot;6&quot;)</span><br><span class=\"line\">\t\texit 0</span><br><span class=\"line\">\t\t;;</span><br><span class=\"line\">\t*)</span><br><span class=\"line\">\t\techo &#39;  Input Error,Retype!&#39;</span><br><span class=\"line\">\t\tPV</span><br><span class=\"line\">\t\t;;</span><br><span class=\"line\">\tesac</span><br><span class=\"line\">\tNeedContinue() &#123;</span><br><span class=\"line\">\t\tif [ $Status -eq 0 ]; then</span><br><span class=\"line\">\t\t\tNextLine</span><br><span class=\"line\">\t\t\tSplit</span><br><span class=\"line\">\t\t\tPV</span><br><span class=\"line\">\t\tfi</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tNeedContinue</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">PV</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<hr>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#!&#x2F;bin&#x2F;bash</span><br><span class=\"line\"># Version 1.0</span><br><span class=\"line\"># AUTHOR:</span><br><span class=\"line\"></span><br><span class=\"line\">#显示分组中的服务器</span><br><span class=\"line\">view_args() &#123;</span><br><span class=\"line\">\tascription&#x3D;$(whiptail --title &quot;归属项目设置&quot; --inputbox &quot;该项目所属项目组&quot; 10 60 3&gt;&amp;1 1&gt;&amp;2 2&gt;&amp;3)</span><br><span class=\"line\">\tif [ $? -eq 1 ];then</span><br><span class=\"line\">\t\t\twhiptail --title &quot;提示！&quot; --msgbox &quot;欢迎您再次使用初始化脚本.&quot; 10 60</span><br><span class=\"line\">\t\t\texit 1</span><br><span class=\"line\">\tfi</span><br><span class=\"line\">\tpname&#x3D;$(whiptail --title &quot;项目设置&quot; --inputbox &quot;项目名称&quot; 10 60 3&gt;&amp;1 1&gt;&amp;2 2&gt;&amp;3)</span><br><span class=\"line\">\t\tif [ $? -eq 1 ];then</span><br><span class=\"line\">\t\t\twhiptail --title &quot;提示！&quot; --msgbox &quot;欢迎您再次使用初始化脚本.&quot; 10 60</span><br><span class=\"line\">\t\t\texit 1</span><br><span class=\"line\">\tfi</span><br><span class=\"line\">\tgit_url&#x3D;$(whiptail --title &quot;项目GIT地址&quot; --inputbox &quot;Git地址&quot; 10 60 3&gt;&amp;1 1&gt;&amp;2 2&gt;&amp;3)</span><br><span class=\"line\">\t\tif [ $? -eq 1 ];then</span><br><span class=\"line\">\t\t\twhiptail --title &quot;提示！&quot; --msgbox &quot;欢迎您再次使用初始化脚本.&quot; 10 60</span><br><span class=\"line\">\t\t\texit 1</span><br><span class=\"line\">\tfi</span><br><span class=\"line\">\tenv&#x3D;$(whiptail --title &quot;项目环境设置&quot; --inputbox &quot;请您输入该项目的环境&quot; 10 60 3&gt;&amp;1 1&gt;&amp;2 2&gt;&amp;3)</span><br><span class=\"line\">\t\tif [ $? -eq 1 ];then</span><br><span class=\"line\">\t\t\twhiptail --title &quot;提示！&quot; --msgbox &quot;欢迎您再次使用初始化脚本.&quot; 10 60</span><br><span class=\"line\">\t\t\texit 1</span><br><span class=\"line\">\tfi</span><br><span class=\"line\">\ttype&#x3D;$(whiptail --title &quot;项目类型设置&quot; --menu &quot;请您选择该项目的类型&quot; 10 60 4 \\</span><br><span class=\"line\">\t\t&quot;Frontnd&quot; &quot;前端项目&quot; \\</span><br><span class=\"line\">\t\t&quot;BackEnd&quot; &quot;后端项目&quot; 3&gt;&amp;1 1&gt;&amp;2 2&gt;&amp;3)</span><br><span class=\"line\">\t\t\tif [ $? -eq 1 ];then</span><br><span class=\"line\">\t\t\twhiptail --title &quot;提示！&quot; --msgbox &quot;欢迎您再次使用初始化脚本.&quot; 10 60</span><br><span class=\"line\">\t\t\texit 1</span><br><span class=\"line\">\tfi</span><br><span class=\"line\">\troot_project_path&#x3D;$(whiptail --title &quot;项目环境设置&quot; --inputbox &quot;部署脚本根目录&quot; 10 60 &quot;&#x2F;tmp&#x2F;deploy&quot; 3&gt;&amp;1 1&gt;&amp;2 2&gt;&amp;3)</span><br><span class=\"line\">\t\tif [ $? -eq 1 ];then</span><br><span class=\"line\">\t\t\twhiptail --title &quot;提示！&quot; --msgbox &quot;欢迎您再次使用初始化脚本.&quot; 10 60</span><br><span class=\"line\">\t\t\texit 1</span><br><span class=\"line\">\tfi</span><br><span class=\"line\">\tback_dir&#x3D;$(whiptail --title &quot;项目环境设置&quot; --inputbox &quot;项目备份路径&quot; 10 60 &quot;&#x2F;ztocwst&#x2F;back&quot; 3&gt;&amp;1 1&gt;&amp;2 2&gt;&amp;3)</span><br><span class=\"line\">\t\tif [ $? -eq 1 ];then</span><br><span class=\"line\">\t\t\twhiptail --title &quot;提示！&quot; --msgbox &quot;欢迎您再次使用初始化脚本.&quot; 10 60</span><br><span class=\"line\">\t\t\texit 1</span><br><span class=\"line\">\tfi</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">view_project() &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\tif [ $&#123;type&#125; &#x3D;&#x3D; &quot;Frontnd&quot; ]; then</span><br><span class=\"line\">\t\techo &quot;&quot;</span><br><span class=\"line\">\t\tfed_project_cmd&#x3D;$(whiptail --title &quot;前端项目设置&quot; --inputbox &quot;前端项目编译命令&quot; 10 60 3&gt;&amp;1 1&gt;&amp;2 2&gt;&amp;3)</span><br><span class=\"line\">\t\t\tif [ $? -eq 1 ];then</span><br><span class=\"line\">\t\t\twhiptail --title &quot;提示！&quot; --msgbox &quot;欢迎您再次使用初始化脚本.&quot; 10 60</span><br><span class=\"line\">\t\t\texit 1</span><br><span class=\"line\">\tfi</span><br><span class=\"line\">\t\tproject_out&#x3D;$(whiptail --title &quot;前端项目设置&quot; --inputbox &quot;前端项目编译输出路径&quot; 10 60 &quot;dist&quot; 3&gt;&amp;1 1&gt;&amp;2 2&gt;&amp;3)</span><br><span class=\"line\">\t\t\tif [ $? -eq 1 ];then</span><br><span class=\"line\">\t\t\twhiptail --title &quot;提示！&quot; --msgbox &quot;欢迎您再次使用初始化脚本.&quot; 10 60</span><br><span class=\"line\">\t\t\texit 1</span><br><span class=\"line\">\tfi</span><br><span class=\"line\">\t\tsite_root&#x3D;$(whiptail --title &quot;前端项目设置&quot; --inputbox &quot;前端项目Nginx指向路径&quot; 10 60 &quot;&#x2F;ztocwst&#x2F;nginx&#x2F;www&quot; 3&gt;&amp;1 1&gt;&amp;2 2&gt;&amp;3)</span><br><span class=\"line\">\t\t\tif [ $? -eq 1 ];then</span><br><span class=\"line\">\t\t\twhiptail --title &quot;提示！&quot; --msgbox &quot;欢迎您再次使用初始化脚本.&quot; 10 60</span><br><span class=\"line\">\t\t\texit 1</span><br><span class=\"line\">\tfi</span><br><span class=\"line\">\t\tdomain_name&#x3D;$(whiptail --title &quot;前端项目设置&quot; --inputbox &quot;前端项目Nginx域名&quot; 10 60 3&gt;&amp;1 1&gt;&amp;2 2&gt;&amp;3)</span><br><span class=\"line\">\t\t\tif [ $? -eq 1 ];then</span><br><span class=\"line\">\t\t\twhiptail --title &quot;提示！&quot; --msgbox &quot;欢迎您再次使用初始化脚本.&quot; 10 60</span><br><span class=\"line\">\t\t\texit 1</span><br><span class=\"line\">\tfi</span><br><span class=\"line\">\telse</span><br><span class=\"line\">\t\techo &quot;&quot;</span><br><span class=\"line\">\t\tproject_cmd&#x3D;$(whiptail --title &quot;后端项目设置&quot; --inputbox &quot;后端项目编译命令&quot; 10 60 3&gt;&amp;1 1&gt;&amp;2 2&gt;&amp;3)</span><br><span class=\"line\">\t\t\tif [ $? -eq 1 ];then</span><br><span class=\"line\">\t\t\twhiptail --title &quot;提示！&quot; --msgbox &quot;欢迎您再次使用初始化脚本.&quot; 10 60</span><br><span class=\"line\">\t\t\texit 1</span><br><span class=\"line\">\tfi</span><br><span class=\"line\">\t\tproject_out&#x3D;$(whiptail --title &quot;后端项目设置&quot; --inputbox &quot;后端项目编译输出路径&quot; 10 60 3&gt;&amp;1 1&gt;&amp;2 2&gt;&amp;3)</span><br><span class=\"line\">\t\t\tif [ $? -eq 1 ];then</span><br><span class=\"line\">\t\t\twhiptail --title &quot;提示！&quot; --msgbox &quot;欢迎您再次使用初始化脚本.&quot; 10 60</span><br><span class=\"line\">\t\t\texit 1</span><br><span class=\"line\">\tfi</span><br><span class=\"line\">\t\tsrc_project_path&#x3D;$(whiptail --title &quot;后端项目设置&quot; --inputbox &quot;后端项目路径&quot; 10 60 &quot;&#x2F;ztocwst&#x2F;service&quot; 3&gt;&amp;1 1&gt;&amp;2 2&gt;&amp;3)</span><br><span class=\"line\">\t\t\tif [ $? -eq 1 ];then</span><br><span class=\"line\">\t\t\twhiptail --title &quot;提示！&quot; --msgbox &quot;欢迎您再次使用初始化脚本.&quot; 10 60</span><br><span class=\"line\">\t\t\texit 1</span><br><span class=\"line\">\tfi</span><br><span class=\"line\">\tfi</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">outconfig() &#123;</span><br><span class=\"line\">\tif [ $&#123;type&#125; &#x3D;&#x3D; &quot;Frontnd&quot; ]; then</span><br><span class=\"line\">\t\techo &quot;&quot;</span><br><span class=\"line\">\t\tmv vars.yml vars.yml-$(date +%Y%m%d%H%M)</span><br><span class=\"line\">cat &gt; vars.yml &lt;&lt;EOF</span><br><span class=\"line\"># *项目环境</span><br><span class=\"line\">env: &quot;$&#123;env&#125;&quot;</span><br><span class=\"line\"></span><br><span class=\"line\"># *项目类型  fed- , tomcat# 前端项目使用</span><br><span class=\"line\">type: &quot;fed-&quot;  </span><br><span class=\"line\"></span><br><span class=\"line\"># *归属项目</span><br><span class=\"line\">ascription: &quot;$&#123;ascription&#125;&quot;</span><br><span class=\"line\"></span><br><span class=\"line\"># *名称</span><br><span class=\"line\">pname: &quot;$&#123;pname&#125;&quot;</span><br><span class=\"line\"></span><br><span class=\"line\"># 域名</span><br><span class=\"line\">domain_name: &quot;$&#123;domain_name&#125;&quot;</span><br><span class=\"line\"></span><br><span class=\"line\"># 前端项目 编译命令</span><br><span class=\"line\">fed_project_cmd: $&#123;fed_project_cmd&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"># *项目git地址</span><br><span class=\"line\">git_url:  &quot;$&#123;git_url&#125;&quot;</span><br><span class=\"line\"></span><br><span class=\"line\"># *输出路径前端一般是 dist</span><br><span class=\"line\">project_out: &quot;$&#123;project_out&#125;&quot;</span><br><span class=\"line\"></span><br><span class=\"line\"># 项目脚本路径</span><br><span class=\"line\">local_project_path: &quot;&#123;&#123; root_project_path &#125;&#125;&#x2F;&#123;&#123; ascription &#125;&#125;&#x2F;&#123;&#123; env &#125;&#125;&#x2F;&#123;&#123; project_name &#125;&#125;&quot;</span><br><span class=\"line\"></span><br><span class=\"line\"># 项目名称</span><br><span class=\"line\">project_name: &quot;&#123;&#123; type &#125;&#125;&#123;&#123; env &#125;&#125;-ztocwst-&#123;&#123; ascription &#125;&#125;-&#123;&#123; pname &#125;&#125;&quot;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># nginx www路径</span><br><span class=\"line\">site_root: &quot;$&#123;site_root&#125;&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">##############  全局参数</span><br><span class=\"line\"># 部署脚本根目录</span><br><span class=\"line\">root_project_path: &quot;$&#123;root_project_path&#125;&quot;</span><br><span class=\"line\"></span><br><span class=\"line\"># 备份路径</span><br><span class=\"line\">back_dir: &quot;$&#123;back_dir&#125;&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">EOF</span><br><span class=\"line\"></span><br><span class=\"line\">\telse</span><br><span class=\"line\">\t\techo &quot;&quot;</span><br><span class=\"line\">\t\tmv vars.yml vars.yml-$(date +%Y%m%d%H%M)</span><br><span class=\"line\">cat &gt; vars.yml &lt;&lt;EOF</span><br><span class=\"line\"># *项目环境</span><br><span class=\"line\">env: &quot;$&#123;env&#125;&quot;</span><br><span class=\"line\"></span><br><span class=\"line\"># *项目类型  fed- , tomcat</span><br><span class=\"line\">type: &quot;&quot;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># *归属项目</span><br><span class=\"line\">ascription: &quot;$&#123;ascription&#125;&quot;</span><br><span class=\"line\"></span><br><span class=\"line\"># *名称</span><br><span class=\"line\">pname: &quot;$&#123;pname&#125;&quot;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># *后端编译命令</span><br><span class=\"line\">project_cmd: &quot;$&#123;project_cmd&#125;&quot;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># *项目git地址</span><br><span class=\"line\">git_url:  &quot;$&#123;git_url&#125;&quot;</span><br><span class=\"line\"></span><br><span class=\"line\"># *编译输出路径</span><br><span class=\"line\">project_out: &quot;$&#123;project_out&#125;&quot;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># 项目脚本路径</span><br><span class=\"line\">local_project_path: &quot;&#123;&#123; root_project_path &#125;&#125;&#x2F;&#123;&#123; ascription &#125;&#125;&#x2F;&#123;&#123; env &#125;&#125;&#x2F;&#123;&#123; project_name &#125;&#125;&quot;</span><br><span class=\"line\"></span><br><span class=\"line\"># 项目名称</span><br><span class=\"line\">project_name: &quot;&#123;&#123; type &#125;&#125;&#123;&#123; env &#125;&#125;-ztocwst-&#123;&#123; ascription &#125;&#125;-&#123;&#123; pname &#125;&#125;&quot;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">##############  全局参数</span><br><span class=\"line\"># 部署脚本根目录</span><br><span class=\"line\">root_project_path: &quot;$&#123;root_project_path&#125;&quot;</span><br><span class=\"line\"></span><br><span class=\"line\"># 备份路径</span><br><span class=\"line\">back_dir: &quot;$&#123;back_dir&#125;&quot;</span><br><span class=\"line\"></span><br><span class=\"line\"># 后端目标服务器项目路径</span><br><span class=\"line\">src_project_path: &quot;$&#123;src_project_path&#125;&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">EOF</span><br><span class=\"line\"></span><br><span class=\"line\">\tfi</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">main()&#123;</span><br><span class=\"line\">\tview_args</span><br><span class=\"line\">\tview_project</span><br><span class=\"line\">\toutconfig</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">main</span><br></pre></td></tr></table></figure>\n\n<hr>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#!&#x2F;bin&#x2F;bash</span><br><span class=\"line\">function Prompt()&#123;</span><br><span class=\"line\">(whiptail --title &quot;IP地址更改(yes&#x2F;no)&quot; --yesno &quot;您是否需要重新配置IP地址？&quot; 10 60)</span><br><span class=\"line\">    if [ $? -eq 0 ];then</span><br><span class=\"line\">        ip_check</span><br><span class=\"line\">    else</span><br><span class=\"line\">        whiptail --title &quot;Nginx提示！&quot; --msgbox &quot;欢迎您再次使用Nginx一键安装服务.&quot; 10 60</span><br><span class=\"line\">        exit 1</span><br><span class=\"line\">    fi</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">function ip_check()&#123;</span><br><span class=\"line\">IP&#x3D;$(whiptail --title &quot;IP地址设置&quot; --inputbox &quot;请您输入您的IP地址&quot; 10 60  3&gt;&amp;1 1&gt;&amp;2 2&gt;&amp;3)</span><br><span class=\"line\">    VALID_CHECK&#x3D;$(echo $IP|awk -F. &#39;$1&lt;&#x3D;255&amp;&amp;$2&lt;&#x3D;255&amp;&amp;$3&lt;&#x3D;255&amp;&amp;$4&lt;&#x3D;255&#123;print &quot;yes&quot;&#125;&#39;)</span><br><span class=\"line\">        if echo $IP|grep -E &quot;^[0-9]&#123;1,3&#125;\\.[0-9]&#123;1,3&#125;\\.[0-9]&#123;1,3&#125;\\.[0-9]&#123;1,3&#125;$&quot; &gt;&#x2F;dev&#x2F;null; then</span><br><span class=\"line\">            if [[ &quot;$VALID_CHECK&quot; &#x3D;&#x3D; &quot;yes&quot; ]]; then</span><br><span class=\"line\">                whiptail --title &quot;IP地址合法提示！&quot; --msgbox &quot;您输入的IP地址正确，点击OK进行下一步配置！.&quot; 10 60</span><br><span class=\"line\">            fi</span><br><span class=\"line\">        else</span><br><span class=\"line\">                whiptail --title &quot;IP地址错误提示！&quot; --msgbox &quot;您输入的IP地址可能有误,请您检查后再次输入！.&quot; 10 60</span><br><span class=\"line\">                Prompt</span><br><span class=\"line\">        fi</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">function install_nginx()&#123;</span><br><span class=\"line\">(whiptail --title &quot;安装 Nginx？(yes&#x2F;no)&quot; --yesno &quot;你是否需要安装Nginx？&quot; 10 60)</span><br><span class=\"line\">    if [ $? -eq 0 ];then</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                sleep 1</span><br><span class=\"line\">                echo 5</span><br><span class=\"line\">                apt-get update &gt;&#x2F;dev&#x2F;null</span><br><span class=\"line\">                sleep 1</span><br><span class=\"line\">                echo 10</span><br><span class=\"line\">                sudo apt-get -y install  build-essential &gt;&#x2F;dev&#x2F;null &amp;</span><br><span class=\"line\">                sleep 1</span><br><span class=\"line\">                echo 30</span><br><span class=\"line\">                sudo apt-get -y install openssl libssl-dev &gt;&#x2F;dev&#x2F;null &amp;</span><br><span class=\"line\">                sleep 1</span><br><span class=\"line\">                echo 50</span><br><span class=\"line\">                sudo apt-get -y install libpcre3 libpcre3-dev &gt;&#x2F;dev&#x2F;null &amp;</span><br><span class=\"line\">                sleep 1</span><br><span class=\"line\">                echo 70</span><br><span class=\"line\">                sudo apt-get -y install zlib1g-dev &gt;&#x2F;dev&#x2F;null &amp;</span><br><span class=\"line\">                sleep 1</span><br><span class=\"line\">                echo 90</span><br><span class=\"line\">                wget -q  http:&#x2F;&#x2F;nginx.org&#x2F;download&#x2F;nginx-1.12.2.tar.gz &gt;&#x2F;dev&#x2F;null  </span><br><span class=\"line\">                sleep 1</span><br><span class=\"line\">                echo 95</span><br><span class=\"line\">                useradd -M -s &#x2F;sbin&#x2F;nologin nginx &amp;</span><br><span class=\"line\">                tar zxf &#x2F;root&#x2F;nginx-1.12.2.tar.gz &amp;&amp; cd &#x2F;root&#x2F;nginx-1.12.2&#x2F; &amp;&amp; </span><br><span class=\"line\">                .&#x2F;configure --prefix&#x3D;&#x2F;usr&#x2F;local&#x2F;nginx --with-http_dav_module --with-http_stub_status_module --with-http_addition_module --with-http_sub_module  --with-http_flv_module --with-http_mp4_module --with-pcre --with-http_ssl_module --with-http_gzip_static_module  --user&#x3D;nginx &gt;&#x2F;dev&#x2F;null &amp;&amp; make &gt;&#x2F;dev&#x2F;null &amp;&amp; make install &gt;&#x2F;dev&#x2F;null</span><br><span class=\"line\">                &#x2F;usr&#x2F;local&#x2F;nginx&#x2F;sbin&#x2F;nginx &amp;&gt;&#x2F;dev&#x2F;null &amp;</span><br><span class=\"line\">                sleep 100</span><br><span class=\"line\">            &#125; |  whiptail --gauge &quot;正在安装Nginx,过程可能需要几分钟请稍后..........&quot; 6 60 0 &amp;&amp;  whiptail --title &quot;Nginx安装成功提示！！！&quot; --msgbox &quot;恭喜您Nginx安装成功，请您访问：http:&#x2F;&#x2F;$IP:80, 感谢使用~~~&quot; 10 60 </span><br><span class=\"line\">    else</span><br><span class=\"line\">        whiptail --title &quot;Nginx提示！！！&quot; --msgbox &quot;感谢使用~~~&quot; 10 60</span><br><span class=\"line\">        exit 1</span><br><span class=\"line\">    fi</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">function mail()&#123;</span><br><span class=\"line\">    ip_check</span><br><span class=\"line\">    install_nginx</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">mail</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"<p>摘要: desc</p>","more":"<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#!&#x2F;bin&#x2F;bash</span><br><span class=\"line\"># Version 1.0</span><br><span class=\"line\"># AUTHOR:Xin23 http:&#x2F;&#x2F;weibo.com&#x2F;231988</span><br><span class=\"line\">PV() &#123;</span><br><span class=\"line\">\tNextLine() &#123;</span><br><span class=\"line\">\t\techo &#39; &#39;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tSplit() &#123;</span><br><span class=\"line\">\t\techo &#39;-----------------------------------------------------------------------&#39;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tEchoTitle() &#123;</span><br><span class=\"line\">\t\techo &quot;--------$Title-----------------------------------------&quot;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tShowPVFirstMenu() &#123;</span><br><span class=\"line\">\t\techo &#39;</span><br><span class=\"line\">       Physical Volumn Main Menu</span><br><span class=\"line\">       Input Number To Choose!</span><br><span class=\"line\">       Create Physical Volumn ...... 1</span><br><span class=\"line\">       Remove Physical Volumn ...... 2</span><br><span class=\"line\">       Change Physical Volumn ...... 3</span><br><span class=\"line\">       Show   Physical Volumn ...... 4</span><br><span class=\"line\">       Scan   Physical Volumn ...... 5</span><br><span class=\"line\">       Exit                   ...... 6&#39;</span><br><span class=\"line\">\t\tNextLine</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tGetChoice() &#123;</span><br><span class=\"line\">\t\tread -p &#39;       Input Your Choice: &#39; Var</span><br><span class=\"line\">\t\tNextLine</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tConfirmOperate() &#123;</span><br><span class=\"line\">\t\tNextLine</span><br><span class=\"line\">\t\techo &quot;  Continue               ...... y</span><br><span class=\"line\">       Return                 ...... n&quot;</span><br><span class=\"line\">\t\tNextLine</span><br><span class=\"line\">\t\tGetChoice</span><br><span class=\"line\">\t\tNextLine</span><br><span class=\"line\">\t\tRun</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tRun() &#123;</span><br><span class=\"line\">\t\tif [ $Var &#x3D;&#x3D; y ]; then</span><br><span class=\"line\">\t\t\t$Parameter $Disk</span><br><span class=\"line\">\t\telif [ $Var &#x3D;&#x3D; n ]; then</span><br><span class=\"line\">\t\t\tSplit</span><br><span class=\"line\">\t\t\tPV</span><br><span class=\"line\">\t\telse</span><br><span class=\"line\">\t\t\tConfirmOperate</span><br><span class=\"line\">\t\tfi</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tChooseDisk() &#123;</span><br><span class=\"line\">\t\tread -p &quot;       Please Choose Disk:    (Example: &#x2F;dev&#x2F;sdc)       &quot; Disk</span><br><span class=\"line\">\t\tNextLine</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tPVChange() &#123;</span><br><span class=\"line\">\t\techo &#39;  Which Operate You Want To do ?  &#39;</span><br><span class=\"line\">\t\tNextLine</span><br><span class=\"line\">\t\techo &#39;        ENABLE  Allocatable    ...... y</span><br><span class=\"line\">       DISABLE Allocatable    ...... n&#39;</span><br><span class=\"line\">\t\tNextLine</span><br><span class=\"line\">\t\tGetChoice</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tCheckPVChange() &#123;</span><br><span class=\"line\">\t\tif [ $Var &#x3D;&#x3D; y ]; then</span><br><span class=\"line\">\t\t\tParameter&#x3D;&#39;pvchange -x y&#39;</span><br><span class=\"line\">\t\telif [ $Var &#x3D;&#x3D; n ]; then</span><br><span class=\"line\">\t\t\tParameter&#x3D;&#39;pvchange -x n&#39;</span><br><span class=\"line\">\t\telse</span><br><span class=\"line\">\t\t\tPVChange</span><br><span class=\"line\">\t\tfi</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tPVShow() &#123;</span><br><span class=\"line\">\t\techo &#39;  Which Physical Volumn You Want To Show ?        &#39;</span><br><span class=\"line\">\t\tNextLine</span><br><span class=\"line\">\t\techo &#39;          All    Physical Volumn ...... 1</span><br><span class=\"line\">       Single Physical Volumn ...... 2&#39;</span><br><span class=\"line\">\t\tNextLine</span><br><span class=\"line\">\t\tGetChoice</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tCheckPVShow() &#123;</span><br><span class=\"line\">\t\tif [ $Var -eq 1 ]; then</span><br><span class=\"line\">\t\t\tpvdisplay</span><br><span class=\"line\">\t\telif [ $Var -eq 2 ]; then</span><br><span class=\"line\">\t\t\tpvdisplay $Disk</span><br><span class=\"line\">\t\tfi</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tTestPVShow() &#123;</span><br><span class=\"line\">\t\tif [ $Var -eq 1 ]; then</span><br><span class=\"line\">\t\t\tDisk&#x3D;All</span><br><span class=\"line\">\t\telif [ $Var -eq 2 ]; then</span><br><span class=\"line\">\t\t\tEchoTitle</span><br><span class=\"line\">\t\t\tNextLine</span><br><span class=\"line\">\t\t\tChooseDisk</span><br><span class=\"line\">\t\tfi</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\tShowPVFirstMenu</span><br><span class=\"line\">\tGetChoice</span><br><span class=\"line\">\tcase $Var in</span><br><span class=\"line\">\t&quot;1&quot;)</span><br><span class=\"line\">\t\tTitle&#x3D;&#39;Create Physical Volumn&#39;</span><br><span class=\"line\">\t\tParameter&#x3D;pvcreate</span><br><span class=\"line\">\t\tEchoTitle</span><br><span class=\"line\">\t\tNextLine</span><br><span class=\"line\">\t\tChooseDisk</span><br><span class=\"line\">\t\techo &quot;  Disk $Disk Will Be Convert To Physical Volumn&quot;</span><br><span class=\"line\">\t\tConfirmOperate</span><br><span class=\"line\">\t\tStatus&#x3D;0</span><br><span class=\"line\">\t\t;;</span><br><span class=\"line\">\t&quot;2&quot;)</span><br><span class=\"line\">\t\tTitle&#x3D;&#39;Remove Physical Volumn&#39;</span><br><span class=\"line\">\t\tEchoTitle</span><br><span class=\"line\">\t\tParameter&#x3D;pvremove</span><br><span class=\"line\">\t\tNextLine</span><br><span class=\"line\">\t\tChooseDisk</span><br><span class=\"line\">\t\techo &quot;  Disk $Disk Will Be Remove From Physical Volumn&quot;</span><br><span class=\"line\">\t\tConfirmOperate</span><br><span class=\"line\">\t\tStatus&#x3D;0</span><br><span class=\"line\">\t\t;;</span><br><span class=\"line\">\t&quot;3&quot;)</span><br><span class=\"line\">\t\tTitle&#x3D;&#39;Change Physical Volumn&#39;</span><br><span class=\"line\">\t\tEchoTitle</span><br><span class=\"line\">\t\tNextLine</span><br><span class=\"line\">\t\tPVChange</span><br><span class=\"line\">\t\tCheckPVChange</span><br><span class=\"line\">\t\tNextLine</span><br><span class=\"line\">\t\tChooseDisk</span><br><span class=\"line\">\t\techo &quot;  Physical Volumn $Disk Will Be Change&quot;</span><br><span class=\"line\">\t\tConfirmOperate</span><br><span class=\"line\">\t\tStatus&#x3D;0</span><br><span class=\"line\">\t\t;;</span><br><span class=\"line\">\t&quot;4&quot;)</span><br><span class=\"line\">\t\tTitle&#x3D;&#39;Show   Physical Volumn&#39;</span><br><span class=\"line\">\t\tEchoTitle</span><br><span class=\"line\">\t\tNextLine</span><br><span class=\"line\">\t\tPVShow</span><br><span class=\"line\">\t\tNextLine</span><br><span class=\"line\">\t\tTestPVShow</span><br><span class=\"line\">\t\techo &quot;  Physical Volumn $Disk Will Be Show&quot;</span><br><span class=\"line\">\t\tNextLine</span><br><span class=\"line\">\t\tCheckPVShow</span><br><span class=\"line\">\t\tStatus&#x3D;0</span><br><span class=\"line\">\t\t;;</span><br><span class=\"line\">\t&quot;5&quot;)</span><br><span class=\"line\">\t\tTitle&#x3D;&#39;Scan   Physical Volumn&#39;</span><br><span class=\"line\">\t\tEchoTitle</span><br><span class=\"line\">\t\tNextLine</span><br><span class=\"line\">\t\tpvscan</span><br><span class=\"line\">\t\tStatus&#x3D;0</span><br><span class=\"line\">\t\t;;</span><br><span class=\"line\">\t&quot;6&quot;)</span><br><span class=\"line\">\t\texit 0</span><br><span class=\"line\">\t\t;;</span><br><span class=\"line\">\t*)</span><br><span class=\"line\">\t\techo &#39;  Input Error,Retype!&#39;</span><br><span class=\"line\">\t\tPV</span><br><span class=\"line\">\t\t;;</span><br><span class=\"line\">\tesac</span><br><span class=\"line\">\tNeedContinue() &#123;</span><br><span class=\"line\">\t\tif [ $Status -eq 0 ]; then</span><br><span class=\"line\">\t\t\tNextLine</span><br><span class=\"line\">\t\t\tSplit</span><br><span class=\"line\">\t\t\tPV</span><br><span class=\"line\">\t\tfi</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tNeedContinue</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">PV</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<hr>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#!&#x2F;bin&#x2F;bash</span><br><span class=\"line\"># Version 1.0</span><br><span class=\"line\"># AUTHOR:</span><br><span class=\"line\"></span><br><span class=\"line\">#显示分组中的服务器</span><br><span class=\"line\">view_args() &#123;</span><br><span class=\"line\">\tascription&#x3D;$(whiptail --title &quot;归属项目设置&quot; --inputbox &quot;该项目所属项目组&quot; 10 60 3&gt;&amp;1 1&gt;&amp;2 2&gt;&amp;3)</span><br><span class=\"line\">\tif [ $? -eq 1 ];then</span><br><span class=\"line\">\t\t\twhiptail --title &quot;提示！&quot; --msgbox &quot;欢迎您再次使用初始化脚本.&quot; 10 60</span><br><span class=\"line\">\t\t\texit 1</span><br><span class=\"line\">\tfi</span><br><span class=\"line\">\tpname&#x3D;$(whiptail --title &quot;项目设置&quot; --inputbox &quot;项目名称&quot; 10 60 3&gt;&amp;1 1&gt;&amp;2 2&gt;&amp;3)</span><br><span class=\"line\">\t\tif [ $? -eq 1 ];then</span><br><span class=\"line\">\t\t\twhiptail --title &quot;提示！&quot; --msgbox &quot;欢迎您再次使用初始化脚本.&quot; 10 60</span><br><span class=\"line\">\t\t\texit 1</span><br><span class=\"line\">\tfi</span><br><span class=\"line\">\tgit_url&#x3D;$(whiptail --title &quot;项目GIT地址&quot; --inputbox &quot;Git地址&quot; 10 60 3&gt;&amp;1 1&gt;&amp;2 2&gt;&amp;3)</span><br><span class=\"line\">\t\tif [ $? -eq 1 ];then</span><br><span class=\"line\">\t\t\twhiptail --title &quot;提示！&quot; --msgbox &quot;欢迎您再次使用初始化脚本.&quot; 10 60</span><br><span class=\"line\">\t\t\texit 1</span><br><span class=\"line\">\tfi</span><br><span class=\"line\">\tenv&#x3D;$(whiptail --title &quot;项目环境设置&quot; --inputbox &quot;请您输入该项目的环境&quot; 10 60 3&gt;&amp;1 1&gt;&amp;2 2&gt;&amp;3)</span><br><span class=\"line\">\t\tif [ $? -eq 1 ];then</span><br><span class=\"line\">\t\t\twhiptail --title &quot;提示！&quot; --msgbox &quot;欢迎您再次使用初始化脚本.&quot; 10 60</span><br><span class=\"line\">\t\t\texit 1</span><br><span class=\"line\">\tfi</span><br><span class=\"line\">\ttype&#x3D;$(whiptail --title &quot;项目类型设置&quot; --menu &quot;请您选择该项目的类型&quot; 10 60 4 \\</span><br><span class=\"line\">\t\t&quot;Frontnd&quot; &quot;前端项目&quot; \\</span><br><span class=\"line\">\t\t&quot;BackEnd&quot; &quot;后端项目&quot; 3&gt;&amp;1 1&gt;&amp;2 2&gt;&amp;3)</span><br><span class=\"line\">\t\t\tif [ $? -eq 1 ];then</span><br><span class=\"line\">\t\t\twhiptail --title &quot;提示！&quot; --msgbox &quot;欢迎您再次使用初始化脚本.&quot; 10 60</span><br><span class=\"line\">\t\t\texit 1</span><br><span class=\"line\">\tfi</span><br><span class=\"line\">\troot_project_path&#x3D;$(whiptail --title &quot;项目环境设置&quot; --inputbox &quot;部署脚本根目录&quot; 10 60 &quot;&#x2F;tmp&#x2F;deploy&quot; 3&gt;&amp;1 1&gt;&amp;2 2&gt;&amp;3)</span><br><span class=\"line\">\t\tif [ $? -eq 1 ];then</span><br><span class=\"line\">\t\t\twhiptail --title &quot;提示！&quot; --msgbox &quot;欢迎您再次使用初始化脚本.&quot; 10 60</span><br><span class=\"line\">\t\t\texit 1</span><br><span class=\"line\">\tfi</span><br><span class=\"line\">\tback_dir&#x3D;$(whiptail --title &quot;项目环境设置&quot; --inputbox &quot;项目备份路径&quot; 10 60 &quot;&#x2F;ztocwst&#x2F;back&quot; 3&gt;&amp;1 1&gt;&amp;2 2&gt;&amp;3)</span><br><span class=\"line\">\t\tif [ $? -eq 1 ];then</span><br><span class=\"line\">\t\t\twhiptail --title &quot;提示！&quot; --msgbox &quot;欢迎您再次使用初始化脚本.&quot; 10 60</span><br><span class=\"line\">\t\t\texit 1</span><br><span class=\"line\">\tfi</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">view_project() &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\tif [ $&#123;type&#125; &#x3D;&#x3D; &quot;Frontnd&quot; ]; then</span><br><span class=\"line\">\t\techo &quot;&quot;</span><br><span class=\"line\">\t\tfed_project_cmd&#x3D;$(whiptail --title &quot;前端项目设置&quot; --inputbox &quot;前端项目编译命令&quot; 10 60 3&gt;&amp;1 1&gt;&amp;2 2&gt;&amp;3)</span><br><span class=\"line\">\t\t\tif [ $? -eq 1 ];then</span><br><span class=\"line\">\t\t\twhiptail --title &quot;提示！&quot; --msgbox &quot;欢迎您再次使用初始化脚本.&quot; 10 60</span><br><span class=\"line\">\t\t\texit 1</span><br><span class=\"line\">\tfi</span><br><span class=\"line\">\t\tproject_out&#x3D;$(whiptail --title &quot;前端项目设置&quot; --inputbox &quot;前端项目编译输出路径&quot; 10 60 &quot;dist&quot; 3&gt;&amp;1 1&gt;&amp;2 2&gt;&amp;3)</span><br><span class=\"line\">\t\t\tif [ $? -eq 1 ];then</span><br><span class=\"line\">\t\t\twhiptail --title &quot;提示！&quot; --msgbox &quot;欢迎您再次使用初始化脚本.&quot; 10 60</span><br><span class=\"line\">\t\t\texit 1</span><br><span class=\"line\">\tfi</span><br><span class=\"line\">\t\tsite_root&#x3D;$(whiptail --title &quot;前端项目设置&quot; --inputbox &quot;前端项目Nginx指向路径&quot; 10 60 &quot;&#x2F;ztocwst&#x2F;nginx&#x2F;www&quot; 3&gt;&amp;1 1&gt;&amp;2 2&gt;&amp;3)</span><br><span class=\"line\">\t\t\tif [ $? -eq 1 ];then</span><br><span class=\"line\">\t\t\twhiptail --title &quot;提示！&quot; --msgbox &quot;欢迎您再次使用初始化脚本.&quot; 10 60</span><br><span class=\"line\">\t\t\texit 1</span><br><span class=\"line\">\tfi</span><br><span class=\"line\">\t\tdomain_name&#x3D;$(whiptail --title &quot;前端项目设置&quot; --inputbox &quot;前端项目Nginx域名&quot; 10 60 3&gt;&amp;1 1&gt;&amp;2 2&gt;&amp;3)</span><br><span class=\"line\">\t\t\tif [ $? -eq 1 ];then</span><br><span class=\"line\">\t\t\twhiptail --title &quot;提示！&quot; --msgbox &quot;欢迎您再次使用初始化脚本.&quot; 10 60</span><br><span class=\"line\">\t\t\texit 1</span><br><span class=\"line\">\tfi</span><br><span class=\"line\">\telse</span><br><span class=\"line\">\t\techo &quot;&quot;</span><br><span class=\"line\">\t\tproject_cmd&#x3D;$(whiptail --title &quot;后端项目设置&quot; --inputbox &quot;后端项目编译命令&quot; 10 60 3&gt;&amp;1 1&gt;&amp;2 2&gt;&amp;3)</span><br><span class=\"line\">\t\t\tif [ $? -eq 1 ];then</span><br><span class=\"line\">\t\t\twhiptail --title &quot;提示！&quot; --msgbox &quot;欢迎您再次使用初始化脚本.&quot; 10 60</span><br><span class=\"line\">\t\t\texit 1</span><br><span class=\"line\">\tfi</span><br><span class=\"line\">\t\tproject_out&#x3D;$(whiptail --title &quot;后端项目设置&quot; --inputbox &quot;后端项目编译输出路径&quot; 10 60 3&gt;&amp;1 1&gt;&amp;2 2&gt;&amp;3)</span><br><span class=\"line\">\t\t\tif [ $? -eq 1 ];then</span><br><span class=\"line\">\t\t\twhiptail --title &quot;提示！&quot; --msgbox &quot;欢迎您再次使用初始化脚本.&quot; 10 60</span><br><span class=\"line\">\t\t\texit 1</span><br><span class=\"line\">\tfi</span><br><span class=\"line\">\t\tsrc_project_path&#x3D;$(whiptail --title &quot;后端项目设置&quot; --inputbox &quot;后端项目路径&quot; 10 60 &quot;&#x2F;ztocwst&#x2F;service&quot; 3&gt;&amp;1 1&gt;&amp;2 2&gt;&amp;3)</span><br><span class=\"line\">\t\t\tif [ $? -eq 1 ];then</span><br><span class=\"line\">\t\t\twhiptail --title &quot;提示！&quot; --msgbox &quot;欢迎您再次使用初始化脚本.&quot; 10 60</span><br><span class=\"line\">\t\t\texit 1</span><br><span class=\"line\">\tfi</span><br><span class=\"line\">\tfi</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">outconfig() &#123;</span><br><span class=\"line\">\tif [ $&#123;type&#125; &#x3D;&#x3D; &quot;Frontnd&quot; ]; then</span><br><span class=\"line\">\t\techo &quot;&quot;</span><br><span class=\"line\">\t\tmv vars.yml vars.yml-$(date +%Y%m%d%H%M)</span><br><span class=\"line\">cat &gt; vars.yml &lt;&lt;EOF</span><br><span class=\"line\"># *项目环境</span><br><span class=\"line\">env: &quot;$&#123;env&#125;&quot;</span><br><span class=\"line\"></span><br><span class=\"line\"># *项目类型  fed- , tomcat# 前端项目使用</span><br><span class=\"line\">type: &quot;fed-&quot;  </span><br><span class=\"line\"></span><br><span class=\"line\"># *归属项目</span><br><span class=\"line\">ascription: &quot;$&#123;ascription&#125;&quot;</span><br><span class=\"line\"></span><br><span class=\"line\"># *名称</span><br><span class=\"line\">pname: &quot;$&#123;pname&#125;&quot;</span><br><span class=\"line\"></span><br><span class=\"line\"># 域名</span><br><span class=\"line\">domain_name: &quot;$&#123;domain_name&#125;&quot;</span><br><span class=\"line\"></span><br><span class=\"line\"># 前端项目 编译命令</span><br><span class=\"line\">fed_project_cmd: $&#123;fed_project_cmd&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"># *项目git地址</span><br><span class=\"line\">git_url:  &quot;$&#123;git_url&#125;&quot;</span><br><span class=\"line\"></span><br><span class=\"line\"># *输出路径前端一般是 dist</span><br><span class=\"line\">project_out: &quot;$&#123;project_out&#125;&quot;</span><br><span class=\"line\"></span><br><span class=\"line\"># 项目脚本路径</span><br><span class=\"line\">local_project_path: &quot;&#123;&#123; root_project_path &#125;&#125;&#x2F;&#123;&#123; ascription &#125;&#125;&#x2F;&#123;&#123; env &#125;&#125;&#x2F;&#123;&#123; project_name &#125;&#125;&quot;</span><br><span class=\"line\"></span><br><span class=\"line\"># 项目名称</span><br><span class=\"line\">project_name: &quot;&#123;&#123; type &#125;&#125;&#123;&#123; env &#125;&#125;-ztocwst-&#123;&#123; ascription &#125;&#125;-&#123;&#123; pname &#125;&#125;&quot;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># nginx www路径</span><br><span class=\"line\">site_root: &quot;$&#123;site_root&#125;&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">##############  全局参数</span><br><span class=\"line\"># 部署脚本根目录</span><br><span class=\"line\">root_project_path: &quot;$&#123;root_project_path&#125;&quot;</span><br><span class=\"line\"></span><br><span class=\"line\"># 备份路径</span><br><span class=\"line\">back_dir: &quot;$&#123;back_dir&#125;&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">EOF</span><br><span class=\"line\"></span><br><span class=\"line\">\telse</span><br><span class=\"line\">\t\techo &quot;&quot;</span><br><span class=\"line\">\t\tmv vars.yml vars.yml-$(date +%Y%m%d%H%M)</span><br><span class=\"line\">cat &gt; vars.yml &lt;&lt;EOF</span><br><span class=\"line\"># *项目环境</span><br><span class=\"line\">env: &quot;$&#123;env&#125;&quot;</span><br><span class=\"line\"></span><br><span class=\"line\"># *项目类型  fed- , tomcat</span><br><span class=\"line\">type: &quot;&quot;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># *归属项目</span><br><span class=\"line\">ascription: &quot;$&#123;ascription&#125;&quot;</span><br><span class=\"line\"></span><br><span class=\"line\"># *名称</span><br><span class=\"line\">pname: &quot;$&#123;pname&#125;&quot;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># *后端编译命令</span><br><span class=\"line\">project_cmd: &quot;$&#123;project_cmd&#125;&quot;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># *项目git地址</span><br><span class=\"line\">git_url:  &quot;$&#123;git_url&#125;&quot;</span><br><span class=\"line\"></span><br><span class=\"line\"># *编译输出路径</span><br><span class=\"line\">project_out: &quot;$&#123;project_out&#125;&quot;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># 项目脚本路径</span><br><span class=\"line\">local_project_path: &quot;&#123;&#123; root_project_path &#125;&#125;&#x2F;&#123;&#123; ascription &#125;&#125;&#x2F;&#123;&#123; env &#125;&#125;&#x2F;&#123;&#123; project_name &#125;&#125;&quot;</span><br><span class=\"line\"></span><br><span class=\"line\"># 项目名称</span><br><span class=\"line\">project_name: &quot;&#123;&#123; type &#125;&#125;&#123;&#123; env &#125;&#125;-ztocwst-&#123;&#123; ascription &#125;&#125;-&#123;&#123; pname &#125;&#125;&quot;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">##############  全局参数</span><br><span class=\"line\"># 部署脚本根目录</span><br><span class=\"line\">root_project_path: &quot;$&#123;root_project_path&#125;&quot;</span><br><span class=\"line\"></span><br><span class=\"line\"># 备份路径</span><br><span class=\"line\">back_dir: &quot;$&#123;back_dir&#125;&quot;</span><br><span class=\"line\"></span><br><span class=\"line\"># 后端目标服务器项目路径</span><br><span class=\"line\">src_project_path: &quot;$&#123;src_project_path&#125;&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">EOF</span><br><span class=\"line\"></span><br><span class=\"line\">\tfi</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">main()&#123;</span><br><span class=\"line\">\tview_args</span><br><span class=\"line\">\tview_project</span><br><span class=\"line\">\toutconfig</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">main</span><br></pre></td></tr></table></figure>\n\n<hr>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#!&#x2F;bin&#x2F;bash</span><br><span class=\"line\">function Prompt()&#123;</span><br><span class=\"line\">(whiptail --title &quot;IP地址更改(yes&#x2F;no)&quot; --yesno &quot;您是否需要重新配置IP地址？&quot; 10 60)</span><br><span class=\"line\">    if [ $? -eq 0 ];then</span><br><span class=\"line\">        ip_check</span><br><span class=\"line\">    else</span><br><span class=\"line\">        whiptail --title &quot;Nginx提示！&quot; --msgbox &quot;欢迎您再次使用Nginx一键安装服务.&quot; 10 60</span><br><span class=\"line\">        exit 1</span><br><span class=\"line\">    fi</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">function ip_check()&#123;</span><br><span class=\"line\">IP&#x3D;$(whiptail --title &quot;IP地址设置&quot; --inputbox &quot;请您输入您的IP地址&quot; 10 60  3&gt;&amp;1 1&gt;&amp;2 2&gt;&amp;3)</span><br><span class=\"line\">    VALID_CHECK&#x3D;$(echo $IP|awk -F. &#39;$1&lt;&#x3D;255&amp;&amp;$2&lt;&#x3D;255&amp;&amp;$3&lt;&#x3D;255&amp;&amp;$4&lt;&#x3D;255&#123;print &quot;yes&quot;&#125;&#39;)</span><br><span class=\"line\">        if echo $IP|grep -E &quot;^[0-9]&#123;1,3&#125;\\.[0-9]&#123;1,3&#125;\\.[0-9]&#123;1,3&#125;\\.[0-9]&#123;1,3&#125;$&quot; &gt;&#x2F;dev&#x2F;null; then</span><br><span class=\"line\">            if [[ &quot;$VALID_CHECK&quot; &#x3D;&#x3D; &quot;yes&quot; ]]; then</span><br><span class=\"line\">                whiptail --title &quot;IP地址合法提示！&quot; --msgbox &quot;您输入的IP地址正确，点击OK进行下一步配置！.&quot; 10 60</span><br><span class=\"line\">            fi</span><br><span class=\"line\">        else</span><br><span class=\"line\">                whiptail --title &quot;IP地址错误提示！&quot; --msgbox &quot;您输入的IP地址可能有误,请您检查后再次输入！.&quot; 10 60</span><br><span class=\"line\">                Prompt</span><br><span class=\"line\">        fi</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">function install_nginx()&#123;</span><br><span class=\"line\">(whiptail --title &quot;安装 Nginx？(yes&#x2F;no)&quot; --yesno &quot;你是否需要安装Nginx？&quot; 10 60)</span><br><span class=\"line\">    if [ $? -eq 0 ];then</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                sleep 1</span><br><span class=\"line\">                echo 5</span><br><span class=\"line\">                apt-get update &gt;&#x2F;dev&#x2F;null</span><br><span class=\"line\">                sleep 1</span><br><span class=\"line\">                echo 10</span><br><span class=\"line\">                sudo apt-get -y install  build-essential &gt;&#x2F;dev&#x2F;null &amp;</span><br><span class=\"line\">                sleep 1</span><br><span class=\"line\">                echo 30</span><br><span class=\"line\">                sudo apt-get -y install openssl libssl-dev &gt;&#x2F;dev&#x2F;null &amp;</span><br><span class=\"line\">                sleep 1</span><br><span class=\"line\">                echo 50</span><br><span class=\"line\">                sudo apt-get -y install libpcre3 libpcre3-dev &gt;&#x2F;dev&#x2F;null &amp;</span><br><span class=\"line\">                sleep 1</span><br><span class=\"line\">                echo 70</span><br><span class=\"line\">                sudo apt-get -y install zlib1g-dev &gt;&#x2F;dev&#x2F;null &amp;</span><br><span class=\"line\">                sleep 1</span><br><span class=\"line\">                echo 90</span><br><span class=\"line\">                wget -q  http:&#x2F;&#x2F;nginx.org&#x2F;download&#x2F;nginx-1.12.2.tar.gz &gt;&#x2F;dev&#x2F;null  </span><br><span class=\"line\">                sleep 1</span><br><span class=\"line\">                echo 95</span><br><span class=\"line\">                useradd -M -s &#x2F;sbin&#x2F;nologin nginx &amp;</span><br><span class=\"line\">                tar zxf &#x2F;root&#x2F;nginx-1.12.2.tar.gz &amp;&amp; cd &#x2F;root&#x2F;nginx-1.12.2&#x2F; &amp;&amp; </span><br><span class=\"line\">                .&#x2F;configure --prefix&#x3D;&#x2F;usr&#x2F;local&#x2F;nginx --with-http_dav_module --with-http_stub_status_module --with-http_addition_module --with-http_sub_module  --with-http_flv_module --with-http_mp4_module --with-pcre --with-http_ssl_module --with-http_gzip_static_module  --user&#x3D;nginx &gt;&#x2F;dev&#x2F;null &amp;&amp; make &gt;&#x2F;dev&#x2F;null &amp;&amp; make install &gt;&#x2F;dev&#x2F;null</span><br><span class=\"line\">                &#x2F;usr&#x2F;local&#x2F;nginx&#x2F;sbin&#x2F;nginx &amp;&gt;&#x2F;dev&#x2F;null &amp;</span><br><span class=\"line\">                sleep 100</span><br><span class=\"line\">            &#125; |  whiptail --gauge &quot;正在安装Nginx,过程可能需要几分钟请稍后..........&quot; 6 60 0 &amp;&amp;  whiptail --title &quot;Nginx安装成功提示！！！&quot; --msgbox &quot;恭喜您Nginx安装成功，请您访问：http:&#x2F;&#x2F;$IP:80, 感谢使用~~~&quot; 10 60 </span><br><span class=\"line\">    else</span><br><span class=\"line\">        whiptail --title &quot;Nginx提示！！！&quot; --msgbox &quot;感谢使用~~~&quot; 10 60</span><br><span class=\"line\">        exit 1</span><br><span class=\"line\">    fi</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">function mail()&#123;</span><br><span class=\"line\">    ip_check</span><br><span class=\"line\">    install_nginx</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">mail</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>"},{"title":"minio安装","date":"2019-12-13T06:00:00.000Z","_content":"\n\n摘要：\n<!-- more -->\n\n### 分布式Minio有什么好处?\n\n在大数据领域，通常的设计理念都是无中心和分布式。Minio分布式模式可以帮助你搭建一个高可用的对象存储服务，你可以使用这些存储设备，而不用考虑其真实物理位置。\n\n**数据保护**\n\n分布式Minio采用 erasure code（纠删码）来防范多个节点宕机和位衰减bit rot。\n\n分布式Minio至少需要4个节点，使用分布式Minio自动引入了纠删码功能。\n\n**高可用**\n\n单机Minio服务存在单点故障，相反，如果是一个N节点的分布式Minio,只要有N/2节点在线，你的数据就是安全的。不过你需要至少有N/2+1个节点 Quorum 来创建新的对象。\n\n例如，一个8节点的Minio集群，每个节点一块盘，就算4个节点宕机，这个集群仍然是可读的，不过你需要5个节点才能写数据。\n\n**限制**\n\n分布式Minio单租户存在最少4个盘最多16个盘的限制（受限于纠删码）。这种限制确保了Minio的简洁，同时仍拥有伸缩性。如果你需要搭建一个多租户环境，你可以轻松的使用编排工具（Kubernetes）来管理多个Minio实例。\n\n注意，只要遵守分布式Minio的限制，你可以组合不同的节点和每个节点几块盘。比如，你可以使用2个节点，每个节点4块盘，也可以使用4个节点，每个节点两块盘，诸如此类。\n\n**一致性**\n\nMinio在分布式和单机模式下，所有读写操作都严格遵守read-after-write一致性模型。\n\n\n\n### 纠删码 (多块硬盘 / 服务)\n\n| 项目           | 参数    |\n| -------------- | ------- |\n| 最大驱动器数量 | 16      |\n| 最小驱动器数量 | 4       |\n| 读仲裁         | N / 2   |\n| 写仲裁         | N / 2+1 |\n\n\n\n\n\n## Minio分布式集群搭建\n\n生产环境建议最少4节点\n\n|  节点   |      IP       |       data       |      home      |\n| :-----: | :-----------: | :--------------: | :------------: |\n| minio01 | 172.28.105.11 | /data/minio_data | /opt/minio/bin |\n| minio02 | 172.28.105.12 | /data/minio_data | /opt/minio/bin |\n| minio03 | 172.28.105.13 | /data/minio_data | /opt/minio/bin |\n| minio04 | 172.28.105.14 | /data/minio_data | /opt/minio/bin |\n\n\n\n### 获取Minio\n\n```\nwget https://dl.min.io/server/minio/release/linux-amd64/minio\n```\n\n### 目录创建\n\n```\nmkdir -p /data/minio_data\nmkdir -p /etc/minio\nmkdir -p /opt/minio/bin\n```\n\n### 集群启动文件\n\n创建/opt/minio/bin/run.sh\n\n```shell\n#!/bin/bash\nexport MINIO_ACCESS_KEY=root\nexport MINIO_SECRET_KEY=12345678\n\n/data/minio/run/minio server --config-dir /etc/minio \\\nhttp://172.28.105.11/data/minio_data \\\nhttp://172.28.105.12/data/minio_data \\\nhttp://172.28.105.13/data/minio_data \\\nhttp://172.28.105.14/data/minio_data \\\n```\n\n- MINIO_ACCESS_KEY：  用户名，长度最小是5个字符\n- MINIO_SECRET_KEY：  密码，密码不能设置过于简单，不然minio会启动失败，长度最小是8个字符\n- --config-dir：  指定集群配置文件目录\n\n### 创建服务\n\n创建/usr/lib/systemd/system/minio.service\n\n- WorkingDirectory：二进制文件目录\n- ExecStart：指定集群启动脚本\n\n\n\n```shell\ncat > /usr/lib/systemd/system/minio.service <<EOF\n[Unit]\nDescription=Minio service\nDocumentation=https://docs.minio.io/\n\n[Service]\nWorkingDirectory=/opt/minio/\nExecStart=/opt/minio/bin/run.sh\n\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\nEOF\n```\n\n### 二进制文件\n\n将minio二进制文件上传到/data/minio/run目录\n\n```\ncp minio /opt/minio/bin\nchmo +x /opt/minio/bin/minio\nchmo +x /opt/minio/bin/run.sh\nchmod +x /usr/lib/systemd/system/minio.service\n```\n\n\n\n### 启动集群\n\n```shell\nsystemctl daemon-reload\nsystemctl enable minio && systemctl start minio\n```\n\n\n\n\n\n## 通过nginx代理集群\n\n### 配置负载均衡\n\n```shell\n#user  nobody;\nworker_processes  1;\n\n#error_log  logs/error.log;\n#error_log  logs/error.log  notice;\n#error_log  logs/error.log  info;\n\n#pid        logs/nginx.pid;\n\n\nevents {\n    worker_connections  1024;\n}\n\n\nhttp {\n    include       mime.types;\n    default_type  application/octet-stream;\n\n    #log_format  main  '$remote_addr - $remote_user [$time_local] \"$request\" '\n    #                  '$status $body_bytes_sent \"$http_referer\" '\n    #                  '\"$http_user_agent\" \"$http_x_forwarded_for\"';\n\n    #access_log  logs/access.log  main;\n\n    sendfile        on;\n    #tcp_nopush     on;\n\n    #keepalive_timeout  0;\n    keepalive_timeout  65;\n\n    #gzip  on;\n\n\tupstream minio{\n\t        server 172.28.105.11:9000;\n\t        server 172.28.105.12:9000;\n\t        server 172.28.105.13:9000;\n\t        server 172.28.105.14:9000;\n\t}\n\n    server {\n        listen 9001;\n        server_name 172.28.105.10;\n        location / {\n                proxy_pass http://minio;\n                proxy_set_header Host $http_host;\n                client_max_body_size 1000m;\n        }\n\t}\n\n}\n```\n\n\n\n\n\n## mc客户端配置\n\n### 下载\n\n```\nwget https://dl.min.io/client/mc/release/linux-amd64/mc\n```\n\n### 简单操作\n\n```\nmc config host add <ALIAS> <YOUR-S3-ENDPOINT> <YOUR-ACCESS-KEY> <YOUR-SECRET-KEY> [--api API-SIGNATURE]\n```\n\n\n\n```csharp\nmc config host add myminio http://172.28.105.11:9000 6FN56FQD3BBYYFHRV8CV 99HwhtPhIpVph+eyNh5ouRcorCBAvGUiVM3LXtuq\n\nmc ls play                    # 列出所有桶\nmc mb myminio/testbucket        # 创建桶\nmc cp io.out myminio/testbucket       # 拷贝测试文件\nmc ls myminio/testbucket           # 列出目录\nmc policy public  myminio/testbucket      # 设置公开权限  [none, download, upload, public]\n```","source":"_posts/minio/minio.md","raw":"---\ntitle: minio安装\ndate: 2019-12-13 14:00:00\ncategories: \n- minio\ntags:\n- minio\n---\n\n\n摘要：\n<!-- more -->\n\n### 分布式Minio有什么好处?\n\n在大数据领域，通常的设计理念都是无中心和分布式。Minio分布式模式可以帮助你搭建一个高可用的对象存储服务，你可以使用这些存储设备，而不用考虑其真实物理位置。\n\n**数据保护**\n\n分布式Minio采用 erasure code（纠删码）来防范多个节点宕机和位衰减bit rot。\n\n分布式Minio至少需要4个节点，使用分布式Minio自动引入了纠删码功能。\n\n**高可用**\n\n单机Minio服务存在单点故障，相反，如果是一个N节点的分布式Minio,只要有N/2节点在线，你的数据就是安全的。不过你需要至少有N/2+1个节点 Quorum 来创建新的对象。\n\n例如，一个8节点的Minio集群，每个节点一块盘，就算4个节点宕机，这个集群仍然是可读的，不过你需要5个节点才能写数据。\n\n**限制**\n\n分布式Minio单租户存在最少4个盘最多16个盘的限制（受限于纠删码）。这种限制确保了Minio的简洁，同时仍拥有伸缩性。如果你需要搭建一个多租户环境，你可以轻松的使用编排工具（Kubernetes）来管理多个Minio实例。\n\n注意，只要遵守分布式Minio的限制，你可以组合不同的节点和每个节点几块盘。比如，你可以使用2个节点，每个节点4块盘，也可以使用4个节点，每个节点两块盘，诸如此类。\n\n**一致性**\n\nMinio在分布式和单机模式下，所有读写操作都严格遵守read-after-write一致性模型。\n\n\n\n### 纠删码 (多块硬盘 / 服务)\n\n| 项目           | 参数    |\n| -------------- | ------- |\n| 最大驱动器数量 | 16      |\n| 最小驱动器数量 | 4       |\n| 读仲裁         | N / 2   |\n| 写仲裁         | N / 2+1 |\n\n\n\n\n\n## Minio分布式集群搭建\n\n生产环境建议最少4节点\n\n|  节点   |      IP       |       data       |      home      |\n| :-----: | :-----------: | :--------------: | :------------: |\n| minio01 | 172.28.105.11 | /data/minio_data | /opt/minio/bin |\n| minio02 | 172.28.105.12 | /data/minio_data | /opt/minio/bin |\n| minio03 | 172.28.105.13 | /data/minio_data | /opt/minio/bin |\n| minio04 | 172.28.105.14 | /data/minio_data | /opt/minio/bin |\n\n\n\n### 获取Minio\n\n```\nwget https://dl.min.io/server/minio/release/linux-amd64/minio\n```\n\n### 目录创建\n\n```\nmkdir -p /data/minio_data\nmkdir -p /etc/minio\nmkdir -p /opt/minio/bin\n```\n\n### 集群启动文件\n\n创建/opt/minio/bin/run.sh\n\n```shell\n#!/bin/bash\nexport MINIO_ACCESS_KEY=root\nexport MINIO_SECRET_KEY=12345678\n\n/data/minio/run/minio server --config-dir /etc/minio \\\nhttp://172.28.105.11/data/minio_data \\\nhttp://172.28.105.12/data/minio_data \\\nhttp://172.28.105.13/data/minio_data \\\nhttp://172.28.105.14/data/minio_data \\\n```\n\n- MINIO_ACCESS_KEY：  用户名，长度最小是5个字符\n- MINIO_SECRET_KEY：  密码，密码不能设置过于简单，不然minio会启动失败，长度最小是8个字符\n- --config-dir：  指定集群配置文件目录\n\n### 创建服务\n\n创建/usr/lib/systemd/system/minio.service\n\n- WorkingDirectory：二进制文件目录\n- ExecStart：指定集群启动脚本\n\n\n\n```shell\ncat > /usr/lib/systemd/system/minio.service <<EOF\n[Unit]\nDescription=Minio service\nDocumentation=https://docs.minio.io/\n\n[Service]\nWorkingDirectory=/opt/minio/\nExecStart=/opt/minio/bin/run.sh\n\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\nEOF\n```\n\n### 二进制文件\n\n将minio二进制文件上传到/data/minio/run目录\n\n```\ncp minio /opt/minio/bin\nchmo +x /opt/minio/bin/minio\nchmo +x /opt/minio/bin/run.sh\nchmod +x /usr/lib/systemd/system/minio.service\n```\n\n\n\n### 启动集群\n\n```shell\nsystemctl daemon-reload\nsystemctl enable minio && systemctl start minio\n```\n\n\n\n\n\n## 通过nginx代理集群\n\n### 配置负载均衡\n\n```shell\n#user  nobody;\nworker_processes  1;\n\n#error_log  logs/error.log;\n#error_log  logs/error.log  notice;\n#error_log  logs/error.log  info;\n\n#pid        logs/nginx.pid;\n\n\nevents {\n    worker_connections  1024;\n}\n\n\nhttp {\n    include       mime.types;\n    default_type  application/octet-stream;\n\n    #log_format  main  '$remote_addr - $remote_user [$time_local] \"$request\" '\n    #                  '$status $body_bytes_sent \"$http_referer\" '\n    #                  '\"$http_user_agent\" \"$http_x_forwarded_for\"';\n\n    #access_log  logs/access.log  main;\n\n    sendfile        on;\n    #tcp_nopush     on;\n\n    #keepalive_timeout  0;\n    keepalive_timeout  65;\n\n    #gzip  on;\n\n\tupstream minio{\n\t        server 172.28.105.11:9000;\n\t        server 172.28.105.12:9000;\n\t        server 172.28.105.13:9000;\n\t        server 172.28.105.14:9000;\n\t}\n\n    server {\n        listen 9001;\n        server_name 172.28.105.10;\n        location / {\n                proxy_pass http://minio;\n                proxy_set_header Host $http_host;\n                client_max_body_size 1000m;\n        }\n\t}\n\n}\n```\n\n\n\n\n\n## mc客户端配置\n\n### 下载\n\n```\nwget https://dl.min.io/client/mc/release/linux-amd64/mc\n```\n\n### 简单操作\n\n```\nmc config host add <ALIAS> <YOUR-S3-ENDPOINT> <YOUR-ACCESS-KEY> <YOUR-SECRET-KEY> [--api API-SIGNATURE]\n```\n\n\n\n```csharp\nmc config host add myminio http://172.28.105.11:9000 6FN56FQD3BBYYFHRV8CV 99HwhtPhIpVph+eyNh5ouRcorCBAvGUiVM3LXtuq\n\nmc ls play                    # 列出所有桶\nmc mb myminio/testbucket        # 创建桶\nmc cp io.out myminio/testbucket       # 拷贝测试文件\nmc ls myminio/testbucket           # 列出目录\nmc policy public  myminio/testbucket      # 设置公开权限  [none, download, upload, public]\n```","slug":"minio/minio","published":1,"updated":"2021-06-18T08:07:11.196Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cku697a08005j00uha5qvcwp7","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><p>摘要：</p>\n<span id=\"more\"></span>\n\n<h3 id=\"分布式Minio有什么好处\"><a href=\"#分布式Minio有什么好处\" class=\"headerlink\" title=\"分布式Minio有什么好处?\"></a>分布式Minio有什么好处?</h3><p>在大数据领域，通常的设计理念都是无中心和分布式。Minio分布式模式可以帮助你搭建一个高可用的对象存储服务，你可以使用这些存储设备，而不用考虑其真实物理位置。</p>\n<p><strong>数据保护</strong></p>\n<p>分布式Minio采用 erasure code（纠删码）来防范多个节点宕机和位衰减bit rot。</p>\n<p>分布式Minio至少需要4个节点，使用分布式Minio自动引入了纠删码功能。</p>\n<p><strong>高可用</strong></p>\n<p>单机Minio服务存在单点故障，相反，如果是一个N节点的分布式Minio,只要有N/2节点在线，你的数据就是安全的。不过你需要至少有N/2+1个节点 Quorum 来创建新的对象。</p>\n<p>例如，一个8节点的Minio集群，每个节点一块盘，就算4个节点宕机，这个集群仍然是可读的，不过你需要5个节点才能写数据。</p>\n<p><strong>限制</strong></p>\n<p>分布式Minio单租户存在最少4个盘最多16个盘的限制（受限于纠删码）。这种限制确保了Minio的简洁，同时仍拥有伸缩性。如果你需要搭建一个多租户环境，你可以轻松的使用编排工具（Kubernetes）来管理多个Minio实例。</p>\n<p>注意，只要遵守分布式Minio的限制，你可以组合不同的节点和每个节点几块盘。比如，你可以使用2个节点，每个节点4块盘，也可以使用4个节点，每个节点两块盘，诸如此类。</p>\n<p><strong>一致性</strong></p>\n<p>Minio在分布式和单机模式下，所有读写操作都严格遵守read-after-write一致性模型。</p>\n<h3 id=\"纠删码-多块硬盘-服务\"><a href=\"#纠删码-多块硬盘-服务\" class=\"headerlink\" title=\"纠删码 (多块硬盘 / 服务)\"></a>纠删码 (多块硬盘 / 服务)</h3><table>\n<thead>\n<tr>\n<th>项目</th>\n<th>参数</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>最大驱动器数量</td>\n<td>16</td>\n</tr>\n<tr>\n<td>最小驱动器数量</td>\n<td>4</td>\n</tr>\n<tr>\n<td>读仲裁</td>\n<td>N / 2</td>\n</tr>\n<tr>\n<td>写仲裁</td>\n<td>N / 2+1</td>\n</tr>\n</tbody></table>\n<h2 id=\"Minio分布式集群搭建\"><a href=\"#Minio分布式集群搭建\" class=\"headerlink\" title=\"Minio分布式集群搭建\"></a>Minio分布式集群搭建</h2><p>生产环境建议最少4节点</p>\n<table>\n<thead>\n<tr>\n<th align=\"center\">节点</th>\n<th align=\"center\">IP</th>\n<th align=\"center\">data</th>\n<th align=\"center\">home</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">minio01</td>\n<td align=\"center\">172.28.105.11</td>\n<td align=\"center\">/data/minio_data</td>\n<td align=\"center\">/opt/minio/bin</td>\n</tr>\n<tr>\n<td align=\"center\">minio02</td>\n<td align=\"center\">172.28.105.12</td>\n<td align=\"center\">/data/minio_data</td>\n<td align=\"center\">/opt/minio/bin</td>\n</tr>\n<tr>\n<td align=\"center\">minio03</td>\n<td align=\"center\">172.28.105.13</td>\n<td align=\"center\">/data/minio_data</td>\n<td align=\"center\">/opt/minio/bin</td>\n</tr>\n<tr>\n<td align=\"center\">minio04</td>\n<td align=\"center\">172.28.105.14</td>\n<td align=\"center\">/data/minio_data</td>\n<td align=\"center\">/opt/minio/bin</td>\n</tr>\n</tbody></table>\n<h3 id=\"获取Minio\"><a href=\"#获取Minio\" class=\"headerlink\" title=\"获取Minio\"></a>获取Minio</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget https:&#x2F;&#x2F;dl.min.io&#x2F;server&#x2F;minio&#x2F;release&#x2F;linux-amd64&#x2F;minio</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"目录创建\"><a href=\"#目录创建\" class=\"headerlink\" title=\"目录创建\"></a>目录创建</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir -p &#x2F;data&#x2F;minio_data</span><br><span class=\"line\">mkdir -p &#x2F;etc&#x2F;minio</span><br><span class=\"line\">mkdir -p &#x2F;opt&#x2F;minio&#x2F;bin</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"集群启动文件\"><a href=\"#集群启动文件\" class=\"headerlink\" title=\"集群启动文件\"></a>集群启动文件</h3><p>创建/opt/minio/bin/run.sh</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">!/bin/bash</span></span><br><span class=\"line\">export MINIO_ACCESS_KEY=root</span><br><span class=\"line\">export MINIO_SECRET_KEY=12345678</span><br><span class=\"line\"></span><br><span class=\"line\">/data/minio/run/minio server --config-dir /etc/minio \\</span><br><span class=\"line\">http://172.28.105.11/data/minio_data \\</span><br><span class=\"line\">http://172.28.105.12/data/minio_data \\</span><br><span class=\"line\">http://172.28.105.13/data/minio_data \\</span><br><span class=\"line\">http://172.28.105.14/data/minio_data \\</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>MINIO_ACCESS_KEY：  用户名，长度最小是5个字符</li>\n<li>MINIO_SECRET_KEY：  密码，密码不能设置过于简单，不然minio会启动失败，长度最小是8个字符</li>\n<li>–config-dir：  指定集群配置文件目录</li>\n</ul>\n<h3 id=\"创建服务\"><a href=\"#创建服务\" class=\"headerlink\" title=\"创建服务\"></a>创建服务</h3><p>创建/usr/lib/systemd/system/minio.service</p>\n<ul>\n<li>WorkingDirectory：二进制文件目录</li>\n<li>ExecStart：指定集群启动脚本</li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cat &gt; /usr/lib/systemd/system/minio.service &lt;&lt;EOF</span><br><span class=\"line\">[Unit]</span><br><span class=\"line\">Description=Minio service</span><br><span class=\"line\">Documentation=https://docs.minio.io/</span><br><span class=\"line\"></span><br><span class=\"line\">[Service]</span><br><span class=\"line\">WorkingDirectory=/opt/minio/</span><br><span class=\"line\">ExecStart=/opt/minio/bin/run.sh</span><br><span class=\"line\"></span><br><span class=\"line\">Restart=on-failure</span><br><span class=\"line\">RestartSec=5</span><br><span class=\"line\"></span><br><span class=\"line\">[Install]</span><br><span class=\"line\">WantedBy=multi-user.target</span><br><span class=\"line\">EOF</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"二进制文件\"><a href=\"#二进制文件\" class=\"headerlink\" title=\"二进制文件\"></a>二进制文件</h3><p>将minio二进制文件上传到/data/minio/run目录</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cp minio &#x2F;opt&#x2F;minio&#x2F;bin</span><br><span class=\"line\">chmo +x &#x2F;opt&#x2F;minio&#x2F;bin&#x2F;minio</span><br><span class=\"line\">chmo +x &#x2F;opt&#x2F;minio&#x2F;bin&#x2F;run.sh</span><br><span class=\"line\">chmod +x &#x2F;usr&#x2F;lib&#x2F;systemd&#x2F;system&#x2F;minio.service</span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"启动集群\"><a href=\"#启动集群\" class=\"headerlink\" title=\"启动集群\"></a>启动集群</h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl daemon-reload</span><br><span class=\"line\">systemctl enable minio &amp;&amp; systemctl start minio</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h2 id=\"通过nginx代理集群\"><a href=\"#通过nginx代理集群\" class=\"headerlink\" title=\"通过nginx代理集群\"></a>通过nginx代理集群</h2><h3 id=\"配置负载均衡\"><a href=\"#配置负载均衡\" class=\"headerlink\" title=\"配置负载均衡\"></a>配置负载均衡</h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">user  nobody;</span></span><br><span class=\"line\">worker_processes  1;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">error_log  logs/error.log;</span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">error_log  logs/error.log  notice;</span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">error_log  logs/error.log  info;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">pid        logs/nginx.pid;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">events &#123;</span><br><span class=\"line\">    worker_connections  1024;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">http &#123;</span><br><span class=\"line\">    include       mime.types;</span><br><span class=\"line\">    default_type  application/octet-stream;</span><br><span class=\"line\"></span><br><span class=\"line\">    #log_format  main  &#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27;</span><br><span class=\"line\">    #                  &#x27;$status $body_bytes_sent &quot;$http_referer&quot; &#x27;</span><br><span class=\"line\">    #                  &#x27;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#x27;;</span><br><span class=\"line\"></span><br><span class=\"line\">    #access_log  logs/access.log  main;</span><br><span class=\"line\"></span><br><span class=\"line\">    sendfile        on;</span><br><span class=\"line\">    #tcp_nopush     on;</span><br><span class=\"line\"></span><br><span class=\"line\">    #keepalive_timeout  0;</span><br><span class=\"line\">    keepalive_timeout  65;</span><br><span class=\"line\"></span><br><span class=\"line\">    #gzip  on;</span><br><span class=\"line\"></span><br><span class=\"line\">\tupstream minio&#123;</span><br><span class=\"line\">\t        server 172.28.105.11:9000;</span><br><span class=\"line\">\t        server 172.28.105.12:9000;</span><br><span class=\"line\">\t        server 172.28.105.13:9000;</span><br><span class=\"line\">\t        server 172.28.105.14:9000;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    server &#123;</span><br><span class=\"line\">        listen 9001;</span><br><span class=\"line\">        server_name 172.28.105.10;</span><br><span class=\"line\">        location / &#123;</span><br><span class=\"line\">                proxy_pass http://minio;</span><br><span class=\"line\">                proxy_set_header Host $http_host;</span><br><span class=\"line\">                client_max_body_size 1000m;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h2 id=\"mc客户端配置\"><a href=\"#mc客户端配置\" class=\"headerlink\" title=\"mc客户端配置\"></a>mc客户端配置</h2><h3 id=\"下载\"><a href=\"#下载\" class=\"headerlink\" title=\"下载\"></a>下载</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget https:&#x2F;&#x2F;dl.min.io&#x2F;client&#x2F;mc&#x2F;release&#x2F;linux-amd64&#x2F;mc</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"简单操作\"><a href=\"#简单操作\" class=\"headerlink\" title=\"简单操作\"></a>简单操作</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mc config host add &lt;ALIAS&gt; &lt;YOUR-S3-ENDPOINT&gt; &lt;YOUR-ACCESS-KEY&gt; &lt;YOUR-SECRET-KEY&gt; [--api API-SIGNATURE]</span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight csharp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mc config host <span class=\"keyword\">add</span> myminio http:<span class=\"comment\">//172.28.105.11:9000 6FN56FQD3BBYYFHRV8CV 99HwhtPhIpVph+eyNh5ouRcorCBAvGUiVM3LXtuq</span></span><br><span class=\"line\"></span><br><span class=\"line\">mc ls play                    <span class=\"meta\"># 列出所有桶</span></span><br><span class=\"line\">mc mb myminio/testbucket        <span class=\"meta\"># 创建桶</span></span><br><span class=\"line\">mc cp io.<span class=\"keyword\">out</span> myminio/testbucket       <span class=\"meta\"># 拷贝测试文件</span></span><br><span class=\"line\">mc ls myminio/testbucket           <span class=\"meta\"># 列出目录</span></span><br><span class=\"line\">mc policy <span class=\"keyword\">public</span>  myminio/testbucket      <span class=\"meta\"># 设置公开权限  [none, download, upload, public]</span></span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"<p>摘要：</p>","more":"<h3 id=\"分布式Minio有什么好处\"><a href=\"#分布式Minio有什么好处\" class=\"headerlink\" title=\"分布式Minio有什么好处?\"></a>分布式Minio有什么好处?</h3><p>在大数据领域，通常的设计理念都是无中心和分布式。Minio分布式模式可以帮助你搭建一个高可用的对象存储服务，你可以使用这些存储设备，而不用考虑其真实物理位置。</p>\n<p><strong>数据保护</strong></p>\n<p>分布式Minio采用 erasure code（纠删码）来防范多个节点宕机和位衰减bit rot。</p>\n<p>分布式Minio至少需要4个节点，使用分布式Minio自动引入了纠删码功能。</p>\n<p><strong>高可用</strong></p>\n<p>单机Minio服务存在单点故障，相反，如果是一个N节点的分布式Minio,只要有N/2节点在线，你的数据就是安全的。不过你需要至少有N/2+1个节点 Quorum 来创建新的对象。</p>\n<p>例如，一个8节点的Minio集群，每个节点一块盘，就算4个节点宕机，这个集群仍然是可读的，不过你需要5个节点才能写数据。</p>\n<p><strong>限制</strong></p>\n<p>分布式Minio单租户存在最少4个盘最多16个盘的限制（受限于纠删码）。这种限制确保了Minio的简洁，同时仍拥有伸缩性。如果你需要搭建一个多租户环境，你可以轻松的使用编排工具（Kubernetes）来管理多个Minio实例。</p>\n<p>注意，只要遵守分布式Minio的限制，你可以组合不同的节点和每个节点几块盘。比如，你可以使用2个节点，每个节点4块盘，也可以使用4个节点，每个节点两块盘，诸如此类。</p>\n<p><strong>一致性</strong></p>\n<p>Minio在分布式和单机模式下，所有读写操作都严格遵守read-after-write一致性模型。</p>\n<h3 id=\"纠删码-多块硬盘-服务\"><a href=\"#纠删码-多块硬盘-服务\" class=\"headerlink\" title=\"纠删码 (多块硬盘 / 服务)\"></a>纠删码 (多块硬盘 / 服务)</h3><table>\n<thead>\n<tr>\n<th>项目</th>\n<th>参数</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>最大驱动器数量</td>\n<td>16</td>\n</tr>\n<tr>\n<td>最小驱动器数量</td>\n<td>4</td>\n</tr>\n<tr>\n<td>读仲裁</td>\n<td>N / 2</td>\n</tr>\n<tr>\n<td>写仲裁</td>\n<td>N / 2+1</td>\n</tr>\n</tbody></table>\n<h2 id=\"Minio分布式集群搭建\"><a href=\"#Minio分布式集群搭建\" class=\"headerlink\" title=\"Minio分布式集群搭建\"></a>Minio分布式集群搭建</h2><p>生产环境建议最少4节点</p>\n<table>\n<thead>\n<tr>\n<th align=\"center\">节点</th>\n<th align=\"center\">IP</th>\n<th align=\"center\">data</th>\n<th align=\"center\">home</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">minio01</td>\n<td align=\"center\">172.28.105.11</td>\n<td align=\"center\">/data/minio_data</td>\n<td align=\"center\">/opt/minio/bin</td>\n</tr>\n<tr>\n<td align=\"center\">minio02</td>\n<td align=\"center\">172.28.105.12</td>\n<td align=\"center\">/data/minio_data</td>\n<td align=\"center\">/opt/minio/bin</td>\n</tr>\n<tr>\n<td align=\"center\">minio03</td>\n<td align=\"center\">172.28.105.13</td>\n<td align=\"center\">/data/minio_data</td>\n<td align=\"center\">/opt/minio/bin</td>\n</tr>\n<tr>\n<td align=\"center\">minio04</td>\n<td align=\"center\">172.28.105.14</td>\n<td align=\"center\">/data/minio_data</td>\n<td align=\"center\">/opt/minio/bin</td>\n</tr>\n</tbody></table>\n<h3 id=\"获取Minio\"><a href=\"#获取Minio\" class=\"headerlink\" title=\"获取Minio\"></a>获取Minio</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget https:&#x2F;&#x2F;dl.min.io&#x2F;server&#x2F;minio&#x2F;release&#x2F;linux-amd64&#x2F;minio</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"目录创建\"><a href=\"#目录创建\" class=\"headerlink\" title=\"目录创建\"></a>目录创建</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir -p &#x2F;data&#x2F;minio_data</span><br><span class=\"line\">mkdir -p &#x2F;etc&#x2F;minio</span><br><span class=\"line\">mkdir -p &#x2F;opt&#x2F;minio&#x2F;bin</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"集群启动文件\"><a href=\"#集群启动文件\" class=\"headerlink\" title=\"集群启动文件\"></a>集群启动文件</h3><p>创建/opt/minio/bin/run.sh</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">!/bin/bash</span></span><br><span class=\"line\">export MINIO_ACCESS_KEY=root</span><br><span class=\"line\">export MINIO_SECRET_KEY=12345678</span><br><span class=\"line\"></span><br><span class=\"line\">/data/minio/run/minio server --config-dir /etc/minio \\</span><br><span class=\"line\">http://172.28.105.11/data/minio_data \\</span><br><span class=\"line\">http://172.28.105.12/data/minio_data \\</span><br><span class=\"line\">http://172.28.105.13/data/minio_data \\</span><br><span class=\"line\">http://172.28.105.14/data/minio_data \\</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>MINIO_ACCESS_KEY：  用户名，长度最小是5个字符</li>\n<li>MINIO_SECRET_KEY：  密码，密码不能设置过于简单，不然minio会启动失败，长度最小是8个字符</li>\n<li>–config-dir：  指定集群配置文件目录</li>\n</ul>\n<h3 id=\"创建服务\"><a href=\"#创建服务\" class=\"headerlink\" title=\"创建服务\"></a>创建服务</h3><p>创建/usr/lib/systemd/system/minio.service</p>\n<ul>\n<li>WorkingDirectory：二进制文件目录</li>\n<li>ExecStart：指定集群启动脚本</li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cat &gt; /usr/lib/systemd/system/minio.service &lt;&lt;EOF</span><br><span class=\"line\">[Unit]</span><br><span class=\"line\">Description=Minio service</span><br><span class=\"line\">Documentation=https://docs.minio.io/</span><br><span class=\"line\"></span><br><span class=\"line\">[Service]</span><br><span class=\"line\">WorkingDirectory=/opt/minio/</span><br><span class=\"line\">ExecStart=/opt/minio/bin/run.sh</span><br><span class=\"line\"></span><br><span class=\"line\">Restart=on-failure</span><br><span class=\"line\">RestartSec=5</span><br><span class=\"line\"></span><br><span class=\"line\">[Install]</span><br><span class=\"line\">WantedBy=multi-user.target</span><br><span class=\"line\">EOF</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"二进制文件\"><a href=\"#二进制文件\" class=\"headerlink\" title=\"二进制文件\"></a>二进制文件</h3><p>将minio二进制文件上传到/data/minio/run目录</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cp minio &#x2F;opt&#x2F;minio&#x2F;bin</span><br><span class=\"line\">chmo +x &#x2F;opt&#x2F;minio&#x2F;bin&#x2F;minio</span><br><span class=\"line\">chmo +x &#x2F;opt&#x2F;minio&#x2F;bin&#x2F;run.sh</span><br><span class=\"line\">chmod +x &#x2F;usr&#x2F;lib&#x2F;systemd&#x2F;system&#x2F;minio.service</span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"启动集群\"><a href=\"#启动集群\" class=\"headerlink\" title=\"启动集群\"></a>启动集群</h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl daemon-reload</span><br><span class=\"line\">systemctl enable minio &amp;&amp; systemctl start minio</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h2 id=\"通过nginx代理集群\"><a href=\"#通过nginx代理集群\" class=\"headerlink\" title=\"通过nginx代理集群\"></a>通过nginx代理集群</h2><h3 id=\"配置负载均衡\"><a href=\"#配置负载均衡\" class=\"headerlink\" title=\"配置负载均衡\"></a>配置负载均衡</h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">user  nobody;</span></span><br><span class=\"line\">worker_processes  1;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">error_log  logs/error.log;</span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">error_log  logs/error.log  notice;</span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">error_log  logs/error.log  info;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">pid        logs/nginx.pid;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">events &#123;</span><br><span class=\"line\">    worker_connections  1024;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">http &#123;</span><br><span class=\"line\">    include       mime.types;</span><br><span class=\"line\">    default_type  application/octet-stream;</span><br><span class=\"line\"></span><br><span class=\"line\">    #log_format  main  &#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27;</span><br><span class=\"line\">    #                  &#x27;$status $body_bytes_sent &quot;$http_referer&quot; &#x27;</span><br><span class=\"line\">    #                  &#x27;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#x27;;</span><br><span class=\"line\"></span><br><span class=\"line\">    #access_log  logs/access.log  main;</span><br><span class=\"line\"></span><br><span class=\"line\">    sendfile        on;</span><br><span class=\"line\">    #tcp_nopush     on;</span><br><span class=\"line\"></span><br><span class=\"line\">    #keepalive_timeout  0;</span><br><span class=\"line\">    keepalive_timeout  65;</span><br><span class=\"line\"></span><br><span class=\"line\">    #gzip  on;</span><br><span class=\"line\"></span><br><span class=\"line\">\tupstream minio&#123;</span><br><span class=\"line\">\t        server 172.28.105.11:9000;</span><br><span class=\"line\">\t        server 172.28.105.12:9000;</span><br><span class=\"line\">\t        server 172.28.105.13:9000;</span><br><span class=\"line\">\t        server 172.28.105.14:9000;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    server &#123;</span><br><span class=\"line\">        listen 9001;</span><br><span class=\"line\">        server_name 172.28.105.10;</span><br><span class=\"line\">        location / &#123;</span><br><span class=\"line\">                proxy_pass http://minio;</span><br><span class=\"line\">                proxy_set_header Host $http_host;</span><br><span class=\"line\">                client_max_body_size 1000m;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h2 id=\"mc客户端配置\"><a href=\"#mc客户端配置\" class=\"headerlink\" title=\"mc客户端配置\"></a>mc客户端配置</h2><h3 id=\"下载\"><a href=\"#下载\" class=\"headerlink\" title=\"下载\"></a>下载</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget https:&#x2F;&#x2F;dl.min.io&#x2F;client&#x2F;mc&#x2F;release&#x2F;linux-amd64&#x2F;mc</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"简单操作\"><a href=\"#简单操作\" class=\"headerlink\" title=\"简单操作\"></a>简单操作</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mc config host add &lt;ALIAS&gt; &lt;YOUR-S3-ENDPOINT&gt; &lt;YOUR-ACCESS-KEY&gt; &lt;YOUR-SECRET-KEY&gt; [--api API-SIGNATURE]</span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight csharp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mc config host <span class=\"keyword\">add</span> myminio http:<span class=\"comment\">//172.28.105.11:9000 6FN56FQD3BBYYFHRV8CV 99HwhtPhIpVph+eyNh5ouRcorCBAvGUiVM3LXtuq</span></span><br><span class=\"line\"></span><br><span class=\"line\">mc ls play                    <span class=\"meta\"># 列出所有桶</span></span><br><span class=\"line\">mc mb myminio/testbucket        <span class=\"meta\"># 创建桶</span></span><br><span class=\"line\">mc cp io.<span class=\"keyword\">out</span> myminio/testbucket       <span class=\"meta\"># 拷贝测试文件</span></span><br><span class=\"line\">mc ls myminio/testbucket           <span class=\"meta\"># 列出目录</span></span><br><span class=\"line\">mc policy <span class=\"keyword\">public</span>  myminio/testbucket      <span class=\"meta\"># 设置公开权限  [none, download, upload, public]</span></span><br></pre></td></tr></table></figure>"},{"title":"minio 集群搭建","date":"2021-03-21T08:25:00.000Z","_content":"  \n  \n摘要: 使用docker 搭建Minio集群\n<!-- more -->\n\n## 注意点\n分布式Minio里的节点时间差不能超过15分钟，你可以使用NTP 来保证时间一致。\n使用docker部署时，如果要使用主机的ip传入host名字，建议使用–net=host该情况下相当于将docker作为一个进程管理工具(类似systemctl)。\nMinio集群部署挂载的目录必须为空目录，且集群的driver组成必须为如下值:4, 6, 8, 10, 12, 14, 16当driver挂掉时，只需保留N/2的节点就能保证只读。如：8节点集群，4个节点下线后集群仍然可读。但在启动数量少于5个节点之前，该集群无法进行写操作。\ndriver定义如下：每台开发机均为一个driver。可配置一台服务器可以通过挂载多个不同阵列增加driver来保证存储可用性。\n集群需要保证ak/sk一致。\n\n\n## 执行\n\n在四台机器上分别上执行run_minio_node.sh\n```\n#!/bin/bash\n# minio node 重启脚本 \naccess_port=9000       #启动监听的端口\nrole=cluster           #备注是集群还是单机 cluster或者Single\nminio_ak=amaocl\nminio_sk=amaocl@123\ndata_path=/data/minio/data\nip_list=(xxx,xxx,xxx,xxx)    #添加ip地址\n\nminio_node_cluster=\" \"\nfor host in ${ip_list[@]} do\n  info=\"http://$host:${access_port}${data_path}\"\n  minio_node_cluster=\"$minio_node_cluster $info\"\ndone\n\nfunction restart_minio_node(){\n  container_name=minio-${role}-${access_port}\n  docker kill $container_name || echo \"ok\"\n  docker rm $container_name || echo \"ok\"\n  docker run --name ${container_name} -d --net=host --restart=always -e \"MINIO_ACCESS_KEY=${minio_ak}\" -e \"MINIO_SECRET_KEY=${minio_sk}\" -v ${data_path}:/data minio/minio server ${minio_node_cluster}\n}\n\nrestart_minio_node\n```","source":"_posts/minio/minio集群搭建.md","raw":"---\ntitle: minio 集群搭建\ndate: 2021-03-21 16:25\ncategories:\n- minio\ntags:\n- minio\n---\n  \n  \n摘要: 使用docker 搭建Minio集群\n<!-- more -->\n\n## 注意点\n分布式Minio里的节点时间差不能超过15分钟，你可以使用NTP 来保证时间一致。\n使用docker部署时，如果要使用主机的ip传入host名字，建议使用–net=host该情况下相当于将docker作为一个进程管理工具(类似systemctl)。\nMinio集群部署挂载的目录必须为空目录，且集群的driver组成必须为如下值:4, 6, 8, 10, 12, 14, 16当driver挂掉时，只需保留N/2的节点就能保证只读。如：8节点集群，4个节点下线后集群仍然可读。但在启动数量少于5个节点之前，该集群无法进行写操作。\ndriver定义如下：每台开发机均为一个driver。可配置一台服务器可以通过挂载多个不同阵列增加driver来保证存储可用性。\n集群需要保证ak/sk一致。\n\n\n## 执行\n\n在四台机器上分别上执行run_minio_node.sh\n```\n#!/bin/bash\n# minio node 重启脚本 \naccess_port=9000       #启动监听的端口\nrole=cluster           #备注是集群还是单机 cluster或者Single\nminio_ak=amaocl\nminio_sk=amaocl@123\ndata_path=/data/minio/data\nip_list=(xxx,xxx,xxx,xxx)    #添加ip地址\n\nminio_node_cluster=\" \"\nfor host in ${ip_list[@]} do\n  info=\"http://$host:${access_port}${data_path}\"\n  minio_node_cluster=\"$minio_node_cluster $info\"\ndone\n\nfunction restart_minio_node(){\n  container_name=minio-${role}-${access_port}\n  docker kill $container_name || echo \"ok\"\n  docker rm $container_name || echo \"ok\"\n  docker run --name ${container_name} -d --net=host --restart=always -e \"MINIO_ACCESS_KEY=${minio_ak}\" -e \"MINIO_SECRET_KEY=${minio_sk}\" -v ${data_path}:/data minio/minio server ${minio_node_cluster}\n}\n\nrestart_minio_node\n```","slug":"minio/minio集群搭建","published":1,"updated":"2021-06-18T08:07:11.197Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cku697a09005n00uhf50lh9g5","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><p>摘要: 使用docker 搭建Minio集群</p>\n<span id=\"more\"></span>\n\n<h2 id=\"注意点\"><a href=\"#注意点\" class=\"headerlink\" title=\"注意点\"></a>注意点</h2><p>分布式Minio里的节点时间差不能超过15分钟，你可以使用NTP 来保证时间一致。<br>使用docker部署时，如果要使用主机的ip传入host名字，建议使用–net=host该情况下相当于将docker作为一个进程管理工具(类似systemctl)。<br>Minio集群部署挂载的目录必须为空目录，且集群的driver组成必须为如下值:4, 6, 8, 10, 12, 14, 16当driver挂掉时，只需保留N/2的节点就能保证只读。如：8节点集群，4个节点下线后集群仍然可读。但在启动数量少于5个节点之前，该集群无法进行写操作。<br>driver定义如下：每台开发机均为一个driver。可配置一台服务器可以通过挂载多个不同阵列增加driver来保证存储可用性。<br>集群需要保证ak/sk一致。</p>\n<h2 id=\"执行\"><a href=\"#执行\" class=\"headerlink\" title=\"执行\"></a>执行</h2><p>在四台机器上分别上执行run_minio_node.sh</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#!&#x2F;bin&#x2F;bash</span><br><span class=\"line\"># minio node 重启脚本 </span><br><span class=\"line\">access_port&#x3D;9000       #启动监听的端口</span><br><span class=\"line\">role&#x3D;cluster           #备注是集群还是单机 cluster或者Single</span><br><span class=\"line\">minio_ak&#x3D;amaocl</span><br><span class=\"line\">minio_sk&#x3D;amaocl@123</span><br><span class=\"line\">data_path&#x3D;&#x2F;data&#x2F;minio&#x2F;data</span><br><span class=\"line\">ip_list&#x3D;(xxx,xxx,xxx,xxx)    #添加ip地址</span><br><span class=\"line\"></span><br><span class=\"line\">minio_node_cluster&#x3D;&quot; &quot;</span><br><span class=\"line\">for host in $&#123;ip_list[@]&#125; do</span><br><span class=\"line\">  info&#x3D;&quot;http:&#x2F;&#x2F;$host:$&#123;access_port&#125;$&#123;data_path&#125;&quot;</span><br><span class=\"line\">  minio_node_cluster&#x3D;&quot;$minio_node_cluster $info&quot;</span><br><span class=\"line\">done</span><br><span class=\"line\"></span><br><span class=\"line\">function restart_minio_node()&#123;</span><br><span class=\"line\">  container_name&#x3D;minio-$&#123;role&#125;-$&#123;access_port&#125;</span><br><span class=\"line\">  docker kill $container_name || echo &quot;ok&quot;</span><br><span class=\"line\">  docker rm $container_name || echo &quot;ok&quot;</span><br><span class=\"line\">  docker run --name $&#123;container_name&#125; -d --net&#x3D;host --restart&#x3D;always -e &quot;MINIO_ACCESS_KEY&#x3D;$&#123;minio_ak&#125;&quot; -e &quot;MINIO_SECRET_KEY&#x3D;$&#123;minio_sk&#125;&quot; -v $&#123;data_path&#125;:&#x2F;data minio&#x2F;minio server $&#123;minio_node_cluster&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">restart_minio_node</span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"<p>摘要: 使用docker 搭建Minio集群</p>","more":"<h2 id=\"注意点\"><a href=\"#注意点\" class=\"headerlink\" title=\"注意点\"></a>注意点</h2><p>分布式Minio里的节点时间差不能超过15分钟，你可以使用NTP 来保证时间一致。<br>使用docker部署时，如果要使用主机的ip传入host名字，建议使用–net=host该情况下相当于将docker作为一个进程管理工具(类似systemctl)。<br>Minio集群部署挂载的目录必须为空目录，且集群的driver组成必须为如下值:4, 6, 8, 10, 12, 14, 16当driver挂掉时，只需保留N/2的节点就能保证只读。如：8节点集群，4个节点下线后集群仍然可读。但在启动数量少于5个节点之前，该集群无法进行写操作。<br>driver定义如下：每台开发机均为一个driver。可配置一台服务器可以通过挂载多个不同阵列增加driver来保证存储可用性。<br>集群需要保证ak/sk一致。</p>\n<h2 id=\"执行\"><a href=\"#执行\" class=\"headerlink\" title=\"执行\"></a>执行</h2><p>在四台机器上分别上执行run_minio_node.sh</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#!&#x2F;bin&#x2F;bash</span><br><span class=\"line\"># minio node 重启脚本 </span><br><span class=\"line\">access_port&#x3D;9000       #启动监听的端口</span><br><span class=\"line\">role&#x3D;cluster           #备注是集群还是单机 cluster或者Single</span><br><span class=\"line\">minio_ak&#x3D;amaocl</span><br><span class=\"line\">minio_sk&#x3D;amaocl@123</span><br><span class=\"line\">data_path&#x3D;&#x2F;data&#x2F;minio&#x2F;data</span><br><span class=\"line\">ip_list&#x3D;(xxx,xxx,xxx,xxx)    #添加ip地址</span><br><span class=\"line\"></span><br><span class=\"line\">minio_node_cluster&#x3D;&quot; &quot;</span><br><span class=\"line\">for host in $&#123;ip_list[@]&#125; do</span><br><span class=\"line\">  info&#x3D;&quot;http:&#x2F;&#x2F;$host:$&#123;access_port&#125;$&#123;data_path&#125;&quot;</span><br><span class=\"line\">  minio_node_cluster&#x3D;&quot;$minio_node_cluster $info&quot;</span><br><span class=\"line\">done</span><br><span class=\"line\"></span><br><span class=\"line\">function restart_minio_node()&#123;</span><br><span class=\"line\">  container_name&#x3D;minio-$&#123;role&#125;-$&#123;access_port&#125;</span><br><span class=\"line\">  docker kill $container_name || echo &quot;ok&quot;</span><br><span class=\"line\">  docker rm $container_name || echo &quot;ok&quot;</span><br><span class=\"line\">  docker run --name $&#123;container_name&#125; -d --net&#x3D;host --restart&#x3D;always -e &quot;MINIO_ACCESS_KEY&#x3D;$&#123;minio_ak&#125;&quot; -e &quot;MINIO_SECRET_KEY&#x3D;$&#123;minio_sk&#125;&quot; -v $&#123;data_path&#125;:&#x2F;data minio&#x2F;minio server $&#123;minio_node_cluster&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">restart_minio_node</span><br></pre></td></tr></table></figure>"},{"title":"minio分布式部署","date":"2021-03-21T08:39:00.000Z","_content":"  \n  \n摘要: minio分布式部署(非docker方式)\n<!-- more -->\n\n\n## 一、Minio分布式集群搭建（多机器多硬盘）\n### 1、环境说明\n4台服务器\n\n\n|节点|\t数据目录(不能是/root下的)| 进程/脚本目录 |\n|---|---|---|\n|10.34.252.87 |\t/home/minio/{data1.data2} |\t/home/minio/{run}|\n|10.34.252.88 |\t/home/minio/{data1.data2} |\t/home/minio/{run}|\n|10.34.252.89 |\t/home/minio/{data1.data2} |\t/home/minio/{run}|\n|10.34.252.93 |\t/home/minio/{data1.data2} |\t/home/minio/{run}|\n\n\n\n### 2、创建目录(4台集群主机都执行)\nmkdir -p /home/minio/{run,data1,data2} && mkdir -p /etc/minio\n\n\n### 3、从官网获取Minio二进制文件并上传至4台集群主机\n\n下载二进制文件：\n```\nwget https://dl.min.io/server/minio/release/linux-amd64/minio\n```\n\n上传Minio到4台集群主机进程脚本目录 /home/minio/run\n```\nscp,ftp等方式\n```\n\n### 4、集群启动文件配置(4台集群主机都执行)\n>Minio默认9000端口，在配置文件中加入–address \"127.0.0.1:9029\" 可更改端口\n注意:\nMINIO_ACCESS_KEY：用户名，长度最小是5个字符\nMINIO_SECRET_KEY：密码，密码不能设置过于简单，不然minio会启动失败，长度最小是8个字符\n–config-dir：指定集群配置文件目录\n\n```\nvim /home/minio/run/minio-run.sh\n```\n\n集群节点10.34.252.87内容为:\n```\n#!/bin/bash\nexport MINIO_ACCESS_KEY=admin\nexport MINIO_SECRET_KEY=admin123\n/home/minio/run/minio server --config-dir /etc/minio \\\n--address \"10.34.252.87:9000\" \\\nhttp://10.34.252.87/home/minio/data1 http://10.34.252.87/home/minio/data2 \\\nhttp://10.34.252.88/home/minio/data1 http://10.34.252.88/home/minio/data2 \\\nhttp://10.34.252.89/home/minio/data1 http://10.34.252.89/home/minio/data2 \\\nhttp://10.34.252.93/home/minio/data1 http://10.34.252.93/home/minio/data2\n```\n\n集群节点10.34.252.88内容为:\n```\n#!/bin/bash\nexport MINIO_ACCESS_KEY=admin\nexport MINIO_SECRET_KEY=admin123\n/home/minio/run/minio server --config-dir /etc/minio \\\n--address \"10.34.252.88:9000\" \\\nhttp://10.34.252.87/home/minio/data1 http://10.34.252.87/home/minio/data2 \\\nhttp://10.34.252.88/home/minio/data1 http://10.34.252.88/home/minio/data2 \\\nhttp://10.34.252.89/home/minio/data1 http://10.34.252.89/home/minio/data2 \\\nhttp://10.34.252.93/home/minio/data1 http://10.34.252.93/home/minio/data2\n```\n\n集群节点10.34.252.89内容为:\n```\n#!/bin/bash\nexport MINIO_ACCESS_KEY=admin\nexport MINIO_SECRET_KEY=admin123\n/home/minio/run/minio server --config-dir /etc/minio \\\n--address \"10.34.252.89:9000\" \\\nhttp://10.34.252.87/home/minio/data1 http://10.34.252.87/home/minio/data2 \\\nhttp://10.34.252.88/home/minio/data1 http://10.34.252.88/home/minio/data2 \\\nhttp://10.34.252.89/home/minio/data1 http://10.34.252.89/home/minio/data2 \\\nhttp://10.34.252.93/home/minio/data1 http://10.34.252.93/home/minio/data2\n```\n\n集群节点10.34.252.93内容为:\n```\n#!/bin/bash\nexport MINIO_ACCESS_KEY=admin\nexport MINIO_SECRET_KEY=admin123\n/home/minio/run/minio server --config-dir /etc/minio \\\n--address \"10.34.252.93:9000\" \\\nhttp://10.34.252.87/home/minio/data1 http://10.34.252.87/home/minio/data2 \\\nhttp://10.34.252.88/home/minio/data1 http://10.34.252.88/home/minio/data2 \\\nhttp://10.34.252.89/home/minio/data1 http://10.34.252.89/home/minio/data2 \\\nhttp://10.34.252.93/home/minio/data1 http://10.34.252.93/home/minio/data2\n```\n\n\n### 创建Minio.server,将minio加入系统服务（4台集群主机都执行）\n\n```\nvim /usr/lib/systemd/system/minio.service\n```\n```\n[Unit]\nDescription=Minio service\nDocumentation=https://docs.minio.io/\n\n[Service]\nWorkingDirectory=/home/minio/run/\nExecStart=/home/minio/run/minio-run.sh\n\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\n```\n\n### 权限修改（4台集群主机都执行）\n```\nchmod +x /usr/lib/systemd/system/minio.service && chmod +x /home/minio/run/minio && chmod +x /home/minio/run/minio-run.sh\n```\n\n### 启动集群（4台集群主机都执行）\n```\nsystemctl daemon-reload\nsystemctl start minio\nsystemctl enable minio\n```\n\n### 查看集群状态\n```\nsystemctl status minio.service -l\n```\n\n日志类似以下内容，则启动成功:\n\n```\n[root@cn-gri-gicar-bdms-05 csz]# systemctl status minio.service -l\n● minio.service - Minio service\n   Loaded: loaded (/usr/lib/systemd/system/minio.service; enabled; vendor preset: disabled)\n   Active: active (running) since Fri 2021-01-22 10:44:29 CST; 43min ago\n     Docs: https://docs.minio.io/\n Main PID: 3663052 (minio-run.sh)\n    Tasks: 41\n   Memory: 89.2M\n   CGroup: /system.slice/minio.service\n           ├─3663052 /bin/bash /root/docker/minio/run/minio-run.sh\n           └─3663053 /root/docker/minio/run/minio server --config-dir /etc/minio --address 10.34.252.87:9000 http://10.34.252.87/home/minio/data1 http://10.34.252.87/home/minio/data2 http://10.34.252.88/home/minio/data1 http://10.34.252.88/home/minio/data2 http://10.34.252.89/home/minio/data1 http://10.34.252.89/home/minio/data2 http://10.34.252.93/home/minio/data1 http://10.34.252.93/home/minio/data2\n\nJan 22 10:44:32 cn-gri-gicar-bdms-05 minio-run.sh[3663052]: Endpoint: http://10.34.252.87:9000\nJan 22 10:44:32 cn-gri-gicar-bdms-05 minio-run.sh[3663052]: Browser Access:\nJan 22 10:44:32 cn-gri-gicar-bdms-05 minio-run.sh[3663052]: http://10.34.252.87:9000\nJan 22 10:44:32 cn-gri-gicar-bdms-05 minio-run.sh[3663052]: Object API (Amazon S3 compatible):\nJan 22 10:44:32 cn-gri-gicar-bdms-05 minio-run.sh[3663052]: Go:         https://docs.min.io/docs/golang-client-quickstart-guide\nJan 22 10:44:32 cn-gri-gicar-bdms-05 minio-run.sh[3663052]: Java:       https://docs.min.io/docs/java-client-quickstart-guide\nJan 22 10:44:32 cn-gri-gicar-bdms-05 minio-run.sh[3663052]: Python:     https://docs.min.io/docs/python-client-quickstart-guide\nJan 22 10:44:32 cn-gri-gicar-bdms-05 minio-run.sh[3663052]: JavaScript: https://docs.min.io/docs/javascript-client-quickstart-guide\nJan 22 10:44:32 cn-gri-gicar-bdms-05 minio-run.sh[3663052]: .NET:       https://docs.min.io/docs/dotnet-client-quickstart-guide\nJan 22 10:44:32 cn-gri-gicar-bdms-05 minio-run.sh[3663052]: Waiting for all MinIO IAM sub-system to be initialized.. lock acquired\n```\n\n\n### 登录页面测试\n登录任一页面\n\n### 测试\n\n创建 bucket 并上传两个文件，在到4台集群主机查看存储情况\n","source":"_posts/minio/minio分布式部署.md","raw":"---\ntitle: minio分布式部署\ndate: 2021-03-21 16:39\ncategories:\n- minio\ntags:\n- minio\n---\n  \n  \n摘要: minio分布式部署(非docker方式)\n<!-- more -->\n\n\n## 一、Minio分布式集群搭建（多机器多硬盘）\n### 1、环境说明\n4台服务器\n\n\n|节点|\t数据目录(不能是/root下的)| 进程/脚本目录 |\n|---|---|---|\n|10.34.252.87 |\t/home/minio/{data1.data2} |\t/home/minio/{run}|\n|10.34.252.88 |\t/home/minio/{data1.data2} |\t/home/minio/{run}|\n|10.34.252.89 |\t/home/minio/{data1.data2} |\t/home/minio/{run}|\n|10.34.252.93 |\t/home/minio/{data1.data2} |\t/home/minio/{run}|\n\n\n\n### 2、创建目录(4台集群主机都执行)\nmkdir -p /home/minio/{run,data1,data2} && mkdir -p /etc/minio\n\n\n### 3、从官网获取Minio二进制文件并上传至4台集群主机\n\n下载二进制文件：\n```\nwget https://dl.min.io/server/minio/release/linux-amd64/minio\n```\n\n上传Minio到4台集群主机进程脚本目录 /home/minio/run\n```\nscp,ftp等方式\n```\n\n### 4、集群启动文件配置(4台集群主机都执行)\n>Minio默认9000端口，在配置文件中加入–address \"127.0.0.1:9029\" 可更改端口\n注意:\nMINIO_ACCESS_KEY：用户名，长度最小是5个字符\nMINIO_SECRET_KEY：密码，密码不能设置过于简单，不然minio会启动失败，长度最小是8个字符\n–config-dir：指定集群配置文件目录\n\n```\nvim /home/minio/run/minio-run.sh\n```\n\n集群节点10.34.252.87内容为:\n```\n#!/bin/bash\nexport MINIO_ACCESS_KEY=admin\nexport MINIO_SECRET_KEY=admin123\n/home/minio/run/minio server --config-dir /etc/minio \\\n--address \"10.34.252.87:9000\" \\\nhttp://10.34.252.87/home/minio/data1 http://10.34.252.87/home/minio/data2 \\\nhttp://10.34.252.88/home/minio/data1 http://10.34.252.88/home/minio/data2 \\\nhttp://10.34.252.89/home/minio/data1 http://10.34.252.89/home/minio/data2 \\\nhttp://10.34.252.93/home/minio/data1 http://10.34.252.93/home/minio/data2\n```\n\n集群节点10.34.252.88内容为:\n```\n#!/bin/bash\nexport MINIO_ACCESS_KEY=admin\nexport MINIO_SECRET_KEY=admin123\n/home/minio/run/minio server --config-dir /etc/minio \\\n--address \"10.34.252.88:9000\" \\\nhttp://10.34.252.87/home/minio/data1 http://10.34.252.87/home/minio/data2 \\\nhttp://10.34.252.88/home/minio/data1 http://10.34.252.88/home/minio/data2 \\\nhttp://10.34.252.89/home/minio/data1 http://10.34.252.89/home/minio/data2 \\\nhttp://10.34.252.93/home/minio/data1 http://10.34.252.93/home/minio/data2\n```\n\n集群节点10.34.252.89内容为:\n```\n#!/bin/bash\nexport MINIO_ACCESS_KEY=admin\nexport MINIO_SECRET_KEY=admin123\n/home/minio/run/minio server --config-dir /etc/minio \\\n--address \"10.34.252.89:9000\" \\\nhttp://10.34.252.87/home/minio/data1 http://10.34.252.87/home/minio/data2 \\\nhttp://10.34.252.88/home/minio/data1 http://10.34.252.88/home/minio/data2 \\\nhttp://10.34.252.89/home/minio/data1 http://10.34.252.89/home/minio/data2 \\\nhttp://10.34.252.93/home/minio/data1 http://10.34.252.93/home/minio/data2\n```\n\n集群节点10.34.252.93内容为:\n```\n#!/bin/bash\nexport MINIO_ACCESS_KEY=admin\nexport MINIO_SECRET_KEY=admin123\n/home/minio/run/minio server --config-dir /etc/minio \\\n--address \"10.34.252.93:9000\" \\\nhttp://10.34.252.87/home/minio/data1 http://10.34.252.87/home/minio/data2 \\\nhttp://10.34.252.88/home/minio/data1 http://10.34.252.88/home/minio/data2 \\\nhttp://10.34.252.89/home/minio/data1 http://10.34.252.89/home/minio/data2 \\\nhttp://10.34.252.93/home/minio/data1 http://10.34.252.93/home/minio/data2\n```\n\n\n### 创建Minio.server,将minio加入系统服务（4台集群主机都执行）\n\n```\nvim /usr/lib/systemd/system/minio.service\n```\n```\n[Unit]\nDescription=Minio service\nDocumentation=https://docs.minio.io/\n\n[Service]\nWorkingDirectory=/home/minio/run/\nExecStart=/home/minio/run/minio-run.sh\n\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\n```\n\n### 权限修改（4台集群主机都执行）\n```\nchmod +x /usr/lib/systemd/system/minio.service && chmod +x /home/minio/run/minio && chmod +x /home/minio/run/minio-run.sh\n```\n\n### 启动集群（4台集群主机都执行）\n```\nsystemctl daemon-reload\nsystemctl start minio\nsystemctl enable minio\n```\n\n### 查看集群状态\n```\nsystemctl status minio.service -l\n```\n\n日志类似以下内容，则启动成功:\n\n```\n[root@cn-gri-gicar-bdms-05 csz]# systemctl status minio.service -l\n● minio.service - Minio service\n   Loaded: loaded (/usr/lib/systemd/system/minio.service; enabled; vendor preset: disabled)\n   Active: active (running) since Fri 2021-01-22 10:44:29 CST; 43min ago\n     Docs: https://docs.minio.io/\n Main PID: 3663052 (minio-run.sh)\n    Tasks: 41\n   Memory: 89.2M\n   CGroup: /system.slice/minio.service\n           ├─3663052 /bin/bash /root/docker/minio/run/minio-run.sh\n           └─3663053 /root/docker/minio/run/minio server --config-dir /etc/minio --address 10.34.252.87:9000 http://10.34.252.87/home/minio/data1 http://10.34.252.87/home/minio/data2 http://10.34.252.88/home/minio/data1 http://10.34.252.88/home/minio/data2 http://10.34.252.89/home/minio/data1 http://10.34.252.89/home/minio/data2 http://10.34.252.93/home/minio/data1 http://10.34.252.93/home/minio/data2\n\nJan 22 10:44:32 cn-gri-gicar-bdms-05 minio-run.sh[3663052]: Endpoint: http://10.34.252.87:9000\nJan 22 10:44:32 cn-gri-gicar-bdms-05 minio-run.sh[3663052]: Browser Access:\nJan 22 10:44:32 cn-gri-gicar-bdms-05 minio-run.sh[3663052]: http://10.34.252.87:9000\nJan 22 10:44:32 cn-gri-gicar-bdms-05 minio-run.sh[3663052]: Object API (Amazon S3 compatible):\nJan 22 10:44:32 cn-gri-gicar-bdms-05 minio-run.sh[3663052]: Go:         https://docs.min.io/docs/golang-client-quickstart-guide\nJan 22 10:44:32 cn-gri-gicar-bdms-05 minio-run.sh[3663052]: Java:       https://docs.min.io/docs/java-client-quickstart-guide\nJan 22 10:44:32 cn-gri-gicar-bdms-05 minio-run.sh[3663052]: Python:     https://docs.min.io/docs/python-client-quickstart-guide\nJan 22 10:44:32 cn-gri-gicar-bdms-05 minio-run.sh[3663052]: JavaScript: https://docs.min.io/docs/javascript-client-quickstart-guide\nJan 22 10:44:32 cn-gri-gicar-bdms-05 minio-run.sh[3663052]: .NET:       https://docs.min.io/docs/dotnet-client-quickstart-guide\nJan 22 10:44:32 cn-gri-gicar-bdms-05 minio-run.sh[3663052]: Waiting for all MinIO IAM sub-system to be initialized.. lock acquired\n```\n\n\n### 登录页面测试\n登录任一页面\n\n### 测试\n\n创建 bucket 并上传两个文件，在到4台集群主机查看存储情况\n","slug":"minio/minio分布式部署","published":1,"updated":"2021-06-18T08:07:11.197Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cku697a0a005q00uhepbuagka","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><p>摘要: minio分布式部署(非docker方式)</p>\n<span id=\"more\"></span>\n\n\n<h2 id=\"一、Minio分布式集群搭建（多机器多硬盘）\"><a href=\"#一、Minio分布式集群搭建（多机器多硬盘）\" class=\"headerlink\" title=\"一、Minio分布式集群搭建（多机器多硬盘）\"></a>一、Minio分布式集群搭建（多机器多硬盘）</h2><h3 id=\"1、环境说明\"><a href=\"#1、环境说明\" class=\"headerlink\" title=\"1、环境说明\"></a>1、环境说明</h3><p>4台服务器</p>\n<table>\n<thead>\n<tr>\n<th>节点</th>\n<th>数据目录(不能是/root下的)</th>\n<th>进程/脚本目录</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>10.34.252.87</td>\n<td>/home/minio/{data1.data2}</td>\n<td>/home/minio/{run}</td>\n</tr>\n<tr>\n<td>10.34.252.88</td>\n<td>/home/minio/{data1.data2}</td>\n<td>/home/minio/{run}</td>\n</tr>\n<tr>\n<td>10.34.252.89</td>\n<td>/home/minio/{data1.data2}</td>\n<td>/home/minio/{run}</td>\n</tr>\n<tr>\n<td>10.34.252.93</td>\n<td>/home/minio/{data1.data2}</td>\n<td>/home/minio/{run}</td>\n</tr>\n</tbody></table>\n<h3 id=\"2、创建目录-4台集群主机都执行\"><a href=\"#2、创建目录-4台集群主机都执行\" class=\"headerlink\" title=\"2、创建目录(4台集群主机都执行)\"></a>2、创建目录(4台集群主机都执行)</h3><p>mkdir -p /home/minio/{run,data1,data2} &amp;&amp; mkdir -p /etc/minio</p>\n<h3 id=\"3、从官网获取Minio二进制文件并上传至4台集群主机\"><a href=\"#3、从官网获取Minio二进制文件并上传至4台集群主机\" class=\"headerlink\" title=\"3、从官网获取Minio二进制文件并上传至4台集群主机\"></a>3、从官网获取Minio二进制文件并上传至4台集群主机</h3><p>下载二进制文件：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget https:&#x2F;&#x2F;dl.min.io&#x2F;server&#x2F;minio&#x2F;release&#x2F;linux-amd64&#x2F;minio</span><br></pre></td></tr></table></figure>\n\n<p>上传Minio到4台集群主机进程脚本目录 /home/minio/run</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">scp,ftp等方式</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"4、集群启动文件配置-4台集群主机都执行\"><a href=\"#4、集群启动文件配置-4台集群主机都执行\" class=\"headerlink\" title=\"4、集群启动文件配置(4台集群主机都执行)\"></a>4、集群启动文件配置(4台集群主机都执行)</h3><blockquote>\n<p>Minio默认9000端口，在配置文件中加入–address “127.0.0.1:9029” 可更改端口<br>注意:<br>MINIO_ACCESS_KEY：用户名，长度最小是5个字符<br>MINIO_SECRET_KEY：密码，密码不能设置过于简单，不然minio会启动失败，长度最小是8个字符<br>–config-dir：指定集群配置文件目录</p>\n</blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim &#x2F;home&#x2F;minio&#x2F;run&#x2F;minio-run.sh</span><br></pre></td></tr></table></figure>\n\n<p>集群节点10.34.252.87内容为:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#!&#x2F;bin&#x2F;bash</span><br><span class=\"line\">export MINIO_ACCESS_KEY&#x3D;admin</span><br><span class=\"line\">export MINIO_SECRET_KEY&#x3D;admin123</span><br><span class=\"line\">&#x2F;home&#x2F;minio&#x2F;run&#x2F;minio server --config-dir &#x2F;etc&#x2F;minio \\</span><br><span class=\"line\">--address &quot;10.34.252.87:9000&quot; \\</span><br><span class=\"line\">http:&#x2F;&#x2F;10.34.252.87&#x2F;home&#x2F;minio&#x2F;data1 http:&#x2F;&#x2F;10.34.252.87&#x2F;home&#x2F;minio&#x2F;data2 \\</span><br><span class=\"line\">http:&#x2F;&#x2F;10.34.252.88&#x2F;home&#x2F;minio&#x2F;data1 http:&#x2F;&#x2F;10.34.252.88&#x2F;home&#x2F;minio&#x2F;data2 \\</span><br><span class=\"line\">http:&#x2F;&#x2F;10.34.252.89&#x2F;home&#x2F;minio&#x2F;data1 http:&#x2F;&#x2F;10.34.252.89&#x2F;home&#x2F;minio&#x2F;data2 \\</span><br><span class=\"line\">http:&#x2F;&#x2F;10.34.252.93&#x2F;home&#x2F;minio&#x2F;data1 http:&#x2F;&#x2F;10.34.252.93&#x2F;home&#x2F;minio&#x2F;data2</span><br></pre></td></tr></table></figure>\n\n<p>集群节点10.34.252.88内容为:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#!&#x2F;bin&#x2F;bash</span><br><span class=\"line\">export MINIO_ACCESS_KEY&#x3D;admin</span><br><span class=\"line\">export MINIO_SECRET_KEY&#x3D;admin123</span><br><span class=\"line\">&#x2F;home&#x2F;minio&#x2F;run&#x2F;minio server --config-dir &#x2F;etc&#x2F;minio \\</span><br><span class=\"line\">--address &quot;10.34.252.88:9000&quot; \\</span><br><span class=\"line\">http:&#x2F;&#x2F;10.34.252.87&#x2F;home&#x2F;minio&#x2F;data1 http:&#x2F;&#x2F;10.34.252.87&#x2F;home&#x2F;minio&#x2F;data2 \\</span><br><span class=\"line\">http:&#x2F;&#x2F;10.34.252.88&#x2F;home&#x2F;minio&#x2F;data1 http:&#x2F;&#x2F;10.34.252.88&#x2F;home&#x2F;minio&#x2F;data2 \\</span><br><span class=\"line\">http:&#x2F;&#x2F;10.34.252.89&#x2F;home&#x2F;minio&#x2F;data1 http:&#x2F;&#x2F;10.34.252.89&#x2F;home&#x2F;minio&#x2F;data2 \\</span><br><span class=\"line\">http:&#x2F;&#x2F;10.34.252.93&#x2F;home&#x2F;minio&#x2F;data1 http:&#x2F;&#x2F;10.34.252.93&#x2F;home&#x2F;minio&#x2F;data2</span><br></pre></td></tr></table></figure>\n\n<p>集群节点10.34.252.89内容为:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#!&#x2F;bin&#x2F;bash</span><br><span class=\"line\">export MINIO_ACCESS_KEY&#x3D;admin</span><br><span class=\"line\">export MINIO_SECRET_KEY&#x3D;admin123</span><br><span class=\"line\">&#x2F;home&#x2F;minio&#x2F;run&#x2F;minio server --config-dir &#x2F;etc&#x2F;minio \\</span><br><span class=\"line\">--address &quot;10.34.252.89:9000&quot; \\</span><br><span class=\"line\">http:&#x2F;&#x2F;10.34.252.87&#x2F;home&#x2F;minio&#x2F;data1 http:&#x2F;&#x2F;10.34.252.87&#x2F;home&#x2F;minio&#x2F;data2 \\</span><br><span class=\"line\">http:&#x2F;&#x2F;10.34.252.88&#x2F;home&#x2F;minio&#x2F;data1 http:&#x2F;&#x2F;10.34.252.88&#x2F;home&#x2F;minio&#x2F;data2 \\</span><br><span class=\"line\">http:&#x2F;&#x2F;10.34.252.89&#x2F;home&#x2F;minio&#x2F;data1 http:&#x2F;&#x2F;10.34.252.89&#x2F;home&#x2F;minio&#x2F;data2 \\</span><br><span class=\"line\">http:&#x2F;&#x2F;10.34.252.93&#x2F;home&#x2F;minio&#x2F;data1 http:&#x2F;&#x2F;10.34.252.93&#x2F;home&#x2F;minio&#x2F;data2</span><br></pre></td></tr></table></figure>\n\n<p>集群节点10.34.252.93内容为:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#!&#x2F;bin&#x2F;bash</span><br><span class=\"line\">export MINIO_ACCESS_KEY&#x3D;admin</span><br><span class=\"line\">export MINIO_SECRET_KEY&#x3D;admin123</span><br><span class=\"line\">&#x2F;home&#x2F;minio&#x2F;run&#x2F;minio server --config-dir &#x2F;etc&#x2F;minio \\</span><br><span class=\"line\">--address &quot;10.34.252.93:9000&quot; \\</span><br><span class=\"line\">http:&#x2F;&#x2F;10.34.252.87&#x2F;home&#x2F;minio&#x2F;data1 http:&#x2F;&#x2F;10.34.252.87&#x2F;home&#x2F;minio&#x2F;data2 \\</span><br><span class=\"line\">http:&#x2F;&#x2F;10.34.252.88&#x2F;home&#x2F;minio&#x2F;data1 http:&#x2F;&#x2F;10.34.252.88&#x2F;home&#x2F;minio&#x2F;data2 \\</span><br><span class=\"line\">http:&#x2F;&#x2F;10.34.252.89&#x2F;home&#x2F;minio&#x2F;data1 http:&#x2F;&#x2F;10.34.252.89&#x2F;home&#x2F;minio&#x2F;data2 \\</span><br><span class=\"line\">http:&#x2F;&#x2F;10.34.252.93&#x2F;home&#x2F;minio&#x2F;data1 http:&#x2F;&#x2F;10.34.252.93&#x2F;home&#x2F;minio&#x2F;data2</span><br></pre></td></tr></table></figure>\n\n\n<h3 id=\"创建Minio-server-将minio加入系统服务（4台集群主机都执行）\"><a href=\"#创建Minio-server-将minio加入系统服务（4台集群主机都执行）\" class=\"headerlink\" title=\"创建Minio.server,将minio加入系统服务（4台集群主机都执行）\"></a>创建Minio.server,将minio加入系统服务（4台集群主机都执行）</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim &#x2F;usr&#x2F;lib&#x2F;systemd&#x2F;system&#x2F;minio.service</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[Unit]</span><br><span class=\"line\">Description&#x3D;Minio service</span><br><span class=\"line\">Documentation&#x3D;https:&#x2F;&#x2F;docs.minio.io&#x2F;</span><br><span class=\"line\"></span><br><span class=\"line\">[Service]</span><br><span class=\"line\">WorkingDirectory&#x3D;&#x2F;home&#x2F;minio&#x2F;run&#x2F;</span><br><span class=\"line\">ExecStart&#x3D;&#x2F;home&#x2F;minio&#x2F;run&#x2F;minio-run.sh</span><br><span class=\"line\"></span><br><span class=\"line\">Restart&#x3D;on-failure</span><br><span class=\"line\">RestartSec&#x3D;5</span><br><span class=\"line\"></span><br><span class=\"line\">[Install]</span><br><span class=\"line\">WantedBy&#x3D;multi-user.target</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"权限修改（4台集群主机都执行）\"><a href=\"#权限修改（4台集群主机都执行）\" class=\"headerlink\" title=\"权限修改（4台集群主机都执行）\"></a>权限修改（4台集群主机都执行）</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">chmod +x &#x2F;usr&#x2F;lib&#x2F;systemd&#x2F;system&#x2F;minio.service &amp;&amp; chmod +x &#x2F;home&#x2F;minio&#x2F;run&#x2F;minio &amp;&amp; chmod +x &#x2F;home&#x2F;minio&#x2F;run&#x2F;minio-run.sh</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"启动集群（4台集群主机都执行）\"><a href=\"#启动集群（4台集群主机都执行）\" class=\"headerlink\" title=\"启动集群（4台集群主机都执行）\"></a>启动集群（4台集群主机都执行）</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl daemon-reload</span><br><span class=\"line\">systemctl start minio</span><br><span class=\"line\">systemctl enable minio</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"查看集群状态\"><a href=\"#查看集群状态\" class=\"headerlink\" title=\"查看集群状态\"></a>查看集群状态</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl status minio.service -l</span><br></pre></td></tr></table></figure>\n\n<p>日志类似以下内容，则启动成功:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@cn-gri-gicar-bdms-05 csz]# systemctl status minio.service -l</span><br><span class=\"line\">● minio.service - Minio service</span><br><span class=\"line\">   Loaded: loaded (&#x2F;usr&#x2F;lib&#x2F;systemd&#x2F;system&#x2F;minio.service; enabled; vendor preset: disabled)</span><br><span class=\"line\">   Active: active (running) since Fri 2021-01-22 10:44:29 CST; 43min ago</span><br><span class=\"line\">     Docs: https:&#x2F;&#x2F;docs.minio.io&#x2F;</span><br><span class=\"line\"> Main PID: 3663052 (minio-run.sh)</span><br><span class=\"line\">    Tasks: 41</span><br><span class=\"line\">   Memory: 89.2M</span><br><span class=\"line\">   CGroup: &#x2F;system.slice&#x2F;minio.service</span><br><span class=\"line\">           ├─3663052 &#x2F;bin&#x2F;bash &#x2F;root&#x2F;docker&#x2F;minio&#x2F;run&#x2F;minio-run.sh</span><br><span class=\"line\">           └─3663053 &#x2F;root&#x2F;docker&#x2F;minio&#x2F;run&#x2F;minio server --config-dir &#x2F;etc&#x2F;minio --address 10.34.252.87:9000 http:&#x2F;&#x2F;10.34.252.87&#x2F;home&#x2F;minio&#x2F;data1 http:&#x2F;&#x2F;10.34.252.87&#x2F;home&#x2F;minio&#x2F;data2 http:&#x2F;&#x2F;10.34.252.88&#x2F;home&#x2F;minio&#x2F;data1 http:&#x2F;&#x2F;10.34.252.88&#x2F;home&#x2F;minio&#x2F;data2 http:&#x2F;&#x2F;10.34.252.89&#x2F;home&#x2F;minio&#x2F;data1 http:&#x2F;&#x2F;10.34.252.89&#x2F;home&#x2F;minio&#x2F;data2 http:&#x2F;&#x2F;10.34.252.93&#x2F;home&#x2F;minio&#x2F;data1 http:&#x2F;&#x2F;10.34.252.93&#x2F;home&#x2F;minio&#x2F;data2</span><br><span class=\"line\"></span><br><span class=\"line\">Jan 22 10:44:32 cn-gri-gicar-bdms-05 minio-run.sh[3663052]: Endpoint: http:&#x2F;&#x2F;10.34.252.87:9000</span><br><span class=\"line\">Jan 22 10:44:32 cn-gri-gicar-bdms-05 minio-run.sh[3663052]: Browser Access:</span><br><span class=\"line\">Jan 22 10:44:32 cn-gri-gicar-bdms-05 minio-run.sh[3663052]: http:&#x2F;&#x2F;10.34.252.87:9000</span><br><span class=\"line\">Jan 22 10:44:32 cn-gri-gicar-bdms-05 minio-run.sh[3663052]: Object API (Amazon S3 compatible):</span><br><span class=\"line\">Jan 22 10:44:32 cn-gri-gicar-bdms-05 minio-run.sh[3663052]: Go:         https:&#x2F;&#x2F;docs.min.io&#x2F;docs&#x2F;golang-client-quickstart-guide</span><br><span class=\"line\">Jan 22 10:44:32 cn-gri-gicar-bdms-05 minio-run.sh[3663052]: Java:       https:&#x2F;&#x2F;docs.min.io&#x2F;docs&#x2F;java-client-quickstart-guide</span><br><span class=\"line\">Jan 22 10:44:32 cn-gri-gicar-bdms-05 minio-run.sh[3663052]: Python:     https:&#x2F;&#x2F;docs.min.io&#x2F;docs&#x2F;python-client-quickstart-guide</span><br><span class=\"line\">Jan 22 10:44:32 cn-gri-gicar-bdms-05 minio-run.sh[3663052]: JavaScript: https:&#x2F;&#x2F;docs.min.io&#x2F;docs&#x2F;javascript-client-quickstart-guide</span><br><span class=\"line\">Jan 22 10:44:32 cn-gri-gicar-bdms-05 minio-run.sh[3663052]: .NET:       https:&#x2F;&#x2F;docs.min.io&#x2F;docs&#x2F;dotnet-client-quickstart-guide</span><br><span class=\"line\">Jan 22 10:44:32 cn-gri-gicar-bdms-05 minio-run.sh[3663052]: Waiting for all MinIO IAM sub-system to be initialized.. lock acquired</span><br></pre></td></tr></table></figure>\n\n\n<h3 id=\"登录页面测试\"><a href=\"#登录页面测试\" class=\"headerlink\" title=\"登录页面测试\"></a>登录页面测试</h3><p>登录任一页面</p>\n<h3 id=\"测试\"><a href=\"#测试\" class=\"headerlink\" title=\"测试\"></a>测试</h3><p>创建 bucket 并上传两个文件，在到4台集群主机查看存储情况</p>\n","site":{"data":{}},"excerpt":"<p>摘要: minio分布式部署(非docker方式)</p>","more":"<h2 id=\"一、Minio分布式集群搭建（多机器多硬盘）\"><a href=\"#一、Minio分布式集群搭建（多机器多硬盘）\" class=\"headerlink\" title=\"一、Minio分布式集群搭建（多机器多硬盘）\"></a>一、Minio分布式集群搭建（多机器多硬盘）</h2><h3 id=\"1、环境说明\"><a href=\"#1、环境说明\" class=\"headerlink\" title=\"1、环境说明\"></a>1、环境说明</h3><p>4台服务器</p>\n<table>\n<thead>\n<tr>\n<th>节点</th>\n<th>数据目录(不能是/root下的)</th>\n<th>进程/脚本目录</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>10.34.252.87</td>\n<td>/home/minio/{data1.data2}</td>\n<td>/home/minio/{run}</td>\n</tr>\n<tr>\n<td>10.34.252.88</td>\n<td>/home/minio/{data1.data2}</td>\n<td>/home/minio/{run}</td>\n</tr>\n<tr>\n<td>10.34.252.89</td>\n<td>/home/minio/{data1.data2}</td>\n<td>/home/minio/{run}</td>\n</tr>\n<tr>\n<td>10.34.252.93</td>\n<td>/home/minio/{data1.data2}</td>\n<td>/home/minio/{run}</td>\n</tr>\n</tbody></table>\n<h3 id=\"2、创建目录-4台集群主机都执行\"><a href=\"#2、创建目录-4台集群主机都执行\" class=\"headerlink\" title=\"2、创建目录(4台集群主机都执行)\"></a>2、创建目录(4台集群主机都执行)</h3><p>mkdir -p /home/minio/{run,data1,data2} &amp;&amp; mkdir -p /etc/minio</p>\n<h3 id=\"3、从官网获取Minio二进制文件并上传至4台集群主机\"><a href=\"#3、从官网获取Minio二进制文件并上传至4台集群主机\" class=\"headerlink\" title=\"3、从官网获取Minio二进制文件并上传至4台集群主机\"></a>3、从官网获取Minio二进制文件并上传至4台集群主机</h3><p>下载二进制文件：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget https:&#x2F;&#x2F;dl.min.io&#x2F;server&#x2F;minio&#x2F;release&#x2F;linux-amd64&#x2F;minio</span><br></pre></td></tr></table></figure>\n\n<p>上传Minio到4台集群主机进程脚本目录 /home/minio/run</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">scp,ftp等方式</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"4、集群启动文件配置-4台集群主机都执行\"><a href=\"#4、集群启动文件配置-4台集群主机都执行\" class=\"headerlink\" title=\"4、集群启动文件配置(4台集群主机都执行)\"></a>4、集群启动文件配置(4台集群主机都执行)</h3><blockquote>\n<p>Minio默认9000端口，在配置文件中加入–address “127.0.0.1:9029” 可更改端口<br>注意:<br>MINIO_ACCESS_KEY：用户名，长度最小是5个字符<br>MINIO_SECRET_KEY：密码，密码不能设置过于简单，不然minio会启动失败，长度最小是8个字符<br>–config-dir：指定集群配置文件目录</p>\n</blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim &#x2F;home&#x2F;minio&#x2F;run&#x2F;minio-run.sh</span><br></pre></td></tr></table></figure>\n\n<p>集群节点10.34.252.87内容为:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#!&#x2F;bin&#x2F;bash</span><br><span class=\"line\">export MINIO_ACCESS_KEY&#x3D;admin</span><br><span class=\"line\">export MINIO_SECRET_KEY&#x3D;admin123</span><br><span class=\"line\">&#x2F;home&#x2F;minio&#x2F;run&#x2F;minio server --config-dir &#x2F;etc&#x2F;minio \\</span><br><span class=\"line\">--address &quot;10.34.252.87:9000&quot; \\</span><br><span class=\"line\">http:&#x2F;&#x2F;10.34.252.87&#x2F;home&#x2F;minio&#x2F;data1 http:&#x2F;&#x2F;10.34.252.87&#x2F;home&#x2F;minio&#x2F;data2 \\</span><br><span class=\"line\">http:&#x2F;&#x2F;10.34.252.88&#x2F;home&#x2F;minio&#x2F;data1 http:&#x2F;&#x2F;10.34.252.88&#x2F;home&#x2F;minio&#x2F;data2 \\</span><br><span class=\"line\">http:&#x2F;&#x2F;10.34.252.89&#x2F;home&#x2F;minio&#x2F;data1 http:&#x2F;&#x2F;10.34.252.89&#x2F;home&#x2F;minio&#x2F;data2 \\</span><br><span class=\"line\">http:&#x2F;&#x2F;10.34.252.93&#x2F;home&#x2F;minio&#x2F;data1 http:&#x2F;&#x2F;10.34.252.93&#x2F;home&#x2F;minio&#x2F;data2</span><br></pre></td></tr></table></figure>\n\n<p>集群节点10.34.252.88内容为:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#!&#x2F;bin&#x2F;bash</span><br><span class=\"line\">export MINIO_ACCESS_KEY&#x3D;admin</span><br><span class=\"line\">export MINIO_SECRET_KEY&#x3D;admin123</span><br><span class=\"line\">&#x2F;home&#x2F;minio&#x2F;run&#x2F;minio server --config-dir &#x2F;etc&#x2F;minio \\</span><br><span class=\"line\">--address &quot;10.34.252.88:9000&quot; \\</span><br><span class=\"line\">http:&#x2F;&#x2F;10.34.252.87&#x2F;home&#x2F;minio&#x2F;data1 http:&#x2F;&#x2F;10.34.252.87&#x2F;home&#x2F;minio&#x2F;data2 \\</span><br><span class=\"line\">http:&#x2F;&#x2F;10.34.252.88&#x2F;home&#x2F;minio&#x2F;data1 http:&#x2F;&#x2F;10.34.252.88&#x2F;home&#x2F;minio&#x2F;data2 \\</span><br><span class=\"line\">http:&#x2F;&#x2F;10.34.252.89&#x2F;home&#x2F;minio&#x2F;data1 http:&#x2F;&#x2F;10.34.252.89&#x2F;home&#x2F;minio&#x2F;data2 \\</span><br><span class=\"line\">http:&#x2F;&#x2F;10.34.252.93&#x2F;home&#x2F;minio&#x2F;data1 http:&#x2F;&#x2F;10.34.252.93&#x2F;home&#x2F;minio&#x2F;data2</span><br></pre></td></tr></table></figure>\n\n<p>集群节点10.34.252.89内容为:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#!&#x2F;bin&#x2F;bash</span><br><span class=\"line\">export MINIO_ACCESS_KEY&#x3D;admin</span><br><span class=\"line\">export MINIO_SECRET_KEY&#x3D;admin123</span><br><span class=\"line\">&#x2F;home&#x2F;minio&#x2F;run&#x2F;minio server --config-dir &#x2F;etc&#x2F;minio \\</span><br><span class=\"line\">--address &quot;10.34.252.89:9000&quot; \\</span><br><span class=\"line\">http:&#x2F;&#x2F;10.34.252.87&#x2F;home&#x2F;minio&#x2F;data1 http:&#x2F;&#x2F;10.34.252.87&#x2F;home&#x2F;minio&#x2F;data2 \\</span><br><span class=\"line\">http:&#x2F;&#x2F;10.34.252.88&#x2F;home&#x2F;minio&#x2F;data1 http:&#x2F;&#x2F;10.34.252.88&#x2F;home&#x2F;minio&#x2F;data2 \\</span><br><span class=\"line\">http:&#x2F;&#x2F;10.34.252.89&#x2F;home&#x2F;minio&#x2F;data1 http:&#x2F;&#x2F;10.34.252.89&#x2F;home&#x2F;minio&#x2F;data2 \\</span><br><span class=\"line\">http:&#x2F;&#x2F;10.34.252.93&#x2F;home&#x2F;minio&#x2F;data1 http:&#x2F;&#x2F;10.34.252.93&#x2F;home&#x2F;minio&#x2F;data2</span><br></pre></td></tr></table></figure>\n\n<p>集群节点10.34.252.93内容为:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#!&#x2F;bin&#x2F;bash</span><br><span class=\"line\">export MINIO_ACCESS_KEY&#x3D;admin</span><br><span class=\"line\">export MINIO_SECRET_KEY&#x3D;admin123</span><br><span class=\"line\">&#x2F;home&#x2F;minio&#x2F;run&#x2F;minio server --config-dir &#x2F;etc&#x2F;minio \\</span><br><span class=\"line\">--address &quot;10.34.252.93:9000&quot; \\</span><br><span class=\"line\">http:&#x2F;&#x2F;10.34.252.87&#x2F;home&#x2F;minio&#x2F;data1 http:&#x2F;&#x2F;10.34.252.87&#x2F;home&#x2F;minio&#x2F;data2 \\</span><br><span class=\"line\">http:&#x2F;&#x2F;10.34.252.88&#x2F;home&#x2F;minio&#x2F;data1 http:&#x2F;&#x2F;10.34.252.88&#x2F;home&#x2F;minio&#x2F;data2 \\</span><br><span class=\"line\">http:&#x2F;&#x2F;10.34.252.89&#x2F;home&#x2F;minio&#x2F;data1 http:&#x2F;&#x2F;10.34.252.89&#x2F;home&#x2F;minio&#x2F;data2 \\</span><br><span class=\"line\">http:&#x2F;&#x2F;10.34.252.93&#x2F;home&#x2F;minio&#x2F;data1 http:&#x2F;&#x2F;10.34.252.93&#x2F;home&#x2F;minio&#x2F;data2</span><br></pre></td></tr></table></figure>\n\n\n<h3 id=\"创建Minio-server-将minio加入系统服务（4台集群主机都执行）\"><a href=\"#创建Minio-server-将minio加入系统服务（4台集群主机都执行）\" class=\"headerlink\" title=\"创建Minio.server,将minio加入系统服务（4台集群主机都执行）\"></a>创建Minio.server,将minio加入系统服务（4台集群主机都执行）</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim &#x2F;usr&#x2F;lib&#x2F;systemd&#x2F;system&#x2F;minio.service</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[Unit]</span><br><span class=\"line\">Description&#x3D;Minio service</span><br><span class=\"line\">Documentation&#x3D;https:&#x2F;&#x2F;docs.minio.io&#x2F;</span><br><span class=\"line\"></span><br><span class=\"line\">[Service]</span><br><span class=\"line\">WorkingDirectory&#x3D;&#x2F;home&#x2F;minio&#x2F;run&#x2F;</span><br><span class=\"line\">ExecStart&#x3D;&#x2F;home&#x2F;minio&#x2F;run&#x2F;minio-run.sh</span><br><span class=\"line\"></span><br><span class=\"line\">Restart&#x3D;on-failure</span><br><span class=\"line\">RestartSec&#x3D;5</span><br><span class=\"line\"></span><br><span class=\"line\">[Install]</span><br><span class=\"line\">WantedBy&#x3D;multi-user.target</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"权限修改（4台集群主机都执行）\"><a href=\"#权限修改（4台集群主机都执行）\" class=\"headerlink\" title=\"权限修改（4台集群主机都执行）\"></a>权限修改（4台集群主机都执行）</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">chmod +x &#x2F;usr&#x2F;lib&#x2F;systemd&#x2F;system&#x2F;minio.service &amp;&amp; chmod +x &#x2F;home&#x2F;minio&#x2F;run&#x2F;minio &amp;&amp; chmod +x &#x2F;home&#x2F;minio&#x2F;run&#x2F;minio-run.sh</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"启动集群（4台集群主机都执行）\"><a href=\"#启动集群（4台集群主机都执行）\" class=\"headerlink\" title=\"启动集群（4台集群主机都执行）\"></a>启动集群（4台集群主机都执行）</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl daemon-reload</span><br><span class=\"line\">systemctl start minio</span><br><span class=\"line\">systemctl enable minio</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"查看集群状态\"><a href=\"#查看集群状态\" class=\"headerlink\" title=\"查看集群状态\"></a>查看集群状态</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl status minio.service -l</span><br></pre></td></tr></table></figure>\n\n<p>日志类似以下内容，则启动成功:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@cn-gri-gicar-bdms-05 csz]# systemctl status minio.service -l</span><br><span class=\"line\">● minio.service - Minio service</span><br><span class=\"line\">   Loaded: loaded (&#x2F;usr&#x2F;lib&#x2F;systemd&#x2F;system&#x2F;minio.service; enabled; vendor preset: disabled)</span><br><span class=\"line\">   Active: active (running) since Fri 2021-01-22 10:44:29 CST; 43min ago</span><br><span class=\"line\">     Docs: https:&#x2F;&#x2F;docs.minio.io&#x2F;</span><br><span class=\"line\"> Main PID: 3663052 (minio-run.sh)</span><br><span class=\"line\">    Tasks: 41</span><br><span class=\"line\">   Memory: 89.2M</span><br><span class=\"line\">   CGroup: &#x2F;system.slice&#x2F;minio.service</span><br><span class=\"line\">           ├─3663052 &#x2F;bin&#x2F;bash &#x2F;root&#x2F;docker&#x2F;minio&#x2F;run&#x2F;minio-run.sh</span><br><span class=\"line\">           └─3663053 &#x2F;root&#x2F;docker&#x2F;minio&#x2F;run&#x2F;minio server --config-dir &#x2F;etc&#x2F;minio --address 10.34.252.87:9000 http:&#x2F;&#x2F;10.34.252.87&#x2F;home&#x2F;minio&#x2F;data1 http:&#x2F;&#x2F;10.34.252.87&#x2F;home&#x2F;minio&#x2F;data2 http:&#x2F;&#x2F;10.34.252.88&#x2F;home&#x2F;minio&#x2F;data1 http:&#x2F;&#x2F;10.34.252.88&#x2F;home&#x2F;minio&#x2F;data2 http:&#x2F;&#x2F;10.34.252.89&#x2F;home&#x2F;minio&#x2F;data1 http:&#x2F;&#x2F;10.34.252.89&#x2F;home&#x2F;minio&#x2F;data2 http:&#x2F;&#x2F;10.34.252.93&#x2F;home&#x2F;minio&#x2F;data1 http:&#x2F;&#x2F;10.34.252.93&#x2F;home&#x2F;minio&#x2F;data2</span><br><span class=\"line\"></span><br><span class=\"line\">Jan 22 10:44:32 cn-gri-gicar-bdms-05 minio-run.sh[3663052]: Endpoint: http:&#x2F;&#x2F;10.34.252.87:9000</span><br><span class=\"line\">Jan 22 10:44:32 cn-gri-gicar-bdms-05 minio-run.sh[3663052]: Browser Access:</span><br><span class=\"line\">Jan 22 10:44:32 cn-gri-gicar-bdms-05 minio-run.sh[3663052]: http:&#x2F;&#x2F;10.34.252.87:9000</span><br><span class=\"line\">Jan 22 10:44:32 cn-gri-gicar-bdms-05 minio-run.sh[3663052]: Object API (Amazon S3 compatible):</span><br><span class=\"line\">Jan 22 10:44:32 cn-gri-gicar-bdms-05 minio-run.sh[3663052]: Go:         https:&#x2F;&#x2F;docs.min.io&#x2F;docs&#x2F;golang-client-quickstart-guide</span><br><span class=\"line\">Jan 22 10:44:32 cn-gri-gicar-bdms-05 minio-run.sh[3663052]: Java:       https:&#x2F;&#x2F;docs.min.io&#x2F;docs&#x2F;java-client-quickstart-guide</span><br><span class=\"line\">Jan 22 10:44:32 cn-gri-gicar-bdms-05 minio-run.sh[3663052]: Python:     https:&#x2F;&#x2F;docs.min.io&#x2F;docs&#x2F;python-client-quickstart-guide</span><br><span class=\"line\">Jan 22 10:44:32 cn-gri-gicar-bdms-05 minio-run.sh[3663052]: JavaScript: https:&#x2F;&#x2F;docs.min.io&#x2F;docs&#x2F;javascript-client-quickstart-guide</span><br><span class=\"line\">Jan 22 10:44:32 cn-gri-gicar-bdms-05 minio-run.sh[3663052]: .NET:       https:&#x2F;&#x2F;docs.min.io&#x2F;docs&#x2F;dotnet-client-quickstart-guide</span><br><span class=\"line\">Jan 22 10:44:32 cn-gri-gicar-bdms-05 minio-run.sh[3663052]: Waiting for all MinIO IAM sub-system to be initialized.. lock acquired</span><br></pre></td></tr></table></figure>\n\n\n<h3 id=\"登录页面测试\"><a href=\"#登录页面测试\" class=\"headerlink\" title=\"登录页面测试\"></a>登录页面测试</h3><p>登录任一页面</p>\n<h3 id=\"测试\"><a href=\"#测试\" class=\"headerlink\" title=\"测试\"></a>测试</h3><p>创建 bucket 并上传两个文件，在到4台集群主机查看存储情况</p>"},{"title":"MySQL审计工具Audit插件使用","date":"2019-12-13T06:00:00.000Z","_content":"\n## MySQL审计工具Audit插件使用\n\n### 一、介绍MySQL AUDIT\n\n`MySQL AUDIT Plugin`是一个 `MySQL`安全审计插件，由McAfee提供，设计强调安全性和审计能力。该插件可用作独立审计解决方案，或配置为数据传送给外部监测工具。支持版本为`MySQL (5.1, 5.5, 5.6, 5.7)，MariaDB (5.5, 10.0, 10.1) ，Platform (32 or 64 bit)`。从Mariadb 10.0版本开始audit插件直接内嵌了，名称为server_audit.so，可以直接加载使用。\n\n源码地址：https://github.com/mcafee/mysql-audit/\n\nWIKI地址：https://github.com/mcafee/mysql-audit/wiki\n\n二进制地址：https://bintray.com/mcafee/mysql-audit-plugin/release\n\nmacfee的mysql audit插件虽然日志信息比较大，对性能影响大，但是如果想要开启审计，那也应该忍受了。\n\n\n\n<hr/>\n### 二、安装使用MySQL AUDIT\n\n1、下载mysql 对应版本的 audit插件\n\nhttps://bintray.com/mcafee/mysql-audit-plugin/release#files\n\n```\n\n```\n\n2、查看MySQL的插件目录\n\n```\n> SHOW GLOBAL VARIABLES LIKE 'plugin_dir'\n\n+---------------+------------------------------+\n| Variable_name | Value                        |\n+---------------+------------------------------+\n| plugin_dir    | /usr/local/mysql/lib/plugin/ |\n+---------------+------------------------------+\n1 row in set (0.02 sec)\n```\n\n3、复制库文件到MySQL库目录下\n\n```\ncp cp audit-plugin-mysql-5.7-1.1.4-725/lib/libaudit_plugin.so /usr/local/mysql/lib/plugin/\n```\n\n4、加载Audit插件\n\n```\n> install plugin audit soname 'libaudit_plugin.so';\n```\n\n5、查看版本\n\n```\n> show plugins;\n......\n| BLACKHOLE                  | ACTIVE   | STORAGE ENGINE     | NULL               | GPL     |\n| partition                  | ACTIVE   | STORAGE ENGINE     | NULL               | GPL     |\n| AUDIT                      | ACTIVE   | AUDIT              | libaudit_plugin.so | GPL     |\n+----------------------------+----------+--------------------+--------------------+---------+\n43 rows in set (0.09 sec)\n\n> show global status like '%audit%';\n+------------------------+-----------+\n| Variable_name          | Value     |\n+------------------------+-----------+\n| Audit_protocol_version | 1.0       |\n| Audit_version          | 1.1.7-866 |\n+------------------------+-----------+\n2 rows in set (0.08 sec)\n\n```\n\n6、开启Audit功能：\n\n```\n> SET GLOBAL audit_json_file=ON;\nQuery OK, 0 rows affected (0.00 sec)\n\n```\n\n7、查看插件有哪些可配置的参数：\n\n```\n>  SHOW GLOBAL VARIABLES LIKE '%audi%'; \n```\n\n\n\n```\n其中我们需要关注的参数有：\n\n1. audit_json_file\n是否开启audit功能。\n\n2. audit_json_log_file\n记录文件的路径和名称信息（默认放在mysql数据目录下）。\n\n3. audit_record_cmds\naudit记录的命令，默认为记录所有命令。可以设置为任意dml、dcl、ddl的组合。如：audit_record_cmds=select,insert,delete,update。还可以在线设置set global audit_record_cmds=NULL。(表示记录所有命令)\n\n4. audit_record_objs\naudit记录操作的对象，默认为记录所有对象，可以用SET GLOBAL audit_record_objs=NULL设置为默认。也可以指定为下面的格式：audit_record_objs=,test.*,mysql.*,information_schema.*。\n\n5. audit_whitelist_users\n用户白名单。\n\n\nhttps://github.com/mcafee/mysql-audit/wiki/Configuration\n```\n\n### 三、[libaudit_plugin.so安装]\n\n\n\n1、上传audit到mysql的plugin目录\n\n2、配置my.cnf 文件\n\n```\nvim /etc/my.cnf\n[mysqld]\nplugin-load=AUDIT=libaudit_plugin.so\naudit_json_file=1\naudit_json_file=ON\naudit_record_cmds=connect,Quit,show,select,insert,update,delete\naudit_whitelist_users=blacklist,mysql2,gmetric,procdb\n\n```\n\n3、启动登录mysql\n\n```\nINSTALL PLUGIN AUDIT SONAME 'libaudit_plugin.so';\nSET GLOBAL audit_json_file=ON;\nSET GLOBAL audit_whitelist_users='qrr,mysql2,gmetric,procdb,{}'\n\n{}:表示空用户\n```\n\n\n\n","source":"_posts/mysql/MySQL审计工具Audit插件使用.md","raw":"---\ntitle: MySQL审计工具Audit插件使用\ndate: 2019-12-13 14:00:00\ncategories: \n- mysql\ntags:\n- mysql\n---\n\n## MySQL审计工具Audit插件使用\n\n### 一、介绍MySQL AUDIT\n\n`MySQL AUDIT Plugin`是一个 `MySQL`安全审计插件，由McAfee提供，设计强调安全性和审计能力。该插件可用作独立审计解决方案，或配置为数据传送给外部监测工具。支持版本为`MySQL (5.1, 5.5, 5.6, 5.7)，MariaDB (5.5, 10.0, 10.1) ，Platform (32 or 64 bit)`。从Mariadb 10.0版本开始audit插件直接内嵌了，名称为server_audit.so，可以直接加载使用。\n\n源码地址：https://github.com/mcafee/mysql-audit/\n\nWIKI地址：https://github.com/mcafee/mysql-audit/wiki\n\n二进制地址：https://bintray.com/mcafee/mysql-audit-plugin/release\n\nmacfee的mysql audit插件虽然日志信息比较大，对性能影响大，但是如果想要开启审计，那也应该忍受了。\n\n\n\n<hr/>\n### 二、安装使用MySQL AUDIT\n\n1、下载mysql 对应版本的 audit插件\n\nhttps://bintray.com/mcafee/mysql-audit-plugin/release#files\n\n```\n\n```\n\n2、查看MySQL的插件目录\n\n```\n> SHOW GLOBAL VARIABLES LIKE 'plugin_dir'\n\n+---------------+------------------------------+\n| Variable_name | Value                        |\n+---------------+------------------------------+\n| plugin_dir    | /usr/local/mysql/lib/plugin/ |\n+---------------+------------------------------+\n1 row in set (0.02 sec)\n```\n\n3、复制库文件到MySQL库目录下\n\n```\ncp cp audit-plugin-mysql-5.7-1.1.4-725/lib/libaudit_plugin.so /usr/local/mysql/lib/plugin/\n```\n\n4、加载Audit插件\n\n```\n> install plugin audit soname 'libaudit_plugin.so';\n```\n\n5、查看版本\n\n```\n> show plugins;\n......\n| BLACKHOLE                  | ACTIVE   | STORAGE ENGINE     | NULL               | GPL     |\n| partition                  | ACTIVE   | STORAGE ENGINE     | NULL               | GPL     |\n| AUDIT                      | ACTIVE   | AUDIT              | libaudit_plugin.so | GPL     |\n+----------------------------+----------+--------------------+--------------------+---------+\n43 rows in set (0.09 sec)\n\n> show global status like '%audit%';\n+------------------------+-----------+\n| Variable_name          | Value     |\n+------------------------+-----------+\n| Audit_protocol_version | 1.0       |\n| Audit_version          | 1.1.7-866 |\n+------------------------+-----------+\n2 rows in set (0.08 sec)\n\n```\n\n6、开启Audit功能：\n\n```\n> SET GLOBAL audit_json_file=ON;\nQuery OK, 0 rows affected (0.00 sec)\n\n```\n\n7、查看插件有哪些可配置的参数：\n\n```\n>  SHOW GLOBAL VARIABLES LIKE '%audi%'; \n```\n\n\n\n```\n其中我们需要关注的参数有：\n\n1. audit_json_file\n是否开启audit功能。\n\n2. audit_json_log_file\n记录文件的路径和名称信息（默认放在mysql数据目录下）。\n\n3. audit_record_cmds\naudit记录的命令，默认为记录所有命令。可以设置为任意dml、dcl、ddl的组合。如：audit_record_cmds=select,insert,delete,update。还可以在线设置set global audit_record_cmds=NULL。(表示记录所有命令)\n\n4. audit_record_objs\naudit记录操作的对象，默认为记录所有对象，可以用SET GLOBAL audit_record_objs=NULL设置为默认。也可以指定为下面的格式：audit_record_objs=,test.*,mysql.*,information_schema.*。\n\n5. audit_whitelist_users\n用户白名单。\n\n\nhttps://github.com/mcafee/mysql-audit/wiki/Configuration\n```\n\n### 三、[libaudit_plugin.so安装]\n\n\n\n1、上传audit到mysql的plugin目录\n\n2、配置my.cnf 文件\n\n```\nvim /etc/my.cnf\n[mysqld]\nplugin-load=AUDIT=libaudit_plugin.so\naudit_json_file=1\naudit_json_file=ON\naudit_record_cmds=connect,Quit,show,select,insert,update,delete\naudit_whitelist_users=blacklist,mysql2,gmetric,procdb\n\n```\n\n3、启动登录mysql\n\n```\nINSTALL PLUGIN AUDIT SONAME 'libaudit_plugin.so';\nSET GLOBAL audit_json_file=ON;\nSET GLOBAL audit_whitelist_users='qrr,mysql2,gmetric,procdb,{}'\n\n{}:表示空用户\n```\n\n\n\n","slug":"mysql/MySQL审计工具Audit插件使用","published":1,"updated":"2021-06-18T08:07:11.198Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cku697a0c005v00uhcgs0h1tf","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><h2 id=\"MySQL审计工具Audit插件使用\"><a href=\"#MySQL审计工具Audit插件使用\" class=\"headerlink\" title=\"MySQL审计工具Audit插件使用\"></a>MySQL审计工具Audit插件使用</h2><h3 id=\"一、介绍MySQL-AUDIT\"><a href=\"#一、介绍MySQL-AUDIT\" class=\"headerlink\" title=\"一、介绍MySQL AUDIT\"></a>一、介绍MySQL AUDIT</h3><p><code>MySQL AUDIT Plugin</code>是一个 <code>MySQL</code>安全审计插件，由McAfee提供，设计强调安全性和审计能力。该插件可用作独立审计解决方案，或配置为数据传送给外部监测工具。支持版本为<code>MySQL (5.1, 5.5, 5.6, 5.7)，MariaDB (5.5, 10.0, 10.1) ，Platform (32 or 64 bit)</code>。从Mariadb 10.0版本开始audit插件直接内嵌了，名称为server_audit.so，可以直接加载使用。</p>\n<p>源码地址：<a href=\"https://github.com/mcafee/mysql-audit/\">https://github.com/mcafee/mysql-audit/</a></p>\n<p>WIKI地址：<a href=\"https://github.com/mcafee/mysql-audit/wiki\">https://github.com/mcafee/mysql-audit/wiki</a></p>\n<p>二进制地址：<a href=\"https://bintray.com/mcafee/mysql-audit-plugin/release\">https://bintray.com/mcafee/mysql-audit-plugin/release</a></p>\n<p>macfee的mysql audit插件虽然日志信息比较大，对性能影响大，但是如果想要开启审计，那也应该忍受了。</p>\n<hr/>\n### 二、安装使用MySQL AUDIT\n\n<p>1、下载mysql 对应版本的 audit插件</p>\n<p><a href=\"https://bintray.com/mcafee/mysql-audit-plugin/release#files\">https://bintray.com/mcafee/mysql-audit-plugin/release#files</a></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>2、查看MySQL的插件目录</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt; SHOW GLOBAL VARIABLES LIKE &#39;plugin_dir&#39;</span><br><span class=\"line\"></span><br><span class=\"line\">+---------------+------------------------------+</span><br><span class=\"line\">| Variable_name | Value                        |</span><br><span class=\"line\">+---------------+------------------------------+</span><br><span class=\"line\">| plugin_dir    | &#x2F;usr&#x2F;local&#x2F;mysql&#x2F;lib&#x2F;plugin&#x2F; |</span><br><span class=\"line\">+---------------+------------------------------+</span><br><span class=\"line\">1 row in set (0.02 sec)</span><br></pre></td></tr></table></figure>\n\n<p>3、复制库文件到MySQL库目录下</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cp cp audit-plugin-mysql-5.7-1.1.4-725&#x2F;lib&#x2F;libaudit_plugin.so &#x2F;usr&#x2F;local&#x2F;mysql&#x2F;lib&#x2F;plugin&#x2F;</span><br></pre></td></tr></table></figure>\n\n<p>4、加载Audit插件</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt; install plugin audit soname &#39;libaudit_plugin.so&#39;;</span><br></pre></td></tr></table></figure>\n\n<p>5、查看版本</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt; show plugins;</span><br><span class=\"line\">......</span><br><span class=\"line\">| BLACKHOLE                  | ACTIVE   | STORAGE ENGINE     | NULL               | GPL     |</span><br><span class=\"line\">| partition                  | ACTIVE   | STORAGE ENGINE     | NULL               | GPL     |</span><br><span class=\"line\">| AUDIT                      | ACTIVE   | AUDIT              | libaudit_plugin.so | GPL     |</span><br><span class=\"line\">+----------------------------+----------+--------------------+--------------------+---------+</span><br><span class=\"line\">43 rows in set (0.09 sec)</span><br><span class=\"line\"></span><br><span class=\"line\">&gt; show global status like &#39;%audit%&#39;;</span><br><span class=\"line\">+------------------------+-----------+</span><br><span class=\"line\">| Variable_name          | Value     |</span><br><span class=\"line\">+------------------------+-----------+</span><br><span class=\"line\">| Audit_protocol_version | 1.0       |</span><br><span class=\"line\">| Audit_version          | 1.1.7-866 |</span><br><span class=\"line\">+------------------------+-----------+</span><br><span class=\"line\">2 rows in set (0.08 sec)</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>6、开启Audit功能：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt; SET GLOBAL audit_json_file&#x3D;ON;</span><br><span class=\"line\">Query OK, 0 rows affected (0.00 sec)</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>7、查看插件有哪些可配置的参数：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;  SHOW GLOBAL VARIABLES LIKE &#39;%audi%&#39;; </span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">其中我们需要关注的参数有：</span><br><span class=\"line\"></span><br><span class=\"line\">1. audit_json_file</span><br><span class=\"line\">是否开启audit功能。</span><br><span class=\"line\"></span><br><span class=\"line\">2. audit_json_log_file</span><br><span class=\"line\">记录文件的路径和名称信息（默认放在mysql数据目录下）。</span><br><span class=\"line\"></span><br><span class=\"line\">3. audit_record_cmds</span><br><span class=\"line\">audit记录的命令，默认为记录所有命令。可以设置为任意dml、dcl、ddl的组合。如：audit_record_cmds&#x3D;select,insert,delete,update。还可以在线设置set global audit_record_cmds&#x3D;NULL。(表示记录所有命令)</span><br><span class=\"line\"></span><br><span class=\"line\">4. audit_record_objs</span><br><span class=\"line\">audit记录操作的对象，默认为记录所有对象，可以用SET GLOBAL audit_record_objs&#x3D;NULL设置为默认。也可以指定为下面的格式：audit_record_objs&#x3D;,test.*,mysql.*,information_schema.*。</span><br><span class=\"line\"></span><br><span class=\"line\">5. audit_whitelist_users</span><br><span class=\"line\">用户白名单。</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">https:&#x2F;&#x2F;github.com&#x2F;mcafee&#x2F;mysql-audit&#x2F;wiki&#x2F;Configuration</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"三、-libaudit-plugin-so安装\"><a href=\"#三、-libaudit-plugin-so安装\" class=\"headerlink\" title=\"三、[libaudit_plugin.so安装]\"></a>三、[libaudit_plugin.so安装]</h3><p>1、上传audit到mysql的plugin目录</p>\n<p>2、配置my.cnf 文件</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim &#x2F;etc&#x2F;my.cnf</span><br><span class=\"line\">[mysqld]</span><br><span class=\"line\">plugin-load&#x3D;AUDIT&#x3D;libaudit_plugin.so</span><br><span class=\"line\">audit_json_file&#x3D;1</span><br><span class=\"line\">audit_json_file&#x3D;ON</span><br><span class=\"line\">audit_record_cmds&#x3D;connect,Quit,show,select,insert,update,delete</span><br><span class=\"line\">audit_whitelist_users&#x3D;blacklist,mysql2,gmetric,procdb</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>3、启动登录mysql</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">INSTALL PLUGIN AUDIT SONAME &#39;libaudit_plugin.so&#39;;</span><br><span class=\"line\">SET GLOBAL audit_json_file&#x3D;ON;</span><br><span class=\"line\">SET GLOBAL audit_whitelist_users&#x3D;&#39;qrr,mysql2,gmetric,procdb,&#123;&#125;&#39;</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;&#125;:表示空用户</span><br></pre></td></tr></table></figure>\n\n\n\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"MySQL审计工具Audit插件使用\"><a href=\"#MySQL审计工具Audit插件使用\" class=\"headerlink\" title=\"MySQL审计工具Audit插件使用\"></a>MySQL审计工具Audit插件使用</h2><h3 id=\"一、介绍MySQL-AUDIT\"><a href=\"#一、介绍MySQL-AUDIT\" class=\"headerlink\" title=\"一、介绍MySQL AUDIT\"></a>一、介绍MySQL AUDIT</h3><p><code>MySQL AUDIT Plugin</code>是一个 <code>MySQL</code>安全审计插件，由McAfee提供，设计强调安全性和审计能力。该插件可用作独立审计解决方案，或配置为数据传送给外部监测工具。支持版本为<code>MySQL (5.1, 5.5, 5.6, 5.7)，MariaDB (5.5, 10.0, 10.1) ，Platform (32 or 64 bit)</code>。从Mariadb 10.0版本开始audit插件直接内嵌了，名称为server_audit.so，可以直接加载使用。</p>\n<p>源码地址：<a href=\"https://github.com/mcafee/mysql-audit/\">https://github.com/mcafee/mysql-audit/</a></p>\n<p>WIKI地址：<a href=\"https://github.com/mcafee/mysql-audit/wiki\">https://github.com/mcafee/mysql-audit/wiki</a></p>\n<p>二进制地址：<a href=\"https://bintray.com/mcafee/mysql-audit-plugin/release\">https://bintray.com/mcafee/mysql-audit-plugin/release</a></p>\n<p>macfee的mysql audit插件虽然日志信息比较大，对性能影响大，但是如果想要开启审计，那也应该忍受了。</p>\n<hr/>\n### 二、安装使用MySQL AUDIT\n\n<p>1、下载mysql 对应版本的 audit插件</p>\n<p><a href=\"https://bintray.com/mcafee/mysql-audit-plugin/release#files\">https://bintray.com/mcafee/mysql-audit-plugin/release#files</a></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>2、查看MySQL的插件目录</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt; SHOW GLOBAL VARIABLES LIKE &#39;plugin_dir&#39;</span><br><span class=\"line\"></span><br><span class=\"line\">+---------------+------------------------------+</span><br><span class=\"line\">| Variable_name | Value                        |</span><br><span class=\"line\">+---------------+------------------------------+</span><br><span class=\"line\">| plugin_dir    | &#x2F;usr&#x2F;local&#x2F;mysql&#x2F;lib&#x2F;plugin&#x2F; |</span><br><span class=\"line\">+---------------+------------------------------+</span><br><span class=\"line\">1 row in set (0.02 sec)</span><br></pre></td></tr></table></figure>\n\n<p>3、复制库文件到MySQL库目录下</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cp cp audit-plugin-mysql-5.7-1.1.4-725&#x2F;lib&#x2F;libaudit_plugin.so &#x2F;usr&#x2F;local&#x2F;mysql&#x2F;lib&#x2F;plugin&#x2F;</span><br></pre></td></tr></table></figure>\n\n<p>4、加载Audit插件</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt; install plugin audit soname &#39;libaudit_plugin.so&#39;;</span><br></pre></td></tr></table></figure>\n\n<p>5、查看版本</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt; show plugins;</span><br><span class=\"line\">......</span><br><span class=\"line\">| BLACKHOLE                  | ACTIVE   | STORAGE ENGINE     | NULL               | GPL     |</span><br><span class=\"line\">| partition                  | ACTIVE   | STORAGE ENGINE     | NULL               | GPL     |</span><br><span class=\"line\">| AUDIT                      | ACTIVE   | AUDIT              | libaudit_plugin.so | GPL     |</span><br><span class=\"line\">+----------------------------+----------+--------------------+--------------------+---------+</span><br><span class=\"line\">43 rows in set (0.09 sec)</span><br><span class=\"line\"></span><br><span class=\"line\">&gt; show global status like &#39;%audit%&#39;;</span><br><span class=\"line\">+------------------------+-----------+</span><br><span class=\"line\">| Variable_name          | Value     |</span><br><span class=\"line\">+------------------------+-----------+</span><br><span class=\"line\">| Audit_protocol_version | 1.0       |</span><br><span class=\"line\">| Audit_version          | 1.1.7-866 |</span><br><span class=\"line\">+------------------------+-----------+</span><br><span class=\"line\">2 rows in set (0.08 sec)</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>6、开启Audit功能：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt; SET GLOBAL audit_json_file&#x3D;ON;</span><br><span class=\"line\">Query OK, 0 rows affected (0.00 sec)</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>7、查看插件有哪些可配置的参数：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;  SHOW GLOBAL VARIABLES LIKE &#39;%audi%&#39;; </span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">其中我们需要关注的参数有：</span><br><span class=\"line\"></span><br><span class=\"line\">1. audit_json_file</span><br><span class=\"line\">是否开启audit功能。</span><br><span class=\"line\"></span><br><span class=\"line\">2. audit_json_log_file</span><br><span class=\"line\">记录文件的路径和名称信息（默认放在mysql数据目录下）。</span><br><span class=\"line\"></span><br><span class=\"line\">3. audit_record_cmds</span><br><span class=\"line\">audit记录的命令，默认为记录所有命令。可以设置为任意dml、dcl、ddl的组合。如：audit_record_cmds&#x3D;select,insert,delete,update。还可以在线设置set global audit_record_cmds&#x3D;NULL。(表示记录所有命令)</span><br><span class=\"line\"></span><br><span class=\"line\">4. audit_record_objs</span><br><span class=\"line\">audit记录操作的对象，默认为记录所有对象，可以用SET GLOBAL audit_record_objs&#x3D;NULL设置为默认。也可以指定为下面的格式：audit_record_objs&#x3D;,test.*,mysql.*,information_schema.*。</span><br><span class=\"line\"></span><br><span class=\"line\">5. audit_whitelist_users</span><br><span class=\"line\">用户白名单。</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">https:&#x2F;&#x2F;github.com&#x2F;mcafee&#x2F;mysql-audit&#x2F;wiki&#x2F;Configuration</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"三、-libaudit-plugin-so安装\"><a href=\"#三、-libaudit-plugin-so安装\" class=\"headerlink\" title=\"三、[libaudit_plugin.so安装]\"></a>三、[libaudit_plugin.so安装]</h3><p>1、上传audit到mysql的plugin目录</p>\n<p>2、配置my.cnf 文件</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim &#x2F;etc&#x2F;my.cnf</span><br><span class=\"line\">[mysqld]</span><br><span class=\"line\">plugin-load&#x3D;AUDIT&#x3D;libaudit_plugin.so</span><br><span class=\"line\">audit_json_file&#x3D;1</span><br><span class=\"line\">audit_json_file&#x3D;ON</span><br><span class=\"line\">audit_record_cmds&#x3D;connect,Quit,show,select,insert,update,delete</span><br><span class=\"line\">audit_whitelist_users&#x3D;blacklist,mysql2,gmetric,procdb</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>3、启动登录mysql</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">INSTALL PLUGIN AUDIT SONAME &#39;libaudit_plugin.so&#39;;</span><br><span class=\"line\">SET GLOBAL audit_json_file&#x3D;ON;</span><br><span class=\"line\">SET GLOBAL audit_whitelist_users&#x3D;&#39;qrr,mysql2,gmetric,procdb,&#123;&#125;&#39;</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;&#125;:表示空用户</span><br></pre></td></tr></table></figure>\n\n\n\n"},{"title":"init-connect+binlog实现mysql审计","date":"2019-12-13T06:00:00.000Z","_content":"\n**一、简介**\n\n1、概述\n\nmysql本身已经提供了详细的sql执行记录–general log ，但是开启它有以下几个缺点：\n\n1）无论sql有无语法错误，只要执行了就会记录，导致记录大量无用信息，后期的筛选有难度。\n\n2）sql并发量很大时，log的记录会对io造成一定的印象，是数据库效率降低。\n\n3）日志文件很容易快速膨胀，不妥善处理会对磁盘空间造成一定影响。\n\n2、原理\n\n1） 由于审计的关键在于DML语句，而所有的DML语句都可以通过binlog记录。\n\n2）不过遗憾的是目前MySQL binlog 中只记录，产生这条记录的connection id（随连接数自增，循环使用），这对之后的反查没有任何帮助。\n\n3）因此考虑通过init-connect，在每次连接的初始化阶段，记录下这个连接的用户，和connection_id信息。\n\n4）在后期审计进行行为追踪时，根据binlog记录的行为及对应的connection-id 结合 之前连接日志记录 进行分析，得出最后的结论。\n\n**备注：根据自己的实际环境使用审计方式，切记谨慎使用。**\n\n3、相对于audit审计插件\n\n 缺点：只对有低级权限的用户的操作有记录，权限高的则没有 。\n\n 优点：日志信息比较小，对性能影响小\n\n\n\n**二、安装审计功能**\n\n1、创建审计用的库表。\n\n```\nmysql> create database db_monitor charset utf8;\nmysql> use db_monitor\nCREATE TABLE accesslog\n( thread_id int(11) DEFAULT NULL,  #进程id\nlog_time datetime default null,  #登录时间\nlocalname varchar(50) DEFAULT NULL, #登录名称，带详细ip\nmatchname varchar(50) DEFAULT NULL,  #登录用户\nkey idx_log_time(log_time)\n) ENGINE=InnoDB  DEFAULT CHARSET=utf8;\n```\n\n\n\n\n\n2、配置init-connect参数\n\n\\# vim /etc/my.cnf\n\n[mysqld]\n\nserver-id = 130\n\nfederated\n\nlog-bin = mysql-bin\n\nbinlog_format = mixed\n\ninit_connect='insert into db_monitor.accesslog(thread_id,log_time,localname,matchname) values(connection_id(),now(),user(),current_user());'\n\n3、删除默认用户：\n\nmysql> delete from user where Host='localhost' and User='';\n\n4、创建普通用户，不能有super权限，而且用户必须有对access_log库的access_log表的insert权限，否则会登录失败。\n\nmysql> GRANT CREATE,DROP,ALTER,INSERT,DELETE,UPDATE,SELECT ON *.* TO audi01@'%' IDENTIFIED BY '147258';\n\nmysql> flush privileges;\n\n5、赋予用户access_log的insert、select权限，然后重新赋予权限：\n\nmysql> GRANT SELECT,INSERT ON db_monitor.* TO audi01@'%';\n\nmysql> flush privileges;\n\n6、查看，使用audi01用户登录查看\n\nmysql> select * from accesslog;\n\nmysql> delete from accesslog where thread_id=10;","source":"_posts/mysql/init_connect实现mysql审计.md","raw":"---\ntitle: init-connect+binlog实现mysql审计\ndate: 2019-12-13 14:00:00\ncategories: \n- bigdata\ntags:\n- flume\n---\n\n**一、简介**\n\n1、概述\n\nmysql本身已经提供了详细的sql执行记录–general log ，但是开启它有以下几个缺点：\n\n1）无论sql有无语法错误，只要执行了就会记录，导致记录大量无用信息，后期的筛选有难度。\n\n2）sql并发量很大时，log的记录会对io造成一定的印象，是数据库效率降低。\n\n3）日志文件很容易快速膨胀，不妥善处理会对磁盘空间造成一定影响。\n\n2、原理\n\n1） 由于审计的关键在于DML语句，而所有的DML语句都可以通过binlog记录。\n\n2）不过遗憾的是目前MySQL binlog 中只记录，产生这条记录的connection id（随连接数自增，循环使用），这对之后的反查没有任何帮助。\n\n3）因此考虑通过init-connect，在每次连接的初始化阶段，记录下这个连接的用户，和connection_id信息。\n\n4）在后期审计进行行为追踪时，根据binlog记录的行为及对应的connection-id 结合 之前连接日志记录 进行分析，得出最后的结论。\n\n**备注：根据自己的实际环境使用审计方式，切记谨慎使用。**\n\n3、相对于audit审计插件\n\n 缺点：只对有低级权限的用户的操作有记录，权限高的则没有 。\n\n 优点：日志信息比较小，对性能影响小\n\n\n\n**二、安装审计功能**\n\n1、创建审计用的库表。\n\n```\nmysql> create database db_monitor charset utf8;\nmysql> use db_monitor\nCREATE TABLE accesslog\n( thread_id int(11) DEFAULT NULL,  #进程id\nlog_time datetime default null,  #登录时间\nlocalname varchar(50) DEFAULT NULL, #登录名称，带详细ip\nmatchname varchar(50) DEFAULT NULL,  #登录用户\nkey idx_log_time(log_time)\n) ENGINE=InnoDB  DEFAULT CHARSET=utf8;\n```\n\n\n\n\n\n2、配置init-connect参数\n\n\\# vim /etc/my.cnf\n\n[mysqld]\n\nserver-id = 130\n\nfederated\n\nlog-bin = mysql-bin\n\nbinlog_format = mixed\n\ninit_connect='insert into db_monitor.accesslog(thread_id,log_time,localname,matchname) values(connection_id(),now(),user(),current_user());'\n\n3、删除默认用户：\n\nmysql> delete from user where Host='localhost' and User='';\n\n4、创建普通用户，不能有super权限，而且用户必须有对access_log库的access_log表的insert权限，否则会登录失败。\n\nmysql> GRANT CREATE,DROP,ALTER,INSERT,DELETE,UPDATE,SELECT ON *.* TO audi01@'%' IDENTIFIED BY '147258';\n\nmysql> flush privileges;\n\n5、赋予用户access_log的insert、select权限，然后重新赋予权限：\n\nmysql> GRANT SELECT,INSERT ON db_monitor.* TO audi01@'%';\n\nmysql> flush privileges;\n\n6、查看，使用audi01用户登录查看\n\nmysql> select * from accesslog;\n\nmysql> delete from accesslog where thread_id=10;","slug":"mysql/init_connect实现mysql审计","published":1,"updated":"2021-06-18T08:07:11.198Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cku697a0d005x00uh14sic0cs","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><p><strong>一、简介</strong></p>\n<p>1、概述</p>\n<p>mysql本身已经提供了详细的sql执行记录–general log ，但是开启它有以下几个缺点：</p>\n<p>1）无论sql有无语法错误，只要执行了就会记录，导致记录大量无用信息，后期的筛选有难度。</p>\n<p>2）sql并发量很大时，log的记录会对io造成一定的印象，是数据库效率降低。</p>\n<p>3）日志文件很容易快速膨胀，不妥善处理会对磁盘空间造成一定影响。</p>\n<p>2、原理</p>\n<p>1） 由于审计的关键在于DML语句，而所有的DML语句都可以通过binlog记录。</p>\n<p>2）不过遗憾的是目前MySQL binlog 中只记录，产生这条记录的connection id（随连接数自增，循环使用），这对之后的反查没有任何帮助。</p>\n<p>3）因此考虑通过init-connect，在每次连接的初始化阶段，记录下这个连接的用户，和connection_id信息。</p>\n<p>4）在后期审计进行行为追踪时，根据binlog记录的行为及对应的connection-id 结合 之前连接日志记录 进行分析，得出最后的结论。</p>\n<p><strong>备注：根据自己的实际环境使用审计方式，切记谨慎使用。</strong></p>\n<p>3、相对于audit审计插件</p>\n<p> 缺点：只对有低级权限的用户的操作有记录，权限高的则没有 。</p>\n<p> 优点：日志信息比较小，对性能影响小</p>\n<p><strong>二、安装审计功能</strong></p>\n<p>1、创建审计用的库表。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql&gt; create database db_monitor charset utf8;</span><br><span class=\"line\">mysql&gt; use db_monitor</span><br><span class=\"line\">CREATE TABLE accesslog</span><br><span class=\"line\">( thread_id int(11) DEFAULT NULL,  #进程id</span><br><span class=\"line\">log_time datetime default null,  #登录时间</span><br><span class=\"line\">localname varchar(50) DEFAULT NULL, #登录名称，带详细ip</span><br><span class=\"line\">matchname varchar(50) DEFAULT NULL,  #登录用户</span><br><span class=\"line\">key idx_log_time(log_time)</span><br><span class=\"line\">) ENGINE&#x3D;InnoDB  DEFAULT CHARSET&#x3D;utf8;</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<p>2、配置init-connect参数</p>\n<p># vim /etc/my.cnf</p>\n<p>[mysqld]</p>\n<p>server-id = 130</p>\n<p>federated</p>\n<p>log-bin = mysql-bin</p>\n<p>binlog_format = mixed</p>\n<p>init_connect=’insert into db_monitor.accesslog(thread_id,log_time,localname,matchname) values(connection_id(),now(),user(),current_user());’</p>\n<p>3、删除默认用户：</p>\n<p>mysql&gt; delete from user where Host=’localhost’ and User=’’;</p>\n<p>4、创建普通用户，不能有super权限，而且用户必须有对access_log库的access_log表的insert权限，否则会登录失败。</p>\n<p>mysql&gt; GRANT CREATE,DROP,ALTER,INSERT,DELETE,UPDATE,SELECT ON <em>.</em> TO audi01@’%’ IDENTIFIED BY ‘147258’;</p>\n<p>mysql&gt; flush privileges;</p>\n<p>5、赋予用户access_log的insert、select权限，然后重新赋予权限：</p>\n<p>mysql&gt; GRANT SELECT,INSERT ON db_monitor.* TO audi01@’%’;</p>\n<p>mysql&gt; flush privileges;</p>\n<p>6、查看，使用audi01用户登录查看</p>\n<p>mysql&gt; select * from accesslog;</p>\n<p>mysql&gt; delete from accesslog where thread_id=10;</p>\n","site":{"data":{}},"excerpt":"","more":"<p><strong>一、简介</strong></p>\n<p>1、概述</p>\n<p>mysql本身已经提供了详细的sql执行记录–general log ，但是开启它有以下几个缺点：</p>\n<p>1）无论sql有无语法错误，只要执行了就会记录，导致记录大量无用信息，后期的筛选有难度。</p>\n<p>2）sql并发量很大时，log的记录会对io造成一定的印象，是数据库效率降低。</p>\n<p>3）日志文件很容易快速膨胀，不妥善处理会对磁盘空间造成一定影响。</p>\n<p>2、原理</p>\n<p>1） 由于审计的关键在于DML语句，而所有的DML语句都可以通过binlog记录。</p>\n<p>2）不过遗憾的是目前MySQL binlog 中只记录，产生这条记录的connection id（随连接数自增，循环使用），这对之后的反查没有任何帮助。</p>\n<p>3）因此考虑通过init-connect，在每次连接的初始化阶段，记录下这个连接的用户，和connection_id信息。</p>\n<p>4）在后期审计进行行为追踪时，根据binlog记录的行为及对应的connection-id 结合 之前连接日志记录 进行分析，得出最后的结论。</p>\n<p><strong>备注：根据自己的实际环境使用审计方式，切记谨慎使用。</strong></p>\n<p>3、相对于audit审计插件</p>\n<p> 缺点：只对有低级权限的用户的操作有记录，权限高的则没有 。</p>\n<p> 优点：日志信息比较小，对性能影响小</p>\n<p><strong>二、安装审计功能</strong></p>\n<p>1、创建审计用的库表。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql&gt; create database db_monitor charset utf8;</span><br><span class=\"line\">mysql&gt; use db_monitor</span><br><span class=\"line\">CREATE TABLE accesslog</span><br><span class=\"line\">( thread_id int(11) DEFAULT NULL,  #进程id</span><br><span class=\"line\">log_time datetime default null,  #登录时间</span><br><span class=\"line\">localname varchar(50) DEFAULT NULL, #登录名称，带详细ip</span><br><span class=\"line\">matchname varchar(50) DEFAULT NULL,  #登录用户</span><br><span class=\"line\">key idx_log_time(log_time)</span><br><span class=\"line\">) ENGINE&#x3D;InnoDB  DEFAULT CHARSET&#x3D;utf8;</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<p>2、配置init-connect参数</p>\n<p># vim /etc/my.cnf</p>\n<p>[mysqld]</p>\n<p>server-id = 130</p>\n<p>federated</p>\n<p>log-bin = mysql-bin</p>\n<p>binlog_format = mixed</p>\n<p>init_connect=’insert into db_monitor.accesslog(thread_id,log_time,localname,matchname) values(connection_id(),now(),user(),current_user());’</p>\n<p>3、删除默认用户：</p>\n<p>mysql&gt; delete from user where Host=’localhost’ and User=’’;</p>\n<p>4、创建普通用户，不能有super权限，而且用户必须有对access_log库的access_log表的insert权限，否则会登录失败。</p>\n<p>mysql&gt; GRANT CREATE,DROP,ALTER,INSERT,DELETE,UPDATE,SELECT ON <em>.</em> TO audi01@’%’ IDENTIFIED BY ‘147258’;</p>\n<p>mysql&gt; flush privileges;</p>\n<p>5、赋予用户access_log的insert、select权限，然后重新赋予权限：</p>\n<p>mysql&gt; GRANT SELECT,INSERT ON db_monitor.* TO audi01@’%’;</p>\n<p>mysql&gt; flush privileges;</p>\n<p>6、查看，使用audi01用户登录查看</p>\n<p>mysql&gt; select * from accesslog;</p>\n<p>mysql&gt; delete from accesslog where thread_id=10;</p>\n"},{"title":"mongodb 安装和用户管理","date":"2020-09-21T04:45:00.000Z","_content":"\n\n### 安装mongodb3.2\n\n下载mongodb\n\n```\nwget https://fastdl.mongodb.org/linux/mongodb-linux-x86_64-rhel62-3.2.3.tgz\n```\n\n```\ntar xf mongodb-linux-x86_64-rhel62-3.2.3.tgz\nmv mongodb-linux-x86_64-rhel62-3.2.3 mongodb\ncd mongodb\nmkdir data logs conf\n```\n\n\n\n配置文件\n\n```\nvim conf/mongod.conf\n\nsystemLog:\n  destination: file\n  path: /opt/mongodb-27017/logs/mongod.log\n  logAppend: true\nprocessManagement:\n  fork: true\n  pidFilePath: \"/opt/mongodb-27017/data/mongod.pid\"\nnet:\n  port: 27017\n  http:\n    enabled: true\nstorage:\n  dbPath: \"/opt/mongodb-27017/data\"\n  engine: wiredTiger\n  wiredTiger:\n    engineConfig:\n      cacheSizeGB: 1\n      directoryForIndexes: true\n    collectionConfig:\n      blockCompressor: zlib\n    indexConfig:\n      prefixCompression: true\n  journal:\n    enabled: true\n  directoryPerDB: true\nsecurity:\n  authorization: enabled      # 开启关闭验证\n```\n\n`mongo3.x以后的版本配置文件都是yaml格式的，官方关于mongo配置文件相关选项说明，https://docs.mongodb.org/manual/reference/configuration-options/#configuration-file`\n\n\n\n启动mongo\n\n```\n/opt/mongodb-27017/bin/mongod -f /opt/mongodb-27017/conf/mongod.conf\n```\n\n\n\n```\nps -ef | grep mongo\n\nroot      4801     1  1 15:25 ?        00:00:22 /opt/mongodb-27017/bin/mongod -f /opt/mongodb-27017/conf/mongod.conf\nroot      4849     1  1 15:29 ?        00:00:18 /opt/mongodb-27018/bin/mongod -f /opt/mongodb-27018/conf/mongod.conf\n```\n\n\n\n\n\n### monodb 用户管理\n\n\n\n角色\n\nRead：    允许用户读取指定数据库\n\nreadWrite：   允许用户读写指定数据库\n\ndbAdmin：    允许用户在指定数据库中执行管理函数，如索引创建、删除，查看统计或访问system.profile\n\nuserAdmin：  允许用户向system.users集合写入，可以找指定数据库里创建、删除和管理用户\n\nclusterAdmin：  只在admin数据库中可用，赋予用户所有分片和复制集相关函数的管理权限。\n\nreadAnyDatabase：   只在admin数据库中可用，赋予用户所有数据库的读权限\n\nreadWriteAnyDatabase：   只在admin数据库中可用，赋予用户所有数据库的读写权限\n\nuserAdminAnyDatabase：   只在admin数据库中可用，赋予用户所有数据库的userAdmin权限\n\ndbAdminAnyDatabase：   只在admin数据库中可用，赋予用户所有数据库的dbAdmin权限。\n\nroot：   只在admin数据库中可用。超级账号，超级权限\n\n\n\n1. 数据库用户角色：   read、readWrite；\n2. 数据库管理角色：   dbAdmin、dbOwner、userAdmin;\n3. 集群管理角色：      clusterAdmin、clusterManager、4. clusterMonitor、hostManage；\n4. 备份恢复角色：     backup、restore；\n5. 所有数据库角色：     readAnyDatabase、readWriteAnyDatabase、userAdminAnyDatabase、dbAdminAnyDatabase\n6. 超级用户角色：    root\n7. 内部角色：   __system\n\n\n\n`注意： 用户在哪个库创建，就要在哪个库auth认证，并在mongo登录时也要先连接认证库`\n\n\n\n### 创建admin 超级管理员用户\n\n```\nuse admin\ndb.createUser(\n  { user: \"admin\",  \n    customData：{description:\"superuser\"},\n    pwd: \"admin\",  \n    roles: [ { role: \"userAdminAnyDatabase\", db: \"admin\" } ]  \n  }  \n) \n```\n\n超级用户的role有两种，userAdmin或者userAdminAnyDatabase(比前一种多加了对所有数据库的访问,仅仅是访问而已)。\n\n\n\n### 创建一个不受访问限制的超级用户\n\n```\nuse admin\ndb.createUser(\n    {\n        user:\"root\",\n        pwd:\"pwd\",\n        roles:[\"root\"]\n    }\n)\n```\n\n### 创建一个业务数据库管理员用户\n\n```\nuse admin\ndb.createUser({\n    user:\"user001\",\n    pwd:\"123456\",\n    customData:{\n        name:'jim',\n        email:'jim@qq.com',\n        age:18,\n    },\n    roles:[\n        {role:\"readWrite\",db:\"db001\"},\n        {role:\"readWrite\",db:\"db002\"},\n        'read'   // 对其他数据库有只读权限，对db001、db002是读写权限\n    ]\n})\n```\n\n### 查看创建的用户\n\n```\nshow users    或     db.system.users.find()     或    db.runCommand({usersInfo:\"userName\"})\n```\n\n### 修改密码\n\n```\nuse admin\ndb.changeUserPassword(\"username\", \"xxx\")\n```\n\n### 修改密码和用户信息\n\n```\ndb.runCommand(\n    {\n        updateUser:\"username\",\n        pwd:\"xxx\",\n        customData:{title:\"xxx\"}\n    }\n)\n```\n\n### 删除数据库用户\n\n```\nuse admin\ndb.dropUser('user001')\n```\n\n### 创建其他数据管理员\n\n```\n// 登录管理员用户\nuse admin\ndb.auth('admin','admin')\n// 切换至db001数据库\nuse db001\n// ... 増查改删该数据库专有用户\n```\n\n```\nuse admin\ndb.createUser({user:'superadmin',pwd:'123456', roles:[{role:'root', db:'admin'}]})     ---创建超级管理员用户\n \ndb.createUser({user:'useradmin',pwd:'123456', roles:[{role:'userAdminAnyDatabase', db:'admin'}]})     ---创建用户管理员账户（能查询其他库集合，但不能查询集合内容）\n \ndb.createUser({user:'admin',pwd:'123456', roles:[{role:'readWriteAnyDatabase', db:'admin'}]})     ---创建访问任意库读写的账户\n \ndb.createUser({user:'user1',pwd:'user1',roles:[{role:'readWrite',db:'test'}]})     ---创建只对test库有读写权限的用户\n \ndb.createUser({user:\"bkuser2\",pwd:\"Bkuser2\",roles:[{role:\"backup\",db:\"admin\"}]})     ---创建用于备份时的用户，如若是恢复权限，则将backup换为restore即可\n--- 注：新建backup账户时，roles里面的db必须是admin，要不然会报错\n```\n\n\n\n\n","source":"_posts/mongodb/安装monogdb3.2.md","raw":"---\ntitle: mongodb 安装和用户管理\ndate: 2020-09-21 12:45\ncategories:\n- mongodb\ntags:\n- mongodb\n- auth\n---\n\n\n### 安装mongodb3.2\n\n下载mongodb\n\n```\nwget https://fastdl.mongodb.org/linux/mongodb-linux-x86_64-rhel62-3.2.3.tgz\n```\n\n```\ntar xf mongodb-linux-x86_64-rhel62-3.2.3.tgz\nmv mongodb-linux-x86_64-rhel62-3.2.3 mongodb\ncd mongodb\nmkdir data logs conf\n```\n\n\n\n配置文件\n\n```\nvim conf/mongod.conf\n\nsystemLog:\n  destination: file\n  path: /opt/mongodb-27017/logs/mongod.log\n  logAppend: true\nprocessManagement:\n  fork: true\n  pidFilePath: \"/opt/mongodb-27017/data/mongod.pid\"\nnet:\n  port: 27017\n  http:\n    enabled: true\nstorage:\n  dbPath: \"/opt/mongodb-27017/data\"\n  engine: wiredTiger\n  wiredTiger:\n    engineConfig:\n      cacheSizeGB: 1\n      directoryForIndexes: true\n    collectionConfig:\n      blockCompressor: zlib\n    indexConfig:\n      prefixCompression: true\n  journal:\n    enabled: true\n  directoryPerDB: true\nsecurity:\n  authorization: enabled      # 开启关闭验证\n```\n\n`mongo3.x以后的版本配置文件都是yaml格式的，官方关于mongo配置文件相关选项说明，https://docs.mongodb.org/manual/reference/configuration-options/#configuration-file`\n\n\n\n启动mongo\n\n```\n/opt/mongodb-27017/bin/mongod -f /opt/mongodb-27017/conf/mongod.conf\n```\n\n\n\n```\nps -ef | grep mongo\n\nroot      4801     1  1 15:25 ?        00:00:22 /opt/mongodb-27017/bin/mongod -f /opt/mongodb-27017/conf/mongod.conf\nroot      4849     1  1 15:29 ?        00:00:18 /opt/mongodb-27018/bin/mongod -f /opt/mongodb-27018/conf/mongod.conf\n```\n\n\n\n\n\n### monodb 用户管理\n\n\n\n角色\n\nRead：    允许用户读取指定数据库\n\nreadWrite：   允许用户读写指定数据库\n\ndbAdmin：    允许用户在指定数据库中执行管理函数，如索引创建、删除，查看统计或访问system.profile\n\nuserAdmin：  允许用户向system.users集合写入，可以找指定数据库里创建、删除和管理用户\n\nclusterAdmin：  只在admin数据库中可用，赋予用户所有分片和复制集相关函数的管理权限。\n\nreadAnyDatabase：   只在admin数据库中可用，赋予用户所有数据库的读权限\n\nreadWriteAnyDatabase：   只在admin数据库中可用，赋予用户所有数据库的读写权限\n\nuserAdminAnyDatabase：   只在admin数据库中可用，赋予用户所有数据库的userAdmin权限\n\ndbAdminAnyDatabase：   只在admin数据库中可用，赋予用户所有数据库的dbAdmin权限。\n\nroot：   只在admin数据库中可用。超级账号，超级权限\n\n\n\n1. 数据库用户角色：   read、readWrite；\n2. 数据库管理角色：   dbAdmin、dbOwner、userAdmin;\n3. 集群管理角色：      clusterAdmin、clusterManager、4. clusterMonitor、hostManage；\n4. 备份恢复角色：     backup、restore；\n5. 所有数据库角色：     readAnyDatabase、readWriteAnyDatabase、userAdminAnyDatabase、dbAdminAnyDatabase\n6. 超级用户角色：    root\n7. 内部角色：   __system\n\n\n\n`注意： 用户在哪个库创建，就要在哪个库auth认证，并在mongo登录时也要先连接认证库`\n\n\n\n### 创建admin 超级管理员用户\n\n```\nuse admin\ndb.createUser(\n  { user: \"admin\",  \n    customData：{description:\"superuser\"},\n    pwd: \"admin\",  \n    roles: [ { role: \"userAdminAnyDatabase\", db: \"admin\" } ]  \n  }  \n) \n```\n\n超级用户的role有两种，userAdmin或者userAdminAnyDatabase(比前一种多加了对所有数据库的访问,仅仅是访问而已)。\n\n\n\n### 创建一个不受访问限制的超级用户\n\n```\nuse admin\ndb.createUser(\n    {\n        user:\"root\",\n        pwd:\"pwd\",\n        roles:[\"root\"]\n    }\n)\n```\n\n### 创建一个业务数据库管理员用户\n\n```\nuse admin\ndb.createUser({\n    user:\"user001\",\n    pwd:\"123456\",\n    customData:{\n        name:'jim',\n        email:'jim@qq.com',\n        age:18,\n    },\n    roles:[\n        {role:\"readWrite\",db:\"db001\"},\n        {role:\"readWrite\",db:\"db002\"},\n        'read'   // 对其他数据库有只读权限，对db001、db002是读写权限\n    ]\n})\n```\n\n### 查看创建的用户\n\n```\nshow users    或     db.system.users.find()     或    db.runCommand({usersInfo:\"userName\"})\n```\n\n### 修改密码\n\n```\nuse admin\ndb.changeUserPassword(\"username\", \"xxx\")\n```\n\n### 修改密码和用户信息\n\n```\ndb.runCommand(\n    {\n        updateUser:\"username\",\n        pwd:\"xxx\",\n        customData:{title:\"xxx\"}\n    }\n)\n```\n\n### 删除数据库用户\n\n```\nuse admin\ndb.dropUser('user001')\n```\n\n### 创建其他数据管理员\n\n```\n// 登录管理员用户\nuse admin\ndb.auth('admin','admin')\n// 切换至db001数据库\nuse db001\n// ... 増查改删该数据库专有用户\n```\n\n```\nuse admin\ndb.createUser({user:'superadmin',pwd:'123456', roles:[{role:'root', db:'admin'}]})     ---创建超级管理员用户\n \ndb.createUser({user:'useradmin',pwd:'123456', roles:[{role:'userAdminAnyDatabase', db:'admin'}]})     ---创建用户管理员账户（能查询其他库集合，但不能查询集合内容）\n \ndb.createUser({user:'admin',pwd:'123456', roles:[{role:'readWriteAnyDatabase', db:'admin'}]})     ---创建访问任意库读写的账户\n \ndb.createUser({user:'user1',pwd:'user1',roles:[{role:'readWrite',db:'test'}]})     ---创建只对test库有读写权限的用户\n \ndb.createUser({user:\"bkuser2\",pwd:\"Bkuser2\",roles:[{role:\"backup\",db:\"admin\"}]})     ---创建用于备份时的用户，如若是恢复权限，则将backup换为restore即可\n--- 注：新建backup账户时，roles里面的db必须是admin，要不然会报错\n```\n\n\n\n\n","slug":"mongodb/安装monogdb3.2","published":1,"updated":"2021-06-18T08:07:11.197Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cku697a0f006100uhfxwp9x2e","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><h3 id=\"安装mongodb3-2\"><a href=\"#安装mongodb3-2\" class=\"headerlink\" title=\"安装mongodb3.2\"></a>安装mongodb3.2</h3><p>下载mongodb</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget https:&#x2F;&#x2F;fastdl.mongodb.org&#x2F;linux&#x2F;mongodb-linux-x86_64-rhel62-3.2.3.tgz</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tar xf mongodb-linux-x86_64-rhel62-3.2.3.tgz</span><br><span class=\"line\">mv mongodb-linux-x86_64-rhel62-3.2.3 mongodb</span><br><span class=\"line\">cd mongodb</span><br><span class=\"line\">mkdir data logs conf</span><br></pre></td></tr></table></figure>\n\n\n\n<p>配置文件</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim conf&#x2F;mongod.conf</span><br><span class=\"line\"></span><br><span class=\"line\">systemLog:</span><br><span class=\"line\">  destination: file</span><br><span class=\"line\">  path: &#x2F;opt&#x2F;mongodb-27017&#x2F;logs&#x2F;mongod.log</span><br><span class=\"line\">  logAppend: true</span><br><span class=\"line\">processManagement:</span><br><span class=\"line\">  fork: true</span><br><span class=\"line\">  pidFilePath: &quot;&#x2F;opt&#x2F;mongodb-27017&#x2F;data&#x2F;mongod.pid&quot;</span><br><span class=\"line\">net:</span><br><span class=\"line\">  port: 27017</span><br><span class=\"line\">  http:</span><br><span class=\"line\">    enabled: true</span><br><span class=\"line\">storage:</span><br><span class=\"line\">  dbPath: &quot;&#x2F;opt&#x2F;mongodb-27017&#x2F;data&quot;</span><br><span class=\"line\">  engine: wiredTiger</span><br><span class=\"line\">  wiredTiger:</span><br><span class=\"line\">    engineConfig:</span><br><span class=\"line\">      cacheSizeGB: 1</span><br><span class=\"line\">      directoryForIndexes: true</span><br><span class=\"line\">    collectionConfig:</span><br><span class=\"line\">      blockCompressor: zlib</span><br><span class=\"line\">    indexConfig:</span><br><span class=\"line\">      prefixCompression: true</span><br><span class=\"line\">  journal:</span><br><span class=\"line\">    enabled: true</span><br><span class=\"line\">  directoryPerDB: true</span><br><span class=\"line\">security:</span><br><span class=\"line\">  authorization: enabled      # 开启关闭验证</span><br></pre></td></tr></table></figure>\n\n<p><code>mongo3.x以后的版本配置文件都是yaml格式的，官方关于mongo配置文件相关选项说明，https://docs.mongodb.org/manual/reference/configuration-options/#configuration-file</code></p>\n<p>启动mongo</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;opt&#x2F;mongodb-27017&#x2F;bin&#x2F;mongod -f &#x2F;opt&#x2F;mongodb-27017&#x2F;conf&#x2F;mongod.conf</span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ps -ef | grep mongo</span><br><span class=\"line\"></span><br><span class=\"line\">root      4801     1  1 15:25 ?        00:00:22 &#x2F;opt&#x2F;mongodb-27017&#x2F;bin&#x2F;mongod -f &#x2F;opt&#x2F;mongodb-27017&#x2F;conf&#x2F;mongod.conf</span><br><span class=\"line\">root      4849     1  1 15:29 ?        00:00:18 &#x2F;opt&#x2F;mongodb-27018&#x2F;bin&#x2F;mongod -f &#x2F;opt&#x2F;mongodb-27018&#x2F;conf&#x2F;mongod.conf</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h3 id=\"monodb-用户管理\"><a href=\"#monodb-用户管理\" class=\"headerlink\" title=\"monodb 用户管理\"></a>monodb 用户管理</h3><p>角色</p>\n<p>Read：    允许用户读取指定数据库</p>\n<p>readWrite：   允许用户读写指定数据库</p>\n<p>dbAdmin：    允许用户在指定数据库中执行管理函数，如索引创建、删除，查看统计或访问system.profile</p>\n<p>userAdmin：  允许用户向system.users集合写入，可以找指定数据库里创建、删除和管理用户</p>\n<p>clusterAdmin：  只在admin数据库中可用，赋予用户所有分片和复制集相关函数的管理权限。</p>\n<p>readAnyDatabase：   只在admin数据库中可用，赋予用户所有数据库的读权限</p>\n<p>readWriteAnyDatabase：   只在admin数据库中可用，赋予用户所有数据库的读写权限</p>\n<p>userAdminAnyDatabase：   只在admin数据库中可用，赋予用户所有数据库的userAdmin权限</p>\n<p>dbAdminAnyDatabase：   只在admin数据库中可用，赋予用户所有数据库的dbAdmin权限。</p>\n<p>root：   只在admin数据库中可用。超级账号，超级权限</p>\n<ol>\n<li>数据库用户角色：   read、readWrite；</li>\n<li>数据库管理角色：   dbAdmin、dbOwner、userAdmin;</li>\n<li>集群管理角色：      clusterAdmin、clusterManager、4. clusterMonitor、hostManage；</li>\n<li>备份恢复角色：     backup、restore；</li>\n<li>所有数据库角色：     readAnyDatabase、readWriteAnyDatabase、userAdminAnyDatabase、dbAdminAnyDatabase</li>\n<li>超级用户角色：    root</li>\n<li>内部角色：   __system</li>\n</ol>\n<p><code>注意： 用户在哪个库创建，就要在哪个库auth认证，并在mongo登录时也要先连接认证库</code></p>\n<h3 id=\"创建admin-超级管理员用户\"><a href=\"#创建admin-超级管理员用户\" class=\"headerlink\" title=\"创建admin 超级管理员用户\"></a>创建admin 超级管理员用户</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">use admin</span><br><span class=\"line\">db.createUser(</span><br><span class=\"line\">  &#123; user: &quot;admin&quot;,  </span><br><span class=\"line\">    customData：&#123;description:&quot;superuser&quot;&#125;,</span><br><span class=\"line\">    pwd: &quot;admin&quot;,  </span><br><span class=\"line\">    roles: [ &#123; role: &quot;userAdminAnyDatabase&quot;, db: &quot;admin&quot; &#125; ]  </span><br><span class=\"line\">  &#125;  </span><br><span class=\"line\">) </span><br></pre></td></tr></table></figure>\n\n<p>超级用户的role有两种，userAdmin或者userAdminAnyDatabase(比前一种多加了对所有数据库的访问,仅仅是访问而已)。</p>\n<h3 id=\"创建一个不受访问限制的超级用户\"><a href=\"#创建一个不受访问限制的超级用户\" class=\"headerlink\" title=\"创建一个不受访问限制的超级用户\"></a>创建一个不受访问限制的超级用户</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">use admin</span><br><span class=\"line\">db.createUser(</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        user:&quot;root&quot;,</span><br><span class=\"line\">        pwd:&quot;pwd&quot;,</span><br><span class=\"line\">        roles:[&quot;root&quot;]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"创建一个业务数据库管理员用户\"><a href=\"#创建一个业务数据库管理员用户\" class=\"headerlink\" title=\"创建一个业务数据库管理员用户\"></a>创建一个业务数据库管理员用户</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">use admin</span><br><span class=\"line\">db.createUser(&#123;</span><br><span class=\"line\">    user:&quot;user001&quot;,</span><br><span class=\"line\">    pwd:&quot;123456&quot;,</span><br><span class=\"line\">    customData:&#123;</span><br><span class=\"line\">        name:&#39;jim&#39;,</span><br><span class=\"line\">        email:&#39;jim@qq.com&#39;,</span><br><span class=\"line\">        age:18,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    roles:[</span><br><span class=\"line\">        &#123;role:&quot;readWrite&quot;,db:&quot;db001&quot;&#125;,</span><br><span class=\"line\">        &#123;role:&quot;readWrite&quot;,db:&quot;db002&quot;&#125;,</span><br><span class=\"line\">        &#39;read&#39;   &#x2F;&#x2F; 对其他数据库有只读权限，对db001、db002是读写权限</span><br><span class=\"line\">    ]</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"查看创建的用户\"><a href=\"#查看创建的用户\" class=\"headerlink\" title=\"查看创建的用户\"></a>查看创建的用户</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">show users    或     db.system.users.find()     或    db.runCommand(&#123;usersInfo:&quot;userName&quot;&#125;)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"修改密码\"><a href=\"#修改密码\" class=\"headerlink\" title=\"修改密码\"></a>修改密码</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">use admin</span><br><span class=\"line\">db.changeUserPassword(&quot;username&quot;, &quot;xxx&quot;)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"修改密码和用户信息\"><a href=\"#修改密码和用户信息\" class=\"headerlink\" title=\"修改密码和用户信息\"></a>修改密码和用户信息</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">db.runCommand(</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        updateUser:&quot;username&quot;,</span><br><span class=\"line\">        pwd:&quot;xxx&quot;,</span><br><span class=\"line\">        customData:&#123;title:&quot;xxx&quot;&#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"删除数据库用户\"><a href=\"#删除数据库用户\" class=\"headerlink\" title=\"删除数据库用户\"></a>删除数据库用户</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">use admin</span><br><span class=\"line\">db.dropUser(&#39;user001&#39;)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"创建其他数据管理员\"><a href=\"#创建其他数据管理员\" class=\"headerlink\" title=\"创建其他数据管理员\"></a>创建其他数据管理员</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F; 登录管理员用户</span><br><span class=\"line\">use admin</span><br><span class=\"line\">db.auth(&#39;admin&#39;,&#39;admin&#39;)</span><br><span class=\"line\">&#x2F;&#x2F; 切换至db001数据库</span><br><span class=\"line\">use db001</span><br><span class=\"line\">&#x2F;&#x2F; ... 増查改删该数据库专有用户</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">use admin</span><br><span class=\"line\">db.createUser(&#123;user:&#39;superadmin&#39;,pwd:&#39;123456&#39;, roles:[&#123;role:&#39;root&#39;, db:&#39;admin&#39;&#125;]&#125;)     ---创建超级管理员用户</span><br><span class=\"line\"> </span><br><span class=\"line\">db.createUser(&#123;user:&#39;useradmin&#39;,pwd:&#39;123456&#39;, roles:[&#123;role:&#39;userAdminAnyDatabase&#39;, db:&#39;admin&#39;&#125;]&#125;)     ---创建用户管理员账户（能查询其他库集合，但不能查询集合内容）</span><br><span class=\"line\"> </span><br><span class=\"line\">db.createUser(&#123;user:&#39;admin&#39;,pwd:&#39;123456&#39;, roles:[&#123;role:&#39;readWriteAnyDatabase&#39;, db:&#39;admin&#39;&#125;]&#125;)     ---创建访问任意库读写的账户</span><br><span class=\"line\"> </span><br><span class=\"line\">db.createUser(&#123;user:&#39;user1&#39;,pwd:&#39;user1&#39;,roles:[&#123;role:&#39;readWrite&#39;,db:&#39;test&#39;&#125;]&#125;)     ---创建只对test库有读写权限的用户</span><br><span class=\"line\"> </span><br><span class=\"line\">db.createUser(&#123;user:&quot;bkuser2&quot;,pwd:&quot;Bkuser2&quot;,roles:[&#123;role:&quot;backup&quot;,db:&quot;admin&quot;&#125;]&#125;)     ---创建用于备份时的用户，如若是恢复权限，则将backup换为restore即可</span><br><span class=\"line\">--- 注：新建backup账户时，roles里面的db必须是admin，要不然会报错</span><br></pre></td></tr></table></figure>\n\n\n\n\n","site":{"data":{}},"excerpt":"","more":"<h3 id=\"安装mongodb3-2\"><a href=\"#安装mongodb3-2\" class=\"headerlink\" title=\"安装mongodb3.2\"></a>安装mongodb3.2</h3><p>下载mongodb</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget https:&#x2F;&#x2F;fastdl.mongodb.org&#x2F;linux&#x2F;mongodb-linux-x86_64-rhel62-3.2.3.tgz</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tar xf mongodb-linux-x86_64-rhel62-3.2.3.tgz</span><br><span class=\"line\">mv mongodb-linux-x86_64-rhel62-3.2.3 mongodb</span><br><span class=\"line\">cd mongodb</span><br><span class=\"line\">mkdir data logs conf</span><br></pre></td></tr></table></figure>\n\n\n\n<p>配置文件</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim conf&#x2F;mongod.conf</span><br><span class=\"line\"></span><br><span class=\"line\">systemLog:</span><br><span class=\"line\">  destination: file</span><br><span class=\"line\">  path: &#x2F;opt&#x2F;mongodb-27017&#x2F;logs&#x2F;mongod.log</span><br><span class=\"line\">  logAppend: true</span><br><span class=\"line\">processManagement:</span><br><span class=\"line\">  fork: true</span><br><span class=\"line\">  pidFilePath: &quot;&#x2F;opt&#x2F;mongodb-27017&#x2F;data&#x2F;mongod.pid&quot;</span><br><span class=\"line\">net:</span><br><span class=\"line\">  port: 27017</span><br><span class=\"line\">  http:</span><br><span class=\"line\">    enabled: true</span><br><span class=\"line\">storage:</span><br><span class=\"line\">  dbPath: &quot;&#x2F;opt&#x2F;mongodb-27017&#x2F;data&quot;</span><br><span class=\"line\">  engine: wiredTiger</span><br><span class=\"line\">  wiredTiger:</span><br><span class=\"line\">    engineConfig:</span><br><span class=\"line\">      cacheSizeGB: 1</span><br><span class=\"line\">      directoryForIndexes: true</span><br><span class=\"line\">    collectionConfig:</span><br><span class=\"line\">      blockCompressor: zlib</span><br><span class=\"line\">    indexConfig:</span><br><span class=\"line\">      prefixCompression: true</span><br><span class=\"line\">  journal:</span><br><span class=\"line\">    enabled: true</span><br><span class=\"line\">  directoryPerDB: true</span><br><span class=\"line\">security:</span><br><span class=\"line\">  authorization: enabled      # 开启关闭验证</span><br></pre></td></tr></table></figure>\n\n<p><code>mongo3.x以后的版本配置文件都是yaml格式的，官方关于mongo配置文件相关选项说明，https://docs.mongodb.org/manual/reference/configuration-options/#configuration-file</code></p>\n<p>启动mongo</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;opt&#x2F;mongodb-27017&#x2F;bin&#x2F;mongod -f &#x2F;opt&#x2F;mongodb-27017&#x2F;conf&#x2F;mongod.conf</span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ps -ef | grep mongo</span><br><span class=\"line\"></span><br><span class=\"line\">root      4801     1  1 15:25 ?        00:00:22 &#x2F;opt&#x2F;mongodb-27017&#x2F;bin&#x2F;mongod -f &#x2F;opt&#x2F;mongodb-27017&#x2F;conf&#x2F;mongod.conf</span><br><span class=\"line\">root      4849     1  1 15:29 ?        00:00:18 &#x2F;opt&#x2F;mongodb-27018&#x2F;bin&#x2F;mongod -f &#x2F;opt&#x2F;mongodb-27018&#x2F;conf&#x2F;mongod.conf</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h3 id=\"monodb-用户管理\"><a href=\"#monodb-用户管理\" class=\"headerlink\" title=\"monodb 用户管理\"></a>monodb 用户管理</h3><p>角色</p>\n<p>Read：    允许用户读取指定数据库</p>\n<p>readWrite：   允许用户读写指定数据库</p>\n<p>dbAdmin：    允许用户在指定数据库中执行管理函数，如索引创建、删除，查看统计或访问system.profile</p>\n<p>userAdmin：  允许用户向system.users集合写入，可以找指定数据库里创建、删除和管理用户</p>\n<p>clusterAdmin：  只在admin数据库中可用，赋予用户所有分片和复制集相关函数的管理权限。</p>\n<p>readAnyDatabase：   只在admin数据库中可用，赋予用户所有数据库的读权限</p>\n<p>readWriteAnyDatabase：   只在admin数据库中可用，赋予用户所有数据库的读写权限</p>\n<p>userAdminAnyDatabase：   只在admin数据库中可用，赋予用户所有数据库的userAdmin权限</p>\n<p>dbAdminAnyDatabase：   只在admin数据库中可用，赋予用户所有数据库的dbAdmin权限。</p>\n<p>root：   只在admin数据库中可用。超级账号，超级权限</p>\n<ol>\n<li>数据库用户角色：   read、readWrite；</li>\n<li>数据库管理角色：   dbAdmin、dbOwner、userAdmin;</li>\n<li>集群管理角色：      clusterAdmin、clusterManager、4. clusterMonitor、hostManage；</li>\n<li>备份恢复角色：     backup、restore；</li>\n<li>所有数据库角色：     readAnyDatabase、readWriteAnyDatabase、userAdminAnyDatabase、dbAdminAnyDatabase</li>\n<li>超级用户角色：    root</li>\n<li>内部角色：   __system</li>\n</ol>\n<p><code>注意： 用户在哪个库创建，就要在哪个库auth认证，并在mongo登录时也要先连接认证库</code></p>\n<h3 id=\"创建admin-超级管理员用户\"><a href=\"#创建admin-超级管理员用户\" class=\"headerlink\" title=\"创建admin 超级管理员用户\"></a>创建admin 超级管理员用户</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">use admin</span><br><span class=\"line\">db.createUser(</span><br><span class=\"line\">  &#123; user: &quot;admin&quot;,  </span><br><span class=\"line\">    customData：&#123;description:&quot;superuser&quot;&#125;,</span><br><span class=\"line\">    pwd: &quot;admin&quot;,  </span><br><span class=\"line\">    roles: [ &#123; role: &quot;userAdminAnyDatabase&quot;, db: &quot;admin&quot; &#125; ]  </span><br><span class=\"line\">  &#125;  </span><br><span class=\"line\">) </span><br></pre></td></tr></table></figure>\n\n<p>超级用户的role有两种，userAdmin或者userAdminAnyDatabase(比前一种多加了对所有数据库的访问,仅仅是访问而已)。</p>\n<h3 id=\"创建一个不受访问限制的超级用户\"><a href=\"#创建一个不受访问限制的超级用户\" class=\"headerlink\" title=\"创建一个不受访问限制的超级用户\"></a>创建一个不受访问限制的超级用户</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">use admin</span><br><span class=\"line\">db.createUser(</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        user:&quot;root&quot;,</span><br><span class=\"line\">        pwd:&quot;pwd&quot;,</span><br><span class=\"line\">        roles:[&quot;root&quot;]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"创建一个业务数据库管理员用户\"><a href=\"#创建一个业务数据库管理员用户\" class=\"headerlink\" title=\"创建一个业务数据库管理员用户\"></a>创建一个业务数据库管理员用户</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">use admin</span><br><span class=\"line\">db.createUser(&#123;</span><br><span class=\"line\">    user:&quot;user001&quot;,</span><br><span class=\"line\">    pwd:&quot;123456&quot;,</span><br><span class=\"line\">    customData:&#123;</span><br><span class=\"line\">        name:&#39;jim&#39;,</span><br><span class=\"line\">        email:&#39;jim@qq.com&#39;,</span><br><span class=\"line\">        age:18,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    roles:[</span><br><span class=\"line\">        &#123;role:&quot;readWrite&quot;,db:&quot;db001&quot;&#125;,</span><br><span class=\"line\">        &#123;role:&quot;readWrite&quot;,db:&quot;db002&quot;&#125;,</span><br><span class=\"line\">        &#39;read&#39;   &#x2F;&#x2F; 对其他数据库有只读权限，对db001、db002是读写权限</span><br><span class=\"line\">    ]</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"查看创建的用户\"><a href=\"#查看创建的用户\" class=\"headerlink\" title=\"查看创建的用户\"></a>查看创建的用户</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">show users    或     db.system.users.find()     或    db.runCommand(&#123;usersInfo:&quot;userName&quot;&#125;)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"修改密码\"><a href=\"#修改密码\" class=\"headerlink\" title=\"修改密码\"></a>修改密码</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">use admin</span><br><span class=\"line\">db.changeUserPassword(&quot;username&quot;, &quot;xxx&quot;)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"修改密码和用户信息\"><a href=\"#修改密码和用户信息\" class=\"headerlink\" title=\"修改密码和用户信息\"></a>修改密码和用户信息</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">db.runCommand(</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        updateUser:&quot;username&quot;,</span><br><span class=\"line\">        pwd:&quot;xxx&quot;,</span><br><span class=\"line\">        customData:&#123;title:&quot;xxx&quot;&#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"删除数据库用户\"><a href=\"#删除数据库用户\" class=\"headerlink\" title=\"删除数据库用户\"></a>删除数据库用户</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">use admin</span><br><span class=\"line\">db.dropUser(&#39;user001&#39;)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"创建其他数据管理员\"><a href=\"#创建其他数据管理员\" class=\"headerlink\" title=\"创建其他数据管理员\"></a>创建其他数据管理员</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F; 登录管理员用户</span><br><span class=\"line\">use admin</span><br><span class=\"line\">db.auth(&#39;admin&#39;,&#39;admin&#39;)</span><br><span class=\"line\">&#x2F;&#x2F; 切换至db001数据库</span><br><span class=\"line\">use db001</span><br><span class=\"line\">&#x2F;&#x2F; ... 増查改删该数据库专有用户</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">use admin</span><br><span class=\"line\">db.createUser(&#123;user:&#39;superadmin&#39;,pwd:&#39;123456&#39;, roles:[&#123;role:&#39;root&#39;, db:&#39;admin&#39;&#125;]&#125;)     ---创建超级管理员用户</span><br><span class=\"line\"> </span><br><span class=\"line\">db.createUser(&#123;user:&#39;useradmin&#39;,pwd:&#39;123456&#39;, roles:[&#123;role:&#39;userAdminAnyDatabase&#39;, db:&#39;admin&#39;&#125;]&#125;)     ---创建用户管理员账户（能查询其他库集合，但不能查询集合内容）</span><br><span class=\"line\"> </span><br><span class=\"line\">db.createUser(&#123;user:&#39;admin&#39;,pwd:&#39;123456&#39;, roles:[&#123;role:&#39;readWriteAnyDatabase&#39;, db:&#39;admin&#39;&#125;]&#125;)     ---创建访问任意库读写的账户</span><br><span class=\"line\"> </span><br><span class=\"line\">db.createUser(&#123;user:&#39;user1&#39;,pwd:&#39;user1&#39;,roles:[&#123;role:&#39;readWrite&#39;,db:&#39;test&#39;&#125;]&#125;)     ---创建只对test库有读写权限的用户</span><br><span class=\"line\"> </span><br><span class=\"line\">db.createUser(&#123;user:&quot;bkuser2&quot;,pwd:&quot;Bkuser2&quot;,roles:[&#123;role:&quot;backup&quot;,db:&quot;admin&quot;&#125;]&#125;)     ---创建用于备份时的用户，如若是恢复权限，则将backup换为restore即可</span><br><span class=\"line\">--- 注：新建backup账户时，roles里面的db必须是admin，要不然会报错</span><br></pre></td></tr></table></figure>\n\n\n\n\n"},{"title":"禁止通过ip访问nginx","date":"2021-08-13T03:18:00.000Z","_content":"\t\n\t\n摘要: 禁止通过ip+端口的方式访问nginx 的80 和443 端口\n<!-- more -->\n\n\n在nginx 配置文件中添加如下配置\n\nNginx 上对于 SSL 服务器在不配置证书的时候会出现协议错误，哪怕端口上配置了其他网站也会报错。解决方法就是随便生成一个证书填进去就好。\n\nnginx.conf\n```\n    server {\n        listen 80 default;\n        listen 443 default_server;\n        server_name _;\n        return 403;\n\n        #SSL-START SSL相关配置，请勿删除或修改下一行带注释的404规则\n        #error_page 404/404.html;\n        ssl_protocols TLSv1 TLSv1.1 TLSv1.2;\n        ssl_ciphers EECDH+CHACHA20:EECDH+CHACHA20-draft:EECDH+AES128:RSA+AES128:EECDH+AES256:RSA+AES256:EECDH+3DES:RSA+3DES:!MD5;\n        ssl_session_cache builtin:1000 shared:SSL:10m;\n        resolver 8.8.8.8 8.8.4.4 valid=300s;\n        resolver_timeout 5s;\n        ssl_prefer_server_ciphers on;\n        ssl_certificate /ztocwst/nginx/cert/fullchain1.pem;\n        ssl_certificate_key /ztocwst/nginx/cert/privkey1.pem;\n        ssl_session_timeout 5m;\n        ssl_session_tickets on;\n        ssl_stapling on;\n        ssl_stapling_verify on;\n        error_page 497  https://$host$request_uri;\n        #SSL-END\n    }\n```","source":"_posts/nginx/nginx禁止ip访问.md","raw":"---\ntitle: 禁止通过ip访问nginx\ndate: 2021-08-13 11:18\ncategories:\n- nginx\ntags:\n- nginx\n---\n\t\n\t\n摘要: 禁止通过ip+端口的方式访问nginx 的80 和443 端口\n<!-- more -->\n\n\n在nginx 配置文件中添加如下配置\n\nNginx 上对于 SSL 服务器在不配置证书的时候会出现协议错误，哪怕端口上配置了其他网站也会报错。解决方法就是随便生成一个证书填进去就好。\n\nnginx.conf\n```\n    server {\n        listen 80 default;\n        listen 443 default_server;\n        server_name _;\n        return 403;\n\n        #SSL-START SSL相关配置，请勿删除或修改下一行带注释的404规则\n        #error_page 404/404.html;\n        ssl_protocols TLSv1 TLSv1.1 TLSv1.2;\n        ssl_ciphers EECDH+CHACHA20:EECDH+CHACHA20-draft:EECDH+AES128:RSA+AES128:EECDH+AES256:RSA+AES256:EECDH+3DES:RSA+3DES:!MD5;\n        ssl_session_cache builtin:1000 shared:SSL:10m;\n        resolver 8.8.8.8 8.8.4.4 valid=300s;\n        resolver_timeout 5s;\n        ssl_prefer_server_ciphers on;\n        ssl_certificate /ztocwst/nginx/cert/fullchain1.pem;\n        ssl_certificate_key /ztocwst/nginx/cert/privkey1.pem;\n        ssl_session_timeout 5m;\n        ssl_session_tickets on;\n        ssl_stapling on;\n        ssl_stapling_verify on;\n        error_page 497  https://$host$request_uri;\n        #SSL-END\n    }\n```","slug":"nginx/nginx禁止ip访问","published":1,"updated":"2021-08-13T03:21:00.475Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cku697a0h006400uh8u896ugq","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><p>摘要: 禁止通过ip+端口的方式访问nginx 的80 和443 端口</p>\n<span id=\"more\"></span>\n\n\n<p>在nginx 配置文件中添加如下配置</p>\n<p>Nginx 上对于 SSL 服务器在不配置证书的时候会出现协议错误，哪怕端口上配置了其他网站也会报错。解决方法就是随便生成一个证书填进去就好。</p>\n<p>nginx.conf</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">server &#123;</span><br><span class=\"line\">    listen 80 default;</span><br><span class=\"line\">    listen 443 default_server;</span><br><span class=\"line\">    server_name _;</span><br><span class=\"line\">    return 403;</span><br><span class=\"line\"></span><br><span class=\"line\">    #SSL-START SSL相关配置，请勿删除或修改下一行带注释的404规则</span><br><span class=\"line\">    #error_page 404&#x2F;404.html;</span><br><span class=\"line\">    ssl_protocols TLSv1 TLSv1.1 TLSv1.2;</span><br><span class=\"line\">    ssl_ciphers EECDH+CHACHA20:EECDH+CHACHA20-draft:EECDH+AES128:RSA+AES128:EECDH+AES256:RSA+AES256:EECDH+3DES:RSA+3DES:!MD5;</span><br><span class=\"line\">    ssl_session_cache builtin:1000 shared:SSL:10m;</span><br><span class=\"line\">    resolver 8.8.8.8 8.8.4.4 valid&#x3D;300s;</span><br><span class=\"line\">    resolver_timeout 5s;</span><br><span class=\"line\">    ssl_prefer_server_ciphers on;</span><br><span class=\"line\">    ssl_certificate &#x2F;ztocwst&#x2F;nginx&#x2F;cert&#x2F;fullchain1.pem;</span><br><span class=\"line\">    ssl_certificate_key &#x2F;ztocwst&#x2F;nginx&#x2F;cert&#x2F;privkey1.pem;</span><br><span class=\"line\">    ssl_session_timeout 5m;</span><br><span class=\"line\">    ssl_session_tickets on;</span><br><span class=\"line\">    ssl_stapling on;</span><br><span class=\"line\">    ssl_stapling_verify on;</span><br><span class=\"line\">    error_page 497  https:&#x2F;&#x2F;$host$request_uri;</span><br><span class=\"line\">    #SSL-END</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"<p>摘要: 禁止通过ip+端口的方式访问nginx 的80 和443 端口</p>","more":"<p>在nginx 配置文件中添加如下配置</p>\n<p>Nginx 上对于 SSL 服务器在不配置证书的时候会出现协议错误，哪怕端口上配置了其他网站也会报错。解决方法就是随便生成一个证书填进去就好。</p>\n<p>nginx.conf</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">server &#123;</span><br><span class=\"line\">    listen 80 default;</span><br><span class=\"line\">    listen 443 default_server;</span><br><span class=\"line\">    server_name _;</span><br><span class=\"line\">    return 403;</span><br><span class=\"line\"></span><br><span class=\"line\">    #SSL-START SSL相关配置，请勿删除或修改下一行带注释的404规则</span><br><span class=\"line\">    #error_page 404&#x2F;404.html;</span><br><span class=\"line\">    ssl_protocols TLSv1 TLSv1.1 TLSv1.2;</span><br><span class=\"line\">    ssl_ciphers EECDH+CHACHA20:EECDH+CHACHA20-draft:EECDH+AES128:RSA+AES128:EECDH+AES256:RSA+AES256:EECDH+3DES:RSA+3DES:!MD5;</span><br><span class=\"line\">    ssl_session_cache builtin:1000 shared:SSL:10m;</span><br><span class=\"line\">    resolver 8.8.8.8 8.8.4.4 valid&#x3D;300s;</span><br><span class=\"line\">    resolver_timeout 5s;</span><br><span class=\"line\">    ssl_prefer_server_ciphers on;</span><br><span class=\"line\">    ssl_certificate &#x2F;ztocwst&#x2F;nginx&#x2F;cert&#x2F;fullchain1.pem;</span><br><span class=\"line\">    ssl_certificate_key &#x2F;ztocwst&#x2F;nginx&#x2F;cert&#x2F;privkey1.pem;</span><br><span class=\"line\">    ssl_session_timeout 5m;</span><br><span class=\"line\">    ssl_session_tickets on;</span><br><span class=\"line\">    ssl_stapling on;</span><br><span class=\"line\">    ssl_stapling_verify on;</span><br><span class=\"line\">    error_page 497  https:&#x2F;&#x2F;$host$request_uri;</span><br><span class=\"line\">    #SSL-END</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>"},{"title":"docker的thanos的部暑","date":"2021-09-08T09:41:00.000Z","_content":"\t\n\t\n摘要: desc\n<!-- more -->\n\n## 架构\n\n10.200.92.117 \n\tthanos / querier\n\tthanos / storer\n\tthanos / compactor\n\tminio \n\n10.200.76.70\n\tprometheus\n\tthanos / sidecar\n\n## thanos 组件\n\n\n## 目录创建\n```\nmkdir -p /opt/prome \ncd /opt/prome\nmkdir -p minio/data\nmkdir thanos\n```\n\n## 配置文件\n\n创建thanos 调用minio 的配置文件\n\n```\nvim thanos/bucket_config.yaml\n\ntype: S3\nconfig:\n  bucket: \"thanos\"\n  endpoint: '10.200.92.117:9001'  # minio 接口地址\n  access_key: \"root\"\n  secret_key: \"TTP7Jwho\"   #设置s3密码，保证8位以上的长度\n  insecure: true     #是否使用安全协议http或https\n  signature_version2: false\n  encrypt_sse: false\n  put_user_metadata: {}\n  http_config:\n    idle_conn_timeout: 90s\n    response_header_timeout: 2m\n    insecure_skip_verify: false\n  trace:\n    enable: false\n  part_size: 134217728\n\n```\n\nprometheus 配置文件,。必须定义extends label，用于区分相同metrics的数据源\n```\nglobal:\n  scrape_interval:     60s\n  evaluation_interval: 60s\n  external_labels:\n    monitor: 'base'\n\n#常规配置...\n```\n\n\n## 应用启动\n### thanos \n\n```\nvim docker-compose.yml\n\n\n\nversion: '2'\nservices:\n\n##############################################################\n  # to search on old metrics\n  storer:\n    container_name: storer\n    image: quay.io/thanos/thanos:v0.13.0-rc.2\n    volumes:\n    - /opt/prome/thanos/bucket_config.yaml:/bucket_config.yaml\n    command:\n    - store\n    - --data-dir=/var/thanos/store\n    - --objstore.config-file=bucket_config.yaml\n    - --http-address=0.0.0.0:19191\n    - --grpc-address=0.0.0.0:19090\n    depends_on:\n      - minio  \n    networks:\n      - prom\n\n  # downsample metrics on the bucket\n  compactor:\n    container_name: compactor\n    image: quay.io/thanos/thanos:v0.13.0-rc.2\n    volumes:\n    - /opt/prome/thanos/bucket_config.yaml:/bucket_config.yaml\n    command:\n    - compact\n    - --data-dir=/var/thanos/compact\n    - --objstore.config-file=bucket_config.yaml\n    - --http-address=0.0.0.0:19191\n    - --wait\n    depends_on:\n      - minio \n    networks:\n      - prom\n\n  # querier component which can be scaled\n  querier:\n    container_name: querier\n    image: quay.io/thanos/thanos:v0.13.0-rc.2\n#    labels:\n#      - \"traefik.enable=true\"\n#      - \"traefik.port=19192\"\n#      - \"traefik.frontend.rule=PathPrefix:/\"\n    ports: \n      - \"19192:19192\"\n    command:\n      - query\n      - --http-address=0.0.0.0:19192\n      - --store=10.200.76.70:19292\n      - --store=storer:19090\n      - --query.replica-label=replica\n    networks:\n      - prom\n\n  minio:\n    image: minio/minio:latest\n    container_name: minio\n    ports:\n      - 9000:9000\n      - 9001:9001\n    volumes: \n      - \"/opt/prome/minio/data:/data\"\n    environment:\n      MINIO_ROOT_USER: \"root\"\n      MINIO_ROOT_PASSWORD: \"TTP7Jwho\" #输入8位以上的密码\n    command: \"server /data --console-address :9000 --address :9001\"\n    restart: always\n    logging:\n      driver: \"json-file\"\n      options:\n        max-size: \"5m\"\n        max-file: \"3\"\n    networks:\n      - prom\n\n\n# 按需启用\n#  node-exporter:\n#    image: prom/node-exporter:latest\n#    container_name: node-exporter\n#    ports:\n#      - '9100:9100'\n\n\nnetworks:\n  prom:\n    driver: bridge\n\n\n```\n\n\n\n## prometheus \n\nweb.enable-lifecycle 一定要开，用于热加载时 reload 你的配置，retention 保留 2 小时，Prometheus 默认 2 小时会生成一个 block，Thanos 会把这个 block 上传到对象存储。\n\nprometheus抓取到的监控数据在落盘之前都是存储在内存中的，所以适当的减小数据落盘时间可以减小内存的压力\nstorage.tsdb.max-block-duration: 设置数据块最小时间跨度，默认 2h 的数据量。监控数据是按块（block）存储，每一个块中包含该时间窗口内的所有样本数据（data chunks)\nstorage.tsdb.min-block-duration\t设置数据块最大时间跨度，默认为最大保留时间的 10%\n\n\n```\nmkdir -p /opt/prom/{prometheus,thanos}\n```\n\n\n```\nvim docker-compose.yml\n\nversion: '3.7'\n\nservices:\n\n# 按需启用\n#  node-exporter:\n#    image: prom/node-exporter:latest\n#    ports:\n#      - \"9100:9100\"\n#    networks:\n#      - prom\n\n#  dingtalk:\n#    image: timonwong/prometheus-webhook-dingtalk:latest\n#    volumes:\n#      - type: bind\n#        source: ./alertmanager/config.yml\n#        target: /etc/prometheus-webhook-dingtalk/config.yml\n#        read_only: true\n#    ports:\n#      - \"8060:8060\"\n#    networks:\n#      - prom\n\n  alertmanager:\n#    depends_on:\n#      - dingtalk\n    image: prom/alertmanager:latest\n    environment:\n      - TZ=Asia/Shanghai\n    volumes:\n      - type: bind\n        source: ./alertmanager/alertmanager.yml\n        target: /etc/alertmanager/alertmanager.yml\n        read_only: true\n    command: \n      - --config.file=/etc/alertmanager/alertmanager.yml \n      - --web.external-url=http://10.200.76.70:9093\n\n    ports:\n      - \"9093:9093\"\n      - \"9094:9094\"\n    networks:\n      - prom\n\n  prometheus:\n    depends_on:\n      - alertmanager\n    image: prom/prometheus:latest\n    environment:\n      - TZ=Asia/Shanghai\n    volumes:\n      - type: bind\n        source: ./prometheus/prometheus.yml\n        target: /etc/prometheus/prometheus.yml\n        read_only: true\n #     - type: bind\n #       source: ./prometheus/rules/alert-rules.yml\n #       target: /etc/prometheus/alert-rules.yml\n #       read_only: true\n      - type: volume\n        source: prometheus\n        target: /prometheus\n      - \"/opt/prom/prometheus/rules:/etc/prometheus/rules\"\n      - \"/opt/prom/prometheus/targets:/etc/prometheus/targets\"\n    command: \n      - --config.file=/etc/prometheus/prometheus.yml \n      - --storage.tsdb.path=/prometheus \n      - --storage.tsdb.retention=60d \n      - --web.enable-lifecycle\n      - --web.enable-admin-api \n      - --web.external-url=http://10.200.76.70:9090\n#      - --storage.tsdb.min-block-duration = --storage.tsdb.max-block-duration\n      - --storage.tsdb.min-block-duration=6d\n      - --storage.tsdb.max-block-duration=6d\n    ports:\n      - \"9090:9090\"\n    networks:\n      - prom\n\n\n  grafana:\n    depends_on:\n      - prometheus\n    image: grafana/grafana:latest\n    volumes:\n      - type: volume\n        source: grafana\n        target: /var/lib/grafana\n    ports:\n      - \"3000:3000\"\n    networks:\n      - prom\n\n\n  black-exporter:\n    environment:\n      - TZ=Asia/Shanghai\n    image: prom/blackbox-exporter:latest\n    volumes:\n      - /opt/prom/black-exporter/blackbox.yml:/config/blackbox.yml\n    command:\n      - '--config.file=/config/blackbox.yml'\n    ports:\n      - '9115:9115'\n    networks:\n      - prom\n\n  sidecar:\n    container_name: sidecar\n    image: quay.io/thanos/thanos:v0.13.0-rc.2\n    logging:\n      driver: \"json-file\"\n      options:\n        max-size: \"5m\"\n        max-file: \"3\"\n    volumes:\n      - type: volume\n        source: prometheus\n        target: /var/prometheus\n      - /opt/prom/thanos/bucket_config.yaml:/bucket_config.yaml\n    command:\n      - sidecar\n      - --tsdb.path=/var/prometheus\n      - --prometheus.url=http://10.200.76.70:9090\n      - --objstore.config-file=/bucket_config.yaml\n      - --http-address=0.0.0.0:19191\n      - --grpc-address=0.0.0.0:19292\n    ports:\n      - \"19191:19191\"\n      - \"19292:19292\"\n    depends_on:\n      - prometheus\n    networks:\n      - prom\n\nvolumes:\n  prometheus:\n    driver: local\n    driver_opts:\n      type: none\n      o: bind\n      device: /opt/prom/prometheus/data\n  grafana:\n    driver: local\n    driver_opts:\n      type: none\n      o: bind\n      device: /opt/prom/grafana\n      \nnetworks:\n  prom:\n    driver: bridge\n\n\n```","source":"_posts/prometheus/docker的thanos的部暑.md","raw":"---\ntitle: docker的thanos的部暑\ndate: 2021-09-08 17:41\ncategories:\n- prometheus\ntags:\n- prome\n- thanos\n---\n\t\n\t\n摘要: desc\n<!-- more -->\n\n## 架构\n\n10.200.92.117 \n\tthanos / querier\n\tthanos / storer\n\tthanos / compactor\n\tminio \n\n10.200.76.70\n\tprometheus\n\tthanos / sidecar\n\n## thanos 组件\n\n\n## 目录创建\n```\nmkdir -p /opt/prome \ncd /opt/prome\nmkdir -p minio/data\nmkdir thanos\n```\n\n## 配置文件\n\n创建thanos 调用minio 的配置文件\n\n```\nvim thanos/bucket_config.yaml\n\ntype: S3\nconfig:\n  bucket: \"thanos\"\n  endpoint: '10.200.92.117:9001'  # minio 接口地址\n  access_key: \"root\"\n  secret_key: \"TTP7Jwho\"   #设置s3密码，保证8位以上的长度\n  insecure: true     #是否使用安全协议http或https\n  signature_version2: false\n  encrypt_sse: false\n  put_user_metadata: {}\n  http_config:\n    idle_conn_timeout: 90s\n    response_header_timeout: 2m\n    insecure_skip_verify: false\n  trace:\n    enable: false\n  part_size: 134217728\n\n```\n\nprometheus 配置文件,。必须定义extends label，用于区分相同metrics的数据源\n```\nglobal:\n  scrape_interval:     60s\n  evaluation_interval: 60s\n  external_labels:\n    monitor: 'base'\n\n#常规配置...\n```\n\n\n## 应用启动\n### thanos \n\n```\nvim docker-compose.yml\n\n\n\nversion: '2'\nservices:\n\n##############################################################\n  # to search on old metrics\n  storer:\n    container_name: storer\n    image: quay.io/thanos/thanos:v0.13.0-rc.2\n    volumes:\n    - /opt/prome/thanos/bucket_config.yaml:/bucket_config.yaml\n    command:\n    - store\n    - --data-dir=/var/thanos/store\n    - --objstore.config-file=bucket_config.yaml\n    - --http-address=0.0.0.0:19191\n    - --grpc-address=0.0.0.0:19090\n    depends_on:\n      - minio  \n    networks:\n      - prom\n\n  # downsample metrics on the bucket\n  compactor:\n    container_name: compactor\n    image: quay.io/thanos/thanos:v0.13.0-rc.2\n    volumes:\n    - /opt/prome/thanos/bucket_config.yaml:/bucket_config.yaml\n    command:\n    - compact\n    - --data-dir=/var/thanos/compact\n    - --objstore.config-file=bucket_config.yaml\n    - --http-address=0.0.0.0:19191\n    - --wait\n    depends_on:\n      - minio \n    networks:\n      - prom\n\n  # querier component which can be scaled\n  querier:\n    container_name: querier\n    image: quay.io/thanos/thanos:v0.13.0-rc.2\n#    labels:\n#      - \"traefik.enable=true\"\n#      - \"traefik.port=19192\"\n#      - \"traefik.frontend.rule=PathPrefix:/\"\n    ports: \n      - \"19192:19192\"\n    command:\n      - query\n      - --http-address=0.0.0.0:19192\n      - --store=10.200.76.70:19292\n      - --store=storer:19090\n      - --query.replica-label=replica\n    networks:\n      - prom\n\n  minio:\n    image: minio/minio:latest\n    container_name: minio\n    ports:\n      - 9000:9000\n      - 9001:9001\n    volumes: \n      - \"/opt/prome/minio/data:/data\"\n    environment:\n      MINIO_ROOT_USER: \"root\"\n      MINIO_ROOT_PASSWORD: \"TTP7Jwho\" #输入8位以上的密码\n    command: \"server /data --console-address :9000 --address :9001\"\n    restart: always\n    logging:\n      driver: \"json-file\"\n      options:\n        max-size: \"5m\"\n        max-file: \"3\"\n    networks:\n      - prom\n\n\n# 按需启用\n#  node-exporter:\n#    image: prom/node-exporter:latest\n#    container_name: node-exporter\n#    ports:\n#      - '9100:9100'\n\n\nnetworks:\n  prom:\n    driver: bridge\n\n\n```\n\n\n\n## prometheus \n\nweb.enable-lifecycle 一定要开，用于热加载时 reload 你的配置，retention 保留 2 小时，Prometheus 默认 2 小时会生成一个 block，Thanos 会把这个 block 上传到对象存储。\n\nprometheus抓取到的监控数据在落盘之前都是存储在内存中的，所以适当的减小数据落盘时间可以减小内存的压力\nstorage.tsdb.max-block-duration: 设置数据块最小时间跨度，默认 2h 的数据量。监控数据是按块（block）存储，每一个块中包含该时间窗口内的所有样本数据（data chunks)\nstorage.tsdb.min-block-duration\t设置数据块最大时间跨度，默认为最大保留时间的 10%\n\n\n```\nmkdir -p /opt/prom/{prometheus,thanos}\n```\n\n\n```\nvim docker-compose.yml\n\nversion: '3.7'\n\nservices:\n\n# 按需启用\n#  node-exporter:\n#    image: prom/node-exporter:latest\n#    ports:\n#      - \"9100:9100\"\n#    networks:\n#      - prom\n\n#  dingtalk:\n#    image: timonwong/prometheus-webhook-dingtalk:latest\n#    volumes:\n#      - type: bind\n#        source: ./alertmanager/config.yml\n#        target: /etc/prometheus-webhook-dingtalk/config.yml\n#        read_only: true\n#    ports:\n#      - \"8060:8060\"\n#    networks:\n#      - prom\n\n  alertmanager:\n#    depends_on:\n#      - dingtalk\n    image: prom/alertmanager:latest\n    environment:\n      - TZ=Asia/Shanghai\n    volumes:\n      - type: bind\n        source: ./alertmanager/alertmanager.yml\n        target: /etc/alertmanager/alertmanager.yml\n        read_only: true\n    command: \n      - --config.file=/etc/alertmanager/alertmanager.yml \n      - --web.external-url=http://10.200.76.70:9093\n\n    ports:\n      - \"9093:9093\"\n      - \"9094:9094\"\n    networks:\n      - prom\n\n  prometheus:\n    depends_on:\n      - alertmanager\n    image: prom/prometheus:latest\n    environment:\n      - TZ=Asia/Shanghai\n    volumes:\n      - type: bind\n        source: ./prometheus/prometheus.yml\n        target: /etc/prometheus/prometheus.yml\n        read_only: true\n #     - type: bind\n #       source: ./prometheus/rules/alert-rules.yml\n #       target: /etc/prometheus/alert-rules.yml\n #       read_only: true\n      - type: volume\n        source: prometheus\n        target: /prometheus\n      - \"/opt/prom/prometheus/rules:/etc/prometheus/rules\"\n      - \"/opt/prom/prometheus/targets:/etc/prometheus/targets\"\n    command: \n      - --config.file=/etc/prometheus/prometheus.yml \n      - --storage.tsdb.path=/prometheus \n      - --storage.tsdb.retention=60d \n      - --web.enable-lifecycle\n      - --web.enable-admin-api \n      - --web.external-url=http://10.200.76.70:9090\n#      - --storage.tsdb.min-block-duration = --storage.tsdb.max-block-duration\n      - --storage.tsdb.min-block-duration=6d\n      - --storage.tsdb.max-block-duration=6d\n    ports:\n      - \"9090:9090\"\n    networks:\n      - prom\n\n\n  grafana:\n    depends_on:\n      - prometheus\n    image: grafana/grafana:latest\n    volumes:\n      - type: volume\n        source: grafana\n        target: /var/lib/grafana\n    ports:\n      - \"3000:3000\"\n    networks:\n      - prom\n\n\n  black-exporter:\n    environment:\n      - TZ=Asia/Shanghai\n    image: prom/blackbox-exporter:latest\n    volumes:\n      - /opt/prom/black-exporter/blackbox.yml:/config/blackbox.yml\n    command:\n      - '--config.file=/config/blackbox.yml'\n    ports:\n      - '9115:9115'\n    networks:\n      - prom\n\n  sidecar:\n    container_name: sidecar\n    image: quay.io/thanos/thanos:v0.13.0-rc.2\n    logging:\n      driver: \"json-file\"\n      options:\n        max-size: \"5m\"\n        max-file: \"3\"\n    volumes:\n      - type: volume\n        source: prometheus\n        target: /var/prometheus\n      - /opt/prom/thanos/bucket_config.yaml:/bucket_config.yaml\n    command:\n      - sidecar\n      - --tsdb.path=/var/prometheus\n      - --prometheus.url=http://10.200.76.70:9090\n      - --objstore.config-file=/bucket_config.yaml\n      - --http-address=0.0.0.0:19191\n      - --grpc-address=0.0.0.0:19292\n    ports:\n      - \"19191:19191\"\n      - \"19292:19292\"\n    depends_on:\n      - prometheus\n    networks:\n      - prom\n\nvolumes:\n  prometheus:\n    driver: local\n    driver_opts:\n      type: none\n      o: bind\n      device: /opt/prom/prometheus/data\n  grafana:\n    driver: local\n    driver_opts:\n      type: none\n      o: bind\n      device: /opt/prom/grafana\n      \nnetworks:\n  prom:\n    driver: bridge\n\n\n```","slug":"prometheus/docker的thanos的部暑","published":1,"updated":"2021-09-09T02:51:37.767Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cku697a0j006900uhba516i4s","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><p>摘要: desc</p>\n<span id=\"more\"></span>\n\n<h2 id=\"架构\"><a href=\"#架构\" class=\"headerlink\" title=\"架构\"></a>架构</h2><p>10.200.92.117<br>    thanos / querier<br>    thanos / storer<br>    thanos / compactor<br>    minio </p>\n<p>10.200.76.70<br>    prometheus<br>    thanos / sidecar</p>\n<h2 id=\"thanos-组件\"><a href=\"#thanos-组件\" class=\"headerlink\" title=\"thanos 组件\"></a>thanos 组件</h2><h2 id=\"目录创建\"><a href=\"#目录创建\" class=\"headerlink\" title=\"目录创建\"></a>目录创建</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir -p &#x2F;opt&#x2F;prome </span><br><span class=\"line\">cd &#x2F;opt&#x2F;prome</span><br><span class=\"line\">mkdir -p minio&#x2F;data</span><br><span class=\"line\">mkdir thanos</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"配置文件\"><a href=\"#配置文件\" class=\"headerlink\" title=\"配置文件\"></a>配置文件</h2><p>创建thanos 调用minio 的配置文件</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim thanos&#x2F;bucket_config.yaml</span><br><span class=\"line\"></span><br><span class=\"line\">type: S3</span><br><span class=\"line\">config:</span><br><span class=\"line\">  bucket: &quot;thanos&quot;</span><br><span class=\"line\">  endpoint: &#39;10.200.92.117:9001&#39;  # minio 接口地址</span><br><span class=\"line\">  access_key: &quot;root&quot;</span><br><span class=\"line\">  secret_key: &quot;TTP7Jwho&quot;   #设置s3密码，保证8位以上的长度</span><br><span class=\"line\">  insecure: true     #是否使用安全协议http或https</span><br><span class=\"line\">  signature_version2: false</span><br><span class=\"line\">  encrypt_sse: false</span><br><span class=\"line\">  put_user_metadata: &#123;&#125;</span><br><span class=\"line\">  http_config:</span><br><span class=\"line\">    idle_conn_timeout: 90s</span><br><span class=\"line\">    response_header_timeout: 2m</span><br><span class=\"line\">    insecure_skip_verify: false</span><br><span class=\"line\">  trace:</span><br><span class=\"line\">    enable: false</span><br><span class=\"line\">  part_size: 134217728</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>prometheus 配置文件,。必须定义extends label，用于区分相同metrics的数据源</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">global:</span><br><span class=\"line\">  scrape_interval:     60s</span><br><span class=\"line\">  evaluation_interval: 60s</span><br><span class=\"line\">  external_labels:</span><br><span class=\"line\">    monitor: &#39;base&#39;</span><br><span class=\"line\"></span><br><span class=\"line\">#常规配置...</span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"应用启动\"><a href=\"#应用启动\" class=\"headerlink\" title=\"应用启动\"></a>应用启动</h2><h3 id=\"thanos\"><a href=\"#thanos\" class=\"headerlink\" title=\"thanos\"></a>thanos</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim docker-compose.yml</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">version: &#39;2&#39;</span><br><span class=\"line\">services:</span><br><span class=\"line\"></span><br><span class=\"line\">##############################################################</span><br><span class=\"line\">  # to search on old metrics</span><br><span class=\"line\">  storer:</span><br><span class=\"line\">    container_name: storer</span><br><span class=\"line\">    image: quay.io&#x2F;thanos&#x2F;thanos:v0.13.0-rc.2</span><br><span class=\"line\">    volumes:</span><br><span class=\"line\">    - &#x2F;opt&#x2F;prome&#x2F;thanos&#x2F;bucket_config.yaml:&#x2F;bucket_config.yaml</span><br><span class=\"line\">    command:</span><br><span class=\"line\">    - store</span><br><span class=\"line\">    - --data-dir&#x3D;&#x2F;var&#x2F;thanos&#x2F;store</span><br><span class=\"line\">    - --objstore.config-file&#x3D;bucket_config.yaml</span><br><span class=\"line\">    - --http-address&#x3D;0.0.0.0:19191</span><br><span class=\"line\">    - --grpc-address&#x3D;0.0.0.0:19090</span><br><span class=\"line\">    depends_on:</span><br><span class=\"line\">      - minio  </span><br><span class=\"line\">    networks:</span><br><span class=\"line\">      - prom</span><br><span class=\"line\"></span><br><span class=\"line\">  # downsample metrics on the bucket</span><br><span class=\"line\">  compactor:</span><br><span class=\"line\">    container_name: compactor</span><br><span class=\"line\">    image: quay.io&#x2F;thanos&#x2F;thanos:v0.13.0-rc.2</span><br><span class=\"line\">    volumes:</span><br><span class=\"line\">    - &#x2F;opt&#x2F;prome&#x2F;thanos&#x2F;bucket_config.yaml:&#x2F;bucket_config.yaml</span><br><span class=\"line\">    command:</span><br><span class=\"line\">    - compact</span><br><span class=\"line\">    - --data-dir&#x3D;&#x2F;var&#x2F;thanos&#x2F;compact</span><br><span class=\"line\">    - --objstore.config-file&#x3D;bucket_config.yaml</span><br><span class=\"line\">    - --http-address&#x3D;0.0.0.0:19191</span><br><span class=\"line\">    - --wait</span><br><span class=\"line\">    depends_on:</span><br><span class=\"line\">      - minio </span><br><span class=\"line\">    networks:</span><br><span class=\"line\">      - prom</span><br><span class=\"line\"></span><br><span class=\"line\">  # querier component which can be scaled</span><br><span class=\"line\">  querier:</span><br><span class=\"line\">    container_name: querier</span><br><span class=\"line\">    image: quay.io&#x2F;thanos&#x2F;thanos:v0.13.0-rc.2</span><br><span class=\"line\">#    labels:</span><br><span class=\"line\">#      - &quot;traefik.enable&#x3D;true&quot;</span><br><span class=\"line\">#      - &quot;traefik.port&#x3D;19192&quot;</span><br><span class=\"line\">#      - &quot;traefik.frontend.rule&#x3D;PathPrefix:&#x2F;&quot;</span><br><span class=\"line\">    ports: </span><br><span class=\"line\">      - &quot;19192:19192&quot;</span><br><span class=\"line\">    command:</span><br><span class=\"line\">      - query</span><br><span class=\"line\">      - --http-address&#x3D;0.0.0.0:19192</span><br><span class=\"line\">      - --store&#x3D;10.200.76.70:19292</span><br><span class=\"line\">      - --store&#x3D;storer:19090</span><br><span class=\"line\">      - --query.replica-label&#x3D;replica</span><br><span class=\"line\">    networks:</span><br><span class=\"line\">      - prom</span><br><span class=\"line\"></span><br><span class=\"line\">  minio:</span><br><span class=\"line\">    image: minio&#x2F;minio:latest</span><br><span class=\"line\">    container_name: minio</span><br><span class=\"line\">    ports:</span><br><span class=\"line\">      - 9000:9000</span><br><span class=\"line\">      - 9001:9001</span><br><span class=\"line\">    volumes: </span><br><span class=\"line\">      - &quot;&#x2F;opt&#x2F;prome&#x2F;minio&#x2F;data:&#x2F;data&quot;</span><br><span class=\"line\">    environment:</span><br><span class=\"line\">      MINIO_ROOT_USER: &quot;root&quot;</span><br><span class=\"line\">      MINIO_ROOT_PASSWORD: &quot;TTP7Jwho&quot; #输入8位以上的密码</span><br><span class=\"line\">    command: &quot;server &#x2F;data --console-address :9000 --address :9001&quot;</span><br><span class=\"line\">    restart: always</span><br><span class=\"line\">    logging:</span><br><span class=\"line\">      driver: &quot;json-file&quot;</span><br><span class=\"line\">      options:</span><br><span class=\"line\">        max-size: &quot;5m&quot;</span><br><span class=\"line\">        max-file: &quot;3&quot;</span><br><span class=\"line\">    networks:</span><br><span class=\"line\">      - prom</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># 按需启用</span><br><span class=\"line\">#  node-exporter:</span><br><span class=\"line\">#    image: prom&#x2F;node-exporter:latest</span><br><span class=\"line\">#    container_name: node-exporter</span><br><span class=\"line\">#    ports:</span><br><span class=\"line\">#      - &#39;9100:9100&#39;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">networks:</span><br><span class=\"line\">  prom:</span><br><span class=\"line\">    driver: bridge</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"prometheus\"><a href=\"#prometheus\" class=\"headerlink\" title=\"prometheus\"></a>prometheus</h2><p>web.enable-lifecycle 一定要开，用于热加载时 reload 你的配置，retention 保留 2 小时，Prometheus 默认 2 小时会生成一个 block，Thanos 会把这个 block 上传到对象存储。</p>\n<p>prometheus抓取到的监控数据在落盘之前都是存储在内存中的，所以适当的减小数据落盘时间可以减小内存的压力<br>storage.tsdb.max-block-duration: 设置数据块最小时间跨度，默认 2h 的数据量。监控数据是按块（block）存储，每一个块中包含该时间窗口内的所有样本数据（data chunks)<br>storage.tsdb.min-block-duration    设置数据块最大时间跨度，默认为最大保留时间的 10%</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir -p &#x2F;opt&#x2F;prom&#x2F;&#123;prometheus,thanos&#125;</span><br></pre></td></tr></table></figure>\n\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim docker-compose.yml</span><br><span class=\"line\"></span><br><span class=\"line\">version: &#39;3.7&#39;</span><br><span class=\"line\"></span><br><span class=\"line\">services:</span><br><span class=\"line\"></span><br><span class=\"line\"># 按需启用</span><br><span class=\"line\">#  node-exporter:</span><br><span class=\"line\">#    image: prom&#x2F;node-exporter:latest</span><br><span class=\"line\">#    ports:</span><br><span class=\"line\">#      - &quot;9100:9100&quot;</span><br><span class=\"line\">#    networks:</span><br><span class=\"line\">#      - prom</span><br><span class=\"line\"></span><br><span class=\"line\">#  dingtalk:</span><br><span class=\"line\">#    image: timonwong&#x2F;prometheus-webhook-dingtalk:latest</span><br><span class=\"line\">#    volumes:</span><br><span class=\"line\">#      - type: bind</span><br><span class=\"line\">#        source: .&#x2F;alertmanager&#x2F;config.yml</span><br><span class=\"line\">#        target: &#x2F;etc&#x2F;prometheus-webhook-dingtalk&#x2F;config.yml</span><br><span class=\"line\">#        read_only: true</span><br><span class=\"line\">#    ports:</span><br><span class=\"line\">#      - &quot;8060:8060&quot;</span><br><span class=\"line\">#    networks:</span><br><span class=\"line\">#      - prom</span><br><span class=\"line\"></span><br><span class=\"line\">  alertmanager:</span><br><span class=\"line\">#    depends_on:</span><br><span class=\"line\">#      - dingtalk</span><br><span class=\"line\">    image: prom&#x2F;alertmanager:latest</span><br><span class=\"line\">    environment:</span><br><span class=\"line\">      - TZ&#x3D;Asia&#x2F;Shanghai</span><br><span class=\"line\">    volumes:</span><br><span class=\"line\">      - type: bind</span><br><span class=\"line\">        source: .&#x2F;alertmanager&#x2F;alertmanager.yml</span><br><span class=\"line\">        target: &#x2F;etc&#x2F;alertmanager&#x2F;alertmanager.yml</span><br><span class=\"line\">        read_only: true</span><br><span class=\"line\">    command: </span><br><span class=\"line\">      - --config.file&#x3D;&#x2F;etc&#x2F;alertmanager&#x2F;alertmanager.yml </span><br><span class=\"line\">      - --web.external-url&#x3D;http:&#x2F;&#x2F;10.200.76.70:9093</span><br><span class=\"line\"></span><br><span class=\"line\">    ports:</span><br><span class=\"line\">      - &quot;9093:9093&quot;</span><br><span class=\"line\">      - &quot;9094:9094&quot;</span><br><span class=\"line\">    networks:</span><br><span class=\"line\">      - prom</span><br><span class=\"line\"></span><br><span class=\"line\">  prometheus:</span><br><span class=\"line\">    depends_on:</span><br><span class=\"line\">      - alertmanager</span><br><span class=\"line\">    image: prom&#x2F;prometheus:latest</span><br><span class=\"line\">    environment:</span><br><span class=\"line\">      - TZ&#x3D;Asia&#x2F;Shanghai</span><br><span class=\"line\">    volumes:</span><br><span class=\"line\">      - type: bind</span><br><span class=\"line\">        source: .&#x2F;prometheus&#x2F;prometheus.yml</span><br><span class=\"line\">        target: &#x2F;etc&#x2F;prometheus&#x2F;prometheus.yml</span><br><span class=\"line\">        read_only: true</span><br><span class=\"line\"> #     - type: bind</span><br><span class=\"line\"> #       source: .&#x2F;prometheus&#x2F;rules&#x2F;alert-rules.yml</span><br><span class=\"line\"> #       target: &#x2F;etc&#x2F;prometheus&#x2F;alert-rules.yml</span><br><span class=\"line\"> #       read_only: true</span><br><span class=\"line\">      - type: volume</span><br><span class=\"line\">        source: prometheus</span><br><span class=\"line\">        target: &#x2F;prometheus</span><br><span class=\"line\">      - &quot;&#x2F;opt&#x2F;prom&#x2F;prometheus&#x2F;rules:&#x2F;etc&#x2F;prometheus&#x2F;rules&quot;</span><br><span class=\"line\">      - &quot;&#x2F;opt&#x2F;prom&#x2F;prometheus&#x2F;targets:&#x2F;etc&#x2F;prometheus&#x2F;targets&quot;</span><br><span class=\"line\">    command: </span><br><span class=\"line\">      - --config.file&#x3D;&#x2F;etc&#x2F;prometheus&#x2F;prometheus.yml </span><br><span class=\"line\">      - --storage.tsdb.path&#x3D;&#x2F;prometheus </span><br><span class=\"line\">      - --storage.tsdb.retention&#x3D;60d </span><br><span class=\"line\">      - --web.enable-lifecycle</span><br><span class=\"line\">      - --web.enable-admin-api </span><br><span class=\"line\">      - --web.external-url&#x3D;http:&#x2F;&#x2F;10.200.76.70:9090</span><br><span class=\"line\">#      - --storage.tsdb.min-block-duration &#x3D; --storage.tsdb.max-block-duration</span><br><span class=\"line\">      - --storage.tsdb.min-block-duration&#x3D;6d</span><br><span class=\"line\">      - --storage.tsdb.max-block-duration&#x3D;6d</span><br><span class=\"line\">    ports:</span><br><span class=\"line\">      - &quot;9090:9090&quot;</span><br><span class=\"line\">    networks:</span><br><span class=\"line\">      - prom</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">  grafana:</span><br><span class=\"line\">    depends_on:</span><br><span class=\"line\">      - prometheus</span><br><span class=\"line\">    image: grafana&#x2F;grafana:latest</span><br><span class=\"line\">    volumes:</span><br><span class=\"line\">      - type: volume</span><br><span class=\"line\">        source: grafana</span><br><span class=\"line\">        target: &#x2F;var&#x2F;lib&#x2F;grafana</span><br><span class=\"line\">    ports:</span><br><span class=\"line\">      - &quot;3000:3000&quot;</span><br><span class=\"line\">    networks:</span><br><span class=\"line\">      - prom</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">  black-exporter:</span><br><span class=\"line\">    environment:</span><br><span class=\"line\">      - TZ&#x3D;Asia&#x2F;Shanghai</span><br><span class=\"line\">    image: prom&#x2F;blackbox-exporter:latest</span><br><span class=\"line\">    volumes:</span><br><span class=\"line\">      - &#x2F;opt&#x2F;prom&#x2F;black-exporter&#x2F;blackbox.yml:&#x2F;config&#x2F;blackbox.yml</span><br><span class=\"line\">    command:</span><br><span class=\"line\">      - &#39;--config.file&#x3D;&#x2F;config&#x2F;blackbox.yml&#39;</span><br><span class=\"line\">    ports:</span><br><span class=\"line\">      - &#39;9115:9115&#39;</span><br><span class=\"line\">    networks:</span><br><span class=\"line\">      - prom</span><br><span class=\"line\"></span><br><span class=\"line\">  sidecar:</span><br><span class=\"line\">    container_name: sidecar</span><br><span class=\"line\">    image: quay.io&#x2F;thanos&#x2F;thanos:v0.13.0-rc.2</span><br><span class=\"line\">    logging:</span><br><span class=\"line\">      driver: &quot;json-file&quot;</span><br><span class=\"line\">      options:</span><br><span class=\"line\">        max-size: &quot;5m&quot;</span><br><span class=\"line\">        max-file: &quot;3&quot;</span><br><span class=\"line\">    volumes:</span><br><span class=\"line\">      - type: volume</span><br><span class=\"line\">        source: prometheus</span><br><span class=\"line\">        target: &#x2F;var&#x2F;prometheus</span><br><span class=\"line\">      - &#x2F;opt&#x2F;prom&#x2F;thanos&#x2F;bucket_config.yaml:&#x2F;bucket_config.yaml</span><br><span class=\"line\">    command:</span><br><span class=\"line\">      - sidecar</span><br><span class=\"line\">      - --tsdb.path&#x3D;&#x2F;var&#x2F;prometheus</span><br><span class=\"line\">      - --prometheus.url&#x3D;http:&#x2F;&#x2F;10.200.76.70:9090</span><br><span class=\"line\">      - --objstore.config-file&#x3D;&#x2F;bucket_config.yaml</span><br><span class=\"line\">      - --http-address&#x3D;0.0.0.0:19191</span><br><span class=\"line\">      - --grpc-address&#x3D;0.0.0.0:19292</span><br><span class=\"line\">    ports:</span><br><span class=\"line\">      - &quot;19191:19191&quot;</span><br><span class=\"line\">      - &quot;19292:19292&quot;</span><br><span class=\"line\">    depends_on:</span><br><span class=\"line\">      - prometheus</span><br><span class=\"line\">    networks:</span><br><span class=\"line\">      - prom</span><br><span class=\"line\"></span><br><span class=\"line\">volumes:</span><br><span class=\"line\">  prometheus:</span><br><span class=\"line\">    driver: local</span><br><span class=\"line\">    driver_opts:</span><br><span class=\"line\">      type: none</span><br><span class=\"line\">      o: bind</span><br><span class=\"line\">      device: &#x2F;opt&#x2F;prom&#x2F;prometheus&#x2F;data</span><br><span class=\"line\">  grafana:</span><br><span class=\"line\">    driver: local</span><br><span class=\"line\">    driver_opts:</span><br><span class=\"line\">      type: none</span><br><span class=\"line\">      o: bind</span><br><span class=\"line\">      device: &#x2F;opt&#x2F;prom&#x2F;grafana</span><br><span class=\"line\">      </span><br><span class=\"line\">networks:</span><br><span class=\"line\">  prom:</span><br><span class=\"line\">    driver: bridge</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"<p>摘要: desc</p>","more":"<h2 id=\"架构\"><a href=\"#架构\" class=\"headerlink\" title=\"架构\"></a>架构</h2><p>10.200.92.117<br>    thanos / querier<br>    thanos / storer<br>    thanos / compactor<br>    minio </p>\n<p>10.200.76.70<br>    prometheus<br>    thanos / sidecar</p>\n<h2 id=\"thanos-组件\"><a href=\"#thanos-组件\" class=\"headerlink\" title=\"thanos 组件\"></a>thanos 组件</h2><h2 id=\"目录创建\"><a href=\"#目录创建\" class=\"headerlink\" title=\"目录创建\"></a>目录创建</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir -p &#x2F;opt&#x2F;prome </span><br><span class=\"line\">cd &#x2F;opt&#x2F;prome</span><br><span class=\"line\">mkdir -p minio&#x2F;data</span><br><span class=\"line\">mkdir thanos</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"配置文件\"><a href=\"#配置文件\" class=\"headerlink\" title=\"配置文件\"></a>配置文件</h2><p>创建thanos 调用minio 的配置文件</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim thanos&#x2F;bucket_config.yaml</span><br><span class=\"line\"></span><br><span class=\"line\">type: S3</span><br><span class=\"line\">config:</span><br><span class=\"line\">  bucket: &quot;thanos&quot;</span><br><span class=\"line\">  endpoint: &#39;10.200.92.117:9001&#39;  # minio 接口地址</span><br><span class=\"line\">  access_key: &quot;root&quot;</span><br><span class=\"line\">  secret_key: &quot;TTP7Jwho&quot;   #设置s3密码，保证8位以上的长度</span><br><span class=\"line\">  insecure: true     #是否使用安全协议http或https</span><br><span class=\"line\">  signature_version2: false</span><br><span class=\"line\">  encrypt_sse: false</span><br><span class=\"line\">  put_user_metadata: &#123;&#125;</span><br><span class=\"line\">  http_config:</span><br><span class=\"line\">    idle_conn_timeout: 90s</span><br><span class=\"line\">    response_header_timeout: 2m</span><br><span class=\"line\">    insecure_skip_verify: false</span><br><span class=\"line\">  trace:</span><br><span class=\"line\">    enable: false</span><br><span class=\"line\">  part_size: 134217728</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>prometheus 配置文件,。必须定义extends label，用于区分相同metrics的数据源</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">global:</span><br><span class=\"line\">  scrape_interval:     60s</span><br><span class=\"line\">  evaluation_interval: 60s</span><br><span class=\"line\">  external_labels:</span><br><span class=\"line\">    monitor: &#39;base&#39;</span><br><span class=\"line\"></span><br><span class=\"line\">#常规配置...</span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"应用启动\"><a href=\"#应用启动\" class=\"headerlink\" title=\"应用启动\"></a>应用启动</h2><h3 id=\"thanos\"><a href=\"#thanos\" class=\"headerlink\" title=\"thanos\"></a>thanos</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim docker-compose.yml</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">version: &#39;2&#39;</span><br><span class=\"line\">services:</span><br><span class=\"line\"></span><br><span class=\"line\">##############################################################</span><br><span class=\"line\">  # to search on old metrics</span><br><span class=\"line\">  storer:</span><br><span class=\"line\">    container_name: storer</span><br><span class=\"line\">    image: quay.io&#x2F;thanos&#x2F;thanos:v0.13.0-rc.2</span><br><span class=\"line\">    volumes:</span><br><span class=\"line\">    - &#x2F;opt&#x2F;prome&#x2F;thanos&#x2F;bucket_config.yaml:&#x2F;bucket_config.yaml</span><br><span class=\"line\">    command:</span><br><span class=\"line\">    - store</span><br><span class=\"line\">    - --data-dir&#x3D;&#x2F;var&#x2F;thanos&#x2F;store</span><br><span class=\"line\">    - --objstore.config-file&#x3D;bucket_config.yaml</span><br><span class=\"line\">    - --http-address&#x3D;0.0.0.0:19191</span><br><span class=\"line\">    - --grpc-address&#x3D;0.0.0.0:19090</span><br><span class=\"line\">    depends_on:</span><br><span class=\"line\">      - minio  </span><br><span class=\"line\">    networks:</span><br><span class=\"line\">      - prom</span><br><span class=\"line\"></span><br><span class=\"line\">  # downsample metrics on the bucket</span><br><span class=\"line\">  compactor:</span><br><span class=\"line\">    container_name: compactor</span><br><span class=\"line\">    image: quay.io&#x2F;thanos&#x2F;thanos:v0.13.0-rc.2</span><br><span class=\"line\">    volumes:</span><br><span class=\"line\">    - &#x2F;opt&#x2F;prome&#x2F;thanos&#x2F;bucket_config.yaml:&#x2F;bucket_config.yaml</span><br><span class=\"line\">    command:</span><br><span class=\"line\">    - compact</span><br><span class=\"line\">    - --data-dir&#x3D;&#x2F;var&#x2F;thanos&#x2F;compact</span><br><span class=\"line\">    - --objstore.config-file&#x3D;bucket_config.yaml</span><br><span class=\"line\">    - --http-address&#x3D;0.0.0.0:19191</span><br><span class=\"line\">    - --wait</span><br><span class=\"line\">    depends_on:</span><br><span class=\"line\">      - minio </span><br><span class=\"line\">    networks:</span><br><span class=\"line\">      - prom</span><br><span class=\"line\"></span><br><span class=\"line\">  # querier component which can be scaled</span><br><span class=\"line\">  querier:</span><br><span class=\"line\">    container_name: querier</span><br><span class=\"line\">    image: quay.io&#x2F;thanos&#x2F;thanos:v0.13.0-rc.2</span><br><span class=\"line\">#    labels:</span><br><span class=\"line\">#      - &quot;traefik.enable&#x3D;true&quot;</span><br><span class=\"line\">#      - &quot;traefik.port&#x3D;19192&quot;</span><br><span class=\"line\">#      - &quot;traefik.frontend.rule&#x3D;PathPrefix:&#x2F;&quot;</span><br><span class=\"line\">    ports: </span><br><span class=\"line\">      - &quot;19192:19192&quot;</span><br><span class=\"line\">    command:</span><br><span class=\"line\">      - query</span><br><span class=\"line\">      - --http-address&#x3D;0.0.0.0:19192</span><br><span class=\"line\">      - --store&#x3D;10.200.76.70:19292</span><br><span class=\"line\">      - --store&#x3D;storer:19090</span><br><span class=\"line\">      - --query.replica-label&#x3D;replica</span><br><span class=\"line\">    networks:</span><br><span class=\"line\">      - prom</span><br><span class=\"line\"></span><br><span class=\"line\">  minio:</span><br><span class=\"line\">    image: minio&#x2F;minio:latest</span><br><span class=\"line\">    container_name: minio</span><br><span class=\"line\">    ports:</span><br><span class=\"line\">      - 9000:9000</span><br><span class=\"line\">      - 9001:9001</span><br><span class=\"line\">    volumes: </span><br><span class=\"line\">      - &quot;&#x2F;opt&#x2F;prome&#x2F;minio&#x2F;data:&#x2F;data&quot;</span><br><span class=\"line\">    environment:</span><br><span class=\"line\">      MINIO_ROOT_USER: &quot;root&quot;</span><br><span class=\"line\">      MINIO_ROOT_PASSWORD: &quot;TTP7Jwho&quot; #输入8位以上的密码</span><br><span class=\"line\">    command: &quot;server &#x2F;data --console-address :9000 --address :9001&quot;</span><br><span class=\"line\">    restart: always</span><br><span class=\"line\">    logging:</span><br><span class=\"line\">      driver: &quot;json-file&quot;</span><br><span class=\"line\">      options:</span><br><span class=\"line\">        max-size: &quot;5m&quot;</span><br><span class=\"line\">        max-file: &quot;3&quot;</span><br><span class=\"line\">    networks:</span><br><span class=\"line\">      - prom</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># 按需启用</span><br><span class=\"line\">#  node-exporter:</span><br><span class=\"line\">#    image: prom&#x2F;node-exporter:latest</span><br><span class=\"line\">#    container_name: node-exporter</span><br><span class=\"line\">#    ports:</span><br><span class=\"line\">#      - &#39;9100:9100&#39;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">networks:</span><br><span class=\"line\">  prom:</span><br><span class=\"line\">    driver: bridge</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"prometheus\"><a href=\"#prometheus\" class=\"headerlink\" title=\"prometheus\"></a>prometheus</h2><p>web.enable-lifecycle 一定要开，用于热加载时 reload 你的配置，retention 保留 2 小时，Prometheus 默认 2 小时会生成一个 block，Thanos 会把这个 block 上传到对象存储。</p>\n<p>prometheus抓取到的监控数据在落盘之前都是存储在内存中的，所以适当的减小数据落盘时间可以减小内存的压力<br>storage.tsdb.max-block-duration: 设置数据块最小时间跨度，默认 2h 的数据量。监控数据是按块（block）存储，每一个块中包含该时间窗口内的所有样本数据（data chunks)<br>storage.tsdb.min-block-duration    设置数据块最大时间跨度，默认为最大保留时间的 10%</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir -p &#x2F;opt&#x2F;prom&#x2F;&#123;prometheus,thanos&#125;</span><br></pre></td></tr></table></figure>\n\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim docker-compose.yml</span><br><span class=\"line\"></span><br><span class=\"line\">version: &#39;3.7&#39;</span><br><span class=\"line\"></span><br><span class=\"line\">services:</span><br><span class=\"line\"></span><br><span class=\"line\"># 按需启用</span><br><span class=\"line\">#  node-exporter:</span><br><span class=\"line\">#    image: prom&#x2F;node-exporter:latest</span><br><span class=\"line\">#    ports:</span><br><span class=\"line\">#      - &quot;9100:9100&quot;</span><br><span class=\"line\">#    networks:</span><br><span class=\"line\">#      - prom</span><br><span class=\"line\"></span><br><span class=\"line\">#  dingtalk:</span><br><span class=\"line\">#    image: timonwong&#x2F;prometheus-webhook-dingtalk:latest</span><br><span class=\"line\">#    volumes:</span><br><span class=\"line\">#      - type: bind</span><br><span class=\"line\">#        source: .&#x2F;alertmanager&#x2F;config.yml</span><br><span class=\"line\">#        target: &#x2F;etc&#x2F;prometheus-webhook-dingtalk&#x2F;config.yml</span><br><span class=\"line\">#        read_only: true</span><br><span class=\"line\">#    ports:</span><br><span class=\"line\">#      - &quot;8060:8060&quot;</span><br><span class=\"line\">#    networks:</span><br><span class=\"line\">#      - prom</span><br><span class=\"line\"></span><br><span class=\"line\">  alertmanager:</span><br><span class=\"line\">#    depends_on:</span><br><span class=\"line\">#      - dingtalk</span><br><span class=\"line\">    image: prom&#x2F;alertmanager:latest</span><br><span class=\"line\">    environment:</span><br><span class=\"line\">      - TZ&#x3D;Asia&#x2F;Shanghai</span><br><span class=\"line\">    volumes:</span><br><span class=\"line\">      - type: bind</span><br><span class=\"line\">        source: .&#x2F;alertmanager&#x2F;alertmanager.yml</span><br><span class=\"line\">        target: &#x2F;etc&#x2F;alertmanager&#x2F;alertmanager.yml</span><br><span class=\"line\">        read_only: true</span><br><span class=\"line\">    command: </span><br><span class=\"line\">      - --config.file&#x3D;&#x2F;etc&#x2F;alertmanager&#x2F;alertmanager.yml </span><br><span class=\"line\">      - --web.external-url&#x3D;http:&#x2F;&#x2F;10.200.76.70:9093</span><br><span class=\"line\"></span><br><span class=\"line\">    ports:</span><br><span class=\"line\">      - &quot;9093:9093&quot;</span><br><span class=\"line\">      - &quot;9094:9094&quot;</span><br><span class=\"line\">    networks:</span><br><span class=\"line\">      - prom</span><br><span class=\"line\"></span><br><span class=\"line\">  prometheus:</span><br><span class=\"line\">    depends_on:</span><br><span class=\"line\">      - alertmanager</span><br><span class=\"line\">    image: prom&#x2F;prometheus:latest</span><br><span class=\"line\">    environment:</span><br><span class=\"line\">      - TZ&#x3D;Asia&#x2F;Shanghai</span><br><span class=\"line\">    volumes:</span><br><span class=\"line\">      - type: bind</span><br><span class=\"line\">        source: .&#x2F;prometheus&#x2F;prometheus.yml</span><br><span class=\"line\">        target: &#x2F;etc&#x2F;prometheus&#x2F;prometheus.yml</span><br><span class=\"line\">        read_only: true</span><br><span class=\"line\"> #     - type: bind</span><br><span class=\"line\"> #       source: .&#x2F;prometheus&#x2F;rules&#x2F;alert-rules.yml</span><br><span class=\"line\"> #       target: &#x2F;etc&#x2F;prometheus&#x2F;alert-rules.yml</span><br><span class=\"line\"> #       read_only: true</span><br><span class=\"line\">      - type: volume</span><br><span class=\"line\">        source: prometheus</span><br><span class=\"line\">        target: &#x2F;prometheus</span><br><span class=\"line\">      - &quot;&#x2F;opt&#x2F;prom&#x2F;prometheus&#x2F;rules:&#x2F;etc&#x2F;prometheus&#x2F;rules&quot;</span><br><span class=\"line\">      - &quot;&#x2F;opt&#x2F;prom&#x2F;prometheus&#x2F;targets:&#x2F;etc&#x2F;prometheus&#x2F;targets&quot;</span><br><span class=\"line\">    command: </span><br><span class=\"line\">      - --config.file&#x3D;&#x2F;etc&#x2F;prometheus&#x2F;prometheus.yml </span><br><span class=\"line\">      - --storage.tsdb.path&#x3D;&#x2F;prometheus </span><br><span class=\"line\">      - --storage.tsdb.retention&#x3D;60d </span><br><span class=\"line\">      - --web.enable-lifecycle</span><br><span class=\"line\">      - --web.enable-admin-api </span><br><span class=\"line\">      - --web.external-url&#x3D;http:&#x2F;&#x2F;10.200.76.70:9090</span><br><span class=\"line\">#      - --storage.tsdb.min-block-duration &#x3D; --storage.tsdb.max-block-duration</span><br><span class=\"line\">      - --storage.tsdb.min-block-duration&#x3D;6d</span><br><span class=\"line\">      - --storage.tsdb.max-block-duration&#x3D;6d</span><br><span class=\"line\">    ports:</span><br><span class=\"line\">      - &quot;9090:9090&quot;</span><br><span class=\"line\">    networks:</span><br><span class=\"line\">      - prom</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">  grafana:</span><br><span class=\"line\">    depends_on:</span><br><span class=\"line\">      - prometheus</span><br><span class=\"line\">    image: grafana&#x2F;grafana:latest</span><br><span class=\"line\">    volumes:</span><br><span class=\"line\">      - type: volume</span><br><span class=\"line\">        source: grafana</span><br><span class=\"line\">        target: &#x2F;var&#x2F;lib&#x2F;grafana</span><br><span class=\"line\">    ports:</span><br><span class=\"line\">      - &quot;3000:3000&quot;</span><br><span class=\"line\">    networks:</span><br><span class=\"line\">      - prom</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">  black-exporter:</span><br><span class=\"line\">    environment:</span><br><span class=\"line\">      - TZ&#x3D;Asia&#x2F;Shanghai</span><br><span class=\"line\">    image: prom&#x2F;blackbox-exporter:latest</span><br><span class=\"line\">    volumes:</span><br><span class=\"line\">      - &#x2F;opt&#x2F;prom&#x2F;black-exporter&#x2F;blackbox.yml:&#x2F;config&#x2F;blackbox.yml</span><br><span class=\"line\">    command:</span><br><span class=\"line\">      - &#39;--config.file&#x3D;&#x2F;config&#x2F;blackbox.yml&#39;</span><br><span class=\"line\">    ports:</span><br><span class=\"line\">      - &#39;9115:9115&#39;</span><br><span class=\"line\">    networks:</span><br><span class=\"line\">      - prom</span><br><span class=\"line\"></span><br><span class=\"line\">  sidecar:</span><br><span class=\"line\">    container_name: sidecar</span><br><span class=\"line\">    image: quay.io&#x2F;thanos&#x2F;thanos:v0.13.0-rc.2</span><br><span class=\"line\">    logging:</span><br><span class=\"line\">      driver: &quot;json-file&quot;</span><br><span class=\"line\">      options:</span><br><span class=\"line\">        max-size: &quot;5m&quot;</span><br><span class=\"line\">        max-file: &quot;3&quot;</span><br><span class=\"line\">    volumes:</span><br><span class=\"line\">      - type: volume</span><br><span class=\"line\">        source: prometheus</span><br><span class=\"line\">        target: &#x2F;var&#x2F;prometheus</span><br><span class=\"line\">      - &#x2F;opt&#x2F;prom&#x2F;thanos&#x2F;bucket_config.yaml:&#x2F;bucket_config.yaml</span><br><span class=\"line\">    command:</span><br><span class=\"line\">      - sidecar</span><br><span class=\"line\">      - --tsdb.path&#x3D;&#x2F;var&#x2F;prometheus</span><br><span class=\"line\">      - --prometheus.url&#x3D;http:&#x2F;&#x2F;10.200.76.70:9090</span><br><span class=\"line\">      - --objstore.config-file&#x3D;&#x2F;bucket_config.yaml</span><br><span class=\"line\">      - --http-address&#x3D;0.0.0.0:19191</span><br><span class=\"line\">      - --grpc-address&#x3D;0.0.0.0:19292</span><br><span class=\"line\">    ports:</span><br><span class=\"line\">      - &quot;19191:19191&quot;</span><br><span class=\"line\">      - &quot;19292:19292&quot;</span><br><span class=\"line\">    depends_on:</span><br><span class=\"line\">      - prometheus</span><br><span class=\"line\">    networks:</span><br><span class=\"line\">      - prom</span><br><span class=\"line\"></span><br><span class=\"line\">volumes:</span><br><span class=\"line\">  prometheus:</span><br><span class=\"line\">    driver: local</span><br><span class=\"line\">    driver_opts:</span><br><span class=\"line\">      type: none</span><br><span class=\"line\">      o: bind</span><br><span class=\"line\">      device: &#x2F;opt&#x2F;prom&#x2F;prometheus&#x2F;data</span><br><span class=\"line\">  grafana:</span><br><span class=\"line\">    driver: local</span><br><span class=\"line\">    driver_opts:</span><br><span class=\"line\">      type: none</span><br><span class=\"line\">      o: bind</span><br><span class=\"line\">      device: &#x2F;opt&#x2F;prom&#x2F;grafana</span><br><span class=\"line\">      </span><br><span class=\"line\">networks:</span><br><span class=\"line\">  prom:</span><br><span class=\"line\">    driver: bridge</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>"},{"title":"node_exporter 安装脚本","date":"2020-09-21T10:47:00.000Z","_content":"  \n  \n摘要: 安装node_exporter脚本， 用于监控数据采集\n<!-- more -->\n\n```bash\n#!/bin/bash\n#\n#   rhel7.4 安装node_exporter 用于监控数据采集\n#   Usage:\n#         sh addNode.sh\n#Logs: /var/log/messages\n#History:  2019/8/2 v3\n#Create_Time: 2019-08-02\n# USE: small_wei\n#\n#\n#WEB_PATH='http://12.0.94.46:8086'       #这里是我测试环境下的文件下载链接路径\n# https://github.com/prometheus/node_exporter   官方下载地址\nWEB_PATH='https://package-dev-qafc.aaa.com/res/node_exporter'\nInstall_PATH=/opt/node_exporter\nServer_file=/usr/lib/systemd/system\nprot=6301\nRED_COLOR='\\E[1;31m'  #红\nGREEN_COLOR='\\E[1;32m' #绿\nRES='\\E[0m'\nnode_user=prometheus\nnode_group=prometheus\nTime_date=$(date +\"%Y%m%d%H%M%S\")\nif [ ! $(id -u) == 0 ];then\n    echo -e \"${GREEN_COLOR}Please run with the root user!${RES}\"\n    exit 22\nfi\n#防止重复执行\nif [ $(ps -ef | grep $0 |grep -v grep | wc -l) -gt 2 ];then    #理论值为 1,但这里是 2 \n        echo -e \"${RED_COLOR} $0  The script is executing, do not repeat!, Run id is $$${RES}\"\n        exit 22\nfi\n#create group if not exists\negrep \"^${node_group}\" /etc/group 2>/dev/null\nif [ $? -ne 0 ];then\n    groupadd ${node_group}\n    echo -e \"${node_group} group Creating a successful\"\nfi\n#create user if not exists\negrep \"^${node_user}\" /etc/passwd 2>/dev/null\nif [ $? -ne 0 ];then\n    useradd -g ${node_group} ${node_user}\n    echo -e \"${node_user} user Creating a successful\"\nfi\nport=`netstat -tunlp|grep ${prot}`\nif test -z \"${port}\"\nthen\n    [[ ! -d ${Install_PATH} ]] && mkdir -p ${Install_PATH} || echo \"存在\"\n    chown -R ${node_user}:${node_user} ${Install_PATH}\n    cd ${Install_PATH}\n    curl -u ztycroot:dwI6TNCe -O $WEB_PATH\n    chmod +x  ${Install_PATH}/node_exporter\n    if [[ $? == 0 ]];then\n        echo -e \"${GREEN_COLOR}Environment readiness complete${RES}\"\n    fi\n#-----------------\n    if [  -f \"${Server_file}/node_exporter.service\" ];then\n\t    [[ ! -d /opt/back/ ]] && mkdir -p /opt/back/ || echo \"已存在\"\n        cp -f ${Server_file}/node_exporter.service /opt/back/node_exporter.service.bak${Time_date}\n    fi\n    if [ $? == 0 ];then\n        echo -e \"${GREEN_COLOR}node_exporter.service.bak${Time_date}  File The backup successful${RES}\"\n    else\n        echo -e \"${RED_COLOR}node_exporter.service.bak${Time_date} File backup failed${RES}\"\n        exit 22\n    fi\ncat >${Server_file}/node_exporter.service <<-EOF\n[Unit]\nDescription=Prometheus node exporter\nDocumentation=https://prometheus.io/\nAfter=local-fs.target network-online.target network.target\nWants=local-fs.target network-online.target network.target\n[Service]\nUser=${node_user}\nGroup=${node_group}\nType=simple\n#ExecStart=${Install_PATH}/node_exporter --web.listen-address=:9100 --log.level=error\n#ExecStart=${Install_PATH}/node_exporter --web.listen-address=:${prot} --log.level=error\n\nExecStart=${Install_PATH}/node_exporter --web.listen-address=:${prot} --log.level=error \\\\\n          --no-collector.softnet \\\\\n          --no-collector.nfs \\\\\n          --no-collector.hwmon \\\\\n          --no-collector.mdadm\n\nExecReload=/bin/kill -HUP $MAINPID\nTimeoutStopSec=20s\nRestart=always\n\n[Install]\nWantedBy=multi-user.target\nEOF\n    systemctl daemon-reload\n    systemctl restart node_exporter\n    if [ $? == 0 ];then\n        echo -e  \"${GREEN_COLOR}node_exporte  Server start success!${RES}\"\n    else\n        echo -e  \"${RED_COLOR}node_exporte  Server start ERROR!${RES}\"\n        exit 22\n    fi\n#------------------\nelse\n    echo -e \"${GREEN_COLOR}port:${prot} is busy,failed${RES}\"\nfi\nsystemctl enable node_exporter\nsystemctl status node_exporter\n#验证\ncode=`curl -I -m 3 -o /dev/null -s -w %{http_code}  127.0.0.1:${prot}`\nif [ ${code} == 200 ];then\n    echo -e  \"${GREEN_COLOR}register node in consul success${RES}\"\nelse\n    echo -e \"${RED_COLOR}Registration failed or registered, please check! ${RES}\"\n    exit 22\nfi\n```\n\n","source":"_posts/prometheus/node_exporter安装脚本.md","raw":"---\ntitle:  node_exporter 安装脚本\ndate: 2020-09-21 18:47\ncategories:\n- prometheus\ntags:\n- prome\n- node_exporter\n---\n  \n  \n摘要: 安装node_exporter脚本， 用于监控数据采集\n<!-- more -->\n\n```bash\n#!/bin/bash\n#\n#   rhel7.4 安装node_exporter 用于监控数据采集\n#   Usage:\n#         sh addNode.sh\n#Logs: /var/log/messages\n#History:  2019/8/2 v3\n#Create_Time: 2019-08-02\n# USE: small_wei\n#\n#\n#WEB_PATH='http://12.0.94.46:8086'       #这里是我测试环境下的文件下载链接路径\n# https://github.com/prometheus/node_exporter   官方下载地址\nWEB_PATH='https://package-dev-qafc.aaa.com/res/node_exporter'\nInstall_PATH=/opt/node_exporter\nServer_file=/usr/lib/systemd/system\nprot=6301\nRED_COLOR='\\E[1;31m'  #红\nGREEN_COLOR='\\E[1;32m' #绿\nRES='\\E[0m'\nnode_user=prometheus\nnode_group=prometheus\nTime_date=$(date +\"%Y%m%d%H%M%S\")\nif [ ! $(id -u) == 0 ];then\n    echo -e \"${GREEN_COLOR}Please run with the root user!${RES}\"\n    exit 22\nfi\n#防止重复执行\nif [ $(ps -ef | grep $0 |grep -v grep | wc -l) -gt 2 ];then    #理论值为 1,但这里是 2 \n        echo -e \"${RED_COLOR} $0  The script is executing, do not repeat!, Run id is $$${RES}\"\n        exit 22\nfi\n#create group if not exists\negrep \"^${node_group}\" /etc/group 2>/dev/null\nif [ $? -ne 0 ];then\n    groupadd ${node_group}\n    echo -e \"${node_group} group Creating a successful\"\nfi\n#create user if not exists\negrep \"^${node_user}\" /etc/passwd 2>/dev/null\nif [ $? -ne 0 ];then\n    useradd -g ${node_group} ${node_user}\n    echo -e \"${node_user} user Creating a successful\"\nfi\nport=`netstat -tunlp|grep ${prot}`\nif test -z \"${port}\"\nthen\n    [[ ! -d ${Install_PATH} ]] && mkdir -p ${Install_PATH} || echo \"存在\"\n    chown -R ${node_user}:${node_user} ${Install_PATH}\n    cd ${Install_PATH}\n    curl -u ztycroot:dwI6TNCe -O $WEB_PATH\n    chmod +x  ${Install_PATH}/node_exporter\n    if [[ $? == 0 ]];then\n        echo -e \"${GREEN_COLOR}Environment readiness complete${RES}\"\n    fi\n#-----------------\n    if [  -f \"${Server_file}/node_exporter.service\" ];then\n\t    [[ ! -d /opt/back/ ]] && mkdir -p /opt/back/ || echo \"已存在\"\n        cp -f ${Server_file}/node_exporter.service /opt/back/node_exporter.service.bak${Time_date}\n    fi\n    if [ $? == 0 ];then\n        echo -e \"${GREEN_COLOR}node_exporter.service.bak${Time_date}  File The backup successful${RES}\"\n    else\n        echo -e \"${RED_COLOR}node_exporter.service.bak${Time_date} File backup failed${RES}\"\n        exit 22\n    fi\ncat >${Server_file}/node_exporter.service <<-EOF\n[Unit]\nDescription=Prometheus node exporter\nDocumentation=https://prometheus.io/\nAfter=local-fs.target network-online.target network.target\nWants=local-fs.target network-online.target network.target\n[Service]\nUser=${node_user}\nGroup=${node_group}\nType=simple\n#ExecStart=${Install_PATH}/node_exporter --web.listen-address=:9100 --log.level=error\n#ExecStart=${Install_PATH}/node_exporter --web.listen-address=:${prot} --log.level=error\n\nExecStart=${Install_PATH}/node_exporter --web.listen-address=:${prot} --log.level=error \\\\\n          --no-collector.softnet \\\\\n          --no-collector.nfs \\\\\n          --no-collector.hwmon \\\\\n          --no-collector.mdadm\n\nExecReload=/bin/kill -HUP $MAINPID\nTimeoutStopSec=20s\nRestart=always\n\n[Install]\nWantedBy=multi-user.target\nEOF\n    systemctl daemon-reload\n    systemctl restart node_exporter\n    if [ $? == 0 ];then\n        echo -e  \"${GREEN_COLOR}node_exporte  Server start success!${RES}\"\n    else\n        echo -e  \"${RED_COLOR}node_exporte  Server start ERROR!${RES}\"\n        exit 22\n    fi\n#------------------\nelse\n    echo -e \"${GREEN_COLOR}port:${prot} is busy,failed${RES}\"\nfi\nsystemctl enable node_exporter\nsystemctl status node_exporter\n#验证\ncode=`curl -I -m 3 -o /dev/null -s -w %{http_code}  127.0.0.1:${prot}`\nif [ ${code} == 200 ];then\n    echo -e  \"${GREEN_COLOR}register node in consul success${RES}\"\nelse\n    echo -e \"${RED_COLOR}Registration failed or registered, please check! ${RES}\"\n    exit 22\nfi\n```\n\n","slug":"prometheus/node_exporter安装脚本","published":1,"updated":"2021-09-08T09:41:58.460Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cku697a0k006c00uhgubq3laa","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><p>摘要: 安装node_exporter脚本， 用于监控数据采集</p>\n<span id=\"more\"></span>\n\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/bin/bash</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\">#   rhel7.4 安装node_exporter 用于监控数据采集</span></span><br><span class=\"line\"><span class=\"comment\">#   Usage:</span></span><br><span class=\"line\"><span class=\"comment\">#         sh addNode.sh</span></span><br><span class=\"line\"><span class=\"comment\">#Logs: /var/log/messages</span></span><br><span class=\"line\"><span class=\"comment\">#History:  2019/8/2 v3</span></span><br><span class=\"line\"><span class=\"comment\">#Create_Time: 2019-08-02</span></span><br><span class=\"line\"><span class=\"comment\"># USE: small_wei</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\">#WEB_PATH=&#x27;http://12.0.94.46:8086&#x27;       #这里是我测试环境下的文件下载链接路径</span></span><br><span class=\"line\"><span class=\"comment\"># https://github.com/prometheus/node_exporter   官方下载地址</span></span><br><span class=\"line\">WEB_PATH=<span class=\"string\">&#x27;https://package-dev-qafc.aaa.com/res/node_exporter&#x27;</span></span><br><span class=\"line\">Install_PATH=/opt/node_exporter</span><br><span class=\"line\">Server_file=/usr/lib/systemd/system</span><br><span class=\"line\">prot=6301</span><br><span class=\"line\">RED_COLOR=<span class=\"string\">&#x27;\\E[1;31m&#x27;</span>  <span class=\"comment\">#红</span></span><br><span class=\"line\">GREEN_COLOR=<span class=\"string\">&#x27;\\E[1;32m&#x27;</span> <span class=\"comment\">#绿</span></span><br><span class=\"line\">RES=<span class=\"string\">&#x27;\\E[0m&#x27;</span></span><br><span class=\"line\">node_user=prometheus</span><br><span class=\"line\">node_group=prometheus</span><br><span class=\"line\">Time_date=$(date +<span class=\"string\">&quot;%Y%m%d%H%M%S&quot;</span>)</span><br><span class=\"line\"><span class=\"keyword\">if</span> [ ! $(id -u) == 0 ];<span class=\"keyword\">then</span></span><br><span class=\"line\">    <span class=\"built_in\">echo</span> -e <span class=\"string\">&quot;<span class=\"variable\">$&#123;GREEN_COLOR&#125;</span>Please run with the root user!<span class=\"variable\">$&#123;RES&#125;</span>&quot;</span></span><br><span class=\"line\">    <span class=\"built_in\">exit</span> 22</span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"><span class=\"comment\">#防止重复执行</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> [ $(ps -ef | grep <span class=\"variable\">$0</span> |grep -v grep | wc -l) -gt 2 ];<span class=\"keyword\">then</span>    <span class=\"comment\">#理论值为 1,但这里是 2 </span></span><br><span class=\"line\">        <span class=\"built_in\">echo</span> -e <span class=\"string\">&quot;<span class=\"variable\">$&#123;RED_COLOR&#125;</span> <span class=\"variable\">$0</span>  The script is executing, do not repeat!, Run id is $$<span class=\"variable\">$&#123;RES&#125;</span>&quot;</span></span><br><span class=\"line\">        <span class=\"built_in\">exit</span> 22</span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"><span class=\"comment\">#create group if not exists</span></span><br><span class=\"line\">egrep <span class=\"string\">&quot;^<span class=\"variable\">$&#123;node_group&#125;</span>&quot;</span> /etc/group 2&gt;/dev/null</span><br><span class=\"line\"><span class=\"keyword\">if</span> [ $? -ne 0 ];<span class=\"keyword\">then</span></span><br><span class=\"line\">    groupadd <span class=\"variable\">$&#123;node_group&#125;</span></span><br><span class=\"line\">    <span class=\"built_in\">echo</span> -e <span class=\"string\">&quot;<span class=\"variable\">$&#123;node_group&#125;</span> group Creating a successful&quot;</span></span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"><span class=\"comment\">#create user if not exists</span></span><br><span class=\"line\">egrep <span class=\"string\">&quot;^<span class=\"variable\">$&#123;node_user&#125;</span>&quot;</span> /etc/passwd 2&gt;/dev/null</span><br><span class=\"line\"><span class=\"keyword\">if</span> [ $? -ne 0 ];<span class=\"keyword\">then</span></span><br><span class=\"line\">    useradd -g <span class=\"variable\">$&#123;node_group&#125;</span> <span class=\"variable\">$&#123;node_user&#125;</span></span><br><span class=\"line\">    <span class=\"built_in\">echo</span> -e <span class=\"string\">&quot;<span class=\"variable\">$&#123;node_user&#125;</span> user Creating a successful&quot;</span></span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\">port=`netstat -tunlp|grep <span class=\"variable\">$&#123;prot&#125;</span>`</span><br><span class=\"line\"><span class=\"keyword\">if</span> <span class=\"built_in\">test</span> -z <span class=\"string\">&quot;<span class=\"variable\">$&#123;port&#125;</span>&quot;</span></span><br><span class=\"line\"><span class=\"keyword\">then</span></span><br><span class=\"line\">    [[ ! -d <span class=\"variable\">$&#123;Install_PATH&#125;</span> ]] &amp;&amp; mkdir -p <span class=\"variable\">$&#123;Install_PATH&#125;</span> || <span class=\"built_in\">echo</span> <span class=\"string\">&quot;存在&quot;</span></span><br><span class=\"line\">    chown -R <span class=\"variable\">$&#123;node_user&#125;</span>:<span class=\"variable\">$&#123;node_user&#125;</span> <span class=\"variable\">$&#123;Install_PATH&#125;</span></span><br><span class=\"line\">    <span class=\"built_in\">cd</span> <span class=\"variable\">$&#123;Install_PATH&#125;</span></span><br><span class=\"line\">    curl -u ztycroot:dwI6TNCe -O <span class=\"variable\">$WEB_PATH</span></span><br><span class=\"line\">    chmod +x  <span class=\"variable\">$&#123;Install_PATH&#125;</span>/node_exporter</span><br><span class=\"line\">    <span class=\"keyword\">if</span> [[ $? == 0 ]];<span class=\"keyword\">then</span></span><br><span class=\"line\">        <span class=\"built_in\">echo</span> -e <span class=\"string\">&quot;<span class=\"variable\">$&#123;GREEN_COLOR&#125;</span>Environment readiness complete<span class=\"variable\">$&#123;RES&#125;</span>&quot;</span></span><br><span class=\"line\">    <span class=\"keyword\">fi</span></span><br><span class=\"line\"><span class=\"comment\">#-----------------</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> [  -f <span class=\"string\">&quot;<span class=\"variable\">$&#123;Server_file&#125;</span>/node_exporter.service&quot;</span> ];<span class=\"keyword\">then</span></span><br><span class=\"line\">\t    [[ ! -d /opt/back/ ]] &amp;&amp; mkdir -p /opt/back/ || <span class=\"built_in\">echo</span> <span class=\"string\">&quot;已存在&quot;</span></span><br><span class=\"line\">        cp -f <span class=\"variable\">$&#123;Server_file&#125;</span>/node_exporter.service /opt/back/node_exporter.service.bak<span class=\"variable\">$&#123;Time_date&#125;</span></span><br><span class=\"line\">    <span class=\"keyword\">fi</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> [ $? == 0 ];<span class=\"keyword\">then</span></span><br><span class=\"line\">        <span class=\"built_in\">echo</span> -e <span class=\"string\">&quot;<span class=\"variable\">$&#123;GREEN_COLOR&#125;</span>node_exporter.service.bak<span class=\"variable\">$&#123;Time_date&#125;</span>  File The backup successful<span class=\"variable\">$&#123;RES&#125;</span>&quot;</span></span><br><span class=\"line\">    <span class=\"keyword\">else</span></span><br><span class=\"line\">        <span class=\"built_in\">echo</span> -e <span class=\"string\">&quot;<span class=\"variable\">$&#123;RED_COLOR&#125;</span>node_exporter.service.bak<span class=\"variable\">$&#123;Time_date&#125;</span> File backup failed<span class=\"variable\">$&#123;RES&#125;</span>&quot;</span></span><br><span class=\"line\">        <span class=\"built_in\">exit</span> 22</span><br><span class=\"line\">    <span class=\"keyword\">fi</span></span><br><span class=\"line\">cat &gt;<span class=\"variable\">$&#123;Server_file&#125;</span>/node_exporter.service &lt;&lt;-<span class=\"string\">EOF</span></span><br><span class=\"line\"><span class=\"string\">[Unit]</span></span><br><span class=\"line\"><span class=\"string\">Description=Prometheus node exporter</span></span><br><span class=\"line\"><span class=\"string\">Documentation=https://prometheus.io/</span></span><br><span class=\"line\"><span class=\"string\">After=local-fs.target network-online.target network.target</span></span><br><span class=\"line\"><span class=\"string\">Wants=local-fs.target network-online.target network.target</span></span><br><span class=\"line\"><span class=\"string\">[Service]</span></span><br><span class=\"line\"><span class=\"string\">User=$&#123;node_user&#125;</span></span><br><span class=\"line\"><span class=\"string\">Group=$&#123;node_group&#125;</span></span><br><span class=\"line\"><span class=\"string\">Type=simple</span></span><br><span class=\"line\"><span class=\"string\">#ExecStart=$&#123;Install_PATH&#125;/node_exporter --web.listen-address=:9100 --log.level=error</span></span><br><span class=\"line\"><span class=\"string\">#ExecStart=$&#123;Install_PATH&#125;/node_exporter --web.listen-address=:$&#123;prot&#125; --log.level=error</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">ExecStart=$&#123;Install_PATH&#125;/node_exporter --web.listen-address=:$&#123;prot&#125; --log.level=error \\\\</span></span><br><span class=\"line\"><span class=\"string\">          --no-collector.softnet \\\\</span></span><br><span class=\"line\"><span class=\"string\">          --no-collector.nfs \\\\</span></span><br><span class=\"line\"><span class=\"string\">          --no-collector.hwmon \\\\</span></span><br><span class=\"line\"><span class=\"string\">          --no-collector.mdadm</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">ExecReload=/bin/kill -HUP $MAINPID</span></span><br><span class=\"line\"><span class=\"string\">TimeoutStopSec=20s</span></span><br><span class=\"line\"><span class=\"string\">Restart=always</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">[Install]</span></span><br><span class=\"line\"><span class=\"string\">WantedBy=multi-user.target</span></span><br><span class=\"line\"><span class=\"string\">EOF</span></span><br><span class=\"line\">    systemctl daemon-reload</span><br><span class=\"line\">    systemctl restart node_exporter</span><br><span class=\"line\">    <span class=\"keyword\">if</span> [ $? == 0 ];<span class=\"keyword\">then</span></span><br><span class=\"line\">        <span class=\"built_in\">echo</span> -e  <span class=\"string\">&quot;<span class=\"variable\">$&#123;GREEN_COLOR&#125;</span>node_exporte  Server start success!<span class=\"variable\">$&#123;RES&#125;</span>&quot;</span></span><br><span class=\"line\">    <span class=\"keyword\">else</span></span><br><span class=\"line\">        <span class=\"built_in\">echo</span> -e  <span class=\"string\">&quot;<span class=\"variable\">$&#123;RED_COLOR&#125;</span>node_exporte  Server start ERROR!<span class=\"variable\">$&#123;RES&#125;</span>&quot;</span></span><br><span class=\"line\">        <span class=\"built_in\">exit</span> 22</span><br><span class=\"line\">    <span class=\"keyword\">fi</span></span><br><span class=\"line\"><span class=\"comment\">#------------------</span></span><br><span class=\"line\"><span class=\"keyword\">else</span></span><br><span class=\"line\">    <span class=\"built_in\">echo</span> -e <span class=\"string\">&quot;<span class=\"variable\">$&#123;GREEN_COLOR&#125;</span>port:<span class=\"variable\">$&#123;prot&#125;</span> is busy,failed<span class=\"variable\">$&#123;RES&#125;</span>&quot;</span></span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\">systemctl <span class=\"built_in\">enable</span> node_exporter</span><br><span class=\"line\">systemctl status node_exporter</span><br><span class=\"line\"><span class=\"comment\">#验证</span></span><br><span class=\"line\">code=`curl -I -m 3 -o /dev/null -s -w %&#123;http_code&#125;  127.0.0.1:<span class=\"variable\">$&#123;prot&#125;</span>`</span><br><span class=\"line\"><span class=\"keyword\">if</span> [ <span class=\"variable\">$&#123;code&#125;</span> == 200 ];<span class=\"keyword\">then</span></span><br><span class=\"line\">    <span class=\"built_in\">echo</span> -e  <span class=\"string\">&quot;<span class=\"variable\">$&#123;GREEN_COLOR&#125;</span>register node in consul success<span class=\"variable\">$&#123;RES&#125;</span>&quot;</span></span><br><span class=\"line\"><span class=\"keyword\">else</span></span><br><span class=\"line\">    <span class=\"built_in\">echo</span> -e <span class=\"string\">&quot;<span class=\"variable\">$&#123;RED_COLOR&#125;</span>Registration failed or registered, please check! <span class=\"variable\">$&#123;RES&#125;</span>&quot;</span></span><br><span class=\"line\">    <span class=\"built_in\">exit</span> 22</span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"<p>摘要: 安装node_exporter脚本， 用于监控数据采集</p>","more":"<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/bin/bash</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\">#   rhel7.4 安装node_exporter 用于监控数据采集</span></span><br><span class=\"line\"><span class=\"comment\">#   Usage:</span></span><br><span class=\"line\"><span class=\"comment\">#         sh addNode.sh</span></span><br><span class=\"line\"><span class=\"comment\">#Logs: /var/log/messages</span></span><br><span class=\"line\"><span class=\"comment\">#History:  2019/8/2 v3</span></span><br><span class=\"line\"><span class=\"comment\">#Create_Time: 2019-08-02</span></span><br><span class=\"line\"><span class=\"comment\"># USE: small_wei</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\">#WEB_PATH=&#x27;http://12.0.94.46:8086&#x27;       #这里是我测试环境下的文件下载链接路径</span></span><br><span class=\"line\"><span class=\"comment\"># https://github.com/prometheus/node_exporter   官方下载地址</span></span><br><span class=\"line\">WEB_PATH=<span class=\"string\">&#x27;https://package-dev-qafc.aaa.com/res/node_exporter&#x27;</span></span><br><span class=\"line\">Install_PATH=/opt/node_exporter</span><br><span class=\"line\">Server_file=/usr/lib/systemd/system</span><br><span class=\"line\">prot=6301</span><br><span class=\"line\">RED_COLOR=<span class=\"string\">&#x27;\\E[1;31m&#x27;</span>  <span class=\"comment\">#红</span></span><br><span class=\"line\">GREEN_COLOR=<span class=\"string\">&#x27;\\E[1;32m&#x27;</span> <span class=\"comment\">#绿</span></span><br><span class=\"line\">RES=<span class=\"string\">&#x27;\\E[0m&#x27;</span></span><br><span class=\"line\">node_user=prometheus</span><br><span class=\"line\">node_group=prometheus</span><br><span class=\"line\">Time_date=$(date +<span class=\"string\">&quot;%Y%m%d%H%M%S&quot;</span>)</span><br><span class=\"line\"><span class=\"keyword\">if</span> [ ! $(id -u) == 0 ];<span class=\"keyword\">then</span></span><br><span class=\"line\">    <span class=\"built_in\">echo</span> -e <span class=\"string\">&quot;<span class=\"variable\">$&#123;GREEN_COLOR&#125;</span>Please run with the root user!<span class=\"variable\">$&#123;RES&#125;</span>&quot;</span></span><br><span class=\"line\">    <span class=\"built_in\">exit</span> 22</span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"><span class=\"comment\">#防止重复执行</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> [ $(ps -ef | grep <span class=\"variable\">$0</span> |grep -v grep | wc -l) -gt 2 ];<span class=\"keyword\">then</span>    <span class=\"comment\">#理论值为 1,但这里是 2 </span></span><br><span class=\"line\">        <span class=\"built_in\">echo</span> -e <span class=\"string\">&quot;<span class=\"variable\">$&#123;RED_COLOR&#125;</span> <span class=\"variable\">$0</span>  The script is executing, do not repeat!, Run id is $$<span class=\"variable\">$&#123;RES&#125;</span>&quot;</span></span><br><span class=\"line\">        <span class=\"built_in\">exit</span> 22</span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"><span class=\"comment\">#create group if not exists</span></span><br><span class=\"line\">egrep <span class=\"string\">&quot;^<span class=\"variable\">$&#123;node_group&#125;</span>&quot;</span> /etc/group 2&gt;/dev/null</span><br><span class=\"line\"><span class=\"keyword\">if</span> [ $? -ne 0 ];<span class=\"keyword\">then</span></span><br><span class=\"line\">    groupadd <span class=\"variable\">$&#123;node_group&#125;</span></span><br><span class=\"line\">    <span class=\"built_in\">echo</span> -e <span class=\"string\">&quot;<span class=\"variable\">$&#123;node_group&#125;</span> group Creating a successful&quot;</span></span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"><span class=\"comment\">#create user if not exists</span></span><br><span class=\"line\">egrep <span class=\"string\">&quot;^<span class=\"variable\">$&#123;node_user&#125;</span>&quot;</span> /etc/passwd 2&gt;/dev/null</span><br><span class=\"line\"><span class=\"keyword\">if</span> [ $? -ne 0 ];<span class=\"keyword\">then</span></span><br><span class=\"line\">    useradd -g <span class=\"variable\">$&#123;node_group&#125;</span> <span class=\"variable\">$&#123;node_user&#125;</span></span><br><span class=\"line\">    <span class=\"built_in\">echo</span> -e <span class=\"string\">&quot;<span class=\"variable\">$&#123;node_user&#125;</span> user Creating a successful&quot;</span></span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\">port=`netstat -tunlp|grep <span class=\"variable\">$&#123;prot&#125;</span>`</span><br><span class=\"line\"><span class=\"keyword\">if</span> <span class=\"built_in\">test</span> -z <span class=\"string\">&quot;<span class=\"variable\">$&#123;port&#125;</span>&quot;</span></span><br><span class=\"line\"><span class=\"keyword\">then</span></span><br><span class=\"line\">    [[ ! -d <span class=\"variable\">$&#123;Install_PATH&#125;</span> ]] &amp;&amp; mkdir -p <span class=\"variable\">$&#123;Install_PATH&#125;</span> || <span class=\"built_in\">echo</span> <span class=\"string\">&quot;存在&quot;</span></span><br><span class=\"line\">    chown -R <span class=\"variable\">$&#123;node_user&#125;</span>:<span class=\"variable\">$&#123;node_user&#125;</span> <span class=\"variable\">$&#123;Install_PATH&#125;</span></span><br><span class=\"line\">    <span class=\"built_in\">cd</span> <span class=\"variable\">$&#123;Install_PATH&#125;</span></span><br><span class=\"line\">    curl -u ztycroot:dwI6TNCe -O <span class=\"variable\">$WEB_PATH</span></span><br><span class=\"line\">    chmod +x  <span class=\"variable\">$&#123;Install_PATH&#125;</span>/node_exporter</span><br><span class=\"line\">    <span class=\"keyword\">if</span> [[ $? == 0 ]];<span class=\"keyword\">then</span></span><br><span class=\"line\">        <span class=\"built_in\">echo</span> -e <span class=\"string\">&quot;<span class=\"variable\">$&#123;GREEN_COLOR&#125;</span>Environment readiness complete<span class=\"variable\">$&#123;RES&#125;</span>&quot;</span></span><br><span class=\"line\">    <span class=\"keyword\">fi</span></span><br><span class=\"line\"><span class=\"comment\">#-----------------</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> [  -f <span class=\"string\">&quot;<span class=\"variable\">$&#123;Server_file&#125;</span>/node_exporter.service&quot;</span> ];<span class=\"keyword\">then</span></span><br><span class=\"line\">\t    [[ ! -d /opt/back/ ]] &amp;&amp; mkdir -p /opt/back/ || <span class=\"built_in\">echo</span> <span class=\"string\">&quot;已存在&quot;</span></span><br><span class=\"line\">        cp -f <span class=\"variable\">$&#123;Server_file&#125;</span>/node_exporter.service /opt/back/node_exporter.service.bak<span class=\"variable\">$&#123;Time_date&#125;</span></span><br><span class=\"line\">    <span class=\"keyword\">fi</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> [ $? == 0 ];<span class=\"keyword\">then</span></span><br><span class=\"line\">        <span class=\"built_in\">echo</span> -e <span class=\"string\">&quot;<span class=\"variable\">$&#123;GREEN_COLOR&#125;</span>node_exporter.service.bak<span class=\"variable\">$&#123;Time_date&#125;</span>  File The backup successful<span class=\"variable\">$&#123;RES&#125;</span>&quot;</span></span><br><span class=\"line\">    <span class=\"keyword\">else</span></span><br><span class=\"line\">        <span class=\"built_in\">echo</span> -e <span class=\"string\">&quot;<span class=\"variable\">$&#123;RED_COLOR&#125;</span>node_exporter.service.bak<span class=\"variable\">$&#123;Time_date&#125;</span> File backup failed<span class=\"variable\">$&#123;RES&#125;</span>&quot;</span></span><br><span class=\"line\">        <span class=\"built_in\">exit</span> 22</span><br><span class=\"line\">    <span class=\"keyword\">fi</span></span><br><span class=\"line\">cat &gt;<span class=\"variable\">$&#123;Server_file&#125;</span>/node_exporter.service &lt;&lt;-<span class=\"string\">EOF</span></span><br><span class=\"line\"><span class=\"string\">[Unit]</span></span><br><span class=\"line\"><span class=\"string\">Description=Prometheus node exporter</span></span><br><span class=\"line\"><span class=\"string\">Documentation=https://prometheus.io/</span></span><br><span class=\"line\"><span class=\"string\">After=local-fs.target network-online.target network.target</span></span><br><span class=\"line\"><span class=\"string\">Wants=local-fs.target network-online.target network.target</span></span><br><span class=\"line\"><span class=\"string\">[Service]</span></span><br><span class=\"line\"><span class=\"string\">User=$&#123;node_user&#125;</span></span><br><span class=\"line\"><span class=\"string\">Group=$&#123;node_group&#125;</span></span><br><span class=\"line\"><span class=\"string\">Type=simple</span></span><br><span class=\"line\"><span class=\"string\">#ExecStart=$&#123;Install_PATH&#125;/node_exporter --web.listen-address=:9100 --log.level=error</span></span><br><span class=\"line\"><span class=\"string\">#ExecStart=$&#123;Install_PATH&#125;/node_exporter --web.listen-address=:$&#123;prot&#125; --log.level=error</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">ExecStart=$&#123;Install_PATH&#125;/node_exporter --web.listen-address=:$&#123;prot&#125; --log.level=error \\\\</span></span><br><span class=\"line\"><span class=\"string\">          --no-collector.softnet \\\\</span></span><br><span class=\"line\"><span class=\"string\">          --no-collector.nfs \\\\</span></span><br><span class=\"line\"><span class=\"string\">          --no-collector.hwmon \\\\</span></span><br><span class=\"line\"><span class=\"string\">          --no-collector.mdadm</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">ExecReload=/bin/kill -HUP $MAINPID</span></span><br><span class=\"line\"><span class=\"string\">TimeoutStopSec=20s</span></span><br><span class=\"line\"><span class=\"string\">Restart=always</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">[Install]</span></span><br><span class=\"line\"><span class=\"string\">WantedBy=multi-user.target</span></span><br><span class=\"line\"><span class=\"string\">EOF</span></span><br><span class=\"line\">    systemctl daemon-reload</span><br><span class=\"line\">    systemctl restart node_exporter</span><br><span class=\"line\">    <span class=\"keyword\">if</span> [ $? == 0 ];<span class=\"keyword\">then</span></span><br><span class=\"line\">        <span class=\"built_in\">echo</span> -e  <span class=\"string\">&quot;<span class=\"variable\">$&#123;GREEN_COLOR&#125;</span>node_exporte  Server start success!<span class=\"variable\">$&#123;RES&#125;</span>&quot;</span></span><br><span class=\"line\">    <span class=\"keyword\">else</span></span><br><span class=\"line\">        <span class=\"built_in\">echo</span> -e  <span class=\"string\">&quot;<span class=\"variable\">$&#123;RED_COLOR&#125;</span>node_exporte  Server start ERROR!<span class=\"variable\">$&#123;RES&#125;</span>&quot;</span></span><br><span class=\"line\">        <span class=\"built_in\">exit</span> 22</span><br><span class=\"line\">    <span class=\"keyword\">fi</span></span><br><span class=\"line\"><span class=\"comment\">#------------------</span></span><br><span class=\"line\"><span class=\"keyword\">else</span></span><br><span class=\"line\">    <span class=\"built_in\">echo</span> -e <span class=\"string\">&quot;<span class=\"variable\">$&#123;GREEN_COLOR&#125;</span>port:<span class=\"variable\">$&#123;prot&#125;</span> is busy,failed<span class=\"variable\">$&#123;RES&#125;</span>&quot;</span></span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\">systemctl <span class=\"built_in\">enable</span> node_exporter</span><br><span class=\"line\">systemctl status node_exporter</span><br><span class=\"line\"><span class=\"comment\">#验证</span></span><br><span class=\"line\">code=`curl -I -m 3 -o /dev/null -s -w %&#123;http_code&#125;  127.0.0.1:<span class=\"variable\">$&#123;prot&#125;</span>`</span><br><span class=\"line\"><span class=\"keyword\">if</span> [ <span class=\"variable\">$&#123;code&#125;</span> == 200 ];<span class=\"keyword\">then</span></span><br><span class=\"line\">    <span class=\"built_in\">echo</span> -e  <span class=\"string\">&quot;<span class=\"variable\">$&#123;GREEN_COLOR&#125;</span>register node in consul success<span class=\"variable\">$&#123;RES&#125;</span>&quot;</span></span><br><span class=\"line\"><span class=\"keyword\">else</span></span><br><span class=\"line\">    <span class=\"built_in\">echo</span> -e <span class=\"string\">&quot;<span class=\"variable\">$&#123;RED_COLOR&#125;</span>Registration failed or registered, please check! <span class=\"variable\">$&#123;RES&#125;</span>&quot;</span></span><br><span class=\"line\">    <span class=\"built_in\">exit</span> 22</span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br></pre></td></tr></table></figure>"},{"title":"node_exporter 配置","date":"2020-09-21T08:34:00.000Z","_content":"\n\nnode_exporter是prometheus官方提供的agent，项目被托管在prometheus的账号之下。我们也可以通过官方提供的链接下载最新的版本。在官方的github里面已经提供了非常详细使用说明，我们这里带大家梳理一下\n\n\n### node_exporte基本信息配置\n\n```\n-- web.listen-address=\":9100\"\n# 监听的端口，默认是9100，若需要修改则通过此参数\n\n--web.telemetry-path=\"/metrics\"  \n#获取metric信息的url，默认是/metrics，若需要修改则通过此参数\n\n--log.level=\"info\" \n#设置日志级别\n\n--log.format=\"logger:stderr\"  \n#设置打印日志的格式，若有自动化日志提取工具可以使用这个参数规范日志打印的格式\n```\n\n\n### 通过正则表达式来屏蔽或选择某些监控项\n```\n--collector.diskstats.ignored-devices=\"^(ram|loop|fd|(h|s|v|xv)d[a-z]|nvme\\\\d+n\\\\d+p)\\\\d+$\"\n#通过正则表达式忽略某些磁盘的信息收集\n\n--collector.filesystem.ignored-mount-points=\"^/(dev|proc|sys|var/lib/docker/.+)($|/)\"  \n#通过正则表达式忽略某些文件系统挂载点的信息收集\n\n--collector.filesystem.ignored-fs-types=\"^(autofs|binfmt_misc|bpf|cgroup2?|configfs|debugfs|devpts|devtmpfs|fusectl|hugetlbfs|mqueue|nsfs|overlay|proc|procfs|pstore|rpc_pipefs|securityfs|selinuxfs|squashfs|sysfs|tracefs)$\"  \n#通过正则表达式忽略某些文件系统类型的信息收集\n\n--collector.netclass.ignored-devices=\"^$\"  \n#通过正则表达式忽略某些网络类的信息收集\n\n--collector.netdev.ignored-devices=\"^$\"  \n#通过正则表达式忽略某些网络设备的信息收集\n\n  --collector.netstat.fields=\"^$\"\n #通过正则表达式配置需要获取的网络状态信息\n \n--collector.vmstat.fields=\"^(oom_kill|pgpg|pswp|pg.*fault).*\" \n#通过正则表达式配置vmstat返回信息中需要收集的选项\n```\n\n```\n\n````\n\n### 添加用户名和密码验证\n\n我们直接可以使用 htpasswd 来生成 密码(在httpd-tools当中)\n```\nyum install httpd-tools -y\n\nhtpasswd -nBC 12 '' | tr -d ':\\n'       \nNew password:\nRe-type new password:                                              \n$2y$12$WLw2sYa.NYZoBVoCOE84qe3xNm7kbSoKVIBXP.PvqNDna60vnZhEW\n#这个密码可以用作其他的服务器上，自己输入的密码要记住，\n#用户名可以任意给一个，配置文件格式是如下，注意username前面有两个空格\n\nbasic_auth_users:\n  # 当前设置的用户名为 prometheus ， 可以设置多个\n  prometheus: $2y$12$WLw2sYa.NYZoBVoCOE84qe3xNm7kbSoKVIBXP.PvqNDna60vnZhEW\n```\n\n\n\n### TLS的配置\n```bash\n# mkdir -p prometheus-tls\n# cd prometheus-tls\n# openssl req -new -newkey rsa:2048 -days 365 -nodes -x509 -keyout node_exporter.key -out node_exporter.crt -subj \"/C=CN/ST=Beijing/L=Beijing/O=Moelove.info/CN=localhost\"\n\n# ls\nnode_exporter.crt  node_exporter.key\n```\n\n\n我们默认暴露的都是http的请求的，也没有验证，也就是明文传输，很容易存在安全隐患，如果需要对数据加密，我们就要使用参数`./node_exporter --web.config=web-config.yml`，这个文件的内容如下\n```\ntls_server_config:\n  # Certificate and key files for server to use to authenticate to client.\n  cert_file: node_exporter.crt   # <filename>\n  key_file: node_exporter.key    #<filename>\n\n  # Server policy for client authentication. Maps to ClientAuth Policies.\n  # For more detail on clientAuth options: [ClientAuthType](https://golang.org/pkg/crypto/tls/#ClientAuthType)\n  [ client_auth_type: <string> | default = \"NoClientCert\" ]\n\n  # CA certificate for client certificate authentication to the server.\n  [ client_ca_file: <filename> ]\n\n  # Minimum TLS version that is acceptable.\n  [ min_version: <string> | default = \"TLS12\" ]\n\n  # Maximum TLS version that is acceptable.\n  [ max_version: <string> | default = \"TLS13\" ]\n\n  # List of supported cipher suites for TLS versions up to TLS 1.2. If empty,\n  # Go default cipher suites are used. Available cipher suites are documented\n  # in the go documentation:\n  # https://golang.org/pkg/crypto/tls/#pkg-constants\n  [ cipher_suites:\n    [ - <string> ] ]\n\n  # prefer_server_cipher_suites controls whether the server selects the\n  # client's most preferred ciphersuite, or the server's most preferred\n  # ciphersuite. If true then the server's preference, as expressed in\n  # the order of elements in cipher_suites, is used.\n  [ prefer_server_cipher_suites: <bool> | default = true ]\n\n  # Elliptic curves that will be used in an ECDHE handshake, in preference\n  # order. Available curves are documented in the go documentation:\n  # https://golang.org/pkg/crypto/tls/#CurveID\n  [ curve_preferences:\n    [ - <string> ] ]\n\nhttp_server_config:\n  # Enable HTTP/2 support. Note that HTTP/2 is only supported with TLS.\n  # This can not be changed on the fly.\n  [ http2: <bool> | default = true ]\n\n# Usernames and hashed passwords that have full access to the web\n# server via basic authentication. If empty, no basic authentication is\n# required. Passwords are hashed with bcrypt.\nbasic_auth_users:\n  [ <string>: <secret> ... ]\n```\n\n\n不能直接 curl 进行请求了，我们可以将证书传递给 curl ，用来验证刚才的配置是否正确\n```\ncurl -s  --cacert node_exporter.crt https://localhost:9100/metrics  |grep node_exporter_build_info\n```\n\n当然，除了通过 --cacert 参数将证书传递给 curl 外，也可以通过 -k 参数来忽略证书检查。\n```\ncurl -s -k https://localhost:9100/metrics  |grep node_exporter_build_info        \n```\n\n### 配置 Prometheus 使用 TLS\n要修改下配置文件，让 Prometheus 可以抓取 Node Exporter 暴露的 metrics 。\n\n```\nglobal:\n  scrape_interval:     15s \n  evaluation_interval: 15s \n\nscrape_configs:\n  - job_name: 'prometheus'\n    static_configs:\n    - targets: ['localhost:9090']\n\n  - job_name: 'node_exporter'\n    scheme: https\n    tls_config:\n      ca_file: node_exporter.crt\n    static_configs:\n    - targets: ['localhost:9100']\n```\n\n这里额外增加了 `scheme: https`  表示通过 HTTPS 建立连接，tls_config 中指定了所用的证书文件。完整的配置可以参考 官方文档中对 [tls_config](https://prometheus.io/docs/prometheus/latest/configuration/configuration/#tls_config) 的说明 。\n\n\n\n### 配置 Prometheus 使用 Basic Auth\n```\nglobal:\n  scrape_interval:     15s \n  evaluation_interval: 15s \n\nscrape_configs:\n  - job_name: 'prometheus'\n    static_configs:\n    - targets: ['localhost:9090']\n\n  - job_name: 'node_exporter'\n    scheme: https\n    tls_config:\n      ca_file: node_exporter.crt\n    basic_auth:\n      username: prometheus\n      password: moelove.info\n    static_configs:\n    - targets: ['localhost:9100']\n```\n\n在生产中使用时，建议更加规范化操作，比如 CA 的选择，密码的管理等，比如 Node Exporter 的 Basic Auth 其实支持配置多个用户名密码的。\n\n","source":"_posts/prometheus/node_exporter配置.md","raw":"---\ntitle: node_exporter 配置\ndate: 2020-09-21 16:34\ncategories:\n- prometheus\ntags:\n- prome\n- node_exporter\n---\n\n\nnode_exporter是prometheus官方提供的agent，项目被托管在prometheus的账号之下。我们也可以通过官方提供的链接下载最新的版本。在官方的github里面已经提供了非常详细使用说明，我们这里带大家梳理一下\n\n\n### node_exporte基本信息配置\n\n```\n-- web.listen-address=\":9100\"\n# 监听的端口，默认是9100，若需要修改则通过此参数\n\n--web.telemetry-path=\"/metrics\"  \n#获取metric信息的url，默认是/metrics，若需要修改则通过此参数\n\n--log.level=\"info\" \n#设置日志级别\n\n--log.format=\"logger:stderr\"  \n#设置打印日志的格式，若有自动化日志提取工具可以使用这个参数规范日志打印的格式\n```\n\n\n### 通过正则表达式来屏蔽或选择某些监控项\n```\n--collector.diskstats.ignored-devices=\"^(ram|loop|fd|(h|s|v|xv)d[a-z]|nvme\\\\d+n\\\\d+p)\\\\d+$\"\n#通过正则表达式忽略某些磁盘的信息收集\n\n--collector.filesystem.ignored-mount-points=\"^/(dev|proc|sys|var/lib/docker/.+)($|/)\"  \n#通过正则表达式忽略某些文件系统挂载点的信息收集\n\n--collector.filesystem.ignored-fs-types=\"^(autofs|binfmt_misc|bpf|cgroup2?|configfs|debugfs|devpts|devtmpfs|fusectl|hugetlbfs|mqueue|nsfs|overlay|proc|procfs|pstore|rpc_pipefs|securityfs|selinuxfs|squashfs|sysfs|tracefs)$\"  \n#通过正则表达式忽略某些文件系统类型的信息收集\n\n--collector.netclass.ignored-devices=\"^$\"  \n#通过正则表达式忽略某些网络类的信息收集\n\n--collector.netdev.ignored-devices=\"^$\"  \n#通过正则表达式忽略某些网络设备的信息收集\n\n  --collector.netstat.fields=\"^$\"\n #通过正则表达式配置需要获取的网络状态信息\n \n--collector.vmstat.fields=\"^(oom_kill|pgpg|pswp|pg.*fault).*\" \n#通过正则表达式配置vmstat返回信息中需要收集的选项\n```\n\n```\n\n````\n\n### 添加用户名和密码验证\n\n我们直接可以使用 htpasswd 来生成 密码(在httpd-tools当中)\n```\nyum install httpd-tools -y\n\nhtpasswd -nBC 12 '' | tr -d ':\\n'       \nNew password:\nRe-type new password:                                              \n$2y$12$WLw2sYa.NYZoBVoCOE84qe3xNm7kbSoKVIBXP.PvqNDna60vnZhEW\n#这个密码可以用作其他的服务器上，自己输入的密码要记住，\n#用户名可以任意给一个，配置文件格式是如下，注意username前面有两个空格\n\nbasic_auth_users:\n  # 当前设置的用户名为 prometheus ， 可以设置多个\n  prometheus: $2y$12$WLw2sYa.NYZoBVoCOE84qe3xNm7kbSoKVIBXP.PvqNDna60vnZhEW\n```\n\n\n\n### TLS的配置\n```bash\n# mkdir -p prometheus-tls\n# cd prometheus-tls\n# openssl req -new -newkey rsa:2048 -days 365 -nodes -x509 -keyout node_exporter.key -out node_exporter.crt -subj \"/C=CN/ST=Beijing/L=Beijing/O=Moelove.info/CN=localhost\"\n\n# ls\nnode_exporter.crt  node_exporter.key\n```\n\n\n我们默认暴露的都是http的请求的，也没有验证，也就是明文传输，很容易存在安全隐患，如果需要对数据加密，我们就要使用参数`./node_exporter --web.config=web-config.yml`，这个文件的内容如下\n```\ntls_server_config:\n  # Certificate and key files for server to use to authenticate to client.\n  cert_file: node_exporter.crt   # <filename>\n  key_file: node_exporter.key    #<filename>\n\n  # Server policy for client authentication. Maps to ClientAuth Policies.\n  # For more detail on clientAuth options: [ClientAuthType](https://golang.org/pkg/crypto/tls/#ClientAuthType)\n  [ client_auth_type: <string> | default = \"NoClientCert\" ]\n\n  # CA certificate for client certificate authentication to the server.\n  [ client_ca_file: <filename> ]\n\n  # Minimum TLS version that is acceptable.\n  [ min_version: <string> | default = \"TLS12\" ]\n\n  # Maximum TLS version that is acceptable.\n  [ max_version: <string> | default = \"TLS13\" ]\n\n  # List of supported cipher suites for TLS versions up to TLS 1.2. If empty,\n  # Go default cipher suites are used. Available cipher suites are documented\n  # in the go documentation:\n  # https://golang.org/pkg/crypto/tls/#pkg-constants\n  [ cipher_suites:\n    [ - <string> ] ]\n\n  # prefer_server_cipher_suites controls whether the server selects the\n  # client's most preferred ciphersuite, or the server's most preferred\n  # ciphersuite. If true then the server's preference, as expressed in\n  # the order of elements in cipher_suites, is used.\n  [ prefer_server_cipher_suites: <bool> | default = true ]\n\n  # Elliptic curves that will be used in an ECDHE handshake, in preference\n  # order. Available curves are documented in the go documentation:\n  # https://golang.org/pkg/crypto/tls/#CurveID\n  [ curve_preferences:\n    [ - <string> ] ]\n\nhttp_server_config:\n  # Enable HTTP/2 support. Note that HTTP/2 is only supported with TLS.\n  # This can not be changed on the fly.\n  [ http2: <bool> | default = true ]\n\n# Usernames and hashed passwords that have full access to the web\n# server via basic authentication. If empty, no basic authentication is\n# required. Passwords are hashed with bcrypt.\nbasic_auth_users:\n  [ <string>: <secret> ... ]\n```\n\n\n不能直接 curl 进行请求了，我们可以将证书传递给 curl ，用来验证刚才的配置是否正确\n```\ncurl -s  --cacert node_exporter.crt https://localhost:9100/metrics  |grep node_exporter_build_info\n```\n\n当然，除了通过 --cacert 参数将证书传递给 curl 外，也可以通过 -k 参数来忽略证书检查。\n```\ncurl -s -k https://localhost:9100/metrics  |grep node_exporter_build_info        \n```\n\n### 配置 Prometheus 使用 TLS\n要修改下配置文件，让 Prometheus 可以抓取 Node Exporter 暴露的 metrics 。\n\n```\nglobal:\n  scrape_interval:     15s \n  evaluation_interval: 15s \n\nscrape_configs:\n  - job_name: 'prometheus'\n    static_configs:\n    - targets: ['localhost:9090']\n\n  - job_name: 'node_exporter'\n    scheme: https\n    tls_config:\n      ca_file: node_exporter.crt\n    static_configs:\n    - targets: ['localhost:9100']\n```\n\n这里额外增加了 `scheme: https`  表示通过 HTTPS 建立连接，tls_config 中指定了所用的证书文件。完整的配置可以参考 官方文档中对 [tls_config](https://prometheus.io/docs/prometheus/latest/configuration/configuration/#tls_config) 的说明 。\n\n\n\n### 配置 Prometheus 使用 Basic Auth\n```\nglobal:\n  scrape_interval:     15s \n  evaluation_interval: 15s \n\nscrape_configs:\n  - job_name: 'prometheus'\n    static_configs:\n    - targets: ['localhost:9090']\n\n  - job_name: 'node_exporter'\n    scheme: https\n    tls_config:\n      ca_file: node_exporter.crt\n    basic_auth:\n      username: prometheus\n      password: moelove.info\n    static_configs:\n    - targets: ['localhost:9100']\n```\n\n在生产中使用时，建议更加规范化操作，比如 CA 的选择，密码的管理等，比如 Node Exporter 的 Basic Auth 其实支持配置多个用户名密码的。\n\n","slug":"prometheus/node_exporter配置","published":1,"updated":"2021-09-08T09:42:02.967Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cku697a0m006h00uhgn9fchyz","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><p>node_exporter是prometheus官方提供的agent，项目被托管在prometheus的账号之下。我们也可以通过官方提供的链接下载最新的版本。在官方的github里面已经提供了非常详细使用说明，我们这里带大家梳理一下</p>\n<h3 id=\"node-exporte基本信息配置\"><a href=\"#node-exporte基本信息配置\" class=\"headerlink\" title=\"node_exporte基本信息配置\"></a>node_exporte基本信息配置</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">-- web.listen-address&#x3D;&quot;:9100&quot;</span><br><span class=\"line\"># 监听的端口，默认是9100，若需要修改则通过此参数</span><br><span class=\"line\"></span><br><span class=\"line\">--web.telemetry-path&#x3D;&quot;&#x2F;metrics&quot;  </span><br><span class=\"line\">#获取metric信息的url，默认是&#x2F;metrics，若需要修改则通过此参数</span><br><span class=\"line\"></span><br><span class=\"line\">--log.level&#x3D;&quot;info&quot; </span><br><span class=\"line\">#设置日志级别</span><br><span class=\"line\"></span><br><span class=\"line\">--log.format&#x3D;&quot;logger:stderr&quot;  </span><br><span class=\"line\">#设置打印日志的格式，若有自动化日志提取工具可以使用这个参数规范日志打印的格式</span><br></pre></td></tr></table></figure>\n\n\n<h3 id=\"通过正则表达式来屏蔽或选择某些监控项\"><a href=\"#通过正则表达式来屏蔽或选择某些监控项\" class=\"headerlink\" title=\"通过正则表达式来屏蔽或选择某些监控项\"></a>通过正则表达式来屏蔽或选择某些监控项</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">--collector.diskstats.ignored-devices&#x3D;&quot;^(ram|loop|fd|(h|s|v|xv)d[a-z]|nvme\\\\d+n\\\\d+p)\\\\d+$&quot;</span><br><span class=\"line\">#通过正则表达式忽略某些磁盘的信息收集</span><br><span class=\"line\"></span><br><span class=\"line\">--collector.filesystem.ignored-mount-points&#x3D;&quot;^&#x2F;(dev|proc|sys|var&#x2F;lib&#x2F;docker&#x2F;.+)($|&#x2F;)&quot;  </span><br><span class=\"line\">#通过正则表达式忽略某些文件系统挂载点的信息收集</span><br><span class=\"line\"></span><br><span class=\"line\">--collector.filesystem.ignored-fs-types&#x3D;&quot;^(autofs|binfmt_misc|bpf|cgroup2?|configfs|debugfs|devpts|devtmpfs|fusectl|hugetlbfs|mqueue|nsfs|overlay|proc|procfs|pstore|rpc_pipefs|securityfs|selinuxfs|squashfs|sysfs|tracefs)$&quot;  </span><br><span class=\"line\">#通过正则表达式忽略某些文件系统类型的信息收集</span><br><span class=\"line\"></span><br><span class=\"line\">--collector.netclass.ignored-devices&#x3D;&quot;^$&quot;  </span><br><span class=\"line\">#通过正则表达式忽略某些网络类的信息收集</span><br><span class=\"line\"></span><br><span class=\"line\">--collector.netdev.ignored-devices&#x3D;&quot;^$&quot;  </span><br><span class=\"line\">#通过正则表达式忽略某些网络设备的信息收集</span><br><span class=\"line\"></span><br><span class=\"line\">  --collector.netstat.fields&#x3D;&quot;^$&quot;</span><br><span class=\"line\"> #通过正则表达式配置需要获取的网络状态信息</span><br><span class=\"line\"> </span><br><span class=\"line\">--collector.vmstat.fields&#x3D;&quot;^(oom_kill|pgpg|pswp|pg.*fault).*&quot; </span><br><span class=\"line\">#通过正则表达式配置vmstat返回信息中需要收集的选项</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">&#96;&#96;&#96;&#96;</span><br><span class=\"line\"></span><br><span class=\"line\">### 添加用户名和密码验证</span><br><span class=\"line\"></span><br><span class=\"line\">我们直接可以使用 htpasswd 来生成 密码(在httpd-tools当中)</span><br></pre></td></tr></table></figure>\n<p>yum install httpd-tools -y</p>\n<p>htpasswd -nBC 12 ‘’ | tr -d ‘:\\n’<br>New password:<br>Re-type new password:<br>$2y$12$WLw2sYa.NYZoBVoCOE84qe3xNm7kbSoKVIBXP.PvqNDna60vnZhEW<br>#这个密码可以用作其他的服务器上，自己输入的密码要记住，<br>#用户名可以任意给一个，配置文件格式是如下，注意username前面有两个空格</p>\n<p>basic_auth_users:</p>\n<h1 id=\"当前设置的用户名为-prometheus-，-可以设置多个\"><a href=\"#当前设置的用户名为-prometheus-，-可以设置多个\" class=\"headerlink\" title=\"当前设置的用户名为 prometheus ， 可以设置多个\"></a>当前设置的用户名为 prometheus ， 可以设置多个</h1><p>  prometheus: $2y$12$WLw2sYa.NYZoBVoCOE84qe3xNm7kbSoKVIBXP.PvqNDna60vnZhEW</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">### TLS的配置</span><br><span class=\"line\">&#96;&#96;&#96;bash</span><br><span class=\"line\"># mkdir -p prometheus-tls</span><br><span class=\"line\"># cd prometheus-tls</span><br><span class=\"line\"># openssl req -new -newkey rsa:2048 -days 365 -nodes -x509 -keyout node_exporter.key -out node_exporter.crt -subj &quot;&#x2F;C&#x3D;CN&#x2F;ST&#x3D;Beijing&#x2F;L&#x3D;Beijing&#x2F;O&#x3D;Moelove.info&#x2F;CN&#x3D;localhost&quot;</span><br><span class=\"line\"></span><br><span class=\"line\"># ls</span><br><span class=\"line\">node_exporter.crt  node_exporter.key</span><br></pre></td></tr></table></figure>\n\n\n<p>我们默认暴露的都是http的请求的，也没有验证，也就是明文传输，很容易存在安全隐患，如果需要对数据加密，我们就要使用参数<code>./node_exporter --web.config=web-config.yml</code>，这个文件的内容如下</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tls_server_config:</span><br><span class=\"line\">  # Certificate and key files for server to use to authenticate to client.</span><br><span class=\"line\">  cert_file: node_exporter.crt   # &lt;filename&gt;</span><br><span class=\"line\">  key_file: node_exporter.key    #&lt;filename&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">  # Server policy for client authentication. Maps to ClientAuth Policies.</span><br><span class=\"line\">  # For more detail on clientAuth options: [ClientAuthType](https:&#x2F;&#x2F;golang.org&#x2F;pkg&#x2F;crypto&#x2F;tls&#x2F;#ClientAuthType)</span><br><span class=\"line\">  [ client_auth_type: &lt;string&gt; | default &#x3D; &quot;NoClientCert&quot; ]</span><br><span class=\"line\"></span><br><span class=\"line\">  # CA certificate for client certificate authentication to the server.</span><br><span class=\"line\">  [ client_ca_file: &lt;filename&gt; ]</span><br><span class=\"line\"></span><br><span class=\"line\">  # Minimum TLS version that is acceptable.</span><br><span class=\"line\">  [ min_version: &lt;string&gt; | default &#x3D; &quot;TLS12&quot; ]</span><br><span class=\"line\"></span><br><span class=\"line\">  # Maximum TLS version that is acceptable.</span><br><span class=\"line\">  [ max_version: &lt;string&gt; | default &#x3D; &quot;TLS13&quot; ]</span><br><span class=\"line\"></span><br><span class=\"line\">  # List of supported cipher suites for TLS versions up to TLS 1.2. If empty,</span><br><span class=\"line\">  # Go default cipher suites are used. Available cipher suites are documented</span><br><span class=\"line\">  # in the go documentation:</span><br><span class=\"line\">  # https:&#x2F;&#x2F;golang.org&#x2F;pkg&#x2F;crypto&#x2F;tls&#x2F;#pkg-constants</span><br><span class=\"line\">  [ cipher_suites:</span><br><span class=\"line\">    [ - &lt;string&gt; ] ]</span><br><span class=\"line\"></span><br><span class=\"line\">  # prefer_server_cipher_suites controls whether the server selects the</span><br><span class=\"line\">  # client&#39;s most preferred ciphersuite, or the server&#39;s most preferred</span><br><span class=\"line\">  # ciphersuite. If true then the server&#39;s preference, as expressed in</span><br><span class=\"line\">  # the order of elements in cipher_suites, is used.</span><br><span class=\"line\">  [ prefer_server_cipher_suites: &lt;bool&gt; | default &#x3D; true ]</span><br><span class=\"line\"></span><br><span class=\"line\">  # Elliptic curves that will be used in an ECDHE handshake, in preference</span><br><span class=\"line\">  # order. Available curves are documented in the go documentation:</span><br><span class=\"line\">  # https:&#x2F;&#x2F;golang.org&#x2F;pkg&#x2F;crypto&#x2F;tls&#x2F;#CurveID</span><br><span class=\"line\">  [ curve_preferences:</span><br><span class=\"line\">    [ - &lt;string&gt; ] ]</span><br><span class=\"line\"></span><br><span class=\"line\">http_server_config:</span><br><span class=\"line\">  # Enable HTTP&#x2F;2 support. Note that HTTP&#x2F;2 is only supported with TLS.</span><br><span class=\"line\">  # This can not be changed on the fly.</span><br><span class=\"line\">  [ http2: &lt;bool&gt; | default &#x3D; true ]</span><br><span class=\"line\"></span><br><span class=\"line\"># Usernames and hashed passwords that have full access to the web</span><br><span class=\"line\"># server via basic authentication. If empty, no basic authentication is</span><br><span class=\"line\"># required. Passwords are hashed with bcrypt.</span><br><span class=\"line\">basic_auth_users:</span><br><span class=\"line\">  [ &lt;string&gt;: &lt;secret&gt; ... ]</span><br></pre></td></tr></table></figure>\n\n\n<p>不能直接 curl 进行请求了，我们可以将证书传递给 curl ，用来验证刚才的配置是否正确</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -s  --cacert node_exporter.crt https:&#x2F;&#x2F;localhost:9100&#x2F;metrics  |grep node_exporter_build_info</span><br></pre></td></tr></table></figure>\n\n<p>当然，除了通过 –cacert 参数将证书传递给 curl 外，也可以通过 -k 参数来忽略证书检查。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -s -k https:&#x2F;&#x2F;localhost:9100&#x2F;metrics  |grep node_exporter_build_info        </span><br></pre></td></tr></table></figure>\n\n<h3 id=\"配置-Prometheus-使用-TLS\"><a href=\"#配置-Prometheus-使用-TLS\" class=\"headerlink\" title=\"配置 Prometheus 使用 TLS\"></a>配置 Prometheus 使用 TLS</h3><p>要修改下配置文件，让 Prometheus 可以抓取 Node Exporter 暴露的 metrics 。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">global:</span><br><span class=\"line\">  scrape_interval:     15s </span><br><span class=\"line\">  evaluation_interval: 15s </span><br><span class=\"line\"></span><br><span class=\"line\">scrape_configs:</span><br><span class=\"line\">  - job_name: &#39;prometheus&#39;</span><br><span class=\"line\">    static_configs:</span><br><span class=\"line\">    - targets: [&#39;localhost:9090&#39;]</span><br><span class=\"line\"></span><br><span class=\"line\">  - job_name: &#39;node_exporter&#39;</span><br><span class=\"line\">    scheme: https</span><br><span class=\"line\">    tls_config:</span><br><span class=\"line\">      ca_file: node_exporter.crt</span><br><span class=\"line\">    static_configs:</span><br><span class=\"line\">    - targets: [&#39;localhost:9100&#39;]</span><br></pre></td></tr></table></figure>\n\n<p>这里额外增加了 <code>scheme: https</code>  表示通过 HTTPS 建立连接，tls_config 中指定了所用的证书文件。完整的配置可以参考 官方文档中对 <a href=\"https://prometheus.io/docs/prometheus/latest/configuration/configuration/#tls_config\">tls_config</a> 的说明 。</p>\n<h3 id=\"配置-Prometheus-使用-Basic-Auth\"><a href=\"#配置-Prometheus-使用-Basic-Auth\" class=\"headerlink\" title=\"配置 Prometheus 使用 Basic Auth\"></a>配置 Prometheus 使用 Basic Auth</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">global:</span><br><span class=\"line\">  scrape_interval:     15s </span><br><span class=\"line\">  evaluation_interval: 15s </span><br><span class=\"line\"></span><br><span class=\"line\">scrape_configs:</span><br><span class=\"line\">  - job_name: &#39;prometheus&#39;</span><br><span class=\"line\">    static_configs:</span><br><span class=\"line\">    - targets: [&#39;localhost:9090&#39;]</span><br><span class=\"line\"></span><br><span class=\"line\">  - job_name: &#39;node_exporter&#39;</span><br><span class=\"line\">    scheme: https</span><br><span class=\"line\">    tls_config:</span><br><span class=\"line\">      ca_file: node_exporter.crt</span><br><span class=\"line\">    basic_auth:</span><br><span class=\"line\">      username: prometheus</span><br><span class=\"line\">      password: moelove.info</span><br><span class=\"line\">    static_configs:</span><br><span class=\"line\">    - targets: [&#39;localhost:9100&#39;]</span><br></pre></td></tr></table></figure>\n\n<p>在生产中使用时，建议更加规范化操作，比如 CA 的选择，密码的管理等，比如 Node Exporter 的 Basic Auth 其实支持配置多个用户名密码的。</p>\n","site":{"data":{}},"excerpt":"","more":"<p>node_exporter是prometheus官方提供的agent，项目被托管在prometheus的账号之下。我们也可以通过官方提供的链接下载最新的版本。在官方的github里面已经提供了非常详细使用说明，我们这里带大家梳理一下</p>\n<h3 id=\"node-exporte基本信息配置\"><a href=\"#node-exporte基本信息配置\" class=\"headerlink\" title=\"node_exporte基本信息配置\"></a>node_exporte基本信息配置</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">-- web.listen-address&#x3D;&quot;:9100&quot;</span><br><span class=\"line\"># 监听的端口，默认是9100，若需要修改则通过此参数</span><br><span class=\"line\"></span><br><span class=\"line\">--web.telemetry-path&#x3D;&quot;&#x2F;metrics&quot;  </span><br><span class=\"line\">#获取metric信息的url，默认是&#x2F;metrics，若需要修改则通过此参数</span><br><span class=\"line\"></span><br><span class=\"line\">--log.level&#x3D;&quot;info&quot; </span><br><span class=\"line\">#设置日志级别</span><br><span class=\"line\"></span><br><span class=\"line\">--log.format&#x3D;&quot;logger:stderr&quot;  </span><br><span class=\"line\">#设置打印日志的格式，若有自动化日志提取工具可以使用这个参数规范日志打印的格式</span><br></pre></td></tr></table></figure>\n\n\n<h3 id=\"通过正则表达式来屏蔽或选择某些监控项\"><a href=\"#通过正则表达式来屏蔽或选择某些监控项\" class=\"headerlink\" title=\"通过正则表达式来屏蔽或选择某些监控项\"></a>通过正则表达式来屏蔽或选择某些监控项</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">--collector.diskstats.ignored-devices&#x3D;&quot;^(ram|loop|fd|(h|s|v|xv)d[a-z]|nvme\\\\d+n\\\\d+p)\\\\d+$&quot;</span><br><span class=\"line\">#通过正则表达式忽略某些磁盘的信息收集</span><br><span class=\"line\"></span><br><span class=\"line\">--collector.filesystem.ignored-mount-points&#x3D;&quot;^&#x2F;(dev|proc|sys|var&#x2F;lib&#x2F;docker&#x2F;.+)($|&#x2F;)&quot;  </span><br><span class=\"line\">#通过正则表达式忽略某些文件系统挂载点的信息收集</span><br><span class=\"line\"></span><br><span class=\"line\">--collector.filesystem.ignored-fs-types&#x3D;&quot;^(autofs|binfmt_misc|bpf|cgroup2?|configfs|debugfs|devpts|devtmpfs|fusectl|hugetlbfs|mqueue|nsfs|overlay|proc|procfs|pstore|rpc_pipefs|securityfs|selinuxfs|squashfs|sysfs|tracefs)$&quot;  </span><br><span class=\"line\">#通过正则表达式忽略某些文件系统类型的信息收集</span><br><span class=\"line\"></span><br><span class=\"line\">--collector.netclass.ignored-devices&#x3D;&quot;^$&quot;  </span><br><span class=\"line\">#通过正则表达式忽略某些网络类的信息收集</span><br><span class=\"line\"></span><br><span class=\"line\">--collector.netdev.ignored-devices&#x3D;&quot;^$&quot;  </span><br><span class=\"line\">#通过正则表达式忽略某些网络设备的信息收集</span><br><span class=\"line\"></span><br><span class=\"line\">  --collector.netstat.fields&#x3D;&quot;^$&quot;</span><br><span class=\"line\"> #通过正则表达式配置需要获取的网络状态信息</span><br><span class=\"line\"> </span><br><span class=\"line\">--collector.vmstat.fields&#x3D;&quot;^(oom_kill|pgpg|pswp|pg.*fault).*&quot; </span><br><span class=\"line\">#通过正则表达式配置vmstat返回信息中需要收集的选项</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">&#96;&#96;&#96;&#96;</span><br><span class=\"line\"></span><br><span class=\"line\">### 添加用户名和密码验证</span><br><span class=\"line\"></span><br><span class=\"line\">我们直接可以使用 htpasswd 来生成 密码(在httpd-tools当中)</span><br></pre></td></tr></table></figure>\n<p>yum install httpd-tools -y</p>\n<p>htpasswd -nBC 12 ‘’ | tr -d ‘:\\n’<br>New password:<br>Re-type new password:<br>$2y$12$WLw2sYa.NYZoBVoCOE84qe3xNm7kbSoKVIBXP.PvqNDna60vnZhEW<br>#这个密码可以用作其他的服务器上，自己输入的密码要记住，<br>#用户名可以任意给一个，配置文件格式是如下，注意username前面有两个空格</p>\n<p>basic_auth_users:</p>\n<h1 id=\"当前设置的用户名为-prometheus-，-可以设置多个\"><a href=\"#当前设置的用户名为-prometheus-，-可以设置多个\" class=\"headerlink\" title=\"当前设置的用户名为 prometheus ， 可以设置多个\"></a>当前设置的用户名为 prometheus ， 可以设置多个</h1><p>  prometheus: $2y$12$WLw2sYa.NYZoBVoCOE84qe3xNm7kbSoKVIBXP.PvqNDna60vnZhEW</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">### TLS的配置</span><br><span class=\"line\">&#96;&#96;&#96;bash</span><br><span class=\"line\"># mkdir -p prometheus-tls</span><br><span class=\"line\"># cd prometheus-tls</span><br><span class=\"line\"># openssl req -new -newkey rsa:2048 -days 365 -nodes -x509 -keyout node_exporter.key -out node_exporter.crt -subj &quot;&#x2F;C&#x3D;CN&#x2F;ST&#x3D;Beijing&#x2F;L&#x3D;Beijing&#x2F;O&#x3D;Moelove.info&#x2F;CN&#x3D;localhost&quot;</span><br><span class=\"line\"></span><br><span class=\"line\"># ls</span><br><span class=\"line\">node_exporter.crt  node_exporter.key</span><br></pre></td></tr></table></figure>\n\n\n<p>我们默认暴露的都是http的请求的，也没有验证，也就是明文传输，很容易存在安全隐患，如果需要对数据加密，我们就要使用参数<code>./node_exporter --web.config=web-config.yml</code>，这个文件的内容如下</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tls_server_config:</span><br><span class=\"line\">  # Certificate and key files for server to use to authenticate to client.</span><br><span class=\"line\">  cert_file: node_exporter.crt   # &lt;filename&gt;</span><br><span class=\"line\">  key_file: node_exporter.key    #&lt;filename&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">  # Server policy for client authentication. Maps to ClientAuth Policies.</span><br><span class=\"line\">  # For more detail on clientAuth options: [ClientAuthType](https:&#x2F;&#x2F;golang.org&#x2F;pkg&#x2F;crypto&#x2F;tls&#x2F;#ClientAuthType)</span><br><span class=\"line\">  [ client_auth_type: &lt;string&gt; | default &#x3D; &quot;NoClientCert&quot; ]</span><br><span class=\"line\"></span><br><span class=\"line\">  # CA certificate for client certificate authentication to the server.</span><br><span class=\"line\">  [ client_ca_file: &lt;filename&gt; ]</span><br><span class=\"line\"></span><br><span class=\"line\">  # Minimum TLS version that is acceptable.</span><br><span class=\"line\">  [ min_version: &lt;string&gt; | default &#x3D; &quot;TLS12&quot; ]</span><br><span class=\"line\"></span><br><span class=\"line\">  # Maximum TLS version that is acceptable.</span><br><span class=\"line\">  [ max_version: &lt;string&gt; | default &#x3D; &quot;TLS13&quot; ]</span><br><span class=\"line\"></span><br><span class=\"line\">  # List of supported cipher suites for TLS versions up to TLS 1.2. If empty,</span><br><span class=\"line\">  # Go default cipher suites are used. Available cipher suites are documented</span><br><span class=\"line\">  # in the go documentation:</span><br><span class=\"line\">  # https:&#x2F;&#x2F;golang.org&#x2F;pkg&#x2F;crypto&#x2F;tls&#x2F;#pkg-constants</span><br><span class=\"line\">  [ cipher_suites:</span><br><span class=\"line\">    [ - &lt;string&gt; ] ]</span><br><span class=\"line\"></span><br><span class=\"line\">  # prefer_server_cipher_suites controls whether the server selects the</span><br><span class=\"line\">  # client&#39;s most preferred ciphersuite, or the server&#39;s most preferred</span><br><span class=\"line\">  # ciphersuite. If true then the server&#39;s preference, as expressed in</span><br><span class=\"line\">  # the order of elements in cipher_suites, is used.</span><br><span class=\"line\">  [ prefer_server_cipher_suites: &lt;bool&gt; | default &#x3D; true ]</span><br><span class=\"line\"></span><br><span class=\"line\">  # Elliptic curves that will be used in an ECDHE handshake, in preference</span><br><span class=\"line\">  # order. Available curves are documented in the go documentation:</span><br><span class=\"line\">  # https:&#x2F;&#x2F;golang.org&#x2F;pkg&#x2F;crypto&#x2F;tls&#x2F;#CurveID</span><br><span class=\"line\">  [ curve_preferences:</span><br><span class=\"line\">    [ - &lt;string&gt; ] ]</span><br><span class=\"line\"></span><br><span class=\"line\">http_server_config:</span><br><span class=\"line\">  # Enable HTTP&#x2F;2 support. Note that HTTP&#x2F;2 is only supported with TLS.</span><br><span class=\"line\">  # This can not be changed on the fly.</span><br><span class=\"line\">  [ http2: &lt;bool&gt; | default &#x3D; true ]</span><br><span class=\"line\"></span><br><span class=\"line\"># Usernames and hashed passwords that have full access to the web</span><br><span class=\"line\"># server via basic authentication. If empty, no basic authentication is</span><br><span class=\"line\"># required. Passwords are hashed with bcrypt.</span><br><span class=\"line\">basic_auth_users:</span><br><span class=\"line\">  [ &lt;string&gt;: &lt;secret&gt; ... ]</span><br></pre></td></tr></table></figure>\n\n\n<p>不能直接 curl 进行请求了，我们可以将证书传递给 curl ，用来验证刚才的配置是否正确</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -s  --cacert node_exporter.crt https:&#x2F;&#x2F;localhost:9100&#x2F;metrics  |grep node_exporter_build_info</span><br></pre></td></tr></table></figure>\n\n<p>当然，除了通过 –cacert 参数将证书传递给 curl 外，也可以通过 -k 参数来忽略证书检查。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -s -k https:&#x2F;&#x2F;localhost:9100&#x2F;metrics  |grep node_exporter_build_info        </span><br></pre></td></tr></table></figure>\n\n<h3 id=\"配置-Prometheus-使用-TLS\"><a href=\"#配置-Prometheus-使用-TLS\" class=\"headerlink\" title=\"配置 Prometheus 使用 TLS\"></a>配置 Prometheus 使用 TLS</h3><p>要修改下配置文件，让 Prometheus 可以抓取 Node Exporter 暴露的 metrics 。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">global:</span><br><span class=\"line\">  scrape_interval:     15s </span><br><span class=\"line\">  evaluation_interval: 15s </span><br><span class=\"line\"></span><br><span class=\"line\">scrape_configs:</span><br><span class=\"line\">  - job_name: &#39;prometheus&#39;</span><br><span class=\"line\">    static_configs:</span><br><span class=\"line\">    - targets: [&#39;localhost:9090&#39;]</span><br><span class=\"line\"></span><br><span class=\"line\">  - job_name: &#39;node_exporter&#39;</span><br><span class=\"line\">    scheme: https</span><br><span class=\"line\">    tls_config:</span><br><span class=\"line\">      ca_file: node_exporter.crt</span><br><span class=\"line\">    static_configs:</span><br><span class=\"line\">    - targets: [&#39;localhost:9100&#39;]</span><br></pre></td></tr></table></figure>\n\n<p>这里额外增加了 <code>scheme: https</code>  表示通过 HTTPS 建立连接，tls_config 中指定了所用的证书文件。完整的配置可以参考 官方文档中对 <a href=\"https://prometheus.io/docs/prometheus/latest/configuration/configuration/#tls_config\">tls_config</a> 的说明 。</p>\n<h3 id=\"配置-Prometheus-使用-Basic-Auth\"><a href=\"#配置-Prometheus-使用-Basic-Auth\" class=\"headerlink\" title=\"配置 Prometheus 使用 Basic Auth\"></a>配置 Prometheus 使用 Basic Auth</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">global:</span><br><span class=\"line\">  scrape_interval:     15s </span><br><span class=\"line\">  evaluation_interval: 15s </span><br><span class=\"line\"></span><br><span class=\"line\">scrape_configs:</span><br><span class=\"line\">  - job_name: &#39;prometheus&#39;</span><br><span class=\"line\">    static_configs:</span><br><span class=\"line\">    - targets: [&#39;localhost:9090&#39;]</span><br><span class=\"line\"></span><br><span class=\"line\">  - job_name: &#39;node_exporter&#39;</span><br><span class=\"line\">    scheme: https</span><br><span class=\"line\">    tls_config:</span><br><span class=\"line\">      ca_file: node_exporter.crt</span><br><span class=\"line\">    basic_auth:</span><br><span class=\"line\">      username: prometheus</span><br><span class=\"line\">      password: moelove.info</span><br><span class=\"line\">    static_configs:</span><br><span class=\"line\">    - targets: [&#39;localhost:9100&#39;]</span><br></pre></td></tr></table></figure>\n\n<p>在生产中使用时，建议更加规范化操作，比如 CA 的选择，密码的管理等，比如 Node Exporter 的 Basic Auth 其实支持配置多个用户名密码的。</p>\n"},{"title":"prometheus清除数据","date":"2021-05-17T10:10:00.000Z","_content":"  \n  \n摘要: prometheus 清除历史数据\n<!-- more -->\n\n\n## 开启管理时间序列的 API \n默认情况下，管理时间序列的 API 是被禁用的\n```\n ./prometheus --storage.tsdb.retention=180d --web.enable-admin-api\n```\n\n## api 使用\n\n### 清理某个key的全部的数据\n```\ncurl -X POST -g 'http://localhost:9090/api/v1/admin/tsdb/delete_series?match[]=up&match[]=mysql_global_status_threads_running{instance=\"test-db13:9104\",job=\"mysql\"}'\n```\n\n### 清理这个key指定时间段的数据 （清理的时间戳区间：1557903714 到 155790395 ）\n```\ncurl -X POST -g 'http://localhost:9090/api/v1/admin/tsdb/delete_series?start=1557903714&end=1557903954&match[]=mysql_global_status_threads_running{instance=\"test-db13:9104\",job=\"mysql\"}'\n```\n\n### 删除某个标签匹配的数据\n```\ncurl -X POST -g 'http://localhost:9090/api/v1/admin/tsdb/delete_series?match[]={instance=\".*\"}'\n```\n\n### 删除某个指标数据\n```\ncurl -X POST -g 'http://localhost:9090/api/v1/admin/tsdb/delete_series?match[]={node_load1=\".*\"}'\n```\n\n### 清理db\n```\ncurl -XPOST http://localhost:9090/api/v1/admin/tsdb/clean_tombstones\n```\n\n### 删除全部数据\n```\ncurl -X POST -g 'http://localhost:9090/api/v1/admin/tsdb/delete_series?match[]={__name__=~\".+\"}'\n```\n\n### 删除某个组下的所有数据\n```\ncurl -X DELETE http://localhost:9090/metrics/job/pushgateway-microservice\n```\n\n","source":"_posts/prometheus/prometheus清除数据.md","raw":"---\ntitle: prometheus清除数据\ndate: 2021-05-17 18:10\ncategories:\n- prometheus\ntags:\n- prome\n---\n  \n  \n摘要: prometheus 清除历史数据\n<!-- more -->\n\n\n## 开启管理时间序列的 API \n默认情况下，管理时间序列的 API 是被禁用的\n```\n ./prometheus --storage.tsdb.retention=180d --web.enable-admin-api\n```\n\n## api 使用\n\n### 清理某个key的全部的数据\n```\ncurl -X POST -g 'http://localhost:9090/api/v1/admin/tsdb/delete_series?match[]=up&match[]=mysql_global_status_threads_running{instance=\"test-db13:9104\",job=\"mysql\"}'\n```\n\n### 清理这个key指定时间段的数据 （清理的时间戳区间：1557903714 到 155790395 ）\n```\ncurl -X POST -g 'http://localhost:9090/api/v1/admin/tsdb/delete_series?start=1557903714&end=1557903954&match[]=mysql_global_status_threads_running{instance=\"test-db13:9104\",job=\"mysql\"}'\n```\n\n### 删除某个标签匹配的数据\n```\ncurl -X POST -g 'http://localhost:9090/api/v1/admin/tsdb/delete_series?match[]={instance=\".*\"}'\n```\n\n### 删除某个指标数据\n```\ncurl -X POST -g 'http://localhost:9090/api/v1/admin/tsdb/delete_series?match[]={node_load1=\".*\"}'\n```\n\n### 清理db\n```\ncurl -XPOST http://localhost:9090/api/v1/admin/tsdb/clean_tombstones\n```\n\n### 删除全部数据\n```\ncurl -X POST -g 'http://localhost:9090/api/v1/admin/tsdb/delete_series?match[]={__name__=~\".+\"}'\n```\n\n### 删除某个组下的所有数据\n```\ncurl -X DELETE http://localhost:9090/metrics/job/pushgateway-microservice\n```\n\n","slug":"prometheus/prometheus清除数据","published":1,"updated":"2021-09-08T09:42:11.656Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cku697a0n006j00uhfhclda8i","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><p>摘要: prometheus 清除历史数据</p>\n<span id=\"more\"></span>\n\n\n<h2 id=\"开启管理时间序列的-API\"><a href=\"#开启管理时间序列的-API\" class=\"headerlink\" title=\"开启管理时间序列的 API\"></a>开启管理时间序列的 API</h2><p>默认情况下，管理时间序列的 API 是被禁用的</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">.&#x2F;prometheus --storage.tsdb.retention&#x3D;180d --web.enable-admin-api</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"api-使用\"><a href=\"#api-使用\" class=\"headerlink\" title=\"api 使用\"></a>api 使用</h2><h3 id=\"清理某个key的全部的数据\"><a href=\"#清理某个key的全部的数据\" class=\"headerlink\" title=\"清理某个key的全部的数据\"></a>清理某个key的全部的数据</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -X POST -g &#39;http:&#x2F;&#x2F;localhost:9090&#x2F;api&#x2F;v1&#x2F;admin&#x2F;tsdb&#x2F;delete_series?match[]&#x3D;up&amp;match[]&#x3D;mysql_global_status_threads_running&#123;instance&#x3D;&quot;test-db13:9104&quot;,job&#x3D;&quot;mysql&quot;&#125;&#39;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"清理这个key指定时间段的数据-（清理的时间戳区间：1557903714-到-155790395-）\"><a href=\"#清理这个key指定时间段的数据-（清理的时间戳区间：1557903714-到-155790395-）\" class=\"headerlink\" title=\"清理这个key指定时间段的数据 （清理的时间戳区间：1557903714 到 155790395 ）\"></a>清理这个key指定时间段的数据 （清理的时间戳区间：1557903714 到 155790395 ）</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -X POST -g &#39;http:&#x2F;&#x2F;localhost:9090&#x2F;api&#x2F;v1&#x2F;admin&#x2F;tsdb&#x2F;delete_series?start&#x3D;1557903714&amp;end&#x3D;1557903954&amp;match[]&#x3D;mysql_global_status_threads_running&#123;instance&#x3D;&quot;test-db13:9104&quot;,job&#x3D;&quot;mysql&quot;&#125;&#39;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"删除某个标签匹配的数据\"><a href=\"#删除某个标签匹配的数据\" class=\"headerlink\" title=\"删除某个标签匹配的数据\"></a>删除某个标签匹配的数据</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -X POST -g &#39;http:&#x2F;&#x2F;localhost:9090&#x2F;api&#x2F;v1&#x2F;admin&#x2F;tsdb&#x2F;delete_series?match[]&#x3D;&#123;instance&#x3D;&quot;.*&quot;&#125;&#39;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"删除某个指标数据\"><a href=\"#删除某个指标数据\" class=\"headerlink\" title=\"删除某个指标数据\"></a>删除某个指标数据</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -X POST -g &#39;http:&#x2F;&#x2F;localhost:9090&#x2F;api&#x2F;v1&#x2F;admin&#x2F;tsdb&#x2F;delete_series?match[]&#x3D;&#123;node_load1&#x3D;&quot;.*&quot;&#125;&#39;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"清理db\"><a href=\"#清理db\" class=\"headerlink\" title=\"清理db\"></a>清理db</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -XPOST http:&#x2F;&#x2F;localhost:9090&#x2F;api&#x2F;v1&#x2F;admin&#x2F;tsdb&#x2F;clean_tombstones</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"删除全部数据\"><a href=\"#删除全部数据\" class=\"headerlink\" title=\"删除全部数据\"></a>删除全部数据</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -X POST -g &#39;http:&#x2F;&#x2F;localhost:9090&#x2F;api&#x2F;v1&#x2F;admin&#x2F;tsdb&#x2F;delete_series?match[]&#x3D;&#123;__name__&#x3D;~&quot;.+&quot;&#125;&#39;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"删除某个组下的所有数据\"><a href=\"#删除某个组下的所有数据\" class=\"headerlink\" title=\"删除某个组下的所有数据\"></a>删除某个组下的所有数据</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -X DELETE http:&#x2F;&#x2F;localhost:9090&#x2F;metrics&#x2F;job&#x2F;pushgateway-microservice</span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"<p>摘要: prometheus 清除历史数据</p>","more":"<h2 id=\"开启管理时间序列的-API\"><a href=\"#开启管理时间序列的-API\" class=\"headerlink\" title=\"开启管理时间序列的 API\"></a>开启管理时间序列的 API</h2><p>默认情况下，管理时间序列的 API 是被禁用的</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">.&#x2F;prometheus --storage.tsdb.retention&#x3D;180d --web.enable-admin-api</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"api-使用\"><a href=\"#api-使用\" class=\"headerlink\" title=\"api 使用\"></a>api 使用</h2><h3 id=\"清理某个key的全部的数据\"><a href=\"#清理某个key的全部的数据\" class=\"headerlink\" title=\"清理某个key的全部的数据\"></a>清理某个key的全部的数据</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -X POST -g &#39;http:&#x2F;&#x2F;localhost:9090&#x2F;api&#x2F;v1&#x2F;admin&#x2F;tsdb&#x2F;delete_series?match[]&#x3D;up&amp;match[]&#x3D;mysql_global_status_threads_running&#123;instance&#x3D;&quot;test-db13:9104&quot;,job&#x3D;&quot;mysql&quot;&#125;&#39;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"清理这个key指定时间段的数据-（清理的时间戳区间：1557903714-到-155790395-）\"><a href=\"#清理这个key指定时间段的数据-（清理的时间戳区间：1557903714-到-155790395-）\" class=\"headerlink\" title=\"清理这个key指定时间段的数据 （清理的时间戳区间：1557903714 到 155790395 ）\"></a>清理这个key指定时间段的数据 （清理的时间戳区间：1557903714 到 155790395 ）</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -X POST -g &#39;http:&#x2F;&#x2F;localhost:9090&#x2F;api&#x2F;v1&#x2F;admin&#x2F;tsdb&#x2F;delete_series?start&#x3D;1557903714&amp;end&#x3D;1557903954&amp;match[]&#x3D;mysql_global_status_threads_running&#123;instance&#x3D;&quot;test-db13:9104&quot;,job&#x3D;&quot;mysql&quot;&#125;&#39;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"删除某个标签匹配的数据\"><a href=\"#删除某个标签匹配的数据\" class=\"headerlink\" title=\"删除某个标签匹配的数据\"></a>删除某个标签匹配的数据</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -X POST -g &#39;http:&#x2F;&#x2F;localhost:9090&#x2F;api&#x2F;v1&#x2F;admin&#x2F;tsdb&#x2F;delete_series?match[]&#x3D;&#123;instance&#x3D;&quot;.*&quot;&#125;&#39;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"删除某个指标数据\"><a href=\"#删除某个指标数据\" class=\"headerlink\" title=\"删除某个指标数据\"></a>删除某个指标数据</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -X POST -g &#39;http:&#x2F;&#x2F;localhost:9090&#x2F;api&#x2F;v1&#x2F;admin&#x2F;tsdb&#x2F;delete_series?match[]&#x3D;&#123;node_load1&#x3D;&quot;.*&quot;&#125;&#39;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"清理db\"><a href=\"#清理db\" class=\"headerlink\" title=\"清理db\"></a>清理db</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -XPOST http:&#x2F;&#x2F;localhost:9090&#x2F;api&#x2F;v1&#x2F;admin&#x2F;tsdb&#x2F;clean_tombstones</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"删除全部数据\"><a href=\"#删除全部数据\" class=\"headerlink\" title=\"删除全部数据\"></a>删除全部数据</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -X POST -g &#39;http:&#x2F;&#x2F;localhost:9090&#x2F;api&#x2F;v1&#x2F;admin&#x2F;tsdb&#x2F;delete_series?match[]&#x3D;&#123;__name__&#x3D;~&quot;.+&quot;&#125;&#39;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"删除某个组下的所有数据\"><a href=\"#删除某个组下的所有数据\" class=\"headerlink\" title=\"删除某个组下的所有数据\"></a>删除某个组下的所有数据</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -X DELETE http:&#x2F;&#x2F;localhost:9090&#x2F;metrics&#x2F;job&#x2F;pushgateway-microservice</span><br></pre></td></tr></table></figure>"},{"title":"prometheus使用docker-compose安装","date":"2021-05-17T08:59:00.000Z","_content":"  \n  \n摘要: prometheus使用docker-compose \n<!-- more -->\n\n\n## 目录创建\n```\nmkdir -p /opt/prom/{prometheus,alertmanager,black-exporter,grafana}\n```\n\n## 创建docker-compose文件\ncd /opt/prom/\nvim docker-compose.yaml\n```\nversion: '3.7'\n\nservices:\n  node-exporter:\n    image: prom/node-exporter:latest\n    ports:\n      - \"9100:9100\"\n    networks:\n      - prom\n\n#  dingtalk:\n#    image: timonwong/prometheus-webhook-dingtalk:latest\n#    volumes:\n#      - type: bind\n#        source: ./alertmanager/config.yml\n#        target: /etc/prometheus-webhook-dingtalk/config.yml\n#        read_only: true\n#    ports:\n#      - \"8060:8060\"\n#    networks:\n#      - prom\n\n  alertmanager:\n#    depends_on:\n#      - dingtalk\n    image: prom/alertmanager:latest\n    environment:\n      - TZ=Asia/Shanghai\n    volumes:\n      - type: bind\n        source: ./alertmanager/alertmanager.yml\n        target: /etc/alertmanager/alertmanager.yml\n        read_only: true\n\t\tcommand: \"--config.file=/etc/alertmanager/alertmanager.yml --web.external-url=http://10.200.76.70:9093\"\n    ports:\n      - \"9093:9093\"\n      - \"9094:9094\"\n    networks:\n      - prom\n\n  prometheus:\n    depends_on:\n      - alertmanager\n    image: prom/prometheus:latest\n    environment:\n      - TZ=Asia/Shanghai\n    volumes:\n      - type: bind\n        source: ./prometheus/prometheus.yml\n        target: /etc/prometheus/prometheus.yml\n        read_only: true\n #     - type: bind\n #       source: ./prometheus/rules/alert-rules.yml\n #       target: /etc/prometheus/alert-rules.yml\n #       read_only: true\n      - type: volume\n        source: prometheus\n        target: /prometheus\n      - \"/opt/prom/prometheus/rules:/etc/prometheus/rules\"\n      - \"/opt/prom/prometheus/targets:/etc/prometheus/targets\"\n    command: \"--config.file=/etc/prometheus/prometheus.yml --storage.tsdb.path=/prometheus --storage.tsdb.retention=180d --web.enable-admin-api --web.external-url=http://10.200.76.70:9090\"\n    ports:\n      - \"9090:9090\"\n    networks:\n      - prom\n\n  grafana:\n    depends_on:\n      - prometheus\n    image: grafana/grafana:latest\n    volumes:\n      - type: volume\n        source: grafana\n        target: /var/lib/grafana\n    ports:\n      - \"3000:3000\"\n    networks:\n      - prom\n\n\n  black-exporter:\n    environment:\n      - TZ=Asia/Shanghai\n    image: prom/blackbox-exporter:latest\n    volumes:\n      - /opt/prom/black-exporter/blackbox.yml:/config/blackbox.yml\n    command:\n      - '--config.file=/config/blackbox.yml'\n    ports:\n      - '9115:9115'\n    networks:\n      - prom\n\nvolumes:\n  prometheus:\n    driver: local\n    driver_opts:\n      type: none\n      o: bind\n      device: /opt/prom/prometheus/data\n  grafana:\n    driver: local\n    driver_opts:\n      type: none\n      o: bind\n      device: /opt/prom/grafana\n      \nnetworks:\n  prom:\n    driver: bridge\n```\n\n## prometheus 配置文件\n### 初始化目录\n```\nmkdir -p data rules targets\n```\n\n### 创建prometheus.yml配置文件\ncd prometheus\nvim prometheus.yml\n```\nglobal:\n  scrape_interval:     15s\n  evaluation_interval: 15s\n\nalerting:\n  alertmanagers:\n  - static_configs:\n    - targets:\n      - alertmanager:9093\n\nrule_files:\n  - \"/etc/prometheus/rules/*.yml\"\n  #- \"*rules.yml\"\n  \nscrape_configs:\n  - job_name: 'node-target'\n    file_sd_configs:\n    - files:\n      - \"/etc/prometheus/targets/node/xwms/target.yml\"\n      - \"/etc/prometheus/targets/node/jingtian/target.yml\"\n      - \"/etc/prometheus/targets/node/zop/target.yml\"\n      - \"/etc/prometheus/targets/node/zms/target.yml\"\n      - \"/etc/prometheus/targets/node/yunpei/target.yml\"\n      - \"/etc/prometheus/targets/node/oa/target.yml\"\n      - \"/etc/prometheus/targets/node/dba/target.yml\"\n      - \"/etc/prometheus/targets/node/bms/target.yml\"\n      - \"/etc/prometheus/targets/node/bigdata/target.yml\"\n      refresh_interval: 10s \n\n  - job_name: 'prometheus'\n    static_configs:\n    - targets: ['prometheus:9090']\n\n  - job_name: 'node'\n    static_configs:\n    - targets: ['node-exporter:9100']\n\n  - job_name: 'alertmanager'\n    static_configs:\n    - targets: ['alertmanager:9093']\n\n  - job_name: 'jmx'\n    file_sd_configs:\n    - files:\n      - \"/etc/prometheus/targets/jmx/target.yml\"\n      refresh_interval: 3m\n\n\n  - job_name: 'prjectVer'\n    scrape_interval: 120s\n    metrics_path: '/actuator1/project/version'\n    file_sd_configs:\n    - files:\n      - \"/etc/prometheus/targets/prjectVer/target.yml\"\n      refresh_interval: 1m\n\n  - job_name: \"Website-monitor\"\n    scrape_interval: 60s\n    metrics_path: /probe\n    params:\n      module: [http_2xx]\n    file_sd_configs:\n    - files:\n      - \"/etc/prometheus/targets/website/target.yml\"\n      refresh_interval: 3m\n\n    relabel_configs:\n      - source_labels: [__address__]\n        target_label: __param_target\n      - source_labels: [__param_target]\n        target_label: instance\n      - target_label: __address__\n        replacement: 10.200.76.70:9115\n```\n\n### 添加ruls\n```\nhttps://awesome-prometheus-alerts.grep.to/rules\n```\n\n\ncd rules\n\n#### CPU\nvim cpu.yml\n```\ngroups:\n  - name: cpu-alert\n    rules:\n    - alert: NodeCpuHigh\n      expr: (1 - avg by (instance) (irate(node_cpu_seconds_total{job=\"node-target\",mode=\"idle\"}[5m]))) * 100 > 80\n      for: 5m\n      labels:\n        severity: warning\n        instance: \"{{ $labels.instance }}\"\n      annotations:\n        summary: \"instance: {{ $labels.instance }} cpu使用率过高\"\n        description: \"CPU 使用率超过 80%\"\n        value: \"{{ $value }}\"\n\n    - alert: NodeCpuIowaitHigh\n      expr: avg by (instance) (irate(node_cpu_seconds_total{job=\"node-target\",mode=\"iowait\"}[5m])) * 100 > 50\n      for: 5m\n      labels:\n        severity: warning\n        instance: \"{{ $labels.instance }}\"\n      annotations:\n        summary: \"instance: {{ $labels.instance }} cpu iowait 使用率过高\"\n        description: \"CPU iowait 使用率超过 50%\"\n        value: \"{{ $value }}\"\n\n    - alert: NodeLoad5High\n      expr: node_load5 > (count by (instance) (node_cpu_seconds_total{job=\"node-target\",mode='system'})) * 1.2\n      for: 5m\n      labels:\n        severity: warning\n        instance: \"{{ $labels.instance }}\"\n      annotations:\n        summary: \"instance: {{ $labels.instance }} load(5m) 过高\"\n        description: \"Load(5m) 过高，超出cpu核数 1.2倍\"\n        value: \"{{ $value }}\"\n```\n\n#### disk\nvim disk.yml\n```\ngroups:\n  - name: node-alert\n    rules:\n    - alert: NodeDiskHigh\n      expr: ceil(((node_filesystem_size_bytes {device=~\"(/dev/.*|/)\",fstype=~\"(ext4|xfs)\"} - node_filesystem_free_bytes {device=~\"(/dev/.*|/)\",fstype=~\"(ext4|xfs)\"}) / node_filesystem_size_bytes {device=~\"(/dev/.*|/)\",fstype=~\"(ext4|xfs)\"} ) * 100  > 80 )\n      for: 10m\n      labels:\n        severity: warning\n        instance: \"{{ $labels.instance }}\"\n      annotations:\n        summary: \"instance: {{ $labels.instance }} disk( {{ $labels.mountpoint }} 分区) 使用率过高\"\n        description: \"Disk( {{ $labels.mountpoint }} 分区) 使用率超过 80%\"\n        value: \"{{ $value }}\"\n```\n\n#### mem\nvim mem.yml\n```\ngroups:\n  - name: memory-alert\n    rules:\n    - alert: NodeMemoryHigh\n      expr: (1 - node_memory_MemAvailable_bytes{job=\"node\"} / node_memory_MemTotal_bytes{job=\"node\"}) * 100 > 90\n      for: 5m\n      labels:\n        severity: warning\n        instance: \"{{ $labels.instance }}\"\n      annotations:\n        summary: \"instance: {{ $labels.instance }} memory 使用率过高\"\n        description: \"Memory 使用率超过 90%\"\n        value: \"{{ $value }}\"\n```\n\n#### node\nvim node.yml\n```\ngroups:\n  - name: node-alert\n    rules:\n    - alert: NodeDown5m\n      expr: up{job=\"node\"} == 0\n      for: 5m\n      labels:\n        severity: critical\n        instance: \"{{ $labels.instance }}\"\n      annotations:\n        summary: \"instance: {{ $labels.instance }} down\"\n        description: \"Instance: {{ $labels.instance }} 已经宕机 5分钟\"\n        value: \"{{ $value }}\"\n    - alert: NodeDown30m\n      expr: up{job=\"node\"} == 0\n      for: 30m\n      labels:\n        severity: critical\n        instance: \"{{ $labels.instance }}\"\n      annotations:\n        summary: \"instance: {{ $labels.instance }} down\"\n        description: \"Instance: {{ $labels.instance }} 已经宕机 30分钟\"\n        value: \"{{ $value }}\"\n```\n\n### 添加 targets\n\n#### 创建目录\n```\nmkdir jmx jvm node prjectVer website\n```\n\n#### jmx 配置\ncd jmx\nvim target.yml\n```\n# edibz\n- targets: ['47.112.97.170:20101']\n  labels: {cluster: 'wms',type: 'jmx',project: 'edibz',env: 'prod',job: 'edibz10401',export: 'jmx',ip: '47.112.97.170'}\n- targets: ['47.112.97.170:20102']\n  labels: {cluster: 'wms',type: 'jmx',project: 'edibz',env: 'prod',job: 'edibz10402',export: 'jmx',ip: '47.112.97.170'}\n\n\n# ediqm\n- targets: ['47.112.125.246:20201']\n  labels: {cluster: 'wms',type: 'jmx',project: 'ediqm',env: 'prod',job: 'ediqm10200',export: 'jmx',ip: '47.112.125.246'}\n- targets: ['47.112.125.246:20202']\n  labels: {cluster: 'wms',type: 'jmx',project: 'ediqm',env: 'prod',job: 'ediqm10201',export: 'jmx',ip: '47.112.125.246'}\n- targets: ['47.112.118.67:20203']\n  labels: {cluster: 'wms',type: 'jmx',project: 'ediqm',env: 'prod',job: 'ediqm10202',export: 'jmx',ip: '47.112.118.67'}\n- targets: ['47.112.118.67:20204']\n  labels: {cluster: 'wms',type: 'jmx',project: 'ediqm',env: 'prod',job: 'ediqm10203',export: 'jmx',ip: '47.112.118.67'}\n\n\n# wms\n- targets: ['47.112.98.225:20001']\n  labels: {cluster: 'wms',type: 'jmx',project: 'xwms',env: 'prod',job: 'xwms10000',export: 'jmx',ip: '47.112.98.225'}\n- targets: ['47.112.119.2:20002']\n  labels: {cluster: 'wms',type: 'jmx',project: 'xwms',env: 'prod',job: 'xwms10002',export: 'jmx',ip: '47.112.119.2'}\n- targets: ['47.112.115.7:20003']\n  labels: {cluster: 'wms',type: 'jmx',project: 'xwms',env: 'prod',job: 'xwms10003',export: 'jmx',ip: '47.112.115.7'}\n- targets: ['47.112.125.15:20004']\n  labels: {cluster: 'wms',type: 'jmx',project: 'xwms',env: 'prod',job: 'xwms10004',export: 'jmx',ip: '47.112.125.15'}\n#- targets: ['47.112.169.38:20005']\n#  labels: {cluster: 'wms',type: 'jmx',project: 'xwms',env: 'prod',job: 'xwms10005',export: 'jmx',ip: '47.112.169.38'}\n```\n\n#### node 配置文件\n```\nmkdir bigdata  bms  dba  jingtian  oa  xwms  yunpei  zms  zop\n```\ncd xwms\n```\n- targets: ['47.107.233.112:6301']\n  labels: {\"project\": \"xwms\",\"env\": \"prod\",\"hostname\": \"ali02-prod-wms-cluster-nginx-api-01\",\"ip\": \"47.107.233.112\"}\n- targets: ['47.112.114.10:6301']\n  labels: {\"project\": \"xwms\",\"env\": \"prod\",\"hostname\": \"ali02-prod-wms-cluster-nginx-web-01\",\"ip\": \"47.112.114.10\"}\n- targets: ['47.112.98.225:6301']\n  labels: {\"project\": \"xwms\",\"env\": \"prod\",\"hostname\": \"ali02-prod-wms-cluster-wms-01\",\"ip\": \"47.112.98.225\"}\n- targets: ['47.112.119.2:6301']\n  labels: {\"project\": \"xwms\",\"env\": \"prod\",\"hostname\": \"ali02-prod-wms-cluster-wms-02\",\"ip\": \"47.112.119.2\"}\n- targets: ['47.112.115.7:6301']\n  labels: {\"project\": \"xwms\",\"env\": \"prod\",\"hostname\": \"ali02-prod-wms-cluster-wms-03\",\"ip\": \"47.112.115.7\"}\n- targets: ['47.112.125.15:6301']\n  labels: {\"project\": \"xwms\",\"env\": \"prod\",\"hostname\": \"ali02-prod-wms-cluster-wms-04\",\"ip\": \"47.112.125.15\"}\n- targets: ['47.112.125.246:6301']\n  labels: {\"project\": \"xwms\",\"env\": \"prod\",\"hostname\": \"ali02-prod-wms-cluster-qm-01\",\"ip\": \"47.112.125.246\"}\n- targets: ['47.112.118.67:6301']\n  labels: {\"project\": \"xwms\",\"env\": \"prod\",\"hostname\": \"ali02-prod-wms-cluster-qm-02\",\"ip\": \"47.112.118.67\"}\n- targets: ['47.112.97.170:6301']\n  labels: {\"project\": \"xwms\",\"env\": \"prod\",\"hostname\": \"ali02-prod-wms-cluster-bz-01\",\"ip\": \"47.112.97.170\"}\n- targets: ['47.112.138.225:6301']\n  labels: {\"project\": \"xwms\",\"env\": \"prod\",\"hostname\": \"ali02-prod-wms-cluster-express-01\",\"ip\": \"47.112.138.225\"}\n- targets: ['47.112.116.45:6301']\n  labels: {\"project\": \"xwms\",\"env\": \"prod\",\"hostname\": \"ali02-prod-wms-cluster-express-02\",\"ip\": \"47.112.116.45\"}\n- targets: ['47.112.125.154:6301']\n  labels: {\"project\": \"xwms\",\"env\": \"prod\",\"hostname\": \"ali02-prod-wms-cluster-id-01\",\"ip\": \"47.112.125.154\"}\n- targets: ['47.112.123.210:6301']\n  labels: {\"project\": \"xwms\",\"env\": \"prod\",\"hostname\": \"ali02-prod-wms-cluster-schedule-01\",\"ip\": \"47.112.123.210\"}\n- targets: ['47.112.106.181:6301']\n  labels: {\"project\": \"xwms\",\"env\": \"prod\",\"hostname\": \"ali02-prod-wms-cluster-schedule-02\",\"ip\": \"47.112.106.181\"}\n- targets: ['120.79.163.136:6301']\n  labels: {\"project\": \"xwms\",\"env\": \"prod\",\"hostname\": \"ali02-prod-wms-cluster-schedule-03\",\"ip\": \"120.79.163.136\"}\n- targets: ['47.112.153.226:6301']\n  labels: {\"project\": \"xwms\",\"env\": \"prod\",\"hostname\": \"ali02-prod-wms-web-pre-01\",\"ip\": \"47.112.153.226\"}\n- targets: ['47.112.119.25:6301']\n  labels: {\"project\": \"xwms\",\"env\": \"prod\",\"hostname\": \"ali02-prod-wms-api-pre-01\",\"ip\": \"47.112.119.25\"}\n- targets: ['47.112.147.64:6301']\n  labels: {\"project\": \"xwms\",\"env\": \"prod\",\"hostname\": \"ali02-prod-wms-web-pre-02\",\"ip\": \"47.112.147.64\"}\n- targets: ['47.112.117.33:6301']\n  labels: {\"project\": \"xwms\",\"env\": \"prod\",\"hostname\": \"ali02-prod-wms-api-pre-02\",\"ip\": \"47.112.117.33\"}\n- targets: ['47.112.169.38:6301']\n  labels: {\"project\": \"xwms\",\"env\": \"prod\",\"hostname\": \"ali02-prod-wms-web-pre-03\",\"ip\": \"47.112.169.38\"}\n- targets: ['120.77.181.215:6301']\n  labels: {\"project\": \"xwms\",\"env\": \"prod\",\"hostname\": \"ali02-prod-wms-api-pre-03\",\"ip\": \"120.77.181.215\"}\n```\n\n\n#### targets 添加脚本\nvim add.sh\n```\n#!/bin/bash\nenv=\"prod\"\nproject=\"bigdata\"\n\ncat /dev/null > target.yml\nwhile read line;\ndo\nif [[ $line =~ ^# ]];then\n  continue\nfi\n  tip=`echo $line | cut -f 1 -d \" \"`\n  thost=`echo $line | cut -f 2 -d \" \"`\n  echo $tip .. $thost\nif  [ ! -n \"$tip\" ] ;then\n  echo \"you have not input a word!\"\n  continue\nfi\ncat >>target.yml<<-EOF\n- targets: ['${tip}:6301']\n  labels: {\"project\": \"${project}\",\"env\": \"${env}\",\"hostname\": \"${thost}\",\"ip\": \"${tip}\"}\n\nEOF\ndone<hostname\n```\n\n\nvim hostname\n```\n172.16.104.200  cdh.ops.com\n172.16.104.201  cdh01.ops.com\n172.16.104.202  cdh02.ops.com\n172.16.104.203  cdh03.ops.com\n172.16.104.204  cdh04.ops.com\n172.16.104.205  cdh05.ops.com\n172.16.104.206  cdh06.ops.com\n172.16.104.207  cdh07.ops.com\n172.16.104.208  cdh08.ops.com\n172.16.104.209  cdh09.ops.com\n47.115.21.93    ali02-prod-bi-box-01.ops.com\n47.115.17.67    ali02-prod-bi-box-02.ops.com\n#172.16.105.116  hz01-prod-bi-haizao-01.ops.com\n#172.16.105.119  hz01-prod-bi-haizao-02.ops.com\n```\n\n\n### 动态更新prometheus的配置项\n\n动态更新Prometheus的配置，即热更新加载，一共有两种方式：\n\n1）向prometheus进程发送SIGHUP信号\n\n2）curl -X POST http://localdns:9090/-/reload ","source":"_posts/prometheus/prom安装.md","raw":"---\ntitle: prometheus使用docker-compose安装\ndate: 2021-05-17 16:59\ncategories:\n- prometheus\ntags:\n- prome\n---\n  \n  \n摘要: prometheus使用docker-compose \n<!-- more -->\n\n\n## 目录创建\n```\nmkdir -p /opt/prom/{prometheus,alertmanager,black-exporter,grafana}\n```\n\n## 创建docker-compose文件\ncd /opt/prom/\nvim docker-compose.yaml\n```\nversion: '3.7'\n\nservices:\n  node-exporter:\n    image: prom/node-exporter:latest\n    ports:\n      - \"9100:9100\"\n    networks:\n      - prom\n\n#  dingtalk:\n#    image: timonwong/prometheus-webhook-dingtalk:latest\n#    volumes:\n#      - type: bind\n#        source: ./alertmanager/config.yml\n#        target: /etc/prometheus-webhook-dingtalk/config.yml\n#        read_only: true\n#    ports:\n#      - \"8060:8060\"\n#    networks:\n#      - prom\n\n  alertmanager:\n#    depends_on:\n#      - dingtalk\n    image: prom/alertmanager:latest\n    environment:\n      - TZ=Asia/Shanghai\n    volumes:\n      - type: bind\n        source: ./alertmanager/alertmanager.yml\n        target: /etc/alertmanager/alertmanager.yml\n        read_only: true\n\t\tcommand: \"--config.file=/etc/alertmanager/alertmanager.yml --web.external-url=http://10.200.76.70:9093\"\n    ports:\n      - \"9093:9093\"\n      - \"9094:9094\"\n    networks:\n      - prom\n\n  prometheus:\n    depends_on:\n      - alertmanager\n    image: prom/prometheus:latest\n    environment:\n      - TZ=Asia/Shanghai\n    volumes:\n      - type: bind\n        source: ./prometheus/prometheus.yml\n        target: /etc/prometheus/prometheus.yml\n        read_only: true\n #     - type: bind\n #       source: ./prometheus/rules/alert-rules.yml\n #       target: /etc/prometheus/alert-rules.yml\n #       read_only: true\n      - type: volume\n        source: prometheus\n        target: /prometheus\n      - \"/opt/prom/prometheus/rules:/etc/prometheus/rules\"\n      - \"/opt/prom/prometheus/targets:/etc/prometheus/targets\"\n    command: \"--config.file=/etc/prometheus/prometheus.yml --storage.tsdb.path=/prometheus --storage.tsdb.retention=180d --web.enable-admin-api --web.external-url=http://10.200.76.70:9090\"\n    ports:\n      - \"9090:9090\"\n    networks:\n      - prom\n\n  grafana:\n    depends_on:\n      - prometheus\n    image: grafana/grafana:latest\n    volumes:\n      - type: volume\n        source: grafana\n        target: /var/lib/grafana\n    ports:\n      - \"3000:3000\"\n    networks:\n      - prom\n\n\n  black-exporter:\n    environment:\n      - TZ=Asia/Shanghai\n    image: prom/blackbox-exporter:latest\n    volumes:\n      - /opt/prom/black-exporter/blackbox.yml:/config/blackbox.yml\n    command:\n      - '--config.file=/config/blackbox.yml'\n    ports:\n      - '9115:9115'\n    networks:\n      - prom\n\nvolumes:\n  prometheus:\n    driver: local\n    driver_opts:\n      type: none\n      o: bind\n      device: /opt/prom/prometheus/data\n  grafana:\n    driver: local\n    driver_opts:\n      type: none\n      o: bind\n      device: /opt/prom/grafana\n      \nnetworks:\n  prom:\n    driver: bridge\n```\n\n## prometheus 配置文件\n### 初始化目录\n```\nmkdir -p data rules targets\n```\n\n### 创建prometheus.yml配置文件\ncd prometheus\nvim prometheus.yml\n```\nglobal:\n  scrape_interval:     15s\n  evaluation_interval: 15s\n\nalerting:\n  alertmanagers:\n  - static_configs:\n    - targets:\n      - alertmanager:9093\n\nrule_files:\n  - \"/etc/prometheus/rules/*.yml\"\n  #- \"*rules.yml\"\n  \nscrape_configs:\n  - job_name: 'node-target'\n    file_sd_configs:\n    - files:\n      - \"/etc/prometheus/targets/node/xwms/target.yml\"\n      - \"/etc/prometheus/targets/node/jingtian/target.yml\"\n      - \"/etc/prometheus/targets/node/zop/target.yml\"\n      - \"/etc/prometheus/targets/node/zms/target.yml\"\n      - \"/etc/prometheus/targets/node/yunpei/target.yml\"\n      - \"/etc/prometheus/targets/node/oa/target.yml\"\n      - \"/etc/prometheus/targets/node/dba/target.yml\"\n      - \"/etc/prometheus/targets/node/bms/target.yml\"\n      - \"/etc/prometheus/targets/node/bigdata/target.yml\"\n      refresh_interval: 10s \n\n  - job_name: 'prometheus'\n    static_configs:\n    - targets: ['prometheus:9090']\n\n  - job_name: 'node'\n    static_configs:\n    - targets: ['node-exporter:9100']\n\n  - job_name: 'alertmanager'\n    static_configs:\n    - targets: ['alertmanager:9093']\n\n  - job_name: 'jmx'\n    file_sd_configs:\n    - files:\n      - \"/etc/prometheus/targets/jmx/target.yml\"\n      refresh_interval: 3m\n\n\n  - job_name: 'prjectVer'\n    scrape_interval: 120s\n    metrics_path: '/actuator1/project/version'\n    file_sd_configs:\n    - files:\n      - \"/etc/prometheus/targets/prjectVer/target.yml\"\n      refresh_interval: 1m\n\n  - job_name: \"Website-monitor\"\n    scrape_interval: 60s\n    metrics_path: /probe\n    params:\n      module: [http_2xx]\n    file_sd_configs:\n    - files:\n      - \"/etc/prometheus/targets/website/target.yml\"\n      refresh_interval: 3m\n\n    relabel_configs:\n      - source_labels: [__address__]\n        target_label: __param_target\n      - source_labels: [__param_target]\n        target_label: instance\n      - target_label: __address__\n        replacement: 10.200.76.70:9115\n```\n\n### 添加ruls\n```\nhttps://awesome-prometheus-alerts.grep.to/rules\n```\n\n\ncd rules\n\n#### CPU\nvim cpu.yml\n```\ngroups:\n  - name: cpu-alert\n    rules:\n    - alert: NodeCpuHigh\n      expr: (1 - avg by (instance) (irate(node_cpu_seconds_total{job=\"node-target\",mode=\"idle\"}[5m]))) * 100 > 80\n      for: 5m\n      labels:\n        severity: warning\n        instance: \"{{ $labels.instance }}\"\n      annotations:\n        summary: \"instance: {{ $labels.instance }} cpu使用率过高\"\n        description: \"CPU 使用率超过 80%\"\n        value: \"{{ $value }}\"\n\n    - alert: NodeCpuIowaitHigh\n      expr: avg by (instance) (irate(node_cpu_seconds_total{job=\"node-target\",mode=\"iowait\"}[5m])) * 100 > 50\n      for: 5m\n      labels:\n        severity: warning\n        instance: \"{{ $labels.instance }}\"\n      annotations:\n        summary: \"instance: {{ $labels.instance }} cpu iowait 使用率过高\"\n        description: \"CPU iowait 使用率超过 50%\"\n        value: \"{{ $value }}\"\n\n    - alert: NodeLoad5High\n      expr: node_load5 > (count by (instance) (node_cpu_seconds_total{job=\"node-target\",mode='system'})) * 1.2\n      for: 5m\n      labels:\n        severity: warning\n        instance: \"{{ $labels.instance }}\"\n      annotations:\n        summary: \"instance: {{ $labels.instance }} load(5m) 过高\"\n        description: \"Load(5m) 过高，超出cpu核数 1.2倍\"\n        value: \"{{ $value }}\"\n```\n\n#### disk\nvim disk.yml\n```\ngroups:\n  - name: node-alert\n    rules:\n    - alert: NodeDiskHigh\n      expr: ceil(((node_filesystem_size_bytes {device=~\"(/dev/.*|/)\",fstype=~\"(ext4|xfs)\"} - node_filesystem_free_bytes {device=~\"(/dev/.*|/)\",fstype=~\"(ext4|xfs)\"}) / node_filesystem_size_bytes {device=~\"(/dev/.*|/)\",fstype=~\"(ext4|xfs)\"} ) * 100  > 80 )\n      for: 10m\n      labels:\n        severity: warning\n        instance: \"{{ $labels.instance }}\"\n      annotations:\n        summary: \"instance: {{ $labels.instance }} disk( {{ $labels.mountpoint }} 分区) 使用率过高\"\n        description: \"Disk( {{ $labels.mountpoint }} 分区) 使用率超过 80%\"\n        value: \"{{ $value }}\"\n```\n\n#### mem\nvim mem.yml\n```\ngroups:\n  - name: memory-alert\n    rules:\n    - alert: NodeMemoryHigh\n      expr: (1 - node_memory_MemAvailable_bytes{job=\"node\"} / node_memory_MemTotal_bytes{job=\"node\"}) * 100 > 90\n      for: 5m\n      labels:\n        severity: warning\n        instance: \"{{ $labels.instance }}\"\n      annotations:\n        summary: \"instance: {{ $labels.instance }} memory 使用率过高\"\n        description: \"Memory 使用率超过 90%\"\n        value: \"{{ $value }}\"\n```\n\n#### node\nvim node.yml\n```\ngroups:\n  - name: node-alert\n    rules:\n    - alert: NodeDown5m\n      expr: up{job=\"node\"} == 0\n      for: 5m\n      labels:\n        severity: critical\n        instance: \"{{ $labels.instance }}\"\n      annotations:\n        summary: \"instance: {{ $labels.instance }} down\"\n        description: \"Instance: {{ $labels.instance }} 已经宕机 5分钟\"\n        value: \"{{ $value }}\"\n    - alert: NodeDown30m\n      expr: up{job=\"node\"} == 0\n      for: 30m\n      labels:\n        severity: critical\n        instance: \"{{ $labels.instance }}\"\n      annotations:\n        summary: \"instance: {{ $labels.instance }} down\"\n        description: \"Instance: {{ $labels.instance }} 已经宕机 30分钟\"\n        value: \"{{ $value }}\"\n```\n\n### 添加 targets\n\n#### 创建目录\n```\nmkdir jmx jvm node prjectVer website\n```\n\n#### jmx 配置\ncd jmx\nvim target.yml\n```\n# edibz\n- targets: ['47.112.97.170:20101']\n  labels: {cluster: 'wms',type: 'jmx',project: 'edibz',env: 'prod',job: 'edibz10401',export: 'jmx',ip: '47.112.97.170'}\n- targets: ['47.112.97.170:20102']\n  labels: {cluster: 'wms',type: 'jmx',project: 'edibz',env: 'prod',job: 'edibz10402',export: 'jmx',ip: '47.112.97.170'}\n\n\n# ediqm\n- targets: ['47.112.125.246:20201']\n  labels: {cluster: 'wms',type: 'jmx',project: 'ediqm',env: 'prod',job: 'ediqm10200',export: 'jmx',ip: '47.112.125.246'}\n- targets: ['47.112.125.246:20202']\n  labels: {cluster: 'wms',type: 'jmx',project: 'ediqm',env: 'prod',job: 'ediqm10201',export: 'jmx',ip: '47.112.125.246'}\n- targets: ['47.112.118.67:20203']\n  labels: {cluster: 'wms',type: 'jmx',project: 'ediqm',env: 'prod',job: 'ediqm10202',export: 'jmx',ip: '47.112.118.67'}\n- targets: ['47.112.118.67:20204']\n  labels: {cluster: 'wms',type: 'jmx',project: 'ediqm',env: 'prod',job: 'ediqm10203',export: 'jmx',ip: '47.112.118.67'}\n\n\n# wms\n- targets: ['47.112.98.225:20001']\n  labels: {cluster: 'wms',type: 'jmx',project: 'xwms',env: 'prod',job: 'xwms10000',export: 'jmx',ip: '47.112.98.225'}\n- targets: ['47.112.119.2:20002']\n  labels: {cluster: 'wms',type: 'jmx',project: 'xwms',env: 'prod',job: 'xwms10002',export: 'jmx',ip: '47.112.119.2'}\n- targets: ['47.112.115.7:20003']\n  labels: {cluster: 'wms',type: 'jmx',project: 'xwms',env: 'prod',job: 'xwms10003',export: 'jmx',ip: '47.112.115.7'}\n- targets: ['47.112.125.15:20004']\n  labels: {cluster: 'wms',type: 'jmx',project: 'xwms',env: 'prod',job: 'xwms10004',export: 'jmx',ip: '47.112.125.15'}\n#- targets: ['47.112.169.38:20005']\n#  labels: {cluster: 'wms',type: 'jmx',project: 'xwms',env: 'prod',job: 'xwms10005',export: 'jmx',ip: '47.112.169.38'}\n```\n\n#### node 配置文件\n```\nmkdir bigdata  bms  dba  jingtian  oa  xwms  yunpei  zms  zop\n```\ncd xwms\n```\n- targets: ['47.107.233.112:6301']\n  labels: {\"project\": \"xwms\",\"env\": \"prod\",\"hostname\": \"ali02-prod-wms-cluster-nginx-api-01\",\"ip\": \"47.107.233.112\"}\n- targets: ['47.112.114.10:6301']\n  labels: {\"project\": \"xwms\",\"env\": \"prod\",\"hostname\": \"ali02-prod-wms-cluster-nginx-web-01\",\"ip\": \"47.112.114.10\"}\n- targets: ['47.112.98.225:6301']\n  labels: {\"project\": \"xwms\",\"env\": \"prod\",\"hostname\": \"ali02-prod-wms-cluster-wms-01\",\"ip\": \"47.112.98.225\"}\n- targets: ['47.112.119.2:6301']\n  labels: {\"project\": \"xwms\",\"env\": \"prod\",\"hostname\": \"ali02-prod-wms-cluster-wms-02\",\"ip\": \"47.112.119.2\"}\n- targets: ['47.112.115.7:6301']\n  labels: {\"project\": \"xwms\",\"env\": \"prod\",\"hostname\": \"ali02-prod-wms-cluster-wms-03\",\"ip\": \"47.112.115.7\"}\n- targets: ['47.112.125.15:6301']\n  labels: {\"project\": \"xwms\",\"env\": \"prod\",\"hostname\": \"ali02-prod-wms-cluster-wms-04\",\"ip\": \"47.112.125.15\"}\n- targets: ['47.112.125.246:6301']\n  labels: {\"project\": \"xwms\",\"env\": \"prod\",\"hostname\": \"ali02-prod-wms-cluster-qm-01\",\"ip\": \"47.112.125.246\"}\n- targets: ['47.112.118.67:6301']\n  labels: {\"project\": \"xwms\",\"env\": \"prod\",\"hostname\": \"ali02-prod-wms-cluster-qm-02\",\"ip\": \"47.112.118.67\"}\n- targets: ['47.112.97.170:6301']\n  labels: {\"project\": \"xwms\",\"env\": \"prod\",\"hostname\": \"ali02-prod-wms-cluster-bz-01\",\"ip\": \"47.112.97.170\"}\n- targets: ['47.112.138.225:6301']\n  labels: {\"project\": \"xwms\",\"env\": \"prod\",\"hostname\": \"ali02-prod-wms-cluster-express-01\",\"ip\": \"47.112.138.225\"}\n- targets: ['47.112.116.45:6301']\n  labels: {\"project\": \"xwms\",\"env\": \"prod\",\"hostname\": \"ali02-prod-wms-cluster-express-02\",\"ip\": \"47.112.116.45\"}\n- targets: ['47.112.125.154:6301']\n  labels: {\"project\": \"xwms\",\"env\": \"prod\",\"hostname\": \"ali02-prod-wms-cluster-id-01\",\"ip\": \"47.112.125.154\"}\n- targets: ['47.112.123.210:6301']\n  labels: {\"project\": \"xwms\",\"env\": \"prod\",\"hostname\": \"ali02-prod-wms-cluster-schedule-01\",\"ip\": \"47.112.123.210\"}\n- targets: ['47.112.106.181:6301']\n  labels: {\"project\": \"xwms\",\"env\": \"prod\",\"hostname\": \"ali02-prod-wms-cluster-schedule-02\",\"ip\": \"47.112.106.181\"}\n- targets: ['120.79.163.136:6301']\n  labels: {\"project\": \"xwms\",\"env\": \"prod\",\"hostname\": \"ali02-prod-wms-cluster-schedule-03\",\"ip\": \"120.79.163.136\"}\n- targets: ['47.112.153.226:6301']\n  labels: {\"project\": \"xwms\",\"env\": \"prod\",\"hostname\": \"ali02-prod-wms-web-pre-01\",\"ip\": \"47.112.153.226\"}\n- targets: ['47.112.119.25:6301']\n  labels: {\"project\": \"xwms\",\"env\": \"prod\",\"hostname\": \"ali02-prod-wms-api-pre-01\",\"ip\": \"47.112.119.25\"}\n- targets: ['47.112.147.64:6301']\n  labels: {\"project\": \"xwms\",\"env\": \"prod\",\"hostname\": \"ali02-prod-wms-web-pre-02\",\"ip\": \"47.112.147.64\"}\n- targets: ['47.112.117.33:6301']\n  labels: {\"project\": \"xwms\",\"env\": \"prod\",\"hostname\": \"ali02-prod-wms-api-pre-02\",\"ip\": \"47.112.117.33\"}\n- targets: ['47.112.169.38:6301']\n  labels: {\"project\": \"xwms\",\"env\": \"prod\",\"hostname\": \"ali02-prod-wms-web-pre-03\",\"ip\": \"47.112.169.38\"}\n- targets: ['120.77.181.215:6301']\n  labels: {\"project\": \"xwms\",\"env\": \"prod\",\"hostname\": \"ali02-prod-wms-api-pre-03\",\"ip\": \"120.77.181.215\"}\n```\n\n\n#### targets 添加脚本\nvim add.sh\n```\n#!/bin/bash\nenv=\"prod\"\nproject=\"bigdata\"\n\ncat /dev/null > target.yml\nwhile read line;\ndo\nif [[ $line =~ ^# ]];then\n  continue\nfi\n  tip=`echo $line | cut -f 1 -d \" \"`\n  thost=`echo $line | cut -f 2 -d \" \"`\n  echo $tip .. $thost\nif  [ ! -n \"$tip\" ] ;then\n  echo \"you have not input a word!\"\n  continue\nfi\ncat >>target.yml<<-EOF\n- targets: ['${tip}:6301']\n  labels: {\"project\": \"${project}\",\"env\": \"${env}\",\"hostname\": \"${thost}\",\"ip\": \"${tip}\"}\n\nEOF\ndone<hostname\n```\n\n\nvim hostname\n```\n172.16.104.200  cdh.ops.com\n172.16.104.201  cdh01.ops.com\n172.16.104.202  cdh02.ops.com\n172.16.104.203  cdh03.ops.com\n172.16.104.204  cdh04.ops.com\n172.16.104.205  cdh05.ops.com\n172.16.104.206  cdh06.ops.com\n172.16.104.207  cdh07.ops.com\n172.16.104.208  cdh08.ops.com\n172.16.104.209  cdh09.ops.com\n47.115.21.93    ali02-prod-bi-box-01.ops.com\n47.115.17.67    ali02-prod-bi-box-02.ops.com\n#172.16.105.116  hz01-prod-bi-haizao-01.ops.com\n#172.16.105.119  hz01-prod-bi-haizao-02.ops.com\n```\n\n\n### 动态更新prometheus的配置项\n\n动态更新Prometheus的配置，即热更新加载，一共有两种方式：\n\n1）向prometheus进程发送SIGHUP信号\n\n2）curl -X POST http://localdns:9090/-/reload ","slug":"prometheus/prom安装","published":1,"updated":"2021-09-09T07:12:41.053Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cku697a0o006m00uh5e7lbcjt","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><p>摘要: prometheus使用docker-compose </p>\n<span id=\"more\"></span>\n\n\n<h2 id=\"目录创建\"><a href=\"#目录创建\" class=\"headerlink\" title=\"目录创建\"></a>目录创建</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir -p &#x2F;opt&#x2F;prom&#x2F;&#123;prometheus,alertmanager,black-exporter,grafana&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"创建docker-compose文件\"><a href=\"#创建docker-compose文件\" class=\"headerlink\" title=\"创建docker-compose文件\"></a>创建docker-compose文件</h2><p>cd /opt/prom/<br>vim docker-compose.yaml</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">version: &#39;3.7&#39;</span><br><span class=\"line\"></span><br><span class=\"line\">services:</span><br><span class=\"line\">  node-exporter:</span><br><span class=\"line\">    image: prom&#x2F;node-exporter:latest</span><br><span class=\"line\">    ports:</span><br><span class=\"line\">      - &quot;9100:9100&quot;</span><br><span class=\"line\">    networks:</span><br><span class=\"line\">      - prom</span><br><span class=\"line\"></span><br><span class=\"line\">#  dingtalk:</span><br><span class=\"line\">#    image: timonwong&#x2F;prometheus-webhook-dingtalk:latest</span><br><span class=\"line\">#    volumes:</span><br><span class=\"line\">#      - type: bind</span><br><span class=\"line\">#        source: .&#x2F;alertmanager&#x2F;config.yml</span><br><span class=\"line\">#        target: &#x2F;etc&#x2F;prometheus-webhook-dingtalk&#x2F;config.yml</span><br><span class=\"line\">#        read_only: true</span><br><span class=\"line\">#    ports:</span><br><span class=\"line\">#      - &quot;8060:8060&quot;</span><br><span class=\"line\">#    networks:</span><br><span class=\"line\">#      - prom</span><br><span class=\"line\"></span><br><span class=\"line\">  alertmanager:</span><br><span class=\"line\">#    depends_on:</span><br><span class=\"line\">#      - dingtalk</span><br><span class=\"line\">    image: prom&#x2F;alertmanager:latest</span><br><span class=\"line\">    environment:</span><br><span class=\"line\">      - TZ&#x3D;Asia&#x2F;Shanghai</span><br><span class=\"line\">    volumes:</span><br><span class=\"line\">      - type: bind</span><br><span class=\"line\">        source: .&#x2F;alertmanager&#x2F;alertmanager.yml</span><br><span class=\"line\">        target: &#x2F;etc&#x2F;alertmanager&#x2F;alertmanager.yml</span><br><span class=\"line\">        read_only: true</span><br><span class=\"line\">\t\tcommand: &quot;--config.file&#x3D;&#x2F;etc&#x2F;alertmanager&#x2F;alertmanager.yml --web.external-url&#x3D;http:&#x2F;&#x2F;10.200.76.70:9093&quot;</span><br><span class=\"line\">    ports:</span><br><span class=\"line\">      - &quot;9093:9093&quot;</span><br><span class=\"line\">      - &quot;9094:9094&quot;</span><br><span class=\"line\">    networks:</span><br><span class=\"line\">      - prom</span><br><span class=\"line\"></span><br><span class=\"line\">  prometheus:</span><br><span class=\"line\">    depends_on:</span><br><span class=\"line\">      - alertmanager</span><br><span class=\"line\">    image: prom&#x2F;prometheus:latest</span><br><span class=\"line\">    environment:</span><br><span class=\"line\">      - TZ&#x3D;Asia&#x2F;Shanghai</span><br><span class=\"line\">    volumes:</span><br><span class=\"line\">      - type: bind</span><br><span class=\"line\">        source: .&#x2F;prometheus&#x2F;prometheus.yml</span><br><span class=\"line\">        target: &#x2F;etc&#x2F;prometheus&#x2F;prometheus.yml</span><br><span class=\"line\">        read_only: true</span><br><span class=\"line\"> #     - type: bind</span><br><span class=\"line\"> #       source: .&#x2F;prometheus&#x2F;rules&#x2F;alert-rules.yml</span><br><span class=\"line\"> #       target: &#x2F;etc&#x2F;prometheus&#x2F;alert-rules.yml</span><br><span class=\"line\"> #       read_only: true</span><br><span class=\"line\">      - type: volume</span><br><span class=\"line\">        source: prometheus</span><br><span class=\"line\">        target: &#x2F;prometheus</span><br><span class=\"line\">      - &quot;&#x2F;opt&#x2F;prom&#x2F;prometheus&#x2F;rules:&#x2F;etc&#x2F;prometheus&#x2F;rules&quot;</span><br><span class=\"line\">      - &quot;&#x2F;opt&#x2F;prom&#x2F;prometheus&#x2F;targets:&#x2F;etc&#x2F;prometheus&#x2F;targets&quot;</span><br><span class=\"line\">    command: &quot;--config.file&#x3D;&#x2F;etc&#x2F;prometheus&#x2F;prometheus.yml --storage.tsdb.path&#x3D;&#x2F;prometheus --storage.tsdb.retention&#x3D;180d --web.enable-admin-api --web.external-url&#x3D;http:&#x2F;&#x2F;10.200.76.70:9090&quot;</span><br><span class=\"line\">    ports:</span><br><span class=\"line\">      - &quot;9090:9090&quot;</span><br><span class=\"line\">    networks:</span><br><span class=\"line\">      - prom</span><br><span class=\"line\"></span><br><span class=\"line\">  grafana:</span><br><span class=\"line\">    depends_on:</span><br><span class=\"line\">      - prometheus</span><br><span class=\"line\">    image: grafana&#x2F;grafana:latest</span><br><span class=\"line\">    volumes:</span><br><span class=\"line\">      - type: volume</span><br><span class=\"line\">        source: grafana</span><br><span class=\"line\">        target: &#x2F;var&#x2F;lib&#x2F;grafana</span><br><span class=\"line\">    ports:</span><br><span class=\"line\">      - &quot;3000:3000&quot;</span><br><span class=\"line\">    networks:</span><br><span class=\"line\">      - prom</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">  black-exporter:</span><br><span class=\"line\">    environment:</span><br><span class=\"line\">      - TZ&#x3D;Asia&#x2F;Shanghai</span><br><span class=\"line\">    image: prom&#x2F;blackbox-exporter:latest</span><br><span class=\"line\">    volumes:</span><br><span class=\"line\">      - &#x2F;opt&#x2F;prom&#x2F;black-exporter&#x2F;blackbox.yml:&#x2F;config&#x2F;blackbox.yml</span><br><span class=\"line\">    command:</span><br><span class=\"line\">      - &#39;--config.file&#x3D;&#x2F;config&#x2F;blackbox.yml&#39;</span><br><span class=\"line\">    ports:</span><br><span class=\"line\">      - &#39;9115:9115&#39;</span><br><span class=\"line\">    networks:</span><br><span class=\"line\">      - prom</span><br><span class=\"line\"></span><br><span class=\"line\">volumes:</span><br><span class=\"line\">  prometheus:</span><br><span class=\"line\">    driver: local</span><br><span class=\"line\">    driver_opts:</span><br><span class=\"line\">      type: none</span><br><span class=\"line\">      o: bind</span><br><span class=\"line\">      device: &#x2F;opt&#x2F;prom&#x2F;prometheus&#x2F;data</span><br><span class=\"line\">  grafana:</span><br><span class=\"line\">    driver: local</span><br><span class=\"line\">    driver_opts:</span><br><span class=\"line\">      type: none</span><br><span class=\"line\">      o: bind</span><br><span class=\"line\">      device: &#x2F;opt&#x2F;prom&#x2F;grafana</span><br><span class=\"line\">      </span><br><span class=\"line\">networks:</span><br><span class=\"line\">  prom:</span><br><span class=\"line\">    driver: bridge</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"prometheus-配置文件\"><a href=\"#prometheus-配置文件\" class=\"headerlink\" title=\"prometheus 配置文件\"></a>prometheus 配置文件</h2><h3 id=\"初始化目录\"><a href=\"#初始化目录\" class=\"headerlink\" title=\"初始化目录\"></a>初始化目录</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir -p data rules targets</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"创建prometheus-yml配置文件\"><a href=\"#创建prometheus-yml配置文件\" class=\"headerlink\" title=\"创建prometheus.yml配置文件\"></a>创建prometheus.yml配置文件</h3><p>cd prometheus<br>vim prometheus.yml</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">global:</span><br><span class=\"line\">  scrape_interval:     15s</span><br><span class=\"line\">  evaluation_interval: 15s</span><br><span class=\"line\"></span><br><span class=\"line\">alerting:</span><br><span class=\"line\">  alertmanagers:</span><br><span class=\"line\">  - static_configs:</span><br><span class=\"line\">    - targets:</span><br><span class=\"line\">      - alertmanager:9093</span><br><span class=\"line\"></span><br><span class=\"line\">rule_files:</span><br><span class=\"line\">  - &quot;&#x2F;etc&#x2F;prometheus&#x2F;rules&#x2F;*.yml&quot;</span><br><span class=\"line\">  #- &quot;*rules.yml&quot;</span><br><span class=\"line\">  </span><br><span class=\"line\">scrape_configs:</span><br><span class=\"line\">  - job_name: &#39;node-target&#39;</span><br><span class=\"line\">    file_sd_configs:</span><br><span class=\"line\">    - files:</span><br><span class=\"line\">      - &quot;&#x2F;etc&#x2F;prometheus&#x2F;targets&#x2F;node&#x2F;xwms&#x2F;target.yml&quot;</span><br><span class=\"line\">      - &quot;&#x2F;etc&#x2F;prometheus&#x2F;targets&#x2F;node&#x2F;jingtian&#x2F;target.yml&quot;</span><br><span class=\"line\">      - &quot;&#x2F;etc&#x2F;prometheus&#x2F;targets&#x2F;node&#x2F;zop&#x2F;target.yml&quot;</span><br><span class=\"line\">      - &quot;&#x2F;etc&#x2F;prometheus&#x2F;targets&#x2F;node&#x2F;zms&#x2F;target.yml&quot;</span><br><span class=\"line\">      - &quot;&#x2F;etc&#x2F;prometheus&#x2F;targets&#x2F;node&#x2F;yunpei&#x2F;target.yml&quot;</span><br><span class=\"line\">      - &quot;&#x2F;etc&#x2F;prometheus&#x2F;targets&#x2F;node&#x2F;oa&#x2F;target.yml&quot;</span><br><span class=\"line\">      - &quot;&#x2F;etc&#x2F;prometheus&#x2F;targets&#x2F;node&#x2F;dba&#x2F;target.yml&quot;</span><br><span class=\"line\">      - &quot;&#x2F;etc&#x2F;prometheus&#x2F;targets&#x2F;node&#x2F;bms&#x2F;target.yml&quot;</span><br><span class=\"line\">      - &quot;&#x2F;etc&#x2F;prometheus&#x2F;targets&#x2F;node&#x2F;bigdata&#x2F;target.yml&quot;</span><br><span class=\"line\">      refresh_interval: 10s </span><br><span class=\"line\"></span><br><span class=\"line\">  - job_name: &#39;prometheus&#39;</span><br><span class=\"line\">    static_configs:</span><br><span class=\"line\">    - targets: [&#39;prometheus:9090&#39;]</span><br><span class=\"line\"></span><br><span class=\"line\">  - job_name: &#39;node&#39;</span><br><span class=\"line\">    static_configs:</span><br><span class=\"line\">    - targets: [&#39;node-exporter:9100&#39;]</span><br><span class=\"line\"></span><br><span class=\"line\">  - job_name: &#39;alertmanager&#39;</span><br><span class=\"line\">    static_configs:</span><br><span class=\"line\">    - targets: [&#39;alertmanager:9093&#39;]</span><br><span class=\"line\"></span><br><span class=\"line\">  - job_name: &#39;jmx&#39;</span><br><span class=\"line\">    file_sd_configs:</span><br><span class=\"line\">    - files:</span><br><span class=\"line\">      - &quot;&#x2F;etc&#x2F;prometheus&#x2F;targets&#x2F;jmx&#x2F;target.yml&quot;</span><br><span class=\"line\">      refresh_interval: 3m</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">  - job_name: &#39;prjectVer&#39;</span><br><span class=\"line\">    scrape_interval: 120s</span><br><span class=\"line\">    metrics_path: &#39;&#x2F;actuator1&#x2F;project&#x2F;version&#39;</span><br><span class=\"line\">    file_sd_configs:</span><br><span class=\"line\">    - files:</span><br><span class=\"line\">      - &quot;&#x2F;etc&#x2F;prometheus&#x2F;targets&#x2F;prjectVer&#x2F;target.yml&quot;</span><br><span class=\"line\">      refresh_interval: 1m</span><br><span class=\"line\"></span><br><span class=\"line\">  - job_name: &quot;Website-monitor&quot;</span><br><span class=\"line\">    scrape_interval: 60s</span><br><span class=\"line\">    metrics_path: &#x2F;probe</span><br><span class=\"line\">    params:</span><br><span class=\"line\">      module: [http_2xx]</span><br><span class=\"line\">    file_sd_configs:</span><br><span class=\"line\">    - files:</span><br><span class=\"line\">      - &quot;&#x2F;etc&#x2F;prometheus&#x2F;targets&#x2F;website&#x2F;target.yml&quot;</span><br><span class=\"line\">      refresh_interval: 3m</span><br><span class=\"line\"></span><br><span class=\"line\">    relabel_configs:</span><br><span class=\"line\">      - source_labels: [__address__]</span><br><span class=\"line\">        target_label: __param_target</span><br><span class=\"line\">      - source_labels: [__param_target]</span><br><span class=\"line\">        target_label: instance</span><br><span class=\"line\">      - target_label: __address__</span><br><span class=\"line\">        replacement: 10.200.76.70:9115</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"添加ruls\"><a href=\"#添加ruls\" class=\"headerlink\" title=\"添加ruls\"></a>添加ruls</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">https:&#x2F;&#x2F;awesome-prometheus-alerts.grep.to&#x2F;rules</span><br></pre></td></tr></table></figure>\n\n\n<p>cd rules</p>\n<h4 id=\"CPU\"><a href=\"#CPU\" class=\"headerlink\" title=\"CPU\"></a>CPU</h4><p>vim cpu.yml</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">groups:</span><br><span class=\"line\">  - name: cpu-alert</span><br><span class=\"line\">    rules:</span><br><span class=\"line\">    - alert: NodeCpuHigh</span><br><span class=\"line\">      expr: (1 - avg by (instance) (irate(node_cpu_seconds_total&#123;job&#x3D;&quot;node-target&quot;,mode&#x3D;&quot;idle&quot;&#125;[5m]))) * 100 &gt; 80</span><br><span class=\"line\">      for: 5m</span><br><span class=\"line\">      labels:</span><br><span class=\"line\">        severity: warning</span><br><span class=\"line\">        instance: &quot;&#123;&#123; $labels.instance &#125;&#125;&quot;</span><br><span class=\"line\">      annotations:</span><br><span class=\"line\">        summary: &quot;instance: &#123;&#123; $labels.instance &#125;&#125; cpu使用率过高&quot;</span><br><span class=\"line\">        description: &quot;CPU 使用率超过 80%&quot;</span><br><span class=\"line\">        value: &quot;&#123;&#123; $value &#125;&#125;&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">    - alert: NodeCpuIowaitHigh</span><br><span class=\"line\">      expr: avg by (instance) (irate(node_cpu_seconds_total&#123;job&#x3D;&quot;node-target&quot;,mode&#x3D;&quot;iowait&quot;&#125;[5m])) * 100 &gt; 50</span><br><span class=\"line\">      for: 5m</span><br><span class=\"line\">      labels:</span><br><span class=\"line\">        severity: warning</span><br><span class=\"line\">        instance: &quot;&#123;&#123; $labels.instance &#125;&#125;&quot;</span><br><span class=\"line\">      annotations:</span><br><span class=\"line\">        summary: &quot;instance: &#123;&#123; $labels.instance &#125;&#125; cpu iowait 使用率过高&quot;</span><br><span class=\"line\">        description: &quot;CPU iowait 使用率超过 50%&quot;</span><br><span class=\"line\">        value: &quot;&#123;&#123; $value &#125;&#125;&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">    - alert: NodeLoad5High</span><br><span class=\"line\">      expr: node_load5 &gt; (count by (instance) (node_cpu_seconds_total&#123;job&#x3D;&quot;node-target&quot;,mode&#x3D;&#39;system&#39;&#125;)) * 1.2</span><br><span class=\"line\">      for: 5m</span><br><span class=\"line\">      labels:</span><br><span class=\"line\">        severity: warning</span><br><span class=\"line\">        instance: &quot;&#123;&#123; $labels.instance &#125;&#125;&quot;</span><br><span class=\"line\">      annotations:</span><br><span class=\"line\">        summary: &quot;instance: &#123;&#123; $labels.instance &#125;&#125; load(5m) 过高&quot;</span><br><span class=\"line\">        description: &quot;Load(5m) 过高，超出cpu核数 1.2倍&quot;</span><br><span class=\"line\">        value: &quot;&#123;&#123; $value &#125;&#125;&quot;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"disk\"><a href=\"#disk\" class=\"headerlink\" title=\"disk\"></a>disk</h4><p>vim disk.yml</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">groups:</span><br><span class=\"line\">  - name: node-alert</span><br><span class=\"line\">    rules:</span><br><span class=\"line\">    - alert: NodeDiskHigh</span><br><span class=\"line\">      expr: ceil(((node_filesystem_size_bytes &#123;device&#x3D;~&quot;(&#x2F;dev&#x2F;.*|&#x2F;)&quot;,fstype&#x3D;~&quot;(ext4|xfs)&quot;&#125; - node_filesystem_free_bytes &#123;device&#x3D;~&quot;(&#x2F;dev&#x2F;.*|&#x2F;)&quot;,fstype&#x3D;~&quot;(ext4|xfs)&quot;&#125;) &#x2F; node_filesystem_size_bytes &#123;device&#x3D;~&quot;(&#x2F;dev&#x2F;.*|&#x2F;)&quot;,fstype&#x3D;~&quot;(ext4|xfs)&quot;&#125; ) * 100  &gt; 80 )</span><br><span class=\"line\">      for: 10m</span><br><span class=\"line\">      labels:</span><br><span class=\"line\">        severity: warning</span><br><span class=\"line\">        instance: &quot;&#123;&#123; $labels.instance &#125;&#125;&quot;</span><br><span class=\"line\">      annotations:</span><br><span class=\"line\">        summary: &quot;instance: &#123;&#123; $labels.instance &#125;&#125; disk( &#123;&#123; $labels.mountpoint &#125;&#125; 分区) 使用率过高&quot;</span><br><span class=\"line\">        description: &quot;Disk( &#123;&#123; $labels.mountpoint &#125;&#125; 分区) 使用率超过 80%&quot;</span><br><span class=\"line\">        value: &quot;&#123;&#123; $value &#125;&#125;&quot;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"mem\"><a href=\"#mem\" class=\"headerlink\" title=\"mem\"></a>mem</h4><p>vim mem.yml</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">groups:</span><br><span class=\"line\">  - name: memory-alert</span><br><span class=\"line\">    rules:</span><br><span class=\"line\">    - alert: NodeMemoryHigh</span><br><span class=\"line\">      expr: (1 - node_memory_MemAvailable_bytes&#123;job&#x3D;&quot;node&quot;&#125; &#x2F; node_memory_MemTotal_bytes&#123;job&#x3D;&quot;node&quot;&#125;) * 100 &gt; 90</span><br><span class=\"line\">      for: 5m</span><br><span class=\"line\">      labels:</span><br><span class=\"line\">        severity: warning</span><br><span class=\"line\">        instance: &quot;&#123;&#123; $labels.instance &#125;&#125;&quot;</span><br><span class=\"line\">      annotations:</span><br><span class=\"line\">        summary: &quot;instance: &#123;&#123; $labels.instance &#125;&#125; memory 使用率过高&quot;</span><br><span class=\"line\">        description: &quot;Memory 使用率超过 90%&quot;</span><br><span class=\"line\">        value: &quot;&#123;&#123; $value &#125;&#125;&quot;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"node\"><a href=\"#node\" class=\"headerlink\" title=\"node\"></a>node</h4><p>vim node.yml</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">groups:</span><br><span class=\"line\">  - name: node-alert</span><br><span class=\"line\">    rules:</span><br><span class=\"line\">    - alert: NodeDown5m</span><br><span class=\"line\">      expr: up&#123;job&#x3D;&quot;node&quot;&#125; &#x3D;&#x3D; 0</span><br><span class=\"line\">      for: 5m</span><br><span class=\"line\">      labels:</span><br><span class=\"line\">        severity: critical</span><br><span class=\"line\">        instance: &quot;&#123;&#123; $labels.instance &#125;&#125;&quot;</span><br><span class=\"line\">      annotations:</span><br><span class=\"line\">        summary: &quot;instance: &#123;&#123; $labels.instance &#125;&#125; down&quot;</span><br><span class=\"line\">        description: &quot;Instance: &#123;&#123; $labels.instance &#125;&#125; 已经宕机 5分钟&quot;</span><br><span class=\"line\">        value: &quot;&#123;&#123; $value &#125;&#125;&quot;</span><br><span class=\"line\">    - alert: NodeDown30m</span><br><span class=\"line\">      expr: up&#123;job&#x3D;&quot;node&quot;&#125; &#x3D;&#x3D; 0</span><br><span class=\"line\">      for: 30m</span><br><span class=\"line\">      labels:</span><br><span class=\"line\">        severity: critical</span><br><span class=\"line\">        instance: &quot;&#123;&#123; $labels.instance &#125;&#125;&quot;</span><br><span class=\"line\">      annotations:</span><br><span class=\"line\">        summary: &quot;instance: &#123;&#123; $labels.instance &#125;&#125; down&quot;</span><br><span class=\"line\">        description: &quot;Instance: &#123;&#123; $labels.instance &#125;&#125; 已经宕机 30分钟&quot;</span><br><span class=\"line\">        value: &quot;&#123;&#123; $value &#125;&#125;&quot;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"添加-targets\"><a href=\"#添加-targets\" class=\"headerlink\" title=\"添加 targets\"></a>添加 targets</h3><h4 id=\"创建目录\"><a href=\"#创建目录\" class=\"headerlink\" title=\"创建目录\"></a>创建目录</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir jmx jvm node prjectVer website</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"jmx-配置\"><a href=\"#jmx-配置\" class=\"headerlink\" title=\"jmx 配置\"></a>jmx 配置</h4><p>cd jmx<br>vim target.yml</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># edibz</span><br><span class=\"line\">- targets: [&#39;47.112.97.170:20101&#39;]</span><br><span class=\"line\">  labels: &#123;cluster: &#39;wms&#39;,type: &#39;jmx&#39;,project: &#39;edibz&#39;,env: &#39;prod&#39;,job: &#39;edibz10401&#39;,export: &#39;jmx&#39;,ip: &#39;47.112.97.170&#39;&#125;</span><br><span class=\"line\">- targets: [&#39;47.112.97.170:20102&#39;]</span><br><span class=\"line\">  labels: &#123;cluster: &#39;wms&#39;,type: &#39;jmx&#39;,project: &#39;edibz&#39;,env: &#39;prod&#39;,job: &#39;edibz10402&#39;,export: &#39;jmx&#39;,ip: &#39;47.112.97.170&#39;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># ediqm</span><br><span class=\"line\">- targets: [&#39;47.112.125.246:20201&#39;]</span><br><span class=\"line\">  labels: &#123;cluster: &#39;wms&#39;,type: &#39;jmx&#39;,project: &#39;ediqm&#39;,env: &#39;prod&#39;,job: &#39;ediqm10200&#39;,export: &#39;jmx&#39;,ip: &#39;47.112.125.246&#39;&#125;</span><br><span class=\"line\">- targets: [&#39;47.112.125.246:20202&#39;]</span><br><span class=\"line\">  labels: &#123;cluster: &#39;wms&#39;,type: &#39;jmx&#39;,project: &#39;ediqm&#39;,env: &#39;prod&#39;,job: &#39;ediqm10201&#39;,export: &#39;jmx&#39;,ip: &#39;47.112.125.246&#39;&#125;</span><br><span class=\"line\">- targets: [&#39;47.112.118.67:20203&#39;]</span><br><span class=\"line\">  labels: &#123;cluster: &#39;wms&#39;,type: &#39;jmx&#39;,project: &#39;ediqm&#39;,env: &#39;prod&#39;,job: &#39;ediqm10202&#39;,export: &#39;jmx&#39;,ip: &#39;47.112.118.67&#39;&#125;</span><br><span class=\"line\">- targets: [&#39;47.112.118.67:20204&#39;]</span><br><span class=\"line\">  labels: &#123;cluster: &#39;wms&#39;,type: &#39;jmx&#39;,project: &#39;ediqm&#39;,env: &#39;prod&#39;,job: &#39;ediqm10203&#39;,export: &#39;jmx&#39;,ip: &#39;47.112.118.67&#39;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># wms</span><br><span class=\"line\">- targets: [&#39;47.112.98.225:20001&#39;]</span><br><span class=\"line\">  labels: &#123;cluster: &#39;wms&#39;,type: &#39;jmx&#39;,project: &#39;xwms&#39;,env: &#39;prod&#39;,job: &#39;xwms10000&#39;,export: &#39;jmx&#39;,ip: &#39;47.112.98.225&#39;&#125;</span><br><span class=\"line\">- targets: [&#39;47.112.119.2:20002&#39;]</span><br><span class=\"line\">  labels: &#123;cluster: &#39;wms&#39;,type: &#39;jmx&#39;,project: &#39;xwms&#39;,env: &#39;prod&#39;,job: &#39;xwms10002&#39;,export: &#39;jmx&#39;,ip: &#39;47.112.119.2&#39;&#125;</span><br><span class=\"line\">- targets: [&#39;47.112.115.7:20003&#39;]</span><br><span class=\"line\">  labels: &#123;cluster: &#39;wms&#39;,type: &#39;jmx&#39;,project: &#39;xwms&#39;,env: &#39;prod&#39;,job: &#39;xwms10003&#39;,export: &#39;jmx&#39;,ip: &#39;47.112.115.7&#39;&#125;</span><br><span class=\"line\">- targets: [&#39;47.112.125.15:20004&#39;]</span><br><span class=\"line\">  labels: &#123;cluster: &#39;wms&#39;,type: &#39;jmx&#39;,project: &#39;xwms&#39;,env: &#39;prod&#39;,job: &#39;xwms10004&#39;,export: &#39;jmx&#39;,ip: &#39;47.112.125.15&#39;&#125;</span><br><span class=\"line\">#- targets: [&#39;47.112.169.38:20005&#39;]</span><br><span class=\"line\">#  labels: &#123;cluster: &#39;wms&#39;,type: &#39;jmx&#39;,project: &#39;xwms&#39;,env: &#39;prod&#39;,job: &#39;xwms10005&#39;,export: &#39;jmx&#39;,ip: &#39;47.112.169.38&#39;&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"node-配置文件\"><a href=\"#node-配置文件\" class=\"headerlink\" title=\"node 配置文件\"></a>node 配置文件</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir bigdata  bms  dba  jingtian  oa  xwms  yunpei  zms  zop</span><br></pre></td></tr></table></figure>\n<p>cd xwms</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- targets: [&#39;47.107.233.112:6301&#39;]</span><br><span class=\"line\">  labels: &#123;&quot;project&quot;: &quot;xwms&quot;,&quot;env&quot;: &quot;prod&quot;,&quot;hostname&quot;: &quot;ali02-prod-wms-cluster-nginx-api-01&quot;,&quot;ip&quot;: &quot;47.107.233.112&quot;&#125;</span><br><span class=\"line\">- targets: [&#39;47.112.114.10:6301&#39;]</span><br><span class=\"line\">  labels: &#123;&quot;project&quot;: &quot;xwms&quot;,&quot;env&quot;: &quot;prod&quot;,&quot;hostname&quot;: &quot;ali02-prod-wms-cluster-nginx-web-01&quot;,&quot;ip&quot;: &quot;47.112.114.10&quot;&#125;</span><br><span class=\"line\">- targets: [&#39;47.112.98.225:6301&#39;]</span><br><span class=\"line\">  labels: &#123;&quot;project&quot;: &quot;xwms&quot;,&quot;env&quot;: &quot;prod&quot;,&quot;hostname&quot;: &quot;ali02-prod-wms-cluster-wms-01&quot;,&quot;ip&quot;: &quot;47.112.98.225&quot;&#125;</span><br><span class=\"line\">- targets: [&#39;47.112.119.2:6301&#39;]</span><br><span class=\"line\">  labels: &#123;&quot;project&quot;: &quot;xwms&quot;,&quot;env&quot;: &quot;prod&quot;,&quot;hostname&quot;: &quot;ali02-prod-wms-cluster-wms-02&quot;,&quot;ip&quot;: &quot;47.112.119.2&quot;&#125;</span><br><span class=\"line\">- targets: [&#39;47.112.115.7:6301&#39;]</span><br><span class=\"line\">  labels: &#123;&quot;project&quot;: &quot;xwms&quot;,&quot;env&quot;: &quot;prod&quot;,&quot;hostname&quot;: &quot;ali02-prod-wms-cluster-wms-03&quot;,&quot;ip&quot;: &quot;47.112.115.7&quot;&#125;</span><br><span class=\"line\">- targets: [&#39;47.112.125.15:6301&#39;]</span><br><span class=\"line\">  labels: &#123;&quot;project&quot;: &quot;xwms&quot;,&quot;env&quot;: &quot;prod&quot;,&quot;hostname&quot;: &quot;ali02-prod-wms-cluster-wms-04&quot;,&quot;ip&quot;: &quot;47.112.125.15&quot;&#125;</span><br><span class=\"line\">- targets: [&#39;47.112.125.246:6301&#39;]</span><br><span class=\"line\">  labels: &#123;&quot;project&quot;: &quot;xwms&quot;,&quot;env&quot;: &quot;prod&quot;,&quot;hostname&quot;: &quot;ali02-prod-wms-cluster-qm-01&quot;,&quot;ip&quot;: &quot;47.112.125.246&quot;&#125;</span><br><span class=\"line\">- targets: [&#39;47.112.118.67:6301&#39;]</span><br><span class=\"line\">  labels: &#123;&quot;project&quot;: &quot;xwms&quot;,&quot;env&quot;: &quot;prod&quot;,&quot;hostname&quot;: &quot;ali02-prod-wms-cluster-qm-02&quot;,&quot;ip&quot;: &quot;47.112.118.67&quot;&#125;</span><br><span class=\"line\">- targets: [&#39;47.112.97.170:6301&#39;]</span><br><span class=\"line\">  labels: &#123;&quot;project&quot;: &quot;xwms&quot;,&quot;env&quot;: &quot;prod&quot;,&quot;hostname&quot;: &quot;ali02-prod-wms-cluster-bz-01&quot;,&quot;ip&quot;: &quot;47.112.97.170&quot;&#125;</span><br><span class=\"line\">- targets: [&#39;47.112.138.225:6301&#39;]</span><br><span class=\"line\">  labels: &#123;&quot;project&quot;: &quot;xwms&quot;,&quot;env&quot;: &quot;prod&quot;,&quot;hostname&quot;: &quot;ali02-prod-wms-cluster-express-01&quot;,&quot;ip&quot;: &quot;47.112.138.225&quot;&#125;</span><br><span class=\"line\">- targets: [&#39;47.112.116.45:6301&#39;]</span><br><span class=\"line\">  labels: &#123;&quot;project&quot;: &quot;xwms&quot;,&quot;env&quot;: &quot;prod&quot;,&quot;hostname&quot;: &quot;ali02-prod-wms-cluster-express-02&quot;,&quot;ip&quot;: &quot;47.112.116.45&quot;&#125;</span><br><span class=\"line\">- targets: [&#39;47.112.125.154:6301&#39;]</span><br><span class=\"line\">  labels: &#123;&quot;project&quot;: &quot;xwms&quot;,&quot;env&quot;: &quot;prod&quot;,&quot;hostname&quot;: &quot;ali02-prod-wms-cluster-id-01&quot;,&quot;ip&quot;: &quot;47.112.125.154&quot;&#125;</span><br><span class=\"line\">- targets: [&#39;47.112.123.210:6301&#39;]</span><br><span class=\"line\">  labels: &#123;&quot;project&quot;: &quot;xwms&quot;,&quot;env&quot;: &quot;prod&quot;,&quot;hostname&quot;: &quot;ali02-prod-wms-cluster-schedule-01&quot;,&quot;ip&quot;: &quot;47.112.123.210&quot;&#125;</span><br><span class=\"line\">- targets: [&#39;47.112.106.181:6301&#39;]</span><br><span class=\"line\">  labels: &#123;&quot;project&quot;: &quot;xwms&quot;,&quot;env&quot;: &quot;prod&quot;,&quot;hostname&quot;: &quot;ali02-prod-wms-cluster-schedule-02&quot;,&quot;ip&quot;: &quot;47.112.106.181&quot;&#125;</span><br><span class=\"line\">- targets: [&#39;120.79.163.136:6301&#39;]</span><br><span class=\"line\">  labels: &#123;&quot;project&quot;: &quot;xwms&quot;,&quot;env&quot;: &quot;prod&quot;,&quot;hostname&quot;: &quot;ali02-prod-wms-cluster-schedule-03&quot;,&quot;ip&quot;: &quot;120.79.163.136&quot;&#125;</span><br><span class=\"line\">- targets: [&#39;47.112.153.226:6301&#39;]</span><br><span class=\"line\">  labels: &#123;&quot;project&quot;: &quot;xwms&quot;,&quot;env&quot;: &quot;prod&quot;,&quot;hostname&quot;: &quot;ali02-prod-wms-web-pre-01&quot;,&quot;ip&quot;: &quot;47.112.153.226&quot;&#125;</span><br><span class=\"line\">- targets: [&#39;47.112.119.25:6301&#39;]</span><br><span class=\"line\">  labels: &#123;&quot;project&quot;: &quot;xwms&quot;,&quot;env&quot;: &quot;prod&quot;,&quot;hostname&quot;: &quot;ali02-prod-wms-api-pre-01&quot;,&quot;ip&quot;: &quot;47.112.119.25&quot;&#125;</span><br><span class=\"line\">- targets: [&#39;47.112.147.64:6301&#39;]</span><br><span class=\"line\">  labels: &#123;&quot;project&quot;: &quot;xwms&quot;,&quot;env&quot;: &quot;prod&quot;,&quot;hostname&quot;: &quot;ali02-prod-wms-web-pre-02&quot;,&quot;ip&quot;: &quot;47.112.147.64&quot;&#125;</span><br><span class=\"line\">- targets: [&#39;47.112.117.33:6301&#39;]</span><br><span class=\"line\">  labels: &#123;&quot;project&quot;: &quot;xwms&quot;,&quot;env&quot;: &quot;prod&quot;,&quot;hostname&quot;: &quot;ali02-prod-wms-api-pre-02&quot;,&quot;ip&quot;: &quot;47.112.117.33&quot;&#125;</span><br><span class=\"line\">- targets: [&#39;47.112.169.38:6301&#39;]</span><br><span class=\"line\">  labels: &#123;&quot;project&quot;: &quot;xwms&quot;,&quot;env&quot;: &quot;prod&quot;,&quot;hostname&quot;: &quot;ali02-prod-wms-web-pre-03&quot;,&quot;ip&quot;: &quot;47.112.169.38&quot;&#125;</span><br><span class=\"line\">- targets: [&#39;120.77.181.215:6301&#39;]</span><br><span class=\"line\">  labels: &#123;&quot;project&quot;: &quot;xwms&quot;,&quot;env&quot;: &quot;prod&quot;,&quot;hostname&quot;: &quot;ali02-prod-wms-api-pre-03&quot;,&quot;ip&quot;: &quot;120.77.181.215&quot;&#125;</span><br></pre></td></tr></table></figure>\n\n\n<h4 id=\"targets-添加脚本\"><a href=\"#targets-添加脚本\" class=\"headerlink\" title=\"targets 添加脚本\"></a>targets 添加脚本</h4><p>vim add.sh</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#!&#x2F;bin&#x2F;bash</span><br><span class=\"line\">env&#x3D;&quot;prod&quot;</span><br><span class=\"line\">project&#x3D;&quot;bigdata&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">cat &#x2F;dev&#x2F;null &gt; target.yml</span><br><span class=\"line\">while read line;</span><br><span class=\"line\">do</span><br><span class=\"line\">if [[ $line &#x3D;~ ^# ]];then</span><br><span class=\"line\">  continue</span><br><span class=\"line\">fi</span><br><span class=\"line\">  tip&#x3D;&#96;echo $line | cut -f 1 -d &quot; &quot;&#96;</span><br><span class=\"line\">  thost&#x3D;&#96;echo $line | cut -f 2 -d &quot; &quot;&#96;</span><br><span class=\"line\">  echo $tip .. $thost</span><br><span class=\"line\">if  [ ! -n &quot;$tip&quot; ] ;then</span><br><span class=\"line\">  echo &quot;you have not input a word!&quot;</span><br><span class=\"line\">  continue</span><br><span class=\"line\">fi</span><br><span class=\"line\">cat &gt;&gt;target.yml&lt;&lt;-EOF</span><br><span class=\"line\">- targets: [&#39;$&#123;tip&#125;:6301&#39;]</span><br><span class=\"line\">  labels: &#123;&quot;project&quot;: &quot;$&#123;project&#125;&quot;,&quot;env&quot;: &quot;$&#123;env&#125;&quot;,&quot;hostname&quot;: &quot;$&#123;thost&#125;&quot;,&quot;ip&quot;: &quot;$&#123;tip&#125;&quot;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">EOF</span><br><span class=\"line\">done&lt;hostname</span><br></pre></td></tr></table></figure>\n\n\n<p>vim hostname</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">172.16.104.200  cdh.ops.com</span><br><span class=\"line\">172.16.104.201  cdh01.ops.com</span><br><span class=\"line\">172.16.104.202  cdh02.ops.com</span><br><span class=\"line\">172.16.104.203  cdh03.ops.com</span><br><span class=\"line\">172.16.104.204  cdh04.ops.com</span><br><span class=\"line\">172.16.104.205  cdh05.ops.com</span><br><span class=\"line\">172.16.104.206  cdh06.ops.com</span><br><span class=\"line\">172.16.104.207  cdh07.ops.com</span><br><span class=\"line\">172.16.104.208  cdh08.ops.com</span><br><span class=\"line\">172.16.104.209  cdh09.ops.com</span><br><span class=\"line\">47.115.21.93    ali02-prod-bi-box-01.ops.com</span><br><span class=\"line\">47.115.17.67    ali02-prod-bi-box-02.ops.com</span><br><span class=\"line\">#172.16.105.116  hz01-prod-bi-haizao-01.ops.com</span><br><span class=\"line\">#172.16.105.119  hz01-prod-bi-haizao-02.ops.com</span><br></pre></td></tr></table></figure>\n\n\n<h3 id=\"动态更新prometheus的配置项\"><a href=\"#动态更新prometheus的配置项\" class=\"headerlink\" title=\"动态更新prometheus的配置项\"></a>动态更新prometheus的配置项</h3><p>动态更新Prometheus的配置，即热更新加载，一共有两种方式：</p>\n<p>1）向prometheus进程发送SIGHUP信号</p>\n<p>2）curl -X POST <a href=\"http://localdns:9090/-/reload\">http://localdns:9090/-/reload</a> </p>\n","site":{"data":{}},"excerpt":"<p>摘要: prometheus使用docker-compose </p>","more":"<h2 id=\"目录创建\"><a href=\"#目录创建\" class=\"headerlink\" title=\"目录创建\"></a>目录创建</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir -p &#x2F;opt&#x2F;prom&#x2F;&#123;prometheus,alertmanager,black-exporter,grafana&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"创建docker-compose文件\"><a href=\"#创建docker-compose文件\" class=\"headerlink\" title=\"创建docker-compose文件\"></a>创建docker-compose文件</h2><p>cd /opt/prom/<br>vim docker-compose.yaml</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">version: &#39;3.7&#39;</span><br><span class=\"line\"></span><br><span class=\"line\">services:</span><br><span class=\"line\">  node-exporter:</span><br><span class=\"line\">    image: prom&#x2F;node-exporter:latest</span><br><span class=\"line\">    ports:</span><br><span class=\"line\">      - &quot;9100:9100&quot;</span><br><span class=\"line\">    networks:</span><br><span class=\"line\">      - prom</span><br><span class=\"line\"></span><br><span class=\"line\">#  dingtalk:</span><br><span class=\"line\">#    image: timonwong&#x2F;prometheus-webhook-dingtalk:latest</span><br><span class=\"line\">#    volumes:</span><br><span class=\"line\">#      - type: bind</span><br><span class=\"line\">#        source: .&#x2F;alertmanager&#x2F;config.yml</span><br><span class=\"line\">#        target: &#x2F;etc&#x2F;prometheus-webhook-dingtalk&#x2F;config.yml</span><br><span class=\"line\">#        read_only: true</span><br><span class=\"line\">#    ports:</span><br><span class=\"line\">#      - &quot;8060:8060&quot;</span><br><span class=\"line\">#    networks:</span><br><span class=\"line\">#      - prom</span><br><span class=\"line\"></span><br><span class=\"line\">  alertmanager:</span><br><span class=\"line\">#    depends_on:</span><br><span class=\"line\">#      - dingtalk</span><br><span class=\"line\">    image: prom&#x2F;alertmanager:latest</span><br><span class=\"line\">    environment:</span><br><span class=\"line\">      - TZ&#x3D;Asia&#x2F;Shanghai</span><br><span class=\"line\">    volumes:</span><br><span class=\"line\">      - type: bind</span><br><span class=\"line\">        source: .&#x2F;alertmanager&#x2F;alertmanager.yml</span><br><span class=\"line\">        target: &#x2F;etc&#x2F;alertmanager&#x2F;alertmanager.yml</span><br><span class=\"line\">        read_only: true</span><br><span class=\"line\">\t\tcommand: &quot;--config.file&#x3D;&#x2F;etc&#x2F;alertmanager&#x2F;alertmanager.yml --web.external-url&#x3D;http:&#x2F;&#x2F;10.200.76.70:9093&quot;</span><br><span class=\"line\">    ports:</span><br><span class=\"line\">      - &quot;9093:9093&quot;</span><br><span class=\"line\">      - &quot;9094:9094&quot;</span><br><span class=\"line\">    networks:</span><br><span class=\"line\">      - prom</span><br><span class=\"line\"></span><br><span class=\"line\">  prometheus:</span><br><span class=\"line\">    depends_on:</span><br><span class=\"line\">      - alertmanager</span><br><span class=\"line\">    image: prom&#x2F;prometheus:latest</span><br><span class=\"line\">    environment:</span><br><span class=\"line\">      - TZ&#x3D;Asia&#x2F;Shanghai</span><br><span class=\"line\">    volumes:</span><br><span class=\"line\">      - type: bind</span><br><span class=\"line\">        source: .&#x2F;prometheus&#x2F;prometheus.yml</span><br><span class=\"line\">        target: &#x2F;etc&#x2F;prometheus&#x2F;prometheus.yml</span><br><span class=\"line\">        read_only: true</span><br><span class=\"line\"> #     - type: bind</span><br><span class=\"line\"> #       source: .&#x2F;prometheus&#x2F;rules&#x2F;alert-rules.yml</span><br><span class=\"line\"> #       target: &#x2F;etc&#x2F;prometheus&#x2F;alert-rules.yml</span><br><span class=\"line\"> #       read_only: true</span><br><span class=\"line\">      - type: volume</span><br><span class=\"line\">        source: prometheus</span><br><span class=\"line\">        target: &#x2F;prometheus</span><br><span class=\"line\">      - &quot;&#x2F;opt&#x2F;prom&#x2F;prometheus&#x2F;rules:&#x2F;etc&#x2F;prometheus&#x2F;rules&quot;</span><br><span class=\"line\">      - &quot;&#x2F;opt&#x2F;prom&#x2F;prometheus&#x2F;targets:&#x2F;etc&#x2F;prometheus&#x2F;targets&quot;</span><br><span class=\"line\">    command: &quot;--config.file&#x3D;&#x2F;etc&#x2F;prometheus&#x2F;prometheus.yml --storage.tsdb.path&#x3D;&#x2F;prometheus --storage.tsdb.retention&#x3D;180d --web.enable-admin-api --web.external-url&#x3D;http:&#x2F;&#x2F;10.200.76.70:9090&quot;</span><br><span class=\"line\">    ports:</span><br><span class=\"line\">      - &quot;9090:9090&quot;</span><br><span class=\"line\">    networks:</span><br><span class=\"line\">      - prom</span><br><span class=\"line\"></span><br><span class=\"line\">  grafana:</span><br><span class=\"line\">    depends_on:</span><br><span class=\"line\">      - prometheus</span><br><span class=\"line\">    image: grafana&#x2F;grafana:latest</span><br><span class=\"line\">    volumes:</span><br><span class=\"line\">      - type: volume</span><br><span class=\"line\">        source: grafana</span><br><span class=\"line\">        target: &#x2F;var&#x2F;lib&#x2F;grafana</span><br><span class=\"line\">    ports:</span><br><span class=\"line\">      - &quot;3000:3000&quot;</span><br><span class=\"line\">    networks:</span><br><span class=\"line\">      - prom</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">  black-exporter:</span><br><span class=\"line\">    environment:</span><br><span class=\"line\">      - TZ&#x3D;Asia&#x2F;Shanghai</span><br><span class=\"line\">    image: prom&#x2F;blackbox-exporter:latest</span><br><span class=\"line\">    volumes:</span><br><span class=\"line\">      - &#x2F;opt&#x2F;prom&#x2F;black-exporter&#x2F;blackbox.yml:&#x2F;config&#x2F;blackbox.yml</span><br><span class=\"line\">    command:</span><br><span class=\"line\">      - &#39;--config.file&#x3D;&#x2F;config&#x2F;blackbox.yml&#39;</span><br><span class=\"line\">    ports:</span><br><span class=\"line\">      - &#39;9115:9115&#39;</span><br><span class=\"line\">    networks:</span><br><span class=\"line\">      - prom</span><br><span class=\"line\"></span><br><span class=\"line\">volumes:</span><br><span class=\"line\">  prometheus:</span><br><span class=\"line\">    driver: local</span><br><span class=\"line\">    driver_opts:</span><br><span class=\"line\">      type: none</span><br><span class=\"line\">      o: bind</span><br><span class=\"line\">      device: &#x2F;opt&#x2F;prom&#x2F;prometheus&#x2F;data</span><br><span class=\"line\">  grafana:</span><br><span class=\"line\">    driver: local</span><br><span class=\"line\">    driver_opts:</span><br><span class=\"line\">      type: none</span><br><span class=\"line\">      o: bind</span><br><span class=\"line\">      device: &#x2F;opt&#x2F;prom&#x2F;grafana</span><br><span class=\"line\">      </span><br><span class=\"line\">networks:</span><br><span class=\"line\">  prom:</span><br><span class=\"line\">    driver: bridge</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"prometheus-配置文件\"><a href=\"#prometheus-配置文件\" class=\"headerlink\" title=\"prometheus 配置文件\"></a>prometheus 配置文件</h2><h3 id=\"初始化目录\"><a href=\"#初始化目录\" class=\"headerlink\" title=\"初始化目录\"></a>初始化目录</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir -p data rules targets</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"创建prometheus-yml配置文件\"><a href=\"#创建prometheus-yml配置文件\" class=\"headerlink\" title=\"创建prometheus.yml配置文件\"></a>创建prometheus.yml配置文件</h3><p>cd prometheus<br>vim prometheus.yml</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">global:</span><br><span class=\"line\">  scrape_interval:     15s</span><br><span class=\"line\">  evaluation_interval: 15s</span><br><span class=\"line\"></span><br><span class=\"line\">alerting:</span><br><span class=\"line\">  alertmanagers:</span><br><span class=\"line\">  - static_configs:</span><br><span class=\"line\">    - targets:</span><br><span class=\"line\">      - alertmanager:9093</span><br><span class=\"line\"></span><br><span class=\"line\">rule_files:</span><br><span class=\"line\">  - &quot;&#x2F;etc&#x2F;prometheus&#x2F;rules&#x2F;*.yml&quot;</span><br><span class=\"line\">  #- &quot;*rules.yml&quot;</span><br><span class=\"line\">  </span><br><span class=\"line\">scrape_configs:</span><br><span class=\"line\">  - job_name: &#39;node-target&#39;</span><br><span class=\"line\">    file_sd_configs:</span><br><span class=\"line\">    - files:</span><br><span class=\"line\">      - &quot;&#x2F;etc&#x2F;prometheus&#x2F;targets&#x2F;node&#x2F;xwms&#x2F;target.yml&quot;</span><br><span class=\"line\">      - &quot;&#x2F;etc&#x2F;prometheus&#x2F;targets&#x2F;node&#x2F;jingtian&#x2F;target.yml&quot;</span><br><span class=\"line\">      - &quot;&#x2F;etc&#x2F;prometheus&#x2F;targets&#x2F;node&#x2F;zop&#x2F;target.yml&quot;</span><br><span class=\"line\">      - &quot;&#x2F;etc&#x2F;prometheus&#x2F;targets&#x2F;node&#x2F;zms&#x2F;target.yml&quot;</span><br><span class=\"line\">      - &quot;&#x2F;etc&#x2F;prometheus&#x2F;targets&#x2F;node&#x2F;yunpei&#x2F;target.yml&quot;</span><br><span class=\"line\">      - &quot;&#x2F;etc&#x2F;prometheus&#x2F;targets&#x2F;node&#x2F;oa&#x2F;target.yml&quot;</span><br><span class=\"line\">      - &quot;&#x2F;etc&#x2F;prometheus&#x2F;targets&#x2F;node&#x2F;dba&#x2F;target.yml&quot;</span><br><span class=\"line\">      - &quot;&#x2F;etc&#x2F;prometheus&#x2F;targets&#x2F;node&#x2F;bms&#x2F;target.yml&quot;</span><br><span class=\"line\">      - &quot;&#x2F;etc&#x2F;prometheus&#x2F;targets&#x2F;node&#x2F;bigdata&#x2F;target.yml&quot;</span><br><span class=\"line\">      refresh_interval: 10s </span><br><span class=\"line\"></span><br><span class=\"line\">  - job_name: &#39;prometheus&#39;</span><br><span class=\"line\">    static_configs:</span><br><span class=\"line\">    - targets: [&#39;prometheus:9090&#39;]</span><br><span class=\"line\"></span><br><span class=\"line\">  - job_name: &#39;node&#39;</span><br><span class=\"line\">    static_configs:</span><br><span class=\"line\">    - targets: [&#39;node-exporter:9100&#39;]</span><br><span class=\"line\"></span><br><span class=\"line\">  - job_name: &#39;alertmanager&#39;</span><br><span class=\"line\">    static_configs:</span><br><span class=\"line\">    - targets: [&#39;alertmanager:9093&#39;]</span><br><span class=\"line\"></span><br><span class=\"line\">  - job_name: &#39;jmx&#39;</span><br><span class=\"line\">    file_sd_configs:</span><br><span class=\"line\">    - files:</span><br><span class=\"line\">      - &quot;&#x2F;etc&#x2F;prometheus&#x2F;targets&#x2F;jmx&#x2F;target.yml&quot;</span><br><span class=\"line\">      refresh_interval: 3m</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">  - job_name: &#39;prjectVer&#39;</span><br><span class=\"line\">    scrape_interval: 120s</span><br><span class=\"line\">    metrics_path: &#39;&#x2F;actuator1&#x2F;project&#x2F;version&#39;</span><br><span class=\"line\">    file_sd_configs:</span><br><span class=\"line\">    - files:</span><br><span class=\"line\">      - &quot;&#x2F;etc&#x2F;prometheus&#x2F;targets&#x2F;prjectVer&#x2F;target.yml&quot;</span><br><span class=\"line\">      refresh_interval: 1m</span><br><span class=\"line\"></span><br><span class=\"line\">  - job_name: &quot;Website-monitor&quot;</span><br><span class=\"line\">    scrape_interval: 60s</span><br><span class=\"line\">    metrics_path: &#x2F;probe</span><br><span class=\"line\">    params:</span><br><span class=\"line\">      module: [http_2xx]</span><br><span class=\"line\">    file_sd_configs:</span><br><span class=\"line\">    - files:</span><br><span class=\"line\">      - &quot;&#x2F;etc&#x2F;prometheus&#x2F;targets&#x2F;website&#x2F;target.yml&quot;</span><br><span class=\"line\">      refresh_interval: 3m</span><br><span class=\"line\"></span><br><span class=\"line\">    relabel_configs:</span><br><span class=\"line\">      - source_labels: [__address__]</span><br><span class=\"line\">        target_label: __param_target</span><br><span class=\"line\">      - source_labels: [__param_target]</span><br><span class=\"line\">        target_label: instance</span><br><span class=\"line\">      - target_label: __address__</span><br><span class=\"line\">        replacement: 10.200.76.70:9115</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"添加ruls\"><a href=\"#添加ruls\" class=\"headerlink\" title=\"添加ruls\"></a>添加ruls</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">https:&#x2F;&#x2F;awesome-prometheus-alerts.grep.to&#x2F;rules</span><br></pre></td></tr></table></figure>\n\n\n<p>cd rules</p>\n<h4 id=\"CPU\"><a href=\"#CPU\" class=\"headerlink\" title=\"CPU\"></a>CPU</h4><p>vim cpu.yml</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">groups:</span><br><span class=\"line\">  - name: cpu-alert</span><br><span class=\"line\">    rules:</span><br><span class=\"line\">    - alert: NodeCpuHigh</span><br><span class=\"line\">      expr: (1 - avg by (instance) (irate(node_cpu_seconds_total&#123;job&#x3D;&quot;node-target&quot;,mode&#x3D;&quot;idle&quot;&#125;[5m]))) * 100 &gt; 80</span><br><span class=\"line\">      for: 5m</span><br><span class=\"line\">      labels:</span><br><span class=\"line\">        severity: warning</span><br><span class=\"line\">        instance: &quot;&#123;&#123; $labels.instance &#125;&#125;&quot;</span><br><span class=\"line\">      annotations:</span><br><span class=\"line\">        summary: &quot;instance: &#123;&#123; $labels.instance &#125;&#125; cpu使用率过高&quot;</span><br><span class=\"line\">        description: &quot;CPU 使用率超过 80%&quot;</span><br><span class=\"line\">        value: &quot;&#123;&#123; $value &#125;&#125;&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">    - alert: NodeCpuIowaitHigh</span><br><span class=\"line\">      expr: avg by (instance) (irate(node_cpu_seconds_total&#123;job&#x3D;&quot;node-target&quot;,mode&#x3D;&quot;iowait&quot;&#125;[5m])) * 100 &gt; 50</span><br><span class=\"line\">      for: 5m</span><br><span class=\"line\">      labels:</span><br><span class=\"line\">        severity: warning</span><br><span class=\"line\">        instance: &quot;&#123;&#123; $labels.instance &#125;&#125;&quot;</span><br><span class=\"line\">      annotations:</span><br><span class=\"line\">        summary: &quot;instance: &#123;&#123; $labels.instance &#125;&#125; cpu iowait 使用率过高&quot;</span><br><span class=\"line\">        description: &quot;CPU iowait 使用率超过 50%&quot;</span><br><span class=\"line\">        value: &quot;&#123;&#123; $value &#125;&#125;&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">    - alert: NodeLoad5High</span><br><span class=\"line\">      expr: node_load5 &gt; (count by (instance) (node_cpu_seconds_total&#123;job&#x3D;&quot;node-target&quot;,mode&#x3D;&#39;system&#39;&#125;)) * 1.2</span><br><span class=\"line\">      for: 5m</span><br><span class=\"line\">      labels:</span><br><span class=\"line\">        severity: warning</span><br><span class=\"line\">        instance: &quot;&#123;&#123; $labels.instance &#125;&#125;&quot;</span><br><span class=\"line\">      annotations:</span><br><span class=\"line\">        summary: &quot;instance: &#123;&#123; $labels.instance &#125;&#125; load(5m) 过高&quot;</span><br><span class=\"line\">        description: &quot;Load(5m) 过高，超出cpu核数 1.2倍&quot;</span><br><span class=\"line\">        value: &quot;&#123;&#123; $value &#125;&#125;&quot;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"disk\"><a href=\"#disk\" class=\"headerlink\" title=\"disk\"></a>disk</h4><p>vim disk.yml</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">groups:</span><br><span class=\"line\">  - name: node-alert</span><br><span class=\"line\">    rules:</span><br><span class=\"line\">    - alert: NodeDiskHigh</span><br><span class=\"line\">      expr: ceil(((node_filesystem_size_bytes &#123;device&#x3D;~&quot;(&#x2F;dev&#x2F;.*|&#x2F;)&quot;,fstype&#x3D;~&quot;(ext4|xfs)&quot;&#125; - node_filesystem_free_bytes &#123;device&#x3D;~&quot;(&#x2F;dev&#x2F;.*|&#x2F;)&quot;,fstype&#x3D;~&quot;(ext4|xfs)&quot;&#125;) &#x2F; node_filesystem_size_bytes &#123;device&#x3D;~&quot;(&#x2F;dev&#x2F;.*|&#x2F;)&quot;,fstype&#x3D;~&quot;(ext4|xfs)&quot;&#125; ) * 100  &gt; 80 )</span><br><span class=\"line\">      for: 10m</span><br><span class=\"line\">      labels:</span><br><span class=\"line\">        severity: warning</span><br><span class=\"line\">        instance: &quot;&#123;&#123; $labels.instance &#125;&#125;&quot;</span><br><span class=\"line\">      annotations:</span><br><span class=\"line\">        summary: &quot;instance: &#123;&#123; $labels.instance &#125;&#125; disk( &#123;&#123; $labels.mountpoint &#125;&#125; 分区) 使用率过高&quot;</span><br><span class=\"line\">        description: &quot;Disk( &#123;&#123; $labels.mountpoint &#125;&#125; 分区) 使用率超过 80%&quot;</span><br><span class=\"line\">        value: &quot;&#123;&#123; $value &#125;&#125;&quot;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"mem\"><a href=\"#mem\" class=\"headerlink\" title=\"mem\"></a>mem</h4><p>vim mem.yml</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">groups:</span><br><span class=\"line\">  - name: memory-alert</span><br><span class=\"line\">    rules:</span><br><span class=\"line\">    - alert: NodeMemoryHigh</span><br><span class=\"line\">      expr: (1 - node_memory_MemAvailable_bytes&#123;job&#x3D;&quot;node&quot;&#125; &#x2F; node_memory_MemTotal_bytes&#123;job&#x3D;&quot;node&quot;&#125;) * 100 &gt; 90</span><br><span class=\"line\">      for: 5m</span><br><span class=\"line\">      labels:</span><br><span class=\"line\">        severity: warning</span><br><span class=\"line\">        instance: &quot;&#123;&#123; $labels.instance &#125;&#125;&quot;</span><br><span class=\"line\">      annotations:</span><br><span class=\"line\">        summary: &quot;instance: &#123;&#123; $labels.instance &#125;&#125; memory 使用率过高&quot;</span><br><span class=\"line\">        description: &quot;Memory 使用率超过 90%&quot;</span><br><span class=\"line\">        value: &quot;&#123;&#123; $value &#125;&#125;&quot;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"node\"><a href=\"#node\" class=\"headerlink\" title=\"node\"></a>node</h4><p>vim node.yml</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">groups:</span><br><span class=\"line\">  - name: node-alert</span><br><span class=\"line\">    rules:</span><br><span class=\"line\">    - alert: NodeDown5m</span><br><span class=\"line\">      expr: up&#123;job&#x3D;&quot;node&quot;&#125; &#x3D;&#x3D; 0</span><br><span class=\"line\">      for: 5m</span><br><span class=\"line\">      labels:</span><br><span class=\"line\">        severity: critical</span><br><span class=\"line\">        instance: &quot;&#123;&#123; $labels.instance &#125;&#125;&quot;</span><br><span class=\"line\">      annotations:</span><br><span class=\"line\">        summary: &quot;instance: &#123;&#123; $labels.instance &#125;&#125; down&quot;</span><br><span class=\"line\">        description: &quot;Instance: &#123;&#123; $labels.instance &#125;&#125; 已经宕机 5分钟&quot;</span><br><span class=\"line\">        value: &quot;&#123;&#123; $value &#125;&#125;&quot;</span><br><span class=\"line\">    - alert: NodeDown30m</span><br><span class=\"line\">      expr: up&#123;job&#x3D;&quot;node&quot;&#125; &#x3D;&#x3D; 0</span><br><span class=\"line\">      for: 30m</span><br><span class=\"line\">      labels:</span><br><span class=\"line\">        severity: critical</span><br><span class=\"line\">        instance: &quot;&#123;&#123; $labels.instance &#125;&#125;&quot;</span><br><span class=\"line\">      annotations:</span><br><span class=\"line\">        summary: &quot;instance: &#123;&#123; $labels.instance &#125;&#125; down&quot;</span><br><span class=\"line\">        description: &quot;Instance: &#123;&#123; $labels.instance &#125;&#125; 已经宕机 30分钟&quot;</span><br><span class=\"line\">        value: &quot;&#123;&#123; $value &#125;&#125;&quot;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"添加-targets\"><a href=\"#添加-targets\" class=\"headerlink\" title=\"添加 targets\"></a>添加 targets</h3><h4 id=\"创建目录\"><a href=\"#创建目录\" class=\"headerlink\" title=\"创建目录\"></a>创建目录</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir jmx jvm node prjectVer website</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"jmx-配置\"><a href=\"#jmx-配置\" class=\"headerlink\" title=\"jmx 配置\"></a>jmx 配置</h4><p>cd jmx<br>vim target.yml</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># edibz</span><br><span class=\"line\">- targets: [&#39;47.112.97.170:20101&#39;]</span><br><span class=\"line\">  labels: &#123;cluster: &#39;wms&#39;,type: &#39;jmx&#39;,project: &#39;edibz&#39;,env: &#39;prod&#39;,job: &#39;edibz10401&#39;,export: &#39;jmx&#39;,ip: &#39;47.112.97.170&#39;&#125;</span><br><span class=\"line\">- targets: [&#39;47.112.97.170:20102&#39;]</span><br><span class=\"line\">  labels: &#123;cluster: &#39;wms&#39;,type: &#39;jmx&#39;,project: &#39;edibz&#39;,env: &#39;prod&#39;,job: &#39;edibz10402&#39;,export: &#39;jmx&#39;,ip: &#39;47.112.97.170&#39;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># ediqm</span><br><span class=\"line\">- targets: [&#39;47.112.125.246:20201&#39;]</span><br><span class=\"line\">  labels: &#123;cluster: &#39;wms&#39;,type: &#39;jmx&#39;,project: &#39;ediqm&#39;,env: &#39;prod&#39;,job: &#39;ediqm10200&#39;,export: &#39;jmx&#39;,ip: &#39;47.112.125.246&#39;&#125;</span><br><span class=\"line\">- targets: [&#39;47.112.125.246:20202&#39;]</span><br><span class=\"line\">  labels: &#123;cluster: &#39;wms&#39;,type: &#39;jmx&#39;,project: &#39;ediqm&#39;,env: &#39;prod&#39;,job: &#39;ediqm10201&#39;,export: &#39;jmx&#39;,ip: &#39;47.112.125.246&#39;&#125;</span><br><span class=\"line\">- targets: [&#39;47.112.118.67:20203&#39;]</span><br><span class=\"line\">  labels: &#123;cluster: &#39;wms&#39;,type: &#39;jmx&#39;,project: &#39;ediqm&#39;,env: &#39;prod&#39;,job: &#39;ediqm10202&#39;,export: &#39;jmx&#39;,ip: &#39;47.112.118.67&#39;&#125;</span><br><span class=\"line\">- targets: [&#39;47.112.118.67:20204&#39;]</span><br><span class=\"line\">  labels: &#123;cluster: &#39;wms&#39;,type: &#39;jmx&#39;,project: &#39;ediqm&#39;,env: &#39;prod&#39;,job: &#39;ediqm10203&#39;,export: &#39;jmx&#39;,ip: &#39;47.112.118.67&#39;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># wms</span><br><span class=\"line\">- targets: [&#39;47.112.98.225:20001&#39;]</span><br><span class=\"line\">  labels: &#123;cluster: &#39;wms&#39;,type: &#39;jmx&#39;,project: &#39;xwms&#39;,env: &#39;prod&#39;,job: &#39;xwms10000&#39;,export: &#39;jmx&#39;,ip: &#39;47.112.98.225&#39;&#125;</span><br><span class=\"line\">- targets: [&#39;47.112.119.2:20002&#39;]</span><br><span class=\"line\">  labels: &#123;cluster: &#39;wms&#39;,type: &#39;jmx&#39;,project: &#39;xwms&#39;,env: &#39;prod&#39;,job: &#39;xwms10002&#39;,export: &#39;jmx&#39;,ip: &#39;47.112.119.2&#39;&#125;</span><br><span class=\"line\">- targets: [&#39;47.112.115.7:20003&#39;]</span><br><span class=\"line\">  labels: &#123;cluster: &#39;wms&#39;,type: &#39;jmx&#39;,project: &#39;xwms&#39;,env: &#39;prod&#39;,job: &#39;xwms10003&#39;,export: &#39;jmx&#39;,ip: &#39;47.112.115.7&#39;&#125;</span><br><span class=\"line\">- targets: [&#39;47.112.125.15:20004&#39;]</span><br><span class=\"line\">  labels: &#123;cluster: &#39;wms&#39;,type: &#39;jmx&#39;,project: &#39;xwms&#39;,env: &#39;prod&#39;,job: &#39;xwms10004&#39;,export: &#39;jmx&#39;,ip: &#39;47.112.125.15&#39;&#125;</span><br><span class=\"line\">#- targets: [&#39;47.112.169.38:20005&#39;]</span><br><span class=\"line\">#  labels: &#123;cluster: &#39;wms&#39;,type: &#39;jmx&#39;,project: &#39;xwms&#39;,env: &#39;prod&#39;,job: &#39;xwms10005&#39;,export: &#39;jmx&#39;,ip: &#39;47.112.169.38&#39;&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"node-配置文件\"><a href=\"#node-配置文件\" class=\"headerlink\" title=\"node 配置文件\"></a>node 配置文件</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir bigdata  bms  dba  jingtian  oa  xwms  yunpei  zms  zop</span><br></pre></td></tr></table></figure>\n<p>cd xwms</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- targets: [&#39;47.107.233.112:6301&#39;]</span><br><span class=\"line\">  labels: &#123;&quot;project&quot;: &quot;xwms&quot;,&quot;env&quot;: &quot;prod&quot;,&quot;hostname&quot;: &quot;ali02-prod-wms-cluster-nginx-api-01&quot;,&quot;ip&quot;: &quot;47.107.233.112&quot;&#125;</span><br><span class=\"line\">- targets: [&#39;47.112.114.10:6301&#39;]</span><br><span class=\"line\">  labels: &#123;&quot;project&quot;: &quot;xwms&quot;,&quot;env&quot;: &quot;prod&quot;,&quot;hostname&quot;: &quot;ali02-prod-wms-cluster-nginx-web-01&quot;,&quot;ip&quot;: &quot;47.112.114.10&quot;&#125;</span><br><span class=\"line\">- targets: [&#39;47.112.98.225:6301&#39;]</span><br><span class=\"line\">  labels: &#123;&quot;project&quot;: &quot;xwms&quot;,&quot;env&quot;: &quot;prod&quot;,&quot;hostname&quot;: &quot;ali02-prod-wms-cluster-wms-01&quot;,&quot;ip&quot;: &quot;47.112.98.225&quot;&#125;</span><br><span class=\"line\">- targets: [&#39;47.112.119.2:6301&#39;]</span><br><span class=\"line\">  labels: &#123;&quot;project&quot;: &quot;xwms&quot;,&quot;env&quot;: &quot;prod&quot;,&quot;hostname&quot;: &quot;ali02-prod-wms-cluster-wms-02&quot;,&quot;ip&quot;: &quot;47.112.119.2&quot;&#125;</span><br><span class=\"line\">- targets: [&#39;47.112.115.7:6301&#39;]</span><br><span class=\"line\">  labels: &#123;&quot;project&quot;: &quot;xwms&quot;,&quot;env&quot;: &quot;prod&quot;,&quot;hostname&quot;: &quot;ali02-prod-wms-cluster-wms-03&quot;,&quot;ip&quot;: &quot;47.112.115.7&quot;&#125;</span><br><span class=\"line\">- targets: [&#39;47.112.125.15:6301&#39;]</span><br><span class=\"line\">  labels: &#123;&quot;project&quot;: &quot;xwms&quot;,&quot;env&quot;: &quot;prod&quot;,&quot;hostname&quot;: &quot;ali02-prod-wms-cluster-wms-04&quot;,&quot;ip&quot;: &quot;47.112.125.15&quot;&#125;</span><br><span class=\"line\">- targets: [&#39;47.112.125.246:6301&#39;]</span><br><span class=\"line\">  labels: &#123;&quot;project&quot;: &quot;xwms&quot;,&quot;env&quot;: &quot;prod&quot;,&quot;hostname&quot;: &quot;ali02-prod-wms-cluster-qm-01&quot;,&quot;ip&quot;: &quot;47.112.125.246&quot;&#125;</span><br><span class=\"line\">- targets: [&#39;47.112.118.67:6301&#39;]</span><br><span class=\"line\">  labels: &#123;&quot;project&quot;: &quot;xwms&quot;,&quot;env&quot;: &quot;prod&quot;,&quot;hostname&quot;: &quot;ali02-prod-wms-cluster-qm-02&quot;,&quot;ip&quot;: &quot;47.112.118.67&quot;&#125;</span><br><span class=\"line\">- targets: [&#39;47.112.97.170:6301&#39;]</span><br><span class=\"line\">  labels: &#123;&quot;project&quot;: &quot;xwms&quot;,&quot;env&quot;: &quot;prod&quot;,&quot;hostname&quot;: &quot;ali02-prod-wms-cluster-bz-01&quot;,&quot;ip&quot;: &quot;47.112.97.170&quot;&#125;</span><br><span class=\"line\">- targets: [&#39;47.112.138.225:6301&#39;]</span><br><span class=\"line\">  labels: &#123;&quot;project&quot;: &quot;xwms&quot;,&quot;env&quot;: &quot;prod&quot;,&quot;hostname&quot;: &quot;ali02-prod-wms-cluster-express-01&quot;,&quot;ip&quot;: &quot;47.112.138.225&quot;&#125;</span><br><span class=\"line\">- targets: [&#39;47.112.116.45:6301&#39;]</span><br><span class=\"line\">  labels: &#123;&quot;project&quot;: &quot;xwms&quot;,&quot;env&quot;: &quot;prod&quot;,&quot;hostname&quot;: &quot;ali02-prod-wms-cluster-express-02&quot;,&quot;ip&quot;: &quot;47.112.116.45&quot;&#125;</span><br><span class=\"line\">- targets: [&#39;47.112.125.154:6301&#39;]</span><br><span class=\"line\">  labels: &#123;&quot;project&quot;: &quot;xwms&quot;,&quot;env&quot;: &quot;prod&quot;,&quot;hostname&quot;: &quot;ali02-prod-wms-cluster-id-01&quot;,&quot;ip&quot;: &quot;47.112.125.154&quot;&#125;</span><br><span class=\"line\">- targets: [&#39;47.112.123.210:6301&#39;]</span><br><span class=\"line\">  labels: &#123;&quot;project&quot;: &quot;xwms&quot;,&quot;env&quot;: &quot;prod&quot;,&quot;hostname&quot;: &quot;ali02-prod-wms-cluster-schedule-01&quot;,&quot;ip&quot;: &quot;47.112.123.210&quot;&#125;</span><br><span class=\"line\">- targets: [&#39;47.112.106.181:6301&#39;]</span><br><span class=\"line\">  labels: &#123;&quot;project&quot;: &quot;xwms&quot;,&quot;env&quot;: &quot;prod&quot;,&quot;hostname&quot;: &quot;ali02-prod-wms-cluster-schedule-02&quot;,&quot;ip&quot;: &quot;47.112.106.181&quot;&#125;</span><br><span class=\"line\">- targets: [&#39;120.79.163.136:6301&#39;]</span><br><span class=\"line\">  labels: &#123;&quot;project&quot;: &quot;xwms&quot;,&quot;env&quot;: &quot;prod&quot;,&quot;hostname&quot;: &quot;ali02-prod-wms-cluster-schedule-03&quot;,&quot;ip&quot;: &quot;120.79.163.136&quot;&#125;</span><br><span class=\"line\">- targets: [&#39;47.112.153.226:6301&#39;]</span><br><span class=\"line\">  labels: &#123;&quot;project&quot;: &quot;xwms&quot;,&quot;env&quot;: &quot;prod&quot;,&quot;hostname&quot;: &quot;ali02-prod-wms-web-pre-01&quot;,&quot;ip&quot;: &quot;47.112.153.226&quot;&#125;</span><br><span class=\"line\">- targets: [&#39;47.112.119.25:6301&#39;]</span><br><span class=\"line\">  labels: &#123;&quot;project&quot;: &quot;xwms&quot;,&quot;env&quot;: &quot;prod&quot;,&quot;hostname&quot;: &quot;ali02-prod-wms-api-pre-01&quot;,&quot;ip&quot;: &quot;47.112.119.25&quot;&#125;</span><br><span class=\"line\">- targets: [&#39;47.112.147.64:6301&#39;]</span><br><span class=\"line\">  labels: &#123;&quot;project&quot;: &quot;xwms&quot;,&quot;env&quot;: &quot;prod&quot;,&quot;hostname&quot;: &quot;ali02-prod-wms-web-pre-02&quot;,&quot;ip&quot;: &quot;47.112.147.64&quot;&#125;</span><br><span class=\"line\">- targets: [&#39;47.112.117.33:6301&#39;]</span><br><span class=\"line\">  labels: &#123;&quot;project&quot;: &quot;xwms&quot;,&quot;env&quot;: &quot;prod&quot;,&quot;hostname&quot;: &quot;ali02-prod-wms-api-pre-02&quot;,&quot;ip&quot;: &quot;47.112.117.33&quot;&#125;</span><br><span class=\"line\">- targets: [&#39;47.112.169.38:6301&#39;]</span><br><span class=\"line\">  labels: &#123;&quot;project&quot;: &quot;xwms&quot;,&quot;env&quot;: &quot;prod&quot;,&quot;hostname&quot;: &quot;ali02-prod-wms-web-pre-03&quot;,&quot;ip&quot;: &quot;47.112.169.38&quot;&#125;</span><br><span class=\"line\">- targets: [&#39;120.77.181.215:6301&#39;]</span><br><span class=\"line\">  labels: &#123;&quot;project&quot;: &quot;xwms&quot;,&quot;env&quot;: &quot;prod&quot;,&quot;hostname&quot;: &quot;ali02-prod-wms-api-pre-03&quot;,&quot;ip&quot;: &quot;120.77.181.215&quot;&#125;</span><br></pre></td></tr></table></figure>\n\n\n<h4 id=\"targets-添加脚本\"><a href=\"#targets-添加脚本\" class=\"headerlink\" title=\"targets 添加脚本\"></a>targets 添加脚本</h4><p>vim add.sh</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#!&#x2F;bin&#x2F;bash</span><br><span class=\"line\">env&#x3D;&quot;prod&quot;</span><br><span class=\"line\">project&#x3D;&quot;bigdata&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">cat &#x2F;dev&#x2F;null &gt; target.yml</span><br><span class=\"line\">while read line;</span><br><span class=\"line\">do</span><br><span class=\"line\">if [[ $line &#x3D;~ ^# ]];then</span><br><span class=\"line\">  continue</span><br><span class=\"line\">fi</span><br><span class=\"line\">  tip&#x3D;&#96;echo $line | cut -f 1 -d &quot; &quot;&#96;</span><br><span class=\"line\">  thost&#x3D;&#96;echo $line | cut -f 2 -d &quot; &quot;&#96;</span><br><span class=\"line\">  echo $tip .. $thost</span><br><span class=\"line\">if  [ ! -n &quot;$tip&quot; ] ;then</span><br><span class=\"line\">  echo &quot;you have not input a word!&quot;</span><br><span class=\"line\">  continue</span><br><span class=\"line\">fi</span><br><span class=\"line\">cat &gt;&gt;target.yml&lt;&lt;-EOF</span><br><span class=\"line\">- targets: [&#39;$&#123;tip&#125;:6301&#39;]</span><br><span class=\"line\">  labels: &#123;&quot;project&quot;: &quot;$&#123;project&#125;&quot;,&quot;env&quot;: &quot;$&#123;env&#125;&quot;,&quot;hostname&quot;: &quot;$&#123;thost&#125;&quot;,&quot;ip&quot;: &quot;$&#123;tip&#125;&quot;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">EOF</span><br><span class=\"line\">done&lt;hostname</span><br></pre></td></tr></table></figure>\n\n\n<p>vim hostname</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">172.16.104.200  cdh.ops.com</span><br><span class=\"line\">172.16.104.201  cdh01.ops.com</span><br><span class=\"line\">172.16.104.202  cdh02.ops.com</span><br><span class=\"line\">172.16.104.203  cdh03.ops.com</span><br><span class=\"line\">172.16.104.204  cdh04.ops.com</span><br><span class=\"line\">172.16.104.205  cdh05.ops.com</span><br><span class=\"line\">172.16.104.206  cdh06.ops.com</span><br><span class=\"line\">172.16.104.207  cdh07.ops.com</span><br><span class=\"line\">172.16.104.208  cdh08.ops.com</span><br><span class=\"line\">172.16.104.209  cdh09.ops.com</span><br><span class=\"line\">47.115.21.93    ali02-prod-bi-box-01.ops.com</span><br><span class=\"line\">47.115.17.67    ali02-prod-bi-box-02.ops.com</span><br><span class=\"line\">#172.16.105.116  hz01-prod-bi-haizao-01.ops.com</span><br><span class=\"line\">#172.16.105.119  hz01-prod-bi-haizao-02.ops.com</span><br></pre></td></tr></table></figure>\n\n\n<h3 id=\"动态更新prometheus的配置项\"><a href=\"#动态更新prometheus的配置项\" class=\"headerlink\" title=\"动态更新prometheus的配置项\"></a>动态更新prometheus的配置项</h3><p>动态更新Prometheus的配置，即热更新加载，一共有两种方式：</p>\n<p>1）向prometheus进程发送SIGHUP信号</p>\n<p>2）curl -X POST <a href=\"http://localdns:9090/-/reload\">http://localdns:9090/-/reload</a> </p>"},{"title":"定义告警等级","date":"2021-09-01T02:38:00.000Z","_content":"\t\n\t\n摘要: prometheus 定义告警等级\n<!-- more -->\n\n\n在 rules.yml文件中，severity直接写在labels中，有五种等级，分别为 info、warning、critical、emergency、disaster。严重等级依次递增。\n\n等级分为 五级\n\n| 中文 | 英文 | 等级 |\n|---|---|---|\n| 信息 | info | 0 |\n| 警告 | warning | 1 |\n| 严重 | critical | 2|\n| 紧急 | emergency | 3 |\n| 灾难 | disaster | 4 |\n\n\n例子:\n```\ngroups:\n- name: PromRules\n  rules:\n  - alert: Node-Load\n    annotations: {\n\t\t\tdescription: 'descTest',\n\t\t\tsummary: 'summaryTest'\n\t\t}\n\t\texpr: node_load1 > 0.01\n\t\tfor: 30s\n\t\tlabels: {\n\t\t\tresType: 'Node',\n\t\t\tseverity: 'warning',\n\t\t\tlevel: 1\n\t\t}\n\n  - alert: Node-Load\n    annotations: {\n\t\t\tdescription: 'descTest',\n      summary: 'summaryTest'\n\t\t}\n    expr: node_load1 > 0.5\n    for: 30s\n    labels: {\n\t\t\tresType: 'Node',\n\t\t\tseverity: 'critical',\n\t\t\tlevel: 2\n\t\t}\n\n```\n","source":"_posts/prometheus/告警规则.md","raw":"---\ntitle: 定义告警等级\ndate: 2021-09-01 10:38\ncategories:\n- prometheus\ntags:\n- prometheus\n---\n\t\n\t\n摘要: prometheus 定义告警等级\n<!-- more -->\n\n\n在 rules.yml文件中，severity直接写在labels中，有五种等级，分别为 info、warning、critical、emergency、disaster。严重等级依次递增。\n\n等级分为 五级\n\n| 中文 | 英文 | 等级 |\n|---|---|---|\n| 信息 | info | 0 |\n| 警告 | warning | 1 |\n| 严重 | critical | 2|\n| 紧急 | emergency | 3 |\n| 灾难 | disaster | 4 |\n\n\n例子:\n```\ngroups:\n- name: PromRules\n  rules:\n  - alert: Node-Load\n    annotations: {\n\t\t\tdescription: 'descTest',\n\t\t\tsummary: 'summaryTest'\n\t\t}\n\t\texpr: node_load1 > 0.01\n\t\tfor: 30s\n\t\tlabels: {\n\t\t\tresType: 'Node',\n\t\t\tseverity: 'warning',\n\t\t\tlevel: 1\n\t\t}\n\n  - alert: Node-Load\n    annotations: {\n\t\t\tdescription: 'descTest',\n      summary: 'summaryTest'\n\t\t}\n    expr: node_load1 > 0.5\n    for: 30s\n    labels: {\n\t\t\tresType: 'Node',\n\t\t\tseverity: 'critical',\n\t\t\tlevel: 2\n\t\t}\n\n```\n","slug":"prometheus/告警规则","published":1,"updated":"2021-09-01T03:05:26.457Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cku697a0p006o00uh0ay053e3","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><p>摘要: prometheus 定义告警等级</p>\n<span id=\"more\"></span>\n\n\n<p>在 rules.yml文件中，severity直接写在labels中，有五种等级，分别为 info、warning、critical、emergency、disaster。严重等级依次递增。</p>\n<p>等级分为 五级</p>\n<table>\n<thead>\n<tr>\n<th>中文</th>\n<th>英文</th>\n<th>等级</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>信息</td>\n<td>info</td>\n<td>0</td>\n</tr>\n<tr>\n<td>警告</td>\n<td>warning</td>\n<td>1</td>\n</tr>\n<tr>\n<td>严重</td>\n<td>critical</td>\n<td>2</td>\n</tr>\n<tr>\n<td>紧急</td>\n<td>emergency</td>\n<td>3</td>\n</tr>\n<tr>\n<td>灾难</td>\n<td>disaster</td>\n<td>4</td>\n</tr>\n</tbody></table>\n<p>例子:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">groups:</span><br><span class=\"line\">- name: PromRules</span><br><span class=\"line\">  rules:</span><br><span class=\"line\">  - alert: Node-Load</span><br><span class=\"line\">    annotations: &#123;</span><br><span class=\"line\">\t\t\tdescription: &#39;descTest&#39;,</span><br><span class=\"line\">\t\t\tsummary: &#39;summaryTest&#39;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\texpr: node_load1 &gt; 0.01</span><br><span class=\"line\">\t\tfor: 30s</span><br><span class=\"line\">\t\tlabels: &#123;</span><br><span class=\"line\">\t\t\tresType: &#39;Node&#39;,</span><br><span class=\"line\">\t\t\tseverity: &#39;warning&#39;,</span><br><span class=\"line\">\t\t\tlevel: 1</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  - alert: Node-Load</span><br><span class=\"line\">    annotations: &#123;</span><br><span class=\"line\">\t\t\tdescription: &#39;descTest&#39;,</span><br><span class=\"line\">      summary: &#39;summaryTest&#39;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">    expr: node_load1 &gt; 0.5</span><br><span class=\"line\">    for: 30s</span><br><span class=\"line\">    labels: &#123;</span><br><span class=\"line\">\t\t\tresType: &#39;Node&#39;,</span><br><span class=\"line\">\t\t\tseverity: &#39;critical&#39;,</span><br><span class=\"line\">\t\t\tlevel: 2</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"<p>摘要: prometheus 定义告警等级</p>","more":"<p>在 rules.yml文件中，severity直接写在labels中，有五种等级，分别为 info、warning、critical、emergency、disaster。严重等级依次递增。</p>\n<p>等级分为 五级</p>\n<table>\n<thead>\n<tr>\n<th>中文</th>\n<th>英文</th>\n<th>等级</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>信息</td>\n<td>info</td>\n<td>0</td>\n</tr>\n<tr>\n<td>警告</td>\n<td>warning</td>\n<td>1</td>\n</tr>\n<tr>\n<td>严重</td>\n<td>critical</td>\n<td>2</td>\n</tr>\n<tr>\n<td>紧急</td>\n<td>emergency</td>\n<td>3</td>\n</tr>\n<tr>\n<td>灾难</td>\n<td>disaster</td>\n<td>4</td>\n</tr>\n</tbody></table>\n<p>例子:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">groups:</span><br><span class=\"line\">- name: PromRules</span><br><span class=\"line\">  rules:</span><br><span class=\"line\">  - alert: Node-Load</span><br><span class=\"line\">    annotations: &#123;</span><br><span class=\"line\">\t\t\tdescription: &#39;descTest&#39;,</span><br><span class=\"line\">\t\t\tsummary: &#39;summaryTest&#39;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\texpr: node_load1 &gt; 0.01</span><br><span class=\"line\">\t\tfor: 30s</span><br><span class=\"line\">\t\tlabels: &#123;</span><br><span class=\"line\">\t\t\tresType: &#39;Node&#39;,</span><br><span class=\"line\">\t\t\tseverity: &#39;warning&#39;,</span><br><span class=\"line\">\t\t\tlevel: 1</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  - alert: Node-Load</span><br><span class=\"line\">    annotations: &#123;</span><br><span class=\"line\">\t\t\tdescription: &#39;descTest&#39;,</span><br><span class=\"line\">      summary: &#39;summaryTest&#39;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">    expr: node_load1 &gt; 0.5</span><br><span class=\"line\">    for: 30s</span><br><span class=\"line\">    labels: &#123;</span><br><span class=\"line\">\t\t\tresType: &#39;Node&#39;,</span><br><span class=\"line\">\t\t\tseverity: &#39;critical&#39;,</span><br><span class=\"line\">\t\t\tlevel: 2</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>"},{"title":"钉钉报警","date":"2020-09-28T02:46:00.000Z","_content":"  \n  \n摘要: prometheus 使用钉钉报警 python demo 版本\n<!-- more -->\n\n\n### 方式一\n\nprometheus 使用 prometheus-webhook-dingtalk 完成钉钉报警\n\n`https://github.com/timonwong/prometheus-webhook-dingtalk`\n\n\n```\nvim /usr/lib/systemd/system/prometheus-webhook-dingtalk.service\n\n\n[Unit]\nDescription=prometheus-webhook-dingtalk\nAfter=network-online.target\n \n[Service]\nRestart=on-failure\nExecStart=/opt/alertmanager/prometheus-webhook-dingtalk/prometheus-webhook-dingtalk \\\n          --ding.profile=ops_dingding=https://oapi.dingtalk.com/robot/send?access_token=省略一串字符 \\\n          --ding.profile=info_dingding=https://oapi.dingtalk.com/robot/send?access_token=同样省略了一串字符\n \n[Install]\nWantedBy=multi-user.target\n```\n\n\n\n```\n配置开机启动\n\nsystemctl daemon-reload\nsystemctl enable prometheus-webhook-dingtalk\nsystemctl restart prometheus-webhook-dingtalk\nsystemctl status prometheus-webhook-dingtalk\n```\n\n###  方式二\n\n使用python脚本发送钉钉报警\n\n\n`app.py`\n```python\nimport os\nimport json\nimport logging\nimport requests\nimport time\nimport hmac\nimport hashlib\nimport base64\nimport urllib.parse\nfrom config import *\nfrom dateutil import parser\n\nfrom flask import Flask\nfrom flask import request\n\napp = Flask(__name__)\n\nlogging.basicConfig(\n    level=logging.DEBUG if os.getenv('LOG_LEVEL') == 'debug' else logging.INFO,\n    format='%(asctime)s %(levelname)s %(message)s')\n\n\n@app.route('/', methods=['POST', 'GET'])\ndef send():\n    try:\n        content = json.loads(request.get_data())\n        project = \"\"\n\n        for alert in content['alerts']:\n            if alert['status'] == \"resolved\":\n                status = \"恢复\"\n            elif alert['status'] == \"firing\":\n                status = \"故障\"\n            else:\n                status = \"\"\n\n            message = status + \" | \" + alert['labels']['alertname'] + \"\\n\\n\"\n\n            if 'hostname' in alert['labels']:\n                message += \"告警主机: \" + alert['labels']['hostname'] + \"\\n\\n\"\n\n            if 'name' in alert['labels']:\n                message += \"告警地址: \" + alert['labels']['instance'] + \"(\" + alert['labels']['name'] + \")\\n\\n\"\n            else:\n                message += \"告警地址: \" + alert['labels']['instance'] + \"\\n\\n\"\n\n            if 'project' in alert['labels']:\n                message += \"告警项目: \" + alert['labels']['project'] + \"\\n\\n\"\n                project = alert['labels']['project']\n\n            if 'env' in alert['labels']:\n                message += \"告警环境: \" + alert['labels']['env'] + \"\\n\\n\"\n\n            if 'info' in alert['annotations']:\n                message += \"Info: \" + alert['annotations']['info'] + \"\\n\\n\"\n            if 'summary' in alert['annotations']:\n                message += \"Summary: \" + alert['annotations']['summary'] + \"\\n\\n\"\n            if 'description' in alert['annotations']:\n                message += \"告警信息: \" + alert['annotations']['description'] + \"\\n\\n\"\n\n            if alert['status'] == \"resolved\":\n                correctDate = parser.parse(alert['endsAt']).strftime('%Y-%m-%d %H:%M:%S')\n                message += \"恢复时间: \" + correctDate\n            elif alert['status'] == \"firing\":\n                correctDate = parser.parse(alert['startsAt']).strftime('%Y-%m-%d %H:%M:%S')\n                message += \"告警时间: \" + correctDate\n            print(message)\n\n            send_alert_02(message, project)\n        return \"Alert OK\", 200\n    except Exception as error:\n        app.logger.info(\"\\t%s\", error)\n        return \"Alert fail\", 200\n\n\ndef make_sign(timestamp, secret):\n    \"\"\"\n    新版钉钉更新了安全策略，这里我们采用签名的方式进行安全认证\n    https://ding-doc.dingtalk.com/doc#/serverapi2/qf2nxq\n    \"\"\"\n    secret_enc = bytes(secret, 'utf-8')\n    string_to_sign = '{}\\n{}'.format(timestamp, secret)\n    string_to_sign_enc = bytes(string_to_sign, 'utf-8')\n    hmac_code = hmac.new(secret_enc, string_to_sign_enc, digestmod=hashlib.sha256).digest()\n    sign = urllib.parse.quote_plus(base64.b64encode(hmac_code))\n    return sign\n\n\ndef send_alert(data):\n    \"\"\"\n    签名的方式进行安全认证\n    :param data:\n    :return:\n    \"\"\"\n    if not token:\n        app.logger.error('you must set ROBOT_TOKEN env')\n        return\n    if not secret:\n        app.logger.error('you must set ROBOT_SECRET env')\n        return\n    timestamp = int(round(time.time() * 1000))\n    url = 'https://oapi.dingtalk.com/robot/send?access_token=%s&timestamp=%d&sign=%s' % (\n        token, timestamp, make_sign(timestamp, secret))\n    send_data = {\n        \"msgtype\": \"text\",\n        \"text\": {\n            \"content\": data\n        },\n        \"at\": {\n            \"atMobiles\": mobiles,\n            \"isAtAll\": 'false'\n        }\n    }\n    req = requests.post(url, json=send_data)\n    result = req.json()\n    if result['errcode'] != 0:\n        app.logger.error('notify dingtalk error: %s' % result['errcode'])\n\n\ndef send_alert_02(data, project):\n    \"\"\"\n    未签名认证方式\n    \"\"\"\n    accessToken = \"https://oapi.dingtalk.com/robot/send?access_token={}\".format(dingding_token[project])\n    HEADERS = {\n        \"Content-Type\": \"application/json ;charset=utf-8 \"\n    }\n    mobiles = []\n    lists = contacts[\"{}\".format(project)]\n    print(lists)\n    for j in lists:\n        mobiles.append(j[\"mobiles\"])\n    send_data = {\n        \"msgtype\": \"text\",\n        \"text\": {\n            \"content\": data\n        },\n        \"at\": {\n            \"atMobiles\": mobiles,\n            \"isAtAll\": 'false'\n        }\n    }\n    String_textMsg = json.dumps(send_data)\n    res = requests.post(accessToken, data=String_textMsg, headers=HEADERS)\n    print(res)\n\n\nif __name__ == '__main__':\n    app.run(host='0.0.0.0', port=5000)\n```\n\n`config.py`\n```python\ndingding_token = {\n    \"wms\": \"8647622d3103fn656b6hvytg7j6h56j7h567nkjbuhvygyb6bv5c5xf56v4c0ed63a5\",\n    \"oms\": \"69c7359b21ed1b1d23cv36vb7b88lk6g5ffuhuioiiijyihytugrtyfef38e0f96399\"\n}\n\ntoken = 'cf31a0c0f2d9cc28d4234234234234234234234234234234234234b51276a6b01a6a'\nsecret = 'SEC1a4e9326a23423423423423423423423423423553454565756756756afe3f044337'\n\ncontacts = {\n    \"oms\": [\n        {\n            \"mobiles\": \"13554000007\",\n            \"name\": \"xxxx\"\n        },\n        {\n            \"mobiles\": \"1875000004\",\n            \"name\": \"xxxxx\"\n        },\n    ],\n    \"wms\": [\n        {\n            \"mobiles\": \"13554000007\",\n            \"name\": \"xxxx\"\n        },\n        {\n            \"mobiles\": \"1875000004\",\n            \"name\": \"xxxxx\"\n        },\n    ]\n}\n```\n\n\n\n### prometheus 报警规则\n\nrules/cpu.yml\n```yaml\ngroups:\n- name: CPU报警规则\n  rules:\n  - alert: CPU使用率告警\n    expr: 100 - (avg by (instance)(irate(node_cpu_seconds_total{mode=\"idle\"}[1m]) )) * 100 > 90\n    for: 2m\n    labels:\n      level: base\n      severity: warning\n    annotations:\n      description: \"CPU使用超过90%！(当前值: {{ $value }}%)\"\n```\nrules/disk.yml\n```yaml\ngroups:\n- name: 磁盘报警规则\n  rules:\n  - alert: 磁盘使用率告警\n    expr: ceil(((node_filesystem_size_bytes {device=~\"(/dev/.*|/)\",fstype=~\"(ext4|xfs)\"} - node_filesystem_free_bytes {device=~\"(/dev/.*|/)\",fstype=~\"(ext4|xfs)\"}) / node_filesystem_size_bytes {device=~\"(/dev/.*|/)\",fstype=~\"(ext4|xfs)\"} ) * 100  > 85 )\n    for: 2m\n    labels:\n      level: base\n      severity: warning\n    annotations:\n      description: \" {{ $labels.mountpoint }} 使用超过 85% (当前值: {{ $value }})\"\n\n```\nrules/mem.yml\n```yaml\ngroups:\n- name: 内存报警规则\n  rules:\n  - alert: 内存使用率告警\n    expr: ceil((node_memory_MemTotal_bytes - (node_memory_MemFree_bytes+node_memory_Buffers_bytes+node_memory_Cached_bytes )) / node_memory_MemTotal_bytes * 100 > 85)\n    for: 2m\n    labels:\n      level: base\n      severity: warning\n    annotations:\n      description: \"内存使用超过80%！(当前值: {{ $value }}%)\"\n```\nrules/node.yml\n```yaml\ngroups:\n- name: 实例存活告警规则\n  rules:\n  - alert: 主机状态\n    expr: up == 0\n    for: 2m\n    labels:\n      level: base\n      project: base\n      severity: warning\n    annotations:\n      description: \" 主机(或监控节点)发生宕机超过1分钟\"\n```\n\nrules/net.yml\n```yaml\ngroups:\n- name: 网络告警规则\n  rules:\n  - alert: 网络流入\n    expr: ((sum(rate (node_network_receive_bytes_total{device!~'tap.*|veth.*|br.*|docker.*|virbr*|lo*'}[5m])) by (instance)) / 100) > 102400\n    for: 1m\n    labels:\n      level: base\n      project: base\n      severity: warning\n    annotations:\n      summary: \"{{$labels.mountpoint}} 流入网络带宽过高！\"\n      description: \"{{$labels.mountpoint }}流入网络带宽持续2分钟高于100M. RX带宽使用率{{$value}}\"\n\n  - alert: 网络流出\n    expr: ((sum(rate (node_network_transmit_bytes_total{device!~'tap.*|veth.*|br.*|docker.*|virbr*|lo*'}[5m])) by (instance)) / 100) > 102400\n    for: 1m\n    labels:\n      level: base\n      project: base\n      severity: warning\n    annotations:\n      summary: \"{{$labels.mountpoint}} 流出网络带宽过高！\"\n      description: \"{{$labels.mountpoint }}流出网络带宽持续2分钟高于100M. RX带宽使用率{{$value}}\"\n\n  - alert: TCP会话\n    expr: node_netstat_Tcp_CurrEstab > 1000\n    for: 1m\n    labels:\n      level: base\n      project: base\n      severity: warning\n    annotations:\n      summary: \"{{$labels.mountpoint}} TCP_ESTABLISHED过高！\"\n      description: \"{{$labels.mountpoint }} TCP_ESTABLISHED大于1000%(目前使用:{{$value}}%)\"\n\n```\nrules/cpu.yml\nrules/cpu.yml\n","source":"_posts/prometheus/钉钉报警.md","raw":"---\ntitle: 钉钉报警\ndate: 2020-09-28 10:46\ncategories:\n- prometheus\ntags:\n- prometheus\n- dingding\n---\n  \n  \n摘要: prometheus 使用钉钉报警 python demo 版本\n<!-- more -->\n\n\n### 方式一\n\nprometheus 使用 prometheus-webhook-dingtalk 完成钉钉报警\n\n`https://github.com/timonwong/prometheus-webhook-dingtalk`\n\n\n```\nvim /usr/lib/systemd/system/prometheus-webhook-dingtalk.service\n\n\n[Unit]\nDescription=prometheus-webhook-dingtalk\nAfter=network-online.target\n \n[Service]\nRestart=on-failure\nExecStart=/opt/alertmanager/prometheus-webhook-dingtalk/prometheus-webhook-dingtalk \\\n          --ding.profile=ops_dingding=https://oapi.dingtalk.com/robot/send?access_token=省略一串字符 \\\n          --ding.profile=info_dingding=https://oapi.dingtalk.com/robot/send?access_token=同样省略了一串字符\n \n[Install]\nWantedBy=multi-user.target\n```\n\n\n\n```\n配置开机启动\n\nsystemctl daemon-reload\nsystemctl enable prometheus-webhook-dingtalk\nsystemctl restart prometheus-webhook-dingtalk\nsystemctl status prometheus-webhook-dingtalk\n```\n\n###  方式二\n\n使用python脚本发送钉钉报警\n\n\n`app.py`\n```python\nimport os\nimport json\nimport logging\nimport requests\nimport time\nimport hmac\nimport hashlib\nimport base64\nimport urllib.parse\nfrom config import *\nfrom dateutil import parser\n\nfrom flask import Flask\nfrom flask import request\n\napp = Flask(__name__)\n\nlogging.basicConfig(\n    level=logging.DEBUG if os.getenv('LOG_LEVEL') == 'debug' else logging.INFO,\n    format='%(asctime)s %(levelname)s %(message)s')\n\n\n@app.route('/', methods=['POST', 'GET'])\ndef send():\n    try:\n        content = json.loads(request.get_data())\n        project = \"\"\n\n        for alert in content['alerts']:\n            if alert['status'] == \"resolved\":\n                status = \"恢复\"\n            elif alert['status'] == \"firing\":\n                status = \"故障\"\n            else:\n                status = \"\"\n\n            message = status + \" | \" + alert['labels']['alertname'] + \"\\n\\n\"\n\n            if 'hostname' in alert['labels']:\n                message += \"告警主机: \" + alert['labels']['hostname'] + \"\\n\\n\"\n\n            if 'name' in alert['labels']:\n                message += \"告警地址: \" + alert['labels']['instance'] + \"(\" + alert['labels']['name'] + \")\\n\\n\"\n            else:\n                message += \"告警地址: \" + alert['labels']['instance'] + \"\\n\\n\"\n\n            if 'project' in alert['labels']:\n                message += \"告警项目: \" + alert['labels']['project'] + \"\\n\\n\"\n                project = alert['labels']['project']\n\n            if 'env' in alert['labels']:\n                message += \"告警环境: \" + alert['labels']['env'] + \"\\n\\n\"\n\n            if 'info' in alert['annotations']:\n                message += \"Info: \" + alert['annotations']['info'] + \"\\n\\n\"\n            if 'summary' in alert['annotations']:\n                message += \"Summary: \" + alert['annotations']['summary'] + \"\\n\\n\"\n            if 'description' in alert['annotations']:\n                message += \"告警信息: \" + alert['annotations']['description'] + \"\\n\\n\"\n\n            if alert['status'] == \"resolved\":\n                correctDate = parser.parse(alert['endsAt']).strftime('%Y-%m-%d %H:%M:%S')\n                message += \"恢复时间: \" + correctDate\n            elif alert['status'] == \"firing\":\n                correctDate = parser.parse(alert['startsAt']).strftime('%Y-%m-%d %H:%M:%S')\n                message += \"告警时间: \" + correctDate\n            print(message)\n\n            send_alert_02(message, project)\n        return \"Alert OK\", 200\n    except Exception as error:\n        app.logger.info(\"\\t%s\", error)\n        return \"Alert fail\", 200\n\n\ndef make_sign(timestamp, secret):\n    \"\"\"\n    新版钉钉更新了安全策略，这里我们采用签名的方式进行安全认证\n    https://ding-doc.dingtalk.com/doc#/serverapi2/qf2nxq\n    \"\"\"\n    secret_enc = bytes(secret, 'utf-8')\n    string_to_sign = '{}\\n{}'.format(timestamp, secret)\n    string_to_sign_enc = bytes(string_to_sign, 'utf-8')\n    hmac_code = hmac.new(secret_enc, string_to_sign_enc, digestmod=hashlib.sha256).digest()\n    sign = urllib.parse.quote_plus(base64.b64encode(hmac_code))\n    return sign\n\n\ndef send_alert(data):\n    \"\"\"\n    签名的方式进行安全认证\n    :param data:\n    :return:\n    \"\"\"\n    if not token:\n        app.logger.error('you must set ROBOT_TOKEN env')\n        return\n    if not secret:\n        app.logger.error('you must set ROBOT_SECRET env')\n        return\n    timestamp = int(round(time.time() * 1000))\n    url = 'https://oapi.dingtalk.com/robot/send?access_token=%s&timestamp=%d&sign=%s' % (\n        token, timestamp, make_sign(timestamp, secret))\n    send_data = {\n        \"msgtype\": \"text\",\n        \"text\": {\n            \"content\": data\n        },\n        \"at\": {\n            \"atMobiles\": mobiles,\n            \"isAtAll\": 'false'\n        }\n    }\n    req = requests.post(url, json=send_data)\n    result = req.json()\n    if result['errcode'] != 0:\n        app.logger.error('notify dingtalk error: %s' % result['errcode'])\n\n\ndef send_alert_02(data, project):\n    \"\"\"\n    未签名认证方式\n    \"\"\"\n    accessToken = \"https://oapi.dingtalk.com/robot/send?access_token={}\".format(dingding_token[project])\n    HEADERS = {\n        \"Content-Type\": \"application/json ;charset=utf-8 \"\n    }\n    mobiles = []\n    lists = contacts[\"{}\".format(project)]\n    print(lists)\n    for j in lists:\n        mobiles.append(j[\"mobiles\"])\n    send_data = {\n        \"msgtype\": \"text\",\n        \"text\": {\n            \"content\": data\n        },\n        \"at\": {\n            \"atMobiles\": mobiles,\n            \"isAtAll\": 'false'\n        }\n    }\n    String_textMsg = json.dumps(send_data)\n    res = requests.post(accessToken, data=String_textMsg, headers=HEADERS)\n    print(res)\n\n\nif __name__ == '__main__':\n    app.run(host='0.0.0.0', port=5000)\n```\n\n`config.py`\n```python\ndingding_token = {\n    \"wms\": \"8647622d3103fn656b6hvytg7j6h56j7h567nkjbuhvygyb6bv5c5xf56v4c0ed63a5\",\n    \"oms\": \"69c7359b21ed1b1d23cv36vb7b88lk6g5ffuhuioiiijyihytugrtyfef38e0f96399\"\n}\n\ntoken = 'cf31a0c0f2d9cc28d4234234234234234234234234234234234234b51276a6b01a6a'\nsecret = 'SEC1a4e9326a23423423423423423423423423423553454565756756756afe3f044337'\n\ncontacts = {\n    \"oms\": [\n        {\n            \"mobiles\": \"13554000007\",\n            \"name\": \"xxxx\"\n        },\n        {\n            \"mobiles\": \"1875000004\",\n            \"name\": \"xxxxx\"\n        },\n    ],\n    \"wms\": [\n        {\n            \"mobiles\": \"13554000007\",\n            \"name\": \"xxxx\"\n        },\n        {\n            \"mobiles\": \"1875000004\",\n            \"name\": \"xxxxx\"\n        },\n    ]\n}\n```\n\n\n\n### prometheus 报警规则\n\nrules/cpu.yml\n```yaml\ngroups:\n- name: CPU报警规则\n  rules:\n  - alert: CPU使用率告警\n    expr: 100 - (avg by (instance)(irate(node_cpu_seconds_total{mode=\"idle\"}[1m]) )) * 100 > 90\n    for: 2m\n    labels:\n      level: base\n      severity: warning\n    annotations:\n      description: \"CPU使用超过90%！(当前值: {{ $value }}%)\"\n```\nrules/disk.yml\n```yaml\ngroups:\n- name: 磁盘报警规则\n  rules:\n  - alert: 磁盘使用率告警\n    expr: ceil(((node_filesystem_size_bytes {device=~\"(/dev/.*|/)\",fstype=~\"(ext4|xfs)\"} - node_filesystem_free_bytes {device=~\"(/dev/.*|/)\",fstype=~\"(ext4|xfs)\"}) / node_filesystem_size_bytes {device=~\"(/dev/.*|/)\",fstype=~\"(ext4|xfs)\"} ) * 100  > 85 )\n    for: 2m\n    labels:\n      level: base\n      severity: warning\n    annotations:\n      description: \" {{ $labels.mountpoint }} 使用超过 85% (当前值: {{ $value }})\"\n\n```\nrules/mem.yml\n```yaml\ngroups:\n- name: 内存报警规则\n  rules:\n  - alert: 内存使用率告警\n    expr: ceil((node_memory_MemTotal_bytes - (node_memory_MemFree_bytes+node_memory_Buffers_bytes+node_memory_Cached_bytes )) / node_memory_MemTotal_bytes * 100 > 85)\n    for: 2m\n    labels:\n      level: base\n      severity: warning\n    annotations:\n      description: \"内存使用超过80%！(当前值: {{ $value }}%)\"\n```\nrules/node.yml\n```yaml\ngroups:\n- name: 实例存活告警规则\n  rules:\n  - alert: 主机状态\n    expr: up == 0\n    for: 2m\n    labels:\n      level: base\n      project: base\n      severity: warning\n    annotations:\n      description: \" 主机(或监控节点)发生宕机超过1分钟\"\n```\n\nrules/net.yml\n```yaml\ngroups:\n- name: 网络告警规则\n  rules:\n  - alert: 网络流入\n    expr: ((sum(rate (node_network_receive_bytes_total{device!~'tap.*|veth.*|br.*|docker.*|virbr*|lo*'}[5m])) by (instance)) / 100) > 102400\n    for: 1m\n    labels:\n      level: base\n      project: base\n      severity: warning\n    annotations:\n      summary: \"{{$labels.mountpoint}} 流入网络带宽过高！\"\n      description: \"{{$labels.mountpoint }}流入网络带宽持续2分钟高于100M. RX带宽使用率{{$value}}\"\n\n  - alert: 网络流出\n    expr: ((sum(rate (node_network_transmit_bytes_total{device!~'tap.*|veth.*|br.*|docker.*|virbr*|lo*'}[5m])) by (instance)) / 100) > 102400\n    for: 1m\n    labels:\n      level: base\n      project: base\n      severity: warning\n    annotations:\n      summary: \"{{$labels.mountpoint}} 流出网络带宽过高！\"\n      description: \"{{$labels.mountpoint }}流出网络带宽持续2分钟高于100M. RX带宽使用率{{$value}}\"\n\n  - alert: TCP会话\n    expr: node_netstat_Tcp_CurrEstab > 1000\n    for: 1m\n    labels:\n      level: base\n      project: base\n      severity: warning\n    annotations:\n      summary: \"{{$labels.mountpoint}} TCP_ESTABLISHED过高！\"\n      description: \"{{$labels.mountpoint }} TCP_ESTABLISHED大于1000%(目前使用:{{$value}}%)\"\n\n```\nrules/cpu.yml\nrules/cpu.yml\n","slug":"prometheus/钉钉报警","published":1,"updated":"2021-09-01T02:36:21.470Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cku697a0q006r00uh3mci2cf8","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><p>摘要: prometheus 使用钉钉报警 python demo 版本</p>\n<span id=\"more\"></span>\n\n\n<h3 id=\"方式一\"><a href=\"#方式一\" class=\"headerlink\" title=\"方式一\"></a>方式一</h3><p>prometheus 使用 prometheus-webhook-dingtalk 完成钉钉报警</p>\n<p><code>https://github.com/timonwong/prometheus-webhook-dingtalk</code></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim &#x2F;usr&#x2F;lib&#x2F;systemd&#x2F;system&#x2F;prometheus-webhook-dingtalk.service</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">[Unit]</span><br><span class=\"line\">Description&#x3D;prometheus-webhook-dingtalk</span><br><span class=\"line\">After&#x3D;network-online.target</span><br><span class=\"line\"> </span><br><span class=\"line\">[Service]</span><br><span class=\"line\">Restart&#x3D;on-failure</span><br><span class=\"line\">ExecStart&#x3D;&#x2F;opt&#x2F;alertmanager&#x2F;prometheus-webhook-dingtalk&#x2F;prometheus-webhook-dingtalk \\</span><br><span class=\"line\">          --ding.profile&#x3D;ops_dingding&#x3D;https:&#x2F;&#x2F;oapi.dingtalk.com&#x2F;robot&#x2F;send?access_token&#x3D;省略一串字符 \\</span><br><span class=\"line\">          --ding.profile&#x3D;info_dingding&#x3D;https:&#x2F;&#x2F;oapi.dingtalk.com&#x2F;robot&#x2F;send?access_token&#x3D;同样省略了一串字符</span><br><span class=\"line\"> </span><br><span class=\"line\">[Install]</span><br><span class=\"line\">WantedBy&#x3D;multi-user.target</span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">配置开机启动</span><br><span class=\"line\"></span><br><span class=\"line\">systemctl daemon-reload</span><br><span class=\"line\">systemctl enable prometheus-webhook-dingtalk</span><br><span class=\"line\">systemctl restart prometheus-webhook-dingtalk</span><br><span class=\"line\">systemctl status prometheus-webhook-dingtalk</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"方式二\"><a href=\"#方式二\" class=\"headerlink\" title=\"方式二\"></a>方式二</h3><p>使用python脚本发送钉钉报警</p>\n<p><code>app.py</code></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> os</span><br><span class=\"line\"><span class=\"keyword\">import</span> json</span><br><span class=\"line\"><span class=\"keyword\">import</span> logging</span><br><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"><span class=\"keyword\">import</span> time</span><br><span class=\"line\"><span class=\"keyword\">import</span> hmac</span><br><span class=\"line\"><span class=\"keyword\">import</span> hashlib</span><br><span class=\"line\"><span class=\"keyword\">import</span> base64</span><br><span class=\"line\"><span class=\"keyword\">import</span> urllib.parse</span><br><span class=\"line\"><span class=\"keyword\">from</span> config <span class=\"keyword\">import</span> *</span><br><span class=\"line\"><span class=\"keyword\">from</span> dateutil <span class=\"keyword\">import</span> parser</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">from</span> flask <span class=\"keyword\">import</span> Flask</span><br><span class=\"line\"><span class=\"keyword\">from</span> flask <span class=\"keyword\">import</span> request</span><br><span class=\"line\"></span><br><span class=\"line\">app = Flask(__name__)</span><br><span class=\"line\"></span><br><span class=\"line\">logging.basicConfig(</span><br><span class=\"line\">    level=logging.DEBUG <span class=\"keyword\">if</span> os.getenv(<span class=\"string\">&#x27;LOG_LEVEL&#x27;</span>) == <span class=\"string\">&#x27;debug&#x27;</span> <span class=\"keyword\">else</span> logging.INFO,</span><br><span class=\"line\">    <span class=\"built_in\">format</span>=<span class=\"string\">&#x27;%(asctime)s %(levelname)s %(message)s&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@app.route(<span class=\"params\"><span class=\"string\">&#x27;/&#x27;</span>, methods=[<span class=\"string\">&#x27;POST&#x27;</span>, <span class=\"string\">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">send</span>():</span></span><br><span class=\"line\">    <span class=\"keyword\">try</span>:</span><br><span class=\"line\">        content = json.loads(request.get_data())</span><br><span class=\"line\">        project = <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">for</span> alert <span class=\"keyword\">in</span> content[<span class=\"string\">&#x27;alerts&#x27;</span>]:</span><br><span class=\"line\">            <span class=\"keyword\">if</span> alert[<span class=\"string\">&#x27;status&#x27;</span>] == <span class=\"string\">&quot;resolved&quot;</span>:</span><br><span class=\"line\">                status = <span class=\"string\">&quot;恢复&quot;</span></span><br><span class=\"line\">            <span class=\"keyword\">elif</span> alert[<span class=\"string\">&#x27;status&#x27;</span>] == <span class=\"string\">&quot;firing&quot;</span>:</span><br><span class=\"line\">                status = <span class=\"string\">&quot;故障&quot;</span></span><br><span class=\"line\">            <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                status = <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">            message = status + <span class=\"string\">&quot; | &quot;</span> + alert[<span class=\"string\">&#x27;labels&#x27;</span>][<span class=\"string\">&#x27;alertname&#x27;</span>] + <span class=\"string\">&quot;\\n\\n&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span> <span class=\"string\">&#x27;hostname&#x27;</span> <span class=\"keyword\">in</span> alert[<span class=\"string\">&#x27;labels&#x27;</span>]:</span><br><span class=\"line\">                message += <span class=\"string\">&quot;告警主机: &quot;</span> + alert[<span class=\"string\">&#x27;labels&#x27;</span>][<span class=\"string\">&#x27;hostname&#x27;</span>] + <span class=\"string\">&quot;\\n\\n&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span> <span class=\"string\">&#x27;name&#x27;</span> <span class=\"keyword\">in</span> alert[<span class=\"string\">&#x27;labels&#x27;</span>]:</span><br><span class=\"line\">                message += <span class=\"string\">&quot;告警地址: &quot;</span> + alert[<span class=\"string\">&#x27;labels&#x27;</span>][<span class=\"string\">&#x27;instance&#x27;</span>] + <span class=\"string\">&quot;(&quot;</span> + alert[<span class=\"string\">&#x27;labels&#x27;</span>][<span class=\"string\">&#x27;name&#x27;</span>] + <span class=\"string\">&quot;)\\n\\n&quot;</span></span><br><span class=\"line\">            <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                message += <span class=\"string\">&quot;告警地址: &quot;</span> + alert[<span class=\"string\">&#x27;labels&#x27;</span>][<span class=\"string\">&#x27;instance&#x27;</span>] + <span class=\"string\">&quot;\\n\\n&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span> <span class=\"string\">&#x27;project&#x27;</span> <span class=\"keyword\">in</span> alert[<span class=\"string\">&#x27;labels&#x27;</span>]:</span><br><span class=\"line\">                message += <span class=\"string\">&quot;告警项目: &quot;</span> + alert[<span class=\"string\">&#x27;labels&#x27;</span>][<span class=\"string\">&#x27;project&#x27;</span>] + <span class=\"string\">&quot;\\n\\n&quot;</span></span><br><span class=\"line\">                project = alert[<span class=\"string\">&#x27;labels&#x27;</span>][<span class=\"string\">&#x27;project&#x27;</span>]</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span> <span class=\"string\">&#x27;env&#x27;</span> <span class=\"keyword\">in</span> alert[<span class=\"string\">&#x27;labels&#x27;</span>]:</span><br><span class=\"line\">                message += <span class=\"string\">&quot;告警环境: &quot;</span> + alert[<span class=\"string\">&#x27;labels&#x27;</span>][<span class=\"string\">&#x27;env&#x27;</span>] + <span class=\"string\">&quot;\\n\\n&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span> <span class=\"string\">&#x27;info&#x27;</span> <span class=\"keyword\">in</span> alert[<span class=\"string\">&#x27;annotations&#x27;</span>]:</span><br><span class=\"line\">                message += <span class=\"string\">&quot;Info: &quot;</span> + alert[<span class=\"string\">&#x27;annotations&#x27;</span>][<span class=\"string\">&#x27;info&#x27;</span>] + <span class=\"string\">&quot;\\n\\n&quot;</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> <span class=\"string\">&#x27;summary&#x27;</span> <span class=\"keyword\">in</span> alert[<span class=\"string\">&#x27;annotations&#x27;</span>]:</span><br><span class=\"line\">                message += <span class=\"string\">&quot;Summary: &quot;</span> + alert[<span class=\"string\">&#x27;annotations&#x27;</span>][<span class=\"string\">&#x27;summary&#x27;</span>] + <span class=\"string\">&quot;\\n\\n&quot;</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> <span class=\"string\">&#x27;description&#x27;</span> <span class=\"keyword\">in</span> alert[<span class=\"string\">&#x27;annotations&#x27;</span>]:</span><br><span class=\"line\">                message += <span class=\"string\">&quot;告警信息: &quot;</span> + alert[<span class=\"string\">&#x27;annotations&#x27;</span>][<span class=\"string\">&#x27;description&#x27;</span>] + <span class=\"string\">&quot;\\n\\n&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span> alert[<span class=\"string\">&#x27;status&#x27;</span>] == <span class=\"string\">&quot;resolved&quot;</span>:</span><br><span class=\"line\">                correctDate = parser.parse(alert[<span class=\"string\">&#x27;endsAt&#x27;</span>]).strftime(<span class=\"string\">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span>)</span><br><span class=\"line\">                message += <span class=\"string\">&quot;恢复时间: &quot;</span> + correctDate</span><br><span class=\"line\">            <span class=\"keyword\">elif</span> alert[<span class=\"string\">&#x27;status&#x27;</span>] == <span class=\"string\">&quot;firing&quot;</span>:</span><br><span class=\"line\">                correctDate = parser.parse(alert[<span class=\"string\">&#x27;startsAt&#x27;</span>]).strftime(<span class=\"string\">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span>)</span><br><span class=\"line\">                message += <span class=\"string\">&quot;告警时间: &quot;</span> + correctDate</span><br><span class=\"line\">            print(message)</span><br><span class=\"line\"></span><br><span class=\"line\">            send_alert_02(message, project)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;Alert OK&quot;</span>, <span class=\"number\">200</span></span><br><span class=\"line\">    <span class=\"keyword\">except</span> Exception <span class=\"keyword\">as</span> error:</span><br><span class=\"line\">        app.logger.info(<span class=\"string\">&quot;\\t%s&quot;</span>, error)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;Alert fail&quot;</span>, <span class=\"number\">200</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">make_sign</span>(<span class=\"params\">timestamp, secret</span>):</span></span><br><span class=\"line\">    <span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"string\">    新版钉钉更新了安全策略，这里我们采用签名的方式进行安全认证</span></span><br><span class=\"line\"><span class=\"string\">    https://ding-doc.dingtalk.com/doc#/serverapi2/qf2nxq</span></span><br><span class=\"line\"><span class=\"string\">    &quot;&quot;&quot;</span></span><br><span class=\"line\">    secret_enc = <span class=\"built_in\">bytes</span>(secret, <span class=\"string\">&#x27;utf-8&#x27;</span>)</span><br><span class=\"line\">    string_to_sign = <span class=\"string\">&#x27;&#123;&#125;\\n&#123;&#125;&#x27;</span>.<span class=\"built_in\">format</span>(timestamp, secret)</span><br><span class=\"line\">    string_to_sign_enc = <span class=\"built_in\">bytes</span>(string_to_sign, <span class=\"string\">&#x27;utf-8&#x27;</span>)</span><br><span class=\"line\">    hmac_code = hmac.new(secret_enc, string_to_sign_enc, digestmod=hashlib.sha256).digest()</span><br><span class=\"line\">    sign = urllib.parse.quote_plus(base64.b64encode(hmac_code))</span><br><span class=\"line\">    <span class=\"keyword\">return</span> sign</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">send_alert</span>(<span class=\"params\">data</span>):</span></span><br><span class=\"line\">    <span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"string\">    签名的方式进行安全认证</span></span><br><span class=\"line\"><span class=\"string\">    :param data:</span></span><br><span class=\"line\"><span class=\"string\">    :return:</span></span><br><span class=\"line\"><span class=\"string\">    &quot;&quot;&quot;</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> token:</span><br><span class=\"line\">        app.logger.error(<span class=\"string\">&#x27;you must set ROBOT_TOKEN env&#x27;</span>)</span><br><span class=\"line\">        <span class=\"keyword\">return</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> secret:</span><br><span class=\"line\">        app.logger.error(<span class=\"string\">&#x27;you must set ROBOT_SECRET env&#x27;</span>)</span><br><span class=\"line\">        <span class=\"keyword\">return</span></span><br><span class=\"line\">    timestamp = <span class=\"built_in\">int</span>(<span class=\"built_in\">round</span>(time.time() * <span class=\"number\">1000</span>))</span><br><span class=\"line\">    url = <span class=\"string\">&#x27;https://oapi.dingtalk.com/robot/send?access_token=%s&amp;timestamp=%d&amp;sign=%s&#x27;</span> % (</span><br><span class=\"line\">        token, timestamp, make_sign(timestamp, secret))</span><br><span class=\"line\">    send_data = &#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;msgtype&quot;</span>: <span class=\"string\">&quot;text&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;text&quot;</span>: &#123;</span><br><span class=\"line\">            <span class=\"string\">&quot;content&quot;</span>: data</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        <span class=\"string\">&quot;at&quot;</span>: &#123;</span><br><span class=\"line\">            <span class=\"string\">&quot;atMobiles&quot;</span>: mobiles,</span><br><span class=\"line\">            <span class=\"string\">&quot;isAtAll&quot;</span>: <span class=\"string\">&#x27;false&#x27;</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    req = requests.post(url, json=send_data)</span><br><span class=\"line\">    result = req.json()</span><br><span class=\"line\">    <span class=\"keyword\">if</span> result[<span class=\"string\">&#x27;errcode&#x27;</span>] != <span class=\"number\">0</span>:</span><br><span class=\"line\">        app.logger.error(<span class=\"string\">&#x27;notify dingtalk error: %s&#x27;</span> % result[<span class=\"string\">&#x27;errcode&#x27;</span>])</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">send_alert_02</span>(<span class=\"params\">data, project</span>):</span></span><br><span class=\"line\">    <span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"string\">    未签名认证方式</span></span><br><span class=\"line\"><span class=\"string\">    &quot;&quot;&quot;</span></span><br><span class=\"line\">    accessToken = <span class=\"string\">&quot;https://oapi.dingtalk.com/robot/send?access_token=&#123;&#125;&quot;</span>.<span class=\"built_in\">format</span>(dingding_token[project])</span><br><span class=\"line\">    HEADERS = &#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;Content-Type&quot;</span>: <span class=\"string\">&quot;application/json ;charset=utf-8 &quot;</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    mobiles = []</span><br><span class=\"line\">    lists = contacts[<span class=\"string\">&quot;&#123;&#125;&quot;</span>.<span class=\"built_in\">format</span>(project)]</span><br><span class=\"line\">    print(lists)</span><br><span class=\"line\">    <span class=\"keyword\">for</span> j <span class=\"keyword\">in</span> lists:</span><br><span class=\"line\">        mobiles.append(j[<span class=\"string\">&quot;mobiles&quot;</span>])</span><br><span class=\"line\">    send_data = &#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;msgtype&quot;</span>: <span class=\"string\">&quot;text&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;text&quot;</span>: &#123;</span><br><span class=\"line\">            <span class=\"string\">&quot;content&quot;</span>: data</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        <span class=\"string\">&quot;at&quot;</span>: &#123;</span><br><span class=\"line\">            <span class=\"string\">&quot;atMobiles&quot;</span>: mobiles,</span><br><span class=\"line\">            <span class=\"string\">&quot;isAtAll&quot;</span>: <span class=\"string\">&#x27;false&#x27;</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    String_textMsg = json.dumps(send_data)</span><br><span class=\"line\">    res = requests.post(accessToken, data=String_textMsg, headers=HEADERS)</span><br><span class=\"line\">    print(res)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&#x27;__main__&#x27;</span>:</span><br><span class=\"line\">    app.run(host=<span class=\"string\">&#x27;0.0.0.0&#x27;</span>, port=<span class=\"number\">5000</span>)</span><br></pre></td></tr></table></figure>\n\n<p><code>config.py</code></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">dingding_token = &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;wms&quot;</span>: <span class=\"string\">&quot;8647622d3103fn656b6hvytg7j6h56j7h567nkjbuhvygyb6bv5c5xf56v4c0ed63a5&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;oms&quot;</span>: <span class=\"string\">&quot;69c7359b21ed1b1d23cv36vb7b88lk6g5ffuhuioiiijyihytugrtyfef38e0f96399&quot;</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">token = <span class=\"string\">&#x27;cf31a0c0f2d9cc28d4234234234234234234234234234234234234b51276a6b01a6a&#x27;</span></span><br><span class=\"line\">secret = <span class=\"string\">&#x27;SEC1a4e9326a23423423423423423423423423423553454565756756756afe3f044337&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">contacts = &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;oms&quot;</span>: [</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"string\">&quot;mobiles&quot;</span>: <span class=\"string\">&quot;13554000007&quot;</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;name&quot;</span>: <span class=\"string\">&quot;xxxx&quot;</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"string\">&quot;mobiles&quot;</span>: <span class=\"string\">&quot;1875000004&quot;</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;name&quot;</span>: <span class=\"string\">&quot;xxxxx&quot;</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">    ],</span><br><span class=\"line\">    <span class=\"string\">&quot;wms&quot;</span>: [</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"string\">&quot;mobiles&quot;</span>: <span class=\"string\">&quot;13554000007&quot;</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;name&quot;</span>: <span class=\"string\">&quot;xxxx&quot;</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"string\">&quot;mobiles&quot;</span>: <span class=\"string\">&quot;1875000004&quot;</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;name&quot;</span>: <span class=\"string\">&quot;xxxxx&quot;</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">    ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"prometheus-报警规则\"><a href=\"#prometheus-报警规则\" class=\"headerlink\" title=\"prometheus 报警规则\"></a>prometheus 报警规则</h3><p>rules/cpu.yml</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">groups:</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">CPU报警规则</span></span><br><span class=\"line\">  <span class=\"attr\">rules:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">alert:</span> <span class=\"string\">CPU使用率告警</span></span><br><span class=\"line\">    <span class=\"attr\">expr:</span> <span class=\"number\">100</span> <span class=\"bullet\">-</span> <span class=\"string\">(avg</span> <span class=\"string\">by</span> <span class=\"string\">(instance)(irate(node_cpu_seconds_total&#123;mode=&quot;idle&quot;&#125;[1m])</span> <span class=\"string\">))</span> <span class=\"string\">*</span> <span class=\"number\">100</span> <span class=\"string\">&gt;</span> <span class=\"number\">90</span></span><br><span class=\"line\">    <span class=\"attr\">for:</span> <span class=\"string\">2m</span></span><br><span class=\"line\">    <span class=\"attr\">labels:</span></span><br><span class=\"line\">      <span class=\"attr\">level:</span> <span class=\"string\">base</span></span><br><span class=\"line\">      <span class=\"attr\">severity:</span> <span class=\"string\">warning</span></span><br><span class=\"line\">    <span class=\"attr\">annotations:</span></span><br><span class=\"line\">      <span class=\"attr\">description:</span> <span class=\"string\">&quot;CPU使用超过90%！(当前值: <span class=\"template-variable\">&#123;&#123; $value &#125;&#125;</span>%)&quot;</span></span><br></pre></td></tr></table></figure>\n<p>rules/disk.yml</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">groups:</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">磁盘报警规则</span></span><br><span class=\"line\">  <span class=\"attr\">rules:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">alert:</span> <span class=\"string\">磁盘使用率告警</span></span><br><span class=\"line\">    <span class=\"attr\">expr:</span> <span class=\"string\">ceil(((node_filesystem_size_bytes</span> &#123;<span class=\"string\">device=~&quot;(/dev/.*|/)&quot;</span>,<span class=\"string\">fstype=~&quot;(ext4|xfs)&quot;</span>&#125; <span class=\"bullet\">-</span> <span class=\"string\">node_filesystem_free_bytes</span> &#123;<span class=\"string\">device=~&quot;(/dev/.*|/)&quot;</span>,<span class=\"string\">fstype=~&quot;(ext4|xfs)&quot;</span>&#125;<span class=\"string\">)</span> <span class=\"string\">/</span> <span class=\"string\">node_filesystem_size_bytes</span> &#123;<span class=\"string\">device=~&quot;(/dev/.*|/)&quot;</span>,<span class=\"string\">fstype=~&quot;(ext4|xfs)&quot;</span>&#125; <span class=\"string\">)</span> <span class=\"string\">*</span> <span class=\"number\">100</span>  <span class=\"string\">&gt;</span> <span class=\"number\">85</span> <span class=\"string\">)</span></span><br><span class=\"line\">    <span class=\"attr\">for:</span> <span class=\"string\">2m</span></span><br><span class=\"line\">    <span class=\"attr\">labels:</span></span><br><span class=\"line\">      <span class=\"attr\">level:</span> <span class=\"string\">base</span></span><br><span class=\"line\">      <span class=\"attr\">severity:</span> <span class=\"string\">warning</span></span><br><span class=\"line\">    <span class=\"attr\">annotations:</span></span><br><span class=\"line\">      <span class=\"attr\">description:</span> <span class=\"string\">&quot; <span class=\"template-variable\">&#123;&#123; $labels.mountpoint &#125;&#125;</span> 使用超过 85% (当前值: <span class=\"template-variable\">&#123;&#123; $value &#125;&#125;</span>)&quot;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>rules/mem.yml</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">groups:</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">内存报警规则</span></span><br><span class=\"line\">  <span class=\"attr\">rules:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">alert:</span> <span class=\"string\">内存使用率告警</span></span><br><span class=\"line\">    <span class=\"attr\">expr:</span> <span class=\"string\">ceil((node_memory_MemTotal_bytes</span> <span class=\"bullet\">-</span> <span class=\"string\">(node_memory_MemFree_bytes+node_memory_Buffers_bytes+node_memory_Cached_bytes</span> <span class=\"string\">))</span> <span class=\"string\">/</span> <span class=\"string\">node_memory_MemTotal_bytes</span> <span class=\"string\">*</span> <span class=\"number\">100</span> <span class=\"string\">&gt;</span> <span class=\"number\">85</span><span class=\"string\">)</span></span><br><span class=\"line\">    <span class=\"attr\">for:</span> <span class=\"string\">2m</span></span><br><span class=\"line\">    <span class=\"attr\">labels:</span></span><br><span class=\"line\">      <span class=\"attr\">level:</span> <span class=\"string\">base</span></span><br><span class=\"line\">      <span class=\"attr\">severity:</span> <span class=\"string\">warning</span></span><br><span class=\"line\">    <span class=\"attr\">annotations:</span></span><br><span class=\"line\">      <span class=\"attr\">description:</span> <span class=\"string\">&quot;内存使用超过80%！(当前值: <span class=\"template-variable\">&#123;&#123; $value &#125;&#125;</span>%)&quot;</span></span><br></pre></td></tr></table></figure>\n<p>rules/node.yml</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">groups:</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">实例存活告警规则</span></span><br><span class=\"line\">  <span class=\"attr\">rules:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">alert:</span> <span class=\"string\">主机状态</span></span><br><span class=\"line\">    <span class=\"attr\">expr:</span> <span class=\"string\">up</span> <span class=\"string\">==</span> <span class=\"number\">0</span></span><br><span class=\"line\">    <span class=\"attr\">for:</span> <span class=\"string\">2m</span></span><br><span class=\"line\">    <span class=\"attr\">labels:</span></span><br><span class=\"line\">      <span class=\"attr\">level:</span> <span class=\"string\">base</span></span><br><span class=\"line\">      <span class=\"attr\">project:</span> <span class=\"string\">base</span></span><br><span class=\"line\">      <span class=\"attr\">severity:</span> <span class=\"string\">warning</span></span><br><span class=\"line\">    <span class=\"attr\">annotations:</span></span><br><span class=\"line\">      <span class=\"attr\">description:</span> <span class=\"string\">&quot; 主机(或监控节点)发生宕机超过1分钟&quot;</span></span><br></pre></td></tr></table></figure>\n\n<p>rules/net.yml</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">groups:</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">网络告警规则</span></span><br><span class=\"line\">  <span class=\"attr\">rules:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">alert:</span> <span class=\"string\">网络流入</span></span><br><span class=\"line\">    <span class=\"attr\">expr:</span> <span class=\"string\">((sum(rate</span> <span class=\"string\">(node_network_receive_bytes_total&#123;device!~&#x27;tap.*|veth.*|br.*|docker.*|virbr*|lo*&#x27;&#125;[5m]))</span> <span class=\"string\">by</span> <span class=\"string\">(instance))</span> <span class=\"string\">/</span> <span class=\"number\">100</span><span class=\"string\">)</span> <span class=\"string\">&gt;</span> <span class=\"number\">102400</span></span><br><span class=\"line\">    <span class=\"attr\">for:</span> <span class=\"string\">1m</span></span><br><span class=\"line\">    <span class=\"attr\">labels:</span></span><br><span class=\"line\">      <span class=\"attr\">level:</span> <span class=\"string\">base</span></span><br><span class=\"line\">      <span class=\"attr\">project:</span> <span class=\"string\">base</span></span><br><span class=\"line\">      <span class=\"attr\">severity:</span> <span class=\"string\">warning</span></span><br><span class=\"line\">    <span class=\"attr\">annotations:</span></span><br><span class=\"line\">      <span class=\"attr\">summary:</span> <span class=\"string\">&quot;<span class=\"template-variable\">&#123;&#123;$labels.mountpoint&#125;&#125;</span> 流入网络带宽过高！&quot;</span></span><br><span class=\"line\">      <span class=\"attr\">description:</span> <span class=\"string\">&quot;<span class=\"template-variable\">&#123;&#123;$labels.mountpoint &#125;&#125;</span>流入网络带宽持续2分钟高于100M. RX带宽使用率<span class=\"template-variable\">&#123;&#123;$value&#125;&#125;</span>&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">alert:</span> <span class=\"string\">网络流出</span></span><br><span class=\"line\">    <span class=\"attr\">expr:</span> <span class=\"string\">((sum(rate</span> <span class=\"string\">(node_network_transmit_bytes_total&#123;device!~&#x27;tap.*|veth.*|br.*|docker.*|virbr*|lo*&#x27;&#125;[5m]))</span> <span class=\"string\">by</span> <span class=\"string\">(instance))</span> <span class=\"string\">/</span> <span class=\"number\">100</span><span class=\"string\">)</span> <span class=\"string\">&gt;</span> <span class=\"number\">102400</span></span><br><span class=\"line\">    <span class=\"attr\">for:</span> <span class=\"string\">1m</span></span><br><span class=\"line\">    <span class=\"attr\">labels:</span></span><br><span class=\"line\">      <span class=\"attr\">level:</span> <span class=\"string\">base</span></span><br><span class=\"line\">      <span class=\"attr\">project:</span> <span class=\"string\">base</span></span><br><span class=\"line\">      <span class=\"attr\">severity:</span> <span class=\"string\">warning</span></span><br><span class=\"line\">    <span class=\"attr\">annotations:</span></span><br><span class=\"line\">      <span class=\"attr\">summary:</span> <span class=\"string\">&quot;<span class=\"template-variable\">&#123;&#123;$labels.mountpoint&#125;&#125;</span> 流出网络带宽过高！&quot;</span></span><br><span class=\"line\">      <span class=\"attr\">description:</span> <span class=\"string\">&quot;<span class=\"template-variable\">&#123;&#123;$labels.mountpoint &#125;&#125;</span>流出网络带宽持续2分钟高于100M. RX带宽使用率<span class=\"template-variable\">&#123;&#123;$value&#125;&#125;</span>&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">alert:</span> <span class=\"string\">TCP会话</span></span><br><span class=\"line\">    <span class=\"attr\">expr:</span> <span class=\"string\">node_netstat_Tcp_CurrEstab</span> <span class=\"string\">&gt;</span> <span class=\"number\">1000</span></span><br><span class=\"line\">    <span class=\"attr\">for:</span> <span class=\"string\">1m</span></span><br><span class=\"line\">    <span class=\"attr\">labels:</span></span><br><span class=\"line\">      <span class=\"attr\">level:</span> <span class=\"string\">base</span></span><br><span class=\"line\">      <span class=\"attr\">project:</span> <span class=\"string\">base</span></span><br><span class=\"line\">      <span class=\"attr\">severity:</span> <span class=\"string\">warning</span></span><br><span class=\"line\">    <span class=\"attr\">annotations:</span></span><br><span class=\"line\">      <span class=\"attr\">summary:</span> <span class=\"string\">&quot;<span class=\"template-variable\">&#123;&#123;$labels.mountpoint&#125;&#125;</span> TCP_ESTABLISHED过高！&quot;</span></span><br><span class=\"line\">      <span class=\"attr\">description:</span> <span class=\"string\">&quot;<span class=\"template-variable\">&#123;&#123;$labels.mountpoint &#125;&#125;</span> TCP_ESTABLISHED大于1000%(目前使用:<span class=\"template-variable\">&#123;&#123;$value&#125;&#125;</span>%)&quot;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>rules/cpu.yml<br>rules/cpu.yml</p>\n","site":{"data":{}},"excerpt":"<p>摘要: prometheus 使用钉钉报警 python demo 版本</p>","more":"<h3 id=\"方式一\"><a href=\"#方式一\" class=\"headerlink\" title=\"方式一\"></a>方式一</h3><p>prometheus 使用 prometheus-webhook-dingtalk 完成钉钉报警</p>\n<p><code>https://github.com/timonwong/prometheus-webhook-dingtalk</code></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim &#x2F;usr&#x2F;lib&#x2F;systemd&#x2F;system&#x2F;prometheus-webhook-dingtalk.service</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">[Unit]</span><br><span class=\"line\">Description&#x3D;prometheus-webhook-dingtalk</span><br><span class=\"line\">After&#x3D;network-online.target</span><br><span class=\"line\"> </span><br><span class=\"line\">[Service]</span><br><span class=\"line\">Restart&#x3D;on-failure</span><br><span class=\"line\">ExecStart&#x3D;&#x2F;opt&#x2F;alertmanager&#x2F;prometheus-webhook-dingtalk&#x2F;prometheus-webhook-dingtalk \\</span><br><span class=\"line\">          --ding.profile&#x3D;ops_dingding&#x3D;https:&#x2F;&#x2F;oapi.dingtalk.com&#x2F;robot&#x2F;send?access_token&#x3D;省略一串字符 \\</span><br><span class=\"line\">          --ding.profile&#x3D;info_dingding&#x3D;https:&#x2F;&#x2F;oapi.dingtalk.com&#x2F;robot&#x2F;send?access_token&#x3D;同样省略了一串字符</span><br><span class=\"line\"> </span><br><span class=\"line\">[Install]</span><br><span class=\"line\">WantedBy&#x3D;multi-user.target</span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">配置开机启动</span><br><span class=\"line\"></span><br><span class=\"line\">systemctl daemon-reload</span><br><span class=\"line\">systemctl enable prometheus-webhook-dingtalk</span><br><span class=\"line\">systemctl restart prometheus-webhook-dingtalk</span><br><span class=\"line\">systemctl status prometheus-webhook-dingtalk</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"方式二\"><a href=\"#方式二\" class=\"headerlink\" title=\"方式二\"></a>方式二</h3><p>使用python脚本发送钉钉报警</p>\n<p><code>app.py</code></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> os</span><br><span class=\"line\"><span class=\"keyword\">import</span> json</span><br><span class=\"line\"><span class=\"keyword\">import</span> logging</span><br><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"><span class=\"keyword\">import</span> time</span><br><span class=\"line\"><span class=\"keyword\">import</span> hmac</span><br><span class=\"line\"><span class=\"keyword\">import</span> hashlib</span><br><span class=\"line\"><span class=\"keyword\">import</span> base64</span><br><span class=\"line\"><span class=\"keyword\">import</span> urllib.parse</span><br><span class=\"line\"><span class=\"keyword\">from</span> config <span class=\"keyword\">import</span> *</span><br><span class=\"line\"><span class=\"keyword\">from</span> dateutil <span class=\"keyword\">import</span> parser</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">from</span> flask <span class=\"keyword\">import</span> Flask</span><br><span class=\"line\"><span class=\"keyword\">from</span> flask <span class=\"keyword\">import</span> request</span><br><span class=\"line\"></span><br><span class=\"line\">app = Flask(__name__)</span><br><span class=\"line\"></span><br><span class=\"line\">logging.basicConfig(</span><br><span class=\"line\">    level=logging.DEBUG <span class=\"keyword\">if</span> os.getenv(<span class=\"string\">&#x27;LOG_LEVEL&#x27;</span>) == <span class=\"string\">&#x27;debug&#x27;</span> <span class=\"keyword\">else</span> logging.INFO,</span><br><span class=\"line\">    <span class=\"built_in\">format</span>=<span class=\"string\">&#x27;%(asctime)s %(levelname)s %(message)s&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@app.route(<span class=\"params\"><span class=\"string\">&#x27;/&#x27;</span>, methods=[<span class=\"string\">&#x27;POST&#x27;</span>, <span class=\"string\">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">send</span>():</span></span><br><span class=\"line\">    <span class=\"keyword\">try</span>:</span><br><span class=\"line\">        content = json.loads(request.get_data())</span><br><span class=\"line\">        project = <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">for</span> alert <span class=\"keyword\">in</span> content[<span class=\"string\">&#x27;alerts&#x27;</span>]:</span><br><span class=\"line\">            <span class=\"keyword\">if</span> alert[<span class=\"string\">&#x27;status&#x27;</span>] == <span class=\"string\">&quot;resolved&quot;</span>:</span><br><span class=\"line\">                status = <span class=\"string\">&quot;恢复&quot;</span></span><br><span class=\"line\">            <span class=\"keyword\">elif</span> alert[<span class=\"string\">&#x27;status&#x27;</span>] == <span class=\"string\">&quot;firing&quot;</span>:</span><br><span class=\"line\">                status = <span class=\"string\">&quot;故障&quot;</span></span><br><span class=\"line\">            <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                status = <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">            message = status + <span class=\"string\">&quot; | &quot;</span> + alert[<span class=\"string\">&#x27;labels&#x27;</span>][<span class=\"string\">&#x27;alertname&#x27;</span>] + <span class=\"string\">&quot;\\n\\n&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span> <span class=\"string\">&#x27;hostname&#x27;</span> <span class=\"keyword\">in</span> alert[<span class=\"string\">&#x27;labels&#x27;</span>]:</span><br><span class=\"line\">                message += <span class=\"string\">&quot;告警主机: &quot;</span> + alert[<span class=\"string\">&#x27;labels&#x27;</span>][<span class=\"string\">&#x27;hostname&#x27;</span>] + <span class=\"string\">&quot;\\n\\n&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span> <span class=\"string\">&#x27;name&#x27;</span> <span class=\"keyword\">in</span> alert[<span class=\"string\">&#x27;labels&#x27;</span>]:</span><br><span class=\"line\">                message += <span class=\"string\">&quot;告警地址: &quot;</span> + alert[<span class=\"string\">&#x27;labels&#x27;</span>][<span class=\"string\">&#x27;instance&#x27;</span>] + <span class=\"string\">&quot;(&quot;</span> + alert[<span class=\"string\">&#x27;labels&#x27;</span>][<span class=\"string\">&#x27;name&#x27;</span>] + <span class=\"string\">&quot;)\\n\\n&quot;</span></span><br><span class=\"line\">            <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                message += <span class=\"string\">&quot;告警地址: &quot;</span> + alert[<span class=\"string\">&#x27;labels&#x27;</span>][<span class=\"string\">&#x27;instance&#x27;</span>] + <span class=\"string\">&quot;\\n\\n&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span> <span class=\"string\">&#x27;project&#x27;</span> <span class=\"keyword\">in</span> alert[<span class=\"string\">&#x27;labels&#x27;</span>]:</span><br><span class=\"line\">                message += <span class=\"string\">&quot;告警项目: &quot;</span> + alert[<span class=\"string\">&#x27;labels&#x27;</span>][<span class=\"string\">&#x27;project&#x27;</span>] + <span class=\"string\">&quot;\\n\\n&quot;</span></span><br><span class=\"line\">                project = alert[<span class=\"string\">&#x27;labels&#x27;</span>][<span class=\"string\">&#x27;project&#x27;</span>]</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span> <span class=\"string\">&#x27;env&#x27;</span> <span class=\"keyword\">in</span> alert[<span class=\"string\">&#x27;labels&#x27;</span>]:</span><br><span class=\"line\">                message += <span class=\"string\">&quot;告警环境: &quot;</span> + alert[<span class=\"string\">&#x27;labels&#x27;</span>][<span class=\"string\">&#x27;env&#x27;</span>] + <span class=\"string\">&quot;\\n\\n&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span> <span class=\"string\">&#x27;info&#x27;</span> <span class=\"keyword\">in</span> alert[<span class=\"string\">&#x27;annotations&#x27;</span>]:</span><br><span class=\"line\">                message += <span class=\"string\">&quot;Info: &quot;</span> + alert[<span class=\"string\">&#x27;annotations&#x27;</span>][<span class=\"string\">&#x27;info&#x27;</span>] + <span class=\"string\">&quot;\\n\\n&quot;</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> <span class=\"string\">&#x27;summary&#x27;</span> <span class=\"keyword\">in</span> alert[<span class=\"string\">&#x27;annotations&#x27;</span>]:</span><br><span class=\"line\">                message += <span class=\"string\">&quot;Summary: &quot;</span> + alert[<span class=\"string\">&#x27;annotations&#x27;</span>][<span class=\"string\">&#x27;summary&#x27;</span>] + <span class=\"string\">&quot;\\n\\n&quot;</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> <span class=\"string\">&#x27;description&#x27;</span> <span class=\"keyword\">in</span> alert[<span class=\"string\">&#x27;annotations&#x27;</span>]:</span><br><span class=\"line\">                message += <span class=\"string\">&quot;告警信息: &quot;</span> + alert[<span class=\"string\">&#x27;annotations&#x27;</span>][<span class=\"string\">&#x27;description&#x27;</span>] + <span class=\"string\">&quot;\\n\\n&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span> alert[<span class=\"string\">&#x27;status&#x27;</span>] == <span class=\"string\">&quot;resolved&quot;</span>:</span><br><span class=\"line\">                correctDate = parser.parse(alert[<span class=\"string\">&#x27;endsAt&#x27;</span>]).strftime(<span class=\"string\">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span>)</span><br><span class=\"line\">                message += <span class=\"string\">&quot;恢复时间: &quot;</span> + correctDate</span><br><span class=\"line\">            <span class=\"keyword\">elif</span> alert[<span class=\"string\">&#x27;status&#x27;</span>] == <span class=\"string\">&quot;firing&quot;</span>:</span><br><span class=\"line\">                correctDate = parser.parse(alert[<span class=\"string\">&#x27;startsAt&#x27;</span>]).strftime(<span class=\"string\">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span>)</span><br><span class=\"line\">                message += <span class=\"string\">&quot;告警时间: &quot;</span> + correctDate</span><br><span class=\"line\">            print(message)</span><br><span class=\"line\"></span><br><span class=\"line\">            send_alert_02(message, project)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;Alert OK&quot;</span>, <span class=\"number\">200</span></span><br><span class=\"line\">    <span class=\"keyword\">except</span> Exception <span class=\"keyword\">as</span> error:</span><br><span class=\"line\">        app.logger.info(<span class=\"string\">&quot;\\t%s&quot;</span>, error)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;Alert fail&quot;</span>, <span class=\"number\">200</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">make_sign</span>(<span class=\"params\">timestamp, secret</span>):</span></span><br><span class=\"line\">    <span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"string\">    新版钉钉更新了安全策略，这里我们采用签名的方式进行安全认证</span></span><br><span class=\"line\"><span class=\"string\">    https://ding-doc.dingtalk.com/doc#/serverapi2/qf2nxq</span></span><br><span class=\"line\"><span class=\"string\">    &quot;&quot;&quot;</span></span><br><span class=\"line\">    secret_enc = <span class=\"built_in\">bytes</span>(secret, <span class=\"string\">&#x27;utf-8&#x27;</span>)</span><br><span class=\"line\">    string_to_sign = <span class=\"string\">&#x27;&#123;&#125;\\n&#123;&#125;&#x27;</span>.<span class=\"built_in\">format</span>(timestamp, secret)</span><br><span class=\"line\">    string_to_sign_enc = <span class=\"built_in\">bytes</span>(string_to_sign, <span class=\"string\">&#x27;utf-8&#x27;</span>)</span><br><span class=\"line\">    hmac_code = hmac.new(secret_enc, string_to_sign_enc, digestmod=hashlib.sha256).digest()</span><br><span class=\"line\">    sign = urllib.parse.quote_plus(base64.b64encode(hmac_code))</span><br><span class=\"line\">    <span class=\"keyword\">return</span> sign</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">send_alert</span>(<span class=\"params\">data</span>):</span></span><br><span class=\"line\">    <span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"string\">    签名的方式进行安全认证</span></span><br><span class=\"line\"><span class=\"string\">    :param data:</span></span><br><span class=\"line\"><span class=\"string\">    :return:</span></span><br><span class=\"line\"><span class=\"string\">    &quot;&quot;&quot;</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> token:</span><br><span class=\"line\">        app.logger.error(<span class=\"string\">&#x27;you must set ROBOT_TOKEN env&#x27;</span>)</span><br><span class=\"line\">        <span class=\"keyword\">return</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> secret:</span><br><span class=\"line\">        app.logger.error(<span class=\"string\">&#x27;you must set ROBOT_SECRET env&#x27;</span>)</span><br><span class=\"line\">        <span class=\"keyword\">return</span></span><br><span class=\"line\">    timestamp = <span class=\"built_in\">int</span>(<span class=\"built_in\">round</span>(time.time() * <span class=\"number\">1000</span>))</span><br><span class=\"line\">    url = <span class=\"string\">&#x27;https://oapi.dingtalk.com/robot/send?access_token=%s&amp;timestamp=%d&amp;sign=%s&#x27;</span> % (</span><br><span class=\"line\">        token, timestamp, make_sign(timestamp, secret))</span><br><span class=\"line\">    send_data = &#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;msgtype&quot;</span>: <span class=\"string\">&quot;text&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;text&quot;</span>: &#123;</span><br><span class=\"line\">            <span class=\"string\">&quot;content&quot;</span>: data</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        <span class=\"string\">&quot;at&quot;</span>: &#123;</span><br><span class=\"line\">            <span class=\"string\">&quot;atMobiles&quot;</span>: mobiles,</span><br><span class=\"line\">            <span class=\"string\">&quot;isAtAll&quot;</span>: <span class=\"string\">&#x27;false&#x27;</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    req = requests.post(url, json=send_data)</span><br><span class=\"line\">    result = req.json()</span><br><span class=\"line\">    <span class=\"keyword\">if</span> result[<span class=\"string\">&#x27;errcode&#x27;</span>] != <span class=\"number\">0</span>:</span><br><span class=\"line\">        app.logger.error(<span class=\"string\">&#x27;notify dingtalk error: %s&#x27;</span> % result[<span class=\"string\">&#x27;errcode&#x27;</span>])</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">send_alert_02</span>(<span class=\"params\">data, project</span>):</span></span><br><span class=\"line\">    <span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"string\">    未签名认证方式</span></span><br><span class=\"line\"><span class=\"string\">    &quot;&quot;&quot;</span></span><br><span class=\"line\">    accessToken = <span class=\"string\">&quot;https://oapi.dingtalk.com/robot/send?access_token=&#123;&#125;&quot;</span>.<span class=\"built_in\">format</span>(dingding_token[project])</span><br><span class=\"line\">    HEADERS = &#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;Content-Type&quot;</span>: <span class=\"string\">&quot;application/json ;charset=utf-8 &quot;</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    mobiles = []</span><br><span class=\"line\">    lists = contacts[<span class=\"string\">&quot;&#123;&#125;&quot;</span>.<span class=\"built_in\">format</span>(project)]</span><br><span class=\"line\">    print(lists)</span><br><span class=\"line\">    <span class=\"keyword\">for</span> j <span class=\"keyword\">in</span> lists:</span><br><span class=\"line\">        mobiles.append(j[<span class=\"string\">&quot;mobiles&quot;</span>])</span><br><span class=\"line\">    send_data = &#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;msgtype&quot;</span>: <span class=\"string\">&quot;text&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;text&quot;</span>: &#123;</span><br><span class=\"line\">            <span class=\"string\">&quot;content&quot;</span>: data</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        <span class=\"string\">&quot;at&quot;</span>: &#123;</span><br><span class=\"line\">            <span class=\"string\">&quot;atMobiles&quot;</span>: mobiles,</span><br><span class=\"line\">            <span class=\"string\">&quot;isAtAll&quot;</span>: <span class=\"string\">&#x27;false&#x27;</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    String_textMsg = json.dumps(send_data)</span><br><span class=\"line\">    res = requests.post(accessToken, data=String_textMsg, headers=HEADERS)</span><br><span class=\"line\">    print(res)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&#x27;__main__&#x27;</span>:</span><br><span class=\"line\">    app.run(host=<span class=\"string\">&#x27;0.0.0.0&#x27;</span>, port=<span class=\"number\">5000</span>)</span><br></pre></td></tr></table></figure>\n\n<p><code>config.py</code></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">dingding_token = &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;wms&quot;</span>: <span class=\"string\">&quot;8647622d3103fn656b6hvytg7j6h56j7h567nkjbuhvygyb6bv5c5xf56v4c0ed63a5&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;oms&quot;</span>: <span class=\"string\">&quot;69c7359b21ed1b1d23cv36vb7b88lk6g5ffuhuioiiijyihytugrtyfef38e0f96399&quot;</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">token = <span class=\"string\">&#x27;cf31a0c0f2d9cc28d4234234234234234234234234234234234234b51276a6b01a6a&#x27;</span></span><br><span class=\"line\">secret = <span class=\"string\">&#x27;SEC1a4e9326a23423423423423423423423423423553454565756756756afe3f044337&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">contacts = &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;oms&quot;</span>: [</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"string\">&quot;mobiles&quot;</span>: <span class=\"string\">&quot;13554000007&quot;</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;name&quot;</span>: <span class=\"string\">&quot;xxxx&quot;</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"string\">&quot;mobiles&quot;</span>: <span class=\"string\">&quot;1875000004&quot;</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;name&quot;</span>: <span class=\"string\">&quot;xxxxx&quot;</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">    ],</span><br><span class=\"line\">    <span class=\"string\">&quot;wms&quot;</span>: [</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"string\">&quot;mobiles&quot;</span>: <span class=\"string\">&quot;13554000007&quot;</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;name&quot;</span>: <span class=\"string\">&quot;xxxx&quot;</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"string\">&quot;mobiles&quot;</span>: <span class=\"string\">&quot;1875000004&quot;</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;name&quot;</span>: <span class=\"string\">&quot;xxxxx&quot;</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">    ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"prometheus-报警规则\"><a href=\"#prometheus-报警规则\" class=\"headerlink\" title=\"prometheus 报警规则\"></a>prometheus 报警规则</h3><p>rules/cpu.yml</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">groups:</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">CPU报警规则</span></span><br><span class=\"line\">  <span class=\"attr\">rules:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">alert:</span> <span class=\"string\">CPU使用率告警</span></span><br><span class=\"line\">    <span class=\"attr\">expr:</span> <span class=\"number\">100</span> <span class=\"bullet\">-</span> <span class=\"string\">(avg</span> <span class=\"string\">by</span> <span class=\"string\">(instance)(irate(node_cpu_seconds_total&#123;mode=&quot;idle&quot;&#125;[1m])</span> <span class=\"string\">))</span> <span class=\"string\">*</span> <span class=\"number\">100</span> <span class=\"string\">&gt;</span> <span class=\"number\">90</span></span><br><span class=\"line\">    <span class=\"attr\">for:</span> <span class=\"string\">2m</span></span><br><span class=\"line\">    <span class=\"attr\">labels:</span></span><br><span class=\"line\">      <span class=\"attr\">level:</span> <span class=\"string\">base</span></span><br><span class=\"line\">      <span class=\"attr\">severity:</span> <span class=\"string\">warning</span></span><br><span class=\"line\">    <span class=\"attr\">annotations:</span></span><br><span class=\"line\">      <span class=\"attr\">description:</span> <span class=\"string\">&quot;CPU使用超过90%！(当前值: <span class=\"template-variable\">&#123;&#123; $value &#125;&#125;</span>%)&quot;</span></span><br></pre></td></tr></table></figure>\n<p>rules/disk.yml</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">groups:</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">磁盘报警规则</span></span><br><span class=\"line\">  <span class=\"attr\">rules:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">alert:</span> <span class=\"string\">磁盘使用率告警</span></span><br><span class=\"line\">    <span class=\"attr\">expr:</span> <span class=\"string\">ceil(((node_filesystem_size_bytes</span> &#123;<span class=\"string\">device=~&quot;(/dev/.*|/)&quot;</span>,<span class=\"string\">fstype=~&quot;(ext4|xfs)&quot;</span>&#125; <span class=\"bullet\">-</span> <span class=\"string\">node_filesystem_free_bytes</span> &#123;<span class=\"string\">device=~&quot;(/dev/.*|/)&quot;</span>,<span class=\"string\">fstype=~&quot;(ext4|xfs)&quot;</span>&#125;<span class=\"string\">)</span> <span class=\"string\">/</span> <span class=\"string\">node_filesystem_size_bytes</span> &#123;<span class=\"string\">device=~&quot;(/dev/.*|/)&quot;</span>,<span class=\"string\">fstype=~&quot;(ext4|xfs)&quot;</span>&#125; <span class=\"string\">)</span> <span class=\"string\">*</span> <span class=\"number\">100</span>  <span class=\"string\">&gt;</span> <span class=\"number\">85</span> <span class=\"string\">)</span></span><br><span class=\"line\">    <span class=\"attr\">for:</span> <span class=\"string\">2m</span></span><br><span class=\"line\">    <span class=\"attr\">labels:</span></span><br><span class=\"line\">      <span class=\"attr\">level:</span> <span class=\"string\">base</span></span><br><span class=\"line\">      <span class=\"attr\">severity:</span> <span class=\"string\">warning</span></span><br><span class=\"line\">    <span class=\"attr\">annotations:</span></span><br><span class=\"line\">      <span class=\"attr\">description:</span> <span class=\"string\">&quot; <span class=\"template-variable\">&#123;&#123; $labels.mountpoint &#125;&#125;</span> 使用超过 85% (当前值: <span class=\"template-variable\">&#123;&#123; $value &#125;&#125;</span>)&quot;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>rules/mem.yml</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">groups:</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">内存报警规则</span></span><br><span class=\"line\">  <span class=\"attr\">rules:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">alert:</span> <span class=\"string\">内存使用率告警</span></span><br><span class=\"line\">    <span class=\"attr\">expr:</span> <span class=\"string\">ceil((node_memory_MemTotal_bytes</span> <span class=\"bullet\">-</span> <span class=\"string\">(node_memory_MemFree_bytes+node_memory_Buffers_bytes+node_memory_Cached_bytes</span> <span class=\"string\">))</span> <span class=\"string\">/</span> <span class=\"string\">node_memory_MemTotal_bytes</span> <span class=\"string\">*</span> <span class=\"number\">100</span> <span class=\"string\">&gt;</span> <span class=\"number\">85</span><span class=\"string\">)</span></span><br><span class=\"line\">    <span class=\"attr\">for:</span> <span class=\"string\">2m</span></span><br><span class=\"line\">    <span class=\"attr\">labels:</span></span><br><span class=\"line\">      <span class=\"attr\">level:</span> <span class=\"string\">base</span></span><br><span class=\"line\">      <span class=\"attr\">severity:</span> <span class=\"string\">warning</span></span><br><span class=\"line\">    <span class=\"attr\">annotations:</span></span><br><span class=\"line\">      <span class=\"attr\">description:</span> <span class=\"string\">&quot;内存使用超过80%！(当前值: <span class=\"template-variable\">&#123;&#123; $value &#125;&#125;</span>%)&quot;</span></span><br></pre></td></tr></table></figure>\n<p>rules/node.yml</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">groups:</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">实例存活告警规则</span></span><br><span class=\"line\">  <span class=\"attr\">rules:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">alert:</span> <span class=\"string\">主机状态</span></span><br><span class=\"line\">    <span class=\"attr\">expr:</span> <span class=\"string\">up</span> <span class=\"string\">==</span> <span class=\"number\">0</span></span><br><span class=\"line\">    <span class=\"attr\">for:</span> <span class=\"string\">2m</span></span><br><span class=\"line\">    <span class=\"attr\">labels:</span></span><br><span class=\"line\">      <span class=\"attr\">level:</span> <span class=\"string\">base</span></span><br><span class=\"line\">      <span class=\"attr\">project:</span> <span class=\"string\">base</span></span><br><span class=\"line\">      <span class=\"attr\">severity:</span> <span class=\"string\">warning</span></span><br><span class=\"line\">    <span class=\"attr\">annotations:</span></span><br><span class=\"line\">      <span class=\"attr\">description:</span> <span class=\"string\">&quot; 主机(或监控节点)发生宕机超过1分钟&quot;</span></span><br></pre></td></tr></table></figure>\n\n<p>rules/net.yml</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">groups:</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">网络告警规则</span></span><br><span class=\"line\">  <span class=\"attr\">rules:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">alert:</span> <span class=\"string\">网络流入</span></span><br><span class=\"line\">    <span class=\"attr\">expr:</span> <span class=\"string\">((sum(rate</span> <span class=\"string\">(node_network_receive_bytes_total&#123;device!~&#x27;tap.*|veth.*|br.*|docker.*|virbr*|lo*&#x27;&#125;[5m]))</span> <span class=\"string\">by</span> <span class=\"string\">(instance))</span> <span class=\"string\">/</span> <span class=\"number\">100</span><span class=\"string\">)</span> <span class=\"string\">&gt;</span> <span class=\"number\">102400</span></span><br><span class=\"line\">    <span class=\"attr\">for:</span> <span class=\"string\">1m</span></span><br><span class=\"line\">    <span class=\"attr\">labels:</span></span><br><span class=\"line\">      <span class=\"attr\">level:</span> <span class=\"string\">base</span></span><br><span class=\"line\">      <span class=\"attr\">project:</span> <span class=\"string\">base</span></span><br><span class=\"line\">      <span class=\"attr\">severity:</span> <span class=\"string\">warning</span></span><br><span class=\"line\">    <span class=\"attr\">annotations:</span></span><br><span class=\"line\">      <span class=\"attr\">summary:</span> <span class=\"string\">&quot;<span class=\"template-variable\">&#123;&#123;$labels.mountpoint&#125;&#125;</span> 流入网络带宽过高！&quot;</span></span><br><span class=\"line\">      <span class=\"attr\">description:</span> <span class=\"string\">&quot;<span class=\"template-variable\">&#123;&#123;$labels.mountpoint &#125;&#125;</span>流入网络带宽持续2分钟高于100M. RX带宽使用率<span class=\"template-variable\">&#123;&#123;$value&#125;&#125;</span>&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">alert:</span> <span class=\"string\">网络流出</span></span><br><span class=\"line\">    <span class=\"attr\">expr:</span> <span class=\"string\">((sum(rate</span> <span class=\"string\">(node_network_transmit_bytes_total&#123;device!~&#x27;tap.*|veth.*|br.*|docker.*|virbr*|lo*&#x27;&#125;[5m]))</span> <span class=\"string\">by</span> <span class=\"string\">(instance))</span> <span class=\"string\">/</span> <span class=\"number\">100</span><span class=\"string\">)</span> <span class=\"string\">&gt;</span> <span class=\"number\">102400</span></span><br><span class=\"line\">    <span class=\"attr\">for:</span> <span class=\"string\">1m</span></span><br><span class=\"line\">    <span class=\"attr\">labels:</span></span><br><span class=\"line\">      <span class=\"attr\">level:</span> <span class=\"string\">base</span></span><br><span class=\"line\">      <span class=\"attr\">project:</span> <span class=\"string\">base</span></span><br><span class=\"line\">      <span class=\"attr\">severity:</span> <span class=\"string\">warning</span></span><br><span class=\"line\">    <span class=\"attr\">annotations:</span></span><br><span class=\"line\">      <span class=\"attr\">summary:</span> <span class=\"string\">&quot;<span class=\"template-variable\">&#123;&#123;$labels.mountpoint&#125;&#125;</span> 流出网络带宽过高！&quot;</span></span><br><span class=\"line\">      <span class=\"attr\">description:</span> <span class=\"string\">&quot;<span class=\"template-variable\">&#123;&#123;$labels.mountpoint &#125;&#125;</span>流出网络带宽持续2分钟高于100M. RX带宽使用率<span class=\"template-variable\">&#123;&#123;$value&#125;&#125;</span>&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">alert:</span> <span class=\"string\">TCP会话</span></span><br><span class=\"line\">    <span class=\"attr\">expr:</span> <span class=\"string\">node_netstat_Tcp_CurrEstab</span> <span class=\"string\">&gt;</span> <span class=\"number\">1000</span></span><br><span class=\"line\">    <span class=\"attr\">for:</span> <span class=\"string\">1m</span></span><br><span class=\"line\">    <span class=\"attr\">labels:</span></span><br><span class=\"line\">      <span class=\"attr\">level:</span> <span class=\"string\">base</span></span><br><span class=\"line\">      <span class=\"attr\">project:</span> <span class=\"string\">base</span></span><br><span class=\"line\">      <span class=\"attr\">severity:</span> <span class=\"string\">warning</span></span><br><span class=\"line\">    <span class=\"attr\">annotations:</span></span><br><span class=\"line\">      <span class=\"attr\">summary:</span> <span class=\"string\">&quot;<span class=\"template-variable\">&#123;&#123;$labels.mountpoint&#125;&#125;</span> TCP_ESTABLISHED过高！&quot;</span></span><br><span class=\"line\">      <span class=\"attr\">description:</span> <span class=\"string\">&quot;<span class=\"template-variable\">&#123;&#123;$labels.mountpoint &#125;&#125;</span> TCP_ESTABLISHED大于1000%(目前使用:<span class=\"template-variable\">&#123;&#123;$value&#125;&#125;</span>%)&quot;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>rules/cpu.yml<br>rules/cpu.yml</p>"},{"title":"salt-master 安装脚本","date":"2020-09-21T04:42:00.000Z","_content":"\n```bash\n#!/bash/sh\n#Function: install salt-master \necho -e \"\\033[1;32m ###########  close selinux ############# \\033[0m\"\nsed -i 's/SELINUX=enforcing/SELINUX=disabled/g' /etc/selinux/config\nsetenforce 0\nsystemctl stop firewalld.service\nsystemctl disable firewalld.service\nsleep 5\necho -e \"\\033[1;32m ###########  install salt-master ############# \\033[0m\"\ncurl -L https://bootstrap.saltstack.com -o install_salt.sh\nsh install_salt.sh -P -M\n\ntdate=`date '+%m%d%H%M%S'`\ncp /etc/salt/master /etc/salt/master_bak-$tdate\n\nsed -i '/^interface:/interface: 0.0.0.0' /etc/salt/master\nsed -i 's/#auto_accept: False/auto_accept: True/g' /etc/salt/master\n```\n\n","source":"_posts/saltstack/salt-master安装脚本.md","raw":"---\ntitle: salt-master 安装脚本\ndate: 2020-09-21 12:42\ncategories:\n- salt\ntags:\n- salt\n---\n\n```bash\n#!/bash/sh\n#Function: install salt-master \necho -e \"\\033[1;32m ###########  close selinux ############# \\033[0m\"\nsed -i 's/SELINUX=enforcing/SELINUX=disabled/g' /etc/selinux/config\nsetenforce 0\nsystemctl stop firewalld.service\nsystemctl disable firewalld.service\nsleep 5\necho -e \"\\033[1;32m ###########  install salt-master ############# \\033[0m\"\ncurl -L https://bootstrap.saltstack.com -o install_salt.sh\nsh install_salt.sh -P -M\n\ntdate=`date '+%m%d%H%M%S'`\ncp /etc/salt/master /etc/salt/master_bak-$tdate\n\nsed -i '/^interface:/interface: 0.0.0.0' /etc/salt/master\nsed -i 's/#auto_accept: False/auto_accept: True/g' /etc/salt/master\n```\n\n","slug":"saltstack/salt-master安装脚本","published":1,"updated":"2021-06-18T08:07:11.204Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cku697a0r006t00uh5mty0681","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/bash/sh</span></span><br><span class=\"line\"><span class=\"comment\">#Function: install salt-master </span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> -e <span class=\"string\">&quot;\\033[1;32m ###########  close selinux ############# \\033[0m&quot;</span></span><br><span class=\"line\">sed -i <span class=\"string\">&#x27;s/SELINUX=enforcing/SELINUX=disabled/g&#x27;</span> /etc/selinux/config</span><br><span class=\"line\">setenforce 0</span><br><span class=\"line\">systemctl stop firewalld.service</span><br><span class=\"line\">systemctl <span class=\"built_in\">disable</span> firewalld.service</span><br><span class=\"line\">sleep 5</span><br><span class=\"line\"><span class=\"built_in\">echo</span> -e <span class=\"string\">&quot;\\033[1;32m ###########  install salt-master ############# \\033[0m&quot;</span></span><br><span class=\"line\">curl -L https://bootstrap.saltstack.com -o install_salt.sh</span><br><span class=\"line\">sh install_salt.sh -P -M</span><br><span class=\"line\"></span><br><span class=\"line\">tdate=`date <span class=\"string\">&#x27;+%m%d%H%M%S&#x27;</span>`</span><br><span class=\"line\">cp /etc/salt/master /etc/salt/master_bak-<span class=\"variable\">$tdate</span></span><br><span class=\"line\"></span><br><span class=\"line\">sed -i <span class=\"string\">&#x27;/^interface:/interface: 0.0.0.0&#x27;</span> /etc/salt/master</span><br><span class=\"line\">sed -i <span class=\"string\">&#x27;s/#auto_accept: False/auto_accept: True/g&#x27;</span> /etc/salt/master</span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"","more":"<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/bash/sh</span></span><br><span class=\"line\"><span class=\"comment\">#Function: install salt-master </span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> -e <span class=\"string\">&quot;\\033[1;32m ###########  close selinux ############# \\033[0m&quot;</span></span><br><span class=\"line\">sed -i <span class=\"string\">&#x27;s/SELINUX=enforcing/SELINUX=disabled/g&#x27;</span> /etc/selinux/config</span><br><span class=\"line\">setenforce 0</span><br><span class=\"line\">systemctl stop firewalld.service</span><br><span class=\"line\">systemctl <span class=\"built_in\">disable</span> firewalld.service</span><br><span class=\"line\">sleep 5</span><br><span class=\"line\"><span class=\"built_in\">echo</span> -e <span class=\"string\">&quot;\\033[1;32m ###########  install salt-master ############# \\033[0m&quot;</span></span><br><span class=\"line\">curl -L https://bootstrap.saltstack.com -o install_salt.sh</span><br><span class=\"line\">sh install_salt.sh -P -M</span><br><span class=\"line\"></span><br><span class=\"line\">tdate=`date <span class=\"string\">&#x27;+%m%d%H%M%S&#x27;</span>`</span><br><span class=\"line\">cp /etc/salt/master /etc/salt/master_bak-<span class=\"variable\">$tdate</span></span><br><span class=\"line\"></span><br><span class=\"line\">sed -i <span class=\"string\">&#x27;/^interface:/interface: 0.0.0.0&#x27;</span> /etc/salt/master</span><br><span class=\"line\">sed -i <span class=\"string\">&#x27;s/#auto_accept: False/auto_accept: True/g&#x27;</span> /etc/salt/master</span><br></pre></td></tr></table></figure>\n\n"},{"title":"salt-minion 安装脚本","date":"2020-09-21T04:42:00.000Z","_content":"\n```bash\n#!/bash/sh\n#Function: install salt-master \necho -e \"\\033[1;32m ###########  close selinux ############# \\033[0m\"\nsed -i 's/SELINUX=enforcing/SELINUX=disabled/g' /etc/selinux/config\nsetenforce 0\nsystemctl stop firewalld.service\nsystemctl disable firewalld.service\nsleep 5\necho -e \"\\033[1;32m ###########  install salt-minion  ############# \\033[0m\"\ncurl -L https://bootstrap.saltstack.com -o install_salt.sh\nsh install_salt.sh -P\n\ntdate=`date '+%m%d%H%M%S'`\ncp /etc/salt/master /etc/salt/master_bak-$tdate\n\n\nHostName=`hostname`\nmaster_ip=172.16.102.33\n\ncp /etc/salt/minion /etc/salt/minion_bak\nsed -i  \"17a master: $master_ip\" /etc/salt/minion\nsed -i '/^master/master: ${master_ip}' /etc/salt/minion\nsed -i  \"113a id: $HostName\" /etc/salt/minion\n```\n\n","source":"_posts/saltstack/salt-minion安装脚本.md","raw":"---\ntitle: salt-minion 安装脚本\ndate: 2020-09-21 12:42\ncategories:\n- salt\ntags:\n- salt\n---\n\n```bash\n#!/bash/sh\n#Function: install salt-master \necho -e \"\\033[1;32m ###########  close selinux ############# \\033[0m\"\nsed -i 's/SELINUX=enforcing/SELINUX=disabled/g' /etc/selinux/config\nsetenforce 0\nsystemctl stop firewalld.service\nsystemctl disable firewalld.service\nsleep 5\necho -e \"\\033[1;32m ###########  install salt-minion  ############# \\033[0m\"\ncurl -L https://bootstrap.saltstack.com -o install_salt.sh\nsh install_salt.sh -P\n\ntdate=`date '+%m%d%H%M%S'`\ncp /etc/salt/master /etc/salt/master_bak-$tdate\n\n\nHostName=`hostname`\nmaster_ip=172.16.102.33\n\ncp /etc/salt/minion /etc/salt/minion_bak\nsed -i  \"17a master: $master_ip\" /etc/salt/minion\nsed -i '/^master/master: ${master_ip}' /etc/salt/minion\nsed -i  \"113a id: $HostName\" /etc/salt/minion\n```\n\n","slug":"saltstack/salt-minion安装脚本","published":1,"updated":"2021-06-18T08:07:11.204Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cku697a0s006x00uhgfil5ugz","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/bash/sh</span></span><br><span class=\"line\"><span class=\"comment\">#Function: install salt-master </span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> -e <span class=\"string\">&quot;\\033[1;32m ###########  close selinux ############# \\033[0m&quot;</span></span><br><span class=\"line\">sed -i <span class=\"string\">&#x27;s/SELINUX=enforcing/SELINUX=disabled/g&#x27;</span> /etc/selinux/config</span><br><span class=\"line\">setenforce 0</span><br><span class=\"line\">systemctl stop firewalld.service</span><br><span class=\"line\">systemctl <span class=\"built_in\">disable</span> firewalld.service</span><br><span class=\"line\">sleep 5</span><br><span class=\"line\"><span class=\"built_in\">echo</span> -e <span class=\"string\">&quot;\\033[1;32m ###########  install salt-minion  ############# \\033[0m&quot;</span></span><br><span class=\"line\">curl -L https://bootstrap.saltstack.com -o install_salt.sh</span><br><span class=\"line\">sh install_salt.sh -P</span><br><span class=\"line\"></span><br><span class=\"line\">tdate=`date <span class=\"string\">&#x27;+%m%d%H%M%S&#x27;</span>`</span><br><span class=\"line\">cp /etc/salt/master /etc/salt/master_bak-<span class=\"variable\">$tdate</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">HostName=`hostname`</span><br><span class=\"line\">master_ip=172.16.102.33</span><br><span class=\"line\"></span><br><span class=\"line\">cp /etc/salt/minion /etc/salt/minion_bak</span><br><span class=\"line\">sed -i  <span class=\"string\">&quot;17a master: <span class=\"variable\">$master_ip</span>&quot;</span> /etc/salt/minion</span><br><span class=\"line\">sed -i <span class=\"string\">&#x27;/^master/master: $&#123;master_ip&#125;&#x27;</span> /etc/salt/minion</span><br><span class=\"line\">sed -i  <span class=\"string\">&quot;113a id: <span class=\"variable\">$HostName</span>&quot;</span> /etc/salt/minion</span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"","more":"<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/bash/sh</span></span><br><span class=\"line\"><span class=\"comment\">#Function: install salt-master </span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> -e <span class=\"string\">&quot;\\033[1;32m ###########  close selinux ############# \\033[0m&quot;</span></span><br><span class=\"line\">sed -i <span class=\"string\">&#x27;s/SELINUX=enforcing/SELINUX=disabled/g&#x27;</span> /etc/selinux/config</span><br><span class=\"line\">setenforce 0</span><br><span class=\"line\">systemctl stop firewalld.service</span><br><span class=\"line\">systemctl <span class=\"built_in\">disable</span> firewalld.service</span><br><span class=\"line\">sleep 5</span><br><span class=\"line\"><span class=\"built_in\">echo</span> -e <span class=\"string\">&quot;\\033[1;32m ###########  install salt-minion  ############# \\033[0m&quot;</span></span><br><span class=\"line\">curl -L https://bootstrap.saltstack.com -o install_salt.sh</span><br><span class=\"line\">sh install_salt.sh -P</span><br><span class=\"line\"></span><br><span class=\"line\">tdate=`date <span class=\"string\">&#x27;+%m%d%H%M%S&#x27;</span>`</span><br><span class=\"line\">cp /etc/salt/master /etc/salt/master_bak-<span class=\"variable\">$tdate</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">HostName=`hostname`</span><br><span class=\"line\">master_ip=172.16.102.33</span><br><span class=\"line\"></span><br><span class=\"line\">cp /etc/salt/minion /etc/salt/minion_bak</span><br><span class=\"line\">sed -i  <span class=\"string\">&quot;17a master: <span class=\"variable\">$master_ip</span>&quot;</span> /etc/salt/minion</span><br><span class=\"line\">sed -i <span class=\"string\">&#x27;/^master/master: $&#123;master_ip&#125;&#x27;</span> /etc/salt/minion</span><br><span class=\"line\">sed -i  <span class=\"string\">&quot;113a id: <span class=\"variable\">$HostName</span>&quot;</span> /etc/salt/minion</span><br></pre></td></tr></table></figure>\n\n"},{"title":"Saltstack 简单使用","date":"2020-09-21T04:43:00.000Z","_content":"SaltStack 使用\n\n\n\n### SaltStack 介绍\n\n- SaltStack是一款Python开发的开源配置管理工具；\n- 可用来发现、监控、响应、协调、自动化管理本地、混合、云和IOT资产;\n- 其最主要的差异是主从模式，分为master和minions(slave)；\n- 经过配置之后master可以管理成千上万个minions；\n- master安装的是服务端组件salt-mater，minions安装的是salt-minion；\n- Salt使用基于ZeroMQ的强大异步网络拓扑，主要是为实现最快的通信；\n- Salt Master运行2个网络服务，ZeroMQ PUB系统，默认运行在4505端口；ZeroMQ REP系统，用于与Salt Minion进行双向通信，默认运行在4506端口；\n- Salt客户端(salt命令)发送的命令将通过ZeroMQ PUB/SUB广播给各个Salt Minion。前提是Salt Minion配置了Mater，并且Salt Master通过salt-key命令信任了对应的Salt Minion。建立连接之后，Salt Minion可以接收到广播命令，并且执行；\n- PUB/SUB是单向通信，因此一旦广播结束，Master服务器上的PUB接口就不会再与Minion进行任何通信。Minion在运行命令之后，通过REP端口(4506)将命令的返回数据发回Master。\n\n#### 命令发布过程\n\nSaltStack 的 Master 与 Minion 之间通过 ZeroMq 进行消息传递，使用 ZeroMq 的发布订阅模式，连接方式包括 TCP 和 IPC 。\n\nSalt 命令，将 cmd.run ls  命令从 salt.client.LocalClient.cmd_cli 发布到 Master，获取一个 JobID ,根据 jobID 获取命令执行结果。\n\nMaster 接收到命令后，将要执行的命令发送给客户端 minion\n\nMinion 从消息总线上接收到要处理的命令，交给 minion._handle_aes  处理。\n\nMinion  minion._handle_aes   发起一个本地线程调用 cmdmod 执行 ls 命令。线程执行完 ls 后，调用 Minion._return_pub 方法。将执行结果通过消息总线返回给master。 \n\nMaster接收到客户端返回的结果，调用 master.handle_ase 方法将结果写到文件中。\n\nSalt.client.LocalClient.cmd_cli 通过轮询获取Job 执行结果，将结果输出到终端。\n\n#### salt部署基本架构\n\n\n```mermaid\nstateDiagram\n    [*] --> Master\n    Master --> OS_Minion\n    Master --> Web01_Minion\n    Master --> Web02_Minion\n```\n\n\n\n####  salt端口\n\n安装好salt之后开始配置，salt-master默认监听两个端口：\n\n```javascript\n4505   publish_port   提供远程命令发送功能\n4506   ret_port       提供认证，文件服务，结果收集等功能\n确保客户端可以通信服务器的此2个端口，保证防火墙允许端口通过。因此在测试环境直接关闭防火墙。\n```\n\n#### 配置文件\n\n```javascript\nsalt-master的配置文件是/etc/salt/master\nsalt-minion的配置文件是/etc/salt/minion\n配置文件中包含了大量可调整的参数，这些参数控制master和minion各个方面\n```\n\n#### 配置 salt-master\n\n```javascript\n[root@master ~]# grep -v ^# /etc/salt/master|grep -v ^$\ninterface: 0.0.0.0  #绑定到本地的0.0.0.0地址\n\npublish_port: 4505　　#管理端口，命令发送\n\nuser: root　　　　　　#运行salt进程的用户\n\nworker_threads: 5　　#salt运行线程数，线程越多处理速度越快，不要超过cpu个数\n \nret_port: 4506　　#执行结果返回端口\n\npidfile: /var/run/salt-master.pid #pid文件位置\n\nlog_file: /var/log/salt/master　　#日志文件地址\n\n#自动接收minion的key\nauto_accept: False\n\n# minion的识别ID，可以是IP，域名，或是可以通过DNS解析的字符串\nid: slave   # 最好使用主机名\n\n# salt运行的用户权限\nuser: root\n\n# master的识别ID，可以是IP，域名，或是可以通过DNS解析的字符串\nmaster : master    #master 地址\n \n# master通信端口\nmaster_port: 4506\n \n# 备份模式，minion是本地备份，当进行文件管理时的文件备份模式\nbackup_mode: minion\n \n# 执行salt-call时候的输出方式\noutput: nested\n \n# minion等待master接受认证的时间\nacceptance_wait_time: 10\n \n# 失败重连次数，0表示无限次，非零会不断尝试到设置值后停止尝试\nacceptance_wait_time_max: 0\n \n# 重新认证延迟时间，可以避免因为master的key改变导致minion需要重新认证的syn风暴\nrandom_reauth_delay: 60\n\n# salt state执行时候的根目录\nfile_roots:\n  base:\n    - /srv/salt\n```\n\n####  配置satl-minion \n\n```javascript\n[root@slave ~]# grep -v ^# /etc/salt/minion|grep -v ^$\nmaster: master    #master 地址\nmaster_port: 4506\nuser: root\nid: slave   # 最好使用主机名\nacceptance_wait_time: 10\nlog_file: /var/log/salt/minion\n```\n\n\n\n#### 启动salt-master和salt-minion\n\n```javascript\nsystemctl start salt-minion\nsystemctl start salt-master\n\n#检查salt状态\nsystemctl status salt-minion\nsystemctl status salt-master\n```\n\n\n\n### SaltStack VS Ansible\n\n\n\n| SaltStack                                                    | Ansible                                       |\n| ------------------------------------------------------------ | --------------------------------------------- |\n| SaltStack 依靠ZeroMQ速度快                                   | Ansible SSH传输速度慢一些                     |\n| ZeroMQ本身不加密，AES加密，需注意MITM攻击                    | SSH安全性高                                   |\n| Master需要守护进程                                           | 无额外开支，SSH即可                           |\n| State语法需要学习                                            | playbook语法相对简单，容易学习                |\n| excution模块+state模块，state会调用excution模块              | Ansible模块+playbook                          |\n| 使用topfile [top.sls](https://docs.saltstack.com/en/latest/ref/states/top.html) 使用[YAML](http://yaml.org/) | playbook使用YAML                              |\n| 围绕Master输入命令，首次连接使用加密key，使用ZeroMQ库不会拥堵，持续连接速度更快 | 使用SSH通道，无固定Master，更安全，也有MQ版本 |\n| 未提及                                                       | 配置记录文件，原始vs生产                      |\n| 默认本地root，客户端root                                     | 支持多用户sudo操作                            |\n| 密码容易保管，命令容易审计                                   | SSH，公钥连接                                 |\n| 配置模块化，学习成本更高                                     | 克隆Ansible Git，语法简单                     |\n\n\n\n### 安装\n\n#### SALT MASTER\n\n```\ncurl -L https://bootstrap.saltstack.com -o install_salt.sh\nsudo sh install_salt.sh -P -M\n```\n\n#### SALT MINION\n\n```\ncurl -L https://bootstrap.saltstack.com -o install_salt.sh\nsudo sh install_salt.sh -P\n```\n\n配置脚本\n\n```\n#!/bin/bash\n\nHostName=`hostname`\ncp /etc/salt/minion /etc/salt/minion_bak\nsed -i  \"17a master: 172.16.102.33\" /etc/salt/minion\nsed -i  \"113a id: $HostName\" /etc/salt/minion\n\nsystemctl enable salt-minion\nsystemctl start salt-minion\n```\n\n\n\n\n\n### 在master上接收minion秘钥\n\n在minion启动后连接master会请求master为其签发证书，等待证书签发完成后，master可以信任minion，并且minion和master之间的通信是加密的。\n\n在salt-master执行\n\nsalt-key命令用于管理mionion秘钥\n\n```javascript\n[root@master ~]# salt-key -L\nAccepted Keys:\nDenied Keys:\nUnaccepted Keys:\nslave　　　　#此时已经出现slave\nRejected Keys:\n```\n此时slave已经出现在unaccepted keys中，说明minion已经和master联系，并且master已经获取了minion的公钥，等待下一步指令。\n\n### 检查master和minion的秘钥匹配\n\n在master上执行\n\n```javascript\n[root@master ~]# salt-key -f slave\nUnaccepted Keys:\nslave:  0a:b9:97:b5:9a:65:b8:49:a1:50:a5:6a:66:ce:33:ea\n```\n\n然后可以在minion上获取minion的秘钥\n\n```javascript\n[root@slave ~]# salt-call --local key.finger\nlocal:\n    0a:b9:97:b5:9a:65:b8:49:a1:50:a5:6a:66:ce:33:ea\n```\n\n因此可确认秘钥匹配，在master上接收秘钥\n\n```javascript\n[root@master ~]# salt-key -a slave\nThe following keys are going to be accepted:\nUnaccepted Keys:\nslave\nProceed? [n/Y] y\nKey for minion slave accepted.\n```\n\n确认接收秘钥后，检验minion秘钥是否被接收\n\n```javascript\n[root@master ~]# salt-key -L\nAccepted Keys:\nslave\nDenied Keys:\nUnaccepted Keys:\nRejected Keys:\n```\n\n秘钥接收完成后，就可以执行第一条salt啦\n\n\n\n### 认证命令介绍\n\n```\nsalt-key –L #查看所有minion-key\nsalt-key –a #接受某个minion-key\nsalt-key –A #接受所有minion-key\nsalt-key –d #删除某个minion-key\nsalt-key –D #删除所有minion-key\n```\n\n\n\n### SaltStack minion 匹配方式\n\n1、Glob（salt默认的target 类型，使用shell的通配符来指定一个或多个 minion ID）\n\n```\nsalt \\* test.ping  或者 salt '*' test.ping\n```\n\n2、 pcre 兼容正则表达式\n\n```\nsalt -E ‘^[m|M]in.[e|o|u]n$’ test.ping\n```\n\n3、 subnet (通过指定一个IPv4 地址或一个CIDR 的IPv4 子网)\n\n```\nsalt -S 192168.0.42 test.ping\n或者\nsalt -s 192.168.0.0/16 test.ping\n```\n\n4、Grains（salt 可以通过操作系统、CPU架构及自定义信息等机器特征进行 target Minion）\n\n```\nsalt -G 'os:Ubuntu' test.ping\nsalt -G 'os_family:Debian' test.ping\n```\n\n5、pillar (salt 支持通过 pillar 数据进行匹配)\n\n```\nsalt -l 'my_val:my_val' test.ping\n```\n\n6、混合（compound）\n\n```\nsalt -C 'web* or G@os:Arch' test.ping\n```\n\n### salt 常用模板\n\n\n\n```\nsalt '*' status.loadavg            #系统信息\nsalt '*' status.cpuinfo            #CPU 信息\nsalt \"*\" status.diskstats          #查看磁盘信息\nsalt \"*\" status.meminfo            #查看内存信息\nsalt \"*\" status.w                  #w命令返回信息\nsalt node01  sys.list_modules      #查看所有module 列表 \nsalt node01  sys.list_functions cmd    查看指定 module 的所有function 方法\nsalt node01 sys.doc cmd.run        查看指定 module 用法\n\n```\n\n\n\n### salt相关命令\n\n```\n\nsalt-run manage.up \t\t\t# 查看存活的minion\nsalt-run manage.down \t\t# 查看死掉的minion\nsalt-run manage.down removekeys=True \t\t# 查看down掉的minion，并将其删除\nsalt-run manage.status \t\t\t\t\t# 查看minion的相关状态\nsalt-run manage.versions \t\t\t\t# 查看salt的所有master和minion的版本信息\nsalt-run jobs.active \t\t\t\t\t# 查看哪些系统任务还在处理中\nsalt-run jobs.list_jobs \t\t\t\t# 显示所有的已完成或部分完成的任务信息\nsalt '*' saltutil.running \t\t\t\t# 查看运行的jobs ID\nsalt \\* saltutil.kill_job 20151209034239907625 # kill掉进程ID\nsalt -d \t\t\t\t\t# 查看帮助文档\nsalt -d|grep service \t\t\t\t# 查看service相关模块命令\nsalt '*' sys.doc \t\t\t\t# 查看帮助文档\nsalt-key -L \t\t\t\t# 查询所有接收到的证书\nsalt-key -a <证书名> \t\t\t\t# 接收单个证书\nsalt-key -A \t\t\t\t\t# 接受所有证书\nsalt-key -d <证书名> \t\t\t\t# 删除单个证书\nsalt-key -D \t\t\t\t\t\t# 删除所有证书\nsalt '*' service.get_all \t\t\t# 获取主机所有服务\nsalt '*' service.reload sshd \t\t# 重载sshd服务\nsalt '*' pkg.list_pkgs # 显示软件包版本列表\nsalt '*' pkg.version python # 显示软件包版本信息\nsalt '*' pkg.install httpd # 安装软件包\nsalt 'node1.com' service.status mysql # 查看mysql服务状态\nsalt 'node1.com' service.start mysql # 启动mysql服务\nsalt 'node1.com' cmd.run 'service mysql status' # 与上面一样查看服务\nsalt '*' sys.list_modules # 模块列表\nsalt-cp '*' /etc/hosts /etc/hosts # 把master上的hosts文件分发到所有主机\nsalt '*' cp.get_file salt://ceshi/b /tmp/test # 把salt-master端相应的文件，分发文件到minion端\nsalt '*' cp.get_dir salt://zabbix /tmp # 把salt-master端相应的目录，分发文件到minion端\nsalt '*' file.copy /tmp/zabbix.sls /tmp/sls # 把salt-master端对应文件拷贝到minion端相应目录下\nsalt '*' cmd.run 'uptime' # 远程命令执行测试\n\n\n\n```\n\n 远程执行脚本\n\n```\n'cmd.script:'\n salt '*' cmd.script salt://scripts/runme.sh\n salt '*' cmd.script salt://scripts/runme.sh 'arg1 arg2 \"arg 3\"'\n salt '*' cmd.script salt://scripts/windows_task.ps1 args=' -Input c:\\tmp\\infile.txt' shell='powershell'\n salt '*' cmd.script salt://scripts/runme.sh stdin='one\\ntwo\\nthree\\nfour\\nfive\\n'\n \n \n'cmd.shell:'\n\n This passes the cmd argument directly to the shell\n salt '*' cmd.shell \"ls -l | awk '/foo/{print \\$2}'\"\n salt '*' cmd.shell template=jinja \"ls -l /tmp/{{grains.id}} | awk '/foo/{print \\$2}'\"\n salt '*' cmd.shell \"Get-ChildItem C:\\ \" shell='powershell'\n salt '*' cmd.shell \"grep f\" stdin='one\\ntwo\\nthree\\nfour\\nfive\\n'\n salt '*' cmd.shell cmd='sed -e s/=/:/g'\n \n'cmd.shells:'\n salt '*' cmd.shells\n'cmd.tty:'\n salt '*' cmd.tty tty0 'This is a test'\n salt '*' cmd.tty pts3 'This is a test'\n \n'cmd.which:'\n salt '*' cmd.which cat\n \n**grains选项：**\nsalt '*' grains.ls # 查看grains分类\nsalt '*' grains.items # 查看grains所有信息\nsalt '*' grains.item osrelease # 查看grains某个信息\n```\n\n\n\n\n\n","source":"_posts/saltstack/saltstack.md","raw":"---\ntitle: Saltstack 简单使用\ndate: 2020-09-21 12:43\ncategories:\n- salt\ntags:\n- salt\n---\nSaltStack 使用\n\n\n\n### SaltStack 介绍\n\n- SaltStack是一款Python开发的开源配置管理工具；\n- 可用来发现、监控、响应、协调、自动化管理本地、混合、云和IOT资产;\n- 其最主要的差异是主从模式，分为master和minions(slave)；\n- 经过配置之后master可以管理成千上万个minions；\n- master安装的是服务端组件salt-mater，minions安装的是salt-minion；\n- Salt使用基于ZeroMQ的强大异步网络拓扑，主要是为实现最快的通信；\n- Salt Master运行2个网络服务，ZeroMQ PUB系统，默认运行在4505端口；ZeroMQ REP系统，用于与Salt Minion进行双向通信，默认运行在4506端口；\n- Salt客户端(salt命令)发送的命令将通过ZeroMQ PUB/SUB广播给各个Salt Minion。前提是Salt Minion配置了Mater，并且Salt Master通过salt-key命令信任了对应的Salt Minion。建立连接之后，Salt Minion可以接收到广播命令，并且执行；\n- PUB/SUB是单向通信，因此一旦广播结束，Master服务器上的PUB接口就不会再与Minion进行任何通信。Minion在运行命令之后，通过REP端口(4506)将命令的返回数据发回Master。\n\n#### 命令发布过程\n\nSaltStack 的 Master 与 Minion 之间通过 ZeroMq 进行消息传递，使用 ZeroMq 的发布订阅模式，连接方式包括 TCP 和 IPC 。\n\nSalt 命令，将 cmd.run ls  命令从 salt.client.LocalClient.cmd_cli 发布到 Master，获取一个 JobID ,根据 jobID 获取命令执行结果。\n\nMaster 接收到命令后，将要执行的命令发送给客户端 minion\n\nMinion 从消息总线上接收到要处理的命令，交给 minion._handle_aes  处理。\n\nMinion  minion._handle_aes   发起一个本地线程调用 cmdmod 执行 ls 命令。线程执行完 ls 后，调用 Minion._return_pub 方法。将执行结果通过消息总线返回给master。 \n\nMaster接收到客户端返回的结果，调用 master.handle_ase 方法将结果写到文件中。\n\nSalt.client.LocalClient.cmd_cli 通过轮询获取Job 执行结果，将结果输出到终端。\n\n#### salt部署基本架构\n\n\n```mermaid\nstateDiagram\n    [*] --> Master\n    Master --> OS_Minion\n    Master --> Web01_Minion\n    Master --> Web02_Minion\n```\n\n\n\n####  salt端口\n\n安装好salt之后开始配置，salt-master默认监听两个端口：\n\n```javascript\n4505   publish_port   提供远程命令发送功能\n4506   ret_port       提供认证，文件服务，结果收集等功能\n确保客户端可以通信服务器的此2个端口，保证防火墙允许端口通过。因此在测试环境直接关闭防火墙。\n```\n\n#### 配置文件\n\n```javascript\nsalt-master的配置文件是/etc/salt/master\nsalt-minion的配置文件是/etc/salt/minion\n配置文件中包含了大量可调整的参数，这些参数控制master和minion各个方面\n```\n\n#### 配置 salt-master\n\n```javascript\n[root@master ~]# grep -v ^# /etc/salt/master|grep -v ^$\ninterface: 0.0.0.0  #绑定到本地的0.0.0.0地址\n\npublish_port: 4505　　#管理端口，命令发送\n\nuser: root　　　　　　#运行salt进程的用户\n\nworker_threads: 5　　#salt运行线程数，线程越多处理速度越快，不要超过cpu个数\n \nret_port: 4506　　#执行结果返回端口\n\npidfile: /var/run/salt-master.pid #pid文件位置\n\nlog_file: /var/log/salt/master　　#日志文件地址\n\n#自动接收minion的key\nauto_accept: False\n\n# minion的识别ID，可以是IP，域名，或是可以通过DNS解析的字符串\nid: slave   # 最好使用主机名\n\n# salt运行的用户权限\nuser: root\n\n# master的识别ID，可以是IP，域名，或是可以通过DNS解析的字符串\nmaster : master    #master 地址\n \n# master通信端口\nmaster_port: 4506\n \n# 备份模式，minion是本地备份，当进行文件管理时的文件备份模式\nbackup_mode: minion\n \n# 执行salt-call时候的输出方式\noutput: nested\n \n# minion等待master接受认证的时间\nacceptance_wait_time: 10\n \n# 失败重连次数，0表示无限次，非零会不断尝试到设置值后停止尝试\nacceptance_wait_time_max: 0\n \n# 重新认证延迟时间，可以避免因为master的key改变导致minion需要重新认证的syn风暴\nrandom_reauth_delay: 60\n\n# salt state执行时候的根目录\nfile_roots:\n  base:\n    - /srv/salt\n```\n\n####  配置satl-minion \n\n```javascript\n[root@slave ~]# grep -v ^# /etc/salt/minion|grep -v ^$\nmaster: master    #master 地址\nmaster_port: 4506\nuser: root\nid: slave   # 最好使用主机名\nacceptance_wait_time: 10\nlog_file: /var/log/salt/minion\n```\n\n\n\n#### 启动salt-master和salt-minion\n\n```javascript\nsystemctl start salt-minion\nsystemctl start salt-master\n\n#检查salt状态\nsystemctl status salt-minion\nsystemctl status salt-master\n```\n\n\n\n### SaltStack VS Ansible\n\n\n\n| SaltStack                                                    | Ansible                                       |\n| ------------------------------------------------------------ | --------------------------------------------- |\n| SaltStack 依靠ZeroMQ速度快                                   | Ansible SSH传输速度慢一些                     |\n| ZeroMQ本身不加密，AES加密，需注意MITM攻击                    | SSH安全性高                                   |\n| Master需要守护进程                                           | 无额外开支，SSH即可                           |\n| State语法需要学习                                            | playbook语法相对简单，容易学习                |\n| excution模块+state模块，state会调用excution模块              | Ansible模块+playbook                          |\n| 使用topfile [top.sls](https://docs.saltstack.com/en/latest/ref/states/top.html) 使用[YAML](http://yaml.org/) | playbook使用YAML                              |\n| 围绕Master输入命令，首次连接使用加密key，使用ZeroMQ库不会拥堵，持续连接速度更快 | 使用SSH通道，无固定Master，更安全，也有MQ版本 |\n| 未提及                                                       | 配置记录文件，原始vs生产                      |\n| 默认本地root，客户端root                                     | 支持多用户sudo操作                            |\n| 密码容易保管，命令容易审计                                   | SSH，公钥连接                                 |\n| 配置模块化，学习成本更高                                     | 克隆Ansible Git，语法简单                     |\n\n\n\n### 安装\n\n#### SALT MASTER\n\n```\ncurl -L https://bootstrap.saltstack.com -o install_salt.sh\nsudo sh install_salt.sh -P -M\n```\n\n#### SALT MINION\n\n```\ncurl -L https://bootstrap.saltstack.com -o install_salt.sh\nsudo sh install_salt.sh -P\n```\n\n配置脚本\n\n```\n#!/bin/bash\n\nHostName=`hostname`\ncp /etc/salt/minion /etc/salt/minion_bak\nsed -i  \"17a master: 172.16.102.33\" /etc/salt/minion\nsed -i  \"113a id: $HostName\" /etc/salt/minion\n\nsystemctl enable salt-minion\nsystemctl start salt-minion\n```\n\n\n\n\n\n### 在master上接收minion秘钥\n\n在minion启动后连接master会请求master为其签发证书，等待证书签发完成后，master可以信任minion，并且minion和master之间的通信是加密的。\n\n在salt-master执行\n\nsalt-key命令用于管理mionion秘钥\n\n```javascript\n[root@master ~]# salt-key -L\nAccepted Keys:\nDenied Keys:\nUnaccepted Keys:\nslave　　　　#此时已经出现slave\nRejected Keys:\n```\n此时slave已经出现在unaccepted keys中，说明minion已经和master联系，并且master已经获取了minion的公钥，等待下一步指令。\n\n### 检查master和minion的秘钥匹配\n\n在master上执行\n\n```javascript\n[root@master ~]# salt-key -f slave\nUnaccepted Keys:\nslave:  0a:b9:97:b5:9a:65:b8:49:a1:50:a5:6a:66:ce:33:ea\n```\n\n然后可以在minion上获取minion的秘钥\n\n```javascript\n[root@slave ~]# salt-call --local key.finger\nlocal:\n    0a:b9:97:b5:9a:65:b8:49:a1:50:a5:6a:66:ce:33:ea\n```\n\n因此可确认秘钥匹配，在master上接收秘钥\n\n```javascript\n[root@master ~]# salt-key -a slave\nThe following keys are going to be accepted:\nUnaccepted Keys:\nslave\nProceed? [n/Y] y\nKey for minion slave accepted.\n```\n\n确认接收秘钥后，检验minion秘钥是否被接收\n\n```javascript\n[root@master ~]# salt-key -L\nAccepted Keys:\nslave\nDenied Keys:\nUnaccepted Keys:\nRejected Keys:\n```\n\n秘钥接收完成后，就可以执行第一条salt啦\n\n\n\n### 认证命令介绍\n\n```\nsalt-key –L #查看所有minion-key\nsalt-key –a #接受某个minion-key\nsalt-key –A #接受所有minion-key\nsalt-key –d #删除某个minion-key\nsalt-key –D #删除所有minion-key\n```\n\n\n\n### SaltStack minion 匹配方式\n\n1、Glob（salt默认的target 类型，使用shell的通配符来指定一个或多个 minion ID）\n\n```\nsalt \\* test.ping  或者 salt '*' test.ping\n```\n\n2、 pcre 兼容正则表达式\n\n```\nsalt -E ‘^[m|M]in.[e|o|u]n$’ test.ping\n```\n\n3、 subnet (通过指定一个IPv4 地址或一个CIDR 的IPv4 子网)\n\n```\nsalt -S 192168.0.42 test.ping\n或者\nsalt -s 192.168.0.0/16 test.ping\n```\n\n4、Grains（salt 可以通过操作系统、CPU架构及自定义信息等机器特征进行 target Minion）\n\n```\nsalt -G 'os:Ubuntu' test.ping\nsalt -G 'os_family:Debian' test.ping\n```\n\n5、pillar (salt 支持通过 pillar 数据进行匹配)\n\n```\nsalt -l 'my_val:my_val' test.ping\n```\n\n6、混合（compound）\n\n```\nsalt -C 'web* or G@os:Arch' test.ping\n```\n\n### salt 常用模板\n\n\n\n```\nsalt '*' status.loadavg            #系统信息\nsalt '*' status.cpuinfo            #CPU 信息\nsalt \"*\" status.diskstats          #查看磁盘信息\nsalt \"*\" status.meminfo            #查看内存信息\nsalt \"*\" status.w                  #w命令返回信息\nsalt node01  sys.list_modules      #查看所有module 列表 \nsalt node01  sys.list_functions cmd    查看指定 module 的所有function 方法\nsalt node01 sys.doc cmd.run        查看指定 module 用法\n\n```\n\n\n\n### salt相关命令\n\n```\n\nsalt-run manage.up \t\t\t# 查看存活的minion\nsalt-run manage.down \t\t# 查看死掉的minion\nsalt-run manage.down removekeys=True \t\t# 查看down掉的minion，并将其删除\nsalt-run manage.status \t\t\t\t\t# 查看minion的相关状态\nsalt-run manage.versions \t\t\t\t# 查看salt的所有master和minion的版本信息\nsalt-run jobs.active \t\t\t\t\t# 查看哪些系统任务还在处理中\nsalt-run jobs.list_jobs \t\t\t\t# 显示所有的已完成或部分完成的任务信息\nsalt '*' saltutil.running \t\t\t\t# 查看运行的jobs ID\nsalt \\* saltutil.kill_job 20151209034239907625 # kill掉进程ID\nsalt -d \t\t\t\t\t# 查看帮助文档\nsalt -d|grep service \t\t\t\t# 查看service相关模块命令\nsalt '*' sys.doc \t\t\t\t# 查看帮助文档\nsalt-key -L \t\t\t\t# 查询所有接收到的证书\nsalt-key -a <证书名> \t\t\t\t# 接收单个证书\nsalt-key -A \t\t\t\t\t# 接受所有证书\nsalt-key -d <证书名> \t\t\t\t# 删除单个证书\nsalt-key -D \t\t\t\t\t\t# 删除所有证书\nsalt '*' service.get_all \t\t\t# 获取主机所有服务\nsalt '*' service.reload sshd \t\t# 重载sshd服务\nsalt '*' pkg.list_pkgs # 显示软件包版本列表\nsalt '*' pkg.version python # 显示软件包版本信息\nsalt '*' pkg.install httpd # 安装软件包\nsalt 'node1.com' service.status mysql # 查看mysql服务状态\nsalt 'node1.com' service.start mysql # 启动mysql服务\nsalt 'node1.com' cmd.run 'service mysql status' # 与上面一样查看服务\nsalt '*' sys.list_modules # 模块列表\nsalt-cp '*' /etc/hosts /etc/hosts # 把master上的hosts文件分发到所有主机\nsalt '*' cp.get_file salt://ceshi/b /tmp/test # 把salt-master端相应的文件，分发文件到minion端\nsalt '*' cp.get_dir salt://zabbix /tmp # 把salt-master端相应的目录，分发文件到minion端\nsalt '*' file.copy /tmp/zabbix.sls /tmp/sls # 把salt-master端对应文件拷贝到minion端相应目录下\nsalt '*' cmd.run 'uptime' # 远程命令执行测试\n\n\n\n```\n\n 远程执行脚本\n\n```\n'cmd.script:'\n salt '*' cmd.script salt://scripts/runme.sh\n salt '*' cmd.script salt://scripts/runme.sh 'arg1 arg2 \"arg 3\"'\n salt '*' cmd.script salt://scripts/windows_task.ps1 args=' -Input c:\\tmp\\infile.txt' shell='powershell'\n salt '*' cmd.script salt://scripts/runme.sh stdin='one\\ntwo\\nthree\\nfour\\nfive\\n'\n \n \n'cmd.shell:'\n\n This passes the cmd argument directly to the shell\n salt '*' cmd.shell \"ls -l | awk '/foo/{print \\$2}'\"\n salt '*' cmd.shell template=jinja \"ls -l /tmp/{{grains.id}} | awk '/foo/{print \\$2}'\"\n salt '*' cmd.shell \"Get-ChildItem C:\\ \" shell='powershell'\n salt '*' cmd.shell \"grep f\" stdin='one\\ntwo\\nthree\\nfour\\nfive\\n'\n salt '*' cmd.shell cmd='sed -e s/=/:/g'\n \n'cmd.shells:'\n salt '*' cmd.shells\n'cmd.tty:'\n salt '*' cmd.tty tty0 'This is a test'\n salt '*' cmd.tty pts3 'This is a test'\n \n'cmd.which:'\n salt '*' cmd.which cat\n \n**grains选项：**\nsalt '*' grains.ls # 查看grains分类\nsalt '*' grains.items # 查看grains所有信息\nsalt '*' grains.item osrelease # 查看grains某个信息\n```\n\n\n\n\n\n","slug":"saltstack/saltstack","published":1,"updated":"2021-06-18T08:07:11.204Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cku697a0u007000uh5d5sdbzy","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><p>SaltStack 使用</p>\n<h3 id=\"SaltStack-介绍\"><a href=\"#SaltStack-介绍\" class=\"headerlink\" title=\"SaltStack 介绍\"></a>SaltStack 介绍</h3><ul>\n<li>SaltStack是一款Python开发的开源配置管理工具；</li>\n<li>可用来发现、监控、响应、协调、自动化管理本地、混合、云和IOT资产;</li>\n<li>其最主要的差异是主从模式，分为master和minions(slave)；</li>\n<li>经过配置之后master可以管理成千上万个minions；</li>\n<li>master安装的是服务端组件salt-mater，minions安装的是salt-minion；</li>\n<li>Salt使用基于ZeroMQ的强大异步网络拓扑，主要是为实现最快的通信；</li>\n<li>Salt Master运行2个网络服务，ZeroMQ PUB系统，默认运行在4505端口；ZeroMQ REP系统，用于与Salt Minion进行双向通信，默认运行在4506端口；</li>\n<li>Salt客户端(salt命令)发送的命令将通过ZeroMQ PUB/SUB广播给各个Salt Minion。前提是Salt Minion配置了Mater，并且Salt Master通过salt-key命令信任了对应的Salt Minion。建立连接之后，Salt Minion可以接收到广播命令，并且执行；</li>\n<li>PUB/SUB是单向通信，因此一旦广播结束，Master服务器上的PUB接口就不会再与Minion进行任何通信。Minion在运行命令之后，通过REP端口(4506)将命令的返回数据发回Master。</li>\n</ul>\n<h4 id=\"命令发布过程\"><a href=\"#命令发布过程\" class=\"headerlink\" title=\"命令发布过程\"></a>命令发布过程</h4><p>SaltStack 的 Master 与 Minion 之间通过 ZeroMq 进行消息传递，使用 ZeroMq 的发布订阅模式，连接方式包括 TCP 和 IPC 。</p>\n<p>Salt 命令，将 cmd.run ls  命令从 salt.client.LocalClient.cmd_cli 发布到 Master，获取一个 JobID ,根据 jobID 获取命令执行结果。</p>\n<p>Master 接收到命令后，将要执行的命令发送给客户端 minion</p>\n<p>Minion 从消息总线上接收到要处理的命令，交给 minion._handle_aes  处理。</p>\n<p>Minion  minion._handle_aes   发起一个本地线程调用 cmdmod 执行 ls 命令。线程执行完 ls 后，调用 Minion._return_pub 方法。将执行结果通过消息总线返回给master。 </p>\n<p>Master接收到客户端返回的结果，调用 master.handle_ase 方法将结果写到文件中。</p>\n<p>Salt.client.LocalClient.cmd_cli 通过轮询获取Job 执行结果，将结果输出到终端。</p>\n<h4 id=\"salt部署基本架构\"><a href=\"#salt部署基本架构\" class=\"headerlink\" title=\"salt部署基本架构\"></a>salt部署基本架构</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">stateDiagram</span><br><span class=\"line\">    [*] --&gt; Master</span><br><span class=\"line\">    Master --&gt; OS_Minion</span><br><span class=\"line\">    Master --&gt; Web01_Minion</span><br><span class=\"line\">    Master --&gt; Web02_Minion</span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"salt端口\"><a href=\"#salt端口\" class=\"headerlink\" title=\"salt端口\"></a>salt端口</h4><p>安装好salt之后开始配置，salt-master默认监听两个端口：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"number\">4505</span>   publish_port   提供远程命令发送功能</span><br><span class=\"line\"><span class=\"number\">4506</span>   ret_port       提供认证，文件服务，结果收集等功能</span><br><span class=\"line\">确保客户端可以通信服务器的此<span class=\"number\">2</span>个端口，保证防火墙允许端口通过。因此在测试环境直接关闭防火墙。</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"配置文件\"><a href=\"#配置文件\" class=\"headerlink\" title=\"配置文件\"></a>配置文件</h4><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">salt-master的配置文件是/etc/salt/master</span><br><span class=\"line\">salt-minion的配置文件是/etc/salt/minion</span><br><span class=\"line\">配置文件中包含了大量可调整的参数，这些参数控制master和minion各个方面</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"配置-salt-master\"><a href=\"#配置-salt-master\" class=\"headerlink\" title=\"配置 salt-master\"></a>配置 salt-master</h4><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@master ~]# grep -v ^# /etc/salt/master|grep -v ^$</span><br><span class=\"line\">interface: 0.0.0.0  #绑定到本地的0.0.0.0地址</span><br><span class=\"line\"></span><br><span class=\"line\">publish_port: 4505　　#管理端口，命令发送</span><br><span class=\"line\"></span><br><span class=\"line\">user: root　　　　　　#运行salt进程的用户</span><br><span class=\"line\"></span><br><span class=\"line\">worker_threads: <span class=\"number\">5</span>　　#salt运行线程数，线程越多处理速度越快，不要超过cpu个数</span><br><span class=\"line\"> </span><br><span class=\"line\">ret_port: 4506　　#执行结果返回端口</span><br><span class=\"line\"></span><br><span class=\"line\">pidfile: <span class=\"regexp\">/var/</span>run/salt-master.pid #pid文件位置</span><br><span class=\"line\"></span><br><span class=\"line\">log_file: /var/log/salt/master　　#日志文件地址</span><br><span class=\"line\"></span><br><span class=\"line\">#自动接收minion的key</span><br><span class=\"line\">auto_accept: False</span><br><span class=\"line\"></span><br><span class=\"line\"># minion的识别ID，可以是IP，域名，或是可以通过DNS解析的字符串</span><br><span class=\"line\">id: slave   # 最好使用主机名</span><br><span class=\"line\"></span><br><span class=\"line\"># salt运行的用户权限</span><br><span class=\"line\">user: root</span><br><span class=\"line\"></span><br><span class=\"line\"># master的识别ID，可以是IP，域名，或是可以通过DNS解析的字符串</span><br><span class=\"line\">master : master    #master 地址</span><br><span class=\"line\"> </span><br><span class=\"line\"># master通信端口</span><br><span class=\"line\">master_port: <span class=\"number\">4506</span></span><br><span class=\"line\"> </span><br><span class=\"line\"># 备份模式，minion是本地备份，当进行文件管理时的文件备份模式</span><br><span class=\"line\">backup_mode: minion</span><br><span class=\"line\"> </span><br><span class=\"line\"># 执行salt-call时候的输出方式</span><br><span class=\"line\">output: nested</span><br><span class=\"line\"> </span><br><span class=\"line\"># minion等待master接受认证的时间</span><br><span class=\"line\">acceptance_wait_time: <span class=\"number\">10</span></span><br><span class=\"line\"> </span><br><span class=\"line\"># 失败重连次数，0表示无限次，非零会不断尝试到设置值后停止尝试</span><br><span class=\"line\">acceptance_wait_time_max: <span class=\"number\">0</span></span><br><span class=\"line\"> </span><br><span class=\"line\"># 重新认证延迟时间，可以避免因为master的key改变导致minion需要重新认证的syn风暴</span><br><span class=\"line\">random_reauth_delay: <span class=\"number\">60</span></span><br><span class=\"line\"></span><br><span class=\"line\"># salt state执行时候的根目录</span><br><span class=\"line\">file_roots:</span><br><span class=\"line\">  base:</span><br><span class=\"line\">    - <span class=\"regexp\">/srv/</span>salt</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"配置satl-minion\"><a href=\"#配置satl-minion\" class=\"headerlink\" title=\"配置satl-minion\"></a>配置satl-minion</h4><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@slave ~]# grep -v ^# /etc/salt/minion|grep -v ^$</span><br><span class=\"line\">master: master    #master 地址</span><br><span class=\"line\">master_port: <span class=\"number\">4506</span></span><br><span class=\"line\">user: root</span><br><span class=\"line\">id: slave   # 最好使用主机名</span><br><span class=\"line\">acceptance_wait_time: <span class=\"number\">10</span></span><br><span class=\"line\">log_file: <span class=\"regexp\">/var/</span>log/salt/minion</span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"启动salt-master和salt-minion\"><a href=\"#启动salt-master和salt-minion\" class=\"headerlink\" title=\"启动salt-master和salt-minion\"></a>启动salt-master和salt-minion</h4><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl start salt-minion</span><br><span class=\"line\">systemctl start salt-master</span><br><span class=\"line\"></span><br><span class=\"line\">#检查salt状态</span><br><span class=\"line\">systemctl status salt-minion</span><br><span class=\"line\">systemctl status salt-master</span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"SaltStack-VS-Ansible\"><a href=\"#SaltStack-VS-Ansible\" class=\"headerlink\" title=\"SaltStack VS Ansible\"></a>SaltStack VS Ansible</h3><table>\n<thead>\n<tr>\n<th>SaltStack</th>\n<th>Ansible</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>SaltStack 依靠ZeroMQ速度快</td>\n<td>Ansible SSH传输速度慢一些</td>\n</tr>\n<tr>\n<td>ZeroMQ本身不加密，AES加密，需注意MITM攻击</td>\n<td>SSH安全性高</td>\n</tr>\n<tr>\n<td>Master需要守护进程</td>\n<td>无额外开支，SSH即可</td>\n</tr>\n<tr>\n<td>State语法需要学习</td>\n<td>playbook语法相对简单，容易学习</td>\n</tr>\n<tr>\n<td>excution模块+state模块，state会调用excution模块</td>\n<td>Ansible模块+playbook</td>\n</tr>\n<tr>\n<td>使用topfile <a href=\"https://docs.saltstack.com/en/latest/ref/states/top.html\">top.sls</a> 使用<a href=\"http://yaml.org/\">YAML</a></td>\n<td>playbook使用YAML</td>\n</tr>\n<tr>\n<td>围绕Master输入命令，首次连接使用加密key，使用ZeroMQ库不会拥堵，持续连接速度更快</td>\n<td>使用SSH通道，无固定Master，更安全，也有MQ版本</td>\n</tr>\n<tr>\n<td>未提及</td>\n<td>配置记录文件，原始vs生产</td>\n</tr>\n<tr>\n<td>默认本地root，客户端root</td>\n<td>支持多用户sudo操作</td>\n</tr>\n<tr>\n<td>密码容易保管，命令容易审计</td>\n<td>SSH，公钥连接</td>\n</tr>\n<tr>\n<td>配置模块化，学习成本更高</td>\n<td>克隆Ansible Git，语法简单</td>\n</tr>\n</tbody></table>\n<h3 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h3><h4 id=\"SALT-MASTER\"><a href=\"#SALT-MASTER\" class=\"headerlink\" title=\"SALT MASTER\"></a>SALT MASTER</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -L https:&#x2F;&#x2F;bootstrap.saltstack.com -o install_salt.sh</span><br><span class=\"line\">sudo sh install_salt.sh -P -M</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"SALT-MINION\"><a href=\"#SALT-MINION\" class=\"headerlink\" title=\"SALT MINION\"></a>SALT MINION</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -L https:&#x2F;&#x2F;bootstrap.saltstack.com -o install_salt.sh</span><br><span class=\"line\">sudo sh install_salt.sh -P</span><br></pre></td></tr></table></figure>\n\n<p>配置脚本</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#!&#x2F;bin&#x2F;bash</span><br><span class=\"line\"></span><br><span class=\"line\">HostName&#x3D;&#96;hostname&#96;</span><br><span class=\"line\">cp &#x2F;etc&#x2F;salt&#x2F;minion &#x2F;etc&#x2F;salt&#x2F;minion_bak</span><br><span class=\"line\">sed -i  &quot;17a master: 172.16.102.33&quot; &#x2F;etc&#x2F;salt&#x2F;minion</span><br><span class=\"line\">sed -i  &quot;113a id: $HostName&quot; &#x2F;etc&#x2F;salt&#x2F;minion</span><br><span class=\"line\"></span><br><span class=\"line\">systemctl enable salt-minion</span><br><span class=\"line\">systemctl start salt-minion</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h3 id=\"在master上接收minion秘钥\"><a href=\"#在master上接收minion秘钥\" class=\"headerlink\" title=\"在master上接收minion秘钥\"></a>在master上接收minion秘钥</h3><p>在minion启动后连接master会请求master为其签发证书，等待证书签发完成后，master可以信任minion，并且minion和master之间的通信是加密的。</p>\n<p>在salt-master执行</p>\n<p>salt-key命令用于管理mionion秘钥</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@master ~]# salt-key -L</span><br><span class=\"line\">Accepted Keys:</span><br><span class=\"line\">Denied Keys:</span><br><span class=\"line\">Unaccepted Keys:</span><br><span class=\"line\">slave　　　　#此时已经出现slave</span><br><span class=\"line\">Rejected Keys:</span><br></pre></td></tr></table></figure>\n<p>此时slave已经出现在unaccepted keys中，说明minion已经和master联系，并且master已经获取了minion的公钥，等待下一步指令。</p>\n<h3 id=\"检查master和minion的秘钥匹配\"><a href=\"#检查master和minion的秘钥匹配\" class=\"headerlink\" title=\"检查master和minion的秘钥匹配\"></a>检查master和minion的秘钥匹配</h3><p>在master上执行</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@master ~]# salt-key -f slave</span><br><span class=\"line\">Unaccepted Keys:</span><br><span class=\"line\">slave:  0a:b9:<span class=\"number\">97</span>:b5:9a:<span class=\"number\">65</span>:b8:<span class=\"number\">49</span>:a1:<span class=\"number\">50</span>:a5:6a:<span class=\"number\">66</span>:ce:<span class=\"number\">33</span>:ea</span><br></pre></td></tr></table></figure>\n\n<p>然后可以在minion上获取minion的秘钥</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@slave ~]# salt-call --local key.finger</span><br><span class=\"line\">local:</span><br><span class=\"line\">    0a:b9:<span class=\"number\">97</span>:b5:9a:<span class=\"number\">65</span>:b8:<span class=\"number\">49</span>:a1:<span class=\"number\">50</span>:a5:6a:<span class=\"number\">66</span>:ce:<span class=\"number\">33</span>:ea</span><br></pre></td></tr></table></figure>\n\n<p>因此可确认秘钥匹配，在master上接收秘钥</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@master ~]# salt-key -a slave</span><br><span class=\"line\">The following keys are going to be accepted:</span><br><span class=\"line\">Unaccepted Keys:</span><br><span class=\"line\">slave</span><br><span class=\"line\">Proceed? [n/Y] y</span><br><span class=\"line\">Key <span class=\"keyword\">for</span> minion slave accepted.</span><br></pre></td></tr></table></figure>\n\n<p>确认接收秘钥后，检验minion秘钥是否被接收</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@master ~]# salt-key -L</span><br><span class=\"line\">Accepted Keys:</span><br><span class=\"line\">slave</span><br><span class=\"line\">Denied Keys:</span><br><span class=\"line\">Unaccepted Keys:</span><br><span class=\"line\">Rejected Keys:</span><br></pre></td></tr></table></figure>\n\n<p>秘钥接收完成后，就可以执行第一条salt啦</p>\n<h3 id=\"认证命令介绍\"><a href=\"#认证命令介绍\" class=\"headerlink\" title=\"认证命令介绍\"></a>认证命令介绍</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">salt-key –L #查看所有minion-key</span><br><span class=\"line\">salt-key –a #接受某个minion-key</span><br><span class=\"line\">salt-key –A #接受所有minion-key</span><br><span class=\"line\">salt-key –d #删除某个minion-key</span><br><span class=\"line\">salt-key –D #删除所有minion-key</span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"SaltStack-minion-匹配方式\"><a href=\"#SaltStack-minion-匹配方式\" class=\"headerlink\" title=\"SaltStack minion 匹配方式\"></a>SaltStack minion 匹配方式</h3><p>1、Glob（salt默认的target 类型，使用shell的通配符来指定一个或多个 minion ID）</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">salt \\* test.ping  或者 salt &#39;*&#39; test.ping</span><br></pre></td></tr></table></figure>\n\n<p>2、 pcre 兼容正则表达式</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">salt -E ‘^[m|M]in.[e|o|u]n$’ test.ping</span><br></pre></td></tr></table></figure>\n\n<p>3、 subnet (通过指定一个IPv4 地址或一个CIDR 的IPv4 子网)</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">salt -S 192168.0.42 test.ping</span><br><span class=\"line\">或者</span><br><span class=\"line\">salt -s 192.168.0.0&#x2F;16 test.ping</span><br></pre></td></tr></table></figure>\n\n<p>4、Grains（salt 可以通过操作系统、CPU架构及自定义信息等机器特征进行 target Minion）</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">salt -G &#39;os:Ubuntu&#39; test.ping</span><br><span class=\"line\">salt -G &#39;os_family:Debian&#39; test.ping</span><br></pre></td></tr></table></figure>\n\n<p>5、pillar (salt 支持通过 pillar 数据进行匹配)</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">salt -l &#39;my_val:my_val&#39; test.ping</span><br></pre></td></tr></table></figure>\n\n<p>6、混合（compound）</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">salt -C &#39;web* or G@os:Arch&#39; test.ping</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"salt-常用模板\"><a href=\"#salt-常用模板\" class=\"headerlink\" title=\"salt 常用模板\"></a>salt 常用模板</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">salt &#39;*&#39; status.loadavg            #系统信息</span><br><span class=\"line\">salt &#39;*&#39; status.cpuinfo            #CPU 信息</span><br><span class=\"line\">salt &quot;*&quot; status.diskstats          #查看磁盘信息</span><br><span class=\"line\">salt &quot;*&quot; status.meminfo            #查看内存信息</span><br><span class=\"line\">salt &quot;*&quot; status.w                  #w命令返回信息</span><br><span class=\"line\">salt node01  sys.list_modules      #查看所有module 列表 </span><br><span class=\"line\">salt node01  sys.list_functions cmd    查看指定 module 的所有function 方法</span><br><span class=\"line\">salt node01 sys.doc cmd.run        查看指定 module 用法</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"salt相关命令\"><a href=\"#salt相关命令\" class=\"headerlink\" title=\"salt相关命令\"></a>salt相关命令</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">salt-run manage.up \t\t\t# 查看存活的minion</span><br><span class=\"line\">salt-run manage.down \t\t# 查看死掉的minion</span><br><span class=\"line\">salt-run manage.down removekeys&#x3D;True \t\t# 查看down掉的minion，并将其删除</span><br><span class=\"line\">salt-run manage.status \t\t\t\t\t# 查看minion的相关状态</span><br><span class=\"line\">salt-run manage.versions \t\t\t\t# 查看salt的所有master和minion的版本信息</span><br><span class=\"line\">salt-run jobs.active \t\t\t\t\t# 查看哪些系统任务还在处理中</span><br><span class=\"line\">salt-run jobs.list_jobs \t\t\t\t# 显示所有的已完成或部分完成的任务信息</span><br><span class=\"line\">salt &#39;*&#39; saltutil.running \t\t\t\t# 查看运行的jobs ID</span><br><span class=\"line\">salt \\* saltutil.kill_job 20151209034239907625 # kill掉进程ID</span><br><span class=\"line\">salt -d \t\t\t\t\t# 查看帮助文档</span><br><span class=\"line\">salt -d|grep service \t\t\t\t# 查看service相关模块命令</span><br><span class=\"line\">salt &#39;*&#39; sys.doc \t\t\t\t# 查看帮助文档</span><br><span class=\"line\">salt-key -L \t\t\t\t# 查询所有接收到的证书</span><br><span class=\"line\">salt-key -a &lt;证书名&gt; \t\t\t\t# 接收单个证书</span><br><span class=\"line\">salt-key -A \t\t\t\t\t# 接受所有证书</span><br><span class=\"line\">salt-key -d &lt;证书名&gt; \t\t\t\t# 删除单个证书</span><br><span class=\"line\">salt-key -D \t\t\t\t\t\t# 删除所有证书</span><br><span class=\"line\">salt &#39;*&#39; service.get_all \t\t\t# 获取主机所有服务</span><br><span class=\"line\">salt &#39;*&#39; service.reload sshd \t\t# 重载sshd服务</span><br><span class=\"line\">salt &#39;*&#39; pkg.list_pkgs # 显示软件包版本列表</span><br><span class=\"line\">salt &#39;*&#39; pkg.version python # 显示软件包版本信息</span><br><span class=\"line\">salt &#39;*&#39; pkg.install httpd # 安装软件包</span><br><span class=\"line\">salt &#39;node1.com&#39; service.status mysql # 查看mysql服务状态</span><br><span class=\"line\">salt &#39;node1.com&#39; service.start mysql # 启动mysql服务</span><br><span class=\"line\">salt &#39;node1.com&#39; cmd.run &#39;service mysql status&#39; # 与上面一样查看服务</span><br><span class=\"line\">salt &#39;*&#39; sys.list_modules # 模块列表</span><br><span class=\"line\">salt-cp &#39;*&#39; &#x2F;etc&#x2F;hosts &#x2F;etc&#x2F;hosts # 把master上的hosts文件分发到所有主机</span><br><span class=\"line\">salt &#39;*&#39; cp.get_file salt:&#x2F;&#x2F;ceshi&#x2F;b &#x2F;tmp&#x2F;test # 把salt-master端相应的文件，分发文件到minion端</span><br><span class=\"line\">salt &#39;*&#39; cp.get_dir salt:&#x2F;&#x2F;zabbix &#x2F;tmp # 把salt-master端相应的目录，分发文件到minion端</span><br><span class=\"line\">salt &#39;*&#39; file.copy &#x2F;tmp&#x2F;zabbix.sls &#x2F;tmp&#x2F;sls # 把salt-master端对应文件拷贝到minion端相应目录下</span><br><span class=\"line\">salt &#39;*&#39; cmd.run &#39;uptime&#39; # 远程命令执行测试</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p> 远程执行脚本</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#39;cmd.script:&#39;</span><br><span class=\"line\"> salt &#39;*&#39; cmd.script salt:&#x2F;&#x2F;scripts&#x2F;runme.sh</span><br><span class=\"line\"> salt &#39;*&#39; cmd.script salt:&#x2F;&#x2F;scripts&#x2F;runme.sh &#39;arg1 arg2 &quot;arg 3&quot;&#39;</span><br><span class=\"line\"> salt &#39;*&#39; cmd.script salt:&#x2F;&#x2F;scripts&#x2F;windows_task.ps1 args&#x3D;&#39; -Input c:\\tmp\\infile.txt&#39; shell&#x3D;&#39;powershell&#39;</span><br><span class=\"line\"> salt &#39;*&#39; cmd.script salt:&#x2F;&#x2F;scripts&#x2F;runme.sh stdin&#x3D;&#39;one\\ntwo\\nthree\\nfour\\nfive\\n&#39;</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\">&#39;cmd.shell:&#39;</span><br><span class=\"line\"></span><br><span class=\"line\"> This passes the cmd argument directly to the shell</span><br><span class=\"line\"> salt &#39;*&#39; cmd.shell &quot;ls -l | awk &#39;&#x2F;foo&#x2F;&#123;print \\$2&#125;&#39;&quot;</span><br><span class=\"line\"> salt &#39;*&#39; cmd.shell template&#x3D;jinja &quot;ls -l &#x2F;tmp&#x2F;&#123;&#123;grains.id&#125;&#125; | awk &#39;&#x2F;foo&#x2F;&#123;print \\$2&#125;&#39;&quot;</span><br><span class=\"line\"> salt &#39;*&#39; cmd.shell &quot;Get-ChildItem C:\\ &quot; shell&#x3D;&#39;powershell&#39;</span><br><span class=\"line\"> salt &#39;*&#39; cmd.shell &quot;grep f&quot; stdin&#x3D;&#39;one\\ntwo\\nthree\\nfour\\nfive\\n&#39;</span><br><span class=\"line\"> salt &#39;*&#39; cmd.shell cmd&#x3D;&#39;sed -e s&#x2F;&#x3D;&#x2F;:&#x2F;g&#39;</span><br><span class=\"line\"> </span><br><span class=\"line\">&#39;cmd.shells:&#39;</span><br><span class=\"line\"> salt &#39;*&#39; cmd.shells</span><br><span class=\"line\">&#39;cmd.tty:&#39;</span><br><span class=\"line\"> salt &#39;*&#39; cmd.tty tty0 &#39;This is a test&#39;</span><br><span class=\"line\"> salt &#39;*&#39; cmd.tty pts3 &#39;This is a test&#39;</span><br><span class=\"line\"> </span><br><span class=\"line\">&#39;cmd.which:&#39;</span><br><span class=\"line\"> salt &#39;*&#39; cmd.which cat</span><br><span class=\"line\"> </span><br><span class=\"line\">**grains选项：**</span><br><span class=\"line\">salt &#39;*&#39; grains.ls # 查看grains分类</span><br><span class=\"line\">salt &#39;*&#39; grains.items # 查看grains所有信息</span><br><span class=\"line\">salt &#39;*&#39; grains.item osrelease # 查看grains某个信息</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n","site":{"data":{}},"excerpt":"","more":"<p>SaltStack 使用</p>\n<h3 id=\"SaltStack-介绍\"><a href=\"#SaltStack-介绍\" class=\"headerlink\" title=\"SaltStack 介绍\"></a>SaltStack 介绍</h3><ul>\n<li>SaltStack是一款Python开发的开源配置管理工具；</li>\n<li>可用来发现、监控、响应、协调、自动化管理本地、混合、云和IOT资产;</li>\n<li>其最主要的差异是主从模式，分为master和minions(slave)；</li>\n<li>经过配置之后master可以管理成千上万个minions；</li>\n<li>master安装的是服务端组件salt-mater，minions安装的是salt-minion；</li>\n<li>Salt使用基于ZeroMQ的强大异步网络拓扑，主要是为实现最快的通信；</li>\n<li>Salt Master运行2个网络服务，ZeroMQ PUB系统，默认运行在4505端口；ZeroMQ REP系统，用于与Salt Minion进行双向通信，默认运行在4506端口；</li>\n<li>Salt客户端(salt命令)发送的命令将通过ZeroMQ PUB/SUB广播给各个Salt Minion。前提是Salt Minion配置了Mater，并且Salt Master通过salt-key命令信任了对应的Salt Minion。建立连接之后，Salt Minion可以接收到广播命令，并且执行；</li>\n<li>PUB/SUB是单向通信，因此一旦广播结束，Master服务器上的PUB接口就不会再与Minion进行任何通信。Minion在运行命令之后，通过REP端口(4506)将命令的返回数据发回Master。</li>\n</ul>\n<h4 id=\"命令发布过程\"><a href=\"#命令发布过程\" class=\"headerlink\" title=\"命令发布过程\"></a>命令发布过程</h4><p>SaltStack 的 Master 与 Minion 之间通过 ZeroMq 进行消息传递，使用 ZeroMq 的发布订阅模式，连接方式包括 TCP 和 IPC 。</p>\n<p>Salt 命令，将 cmd.run ls  命令从 salt.client.LocalClient.cmd_cli 发布到 Master，获取一个 JobID ,根据 jobID 获取命令执行结果。</p>\n<p>Master 接收到命令后，将要执行的命令发送给客户端 minion</p>\n<p>Minion 从消息总线上接收到要处理的命令，交给 minion._handle_aes  处理。</p>\n<p>Minion  minion._handle_aes   发起一个本地线程调用 cmdmod 执行 ls 命令。线程执行完 ls 后，调用 Minion._return_pub 方法。将执行结果通过消息总线返回给master。 </p>\n<p>Master接收到客户端返回的结果，调用 master.handle_ase 方法将结果写到文件中。</p>\n<p>Salt.client.LocalClient.cmd_cli 通过轮询获取Job 执行结果，将结果输出到终端。</p>\n<h4 id=\"salt部署基本架构\"><a href=\"#salt部署基本架构\" class=\"headerlink\" title=\"salt部署基本架构\"></a>salt部署基本架构</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">stateDiagram</span><br><span class=\"line\">    [*] --&gt; Master</span><br><span class=\"line\">    Master --&gt; OS_Minion</span><br><span class=\"line\">    Master --&gt; Web01_Minion</span><br><span class=\"line\">    Master --&gt; Web02_Minion</span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"salt端口\"><a href=\"#salt端口\" class=\"headerlink\" title=\"salt端口\"></a>salt端口</h4><p>安装好salt之后开始配置，salt-master默认监听两个端口：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"number\">4505</span>   publish_port   提供远程命令发送功能</span><br><span class=\"line\"><span class=\"number\">4506</span>   ret_port       提供认证，文件服务，结果收集等功能</span><br><span class=\"line\">确保客户端可以通信服务器的此<span class=\"number\">2</span>个端口，保证防火墙允许端口通过。因此在测试环境直接关闭防火墙。</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"配置文件\"><a href=\"#配置文件\" class=\"headerlink\" title=\"配置文件\"></a>配置文件</h4><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">salt-master的配置文件是/etc/salt/master</span><br><span class=\"line\">salt-minion的配置文件是/etc/salt/minion</span><br><span class=\"line\">配置文件中包含了大量可调整的参数，这些参数控制master和minion各个方面</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"配置-salt-master\"><a href=\"#配置-salt-master\" class=\"headerlink\" title=\"配置 salt-master\"></a>配置 salt-master</h4><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@master ~]# grep -v ^# /etc/salt/master|grep -v ^$</span><br><span class=\"line\">interface: 0.0.0.0  #绑定到本地的0.0.0.0地址</span><br><span class=\"line\"></span><br><span class=\"line\">publish_port: 4505　　#管理端口，命令发送</span><br><span class=\"line\"></span><br><span class=\"line\">user: root　　　　　　#运行salt进程的用户</span><br><span class=\"line\"></span><br><span class=\"line\">worker_threads: <span class=\"number\">5</span>　　#salt运行线程数，线程越多处理速度越快，不要超过cpu个数</span><br><span class=\"line\"> </span><br><span class=\"line\">ret_port: 4506　　#执行结果返回端口</span><br><span class=\"line\"></span><br><span class=\"line\">pidfile: <span class=\"regexp\">/var/</span>run/salt-master.pid #pid文件位置</span><br><span class=\"line\"></span><br><span class=\"line\">log_file: /var/log/salt/master　　#日志文件地址</span><br><span class=\"line\"></span><br><span class=\"line\">#自动接收minion的key</span><br><span class=\"line\">auto_accept: False</span><br><span class=\"line\"></span><br><span class=\"line\"># minion的识别ID，可以是IP，域名，或是可以通过DNS解析的字符串</span><br><span class=\"line\">id: slave   # 最好使用主机名</span><br><span class=\"line\"></span><br><span class=\"line\"># salt运行的用户权限</span><br><span class=\"line\">user: root</span><br><span class=\"line\"></span><br><span class=\"line\"># master的识别ID，可以是IP，域名，或是可以通过DNS解析的字符串</span><br><span class=\"line\">master : master    #master 地址</span><br><span class=\"line\"> </span><br><span class=\"line\"># master通信端口</span><br><span class=\"line\">master_port: <span class=\"number\">4506</span></span><br><span class=\"line\"> </span><br><span class=\"line\"># 备份模式，minion是本地备份，当进行文件管理时的文件备份模式</span><br><span class=\"line\">backup_mode: minion</span><br><span class=\"line\"> </span><br><span class=\"line\"># 执行salt-call时候的输出方式</span><br><span class=\"line\">output: nested</span><br><span class=\"line\"> </span><br><span class=\"line\"># minion等待master接受认证的时间</span><br><span class=\"line\">acceptance_wait_time: <span class=\"number\">10</span></span><br><span class=\"line\"> </span><br><span class=\"line\"># 失败重连次数，0表示无限次，非零会不断尝试到设置值后停止尝试</span><br><span class=\"line\">acceptance_wait_time_max: <span class=\"number\">0</span></span><br><span class=\"line\"> </span><br><span class=\"line\"># 重新认证延迟时间，可以避免因为master的key改变导致minion需要重新认证的syn风暴</span><br><span class=\"line\">random_reauth_delay: <span class=\"number\">60</span></span><br><span class=\"line\"></span><br><span class=\"line\"># salt state执行时候的根目录</span><br><span class=\"line\">file_roots:</span><br><span class=\"line\">  base:</span><br><span class=\"line\">    - <span class=\"regexp\">/srv/</span>salt</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"配置satl-minion\"><a href=\"#配置satl-minion\" class=\"headerlink\" title=\"配置satl-minion\"></a>配置satl-minion</h4><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@slave ~]# grep -v ^# /etc/salt/minion|grep -v ^$</span><br><span class=\"line\">master: master    #master 地址</span><br><span class=\"line\">master_port: <span class=\"number\">4506</span></span><br><span class=\"line\">user: root</span><br><span class=\"line\">id: slave   # 最好使用主机名</span><br><span class=\"line\">acceptance_wait_time: <span class=\"number\">10</span></span><br><span class=\"line\">log_file: <span class=\"regexp\">/var/</span>log/salt/minion</span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"启动salt-master和salt-minion\"><a href=\"#启动salt-master和salt-minion\" class=\"headerlink\" title=\"启动salt-master和salt-minion\"></a>启动salt-master和salt-minion</h4><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl start salt-minion</span><br><span class=\"line\">systemctl start salt-master</span><br><span class=\"line\"></span><br><span class=\"line\">#检查salt状态</span><br><span class=\"line\">systemctl status salt-minion</span><br><span class=\"line\">systemctl status salt-master</span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"SaltStack-VS-Ansible\"><a href=\"#SaltStack-VS-Ansible\" class=\"headerlink\" title=\"SaltStack VS Ansible\"></a>SaltStack VS Ansible</h3><table>\n<thead>\n<tr>\n<th>SaltStack</th>\n<th>Ansible</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>SaltStack 依靠ZeroMQ速度快</td>\n<td>Ansible SSH传输速度慢一些</td>\n</tr>\n<tr>\n<td>ZeroMQ本身不加密，AES加密，需注意MITM攻击</td>\n<td>SSH安全性高</td>\n</tr>\n<tr>\n<td>Master需要守护进程</td>\n<td>无额外开支，SSH即可</td>\n</tr>\n<tr>\n<td>State语法需要学习</td>\n<td>playbook语法相对简单，容易学习</td>\n</tr>\n<tr>\n<td>excution模块+state模块，state会调用excution模块</td>\n<td>Ansible模块+playbook</td>\n</tr>\n<tr>\n<td>使用topfile <a href=\"https://docs.saltstack.com/en/latest/ref/states/top.html\">top.sls</a> 使用<a href=\"http://yaml.org/\">YAML</a></td>\n<td>playbook使用YAML</td>\n</tr>\n<tr>\n<td>围绕Master输入命令，首次连接使用加密key，使用ZeroMQ库不会拥堵，持续连接速度更快</td>\n<td>使用SSH通道，无固定Master，更安全，也有MQ版本</td>\n</tr>\n<tr>\n<td>未提及</td>\n<td>配置记录文件，原始vs生产</td>\n</tr>\n<tr>\n<td>默认本地root，客户端root</td>\n<td>支持多用户sudo操作</td>\n</tr>\n<tr>\n<td>密码容易保管，命令容易审计</td>\n<td>SSH，公钥连接</td>\n</tr>\n<tr>\n<td>配置模块化，学习成本更高</td>\n<td>克隆Ansible Git，语法简单</td>\n</tr>\n</tbody></table>\n<h3 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h3><h4 id=\"SALT-MASTER\"><a href=\"#SALT-MASTER\" class=\"headerlink\" title=\"SALT MASTER\"></a>SALT MASTER</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -L https:&#x2F;&#x2F;bootstrap.saltstack.com -o install_salt.sh</span><br><span class=\"line\">sudo sh install_salt.sh -P -M</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"SALT-MINION\"><a href=\"#SALT-MINION\" class=\"headerlink\" title=\"SALT MINION\"></a>SALT MINION</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -L https:&#x2F;&#x2F;bootstrap.saltstack.com -o install_salt.sh</span><br><span class=\"line\">sudo sh install_salt.sh -P</span><br></pre></td></tr></table></figure>\n\n<p>配置脚本</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#!&#x2F;bin&#x2F;bash</span><br><span class=\"line\"></span><br><span class=\"line\">HostName&#x3D;&#96;hostname&#96;</span><br><span class=\"line\">cp &#x2F;etc&#x2F;salt&#x2F;minion &#x2F;etc&#x2F;salt&#x2F;minion_bak</span><br><span class=\"line\">sed -i  &quot;17a master: 172.16.102.33&quot; &#x2F;etc&#x2F;salt&#x2F;minion</span><br><span class=\"line\">sed -i  &quot;113a id: $HostName&quot; &#x2F;etc&#x2F;salt&#x2F;minion</span><br><span class=\"line\"></span><br><span class=\"line\">systemctl enable salt-minion</span><br><span class=\"line\">systemctl start salt-minion</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h3 id=\"在master上接收minion秘钥\"><a href=\"#在master上接收minion秘钥\" class=\"headerlink\" title=\"在master上接收minion秘钥\"></a>在master上接收minion秘钥</h3><p>在minion启动后连接master会请求master为其签发证书，等待证书签发完成后，master可以信任minion，并且minion和master之间的通信是加密的。</p>\n<p>在salt-master执行</p>\n<p>salt-key命令用于管理mionion秘钥</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@master ~]# salt-key -L</span><br><span class=\"line\">Accepted Keys:</span><br><span class=\"line\">Denied Keys:</span><br><span class=\"line\">Unaccepted Keys:</span><br><span class=\"line\">slave　　　　#此时已经出现slave</span><br><span class=\"line\">Rejected Keys:</span><br></pre></td></tr></table></figure>\n<p>此时slave已经出现在unaccepted keys中，说明minion已经和master联系，并且master已经获取了minion的公钥，等待下一步指令。</p>\n<h3 id=\"检查master和minion的秘钥匹配\"><a href=\"#检查master和minion的秘钥匹配\" class=\"headerlink\" title=\"检查master和minion的秘钥匹配\"></a>检查master和minion的秘钥匹配</h3><p>在master上执行</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@master ~]# salt-key -f slave</span><br><span class=\"line\">Unaccepted Keys:</span><br><span class=\"line\">slave:  0a:b9:<span class=\"number\">97</span>:b5:9a:<span class=\"number\">65</span>:b8:<span class=\"number\">49</span>:a1:<span class=\"number\">50</span>:a5:6a:<span class=\"number\">66</span>:ce:<span class=\"number\">33</span>:ea</span><br></pre></td></tr></table></figure>\n\n<p>然后可以在minion上获取minion的秘钥</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@slave ~]# salt-call --local key.finger</span><br><span class=\"line\">local:</span><br><span class=\"line\">    0a:b9:<span class=\"number\">97</span>:b5:9a:<span class=\"number\">65</span>:b8:<span class=\"number\">49</span>:a1:<span class=\"number\">50</span>:a5:6a:<span class=\"number\">66</span>:ce:<span class=\"number\">33</span>:ea</span><br></pre></td></tr></table></figure>\n\n<p>因此可确认秘钥匹配，在master上接收秘钥</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@master ~]# salt-key -a slave</span><br><span class=\"line\">The following keys are going to be accepted:</span><br><span class=\"line\">Unaccepted Keys:</span><br><span class=\"line\">slave</span><br><span class=\"line\">Proceed? [n/Y] y</span><br><span class=\"line\">Key <span class=\"keyword\">for</span> minion slave accepted.</span><br></pre></td></tr></table></figure>\n\n<p>确认接收秘钥后，检验minion秘钥是否被接收</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@master ~]# salt-key -L</span><br><span class=\"line\">Accepted Keys:</span><br><span class=\"line\">slave</span><br><span class=\"line\">Denied Keys:</span><br><span class=\"line\">Unaccepted Keys:</span><br><span class=\"line\">Rejected Keys:</span><br></pre></td></tr></table></figure>\n\n<p>秘钥接收完成后，就可以执行第一条salt啦</p>\n<h3 id=\"认证命令介绍\"><a href=\"#认证命令介绍\" class=\"headerlink\" title=\"认证命令介绍\"></a>认证命令介绍</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">salt-key –L #查看所有minion-key</span><br><span class=\"line\">salt-key –a #接受某个minion-key</span><br><span class=\"line\">salt-key –A #接受所有minion-key</span><br><span class=\"line\">salt-key –d #删除某个minion-key</span><br><span class=\"line\">salt-key –D #删除所有minion-key</span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"SaltStack-minion-匹配方式\"><a href=\"#SaltStack-minion-匹配方式\" class=\"headerlink\" title=\"SaltStack minion 匹配方式\"></a>SaltStack minion 匹配方式</h3><p>1、Glob（salt默认的target 类型，使用shell的通配符来指定一个或多个 minion ID）</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">salt \\* test.ping  或者 salt &#39;*&#39; test.ping</span><br></pre></td></tr></table></figure>\n\n<p>2、 pcre 兼容正则表达式</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">salt -E ‘^[m|M]in.[e|o|u]n$’ test.ping</span><br></pre></td></tr></table></figure>\n\n<p>3、 subnet (通过指定一个IPv4 地址或一个CIDR 的IPv4 子网)</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">salt -S 192168.0.42 test.ping</span><br><span class=\"line\">或者</span><br><span class=\"line\">salt -s 192.168.0.0&#x2F;16 test.ping</span><br></pre></td></tr></table></figure>\n\n<p>4、Grains（salt 可以通过操作系统、CPU架构及自定义信息等机器特征进行 target Minion）</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">salt -G &#39;os:Ubuntu&#39; test.ping</span><br><span class=\"line\">salt -G &#39;os_family:Debian&#39; test.ping</span><br></pre></td></tr></table></figure>\n\n<p>5、pillar (salt 支持通过 pillar 数据进行匹配)</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">salt -l &#39;my_val:my_val&#39; test.ping</span><br></pre></td></tr></table></figure>\n\n<p>6、混合（compound）</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">salt -C &#39;web* or G@os:Arch&#39; test.ping</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"salt-常用模板\"><a href=\"#salt-常用模板\" class=\"headerlink\" title=\"salt 常用模板\"></a>salt 常用模板</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">salt &#39;*&#39; status.loadavg            #系统信息</span><br><span class=\"line\">salt &#39;*&#39; status.cpuinfo            #CPU 信息</span><br><span class=\"line\">salt &quot;*&quot; status.diskstats          #查看磁盘信息</span><br><span class=\"line\">salt &quot;*&quot; status.meminfo            #查看内存信息</span><br><span class=\"line\">salt &quot;*&quot; status.w                  #w命令返回信息</span><br><span class=\"line\">salt node01  sys.list_modules      #查看所有module 列表 </span><br><span class=\"line\">salt node01  sys.list_functions cmd    查看指定 module 的所有function 方法</span><br><span class=\"line\">salt node01 sys.doc cmd.run        查看指定 module 用法</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"salt相关命令\"><a href=\"#salt相关命令\" class=\"headerlink\" title=\"salt相关命令\"></a>salt相关命令</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">salt-run manage.up \t\t\t# 查看存活的minion</span><br><span class=\"line\">salt-run manage.down \t\t# 查看死掉的minion</span><br><span class=\"line\">salt-run manage.down removekeys&#x3D;True \t\t# 查看down掉的minion，并将其删除</span><br><span class=\"line\">salt-run manage.status \t\t\t\t\t# 查看minion的相关状态</span><br><span class=\"line\">salt-run manage.versions \t\t\t\t# 查看salt的所有master和minion的版本信息</span><br><span class=\"line\">salt-run jobs.active \t\t\t\t\t# 查看哪些系统任务还在处理中</span><br><span class=\"line\">salt-run jobs.list_jobs \t\t\t\t# 显示所有的已完成或部分完成的任务信息</span><br><span class=\"line\">salt &#39;*&#39; saltutil.running \t\t\t\t# 查看运行的jobs ID</span><br><span class=\"line\">salt \\* saltutil.kill_job 20151209034239907625 # kill掉进程ID</span><br><span class=\"line\">salt -d \t\t\t\t\t# 查看帮助文档</span><br><span class=\"line\">salt -d|grep service \t\t\t\t# 查看service相关模块命令</span><br><span class=\"line\">salt &#39;*&#39; sys.doc \t\t\t\t# 查看帮助文档</span><br><span class=\"line\">salt-key -L \t\t\t\t# 查询所有接收到的证书</span><br><span class=\"line\">salt-key -a &lt;证书名&gt; \t\t\t\t# 接收单个证书</span><br><span class=\"line\">salt-key -A \t\t\t\t\t# 接受所有证书</span><br><span class=\"line\">salt-key -d &lt;证书名&gt; \t\t\t\t# 删除单个证书</span><br><span class=\"line\">salt-key -D \t\t\t\t\t\t# 删除所有证书</span><br><span class=\"line\">salt &#39;*&#39; service.get_all \t\t\t# 获取主机所有服务</span><br><span class=\"line\">salt &#39;*&#39; service.reload sshd \t\t# 重载sshd服务</span><br><span class=\"line\">salt &#39;*&#39; pkg.list_pkgs # 显示软件包版本列表</span><br><span class=\"line\">salt &#39;*&#39; pkg.version python # 显示软件包版本信息</span><br><span class=\"line\">salt &#39;*&#39; pkg.install httpd # 安装软件包</span><br><span class=\"line\">salt &#39;node1.com&#39; service.status mysql # 查看mysql服务状态</span><br><span class=\"line\">salt &#39;node1.com&#39; service.start mysql # 启动mysql服务</span><br><span class=\"line\">salt &#39;node1.com&#39; cmd.run &#39;service mysql status&#39; # 与上面一样查看服务</span><br><span class=\"line\">salt &#39;*&#39; sys.list_modules # 模块列表</span><br><span class=\"line\">salt-cp &#39;*&#39; &#x2F;etc&#x2F;hosts &#x2F;etc&#x2F;hosts # 把master上的hosts文件分发到所有主机</span><br><span class=\"line\">salt &#39;*&#39; cp.get_file salt:&#x2F;&#x2F;ceshi&#x2F;b &#x2F;tmp&#x2F;test # 把salt-master端相应的文件，分发文件到minion端</span><br><span class=\"line\">salt &#39;*&#39; cp.get_dir salt:&#x2F;&#x2F;zabbix &#x2F;tmp # 把salt-master端相应的目录，分发文件到minion端</span><br><span class=\"line\">salt &#39;*&#39; file.copy &#x2F;tmp&#x2F;zabbix.sls &#x2F;tmp&#x2F;sls # 把salt-master端对应文件拷贝到minion端相应目录下</span><br><span class=\"line\">salt &#39;*&#39; cmd.run &#39;uptime&#39; # 远程命令执行测试</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p> 远程执行脚本</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#39;cmd.script:&#39;</span><br><span class=\"line\"> salt &#39;*&#39; cmd.script salt:&#x2F;&#x2F;scripts&#x2F;runme.sh</span><br><span class=\"line\"> salt &#39;*&#39; cmd.script salt:&#x2F;&#x2F;scripts&#x2F;runme.sh &#39;arg1 arg2 &quot;arg 3&quot;&#39;</span><br><span class=\"line\"> salt &#39;*&#39; cmd.script salt:&#x2F;&#x2F;scripts&#x2F;windows_task.ps1 args&#x3D;&#39; -Input c:\\tmp\\infile.txt&#39; shell&#x3D;&#39;powershell&#39;</span><br><span class=\"line\"> salt &#39;*&#39; cmd.script salt:&#x2F;&#x2F;scripts&#x2F;runme.sh stdin&#x3D;&#39;one\\ntwo\\nthree\\nfour\\nfive\\n&#39;</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\">&#39;cmd.shell:&#39;</span><br><span class=\"line\"></span><br><span class=\"line\"> This passes the cmd argument directly to the shell</span><br><span class=\"line\"> salt &#39;*&#39; cmd.shell &quot;ls -l | awk &#39;&#x2F;foo&#x2F;&#123;print \\$2&#125;&#39;&quot;</span><br><span class=\"line\"> salt &#39;*&#39; cmd.shell template&#x3D;jinja &quot;ls -l &#x2F;tmp&#x2F;&#123;&#123;grains.id&#125;&#125; | awk &#39;&#x2F;foo&#x2F;&#123;print \\$2&#125;&#39;&quot;</span><br><span class=\"line\"> salt &#39;*&#39; cmd.shell &quot;Get-ChildItem C:\\ &quot; shell&#x3D;&#39;powershell&#39;</span><br><span class=\"line\"> salt &#39;*&#39; cmd.shell &quot;grep f&quot; stdin&#x3D;&#39;one\\ntwo\\nthree\\nfour\\nfive\\n&#39;</span><br><span class=\"line\"> salt &#39;*&#39; cmd.shell cmd&#x3D;&#39;sed -e s&#x2F;&#x3D;&#x2F;:&#x2F;g&#39;</span><br><span class=\"line\"> </span><br><span class=\"line\">&#39;cmd.shells:&#39;</span><br><span class=\"line\"> salt &#39;*&#39; cmd.shells</span><br><span class=\"line\">&#39;cmd.tty:&#39;</span><br><span class=\"line\"> salt &#39;*&#39; cmd.tty tty0 &#39;This is a test&#39;</span><br><span class=\"line\"> salt &#39;*&#39; cmd.tty pts3 &#39;This is a test&#39;</span><br><span class=\"line\"> </span><br><span class=\"line\">&#39;cmd.which:&#39;</span><br><span class=\"line\"> salt &#39;*&#39; cmd.which cat</span><br><span class=\"line\"> </span><br><span class=\"line\">**grains选项：**</span><br><span class=\"line\">salt &#39;*&#39; grains.ls # 查看grains分类</span><br><span class=\"line\">salt &#39;*&#39; grains.items # 查看grains所有信息</span><br><span class=\"line\">salt &#39;*&#39; grains.item osrelease # 查看grains某个信息</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n"},{"title":"vue 项目初始化","date":"2021-09-23T02:17:00.000Z","_content":"\t\n\t\n摘要: vue3.0 项目初始化\n<!-- more -->\n\n\n## 前置环境\n已安装nodejs \n\n## 准备\n### 安装 vite-app\n```\nnpm i -g create-vite-app\n\n或者\n\nyarn global add create-vite-app\n```\n\n## 项目初始化\n### 新建项目\n```\ncva <project-name>\n或\ncreate-vite-app <project-name>\n或\nnpm init vite-app <project-name>\n或\nyarn create vite-app <project-name>\n```\n### 进入项目，安装依赖\n```\ncd <project-name>\n\nyarn\n# 或 \nnpm i\n```\n### 运行项目\n```\nyarn dev \n或\nyarn run serve\n或\nnpm run serve\n\n```\n\n## 引入TypeScript\n### 加入 ts 依赖\n```\nyarn add --dev typescript\n```\n在 项目根目录下创建 TypeScript 的配置文件 tsconfig.json\n```\n{\n  \"compilerOptions\": {\n    // 允许从没有设置默认导出的模块中默认导入。这并不影响代码的输出，仅为了类型检查。\n    \"allowSyntheticDefaultImports\": true,\n    \n    // 解析非相对模块名的基准目录\n    \"baseUrl\": \".\",\n\n    \"esModuleInterop\": true,\n\n    // 从 tslib 导入辅助工具函数（比如 __extends， __rest等）\n    \"importHelpers\": true,\n\n    // 指定生成哪个模块系统代码\n    \"module\": \"esnext\",\n\n    // 决定如何处理模块。\n    \"moduleResolution\": \"node\",\n\n    // 启用所有严格类型检查选项。\n    // 启用 --strict相当于启用 --noImplicitAny, --noImplicitThis, --alwaysStrict， \n    // --strictNullChecks和 --strictFunctionTypes和--strictPropertyInitialization。\n    \"strict\": true,\n\n    // 生成相应的 .map文件。\n    \"sourceMap\": true,\n\n    // 忽略所有的声明文件（ *.d.ts）的类型检查。\n    \"skipLibCheck\": true,\n\n    // 指定ECMAScript目标版本 \n    \"target\": \"esnext\",\n    \n    // 要包含的类型声明文件名列表\n    \"types\": [\n\n    ],\n\n    \"isolatedModules\": true,\n\n    // 模块名到基于 baseUrl的路径映射的列表。\n    \"paths\": {\n      \"@/*\": [\n        \"src/*\"\n      ]\n    },\n    // 编译过程中需要引入的库文件的列表。\n    \"lib\": [\n      \"ESNext\",\n      \"DOM\",\n      \"DOM.Iterable\",\n      \"ScriptHost\"\n    ]\n  },\n  \"include\": [\n    \"src/**/*.ts\",\n    \"src/**/*.tsx\",\n    \"src/**/*.vue\",\n    \"tests/**/*.ts\",\n    \"tests/**/*.tsx\"\n  ],\n  \"exclude\": [\n    \"node_modules\"\n  ]\n}\n```\n在 src 目录下新加 shim.d.ts 文件\n```\n/* eslint-disable */\nimport type { DefineComponent } from 'vue'\n\ndeclare module '*.vue' {\n  const component: DefineComponent<{}, {}, any>\n  export default component\n}\n```\n把 main.js 修改成 main.ts\n\n\n在根目录，打开 Index.html\n```\n<script type=\"module\" src=\"/src/main.js\"></script>\n修改为：\n<script type=\"module\" src=\"/src/main.ts\"></script>\n```\n\n\n## 引入 eslint\n安装 eslint prettier 依赖\n\n`@typescript-eslint/parser @typescr ipt-eslint/eslint-plugin` 为 eslint 对 typescript 支持。\n\n```\nyarn add --dev eslint prettier eslint-config-prettier eslint-plugin-prettier eslint-plugin-vue @typescript-eslint/parser @typescript-eslint/eslint-plugin\n```\n在根目录下建立 eslint 配置文件：.eslintrc.js\n```\nmodule.exports = {\n  parser: 'vue-eslint-parser',\n  parserOptions: {\n    parser: '@typescript-eslint/parser',\n    ecmaVersion: 2020,\n    sourceType: 'module',\n    ecmaFeatures: {\n      jsx: true\n    }\n  },\n  extends: [\n    'plugin:vue/vue3-recommended',\n    'plugin:@typescript-eslint/recommended',\n    'prettier/@typescript-eslint',\n    'plugin:prettier/recommended'\n  ],\n  rules: {\n    '@typescript-eslint/ban-ts-ignore': 'off',\n    '@typescript-eslint/explicit-function-return-type': 'off',\n    '@typescript-eslint/no-explicit-any': 'off',\n    '@typescript-eslint/no-var-requires': 'off',\n    '@typescript-eslint/no-empty-function': 'off',\n    'vue/custom-event-name-casing': 'off',\n    'no-use-before-define': 'off',\n    // 'no-use-before-define': [\n    //   'error',\n    //   {\n    //     functions: false,\n    //     classes: true,\n    //   },\n    // ],\n    '@typescript-eslint/no-use-before-define': 'off',\n    // '@typescript-eslint/no-use-before-define': [\n    //   'error',\n    //   {\n    //     functions: false,\n    //     classes: true,\n    //   },\n    // ],\n    '@typescript-eslint/ban-ts-comment': 'off',\n    '@typescript-eslint/ban-types': 'off',\n    '@typescript-eslint/no-non-null-assertion': 'off',\n    '@typescript-eslint/explicit-module-boundary-types': 'off',\n    '@typescript-eslint/no-unused-vars': [\n      'error',\n      {\n        argsIgnorePattern: '^h$',\n        varsIgnorePattern: '^h$'\n      }\n    ],\n    'no-unused-vars': [\n      'error',\n      {\n        argsIgnorePattern: '^h$',\n        varsIgnorePattern: '^h$'\n      }\n    ],\n    'space-before-function-paren': 'off',\n    quotes: ['error', 'single'],\n    'comma-dangle': ['error', 'never']\n  }\n};\n```\n建立 prettier.config.js\n```\nmodule.exports = {\n  printWidth: 100,\n  tabWidth: 2,\n  useTabs: false,\n  semi: false, // 未尾逗号\n  vueIndentScriptAndStyle: true,\n  singleQuote: true, // 单引号\n  quoteProps: 'as-needed',\n  bracketSpacing: true,\n  trailingComma: 'none', // 未尾分号\n  jsxBracketSameLine: false,\n  jsxSingleQuote: false,\n  arrowParens: 'always',\n  insertPragma: false,\n  requirePragma: false,\n  proseWrap: 'never',\n  htmlWhitespaceSensitivity: 'strict',\n  endOfLine: 'lf'\n}\n```\n\n## 引入 vue-router、vuex\n```\nyarn add vue-router@next vuex@next\n```\n\n### vuex\n\n在根目录下创建 store/index.ts\n```\nimport { InjectionKey } from 'vue'\nimport { createStore, Store } from 'vuex'\n\nexport interface State {\n  count: number\n}\n\nexport const key: InjectionKey<Store<State>> = Symbol()\n\nexport const store = createStore<State>({\n  state() {\n    return {\n      count: 0\n    }\n  },\n  mutations: {\n    increment(state) {\n      state.count++\n    }\n  }\n})\n```\n\nmain.ts 修改\n```\nimport { createApp } from 'vue'\nimport { store, key } from './store'\nimport App from './App'\nimport './index.css'\n\nconst app = createApp(App)\n\napp.use(store, key)\n\napp.mount('#app')\n```\n\ncomponents/HelloWord.vue 修改\n\n```\n<template>\n  <h1>{{ msg }}</h1>\n  <button @click=\"inCrement\"> count is: </button>\n  <p>{{ count }}</p>\n</template>\n\n<script>\n  import { defineComponent, computed } from 'vue'\n  import { useStore } from 'vuex'\n  import { key } from '../store'\n\n  export default defineComponent({\n    name: 'HelloWorld',\n    props: {\n      msg: {\n        type: String,\n        default: ''\n      }\n    },\n    setup() {\n      const store = useStore(key)\n\n      const count = computed(() => store.state.count)\n\n      return {\n        count,\n        inCrement: () => store.commit('increment')\n      }\n    }\n  })\n</script>\n```\n\n### vue-router\n\n在 src 目录下建立 router/index.ts，内容如下：\n```\nimport { createRouter, createWebHistory, RouteRecordRaw } from \"vue-router\";\nimport HelloWorld from \"../components/HelloWorld.vue\";\n\nconst routes: Array<RouteRecordRaw> = [\n    {\n        path: \"/\",\n        name: \"HelloWorld\",\n        component: HelloWorld,\n    },\n    {\n        path: \"/about\",\n        name: \"About\",\n        // route level code-splitting\n        // this generates a separate chunk (about.[hash].js) for this route\n        // which is lazy-loaded when the route is visited.\n        component: () =>\n            import(/* webpackChunkName: \"About\" */ \"../components/About.vue\")\n    }\n];\n\nconst router = createRouter({\n    history: createWebHistory(process.env.BASE_URL),\n    routes,\n});\n\nexport default router;\n```\n\n再新建一个 components/About.vue 文件，内容如下：\n```\n<template>\n  <img\n    alt=\"Vue logo\"\n    src=\"../assets/logo.png\"\n  />\n  <h1>{{ msg }}</h1>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent } from 'vue'\n\nexport default defineComponent({\n  name: 'About',\n  data() {\n    return {\n      msg: 'Hello Vue 3.0 + Vite!'\n    }\n  },\n  setup() {}\n})\n</script>\n```\n\n再修改 main.ts\n```\nimport { createApp } from 'vue'\nimport { store, key } from './store'\nimport router from \"./router\";\nimport App from './App'\nimport './index.css'\n\nconst app = createApp(App)\n\napp.use(store, key)\napp.use(router)\napp.mount('#app')\n```\n\n添加 src/vue-app-env.d.ts\n```\ndeclare module '*.vue' {\n  import { Component } from 'vue'\n  const mod: Component\n  export default mod\n}\n```\n\n### 启动，访问  http://localhost:3000/\n\n\n##  加入 Element Plus\n\n### 全局安装 Element Plus\n```\nnpm install element-plus --save\n```\n\n### 完整引入\n\n在 main.js 中写入以下内容：\n```\n\nimport { createApp } from 'vue'\nimport ElementPlus from 'element-plus';\nimport router from \"./router\";\nimport 'element-plus/lib/theme-chalk/index.css';\nimport App from './App.vue';\nimport './index.css'\n \nconst app = createApp(App)\napp.use(ElementPlus)\napp.use(router)\napp.mount('#app')\n```\n\n\n### 按需引入\n\n借助 babel-plugin-component，我们可以只引入需要的组件，以达到减小项目体积的目的。\n\n首先，安装 babel-plugin-component：\n```\nnpm install babel-plugin-component -D\n```\n\n然后，将 .babelrc 修改为：\n```\n{\n  \"plugins\": [\n    [\n      \"component\",\n      {\n        \"libraryName\": \"element-plus\",\n        \"styleLibraryName\": \"theme-chalk\"\n      }\n    ]\n  ]\n}\n```\n\n接下来，如果你只希望引入部分组件，比如 Button 和 Select，那么需要在 main.js 中写入以下内容：\n```\nimport { createApp } from 'vue'\nimport { store, key } from './store';\nimport router from \"./router\";\nimport { ElButton, ElSelect } from 'element-plus';\nimport App from './App.vue';\nimport './index.css'\n \nconst app = createApp(App)\napp.component(ElButton.name, ElButton);\napp.component(ElSelect.name, ElSelect);\n \n/* or\n * app.use(ElButton)\n * app.use(ElSelect)\n */\n \napp.use(store, key)\napp.use(router)\napp.mount('#app')\napp.mount('#app')\n```","source":"_posts/vue/vue01.md","raw":"---\ntitle: vue 项目初始化\ndate: 2021-09-23 10:17\ncategories:\n- vue\ntags:\n- vue\n---\n\t\n\t\n摘要: vue3.0 项目初始化\n<!-- more -->\n\n\n## 前置环境\n已安装nodejs \n\n## 准备\n### 安装 vite-app\n```\nnpm i -g create-vite-app\n\n或者\n\nyarn global add create-vite-app\n```\n\n## 项目初始化\n### 新建项目\n```\ncva <project-name>\n或\ncreate-vite-app <project-name>\n或\nnpm init vite-app <project-name>\n或\nyarn create vite-app <project-name>\n```\n### 进入项目，安装依赖\n```\ncd <project-name>\n\nyarn\n# 或 \nnpm i\n```\n### 运行项目\n```\nyarn dev \n或\nyarn run serve\n或\nnpm run serve\n\n```\n\n## 引入TypeScript\n### 加入 ts 依赖\n```\nyarn add --dev typescript\n```\n在 项目根目录下创建 TypeScript 的配置文件 tsconfig.json\n```\n{\n  \"compilerOptions\": {\n    // 允许从没有设置默认导出的模块中默认导入。这并不影响代码的输出，仅为了类型检查。\n    \"allowSyntheticDefaultImports\": true,\n    \n    // 解析非相对模块名的基准目录\n    \"baseUrl\": \".\",\n\n    \"esModuleInterop\": true,\n\n    // 从 tslib 导入辅助工具函数（比如 __extends， __rest等）\n    \"importHelpers\": true,\n\n    // 指定生成哪个模块系统代码\n    \"module\": \"esnext\",\n\n    // 决定如何处理模块。\n    \"moduleResolution\": \"node\",\n\n    // 启用所有严格类型检查选项。\n    // 启用 --strict相当于启用 --noImplicitAny, --noImplicitThis, --alwaysStrict， \n    // --strictNullChecks和 --strictFunctionTypes和--strictPropertyInitialization。\n    \"strict\": true,\n\n    // 生成相应的 .map文件。\n    \"sourceMap\": true,\n\n    // 忽略所有的声明文件（ *.d.ts）的类型检查。\n    \"skipLibCheck\": true,\n\n    // 指定ECMAScript目标版本 \n    \"target\": \"esnext\",\n    \n    // 要包含的类型声明文件名列表\n    \"types\": [\n\n    ],\n\n    \"isolatedModules\": true,\n\n    // 模块名到基于 baseUrl的路径映射的列表。\n    \"paths\": {\n      \"@/*\": [\n        \"src/*\"\n      ]\n    },\n    // 编译过程中需要引入的库文件的列表。\n    \"lib\": [\n      \"ESNext\",\n      \"DOM\",\n      \"DOM.Iterable\",\n      \"ScriptHost\"\n    ]\n  },\n  \"include\": [\n    \"src/**/*.ts\",\n    \"src/**/*.tsx\",\n    \"src/**/*.vue\",\n    \"tests/**/*.ts\",\n    \"tests/**/*.tsx\"\n  ],\n  \"exclude\": [\n    \"node_modules\"\n  ]\n}\n```\n在 src 目录下新加 shim.d.ts 文件\n```\n/* eslint-disable */\nimport type { DefineComponent } from 'vue'\n\ndeclare module '*.vue' {\n  const component: DefineComponent<{}, {}, any>\n  export default component\n}\n```\n把 main.js 修改成 main.ts\n\n\n在根目录，打开 Index.html\n```\n<script type=\"module\" src=\"/src/main.js\"></script>\n修改为：\n<script type=\"module\" src=\"/src/main.ts\"></script>\n```\n\n\n## 引入 eslint\n安装 eslint prettier 依赖\n\n`@typescript-eslint/parser @typescr ipt-eslint/eslint-plugin` 为 eslint 对 typescript 支持。\n\n```\nyarn add --dev eslint prettier eslint-config-prettier eslint-plugin-prettier eslint-plugin-vue @typescript-eslint/parser @typescript-eslint/eslint-plugin\n```\n在根目录下建立 eslint 配置文件：.eslintrc.js\n```\nmodule.exports = {\n  parser: 'vue-eslint-parser',\n  parserOptions: {\n    parser: '@typescript-eslint/parser',\n    ecmaVersion: 2020,\n    sourceType: 'module',\n    ecmaFeatures: {\n      jsx: true\n    }\n  },\n  extends: [\n    'plugin:vue/vue3-recommended',\n    'plugin:@typescript-eslint/recommended',\n    'prettier/@typescript-eslint',\n    'plugin:prettier/recommended'\n  ],\n  rules: {\n    '@typescript-eslint/ban-ts-ignore': 'off',\n    '@typescript-eslint/explicit-function-return-type': 'off',\n    '@typescript-eslint/no-explicit-any': 'off',\n    '@typescript-eslint/no-var-requires': 'off',\n    '@typescript-eslint/no-empty-function': 'off',\n    'vue/custom-event-name-casing': 'off',\n    'no-use-before-define': 'off',\n    // 'no-use-before-define': [\n    //   'error',\n    //   {\n    //     functions: false,\n    //     classes: true,\n    //   },\n    // ],\n    '@typescript-eslint/no-use-before-define': 'off',\n    // '@typescript-eslint/no-use-before-define': [\n    //   'error',\n    //   {\n    //     functions: false,\n    //     classes: true,\n    //   },\n    // ],\n    '@typescript-eslint/ban-ts-comment': 'off',\n    '@typescript-eslint/ban-types': 'off',\n    '@typescript-eslint/no-non-null-assertion': 'off',\n    '@typescript-eslint/explicit-module-boundary-types': 'off',\n    '@typescript-eslint/no-unused-vars': [\n      'error',\n      {\n        argsIgnorePattern: '^h$',\n        varsIgnorePattern: '^h$'\n      }\n    ],\n    'no-unused-vars': [\n      'error',\n      {\n        argsIgnorePattern: '^h$',\n        varsIgnorePattern: '^h$'\n      }\n    ],\n    'space-before-function-paren': 'off',\n    quotes: ['error', 'single'],\n    'comma-dangle': ['error', 'never']\n  }\n};\n```\n建立 prettier.config.js\n```\nmodule.exports = {\n  printWidth: 100,\n  tabWidth: 2,\n  useTabs: false,\n  semi: false, // 未尾逗号\n  vueIndentScriptAndStyle: true,\n  singleQuote: true, // 单引号\n  quoteProps: 'as-needed',\n  bracketSpacing: true,\n  trailingComma: 'none', // 未尾分号\n  jsxBracketSameLine: false,\n  jsxSingleQuote: false,\n  arrowParens: 'always',\n  insertPragma: false,\n  requirePragma: false,\n  proseWrap: 'never',\n  htmlWhitespaceSensitivity: 'strict',\n  endOfLine: 'lf'\n}\n```\n\n## 引入 vue-router、vuex\n```\nyarn add vue-router@next vuex@next\n```\n\n### vuex\n\n在根目录下创建 store/index.ts\n```\nimport { InjectionKey } from 'vue'\nimport { createStore, Store } from 'vuex'\n\nexport interface State {\n  count: number\n}\n\nexport const key: InjectionKey<Store<State>> = Symbol()\n\nexport const store = createStore<State>({\n  state() {\n    return {\n      count: 0\n    }\n  },\n  mutations: {\n    increment(state) {\n      state.count++\n    }\n  }\n})\n```\n\nmain.ts 修改\n```\nimport { createApp } from 'vue'\nimport { store, key } from './store'\nimport App from './App'\nimport './index.css'\n\nconst app = createApp(App)\n\napp.use(store, key)\n\napp.mount('#app')\n```\n\ncomponents/HelloWord.vue 修改\n\n```\n<template>\n  <h1>{{ msg }}</h1>\n  <button @click=\"inCrement\"> count is: </button>\n  <p>{{ count }}</p>\n</template>\n\n<script>\n  import { defineComponent, computed } from 'vue'\n  import { useStore } from 'vuex'\n  import { key } from '../store'\n\n  export default defineComponent({\n    name: 'HelloWorld',\n    props: {\n      msg: {\n        type: String,\n        default: ''\n      }\n    },\n    setup() {\n      const store = useStore(key)\n\n      const count = computed(() => store.state.count)\n\n      return {\n        count,\n        inCrement: () => store.commit('increment')\n      }\n    }\n  })\n</script>\n```\n\n### vue-router\n\n在 src 目录下建立 router/index.ts，内容如下：\n```\nimport { createRouter, createWebHistory, RouteRecordRaw } from \"vue-router\";\nimport HelloWorld from \"../components/HelloWorld.vue\";\n\nconst routes: Array<RouteRecordRaw> = [\n    {\n        path: \"/\",\n        name: \"HelloWorld\",\n        component: HelloWorld,\n    },\n    {\n        path: \"/about\",\n        name: \"About\",\n        // route level code-splitting\n        // this generates a separate chunk (about.[hash].js) for this route\n        // which is lazy-loaded when the route is visited.\n        component: () =>\n            import(/* webpackChunkName: \"About\" */ \"../components/About.vue\")\n    }\n];\n\nconst router = createRouter({\n    history: createWebHistory(process.env.BASE_URL),\n    routes,\n});\n\nexport default router;\n```\n\n再新建一个 components/About.vue 文件，内容如下：\n```\n<template>\n  <img\n    alt=\"Vue logo\"\n    src=\"../assets/logo.png\"\n  />\n  <h1>{{ msg }}</h1>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent } from 'vue'\n\nexport default defineComponent({\n  name: 'About',\n  data() {\n    return {\n      msg: 'Hello Vue 3.0 + Vite!'\n    }\n  },\n  setup() {}\n})\n</script>\n```\n\n再修改 main.ts\n```\nimport { createApp } from 'vue'\nimport { store, key } from './store'\nimport router from \"./router\";\nimport App from './App'\nimport './index.css'\n\nconst app = createApp(App)\n\napp.use(store, key)\napp.use(router)\napp.mount('#app')\n```\n\n添加 src/vue-app-env.d.ts\n```\ndeclare module '*.vue' {\n  import { Component } from 'vue'\n  const mod: Component\n  export default mod\n}\n```\n\n### 启动，访问  http://localhost:3000/\n\n\n##  加入 Element Plus\n\n### 全局安装 Element Plus\n```\nnpm install element-plus --save\n```\n\n### 完整引入\n\n在 main.js 中写入以下内容：\n```\n\nimport { createApp } from 'vue'\nimport ElementPlus from 'element-plus';\nimport router from \"./router\";\nimport 'element-plus/lib/theme-chalk/index.css';\nimport App from './App.vue';\nimport './index.css'\n \nconst app = createApp(App)\napp.use(ElementPlus)\napp.use(router)\napp.mount('#app')\n```\n\n\n### 按需引入\n\n借助 babel-plugin-component，我们可以只引入需要的组件，以达到减小项目体积的目的。\n\n首先，安装 babel-plugin-component：\n```\nnpm install babel-plugin-component -D\n```\n\n然后，将 .babelrc 修改为：\n```\n{\n  \"plugins\": [\n    [\n      \"component\",\n      {\n        \"libraryName\": \"element-plus\",\n        \"styleLibraryName\": \"theme-chalk\"\n      }\n    ]\n  ]\n}\n```\n\n接下来，如果你只希望引入部分组件，比如 Button 和 Select，那么需要在 main.js 中写入以下内容：\n```\nimport { createApp } from 'vue'\nimport { store, key } from './store';\nimport router from \"./router\";\nimport { ElButton, ElSelect } from 'element-plus';\nimport App from './App.vue';\nimport './index.css'\n \nconst app = createApp(App)\napp.component(ElButton.name, ElButton);\napp.component(ElSelect.name, ElSelect);\n \n/* or\n * app.use(ElButton)\n * app.use(ElSelect)\n */\n \napp.use(store, key)\napp.use(router)\napp.mount('#app')\napp.mount('#app')\n```","slug":"vue/vue01","published":1,"updated":"2021-09-23T07:32:45.494Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cku697a2c00bm00uhgraldt8s","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><p>摘要: vue3.0 项目初始化</p>\n<span id=\"more\"></span>\n\n\n<h2 id=\"前置环境\"><a href=\"#前置环境\" class=\"headerlink\" title=\"前置环境\"></a>前置环境</h2><p>已安装nodejs </p>\n<h2 id=\"准备\"><a href=\"#准备\" class=\"headerlink\" title=\"准备\"></a>准备</h2><h3 id=\"安装-vite-app\"><a href=\"#安装-vite-app\" class=\"headerlink\" title=\"安装 vite-app\"></a>安装 vite-app</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm i -g create-vite-app</span><br><span class=\"line\"></span><br><span class=\"line\">或者</span><br><span class=\"line\"></span><br><span class=\"line\">yarn global add create-vite-app</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"项目初始化\"><a href=\"#项目初始化\" class=\"headerlink\" title=\"项目初始化\"></a>项目初始化</h2><h3 id=\"新建项目\"><a href=\"#新建项目\" class=\"headerlink\" title=\"新建项目\"></a>新建项目</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cva &lt;project-name&gt;</span><br><span class=\"line\">或</span><br><span class=\"line\">create-vite-app &lt;project-name&gt;</span><br><span class=\"line\">或</span><br><span class=\"line\">npm init vite-app &lt;project-name&gt;</span><br><span class=\"line\">或</span><br><span class=\"line\">yarn create vite-app &lt;project-name&gt;</span><br></pre></td></tr></table></figure>\n<h3 id=\"进入项目，安装依赖\"><a href=\"#进入项目，安装依赖\" class=\"headerlink\" title=\"进入项目，安装依赖\"></a>进入项目，安装依赖</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd &lt;project-name&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">yarn</span><br><span class=\"line\"># 或 </span><br><span class=\"line\">npm i</span><br></pre></td></tr></table></figure>\n<h3 id=\"运行项目\"><a href=\"#运行项目\" class=\"headerlink\" title=\"运行项目\"></a>运行项目</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yarn dev </span><br><span class=\"line\">或</span><br><span class=\"line\">yarn run serve</span><br><span class=\"line\">或</span><br><span class=\"line\">npm run serve</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"引入TypeScript\"><a href=\"#引入TypeScript\" class=\"headerlink\" title=\"引入TypeScript\"></a>引入TypeScript</h2><h3 id=\"加入-ts-依赖\"><a href=\"#加入-ts-依赖\" class=\"headerlink\" title=\"加入 ts 依赖\"></a>加入 ts 依赖</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yarn add --dev typescript</span><br></pre></td></tr></table></figure>\n<p>在 项目根目录下创建 TypeScript 的配置文件 tsconfig.json</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  &quot;compilerOptions&quot;: &#123;</span><br><span class=\"line\">    &#x2F;&#x2F; 允许从没有设置默认导出的模块中默认导入。这并不影响代码的输出，仅为了类型检查。</span><br><span class=\"line\">    &quot;allowSyntheticDefaultImports&quot;: true,</span><br><span class=\"line\">    </span><br><span class=\"line\">    &#x2F;&#x2F; 解析非相对模块名的基准目录</span><br><span class=\"line\">    &quot;baseUrl&quot;: &quot;.&quot;,</span><br><span class=\"line\"></span><br><span class=\"line\">    &quot;esModuleInterop&quot;: true,</span><br><span class=\"line\"></span><br><span class=\"line\">    &#x2F;&#x2F; 从 tslib 导入辅助工具函数（比如 __extends， __rest等）</span><br><span class=\"line\">    &quot;importHelpers&quot;: true,</span><br><span class=\"line\"></span><br><span class=\"line\">    &#x2F;&#x2F; 指定生成哪个模块系统代码</span><br><span class=\"line\">    &quot;module&quot;: &quot;esnext&quot;,</span><br><span class=\"line\"></span><br><span class=\"line\">    &#x2F;&#x2F; 决定如何处理模块。</span><br><span class=\"line\">    &quot;moduleResolution&quot;: &quot;node&quot;,</span><br><span class=\"line\"></span><br><span class=\"line\">    &#x2F;&#x2F; 启用所有严格类型检查选项。</span><br><span class=\"line\">    &#x2F;&#x2F; 启用 --strict相当于启用 --noImplicitAny, --noImplicitThis, --alwaysStrict， </span><br><span class=\"line\">    &#x2F;&#x2F; --strictNullChecks和 --strictFunctionTypes和--strictPropertyInitialization。</span><br><span class=\"line\">    &quot;strict&quot;: true,</span><br><span class=\"line\"></span><br><span class=\"line\">    &#x2F;&#x2F; 生成相应的 .map文件。</span><br><span class=\"line\">    &quot;sourceMap&quot;: true,</span><br><span class=\"line\"></span><br><span class=\"line\">    &#x2F;&#x2F; 忽略所有的声明文件（ *.d.ts）的类型检查。</span><br><span class=\"line\">    &quot;skipLibCheck&quot;: true,</span><br><span class=\"line\"></span><br><span class=\"line\">    &#x2F;&#x2F; 指定ECMAScript目标版本 </span><br><span class=\"line\">    &quot;target&quot;: &quot;esnext&quot;,</span><br><span class=\"line\">    </span><br><span class=\"line\">    &#x2F;&#x2F; 要包含的类型声明文件名列表</span><br><span class=\"line\">    &quot;types&quot;: [</span><br><span class=\"line\"></span><br><span class=\"line\">    ],</span><br><span class=\"line\"></span><br><span class=\"line\">    &quot;isolatedModules&quot;: true,</span><br><span class=\"line\"></span><br><span class=\"line\">    &#x2F;&#x2F; 模块名到基于 baseUrl的路径映射的列表。</span><br><span class=\"line\">    &quot;paths&quot;: &#123;</span><br><span class=\"line\">      &quot;@&#x2F;*&quot;: [</span><br><span class=\"line\">        &quot;src&#x2F;*&quot;</span><br><span class=\"line\">      ]</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    &#x2F;&#x2F; 编译过程中需要引入的库文件的列表。</span><br><span class=\"line\">    &quot;lib&quot;: [</span><br><span class=\"line\">      &quot;ESNext&quot;,</span><br><span class=\"line\">      &quot;DOM&quot;,</span><br><span class=\"line\">      &quot;DOM.Iterable&quot;,</span><br><span class=\"line\">      &quot;ScriptHost&quot;</span><br><span class=\"line\">    ]</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &quot;include&quot;: [</span><br><span class=\"line\">    &quot;src&#x2F;**&#x2F;*.ts&quot;,</span><br><span class=\"line\">    &quot;src&#x2F;**&#x2F;*.tsx&quot;,</span><br><span class=\"line\">    &quot;src&#x2F;**&#x2F;*.vue&quot;,</span><br><span class=\"line\">    &quot;tests&#x2F;**&#x2F;*.ts&quot;,</span><br><span class=\"line\">    &quot;tests&#x2F;**&#x2F;*.tsx&quot;</span><br><span class=\"line\">  ],</span><br><span class=\"line\">  &quot;exclude&quot;: [</span><br><span class=\"line\">    &quot;node_modules&quot;</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>在 src 目录下新加 shim.d.ts 文件</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;* eslint-disable *&#x2F;</span><br><span class=\"line\">import type &#123; DefineComponent &#125; from &#39;vue&#39;</span><br><span class=\"line\"></span><br><span class=\"line\">declare module &#39;*.vue&#39; &#123;</span><br><span class=\"line\">  const component: DefineComponent&lt;&#123;&#125;, &#123;&#125;, any&gt;</span><br><span class=\"line\">  export default component</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>把 main.js 修改成 main.ts</p>\n<p>在根目录，打开 Index.html</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;script type&#x3D;&quot;module&quot; src&#x3D;&quot;&#x2F;src&#x2F;main.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class=\"line\">修改为：</span><br><span class=\"line\">&lt;script type&#x3D;&quot;module&quot; src&#x3D;&quot;&#x2F;src&#x2F;main.ts&quot;&gt;&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"引入-eslint\"><a href=\"#引入-eslint\" class=\"headerlink\" title=\"引入 eslint\"></a>引入 eslint</h2><p>安装 eslint prettier 依赖</p>\n<p><code>@typescript-eslint/parser @typescr ipt-eslint/eslint-plugin</code> 为 eslint 对 typescript 支持。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yarn add --dev eslint prettier eslint-config-prettier eslint-plugin-prettier eslint-plugin-vue @typescript-eslint&#x2F;parser @typescript-eslint&#x2F;eslint-plugin</span><br></pre></td></tr></table></figure>\n<p>在根目录下建立 eslint 配置文件：.eslintrc.js</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">module.exports &#x3D; &#123;</span><br><span class=\"line\">  parser: &#39;vue-eslint-parser&#39;,</span><br><span class=\"line\">  parserOptions: &#123;</span><br><span class=\"line\">    parser: &#39;@typescript-eslint&#x2F;parser&#39;,</span><br><span class=\"line\">    ecmaVersion: 2020,</span><br><span class=\"line\">    sourceType: &#39;module&#39;,</span><br><span class=\"line\">    ecmaFeatures: &#123;</span><br><span class=\"line\">      jsx: true</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  extends: [</span><br><span class=\"line\">    &#39;plugin:vue&#x2F;vue3-recommended&#39;,</span><br><span class=\"line\">    &#39;plugin:@typescript-eslint&#x2F;recommended&#39;,</span><br><span class=\"line\">    &#39;prettier&#x2F;@typescript-eslint&#39;,</span><br><span class=\"line\">    &#39;plugin:prettier&#x2F;recommended&#39;</span><br><span class=\"line\">  ],</span><br><span class=\"line\">  rules: &#123;</span><br><span class=\"line\">    &#39;@typescript-eslint&#x2F;ban-ts-ignore&#39;: &#39;off&#39;,</span><br><span class=\"line\">    &#39;@typescript-eslint&#x2F;explicit-function-return-type&#39;: &#39;off&#39;,</span><br><span class=\"line\">    &#39;@typescript-eslint&#x2F;no-explicit-any&#39;: &#39;off&#39;,</span><br><span class=\"line\">    &#39;@typescript-eslint&#x2F;no-var-requires&#39;: &#39;off&#39;,</span><br><span class=\"line\">    &#39;@typescript-eslint&#x2F;no-empty-function&#39;: &#39;off&#39;,</span><br><span class=\"line\">    &#39;vue&#x2F;custom-event-name-casing&#39;: &#39;off&#39;,</span><br><span class=\"line\">    &#39;no-use-before-define&#39;: &#39;off&#39;,</span><br><span class=\"line\">    &#x2F;&#x2F; &#39;no-use-before-define&#39;: [</span><br><span class=\"line\">    &#x2F;&#x2F;   &#39;error&#39;,</span><br><span class=\"line\">    &#x2F;&#x2F;   &#123;</span><br><span class=\"line\">    &#x2F;&#x2F;     functions: false,</span><br><span class=\"line\">    &#x2F;&#x2F;     classes: true,</span><br><span class=\"line\">    &#x2F;&#x2F;   &#125;,</span><br><span class=\"line\">    &#x2F;&#x2F; ],</span><br><span class=\"line\">    &#39;@typescript-eslint&#x2F;no-use-before-define&#39;: &#39;off&#39;,</span><br><span class=\"line\">    &#x2F;&#x2F; &#39;@typescript-eslint&#x2F;no-use-before-define&#39;: [</span><br><span class=\"line\">    &#x2F;&#x2F;   &#39;error&#39;,</span><br><span class=\"line\">    &#x2F;&#x2F;   &#123;</span><br><span class=\"line\">    &#x2F;&#x2F;     functions: false,</span><br><span class=\"line\">    &#x2F;&#x2F;     classes: true,</span><br><span class=\"line\">    &#x2F;&#x2F;   &#125;,</span><br><span class=\"line\">    &#x2F;&#x2F; ],</span><br><span class=\"line\">    &#39;@typescript-eslint&#x2F;ban-ts-comment&#39;: &#39;off&#39;,</span><br><span class=\"line\">    &#39;@typescript-eslint&#x2F;ban-types&#39;: &#39;off&#39;,</span><br><span class=\"line\">    &#39;@typescript-eslint&#x2F;no-non-null-assertion&#39;: &#39;off&#39;,</span><br><span class=\"line\">    &#39;@typescript-eslint&#x2F;explicit-module-boundary-types&#39;: &#39;off&#39;,</span><br><span class=\"line\">    &#39;@typescript-eslint&#x2F;no-unused-vars&#39;: [</span><br><span class=\"line\">      &#39;error&#39;,</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        argsIgnorePattern: &#39;^h$&#39;,</span><br><span class=\"line\">        varsIgnorePattern: &#39;^h$&#39;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ],</span><br><span class=\"line\">    &#39;no-unused-vars&#39;: [</span><br><span class=\"line\">      &#39;error&#39;,</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        argsIgnorePattern: &#39;^h$&#39;,</span><br><span class=\"line\">        varsIgnorePattern: &#39;^h$&#39;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ],</span><br><span class=\"line\">    &#39;space-before-function-paren&#39;: &#39;off&#39;,</span><br><span class=\"line\">    quotes: [&#39;error&#39;, &#39;single&#39;],</span><br><span class=\"line\">    &#39;comma-dangle&#39;: [&#39;error&#39;, &#39;never&#39;]</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<p>建立 prettier.config.js</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">module.exports &#x3D; &#123;</span><br><span class=\"line\">  printWidth: 100,</span><br><span class=\"line\">  tabWidth: 2,</span><br><span class=\"line\">  useTabs: false,</span><br><span class=\"line\">  semi: false, &#x2F;&#x2F; 未尾逗号</span><br><span class=\"line\">  vueIndentScriptAndStyle: true,</span><br><span class=\"line\">  singleQuote: true, &#x2F;&#x2F; 单引号</span><br><span class=\"line\">  quoteProps: &#39;as-needed&#39;,</span><br><span class=\"line\">  bracketSpacing: true,</span><br><span class=\"line\">  trailingComma: &#39;none&#39;, &#x2F;&#x2F; 未尾分号</span><br><span class=\"line\">  jsxBracketSameLine: false,</span><br><span class=\"line\">  jsxSingleQuote: false,</span><br><span class=\"line\">  arrowParens: &#39;always&#39;,</span><br><span class=\"line\">  insertPragma: false,</span><br><span class=\"line\">  requirePragma: false,</span><br><span class=\"line\">  proseWrap: &#39;never&#39;,</span><br><span class=\"line\">  htmlWhitespaceSensitivity: &#39;strict&#39;,</span><br><span class=\"line\">  endOfLine: &#39;lf&#39;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"引入-vue-router、vuex\"><a href=\"#引入-vue-router、vuex\" class=\"headerlink\" title=\"引入 vue-router、vuex\"></a>引入 vue-router、vuex</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yarn add vue-router@next vuex@next</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"vuex\"><a href=\"#vuex\" class=\"headerlink\" title=\"vuex\"></a>vuex</h3><p>在根目录下创建 store/index.ts</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">import &#123; InjectionKey &#125; from &#39;vue&#39;</span><br><span class=\"line\">import &#123; createStore, Store &#125; from &#39;vuex&#39;</span><br><span class=\"line\"></span><br><span class=\"line\">export interface State &#123;</span><br><span class=\"line\">  count: number</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">export const key: InjectionKey&lt;Store&lt;State&gt;&gt; &#x3D; Symbol()</span><br><span class=\"line\"></span><br><span class=\"line\">export const store &#x3D; createStore&lt;State&gt;(&#123;</span><br><span class=\"line\">  state() &#123;</span><br><span class=\"line\">    return &#123;</span><br><span class=\"line\">      count: 0</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  mutations: &#123;</span><br><span class=\"line\">    increment(state) &#123;</span><br><span class=\"line\">      state.count++</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>main.ts 修改</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">import &#123; createApp &#125; from &#39;vue&#39;</span><br><span class=\"line\">import &#123; store, key &#125; from &#39;.&#x2F;store&#39;</span><br><span class=\"line\">import App from &#39;.&#x2F;App&#39;</span><br><span class=\"line\">import &#39;.&#x2F;index.css&#39;</span><br><span class=\"line\"></span><br><span class=\"line\">const app &#x3D; createApp(App)</span><br><span class=\"line\"></span><br><span class=\"line\">app.use(store, key)</span><br><span class=\"line\"></span><br><span class=\"line\">app.mount(&#39;#app&#39;)</span><br></pre></td></tr></table></figure>\n\n<p>components/HelloWord.vue 修改</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;template&gt;</span><br><span class=\"line\">  &lt;h1&gt;&#123;&#123; msg &#125;&#125;&lt;&#x2F;h1&gt;</span><br><span class=\"line\">  &lt;button @click&#x3D;&quot;inCrement&quot;&gt; count is: &lt;&#x2F;button&gt;</span><br><span class=\"line\">  &lt;p&gt;&#123;&#123; count &#125;&#125;&lt;&#x2F;p&gt;</span><br><span class=\"line\">&lt;&#x2F;template&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;script&gt;</span><br><span class=\"line\">  import &#123; defineComponent, computed &#125; from &#39;vue&#39;</span><br><span class=\"line\">  import &#123; useStore &#125; from &#39;vuex&#39;</span><br><span class=\"line\">  import &#123; key &#125; from &#39;..&#x2F;store&#39;</span><br><span class=\"line\"></span><br><span class=\"line\">  export default defineComponent(&#123;</span><br><span class=\"line\">    name: &#39;HelloWorld&#39;,</span><br><span class=\"line\">    props: &#123;</span><br><span class=\"line\">      msg: &#123;</span><br><span class=\"line\">        type: String,</span><br><span class=\"line\">        default: &#39;&#39;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    setup() &#123;</span><br><span class=\"line\">      const store &#x3D; useStore(key)</span><br><span class=\"line\"></span><br><span class=\"line\">      const count &#x3D; computed(() &#x3D;&gt; store.state.count)</span><br><span class=\"line\"></span><br><span class=\"line\">      return &#123;</span><br><span class=\"line\">        count,</span><br><span class=\"line\">        inCrement: () &#x3D;&gt; store.commit(&#39;increment&#39;)</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"vue-router\"><a href=\"#vue-router\" class=\"headerlink\" title=\"vue-router\"></a>vue-router</h3><p>在 src 目录下建立 router/index.ts，内容如下：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">import &#123; createRouter, createWebHistory, RouteRecordRaw &#125; from &quot;vue-router&quot;;</span><br><span class=\"line\">import HelloWorld from &quot;..&#x2F;components&#x2F;HelloWorld.vue&quot;;</span><br><span class=\"line\"></span><br><span class=\"line\">const routes: Array&lt;RouteRecordRaw&gt; &#x3D; [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        path: &quot;&#x2F;&quot;,</span><br><span class=\"line\">        name: &quot;HelloWorld&quot;,</span><br><span class=\"line\">        component: HelloWorld,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        path: &quot;&#x2F;about&quot;,</span><br><span class=\"line\">        name: &quot;About&quot;,</span><br><span class=\"line\">        &#x2F;&#x2F; route level code-splitting</span><br><span class=\"line\">        &#x2F;&#x2F; this generates a separate chunk (about.[hash].js) for this route</span><br><span class=\"line\">        &#x2F;&#x2F; which is lazy-loaded when the route is visited.</span><br><span class=\"line\">        component: () &#x3D;&gt;</span><br><span class=\"line\">            import(&#x2F;* webpackChunkName: &quot;About&quot; *&#x2F; &quot;..&#x2F;components&#x2F;About.vue&quot;)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">];</span><br><span class=\"line\"></span><br><span class=\"line\">const router &#x3D; createRouter(&#123;</span><br><span class=\"line\">    history: createWebHistory(process.env.BASE_URL),</span><br><span class=\"line\">    routes,</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">export default router;</span><br></pre></td></tr></table></figure>\n\n<p>再新建一个 components/About.vue 文件，内容如下：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;template&gt;</span><br><span class=\"line\">  &lt;img</span><br><span class=\"line\">    alt&#x3D;&quot;Vue logo&quot;</span><br><span class=\"line\">    src&#x3D;&quot;..&#x2F;assets&#x2F;logo.png&quot;</span><br><span class=\"line\">  &#x2F;&gt;</span><br><span class=\"line\">  &lt;h1&gt;&#123;&#123; msg &#125;&#125;&lt;&#x2F;h1&gt;</span><br><span class=\"line\">&lt;&#x2F;template&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;script lang&#x3D;&quot;ts&quot;&gt;</span><br><span class=\"line\">import &#123; defineComponent &#125; from &#39;vue&#39;</span><br><span class=\"line\"></span><br><span class=\"line\">export default defineComponent(&#123;</span><br><span class=\"line\">  name: &#39;About&#39;,</span><br><span class=\"line\">  data() &#123;</span><br><span class=\"line\">    return &#123;</span><br><span class=\"line\">      msg: &#39;Hello Vue 3.0 + Vite!&#39;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  setup() &#123;&#125;</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>\n\n<p>再修改 main.ts</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">import &#123; createApp &#125; from &#39;vue&#39;</span><br><span class=\"line\">import &#123; store, key &#125; from &#39;.&#x2F;store&#39;</span><br><span class=\"line\">import router from &quot;.&#x2F;router&quot;;</span><br><span class=\"line\">import App from &#39;.&#x2F;App&#39;</span><br><span class=\"line\">import &#39;.&#x2F;index.css&#39;</span><br><span class=\"line\"></span><br><span class=\"line\">const app &#x3D; createApp(App)</span><br><span class=\"line\"></span><br><span class=\"line\">app.use(store, key)</span><br><span class=\"line\">app.use(router)</span><br><span class=\"line\">app.mount(&#39;#app&#39;)</span><br></pre></td></tr></table></figure>\n\n<p>添加 src/vue-app-env.d.ts</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">declare module &#39;*.vue&#39; &#123;</span><br><span class=\"line\">  import &#123; Component &#125; from &#39;vue&#39;</span><br><span class=\"line\">  const mod: Component</span><br><span class=\"line\">  export default mod</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"启动，访问-http-localhost-3000\"><a href=\"#启动，访问-http-localhost-3000\" class=\"headerlink\" title=\"启动，访问  http://localhost:3000/\"></a>启动，访问  <a href=\"http://localhost:3000/\">http://localhost:3000/</a></h3><h2 id=\"加入-Element-Plus\"><a href=\"#加入-Element-Plus\" class=\"headerlink\" title=\"加入 Element Plus\"></a>加入 Element Plus</h2><h3 id=\"全局安装-Element-Plus\"><a href=\"#全局安装-Element-Plus\" class=\"headerlink\" title=\"全局安装 Element Plus\"></a>全局安装 Element Plus</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install element-plus --save</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"完整引入\"><a href=\"#完整引入\" class=\"headerlink\" title=\"完整引入\"></a>完整引入</h3><p>在 main.js 中写入以下内容：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">import &#123; createApp &#125; from &#39;vue&#39;</span><br><span class=\"line\">import ElementPlus from &#39;element-plus&#39;;</span><br><span class=\"line\">import router from &quot;.&#x2F;router&quot;;</span><br><span class=\"line\">import &#39;element-plus&#x2F;lib&#x2F;theme-chalk&#x2F;index.css&#39;;</span><br><span class=\"line\">import App from &#39;.&#x2F;App.vue&#39;;</span><br><span class=\"line\">import &#39;.&#x2F;index.css&#39;</span><br><span class=\"line\"> </span><br><span class=\"line\">const app &#x3D; createApp(App)</span><br><span class=\"line\">app.use(ElementPlus)</span><br><span class=\"line\">app.use(router)</span><br><span class=\"line\">app.mount(&#39;#app&#39;)</span><br></pre></td></tr></table></figure>\n\n\n<h3 id=\"按需引入\"><a href=\"#按需引入\" class=\"headerlink\" title=\"按需引入\"></a>按需引入</h3><p>借助 babel-plugin-component，我们可以只引入需要的组件，以达到减小项目体积的目的。</p>\n<p>首先，安装 babel-plugin-component：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install babel-plugin-component -D</span><br></pre></td></tr></table></figure>\n\n<p>然后，将 .babelrc 修改为：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  &quot;plugins&quot;: [</span><br><span class=\"line\">    [</span><br><span class=\"line\">      &quot;component&quot;,</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        &quot;libraryName&quot;: &quot;element-plus&quot;,</span><br><span class=\"line\">        &quot;styleLibraryName&quot;: &quot;theme-chalk&quot;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ]</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>接下来，如果你只希望引入部分组件，比如 Button 和 Select，那么需要在 main.js 中写入以下内容：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">import &#123; createApp &#125; from &#39;vue&#39;</span><br><span class=\"line\">import &#123; store, key &#125; from &#39;.&#x2F;store&#39;;</span><br><span class=\"line\">import router from &quot;.&#x2F;router&quot;;</span><br><span class=\"line\">import &#123; ElButton, ElSelect &#125; from &#39;element-plus&#39;;</span><br><span class=\"line\">import App from &#39;.&#x2F;App.vue&#39;;</span><br><span class=\"line\">import &#39;.&#x2F;index.css&#39;</span><br><span class=\"line\"> </span><br><span class=\"line\">const app &#x3D; createApp(App)</span><br><span class=\"line\">app.component(ElButton.name, ElButton);</span><br><span class=\"line\">app.component(ElSelect.name, ElSelect);</span><br><span class=\"line\"> </span><br><span class=\"line\">&#x2F;* or</span><br><span class=\"line\"> * app.use(ElButton)</span><br><span class=\"line\"> * app.use(ElSelect)</span><br><span class=\"line\"> *&#x2F;</span><br><span class=\"line\"> </span><br><span class=\"line\">app.use(store, key)</span><br><span class=\"line\">app.use(router)</span><br><span class=\"line\">app.mount(&#39;#app&#39;)</span><br><span class=\"line\">app.mount(&#39;#app&#39;)</span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"<p>摘要: vue3.0 项目初始化</p>","more":"<h2 id=\"前置环境\"><a href=\"#前置环境\" class=\"headerlink\" title=\"前置环境\"></a>前置环境</h2><p>已安装nodejs </p>\n<h2 id=\"准备\"><a href=\"#准备\" class=\"headerlink\" title=\"准备\"></a>准备</h2><h3 id=\"安装-vite-app\"><a href=\"#安装-vite-app\" class=\"headerlink\" title=\"安装 vite-app\"></a>安装 vite-app</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm i -g create-vite-app</span><br><span class=\"line\"></span><br><span class=\"line\">或者</span><br><span class=\"line\"></span><br><span class=\"line\">yarn global add create-vite-app</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"项目初始化\"><a href=\"#项目初始化\" class=\"headerlink\" title=\"项目初始化\"></a>项目初始化</h2><h3 id=\"新建项目\"><a href=\"#新建项目\" class=\"headerlink\" title=\"新建项目\"></a>新建项目</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cva &lt;project-name&gt;</span><br><span class=\"line\">或</span><br><span class=\"line\">create-vite-app &lt;project-name&gt;</span><br><span class=\"line\">或</span><br><span class=\"line\">npm init vite-app &lt;project-name&gt;</span><br><span class=\"line\">或</span><br><span class=\"line\">yarn create vite-app &lt;project-name&gt;</span><br></pre></td></tr></table></figure>\n<h3 id=\"进入项目，安装依赖\"><a href=\"#进入项目，安装依赖\" class=\"headerlink\" title=\"进入项目，安装依赖\"></a>进入项目，安装依赖</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd &lt;project-name&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">yarn</span><br><span class=\"line\"># 或 </span><br><span class=\"line\">npm i</span><br></pre></td></tr></table></figure>\n<h3 id=\"运行项目\"><a href=\"#运行项目\" class=\"headerlink\" title=\"运行项目\"></a>运行项目</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yarn dev </span><br><span class=\"line\">或</span><br><span class=\"line\">yarn run serve</span><br><span class=\"line\">或</span><br><span class=\"line\">npm run serve</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"引入TypeScript\"><a href=\"#引入TypeScript\" class=\"headerlink\" title=\"引入TypeScript\"></a>引入TypeScript</h2><h3 id=\"加入-ts-依赖\"><a href=\"#加入-ts-依赖\" class=\"headerlink\" title=\"加入 ts 依赖\"></a>加入 ts 依赖</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yarn add --dev typescript</span><br></pre></td></tr></table></figure>\n<p>在 项目根目录下创建 TypeScript 的配置文件 tsconfig.json</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  &quot;compilerOptions&quot;: &#123;</span><br><span class=\"line\">    &#x2F;&#x2F; 允许从没有设置默认导出的模块中默认导入。这并不影响代码的输出，仅为了类型检查。</span><br><span class=\"line\">    &quot;allowSyntheticDefaultImports&quot;: true,</span><br><span class=\"line\">    </span><br><span class=\"line\">    &#x2F;&#x2F; 解析非相对模块名的基准目录</span><br><span class=\"line\">    &quot;baseUrl&quot;: &quot;.&quot;,</span><br><span class=\"line\"></span><br><span class=\"line\">    &quot;esModuleInterop&quot;: true,</span><br><span class=\"line\"></span><br><span class=\"line\">    &#x2F;&#x2F; 从 tslib 导入辅助工具函数（比如 __extends， __rest等）</span><br><span class=\"line\">    &quot;importHelpers&quot;: true,</span><br><span class=\"line\"></span><br><span class=\"line\">    &#x2F;&#x2F; 指定生成哪个模块系统代码</span><br><span class=\"line\">    &quot;module&quot;: &quot;esnext&quot;,</span><br><span class=\"line\"></span><br><span class=\"line\">    &#x2F;&#x2F; 决定如何处理模块。</span><br><span class=\"line\">    &quot;moduleResolution&quot;: &quot;node&quot;,</span><br><span class=\"line\"></span><br><span class=\"line\">    &#x2F;&#x2F; 启用所有严格类型检查选项。</span><br><span class=\"line\">    &#x2F;&#x2F; 启用 --strict相当于启用 --noImplicitAny, --noImplicitThis, --alwaysStrict， </span><br><span class=\"line\">    &#x2F;&#x2F; --strictNullChecks和 --strictFunctionTypes和--strictPropertyInitialization。</span><br><span class=\"line\">    &quot;strict&quot;: true,</span><br><span class=\"line\"></span><br><span class=\"line\">    &#x2F;&#x2F; 生成相应的 .map文件。</span><br><span class=\"line\">    &quot;sourceMap&quot;: true,</span><br><span class=\"line\"></span><br><span class=\"line\">    &#x2F;&#x2F; 忽略所有的声明文件（ *.d.ts）的类型检查。</span><br><span class=\"line\">    &quot;skipLibCheck&quot;: true,</span><br><span class=\"line\"></span><br><span class=\"line\">    &#x2F;&#x2F; 指定ECMAScript目标版本 </span><br><span class=\"line\">    &quot;target&quot;: &quot;esnext&quot;,</span><br><span class=\"line\">    </span><br><span class=\"line\">    &#x2F;&#x2F; 要包含的类型声明文件名列表</span><br><span class=\"line\">    &quot;types&quot;: [</span><br><span class=\"line\"></span><br><span class=\"line\">    ],</span><br><span class=\"line\"></span><br><span class=\"line\">    &quot;isolatedModules&quot;: true,</span><br><span class=\"line\"></span><br><span class=\"line\">    &#x2F;&#x2F; 模块名到基于 baseUrl的路径映射的列表。</span><br><span class=\"line\">    &quot;paths&quot;: &#123;</span><br><span class=\"line\">      &quot;@&#x2F;*&quot;: [</span><br><span class=\"line\">        &quot;src&#x2F;*&quot;</span><br><span class=\"line\">      ]</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    &#x2F;&#x2F; 编译过程中需要引入的库文件的列表。</span><br><span class=\"line\">    &quot;lib&quot;: [</span><br><span class=\"line\">      &quot;ESNext&quot;,</span><br><span class=\"line\">      &quot;DOM&quot;,</span><br><span class=\"line\">      &quot;DOM.Iterable&quot;,</span><br><span class=\"line\">      &quot;ScriptHost&quot;</span><br><span class=\"line\">    ]</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &quot;include&quot;: [</span><br><span class=\"line\">    &quot;src&#x2F;**&#x2F;*.ts&quot;,</span><br><span class=\"line\">    &quot;src&#x2F;**&#x2F;*.tsx&quot;,</span><br><span class=\"line\">    &quot;src&#x2F;**&#x2F;*.vue&quot;,</span><br><span class=\"line\">    &quot;tests&#x2F;**&#x2F;*.ts&quot;,</span><br><span class=\"line\">    &quot;tests&#x2F;**&#x2F;*.tsx&quot;</span><br><span class=\"line\">  ],</span><br><span class=\"line\">  &quot;exclude&quot;: [</span><br><span class=\"line\">    &quot;node_modules&quot;</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>在 src 目录下新加 shim.d.ts 文件</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;* eslint-disable *&#x2F;</span><br><span class=\"line\">import type &#123; DefineComponent &#125; from &#39;vue&#39;</span><br><span class=\"line\"></span><br><span class=\"line\">declare module &#39;*.vue&#39; &#123;</span><br><span class=\"line\">  const component: DefineComponent&lt;&#123;&#125;, &#123;&#125;, any&gt;</span><br><span class=\"line\">  export default component</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>把 main.js 修改成 main.ts</p>\n<p>在根目录，打开 Index.html</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;script type&#x3D;&quot;module&quot; src&#x3D;&quot;&#x2F;src&#x2F;main.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class=\"line\">修改为：</span><br><span class=\"line\">&lt;script type&#x3D;&quot;module&quot; src&#x3D;&quot;&#x2F;src&#x2F;main.ts&quot;&gt;&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"引入-eslint\"><a href=\"#引入-eslint\" class=\"headerlink\" title=\"引入 eslint\"></a>引入 eslint</h2><p>安装 eslint prettier 依赖</p>\n<p><code>@typescript-eslint/parser @typescr ipt-eslint/eslint-plugin</code> 为 eslint 对 typescript 支持。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yarn add --dev eslint prettier eslint-config-prettier eslint-plugin-prettier eslint-plugin-vue @typescript-eslint&#x2F;parser @typescript-eslint&#x2F;eslint-plugin</span><br></pre></td></tr></table></figure>\n<p>在根目录下建立 eslint 配置文件：.eslintrc.js</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">module.exports &#x3D; &#123;</span><br><span class=\"line\">  parser: &#39;vue-eslint-parser&#39;,</span><br><span class=\"line\">  parserOptions: &#123;</span><br><span class=\"line\">    parser: &#39;@typescript-eslint&#x2F;parser&#39;,</span><br><span class=\"line\">    ecmaVersion: 2020,</span><br><span class=\"line\">    sourceType: &#39;module&#39;,</span><br><span class=\"line\">    ecmaFeatures: &#123;</span><br><span class=\"line\">      jsx: true</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  extends: [</span><br><span class=\"line\">    &#39;plugin:vue&#x2F;vue3-recommended&#39;,</span><br><span class=\"line\">    &#39;plugin:@typescript-eslint&#x2F;recommended&#39;,</span><br><span class=\"line\">    &#39;prettier&#x2F;@typescript-eslint&#39;,</span><br><span class=\"line\">    &#39;plugin:prettier&#x2F;recommended&#39;</span><br><span class=\"line\">  ],</span><br><span class=\"line\">  rules: &#123;</span><br><span class=\"line\">    &#39;@typescript-eslint&#x2F;ban-ts-ignore&#39;: &#39;off&#39;,</span><br><span class=\"line\">    &#39;@typescript-eslint&#x2F;explicit-function-return-type&#39;: &#39;off&#39;,</span><br><span class=\"line\">    &#39;@typescript-eslint&#x2F;no-explicit-any&#39;: &#39;off&#39;,</span><br><span class=\"line\">    &#39;@typescript-eslint&#x2F;no-var-requires&#39;: &#39;off&#39;,</span><br><span class=\"line\">    &#39;@typescript-eslint&#x2F;no-empty-function&#39;: &#39;off&#39;,</span><br><span class=\"line\">    &#39;vue&#x2F;custom-event-name-casing&#39;: &#39;off&#39;,</span><br><span class=\"line\">    &#39;no-use-before-define&#39;: &#39;off&#39;,</span><br><span class=\"line\">    &#x2F;&#x2F; &#39;no-use-before-define&#39;: [</span><br><span class=\"line\">    &#x2F;&#x2F;   &#39;error&#39;,</span><br><span class=\"line\">    &#x2F;&#x2F;   &#123;</span><br><span class=\"line\">    &#x2F;&#x2F;     functions: false,</span><br><span class=\"line\">    &#x2F;&#x2F;     classes: true,</span><br><span class=\"line\">    &#x2F;&#x2F;   &#125;,</span><br><span class=\"line\">    &#x2F;&#x2F; ],</span><br><span class=\"line\">    &#39;@typescript-eslint&#x2F;no-use-before-define&#39;: &#39;off&#39;,</span><br><span class=\"line\">    &#x2F;&#x2F; &#39;@typescript-eslint&#x2F;no-use-before-define&#39;: [</span><br><span class=\"line\">    &#x2F;&#x2F;   &#39;error&#39;,</span><br><span class=\"line\">    &#x2F;&#x2F;   &#123;</span><br><span class=\"line\">    &#x2F;&#x2F;     functions: false,</span><br><span class=\"line\">    &#x2F;&#x2F;     classes: true,</span><br><span class=\"line\">    &#x2F;&#x2F;   &#125;,</span><br><span class=\"line\">    &#x2F;&#x2F; ],</span><br><span class=\"line\">    &#39;@typescript-eslint&#x2F;ban-ts-comment&#39;: &#39;off&#39;,</span><br><span class=\"line\">    &#39;@typescript-eslint&#x2F;ban-types&#39;: &#39;off&#39;,</span><br><span class=\"line\">    &#39;@typescript-eslint&#x2F;no-non-null-assertion&#39;: &#39;off&#39;,</span><br><span class=\"line\">    &#39;@typescript-eslint&#x2F;explicit-module-boundary-types&#39;: &#39;off&#39;,</span><br><span class=\"line\">    &#39;@typescript-eslint&#x2F;no-unused-vars&#39;: [</span><br><span class=\"line\">      &#39;error&#39;,</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        argsIgnorePattern: &#39;^h$&#39;,</span><br><span class=\"line\">        varsIgnorePattern: &#39;^h$&#39;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ],</span><br><span class=\"line\">    &#39;no-unused-vars&#39;: [</span><br><span class=\"line\">      &#39;error&#39;,</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        argsIgnorePattern: &#39;^h$&#39;,</span><br><span class=\"line\">        varsIgnorePattern: &#39;^h$&#39;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ],</span><br><span class=\"line\">    &#39;space-before-function-paren&#39;: &#39;off&#39;,</span><br><span class=\"line\">    quotes: [&#39;error&#39;, &#39;single&#39;],</span><br><span class=\"line\">    &#39;comma-dangle&#39;: [&#39;error&#39;, &#39;never&#39;]</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<p>建立 prettier.config.js</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">module.exports &#x3D; &#123;</span><br><span class=\"line\">  printWidth: 100,</span><br><span class=\"line\">  tabWidth: 2,</span><br><span class=\"line\">  useTabs: false,</span><br><span class=\"line\">  semi: false, &#x2F;&#x2F; 未尾逗号</span><br><span class=\"line\">  vueIndentScriptAndStyle: true,</span><br><span class=\"line\">  singleQuote: true, &#x2F;&#x2F; 单引号</span><br><span class=\"line\">  quoteProps: &#39;as-needed&#39;,</span><br><span class=\"line\">  bracketSpacing: true,</span><br><span class=\"line\">  trailingComma: &#39;none&#39;, &#x2F;&#x2F; 未尾分号</span><br><span class=\"line\">  jsxBracketSameLine: false,</span><br><span class=\"line\">  jsxSingleQuote: false,</span><br><span class=\"line\">  arrowParens: &#39;always&#39;,</span><br><span class=\"line\">  insertPragma: false,</span><br><span class=\"line\">  requirePragma: false,</span><br><span class=\"line\">  proseWrap: &#39;never&#39;,</span><br><span class=\"line\">  htmlWhitespaceSensitivity: &#39;strict&#39;,</span><br><span class=\"line\">  endOfLine: &#39;lf&#39;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"引入-vue-router、vuex\"><a href=\"#引入-vue-router、vuex\" class=\"headerlink\" title=\"引入 vue-router、vuex\"></a>引入 vue-router、vuex</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yarn add vue-router@next vuex@next</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"vuex\"><a href=\"#vuex\" class=\"headerlink\" title=\"vuex\"></a>vuex</h3><p>在根目录下创建 store/index.ts</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">import &#123; InjectionKey &#125; from &#39;vue&#39;</span><br><span class=\"line\">import &#123; createStore, Store &#125; from &#39;vuex&#39;</span><br><span class=\"line\"></span><br><span class=\"line\">export interface State &#123;</span><br><span class=\"line\">  count: number</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">export const key: InjectionKey&lt;Store&lt;State&gt;&gt; &#x3D; Symbol()</span><br><span class=\"line\"></span><br><span class=\"line\">export const store &#x3D; createStore&lt;State&gt;(&#123;</span><br><span class=\"line\">  state() &#123;</span><br><span class=\"line\">    return &#123;</span><br><span class=\"line\">      count: 0</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  mutations: &#123;</span><br><span class=\"line\">    increment(state) &#123;</span><br><span class=\"line\">      state.count++</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>main.ts 修改</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">import &#123; createApp &#125; from &#39;vue&#39;</span><br><span class=\"line\">import &#123; store, key &#125; from &#39;.&#x2F;store&#39;</span><br><span class=\"line\">import App from &#39;.&#x2F;App&#39;</span><br><span class=\"line\">import &#39;.&#x2F;index.css&#39;</span><br><span class=\"line\"></span><br><span class=\"line\">const app &#x3D; createApp(App)</span><br><span class=\"line\"></span><br><span class=\"line\">app.use(store, key)</span><br><span class=\"line\"></span><br><span class=\"line\">app.mount(&#39;#app&#39;)</span><br></pre></td></tr></table></figure>\n\n<p>components/HelloWord.vue 修改</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;template&gt;</span><br><span class=\"line\">  &lt;h1&gt;&#123;&#123; msg &#125;&#125;&lt;&#x2F;h1&gt;</span><br><span class=\"line\">  &lt;button @click&#x3D;&quot;inCrement&quot;&gt; count is: &lt;&#x2F;button&gt;</span><br><span class=\"line\">  &lt;p&gt;&#123;&#123; count &#125;&#125;&lt;&#x2F;p&gt;</span><br><span class=\"line\">&lt;&#x2F;template&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;script&gt;</span><br><span class=\"line\">  import &#123; defineComponent, computed &#125; from &#39;vue&#39;</span><br><span class=\"line\">  import &#123; useStore &#125; from &#39;vuex&#39;</span><br><span class=\"line\">  import &#123; key &#125; from &#39;..&#x2F;store&#39;</span><br><span class=\"line\"></span><br><span class=\"line\">  export default defineComponent(&#123;</span><br><span class=\"line\">    name: &#39;HelloWorld&#39;,</span><br><span class=\"line\">    props: &#123;</span><br><span class=\"line\">      msg: &#123;</span><br><span class=\"line\">        type: String,</span><br><span class=\"line\">        default: &#39;&#39;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    setup() &#123;</span><br><span class=\"line\">      const store &#x3D; useStore(key)</span><br><span class=\"line\"></span><br><span class=\"line\">      const count &#x3D; computed(() &#x3D;&gt; store.state.count)</span><br><span class=\"line\"></span><br><span class=\"line\">      return &#123;</span><br><span class=\"line\">        count,</span><br><span class=\"line\">        inCrement: () &#x3D;&gt; store.commit(&#39;increment&#39;)</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"vue-router\"><a href=\"#vue-router\" class=\"headerlink\" title=\"vue-router\"></a>vue-router</h3><p>在 src 目录下建立 router/index.ts，内容如下：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">import &#123; createRouter, createWebHistory, RouteRecordRaw &#125; from &quot;vue-router&quot;;</span><br><span class=\"line\">import HelloWorld from &quot;..&#x2F;components&#x2F;HelloWorld.vue&quot;;</span><br><span class=\"line\"></span><br><span class=\"line\">const routes: Array&lt;RouteRecordRaw&gt; &#x3D; [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        path: &quot;&#x2F;&quot;,</span><br><span class=\"line\">        name: &quot;HelloWorld&quot;,</span><br><span class=\"line\">        component: HelloWorld,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        path: &quot;&#x2F;about&quot;,</span><br><span class=\"line\">        name: &quot;About&quot;,</span><br><span class=\"line\">        &#x2F;&#x2F; route level code-splitting</span><br><span class=\"line\">        &#x2F;&#x2F; this generates a separate chunk (about.[hash].js) for this route</span><br><span class=\"line\">        &#x2F;&#x2F; which is lazy-loaded when the route is visited.</span><br><span class=\"line\">        component: () &#x3D;&gt;</span><br><span class=\"line\">            import(&#x2F;* webpackChunkName: &quot;About&quot; *&#x2F; &quot;..&#x2F;components&#x2F;About.vue&quot;)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">];</span><br><span class=\"line\"></span><br><span class=\"line\">const router &#x3D; createRouter(&#123;</span><br><span class=\"line\">    history: createWebHistory(process.env.BASE_URL),</span><br><span class=\"line\">    routes,</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">export default router;</span><br></pre></td></tr></table></figure>\n\n<p>再新建一个 components/About.vue 文件，内容如下：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;template&gt;</span><br><span class=\"line\">  &lt;img</span><br><span class=\"line\">    alt&#x3D;&quot;Vue logo&quot;</span><br><span class=\"line\">    src&#x3D;&quot;..&#x2F;assets&#x2F;logo.png&quot;</span><br><span class=\"line\">  &#x2F;&gt;</span><br><span class=\"line\">  &lt;h1&gt;&#123;&#123; msg &#125;&#125;&lt;&#x2F;h1&gt;</span><br><span class=\"line\">&lt;&#x2F;template&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;script lang&#x3D;&quot;ts&quot;&gt;</span><br><span class=\"line\">import &#123; defineComponent &#125; from &#39;vue&#39;</span><br><span class=\"line\"></span><br><span class=\"line\">export default defineComponent(&#123;</span><br><span class=\"line\">  name: &#39;About&#39;,</span><br><span class=\"line\">  data() &#123;</span><br><span class=\"line\">    return &#123;</span><br><span class=\"line\">      msg: &#39;Hello Vue 3.0 + Vite!&#39;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  setup() &#123;&#125;</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>\n\n<p>再修改 main.ts</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">import &#123; createApp &#125; from &#39;vue&#39;</span><br><span class=\"line\">import &#123; store, key &#125; from &#39;.&#x2F;store&#39;</span><br><span class=\"line\">import router from &quot;.&#x2F;router&quot;;</span><br><span class=\"line\">import App from &#39;.&#x2F;App&#39;</span><br><span class=\"line\">import &#39;.&#x2F;index.css&#39;</span><br><span class=\"line\"></span><br><span class=\"line\">const app &#x3D; createApp(App)</span><br><span class=\"line\"></span><br><span class=\"line\">app.use(store, key)</span><br><span class=\"line\">app.use(router)</span><br><span class=\"line\">app.mount(&#39;#app&#39;)</span><br></pre></td></tr></table></figure>\n\n<p>添加 src/vue-app-env.d.ts</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">declare module &#39;*.vue&#39; &#123;</span><br><span class=\"line\">  import &#123; Component &#125; from &#39;vue&#39;</span><br><span class=\"line\">  const mod: Component</span><br><span class=\"line\">  export default mod</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"启动，访问-http-localhost-3000\"><a href=\"#启动，访问-http-localhost-3000\" class=\"headerlink\" title=\"启动，访问  http://localhost:3000/\"></a>启动，访问  <a href=\"http://localhost:3000/\">http://localhost:3000/</a></h3><h2 id=\"加入-Element-Plus\"><a href=\"#加入-Element-Plus\" class=\"headerlink\" title=\"加入 Element Plus\"></a>加入 Element Plus</h2><h3 id=\"全局安装-Element-Plus\"><a href=\"#全局安装-Element-Plus\" class=\"headerlink\" title=\"全局安装 Element Plus\"></a>全局安装 Element Plus</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install element-plus --save</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"完整引入\"><a href=\"#完整引入\" class=\"headerlink\" title=\"完整引入\"></a>完整引入</h3><p>在 main.js 中写入以下内容：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">import &#123; createApp &#125; from &#39;vue&#39;</span><br><span class=\"line\">import ElementPlus from &#39;element-plus&#39;;</span><br><span class=\"line\">import router from &quot;.&#x2F;router&quot;;</span><br><span class=\"line\">import &#39;element-plus&#x2F;lib&#x2F;theme-chalk&#x2F;index.css&#39;;</span><br><span class=\"line\">import App from &#39;.&#x2F;App.vue&#39;;</span><br><span class=\"line\">import &#39;.&#x2F;index.css&#39;</span><br><span class=\"line\"> </span><br><span class=\"line\">const app &#x3D; createApp(App)</span><br><span class=\"line\">app.use(ElementPlus)</span><br><span class=\"line\">app.use(router)</span><br><span class=\"line\">app.mount(&#39;#app&#39;)</span><br></pre></td></tr></table></figure>\n\n\n<h3 id=\"按需引入\"><a href=\"#按需引入\" class=\"headerlink\" title=\"按需引入\"></a>按需引入</h3><p>借助 babel-plugin-component，我们可以只引入需要的组件，以达到减小项目体积的目的。</p>\n<p>首先，安装 babel-plugin-component：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install babel-plugin-component -D</span><br></pre></td></tr></table></figure>\n\n<p>然后，将 .babelrc 修改为：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  &quot;plugins&quot;: [</span><br><span class=\"line\">    [</span><br><span class=\"line\">      &quot;component&quot;,</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        &quot;libraryName&quot;: &quot;element-plus&quot;,</span><br><span class=\"line\">        &quot;styleLibraryName&quot;: &quot;theme-chalk&quot;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ]</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>接下来，如果你只希望引入部分组件，比如 Button 和 Select，那么需要在 main.js 中写入以下内容：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">import &#123; createApp &#125; from &#39;vue&#39;</span><br><span class=\"line\">import &#123; store, key &#125; from &#39;.&#x2F;store&#39;;</span><br><span class=\"line\">import router from &quot;.&#x2F;router&quot;;</span><br><span class=\"line\">import &#123; ElButton, ElSelect &#125; from &#39;element-plus&#39;;</span><br><span class=\"line\">import App from &#39;.&#x2F;App.vue&#39;;</span><br><span class=\"line\">import &#39;.&#x2F;index.css&#39;</span><br><span class=\"line\"> </span><br><span class=\"line\">const app &#x3D; createApp(App)</span><br><span class=\"line\">app.component(ElButton.name, ElButton);</span><br><span class=\"line\">app.component(ElSelect.name, ElSelect);</span><br><span class=\"line\"> </span><br><span class=\"line\">&#x2F;* or</span><br><span class=\"line\"> * app.use(ElButton)</span><br><span class=\"line\"> * app.use(ElSelect)</span><br><span class=\"line\"> *&#x2F;</span><br><span class=\"line\"> </span><br><span class=\"line\">app.use(store, key)</span><br><span class=\"line\">app.use(router)</span><br><span class=\"line\">app.mount(&#39;#app&#39;)</span><br><span class=\"line\">app.mount(&#39;#app&#39;)</span><br></pre></td></tr></table></figure>"},{"title":"vue3 教程一","date":"2020-09-29T07:05:00.000Z","_content":"  \n  \n摘要: vue3.0教程\n<!-- more -->\n\n### 安装 vue3\n\n\n\n### 安装 vite\n```\nnpm install -g create-vite-app\n```\n\n#### 创建项目\n```\ncreate-vite-app projectName\n```\n安装项目依赖\n```\ncd project\nnpm install \nnpm run dev\n```\n\n#### webpack 创建项目的方法\n```\ngit clone https://github.com/vuejs/vue-next-webpack-preview.git project Nameplates\ncd projectName\nnpm install\nnpm run dev\n```\n\n#### Vue-Cli  创建项目的方法\n```\nnpm install -g @vue/Cli\nvue create projectName\ncd projectName\nvue add vue-next\nnpm run serve\n```","source":"_posts/vue/vue教程一.md","raw":"---\ntitle: vue3 教程一\ndate: 2020-09-29 15:05\ncategories:\n- vue\ntags:\n- vue3\n---\n  \n  \n摘要: vue3.0教程\n<!-- more -->\n\n### 安装 vue3\n\n\n\n### 安装 vite\n```\nnpm install -g create-vite-app\n```\n\n#### 创建项目\n```\ncreate-vite-app projectName\n```\n安装项目依赖\n```\ncd project\nnpm install \nnpm run dev\n```\n\n#### webpack 创建项目的方法\n```\ngit clone https://github.com/vuejs/vue-next-webpack-preview.git project Nameplates\ncd projectName\nnpm install\nnpm run dev\n```\n\n#### Vue-Cli  创建项目的方法\n```\nnpm install -g @vue/Cli\nvue create projectName\ncd projectName\nvue add vue-next\nnpm run serve\n```","slug":"vue/vue教程一","published":1,"updated":"2021-06-18T08:07:11.205Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cku697a2d00bn00uh1pdcelfl","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><p>摘要: vue3.0教程</p>\n<span id=\"more\"></span>\n\n<h3 id=\"安装-vue3\"><a href=\"#安装-vue3\" class=\"headerlink\" title=\"安装 vue3\"></a>安装 vue3</h3><h3 id=\"安装-vite\"><a href=\"#安装-vite\" class=\"headerlink\" title=\"安装 vite\"></a>安装 vite</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install -g create-vite-app</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"创建项目\"><a href=\"#创建项目\" class=\"headerlink\" title=\"创建项目\"></a>创建项目</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">create-vite-app projectName</span><br></pre></td></tr></table></figure>\n<p>安装项目依赖</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd project</span><br><span class=\"line\">npm install </span><br><span class=\"line\">npm run dev</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"webpack-创建项目的方法\"><a href=\"#webpack-创建项目的方法\" class=\"headerlink\" title=\"webpack 创建项目的方法\"></a>webpack 创建项目的方法</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git clone https:&#x2F;&#x2F;github.com&#x2F;vuejs&#x2F;vue-next-webpack-preview.git project Nameplates</span><br><span class=\"line\">cd projectName</span><br><span class=\"line\">npm install</span><br><span class=\"line\">npm run dev</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"Vue-Cli-创建项目的方法\"><a href=\"#Vue-Cli-创建项目的方法\" class=\"headerlink\" title=\"Vue-Cli  创建项目的方法\"></a>Vue-Cli  创建项目的方法</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install -g @vue&#x2F;Cli</span><br><span class=\"line\">vue create projectName</span><br><span class=\"line\">cd projectName</span><br><span class=\"line\">vue add vue-next</span><br><span class=\"line\">npm run serve</span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"<p>摘要: vue3.0教程</p>","more":"<h3 id=\"安装-vue3\"><a href=\"#安装-vue3\" class=\"headerlink\" title=\"安装 vue3\"></a>安装 vue3</h3><h3 id=\"安装-vite\"><a href=\"#安装-vite\" class=\"headerlink\" title=\"安装 vite\"></a>安装 vite</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install -g create-vite-app</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"创建项目\"><a href=\"#创建项目\" class=\"headerlink\" title=\"创建项目\"></a>创建项目</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">create-vite-app projectName</span><br></pre></td></tr></table></figure>\n<p>安装项目依赖</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd project</span><br><span class=\"line\">npm install </span><br><span class=\"line\">npm run dev</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"webpack-创建项目的方法\"><a href=\"#webpack-创建项目的方法\" class=\"headerlink\" title=\"webpack 创建项目的方法\"></a>webpack 创建项目的方法</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git clone https:&#x2F;&#x2F;github.com&#x2F;vuejs&#x2F;vue-next-webpack-preview.git project Nameplates</span><br><span class=\"line\">cd projectName</span><br><span class=\"line\">npm install</span><br><span class=\"line\">npm run dev</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"Vue-Cli-创建项目的方法\"><a href=\"#Vue-Cli-创建项目的方法\" class=\"headerlink\" title=\"Vue-Cli  创建项目的方法\"></a>Vue-Cli  创建项目的方法</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install -g @vue&#x2F;Cli</span><br><span class=\"line\">vue create projectName</span><br><span class=\"line\">cd projectName</span><br><span class=\"line\">vue add vue-next</span><br><span class=\"line\">npm run serve</span><br></pre></td></tr></table></figure>"},{"title":"windows10系统文件修复","date":"2021-06-22T01:45:00.000Z","_content":"\t\n\t\n摘要: win10 系统文件修复\n<!-- more -->\n\n## DISM 和 SFC 检查工具修复系统\n\nWin + S 键搜索栏输入 CMD 找到 “命令提示符”，右键以管理员身份打开，小心复制及贴上执行以下多条命令(需要联网操作，一次一行)\n```\nDISM.exe /Online /Cleanup-Image /ScanHealth\n\nDISM.exe /Online /Cleanup-Image /CheckHealth\n\nDISM.exe /Online /Cleanup-image /Restorehealth\n```\n\n无论上面三条命令是否有显示错误或成功，最后再键入以下命令：\n```\nsfc /scannow\n```\n\n完成后重启","source":"_posts/windows/win10系统文件修复.md","raw":"---\ntitle: windows10系统文件修复\ndate: 2021-06-22 09:45\ncategories:\n- windows\ntags:\n- win10\n---\n\t\n\t\n摘要: win10 系统文件修复\n<!-- more -->\n\n## DISM 和 SFC 检查工具修复系统\n\nWin + S 键搜索栏输入 CMD 找到 “命令提示符”，右键以管理员身份打开，小心复制及贴上执行以下多条命令(需要联网操作，一次一行)\n```\nDISM.exe /Online /Cleanup-Image /ScanHealth\n\nDISM.exe /Online /Cleanup-Image /CheckHealth\n\nDISM.exe /Online /Cleanup-image /Restorehealth\n```\n\n无论上面三条命令是否有显示错误或成功，最后再键入以下命令：\n```\nsfc /scannow\n```\n\n完成后重启","slug":"windows/win10系统文件修复","published":1,"updated":"2021-06-22T01:46:56.580Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cku697a2e00bq00uheb03fkk4","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><p>摘要: win10 系统文件修复</p>\n<span id=\"more\"></span>\n\n<h2 id=\"DISM-和-SFC-检查工具修复系统\"><a href=\"#DISM-和-SFC-检查工具修复系统\" class=\"headerlink\" title=\"DISM 和 SFC 检查工具修复系统\"></a>DISM 和 SFC 检查工具修复系统</h2><p>Win + S 键搜索栏输入 CMD 找到 “命令提示符”，右键以管理员身份打开，小心复制及贴上执行以下多条命令(需要联网操作，一次一行)</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">DISM.exe &#x2F;Online &#x2F;Cleanup-Image &#x2F;ScanHealth</span><br><span class=\"line\"></span><br><span class=\"line\">DISM.exe &#x2F;Online &#x2F;Cleanup-Image &#x2F;CheckHealth</span><br><span class=\"line\"></span><br><span class=\"line\">DISM.exe &#x2F;Online &#x2F;Cleanup-image &#x2F;Restorehealth</span><br></pre></td></tr></table></figure>\n\n<p>无论上面三条命令是否有显示错误或成功，最后再键入以下命令：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sfc &#x2F;scannow</span><br></pre></td></tr></table></figure>\n\n<p>完成后重启</p>\n","site":{"data":{}},"excerpt":"<p>摘要: win10 系统文件修复</p>","more":"<h2 id=\"DISM-和-SFC-检查工具修复系统\"><a href=\"#DISM-和-SFC-检查工具修复系统\" class=\"headerlink\" title=\"DISM 和 SFC 检查工具修复系统\"></a>DISM 和 SFC 检查工具修复系统</h2><p>Win + S 键搜索栏输入 CMD 找到 “命令提示符”，右键以管理员身份打开，小心复制及贴上执行以下多条命令(需要联网操作，一次一行)</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">DISM.exe &#x2F;Online &#x2F;Cleanup-Image &#x2F;ScanHealth</span><br><span class=\"line\"></span><br><span class=\"line\">DISM.exe &#x2F;Online &#x2F;Cleanup-Image &#x2F;CheckHealth</span><br><span class=\"line\"></span><br><span class=\"line\">DISM.exe &#x2F;Online &#x2F;Cleanup-image &#x2F;Restorehealth</span><br></pre></td></tr></table></figure>\n\n<p>无论上面三条命令是否有显示错误或成功，最后再键入以下命令：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sfc &#x2F;scannow</span><br></pre></td></tr></table></figure>\n\n<p>完成后重启</p>"},{"title":"本地搭建CA 证书服务","date":"2019-12-18T02:00:00.000Z","_content":"\n[TOC]\n\n## 一、搭建CA服务\n\nopenssl 默认配置文件: ` /etc/pki/tls/openssl.cnf`\n\n### 1、初始化目录\n\n```shell\n# cd /etc/pki/CA\n# mkdir certs crl newcerts private\n# tree\n.\n|-- certs\n|-- crl\n|-- newcerts\n`-- private\n\n4 directories, 0 files\n```\n\n### 2、创建CA需要的文件\n\n```bash\n# touch index.txt\n# echo 01 > serial\n# ll\ntotal 20\ndrwx--x--x 2 root root 4096 Dec 18 02:59 certs\ndrwx--x--x 2 root root 4096 Dec 18 02:59 crl\n-rw------- 1 root root    0 Dec 18 02:59 index.txt\ndrwx--x--x 2 root root 4096 Dec 18 02:59 newcerts\ndrwx--x--x 2 root root 4096 Dec 18 02:59 private\n-rw------- 1 root root    3 Dec 18 03:00 serial\n```\n\n\n\n### 3、给CA创建私钥\n\n```bash\n# pwd\n/etc/pki/CA\n\n# (umask 066;openssl genrsa -out private/cakey.pem 2048)\nGenerating RSA private key, 2048 bit long modulus\n........+++\n.................+++\ne is 65537 (0x10001)\n\n\n# tree\n.\n|-- certs\n|-- crl\n|-- index.txt\n|-- newcerts\n|-- private\n|   `-- cakey.pem\n`-- serial\n\n4 directories, 3 files\n```\n\n\n\n### 4、给CA生成自签名证书\n\n```\n# openssl req -new -x509 -key private/cakey.pem -days 7300 -out cacert.pem\n\nYou are about to be asked to enter information that will be incorporated\ninto your certificate request.\nWhat you are about to enter is what is called a Distinguished Name or a DN.\nThere are quite a few fields but you can leave some blank\nFor some fields there will be a default value,\nIf you enter '.', the field will be left blank.\n-----\nCountry Name (2 letter code) [CN]:\nState or Province Name (full name) [ZheJiang]:\nLocality Name (eg, city) [HangZhou]:\nOrganization Name (eg, company) [ZTYC]:\nOrganizational Unit Name (eg, section) [ztyc]:\nCommon Name (eg, your name or your server's hostname) []:\nEmail Address []:\n\n# ls\ncacert.pem  certs  crl  index.txt  newcerts  private  serial\n\n```\n\n\n\n## 二、使用CA给客户颁发证书\n\n\n\n### 1、客户机生成私钥\n\n```bash\nclient opt]# (umask 066;openssl genrsa -out wms.qa.ops.com.key 2048)\n\nGenerating RSA private key, 2048 bit long modulus\n..............+++\n.........................................................................+++\ne is 65537 (0x10001)\n\nclient opt]# ls\nwms.qa.ops.com.key\n```\n\n\n\n### 2、生成证书申请文件\n\n```bash\nclient opt]# openssl req -new -key wms.qa.ops.com.key -days 365 -out wms.qa.ops.com.csr\n\nYou are about to be asked to enter information that will be incorporated\ninto your certificate request.\nWhat you are about to enter is what is called a Distinguished Name or a DN.\nThere are quite a few fields but you can leave some blank\nFor some fields there will be a default value,\nIf you enter '.', the field will be left blank.\n-----\nCountry Name (2 letter code) [CN]:\nState or Province Name (full name) [ZheJiang]:\nLocality Name (eg, city) [HangZhou]:\nOrganization Name (eg, company) [ZTYC]:\nOrganizational Unit Name (eg, section) [ztyc]:\nCommon Name (eg, your name or your server's hostname) []:wms.qa.ops.com\nEmail Address []:\n\nPlease enter the following 'extra' attributes\nto be sent with your certificate request\nA challenge password []:\nAn optional company name []:\n\nclient opt]#ls\nwms.qa.ops.com.csr  wms.qa.ops.com.key\n\n```\n\n### 3、将证书申请文件传输到CA服务器上\n\n```bash\n# pwd\n/etc/pki/CA\n\n# ls crl/\nwms.qa.ops.com.csr\n```\n\n\n\n### 4、在CA上给申请签证的客户签署证书\n\n```\n# pwd\n/etc/pki/CA\n\n# openssl ca -in crl/wms.qa.ops.com.csr -out certs/wms.qa.ops.com.crt -days 365\n\nUsing configuration from /etc/pki/tls/openssl.cnf\nCheck that the request matches the signature\nSignature ok\nCertificate Details:\n        Serial Number: 1 (0x1)\n        Validity\n            Not Before: Dec 18 03:33:30 2019 GMT\n            Not After : Dec 17 03:33:30 2020 GMT\n        Subject:\n            countryName               = CN\n            stateOrProvinceName       = ZheJiang\n            organizationName          = ZTYC\n            organizationalUnitName    = ztyc\n            commonName                = wms.qa.ops.com\n        X509v3 extensions:\n            X509v3 Basic Constraints: \n                CA:FALSE\n            Netscape Comment: \n                OpenSSL Generated Certificate\n            X509v3 Subject Key Identifier: \n                B2:35:6B:B9:16:86:4C:76:99:C8:27:64:7A:60:FC:B0:82:59:64:8A\n            X509v3 Authority Key Identifier: \n                keyid:70:EB:D1:7E:7A:D0:29:AE:65:10:73:D3:16:7D:6C:CD:12:C8:F1:FB\n\nCertificate is to be certified until Dec 17 03:33:30 2020 GMT (365 days)\nSign the certificate? [y/n]:y\n\n\n1 out of 1 certificate requests certified, commit? [y/n]y\nWrite out database with 1 new entries\nData Base Updated\n\n\n```\n\n\n\n### 5、将CA上将签署好的证书传输给申请的客户\n\n```bash\nclient opt]# ls \nwms.qa.ops.com.crt  wms.qa.ops.com.csr  wms.qa.ops.com.key\n\n```\n\n### 6、查看颁发的证书\n\n```bash\nclient opt]# openssl x509 -in wms.qa.ops.com.crt -noout -text\n\nCertificate:\n    Data:\n        Version: 3 (0x2)\n        Serial Number: 1 (0x1)\n    Signature Algorithm: sha256WithRSAEncryption\n        Issuer: C=CN, ST=ZheJiang, L=HangZhou, O=ZTYC, OU=ztyc\n        Validity\n            Not Before: Dec 18 03:33:30 2019 GMT\n            Not After : Dec 17 03:33:30 2020 GMT\n        Subject: C=CN, ST=ZheJiang, O=ZTYC, OU=ztyc, CN=wms.qa.ops.com\n        Subject Public Key Info:\n            Public Key Algorithm: rsaEncryption\n                Public-Key: (2048 bit)\n                Modulus:\n                    00:b9:20:cf:dc:bc:d4:06:b6:a0:15:1a:22:52:21:\n                    1f:64:c1:81:90:47:83:70:21:00:0a:ba:2a:ac:00:\n                    22:3d:3d:c3:d7:4a:2c:51:11:5e:df:e8:6c:41:2e:\n.....\n.....\n\n```\n\n### 7、crt转pem格式\n\n```bash\nclient opt]# openssl x509 -in wms.qa.ops.com.crt -inform DER -outform PEM -out wms.qa.ops.com.pem\nclient opt]# ls\nwms.qa.ops.com.crt  wms.qa.ops.com.csr  wms.qa.ops.com.key  wms.qa.ops.com.pem\n```\n\n### 8、证书转换为PKCS12文件\n\n```shell\nclient opt]# openssl pkcs12 -export -clcerts -in wms.qa.ops.com.crt \\\n-inkey wms.qa.ops.com.key -out wms.qa.ops.com.key.p12\nclient opt]# ls\nwms.qa.ops.com.crt  wms.qa.ops.com.csr  wms.qa.ops.com.key  wms.qa.ops.com.pem   wms.qa.ops.com.key.p12\n```\n\n\n\n## 三、CA上吊销证书\n\n### 查看证书的serial以及subject信息\n\n1、在申请吊销证书的客户机上查看需要吊销的证书的serial以及subject信息，并提交给CA\n\n```bash\nclient opt]# openssl x509 -in qa.ops.com.crt -noout -serial -subject\nserial=03\nsubject= /C=CN/ST=ZheJiang/O=ZTYC/OU=ops/CN=qa.ops.com/emailAddress=ops@ztyc.com\n```\n\n2、在CA上根据客户提交的serial以及subject信息，比对服务器上index.txt文件中的信息一致后，执行吊销证书操作\n\n```bash\n# pwd\n/etc/pki/CA\n\n# openssl x509 -in certs/qa.ops.com.crt -noout -serial -subject\nserial=03\nsubject= /C=CN/ST=ZheJiang/O=ZTYC/OU=ops/CN=qa.ops.com/emailAddress=ops@ztyc.com\n\n# cat index.txt\n\nV\t291215081847Z\t\t03\tunknown\t/C=CN/ST=ZheJiang/O=ZTYC/OU=ops/CN=qa.ops.com/emailAddress=ops@ztyc.com\n```\n\n3、信息确认一致，正式执行吊销操作\n\n```bash\n# openssl ca -revoke newcerts/03.pem \nUsing configuration from /etc/pki/tls/openssl.cnf\nRevoking Certificate 03.\nData Base Updated\n\n```\n\n4、生成吊销证书的编号（第一次吊销证书时才需要执行本操作)\n\n```bash\n# pwd\n/etc/pki/CA\n\n# echo 01 > crlnumber\n\n# openssl ca -gencrl -out crl/qa.ops.com.csr \nUsing configuration from /etc/pki/tls/openssl.cnf\n\n# openssl crl -in crl/qa.ops.com.csr -noout -text\nCertificate Revocation List (CRL):\n        Version 2 (0x1)\n    Signature Algorithm: sha256WithRSAEncryption\n        Issuer: /C=CN/ST=ZheJiang/L=HangZhou/O=ZTYC/OU=ztyc\n        Last Update: Dec 18 08:32:01 2019 GMT\n        Next Update: Jan 17 08:32:01 2020 GMT\n        CRL extensions:\n            X509v3 CRL Number: \n                1\nRevoked Certificates:\n    Serial Number: 01\n        Revocation Date: Dec 18 08:29:24 2019 GMT\n    Serial Number: 03\n        Revocation Date: Dec 18 08:29:31 2019 GMT\n    Signature Algorithm: sha256WithRSAEncryption\n         5e:68:d9:a1:ef:1d:7f:83:23:a4:57:95:19:1b:7a:36:82:cc:\n         3a:2a:73:d8:1d:77:03:1a:e5:fd:5d:40:a8:e2:0a:af:34:d7:\n         04:e5:7e:a8:c6:58:36:34:33:d7:79:bf:e0:07:29:f3:72:5b:\n         e8:5d:f4:06:ba:e3:1f:00:2e:f5:4b:47:18:7c:e1:0d:00:3e:\n         2e:13:eb:57:06:be:7f:48:5a:13:ef:62:cc:1e:92:76:22:f3:\n         c2:6b:d0:12:e0:26:4c:33:be:fe:fd:14:de:77:da:6a:20:ce:\n         f5:41:6e:e7:f1:e0:5d:d1:4f:91:e3:97:49:0d:a4:c9:0d:c4:\n         cd:3a:51:5f:31:5b:ed:fc:55:9f:6b:9c:72:c9:7d:92:25:7b:\n         e8:ec:e0:96:b6:98:96:ac:b7:63:40:d5:ec:b7:09:74:e9:c0:\n         96:b6:2c:55:4b:de:fa:fa:2c:74:2e:f8:96:2e:4f:bc:5f:d2:\n         0b:15:1a:6d:1f:e7:1e:8b:d3:af:51:d6:ca:2d:90:9f:9f:03:\n         c2:da:03:f7:0f:a5:6a:e4:f7:3d:25:a1:06:05:c4:de:5e:62:\n         5e:a5:7d:25:7e:9c:16:82:7f:21:28:d0:a3:d6:5c:e7:26:48:\n         03:e0:93:84:fb:f3:b3:0a:d9:e6:35:3e:ae:d7:9f:65:b5:b6:\n         fa:6a:69:67\n\n```\n\n## 四、在浏览器中访问\n\n在浏览器中打开https://<domain_name>来访问。\n\n在Firefox浏览器中可以添加 Security Exception 来忽略HTTPS错误警告。\n\nChrome浏览器可以尝试通过导入CA证书的方式来忽略HTTPS错误警告。\n\n>注意：Chrome 浏览器可能有导入CA证书后仍然无法访问的问题；不同浏览器对自签名SSL证书的检查和限制也有所区别。\n\n\n\n## 五、脚本\n\n### 一、结合上面文档使用\n\n```shell\n#!/bin/bash -e\n\nSSL_IP=''\nSSL_DNS='wms.qa.opt.com'\nCN=${SSL_DNS}\nSSL_SIZE=2048\n\nDATE=${DATE:-3650}\n\nSSL_CONFIG='openssl.cnf'\nSSL_SUBJECT=\"/C=CN/ST=ZheJiang/L=HangZhou/O=ZTYC/OU=ops/CN=${CN}/emailAddress=ops@ztyc.com\"\nCA_DIR='/etc/pki/CA'\n\nif [[ -z $SILENT ]]; then\necho \"----------------------------\"\necho \"| SSL Cert Generator |\"\necho \"----------------------------\"\necho\nfi\n\nexport SSL_DNS=${SSL_DNS}\nexport SSL_IP=${SSL_IP}\nexport SSL_KEY=$CN.key\nexport SSL_CSR=$CN.csr\nexport SSL_SUBJECT=${SSL_SUBJECT}\nexport CA_DIR=${CA_DIR}\nexport SSL_CERT=$CN.crt\nexport SSL_PEM=$CN.pem\n\ndir=$(pwd)\necho -e \"The current working directory is \\033[36m ${dir} \\033[0m\"\n\necho \"====> Generating new config file ${SSL_CONFIG}\"\ncat > ${SSL_CONFIG} <<EOM\n[req]\nreq_extensions = v3_req\ndistinguished_name = req_distinguished_name\n[req_distinguished_name]\n[ v3_req ]\nbasicConstraints = CA:FALSE\nkeyUsage = nonRepudiation, digitalSignature, keyEncipherment\nextendedKeyUsage = clientAuth, serverAuth\nEOM\n\nif [[ -n ${SSL_DNS} || -n ${SSL_IP} ]]; then\ncat >> ${SSL_CONFIG} <<EOM\nsubjectAltName = @alt_names\n[alt_names]\nEOM\n    IFS=\",\"\n    dns=(${SSL_DNS})\n    for i in \"${!dns[@]}\"; do\n      echo DNS.$((i+1)) = ${dns[$i]} >> ${SSL_CONFIG}\n    done\n\n    if [[ -n ${SSL_IP} ]]; then\n        ip=(${SSL_IP})\n        for i in \"${!ip[@]}\"; do\n          echo IP.$((i+1)) = ${ip[$i]} >> ${SSL_CONFIG}\n        done\n    fi\nfi\n\n[[ -z $SILENT ]] && echo \"====> Generating new SSL KEY ${SSL_KEY}\"\necho -e \"\\033[36m openssl genrsa -out ${SSL_KEY} ${SSL_SIZE} \\033[0m\"\nopenssl genrsa -out ${SSL_KEY} ${SSL_SIZE} > /dev/null || exit 1\n\n[[ -z $SILENT ]] && echo \"====> Generating new SSL CSR ${SSL_CSR}\"\necho -e \"\\033[36m openssl req -sha256 -new -key ${SSL_KEY} -out ${SSL_CSR} -subj \\\"${SSL_SUBJECT}\\\" -config ${SSL_CONFIG} \\033[0m\"\nopenssl req -sha256 -new -key ${SSL_KEY} -out ${SSL_CSR} \\\n-subj \"${SSL_SUBJECT}\" -config ${SSL_CONFIG} > /dev/null || exit 1\n\n[[ -z $SILENT ]] && echo \"====> Generating new SSL CERT ${SSL_CERT}\"\n\\cp ${SSL_CSR} ${CA_DIR}/crl\ncd ${CA_DIR}\necho -e \"The current working directory is \\033[36m $(pwd)\\033[0m\"\necho -e \"\\033[36m openssl ca -in crl/${SSL_CSR} -out certs/${SSL_CERT}  -days ${DATE} \\033[0m\"\n#openssl ca -in crl/${SSL_CSR} -out certs/${SSL_CERT}  -days ${DATE}  || exit 1\n/usr/bin/expect <<END\n  spawn openssl ca -in crl/${SSL_CSR} -out certs/${SSL_CERT}  -days ${DATE}\n  expect {\n    \"*y/n]:\" {send \"y\\r\";exp_continue}\n    \"*y/n]\" {send \"y\\r\";exp_continue}\n  }\nEND\n\\cp certs/${SSL_CERT} ${dir}\ncd ${dir}\n\necho -e \"The current working directory is \\033[36m $(pwd)\\033[0m\"\necho -e \"\\033[36m openssl x509 -in ${SSL_CERT} -out ${SSL_PEM} -outform PEM \\033[0m\"\nopenssl x509 -in ${SSL_CERT}  -out ${SSL_PEM} -outform PEM\nls\n\n\nif [[ -z $SILENT ]]; then\necho \"====> Complete\"\necho -e \"keys can be found in volume mapped to \\033[36m $(pwd)\\033[0m\"\necho\necho \"====> Output results as YAML\"\nopenssl x509 -in ${SSL_CERT} -noout -text\nfi\n\n```\n\n### 二、独立使用\n\n```shell\n#!/bin/bash -e\n\n# * 为必改项\n# * 更换为你自己的域名\nCN='' # 例如: demo.rancher.com\n\n# 扩展信任IP或域名\n## 一般ssl证书只信任域名的访问请求，有时候需要使用ip去访问server，那么需要给ssl证书添加扩展IP，\n## 多个IP用逗号隔开。如果想多个域名访问，则添加扩展域名（SSL_DNS）,多个SSL_DNS用逗号隔开\nSSL_IP='' # 例如: 1.2.3.4\nSSL_DNS='' # 例如: demo.rancher.com\n\n# 国家名(2个字母的代号)\nC=CN\n\n# 证书加密位数\nSSL_SIZE=2048\n\n# 证书有效期\nDATE=${DATE:-3650}\n\n# 配置文件\nSSL_CONFIG='openssl.cnf'\n\nif [[ -z $SILENT ]]; then\necho \"----------------------------\"\necho \"| SSL Cert Generator |\"\necho \"----------------------------\"\necho\nfi\n\nexport CA_KEY=${CA_KEY-\"cakey.pem\"}\nexport CA_CERT=${CA_CERT-\"cacerts.pem\"}\nexport CA_SUBJECT=ca-$CN\nexport CA_EXPIRE=${DATE}\n\nexport SSL_CONFIG=${SSL_CONFIG}\nexport SSL_KEY=$CN.key\nexport SSL_CSR=$CN.csr\nexport SSL_CERT=$CN.crt\nexport SSL_EXPIRE=${DATE}\n\nexport SSL_SUBJECT=${CN}\nexport SSL_DNS=${SSL_DNS}\nexport SSL_IP=${SSL_IP}\n\nexport K8S_SECRET_COMBINE_CA=${K8S_SECRET_COMBINE_CA:-'true'}\n\n[[ -z $SILENT ]] && echo \"--> Certificate Authority\"\n\nif [[ -e ./${CA_KEY} ]]; then\n    [[ -z $SILENT ]] && echo \"====> Using existing CA Key ${CA_KEY}\"\nelse\n    [[ -z $SILENT ]] && echo \"====> Generating new CA key ${CA_KEY}\"\n    openssl genrsa -out ${CA_KEY} ${SSL_SIZE} > /dev/null\nfi\n\nif [[ -e ./${CA_CERT} ]]; then\n    [[ -z $SILENT ]] && echo \"====> Using existing CA Certificate ${CA_CERT}\"\nelse\n    [[ -z $SILENT ]] && echo \"====> Generating new CA Certificate ${CA_CERT}\"\n    openssl req -x509 -sha256 -new -nodes -key ${CA_KEY} \\\n    -days ${CA_EXPIRE} -out ${CA_CERT} -subj \"/CN=${CA_SUBJECT}\" > /dev/null || exit 1\nfi\n\necho \"====> Generating new config file ${SSL_CONFIG}\"\ncat > ${SSL_CONFIG} <<EOM\n[req]\nreq_extensions = v3_req\ndistinguished_name = req_distinguished_name\n[req_distinguished_name]\n[ v3_req ]\nbasicConstraints = CA:FALSE\nkeyUsage = nonRepudiation, digitalSignature, keyEncipherment\nextendedKeyUsage = clientAuth, serverAuth\nEOM\n\nif [[ -n ${SSL_DNS} || -n ${SSL_IP} ]]; then\n    cat >> ${SSL_CONFIG} <<EOM\nsubjectAltName = @alt_names\n[alt_names]\nEOM\n    IFS=\",\"\n    dns=(${SSL_DNS})\n    dns+=(${SSL_SUBJECT})\n    for i in \"${!dns[@]}\"; do\n      echo DNS.$((i+1)) = ${dns[$i]} >> ${SSL_CONFIG}\n    done\n\n    if [[ -n ${SSL_IP} ]]; then\n        ip=(${SSL_IP})\n        for i in \"${!ip[@]}\"; do\n          echo IP.$((i+1)) = ${ip[$i]} >> ${SSL_CONFIG}\n        done\n    fi\nfi\n\n[[ -z $SILENT ]] && echo \"====> Generating new SSL KEY ${SSL_KEY}\"\nopenssl genrsa -out ${SSL_KEY} ${SSL_SIZE} > /dev/null || exit 1\n\n[[ -z $SILENT ]] && echo \"====> Generating new SSL CSR ${SSL_CSR}\"\nopenssl req -sha256 -new -key ${SSL_KEY} -out ${SSL_CSR} \\\n-subj \"/CN=${SSL_SUBJECT}\" -config ${SSL_CONFIG} > /dev/null || exit 1\n\n[[ -z $SILENT ]] && echo \"====> Generating new SSL CERT ${SSL_CERT}\"\nopenssl x509 -sha256 -req -in ${SSL_CSR} -CA ${CA_CERT} \\\n    -CAkey ${CA_KEY} -CAcreateserial -out ${SSL_CERT} \\\n    -days ${SSL_EXPIRE} -extensions v3_req \\\n    -extfile ${SSL_CONFIG} > /dev/null || exit 1\n\nif [[ -z $SILENT ]]; then\necho \"====> Complete\"\necho \"keys can be found in volume mapped to $(pwd)\"\necho\necho \"====> Output results as YAML\"\necho \"---\"\necho \"ca_key: |\"\ncat $CA_KEY | sed 's/^/  /'\necho\necho \"ca_cert: |\"\ncat $CA_CERT | sed 's/^/  /'\necho\necho \"ssl_key: |\"\ncat $SSL_KEY | sed 's/^/  /'\necho\necho \"ssl_csr: |\"\ncat $SSL_CSR | sed 's/^/  /'\necho\necho \"ssl_cert: |\"\ncat $SSL_CERT | sed 's/^/  /'\necho\nfi\n\nif [[ -n $K8S_SECRET_NAME ]]; then\n\n  if [[ -n $K8S_SECRET_COMBINE_CA ]]; then\n    [[ -z $SILENT ]] && echo \"====> Adding CA to Cert file\"\n    cat ${CA_CERT} >> ${SSL_CERT}\n  fi\n\n  [[ -z $SILENT ]] && echo \"====> Creating Kubernetes secret: $K8S_SECRET_NAME\"\n  kubectl delete secret $K8S_SECRET_NAME --ignore-not-found\n\n  if [[ -n $K8S_SECRET_SEPARATE_CA ]]; then\n    kubectl create secret generic \\\n    $K8S_SECRET_NAME \\\n    --from-file=\"tls.crt=${SSL_CERT}\" \\\n    --from-file=\"tls.key=${SSL_KEY}\" \\\n    --from-file=\"ca.crt=${CA_CERT}\"\n  else\n    kubectl create secret tls \\\n    $K8S_SECRET_NAME \\\n    --cert=${SSL_CERT} \\\n    --key=${SSL_KEY}\n  fi\n\n  if [[ -n $K8S_SECRET_LABELS ]]; then\n    [[ -z $SILENT ]] && echo \"====> Labeling Kubernetes secret\"\n    IFS=$' \\n\\t' # We have to reset IFS or label secret will misbehave on some systems\n    kubectl label secret \\\n      $K8S_SECRET_NAME \\\n      $K8S_SECRET_LABELS\n  fi\nfi\n\necho \"4. 重命名服务证书\"\nmv ${CN}.key tls.key\nmv ${CN}.crt tls.crt\n```\n\n","source":"_posts/CA证书服务.md","raw":"---\ntitle: 本地搭建CA 证书服务\ndate: 2019-12-18 10:00:00\ncategories: \n- linux\ntags:\n- ca\n- ssl\n---\n\n[TOC]\n\n## 一、搭建CA服务\n\nopenssl 默认配置文件: ` /etc/pki/tls/openssl.cnf`\n\n### 1、初始化目录\n\n```shell\n# cd /etc/pki/CA\n# mkdir certs crl newcerts private\n# tree\n.\n|-- certs\n|-- crl\n|-- newcerts\n`-- private\n\n4 directories, 0 files\n```\n\n### 2、创建CA需要的文件\n\n```bash\n# touch index.txt\n# echo 01 > serial\n# ll\ntotal 20\ndrwx--x--x 2 root root 4096 Dec 18 02:59 certs\ndrwx--x--x 2 root root 4096 Dec 18 02:59 crl\n-rw------- 1 root root    0 Dec 18 02:59 index.txt\ndrwx--x--x 2 root root 4096 Dec 18 02:59 newcerts\ndrwx--x--x 2 root root 4096 Dec 18 02:59 private\n-rw------- 1 root root    3 Dec 18 03:00 serial\n```\n\n\n\n### 3、给CA创建私钥\n\n```bash\n# pwd\n/etc/pki/CA\n\n# (umask 066;openssl genrsa -out private/cakey.pem 2048)\nGenerating RSA private key, 2048 bit long modulus\n........+++\n.................+++\ne is 65537 (0x10001)\n\n\n# tree\n.\n|-- certs\n|-- crl\n|-- index.txt\n|-- newcerts\n|-- private\n|   `-- cakey.pem\n`-- serial\n\n4 directories, 3 files\n```\n\n\n\n### 4、给CA生成自签名证书\n\n```\n# openssl req -new -x509 -key private/cakey.pem -days 7300 -out cacert.pem\n\nYou are about to be asked to enter information that will be incorporated\ninto your certificate request.\nWhat you are about to enter is what is called a Distinguished Name or a DN.\nThere are quite a few fields but you can leave some blank\nFor some fields there will be a default value,\nIf you enter '.', the field will be left blank.\n-----\nCountry Name (2 letter code) [CN]:\nState or Province Name (full name) [ZheJiang]:\nLocality Name (eg, city) [HangZhou]:\nOrganization Name (eg, company) [ZTYC]:\nOrganizational Unit Name (eg, section) [ztyc]:\nCommon Name (eg, your name or your server's hostname) []:\nEmail Address []:\n\n# ls\ncacert.pem  certs  crl  index.txt  newcerts  private  serial\n\n```\n\n\n\n## 二、使用CA给客户颁发证书\n\n\n\n### 1、客户机生成私钥\n\n```bash\nclient opt]# (umask 066;openssl genrsa -out wms.qa.ops.com.key 2048)\n\nGenerating RSA private key, 2048 bit long modulus\n..............+++\n.........................................................................+++\ne is 65537 (0x10001)\n\nclient opt]# ls\nwms.qa.ops.com.key\n```\n\n\n\n### 2、生成证书申请文件\n\n```bash\nclient opt]# openssl req -new -key wms.qa.ops.com.key -days 365 -out wms.qa.ops.com.csr\n\nYou are about to be asked to enter information that will be incorporated\ninto your certificate request.\nWhat you are about to enter is what is called a Distinguished Name or a DN.\nThere are quite a few fields but you can leave some blank\nFor some fields there will be a default value,\nIf you enter '.', the field will be left blank.\n-----\nCountry Name (2 letter code) [CN]:\nState or Province Name (full name) [ZheJiang]:\nLocality Name (eg, city) [HangZhou]:\nOrganization Name (eg, company) [ZTYC]:\nOrganizational Unit Name (eg, section) [ztyc]:\nCommon Name (eg, your name or your server's hostname) []:wms.qa.ops.com\nEmail Address []:\n\nPlease enter the following 'extra' attributes\nto be sent with your certificate request\nA challenge password []:\nAn optional company name []:\n\nclient opt]#ls\nwms.qa.ops.com.csr  wms.qa.ops.com.key\n\n```\n\n### 3、将证书申请文件传输到CA服务器上\n\n```bash\n# pwd\n/etc/pki/CA\n\n# ls crl/\nwms.qa.ops.com.csr\n```\n\n\n\n### 4、在CA上给申请签证的客户签署证书\n\n```\n# pwd\n/etc/pki/CA\n\n# openssl ca -in crl/wms.qa.ops.com.csr -out certs/wms.qa.ops.com.crt -days 365\n\nUsing configuration from /etc/pki/tls/openssl.cnf\nCheck that the request matches the signature\nSignature ok\nCertificate Details:\n        Serial Number: 1 (0x1)\n        Validity\n            Not Before: Dec 18 03:33:30 2019 GMT\n            Not After : Dec 17 03:33:30 2020 GMT\n        Subject:\n            countryName               = CN\n            stateOrProvinceName       = ZheJiang\n            organizationName          = ZTYC\n            organizationalUnitName    = ztyc\n            commonName                = wms.qa.ops.com\n        X509v3 extensions:\n            X509v3 Basic Constraints: \n                CA:FALSE\n            Netscape Comment: \n                OpenSSL Generated Certificate\n            X509v3 Subject Key Identifier: \n                B2:35:6B:B9:16:86:4C:76:99:C8:27:64:7A:60:FC:B0:82:59:64:8A\n            X509v3 Authority Key Identifier: \n                keyid:70:EB:D1:7E:7A:D0:29:AE:65:10:73:D3:16:7D:6C:CD:12:C8:F1:FB\n\nCertificate is to be certified until Dec 17 03:33:30 2020 GMT (365 days)\nSign the certificate? [y/n]:y\n\n\n1 out of 1 certificate requests certified, commit? [y/n]y\nWrite out database with 1 new entries\nData Base Updated\n\n\n```\n\n\n\n### 5、将CA上将签署好的证书传输给申请的客户\n\n```bash\nclient opt]# ls \nwms.qa.ops.com.crt  wms.qa.ops.com.csr  wms.qa.ops.com.key\n\n```\n\n### 6、查看颁发的证书\n\n```bash\nclient opt]# openssl x509 -in wms.qa.ops.com.crt -noout -text\n\nCertificate:\n    Data:\n        Version: 3 (0x2)\n        Serial Number: 1 (0x1)\n    Signature Algorithm: sha256WithRSAEncryption\n        Issuer: C=CN, ST=ZheJiang, L=HangZhou, O=ZTYC, OU=ztyc\n        Validity\n            Not Before: Dec 18 03:33:30 2019 GMT\n            Not After : Dec 17 03:33:30 2020 GMT\n        Subject: C=CN, ST=ZheJiang, O=ZTYC, OU=ztyc, CN=wms.qa.ops.com\n        Subject Public Key Info:\n            Public Key Algorithm: rsaEncryption\n                Public-Key: (2048 bit)\n                Modulus:\n                    00:b9:20:cf:dc:bc:d4:06:b6:a0:15:1a:22:52:21:\n                    1f:64:c1:81:90:47:83:70:21:00:0a:ba:2a:ac:00:\n                    22:3d:3d:c3:d7:4a:2c:51:11:5e:df:e8:6c:41:2e:\n.....\n.....\n\n```\n\n### 7、crt转pem格式\n\n```bash\nclient opt]# openssl x509 -in wms.qa.ops.com.crt -inform DER -outform PEM -out wms.qa.ops.com.pem\nclient opt]# ls\nwms.qa.ops.com.crt  wms.qa.ops.com.csr  wms.qa.ops.com.key  wms.qa.ops.com.pem\n```\n\n### 8、证书转换为PKCS12文件\n\n```shell\nclient opt]# openssl pkcs12 -export -clcerts -in wms.qa.ops.com.crt \\\n-inkey wms.qa.ops.com.key -out wms.qa.ops.com.key.p12\nclient opt]# ls\nwms.qa.ops.com.crt  wms.qa.ops.com.csr  wms.qa.ops.com.key  wms.qa.ops.com.pem   wms.qa.ops.com.key.p12\n```\n\n\n\n## 三、CA上吊销证书\n\n### 查看证书的serial以及subject信息\n\n1、在申请吊销证书的客户机上查看需要吊销的证书的serial以及subject信息，并提交给CA\n\n```bash\nclient opt]# openssl x509 -in qa.ops.com.crt -noout -serial -subject\nserial=03\nsubject= /C=CN/ST=ZheJiang/O=ZTYC/OU=ops/CN=qa.ops.com/emailAddress=ops@ztyc.com\n```\n\n2、在CA上根据客户提交的serial以及subject信息，比对服务器上index.txt文件中的信息一致后，执行吊销证书操作\n\n```bash\n# pwd\n/etc/pki/CA\n\n# openssl x509 -in certs/qa.ops.com.crt -noout -serial -subject\nserial=03\nsubject= /C=CN/ST=ZheJiang/O=ZTYC/OU=ops/CN=qa.ops.com/emailAddress=ops@ztyc.com\n\n# cat index.txt\n\nV\t291215081847Z\t\t03\tunknown\t/C=CN/ST=ZheJiang/O=ZTYC/OU=ops/CN=qa.ops.com/emailAddress=ops@ztyc.com\n```\n\n3、信息确认一致，正式执行吊销操作\n\n```bash\n# openssl ca -revoke newcerts/03.pem \nUsing configuration from /etc/pki/tls/openssl.cnf\nRevoking Certificate 03.\nData Base Updated\n\n```\n\n4、生成吊销证书的编号（第一次吊销证书时才需要执行本操作)\n\n```bash\n# pwd\n/etc/pki/CA\n\n# echo 01 > crlnumber\n\n# openssl ca -gencrl -out crl/qa.ops.com.csr \nUsing configuration from /etc/pki/tls/openssl.cnf\n\n# openssl crl -in crl/qa.ops.com.csr -noout -text\nCertificate Revocation List (CRL):\n        Version 2 (0x1)\n    Signature Algorithm: sha256WithRSAEncryption\n        Issuer: /C=CN/ST=ZheJiang/L=HangZhou/O=ZTYC/OU=ztyc\n        Last Update: Dec 18 08:32:01 2019 GMT\n        Next Update: Jan 17 08:32:01 2020 GMT\n        CRL extensions:\n            X509v3 CRL Number: \n                1\nRevoked Certificates:\n    Serial Number: 01\n        Revocation Date: Dec 18 08:29:24 2019 GMT\n    Serial Number: 03\n        Revocation Date: Dec 18 08:29:31 2019 GMT\n    Signature Algorithm: sha256WithRSAEncryption\n         5e:68:d9:a1:ef:1d:7f:83:23:a4:57:95:19:1b:7a:36:82:cc:\n         3a:2a:73:d8:1d:77:03:1a:e5:fd:5d:40:a8:e2:0a:af:34:d7:\n         04:e5:7e:a8:c6:58:36:34:33:d7:79:bf:e0:07:29:f3:72:5b:\n         e8:5d:f4:06:ba:e3:1f:00:2e:f5:4b:47:18:7c:e1:0d:00:3e:\n         2e:13:eb:57:06:be:7f:48:5a:13:ef:62:cc:1e:92:76:22:f3:\n         c2:6b:d0:12:e0:26:4c:33:be:fe:fd:14:de:77:da:6a:20:ce:\n         f5:41:6e:e7:f1:e0:5d:d1:4f:91:e3:97:49:0d:a4:c9:0d:c4:\n         cd:3a:51:5f:31:5b:ed:fc:55:9f:6b:9c:72:c9:7d:92:25:7b:\n         e8:ec:e0:96:b6:98:96:ac:b7:63:40:d5:ec:b7:09:74:e9:c0:\n         96:b6:2c:55:4b:de:fa:fa:2c:74:2e:f8:96:2e:4f:bc:5f:d2:\n         0b:15:1a:6d:1f:e7:1e:8b:d3:af:51:d6:ca:2d:90:9f:9f:03:\n         c2:da:03:f7:0f:a5:6a:e4:f7:3d:25:a1:06:05:c4:de:5e:62:\n         5e:a5:7d:25:7e:9c:16:82:7f:21:28:d0:a3:d6:5c:e7:26:48:\n         03:e0:93:84:fb:f3:b3:0a:d9:e6:35:3e:ae:d7:9f:65:b5:b6:\n         fa:6a:69:67\n\n```\n\n## 四、在浏览器中访问\n\n在浏览器中打开https://<domain_name>来访问。\n\n在Firefox浏览器中可以添加 Security Exception 来忽略HTTPS错误警告。\n\nChrome浏览器可以尝试通过导入CA证书的方式来忽略HTTPS错误警告。\n\n>注意：Chrome 浏览器可能有导入CA证书后仍然无法访问的问题；不同浏览器对自签名SSL证书的检查和限制也有所区别。\n\n\n\n## 五、脚本\n\n### 一、结合上面文档使用\n\n```shell\n#!/bin/bash -e\n\nSSL_IP=''\nSSL_DNS='wms.qa.opt.com'\nCN=${SSL_DNS}\nSSL_SIZE=2048\n\nDATE=${DATE:-3650}\n\nSSL_CONFIG='openssl.cnf'\nSSL_SUBJECT=\"/C=CN/ST=ZheJiang/L=HangZhou/O=ZTYC/OU=ops/CN=${CN}/emailAddress=ops@ztyc.com\"\nCA_DIR='/etc/pki/CA'\n\nif [[ -z $SILENT ]]; then\necho \"----------------------------\"\necho \"| SSL Cert Generator |\"\necho \"----------------------------\"\necho\nfi\n\nexport SSL_DNS=${SSL_DNS}\nexport SSL_IP=${SSL_IP}\nexport SSL_KEY=$CN.key\nexport SSL_CSR=$CN.csr\nexport SSL_SUBJECT=${SSL_SUBJECT}\nexport CA_DIR=${CA_DIR}\nexport SSL_CERT=$CN.crt\nexport SSL_PEM=$CN.pem\n\ndir=$(pwd)\necho -e \"The current working directory is \\033[36m ${dir} \\033[0m\"\n\necho \"====> Generating new config file ${SSL_CONFIG}\"\ncat > ${SSL_CONFIG} <<EOM\n[req]\nreq_extensions = v3_req\ndistinguished_name = req_distinguished_name\n[req_distinguished_name]\n[ v3_req ]\nbasicConstraints = CA:FALSE\nkeyUsage = nonRepudiation, digitalSignature, keyEncipherment\nextendedKeyUsage = clientAuth, serverAuth\nEOM\n\nif [[ -n ${SSL_DNS} || -n ${SSL_IP} ]]; then\ncat >> ${SSL_CONFIG} <<EOM\nsubjectAltName = @alt_names\n[alt_names]\nEOM\n    IFS=\",\"\n    dns=(${SSL_DNS})\n    for i in \"${!dns[@]}\"; do\n      echo DNS.$((i+1)) = ${dns[$i]} >> ${SSL_CONFIG}\n    done\n\n    if [[ -n ${SSL_IP} ]]; then\n        ip=(${SSL_IP})\n        for i in \"${!ip[@]}\"; do\n          echo IP.$((i+1)) = ${ip[$i]} >> ${SSL_CONFIG}\n        done\n    fi\nfi\n\n[[ -z $SILENT ]] && echo \"====> Generating new SSL KEY ${SSL_KEY}\"\necho -e \"\\033[36m openssl genrsa -out ${SSL_KEY} ${SSL_SIZE} \\033[0m\"\nopenssl genrsa -out ${SSL_KEY} ${SSL_SIZE} > /dev/null || exit 1\n\n[[ -z $SILENT ]] && echo \"====> Generating new SSL CSR ${SSL_CSR}\"\necho -e \"\\033[36m openssl req -sha256 -new -key ${SSL_KEY} -out ${SSL_CSR} -subj \\\"${SSL_SUBJECT}\\\" -config ${SSL_CONFIG} \\033[0m\"\nopenssl req -sha256 -new -key ${SSL_KEY} -out ${SSL_CSR} \\\n-subj \"${SSL_SUBJECT}\" -config ${SSL_CONFIG} > /dev/null || exit 1\n\n[[ -z $SILENT ]] && echo \"====> Generating new SSL CERT ${SSL_CERT}\"\n\\cp ${SSL_CSR} ${CA_DIR}/crl\ncd ${CA_DIR}\necho -e \"The current working directory is \\033[36m $(pwd)\\033[0m\"\necho -e \"\\033[36m openssl ca -in crl/${SSL_CSR} -out certs/${SSL_CERT}  -days ${DATE} \\033[0m\"\n#openssl ca -in crl/${SSL_CSR} -out certs/${SSL_CERT}  -days ${DATE}  || exit 1\n/usr/bin/expect <<END\n  spawn openssl ca -in crl/${SSL_CSR} -out certs/${SSL_CERT}  -days ${DATE}\n  expect {\n    \"*y/n]:\" {send \"y\\r\";exp_continue}\n    \"*y/n]\" {send \"y\\r\";exp_continue}\n  }\nEND\n\\cp certs/${SSL_CERT} ${dir}\ncd ${dir}\n\necho -e \"The current working directory is \\033[36m $(pwd)\\033[0m\"\necho -e \"\\033[36m openssl x509 -in ${SSL_CERT} -out ${SSL_PEM} -outform PEM \\033[0m\"\nopenssl x509 -in ${SSL_CERT}  -out ${SSL_PEM} -outform PEM\nls\n\n\nif [[ -z $SILENT ]]; then\necho \"====> Complete\"\necho -e \"keys can be found in volume mapped to \\033[36m $(pwd)\\033[0m\"\necho\necho \"====> Output results as YAML\"\nopenssl x509 -in ${SSL_CERT} -noout -text\nfi\n\n```\n\n### 二、独立使用\n\n```shell\n#!/bin/bash -e\n\n# * 为必改项\n# * 更换为你自己的域名\nCN='' # 例如: demo.rancher.com\n\n# 扩展信任IP或域名\n## 一般ssl证书只信任域名的访问请求，有时候需要使用ip去访问server，那么需要给ssl证书添加扩展IP，\n## 多个IP用逗号隔开。如果想多个域名访问，则添加扩展域名（SSL_DNS）,多个SSL_DNS用逗号隔开\nSSL_IP='' # 例如: 1.2.3.4\nSSL_DNS='' # 例如: demo.rancher.com\n\n# 国家名(2个字母的代号)\nC=CN\n\n# 证书加密位数\nSSL_SIZE=2048\n\n# 证书有效期\nDATE=${DATE:-3650}\n\n# 配置文件\nSSL_CONFIG='openssl.cnf'\n\nif [[ -z $SILENT ]]; then\necho \"----------------------------\"\necho \"| SSL Cert Generator |\"\necho \"----------------------------\"\necho\nfi\n\nexport CA_KEY=${CA_KEY-\"cakey.pem\"}\nexport CA_CERT=${CA_CERT-\"cacerts.pem\"}\nexport CA_SUBJECT=ca-$CN\nexport CA_EXPIRE=${DATE}\n\nexport SSL_CONFIG=${SSL_CONFIG}\nexport SSL_KEY=$CN.key\nexport SSL_CSR=$CN.csr\nexport SSL_CERT=$CN.crt\nexport SSL_EXPIRE=${DATE}\n\nexport SSL_SUBJECT=${CN}\nexport SSL_DNS=${SSL_DNS}\nexport SSL_IP=${SSL_IP}\n\nexport K8S_SECRET_COMBINE_CA=${K8S_SECRET_COMBINE_CA:-'true'}\n\n[[ -z $SILENT ]] && echo \"--> Certificate Authority\"\n\nif [[ -e ./${CA_KEY} ]]; then\n    [[ -z $SILENT ]] && echo \"====> Using existing CA Key ${CA_KEY}\"\nelse\n    [[ -z $SILENT ]] && echo \"====> Generating new CA key ${CA_KEY}\"\n    openssl genrsa -out ${CA_KEY} ${SSL_SIZE} > /dev/null\nfi\n\nif [[ -e ./${CA_CERT} ]]; then\n    [[ -z $SILENT ]] && echo \"====> Using existing CA Certificate ${CA_CERT}\"\nelse\n    [[ -z $SILENT ]] && echo \"====> Generating new CA Certificate ${CA_CERT}\"\n    openssl req -x509 -sha256 -new -nodes -key ${CA_KEY} \\\n    -days ${CA_EXPIRE} -out ${CA_CERT} -subj \"/CN=${CA_SUBJECT}\" > /dev/null || exit 1\nfi\n\necho \"====> Generating new config file ${SSL_CONFIG}\"\ncat > ${SSL_CONFIG} <<EOM\n[req]\nreq_extensions = v3_req\ndistinguished_name = req_distinguished_name\n[req_distinguished_name]\n[ v3_req ]\nbasicConstraints = CA:FALSE\nkeyUsage = nonRepudiation, digitalSignature, keyEncipherment\nextendedKeyUsage = clientAuth, serverAuth\nEOM\n\nif [[ -n ${SSL_DNS} || -n ${SSL_IP} ]]; then\n    cat >> ${SSL_CONFIG} <<EOM\nsubjectAltName = @alt_names\n[alt_names]\nEOM\n    IFS=\",\"\n    dns=(${SSL_DNS})\n    dns+=(${SSL_SUBJECT})\n    for i in \"${!dns[@]}\"; do\n      echo DNS.$((i+1)) = ${dns[$i]} >> ${SSL_CONFIG}\n    done\n\n    if [[ -n ${SSL_IP} ]]; then\n        ip=(${SSL_IP})\n        for i in \"${!ip[@]}\"; do\n          echo IP.$((i+1)) = ${ip[$i]} >> ${SSL_CONFIG}\n        done\n    fi\nfi\n\n[[ -z $SILENT ]] && echo \"====> Generating new SSL KEY ${SSL_KEY}\"\nopenssl genrsa -out ${SSL_KEY} ${SSL_SIZE} > /dev/null || exit 1\n\n[[ -z $SILENT ]] && echo \"====> Generating new SSL CSR ${SSL_CSR}\"\nopenssl req -sha256 -new -key ${SSL_KEY} -out ${SSL_CSR} \\\n-subj \"/CN=${SSL_SUBJECT}\" -config ${SSL_CONFIG} > /dev/null || exit 1\n\n[[ -z $SILENT ]] && echo \"====> Generating new SSL CERT ${SSL_CERT}\"\nopenssl x509 -sha256 -req -in ${SSL_CSR} -CA ${CA_CERT} \\\n    -CAkey ${CA_KEY} -CAcreateserial -out ${SSL_CERT} \\\n    -days ${SSL_EXPIRE} -extensions v3_req \\\n    -extfile ${SSL_CONFIG} > /dev/null || exit 1\n\nif [[ -z $SILENT ]]; then\necho \"====> Complete\"\necho \"keys can be found in volume mapped to $(pwd)\"\necho\necho \"====> Output results as YAML\"\necho \"---\"\necho \"ca_key: |\"\ncat $CA_KEY | sed 's/^/  /'\necho\necho \"ca_cert: |\"\ncat $CA_CERT | sed 's/^/  /'\necho\necho \"ssl_key: |\"\ncat $SSL_KEY | sed 's/^/  /'\necho\necho \"ssl_csr: |\"\ncat $SSL_CSR | sed 's/^/  /'\necho\necho \"ssl_cert: |\"\ncat $SSL_CERT | sed 's/^/  /'\necho\nfi\n\nif [[ -n $K8S_SECRET_NAME ]]; then\n\n  if [[ -n $K8S_SECRET_COMBINE_CA ]]; then\n    [[ -z $SILENT ]] && echo \"====> Adding CA to Cert file\"\n    cat ${CA_CERT} >> ${SSL_CERT}\n  fi\n\n  [[ -z $SILENT ]] && echo \"====> Creating Kubernetes secret: $K8S_SECRET_NAME\"\n  kubectl delete secret $K8S_SECRET_NAME --ignore-not-found\n\n  if [[ -n $K8S_SECRET_SEPARATE_CA ]]; then\n    kubectl create secret generic \\\n    $K8S_SECRET_NAME \\\n    --from-file=\"tls.crt=${SSL_CERT}\" \\\n    --from-file=\"tls.key=${SSL_KEY}\" \\\n    --from-file=\"ca.crt=${CA_CERT}\"\n  else\n    kubectl create secret tls \\\n    $K8S_SECRET_NAME \\\n    --cert=${SSL_CERT} \\\n    --key=${SSL_KEY}\n  fi\n\n  if [[ -n $K8S_SECRET_LABELS ]]; then\n    [[ -z $SILENT ]] && echo \"====> Labeling Kubernetes secret\"\n    IFS=$' \\n\\t' # We have to reset IFS or label secret will misbehave on some systems\n    kubectl label secret \\\n      $K8S_SECRET_NAME \\\n      $K8S_SECRET_LABELS\n  fi\nfi\n\necho \"4. 重命名服务证书\"\nmv ${CN}.key tls.key\nmv ${CN}.crt tls.crt\n```\n\n","slug":"CA证书服务","published":1,"updated":"2021-06-18T08:07:11.182Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cku697a2f00br00uh18ct1zh3","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><p>[TOC]</p>\n<h2 id=\"一、搭建CA服务\"><a href=\"#一、搭建CA服务\" class=\"headerlink\" title=\"一、搭建CA服务\"></a>一、搭建CA服务</h2><p>openssl 默认配置文件: <code> /etc/pki/tls/openssl.cnf</code></p>\n<h3 id=\"1、初始化目录\"><a href=\"#1、初始化目录\" class=\"headerlink\" title=\"1、初始化目录\"></a>1、初始化目录</h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> <span class=\"built_in\">cd</span> /etc/pki/CA</span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> mkdir certs crl newcerts private</span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> tree</span></span><br><span class=\"line\">.</span><br><span class=\"line\">|-- certs</span><br><span class=\"line\">|-- crl</span><br><span class=\"line\">|-- newcerts</span><br><span class=\"line\">`-- private</span><br><span class=\"line\"></span><br><span class=\"line\">4 directories, 0 files</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2、创建CA需要的文件\"><a href=\"#2、创建CA需要的文件\" class=\"headerlink\" title=\"2、创建CA需要的文件\"></a>2、创建CA需要的文件</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># touch index.txt</span></span><br><span class=\"line\"><span class=\"comment\"># echo 01 &gt; serial</span></span><br><span class=\"line\"><span class=\"comment\"># ll</span></span><br><span class=\"line\">total 20</span><br><span class=\"line\">drwx--x--x 2 root root 4096 Dec 18 02:59 certs</span><br><span class=\"line\">drwx--x--x 2 root root 4096 Dec 18 02:59 crl</span><br><span class=\"line\">-rw------- 1 root root    0 Dec 18 02:59 index.txt</span><br><span class=\"line\">drwx--x--x 2 root root 4096 Dec 18 02:59 newcerts</span><br><span class=\"line\">drwx--x--x 2 root root 4096 Dec 18 02:59 private</span><br><span class=\"line\">-rw------- 1 root root    3 Dec 18 03:00 serial</span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"3、给CA创建私钥\"><a href=\"#3、给CA创建私钥\" class=\"headerlink\" title=\"3、给CA创建私钥\"></a>3、给CA创建私钥</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># pwd</span></span><br><span class=\"line\">/etc/pki/CA</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># (umask 066;openssl genrsa -out private/cakey.pem 2048)</span></span><br><span class=\"line\">Generating RSA private key, 2048 bit long modulus</span><br><span class=\"line\">........+++</span><br><span class=\"line\">.................+++</span><br><span class=\"line\">e is 65537 (0x10001)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># tree</span></span><br><span class=\"line\">.</span><br><span class=\"line\">|-- certs</span><br><span class=\"line\">|-- crl</span><br><span class=\"line\">|-- index.txt</span><br><span class=\"line\">|-- newcerts</span><br><span class=\"line\">|-- private</span><br><span class=\"line\">|   `-- cakey.pem</span><br><span class=\"line\">`-- serial</span><br><span class=\"line\"></span><br><span class=\"line\">4 directories, 3 files</span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"4、给CA生成自签名证书\"><a href=\"#4、给CA生成自签名证书\" class=\"headerlink\" title=\"4、给CA生成自签名证书\"></a>4、给CA生成自签名证书</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># openssl req -new -x509 -key private&#x2F;cakey.pem -days 7300 -out cacert.pem</span><br><span class=\"line\"></span><br><span class=\"line\">You are about to be asked to enter information that will be incorporated</span><br><span class=\"line\">into your certificate request.</span><br><span class=\"line\">What you are about to enter is what is called a Distinguished Name or a DN.</span><br><span class=\"line\">There are quite a few fields but you can leave some blank</span><br><span class=\"line\">For some fields there will be a default value,</span><br><span class=\"line\">If you enter &#39;.&#39;, the field will be left blank.</span><br><span class=\"line\">-----</span><br><span class=\"line\">Country Name (2 letter code) [CN]:</span><br><span class=\"line\">State or Province Name (full name) [ZheJiang]:</span><br><span class=\"line\">Locality Name (eg, city) [HangZhou]:</span><br><span class=\"line\">Organization Name (eg, company) [ZTYC]:</span><br><span class=\"line\">Organizational Unit Name (eg, section) [ztyc]:</span><br><span class=\"line\">Common Name (eg, your name or your server&#39;s hostname) []:</span><br><span class=\"line\">Email Address []:</span><br><span class=\"line\"></span><br><span class=\"line\"># ls</span><br><span class=\"line\">cacert.pem  certs  crl  index.txt  newcerts  private  serial</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"二、使用CA给客户颁发证书\"><a href=\"#二、使用CA给客户颁发证书\" class=\"headerlink\" title=\"二、使用CA给客户颁发证书\"></a>二、使用CA给客户颁发证书</h2><h3 id=\"1、客户机生成私钥\"><a href=\"#1、客户机生成私钥\" class=\"headerlink\" title=\"1、客户机生成私钥\"></a>1、客户机生成私钥</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">client opt]<span class=\"comment\"># (umask 066;openssl genrsa -out wms.qa.ops.com.key 2048)</span></span><br><span class=\"line\"></span><br><span class=\"line\">Generating RSA private key, 2048 bit long modulus</span><br><span class=\"line\">..............+++</span><br><span class=\"line\">.........................................................................+++</span><br><span class=\"line\">e is 65537 (0x10001)</span><br><span class=\"line\"></span><br><span class=\"line\">client opt]<span class=\"comment\"># ls</span></span><br><span class=\"line\">wms.qa.ops.com.key</span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"2、生成证书申请文件\"><a href=\"#2、生成证书申请文件\" class=\"headerlink\" title=\"2、生成证书申请文件\"></a>2、生成证书申请文件</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">client opt]<span class=\"comment\"># openssl req -new -key wms.qa.ops.com.key -days 365 -out wms.qa.ops.com.csr</span></span><br><span class=\"line\"></span><br><span class=\"line\">You are about to be asked to enter information that will be incorporated</span><br><span class=\"line\">into your certificate request.</span><br><span class=\"line\">What you are about to enter is what is called a Distinguished Name or a DN.</span><br><span class=\"line\">There are quite a few fields but you can leave some blank</span><br><span class=\"line\">For some fields there will be a default value,</span><br><span class=\"line\">If you enter <span class=\"string\">&#x27;.&#x27;</span>, the field will be left blank.</span><br><span class=\"line\">-----</span><br><span class=\"line\">Country Name (2 letter code) [CN]:</span><br><span class=\"line\">State or Province Name (full name) [ZheJiang]:</span><br><span class=\"line\">Locality Name (eg, city) [HangZhou]:</span><br><span class=\"line\">Organization Name (eg, company) [ZTYC]:</span><br><span class=\"line\">Organizational Unit Name (eg, section) [ztyc]:</span><br><span class=\"line\">Common Name (eg, your name or your server<span class=\"string\">&#x27;s hostname) []:wms.qa.ops.com</span></span><br><span class=\"line\"><span class=\"string\">Email Address []:</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">Please enter the following &#x27;</span>extra<span class=\"string\">&#x27; attributes</span></span><br><span class=\"line\"><span class=\"string\">to be sent with your certificate request</span></span><br><span class=\"line\"><span class=\"string\">A challenge password []:</span></span><br><span class=\"line\"><span class=\"string\">An optional company name []:</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">client opt]#ls</span></span><br><span class=\"line\"><span class=\"string\">wms.qa.ops.com.csr  wms.qa.ops.com.key</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"3、将证书申请文件传输到CA服务器上\"><a href=\"#3、将证书申请文件传输到CA服务器上\" class=\"headerlink\" title=\"3、将证书申请文件传输到CA服务器上\"></a>3、将证书申请文件传输到CA服务器上</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># pwd</span></span><br><span class=\"line\">/etc/pki/CA</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ls crl/</span></span><br><span class=\"line\">wms.qa.ops.com.csr</span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"4、在CA上给申请签证的客户签署证书\"><a href=\"#4、在CA上给申请签证的客户签署证书\" class=\"headerlink\" title=\"4、在CA上给申请签证的客户签署证书\"></a>4、在CA上给申请签证的客户签署证书</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># pwd</span><br><span class=\"line\">&#x2F;etc&#x2F;pki&#x2F;CA</span><br><span class=\"line\"></span><br><span class=\"line\"># openssl ca -in crl&#x2F;wms.qa.ops.com.csr -out certs&#x2F;wms.qa.ops.com.crt -days 365</span><br><span class=\"line\"></span><br><span class=\"line\">Using configuration from &#x2F;etc&#x2F;pki&#x2F;tls&#x2F;openssl.cnf</span><br><span class=\"line\">Check that the request matches the signature</span><br><span class=\"line\">Signature ok</span><br><span class=\"line\">Certificate Details:</span><br><span class=\"line\">        Serial Number: 1 (0x1)</span><br><span class=\"line\">        Validity</span><br><span class=\"line\">            Not Before: Dec 18 03:33:30 2019 GMT</span><br><span class=\"line\">            Not After : Dec 17 03:33:30 2020 GMT</span><br><span class=\"line\">        Subject:</span><br><span class=\"line\">            countryName               &#x3D; CN</span><br><span class=\"line\">            stateOrProvinceName       &#x3D; ZheJiang</span><br><span class=\"line\">            organizationName          &#x3D; ZTYC</span><br><span class=\"line\">            organizationalUnitName    &#x3D; ztyc</span><br><span class=\"line\">            commonName                &#x3D; wms.qa.ops.com</span><br><span class=\"line\">        X509v3 extensions:</span><br><span class=\"line\">            X509v3 Basic Constraints: </span><br><span class=\"line\">                CA:FALSE</span><br><span class=\"line\">            Netscape Comment: </span><br><span class=\"line\">                OpenSSL Generated Certificate</span><br><span class=\"line\">            X509v3 Subject Key Identifier: </span><br><span class=\"line\">                B2:35:6B:B9:16:86:4C:76:99:C8:27:64:7A:60:FC:B0:82:59:64:8A</span><br><span class=\"line\">            X509v3 Authority Key Identifier: </span><br><span class=\"line\">                keyid:70:EB:D1:7E:7A:D0:29:AE:65:10:73:D3:16:7D:6C:CD:12:C8:F1:FB</span><br><span class=\"line\"></span><br><span class=\"line\">Certificate is to be certified until Dec 17 03:33:30 2020 GMT (365 days)</span><br><span class=\"line\">Sign the certificate? [y&#x2F;n]:y</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">1 out of 1 certificate requests certified, commit? [y&#x2F;n]y</span><br><span class=\"line\">Write out database with 1 new entries</span><br><span class=\"line\">Data Base Updated</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"5、将CA上将签署好的证书传输给申请的客户\"><a href=\"#5、将CA上将签署好的证书传输给申请的客户\" class=\"headerlink\" title=\"5、将CA上将签署好的证书传输给申请的客户\"></a>5、将CA上将签署好的证书传输给申请的客户</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">client opt]<span class=\"comment\"># ls </span></span><br><span class=\"line\">wms.qa.ops.com.crt  wms.qa.ops.com.csr  wms.qa.ops.com.key</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"6、查看颁发的证书\"><a href=\"#6、查看颁发的证书\" class=\"headerlink\" title=\"6、查看颁发的证书\"></a>6、查看颁发的证书</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">client opt]<span class=\"comment\"># openssl x509 -in wms.qa.ops.com.crt -noout -text</span></span><br><span class=\"line\"></span><br><span class=\"line\">Certificate:</span><br><span class=\"line\">    Data:</span><br><span class=\"line\">        Version: 3 (0x2)</span><br><span class=\"line\">        Serial Number: 1 (0x1)</span><br><span class=\"line\">    Signature Algorithm: sha256WithRSAEncryption</span><br><span class=\"line\">        Issuer: C=CN, ST=ZheJiang, L=HangZhou, O=ZTYC, OU=ztyc</span><br><span class=\"line\">        Validity</span><br><span class=\"line\">            Not Before: Dec 18 03:33:30 2019 GMT</span><br><span class=\"line\">            Not After : Dec 17 03:33:30 2020 GMT</span><br><span class=\"line\">        Subject: C=CN, ST=ZheJiang, O=ZTYC, OU=ztyc, CN=wms.qa.ops.com</span><br><span class=\"line\">        Subject Public Key Info:</span><br><span class=\"line\">            Public Key Algorithm: rsaEncryption</span><br><span class=\"line\">                Public-Key: (2048 bit)</span><br><span class=\"line\">                Modulus:</span><br><span class=\"line\">                    00:b9:20:cf:dc:bc:d4:06:b6:a0:15:1a:22:52:21:</span><br><span class=\"line\">                    1f:64:c1:81:90:47:83:70:21:00:0a:ba:2a:ac:00:</span><br><span class=\"line\">                    22:3d:3d:c3:d7:4a:2c:51:11:5e:df:e8:6c:41:2e:</span><br><span class=\"line\">.....</span><br><span class=\"line\">.....</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"7、crt转pem格式\"><a href=\"#7、crt转pem格式\" class=\"headerlink\" title=\"7、crt转pem格式\"></a>7、crt转pem格式</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">client opt]<span class=\"comment\"># openssl x509 -in wms.qa.ops.com.crt -inform DER -outform PEM -out wms.qa.ops.com.pem</span></span><br><span class=\"line\">client opt]<span class=\"comment\"># ls</span></span><br><span class=\"line\">wms.qa.ops.com.crt  wms.qa.ops.com.csr  wms.qa.ops.com.key  wms.qa.ops.com.pem</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"8、证书转换为PKCS12文件\"><a href=\"#8、证书转换为PKCS12文件\" class=\"headerlink\" title=\"8、证书转换为PKCS12文件\"></a>8、证书转换为PKCS12文件</h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">client opt]# openssl pkcs12 -export -clcerts -in wms.qa.ops.com.crt \\</span><br><span class=\"line\">-inkey wms.qa.ops.com.key -out wms.qa.ops.com.key.p12</span><br><span class=\"line\">client opt]# ls</span><br><span class=\"line\">wms.qa.ops.com.crt  wms.qa.ops.com.csr  wms.qa.ops.com.key  wms.qa.ops.com.pem   wms.qa.ops.com.key.p12</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"三、CA上吊销证书\"><a href=\"#三、CA上吊销证书\" class=\"headerlink\" title=\"三、CA上吊销证书\"></a>三、CA上吊销证书</h2><h3 id=\"查看证书的serial以及subject信息\"><a href=\"#查看证书的serial以及subject信息\" class=\"headerlink\" title=\"查看证书的serial以及subject信息\"></a>查看证书的serial以及subject信息</h3><p>1、在申请吊销证书的客户机上查看需要吊销的证书的serial以及subject信息，并提交给CA</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">client opt]<span class=\"comment\"># openssl x509 -in qa.ops.com.crt -noout -serial -subject</span></span><br><span class=\"line\">serial=03</span><br><span class=\"line\">subject= /C=CN/ST=ZheJiang/O=ZTYC/OU=ops/CN=qa.ops.com/emailAddress=ops@ztyc.com</span><br></pre></td></tr></table></figure>\n\n<p>2、在CA上根据客户提交的serial以及subject信息，比对服务器上index.txt文件中的信息一致后，执行吊销证书操作</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># pwd</span></span><br><span class=\"line\">/etc/pki/CA</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># openssl x509 -in certs/qa.ops.com.crt -noout -serial -subject</span></span><br><span class=\"line\">serial=03</span><br><span class=\"line\">subject= /C=CN/ST=ZheJiang/O=ZTYC/OU=ops/CN=qa.ops.com/emailAddress=ops@ztyc.com</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># cat index.txt</span></span><br><span class=\"line\"></span><br><span class=\"line\">V\t291215081847Z\t\t03\tunknown\t/C=CN/ST=ZheJiang/O=ZTYC/OU=ops/CN=qa.ops.com/emailAddress=ops@ztyc.com</span><br></pre></td></tr></table></figure>\n\n<p>3、信息确认一致，正式执行吊销操作</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># openssl ca -revoke newcerts/03.pem </span></span><br><span class=\"line\">Using configuration from /etc/pki/tls/openssl.cnf</span><br><span class=\"line\">Revoking Certificate 03.</span><br><span class=\"line\">Data Base Updated</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>4、生成吊销证书的编号（第一次吊销证书时才需要执行本操作)</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># pwd</span></span><br><span class=\"line\">/etc/pki/CA</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># echo 01 &gt; crlnumber</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># openssl ca -gencrl -out crl/qa.ops.com.csr </span></span><br><span class=\"line\">Using configuration from /etc/pki/tls/openssl.cnf</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># openssl crl -in crl/qa.ops.com.csr -noout -text</span></span><br><span class=\"line\">Certificate Revocation List (CRL):</span><br><span class=\"line\">        Version 2 (0x1)</span><br><span class=\"line\">    Signature Algorithm: sha256WithRSAEncryption</span><br><span class=\"line\">        Issuer: /C=CN/ST=ZheJiang/L=HangZhou/O=ZTYC/OU=ztyc</span><br><span class=\"line\">        Last Update: Dec 18 08:32:01 2019 GMT</span><br><span class=\"line\">        Next Update: Jan 17 08:32:01 2020 GMT</span><br><span class=\"line\">        CRL extensions:</span><br><span class=\"line\">            X509v3 CRL Number: </span><br><span class=\"line\">                1</span><br><span class=\"line\">Revoked Certificates:</span><br><span class=\"line\">    Serial Number: 01</span><br><span class=\"line\">        Revocation Date: Dec 18 08:29:24 2019 GMT</span><br><span class=\"line\">    Serial Number: 03</span><br><span class=\"line\">        Revocation Date: Dec 18 08:29:31 2019 GMT</span><br><span class=\"line\">    Signature Algorithm: sha256WithRSAEncryption</span><br><span class=\"line\">         5e:68:d9:a1:ef:1d:7f:83:23:a4:57:95:19:1b:7a:36:82:cc:</span><br><span class=\"line\">         3a:2a:73:d8:1d:77:03:1a:e5:fd:5d:40:a8:e2:0a:af:34:d7:</span><br><span class=\"line\">         04:e5:7e:a8:c6:58:36:34:33:d7:79:bf:e0:07:29:f3:72:5b:</span><br><span class=\"line\">         e8:5d:f4:06:ba:e3:1f:00:2e:f5:4b:47:18:7c:e1:0d:00:3e:</span><br><span class=\"line\">         2e:13:eb:57:06:be:7f:48:5a:13:ef:62:cc:1e:92:76:22:f3:</span><br><span class=\"line\">         c2:6b:d0:12:e0:26:4c:33:be:fe:fd:14:de:77:da:6a:20:ce:</span><br><span class=\"line\">         f5:41:6e:e7:f1:e0:5d:d1:4f:91:e3:97:49:0d:a4:c9:0d:c4:</span><br><span class=\"line\">         <span class=\"built_in\">cd</span>:3a:51:5f:31:5b:ed:<span class=\"built_in\">fc</span>:55:9f:6b:9c:72:c9:7d:92:25:7b:</span><br><span class=\"line\">         e8:ec:e0:96:b6:98:96:ac:b7:63:40:d5:ec:b7:09:74:e9:c0:</span><br><span class=\"line\">         96:b6:2c:55:4b:de:fa:fa:2c:74:2e:f8:96:2e:4f:bc:5f:d2:</span><br><span class=\"line\">         0b:15:1a:6d:1f:e7:1e:8b:d3:af:51:d6:ca:2d:90:9f:9f:03:</span><br><span class=\"line\">         c2:da:03:f7:0f:a5:6a:e4:f7:3d:25:a1:06:05:c4:de:5e:62:</span><br><span class=\"line\">         5e:a5:7d:25:7e:9c:16:82:7f:21:28:d0:a3:d6:5c:e7:26:48:</span><br><span class=\"line\">         03:e0:93:84:fb:f3:b3:0a:d9:e6:35:3e:ae:d7:9f:65:b5:b6:</span><br><span class=\"line\">         fa:6a:69:67</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"四、在浏览器中访问\"><a href=\"#四、在浏览器中访问\" class=\"headerlink\" title=\"四、在浏览器中访问\"></a>四、在浏览器中访问</h2><p>在浏览器中打开https://<domain_name>来访问。</p>\n<p>在Firefox浏览器中可以添加 Security Exception 来忽略HTTPS错误警告。</p>\n<p>Chrome浏览器可以尝试通过导入CA证书的方式来忽略HTTPS错误警告。</p>\n<blockquote>\n<p>注意：Chrome 浏览器可能有导入CA证书后仍然无法访问的问题；不同浏览器对自签名SSL证书的检查和限制也有所区别。</p>\n</blockquote>\n<h2 id=\"五、脚本\"><a href=\"#五、脚本\" class=\"headerlink\" title=\"五、脚本\"></a>五、脚本</h2><h3 id=\"一、结合上面文档使用\"><a href=\"#一、结合上面文档使用\" class=\"headerlink\" title=\"一、结合上面文档使用\"></a>一、结合上面文档使用</h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">!/bin/bash -e</span></span><br><span class=\"line\"></span><br><span class=\"line\">SSL_IP=&#x27;&#x27;</span><br><span class=\"line\">SSL_DNS=&#x27;wms.qa.opt.com&#x27;</span><br><span class=\"line\">CN=$&#123;SSL_DNS&#125;</span><br><span class=\"line\">SSL_SIZE=2048</span><br><span class=\"line\"></span><br><span class=\"line\">DATE=$&#123;DATE:-3650&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">SSL_CONFIG=&#x27;openssl.cnf&#x27;</span><br><span class=\"line\">SSL_SUBJECT=&quot;/C=CN/ST=ZheJiang/L=HangZhou/O=ZTYC/OU=ops/CN=$&#123;CN&#125;/emailAddress=ops@ztyc.com&quot;</span><br><span class=\"line\">CA_DIR=&#x27;/etc/pki/CA&#x27;</span><br><span class=\"line\"></span><br><span class=\"line\">if [[ -z $SILENT ]]; then</span><br><span class=\"line\">echo &quot;----------------------------&quot;</span><br><span class=\"line\">echo &quot;| SSL Cert Generator |&quot;</span><br><span class=\"line\">echo &quot;----------------------------&quot;</span><br><span class=\"line\">echo</span><br><span class=\"line\">fi</span><br><span class=\"line\"></span><br><span class=\"line\">export SSL_DNS=$&#123;SSL_DNS&#125;</span><br><span class=\"line\">export SSL_IP=$&#123;SSL_IP&#125;</span><br><span class=\"line\">export SSL_KEY=$CN.key</span><br><span class=\"line\">export SSL_CSR=$CN.csr</span><br><span class=\"line\">export SSL_SUBJECT=$&#123;SSL_SUBJECT&#125;</span><br><span class=\"line\">export CA_DIR=$&#123;CA_DIR&#125;</span><br><span class=\"line\">export SSL_CERT=$CN.crt</span><br><span class=\"line\">export SSL_PEM=$CN.pem</span><br><span class=\"line\"></span><br><span class=\"line\">dir=$(pwd)</span><br><span class=\"line\">echo -e &quot;The current working directory is \\033[36m $&#123;dir&#125; \\033[0m&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">echo &quot;====&gt; Generating new config file $&#123;SSL_CONFIG&#125;&quot;</span><br><span class=\"line\">cat &gt; $&#123;SSL_CONFIG&#125; &lt;&lt;EOM</span><br><span class=\"line\">[req]</span><br><span class=\"line\">req_extensions = v3_req</span><br><span class=\"line\">distinguished_name = req_distinguished_name</span><br><span class=\"line\">[req_distinguished_name]</span><br><span class=\"line\">[ v3_req ]</span><br><span class=\"line\">basicConstraints = CA:FALSE</span><br><span class=\"line\">keyUsage = nonRepudiation, digitalSignature, keyEncipherment</span><br><span class=\"line\">extendedKeyUsage = clientAuth, serverAuth</span><br><span class=\"line\">EOM</span><br><span class=\"line\"></span><br><span class=\"line\">if [[ -n $&#123;SSL_DNS&#125; || -n $&#123;SSL_IP&#125; ]]; then</span><br><span class=\"line\">cat &gt;&gt; $&#123;SSL_CONFIG&#125; &lt;&lt;EOM</span><br><span class=\"line\">subjectAltName = @alt_names</span><br><span class=\"line\">[alt_names]</span><br><span class=\"line\">EOM</span><br><span class=\"line\">    IFS=&quot;,&quot;</span><br><span class=\"line\">    dns=($&#123;SSL_DNS&#125;)</span><br><span class=\"line\">    for i in &quot;$&#123;!dns[@]&#125;&quot;; do</span><br><span class=\"line\">      echo DNS.$((i+1)) = $&#123;dns[$i]&#125; &gt;&gt; $&#123;SSL_CONFIG&#125;</span><br><span class=\"line\">    done</span><br><span class=\"line\"></span><br><span class=\"line\">    if [[ -n $&#123;SSL_IP&#125; ]]; then</span><br><span class=\"line\">        ip=($&#123;SSL_IP&#125;)</span><br><span class=\"line\">        for i in &quot;$&#123;!ip[@]&#125;&quot;; do</span><br><span class=\"line\">          echo IP.$((i+1)) = $&#123;ip[$i]&#125; &gt;&gt; $&#123;SSL_CONFIG&#125;</span><br><span class=\"line\">        done</span><br><span class=\"line\">    fi</span><br><span class=\"line\">fi</span><br><span class=\"line\"></span><br><span class=\"line\">[[ -z $SILENT ]] &amp;&amp; echo &quot;====&gt; Generating new SSL KEY $&#123;SSL_KEY&#125;&quot;</span><br><span class=\"line\">echo -e &quot;\\033[36m openssl genrsa -out $&#123;SSL_KEY&#125; $&#123;SSL_SIZE&#125; \\033[0m&quot;</span><br><span class=\"line\">openssl genrsa -out $&#123;SSL_KEY&#125; $&#123;SSL_SIZE&#125; &gt; /dev/null || exit 1</span><br><span class=\"line\"></span><br><span class=\"line\">[[ -z $SILENT ]] &amp;&amp; echo &quot;====&gt; Generating new SSL CSR $&#123;SSL_CSR&#125;&quot;</span><br><span class=\"line\">echo -e &quot;\\033[36m openssl req -sha256 -new -key $&#123;SSL_KEY&#125; -out $&#123;SSL_CSR&#125; -subj \\&quot;$&#123;SSL_SUBJECT&#125;\\&quot; -config $&#123;SSL_CONFIG&#125; \\033[0m&quot;</span><br><span class=\"line\">openssl req -sha256 -new -key $&#123;SSL_KEY&#125; -out $&#123;SSL_CSR&#125; \\</span><br><span class=\"line\">-subj &quot;$&#123;SSL_SUBJECT&#125;&quot; -config $&#123;SSL_CONFIG&#125; &gt; /dev/null || exit 1</span><br><span class=\"line\"></span><br><span class=\"line\">[[ -z $SILENT ]] &amp;&amp; echo &quot;====&gt; Generating new SSL CERT $&#123;SSL_CERT&#125;&quot;</span><br><span class=\"line\">\\cp $&#123;SSL_CSR&#125; $&#123;CA_DIR&#125;/crl</span><br><span class=\"line\">cd $&#123;CA_DIR&#125;</span><br><span class=\"line\">echo -e &quot;The current working directory is \\033[36m $(pwd)\\033[0m&quot;</span><br><span class=\"line\">echo -e &quot;\\033[36m openssl ca -in crl/$&#123;SSL_CSR&#125; -out certs/$&#123;SSL_CERT&#125;  -days $&#123;DATE&#125; \\033[0m&quot;</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">openssl ca -<span class=\"keyword\">in</span> crl/<span class=\"variable\">$&#123;SSL_CSR&#125;</span> -out certs/<span class=\"variable\">$&#123;SSL_CERT&#125;</span>  -days <span class=\"variable\">$&#123;DATE&#125;</span>  || <span class=\"built_in\">exit</span> 1</span></span><br><span class=\"line\">/usr/bin/expect &lt;&lt;END</span><br><span class=\"line\">  spawn openssl ca -in crl/$&#123;SSL_CSR&#125; -out certs/$&#123;SSL_CERT&#125;  -days $&#123;DATE&#125;</span><br><span class=\"line\">  expect &#123;</span><br><span class=\"line\">    &quot;*y/n]:&quot; &#123;send &quot;y\\r&quot;;exp_continue&#125;</span><br><span class=\"line\">    &quot;*y/n]&quot; &#123;send &quot;y\\r&quot;;exp_continue&#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">END</span><br><span class=\"line\">\\cp certs/$&#123;SSL_CERT&#125; $&#123;dir&#125;</span><br><span class=\"line\">cd $&#123;dir&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">echo -e &quot;The current working directory is \\033[36m $(pwd)\\033[0m&quot;</span><br><span class=\"line\">echo -e &quot;\\033[36m openssl x509 -in $&#123;SSL_CERT&#125; -out $&#123;SSL_PEM&#125; -outform PEM \\033[0m&quot;</span><br><span class=\"line\">openssl x509 -in $&#123;SSL_CERT&#125;  -out $&#123;SSL_PEM&#125; -outform PEM</span><br><span class=\"line\">ls</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">if [[ -z $SILENT ]]; then</span><br><span class=\"line\">echo &quot;====&gt; Complete&quot;</span><br><span class=\"line\">echo -e &quot;keys can be found in volume mapped to \\033[36m $(pwd)\\033[0m&quot;</span><br><span class=\"line\">echo</span><br><span class=\"line\">echo &quot;====&gt; Output results as YAML&quot;</span><br><span class=\"line\">openssl x509 -in $&#123;SSL_CERT&#125; -noout -text</span><br><span class=\"line\">fi</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"二、独立使用\"><a href=\"#二、独立使用\" class=\"headerlink\" title=\"二、独立使用\"></a>二、独立使用</h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">!/bin/bash -e</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> * 为必改项</span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> * 更换为你自己的域名</span></span><br><span class=\"line\">CN=&#x27;&#x27; # 例如: demo.rancher.com</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> 扩展信任IP或域名</span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"><span class=\"comment\"># 一般ssl证书只信任域名的访问请求，有时候需要使用ip去访问server，那么需要给ssl证书添加扩展IP，</span></span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"><span class=\"comment\"># 多个IP用逗号隔开。如果想多个域名访问，则添加扩展域名（SSL_DNS）,多个SSL_DNS用逗号隔开</span></span></span><br><span class=\"line\">SSL_IP=&#x27;&#x27; # 例如: 1.2.3.4</span><br><span class=\"line\">SSL_DNS=&#x27;&#x27; # 例如: demo.rancher.com</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> 国家名(2个字母的代号)</span></span><br><span class=\"line\">C=CN</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> 证书加密位数</span></span><br><span class=\"line\">SSL_SIZE=2048</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> 证书有效期</span></span><br><span class=\"line\">DATE=$&#123;DATE:-3650&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> 配置文件</span></span><br><span class=\"line\">SSL_CONFIG=&#x27;openssl.cnf&#x27;</span><br><span class=\"line\"></span><br><span class=\"line\">if [[ -z $SILENT ]]; then</span><br><span class=\"line\">echo &quot;----------------------------&quot;</span><br><span class=\"line\">echo &quot;| SSL Cert Generator |&quot;</span><br><span class=\"line\">echo &quot;----------------------------&quot;</span><br><span class=\"line\">echo</span><br><span class=\"line\">fi</span><br><span class=\"line\"></span><br><span class=\"line\">export CA_KEY=$&#123;CA_KEY-&quot;cakey.pem&quot;&#125;</span><br><span class=\"line\">export CA_CERT=$&#123;CA_CERT-&quot;cacerts.pem&quot;&#125;</span><br><span class=\"line\">export CA_SUBJECT=ca-$CN</span><br><span class=\"line\">export CA_EXPIRE=$&#123;DATE&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">export SSL_CONFIG=$&#123;SSL_CONFIG&#125;</span><br><span class=\"line\">export SSL_KEY=$CN.key</span><br><span class=\"line\">export SSL_CSR=$CN.csr</span><br><span class=\"line\">export SSL_CERT=$CN.crt</span><br><span class=\"line\">export SSL_EXPIRE=$&#123;DATE&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">export SSL_SUBJECT=$&#123;CN&#125;</span><br><span class=\"line\">export SSL_DNS=$&#123;SSL_DNS&#125;</span><br><span class=\"line\">export SSL_IP=$&#123;SSL_IP&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">export K8S_SECRET_COMBINE_CA=$&#123;K8S_SECRET_COMBINE_CA:-&#x27;true&#x27;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">[[ -z $SILENT ]] &amp;&amp; echo &quot;--&gt; Certificate Authority&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">if [[ -e ./$&#123;CA_KEY&#125; ]]; then</span><br><span class=\"line\">    [[ -z $SILENT ]] &amp;&amp; echo &quot;====&gt; Using existing CA Key $&#123;CA_KEY&#125;&quot;</span><br><span class=\"line\">else</span><br><span class=\"line\">    [[ -z $SILENT ]] &amp;&amp; echo &quot;====&gt; Generating new CA key $&#123;CA_KEY&#125;&quot;</span><br><span class=\"line\">    openssl genrsa -out $&#123;CA_KEY&#125; $&#123;SSL_SIZE&#125; &gt; /dev/null</span><br><span class=\"line\">fi</span><br><span class=\"line\"></span><br><span class=\"line\">if [[ -e ./$&#123;CA_CERT&#125; ]]; then</span><br><span class=\"line\">    [[ -z $SILENT ]] &amp;&amp; echo &quot;====&gt; Using existing CA Certificate $&#123;CA_CERT&#125;&quot;</span><br><span class=\"line\">else</span><br><span class=\"line\">    [[ -z $SILENT ]] &amp;&amp; echo &quot;====&gt; Generating new CA Certificate $&#123;CA_CERT&#125;&quot;</span><br><span class=\"line\">    openssl req -x509 -sha256 -new -nodes -key $&#123;CA_KEY&#125; \\</span><br><span class=\"line\">    -days $&#123;CA_EXPIRE&#125; -out $&#123;CA_CERT&#125; -subj &quot;/CN=$&#123;CA_SUBJECT&#125;&quot; &gt; /dev/null || exit 1</span><br><span class=\"line\">fi</span><br><span class=\"line\"></span><br><span class=\"line\">echo &quot;====&gt; Generating new config file $&#123;SSL_CONFIG&#125;&quot;</span><br><span class=\"line\">cat &gt; $&#123;SSL_CONFIG&#125; &lt;&lt;EOM</span><br><span class=\"line\">[req]</span><br><span class=\"line\">req_extensions = v3_req</span><br><span class=\"line\">distinguished_name = req_distinguished_name</span><br><span class=\"line\">[req_distinguished_name]</span><br><span class=\"line\">[ v3_req ]</span><br><span class=\"line\">basicConstraints = CA:FALSE</span><br><span class=\"line\">keyUsage = nonRepudiation, digitalSignature, keyEncipherment</span><br><span class=\"line\">extendedKeyUsage = clientAuth, serverAuth</span><br><span class=\"line\">EOM</span><br><span class=\"line\"></span><br><span class=\"line\">if [[ -n $&#123;SSL_DNS&#125; || -n $&#123;SSL_IP&#125; ]]; then</span><br><span class=\"line\">    cat &gt;&gt; $&#123;SSL_CONFIG&#125; &lt;&lt;EOM</span><br><span class=\"line\">subjectAltName = @alt_names</span><br><span class=\"line\">[alt_names]</span><br><span class=\"line\">EOM</span><br><span class=\"line\">    IFS=&quot;,&quot;</span><br><span class=\"line\">    dns=($&#123;SSL_DNS&#125;)</span><br><span class=\"line\">    dns+=($&#123;SSL_SUBJECT&#125;)</span><br><span class=\"line\">    for i in &quot;$&#123;!dns[@]&#125;&quot;; do</span><br><span class=\"line\">      echo DNS.$((i+1)) = $&#123;dns[$i]&#125; &gt;&gt; $&#123;SSL_CONFIG&#125;</span><br><span class=\"line\">    done</span><br><span class=\"line\"></span><br><span class=\"line\">    if [[ -n $&#123;SSL_IP&#125; ]]; then</span><br><span class=\"line\">        ip=($&#123;SSL_IP&#125;)</span><br><span class=\"line\">        for i in &quot;$&#123;!ip[@]&#125;&quot;; do</span><br><span class=\"line\">          echo IP.$((i+1)) = $&#123;ip[$i]&#125; &gt;&gt; $&#123;SSL_CONFIG&#125;</span><br><span class=\"line\">        done</span><br><span class=\"line\">    fi</span><br><span class=\"line\">fi</span><br><span class=\"line\"></span><br><span class=\"line\">[[ -z $SILENT ]] &amp;&amp; echo &quot;====&gt; Generating new SSL KEY $&#123;SSL_KEY&#125;&quot;</span><br><span class=\"line\">openssl genrsa -out $&#123;SSL_KEY&#125; $&#123;SSL_SIZE&#125; &gt; /dev/null || exit 1</span><br><span class=\"line\"></span><br><span class=\"line\">[[ -z $SILENT ]] &amp;&amp; echo &quot;====&gt; Generating new SSL CSR $&#123;SSL_CSR&#125;&quot;</span><br><span class=\"line\">openssl req -sha256 -new -key $&#123;SSL_KEY&#125; -out $&#123;SSL_CSR&#125; \\</span><br><span class=\"line\">-subj &quot;/CN=$&#123;SSL_SUBJECT&#125;&quot; -config $&#123;SSL_CONFIG&#125; &gt; /dev/null || exit 1</span><br><span class=\"line\"></span><br><span class=\"line\">[[ -z $SILENT ]] &amp;&amp; echo &quot;====&gt; Generating new SSL CERT $&#123;SSL_CERT&#125;&quot;</span><br><span class=\"line\">openssl x509 -sha256 -req -in $&#123;SSL_CSR&#125; -CA $&#123;CA_CERT&#125; \\</span><br><span class=\"line\">    -CAkey $&#123;CA_KEY&#125; -CAcreateserial -out $&#123;SSL_CERT&#125; \\</span><br><span class=\"line\">    -days $&#123;SSL_EXPIRE&#125; -extensions v3_req \\</span><br><span class=\"line\">    -extfile $&#123;SSL_CONFIG&#125; &gt; /dev/null || exit 1</span><br><span class=\"line\"></span><br><span class=\"line\">if [[ -z $SILENT ]]; then</span><br><span class=\"line\">echo &quot;====&gt; Complete&quot;</span><br><span class=\"line\">echo &quot;keys can be found in volume mapped to $(pwd)&quot;</span><br><span class=\"line\">echo</span><br><span class=\"line\">echo &quot;====&gt; Output results as YAML&quot;</span><br><span class=\"line\">echo &quot;---&quot;</span><br><span class=\"line\">echo &quot;ca_key: |&quot;</span><br><span class=\"line\">cat $CA_KEY | sed &#x27;s/^/  /&#x27;</span><br><span class=\"line\">echo</span><br><span class=\"line\">echo &quot;ca_cert: |&quot;</span><br><span class=\"line\">cat $CA_CERT | sed &#x27;s/^/  /&#x27;</span><br><span class=\"line\">echo</span><br><span class=\"line\">echo &quot;ssl_key: |&quot;</span><br><span class=\"line\">cat $SSL_KEY | sed &#x27;s/^/  /&#x27;</span><br><span class=\"line\">echo</span><br><span class=\"line\">echo &quot;ssl_csr: |&quot;</span><br><span class=\"line\">cat $SSL_CSR | sed &#x27;s/^/  /&#x27;</span><br><span class=\"line\">echo</span><br><span class=\"line\">echo &quot;ssl_cert: |&quot;</span><br><span class=\"line\">cat $SSL_CERT | sed &#x27;s/^/  /&#x27;</span><br><span class=\"line\">echo</span><br><span class=\"line\">fi</span><br><span class=\"line\"></span><br><span class=\"line\">if [[ -n $K8S_SECRET_NAME ]]; then</span><br><span class=\"line\"></span><br><span class=\"line\">  if [[ -n $K8S_SECRET_COMBINE_CA ]]; then</span><br><span class=\"line\">    [[ -z $SILENT ]] &amp;&amp; echo &quot;====&gt; Adding CA to Cert file&quot;</span><br><span class=\"line\">    cat $&#123;CA_CERT&#125; &gt;&gt; $&#123;SSL_CERT&#125;</span><br><span class=\"line\">  fi</span><br><span class=\"line\"></span><br><span class=\"line\">  [[ -z $SILENT ]] &amp;&amp; echo &quot;====&gt; Creating Kubernetes secret: $K8S_SECRET_NAME&quot;</span><br><span class=\"line\">  kubectl delete secret $K8S_SECRET_NAME --ignore-not-found</span><br><span class=\"line\"></span><br><span class=\"line\">  if [[ -n $K8S_SECRET_SEPARATE_CA ]]; then</span><br><span class=\"line\">    kubectl create secret generic \\</span><br><span class=\"line\">    $K8S_SECRET_NAME \\</span><br><span class=\"line\">    --from-file=&quot;tls.crt=$&#123;SSL_CERT&#125;&quot; \\</span><br><span class=\"line\">    --from-file=&quot;tls.key=$&#123;SSL_KEY&#125;&quot; \\</span><br><span class=\"line\">    --from-file=&quot;ca.crt=$&#123;CA_CERT&#125;&quot;</span><br><span class=\"line\">  else</span><br><span class=\"line\">    kubectl create secret tls \\</span><br><span class=\"line\">    $K8S_SECRET_NAME \\</span><br><span class=\"line\">    --cert=$&#123;SSL_CERT&#125; \\</span><br><span class=\"line\">    --key=$&#123;SSL_KEY&#125;</span><br><span class=\"line\">  fi</span><br><span class=\"line\"></span><br><span class=\"line\">  if [[ -n $K8S_SECRET_LABELS ]]; then</span><br><span class=\"line\">    [[ -z $SILENT ]] &amp;&amp; echo &quot;====&gt; Labeling Kubernetes secret&quot;</span><br><span class=\"line\">    IFS=$&#x27; \\n\\t&#x27; # We have to reset IFS or label secret will misbehave on some systems</span><br><span class=\"line\">    kubectl label secret \\</span><br><span class=\"line\">      $K8S_SECRET_NAME \\</span><br><span class=\"line\">      $K8S_SECRET_LABELS</span><br><span class=\"line\">  fi</span><br><span class=\"line\">fi</span><br><span class=\"line\"></span><br><span class=\"line\">echo &quot;4. 重命名服务证书&quot;</span><br><span class=\"line\">mv $&#123;CN&#125;.key tls.key</span><br><span class=\"line\">mv $&#123;CN&#125;.crt tls.crt</span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"","more":"<p>[TOC]</p>\n<h2 id=\"一、搭建CA服务\"><a href=\"#一、搭建CA服务\" class=\"headerlink\" title=\"一、搭建CA服务\"></a>一、搭建CA服务</h2><p>openssl 默认配置文件: <code> /etc/pki/tls/openssl.cnf</code></p>\n<h3 id=\"1、初始化目录\"><a href=\"#1、初始化目录\" class=\"headerlink\" title=\"1、初始化目录\"></a>1、初始化目录</h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> <span class=\"built_in\">cd</span> /etc/pki/CA</span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> mkdir certs crl newcerts private</span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> tree</span></span><br><span class=\"line\">.</span><br><span class=\"line\">|-- certs</span><br><span class=\"line\">|-- crl</span><br><span class=\"line\">|-- newcerts</span><br><span class=\"line\">`-- private</span><br><span class=\"line\"></span><br><span class=\"line\">4 directories, 0 files</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2、创建CA需要的文件\"><a href=\"#2、创建CA需要的文件\" class=\"headerlink\" title=\"2、创建CA需要的文件\"></a>2、创建CA需要的文件</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># touch index.txt</span></span><br><span class=\"line\"><span class=\"comment\"># echo 01 &gt; serial</span></span><br><span class=\"line\"><span class=\"comment\"># ll</span></span><br><span class=\"line\">total 20</span><br><span class=\"line\">drwx--x--x 2 root root 4096 Dec 18 02:59 certs</span><br><span class=\"line\">drwx--x--x 2 root root 4096 Dec 18 02:59 crl</span><br><span class=\"line\">-rw------- 1 root root    0 Dec 18 02:59 index.txt</span><br><span class=\"line\">drwx--x--x 2 root root 4096 Dec 18 02:59 newcerts</span><br><span class=\"line\">drwx--x--x 2 root root 4096 Dec 18 02:59 private</span><br><span class=\"line\">-rw------- 1 root root    3 Dec 18 03:00 serial</span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"3、给CA创建私钥\"><a href=\"#3、给CA创建私钥\" class=\"headerlink\" title=\"3、给CA创建私钥\"></a>3、给CA创建私钥</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># pwd</span></span><br><span class=\"line\">/etc/pki/CA</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># (umask 066;openssl genrsa -out private/cakey.pem 2048)</span></span><br><span class=\"line\">Generating RSA private key, 2048 bit long modulus</span><br><span class=\"line\">........+++</span><br><span class=\"line\">.................+++</span><br><span class=\"line\">e is 65537 (0x10001)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># tree</span></span><br><span class=\"line\">.</span><br><span class=\"line\">|-- certs</span><br><span class=\"line\">|-- crl</span><br><span class=\"line\">|-- index.txt</span><br><span class=\"line\">|-- newcerts</span><br><span class=\"line\">|-- private</span><br><span class=\"line\">|   `-- cakey.pem</span><br><span class=\"line\">`-- serial</span><br><span class=\"line\"></span><br><span class=\"line\">4 directories, 3 files</span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"4、给CA生成自签名证书\"><a href=\"#4、给CA生成自签名证书\" class=\"headerlink\" title=\"4、给CA生成自签名证书\"></a>4、给CA生成自签名证书</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># openssl req -new -x509 -key private&#x2F;cakey.pem -days 7300 -out cacert.pem</span><br><span class=\"line\"></span><br><span class=\"line\">You are about to be asked to enter information that will be incorporated</span><br><span class=\"line\">into your certificate request.</span><br><span class=\"line\">What you are about to enter is what is called a Distinguished Name or a DN.</span><br><span class=\"line\">There are quite a few fields but you can leave some blank</span><br><span class=\"line\">For some fields there will be a default value,</span><br><span class=\"line\">If you enter &#39;.&#39;, the field will be left blank.</span><br><span class=\"line\">-----</span><br><span class=\"line\">Country Name (2 letter code) [CN]:</span><br><span class=\"line\">State or Province Name (full name) [ZheJiang]:</span><br><span class=\"line\">Locality Name (eg, city) [HangZhou]:</span><br><span class=\"line\">Organization Name (eg, company) [ZTYC]:</span><br><span class=\"line\">Organizational Unit Name (eg, section) [ztyc]:</span><br><span class=\"line\">Common Name (eg, your name or your server&#39;s hostname) []:</span><br><span class=\"line\">Email Address []:</span><br><span class=\"line\"></span><br><span class=\"line\"># ls</span><br><span class=\"line\">cacert.pem  certs  crl  index.txt  newcerts  private  serial</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"二、使用CA给客户颁发证书\"><a href=\"#二、使用CA给客户颁发证书\" class=\"headerlink\" title=\"二、使用CA给客户颁发证书\"></a>二、使用CA给客户颁发证书</h2><h3 id=\"1、客户机生成私钥\"><a href=\"#1、客户机生成私钥\" class=\"headerlink\" title=\"1、客户机生成私钥\"></a>1、客户机生成私钥</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">client opt]<span class=\"comment\"># (umask 066;openssl genrsa -out wms.qa.ops.com.key 2048)</span></span><br><span class=\"line\"></span><br><span class=\"line\">Generating RSA private key, 2048 bit long modulus</span><br><span class=\"line\">..............+++</span><br><span class=\"line\">.........................................................................+++</span><br><span class=\"line\">e is 65537 (0x10001)</span><br><span class=\"line\"></span><br><span class=\"line\">client opt]<span class=\"comment\"># ls</span></span><br><span class=\"line\">wms.qa.ops.com.key</span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"2、生成证书申请文件\"><a href=\"#2、生成证书申请文件\" class=\"headerlink\" title=\"2、生成证书申请文件\"></a>2、生成证书申请文件</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">client opt]<span class=\"comment\"># openssl req -new -key wms.qa.ops.com.key -days 365 -out wms.qa.ops.com.csr</span></span><br><span class=\"line\"></span><br><span class=\"line\">You are about to be asked to enter information that will be incorporated</span><br><span class=\"line\">into your certificate request.</span><br><span class=\"line\">What you are about to enter is what is called a Distinguished Name or a DN.</span><br><span class=\"line\">There are quite a few fields but you can leave some blank</span><br><span class=\"line\">For some fields there will be a default value,</span><br><span class=\"line\">If you enter <span class=\"string\">&#x27;.&#x27;</span>, the field will be left blank.</span><br><span class=\"line\">-----</span><br><span class=\"line\">Country Name (2 letter code) [CN]:</span><br><span class=\"line\">State or Province Name (full name) [ZheJiang]:</span><br><span class=\"line\">Locality Name (eg, city) [HangZhou]:</span><br><span class=\"line\">Organization Name (eg, company) [ZTYC]:</span><br><span class=\"line\">Organizational Unit Name (eg, section) [ztyc]:</span><br><span class=\"line\">Common Name (eg, your name or your server<span class=\"string\">&#x27;s hostname) []:wms.qa.ops.com</span></span><br><span class=\"line\"><span class=\"string\">Email Address []:</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">Please enter the following &#x27;</span>extra<span class=\"string\">&#x27; attributes</span></span><br><span class=\"line\"><span class=\"string\">to be sent with your certificate request</span></span><br><span class=\"line\"><span class=\"string\">A challenge password []:</span></span><br><span class=\"line\"><span class=\"string\">An optional company name []:</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">client opt]#ls</span></span><br><span class=\"line\"><span class=\"string\">wms.qa.ops.com.csr  wms.qa.ops.com.key</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"3、将证书申请文件传输到CA服务器上\"><a href=\"#3、将证书申请文件传输到CA服务器上\" class=\"headerlink\" title=\"3、将证书申请文件传输到CA服务器上\"></a>3、将证书申请文件传输到CA服务器上</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># pwd</span></span><br><span class=\"line\">/etc/pki/CA</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ls crl/</span></span><br><span class=\"line\">wms.qa.ops.com.csr</span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"4、在CA上给申请签证的客户签署证书\"><a href=\"#4、在CA上给申请签证的客户签署证书\" class=\"headerlink\" title=\"4、在CA上给申请签证的客户签署证书\"></a>4、在CA上给申请签证的客户签署证书</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># pwd</span><br><span class=\"line\">&#x2F;etc&#x2F;pki&#x2F;CA</span><br><span class=\"line\"></span><br><span class=\"line\"># openssl ca -in crl&#x2F;wms.qa.ops.com.csr -out certs&#x2F;wms.qa.ops.com.crt -days 365</span><br><span class=\"line\"></span><br><span class=\"line\">Using configuration from &#x2F;etc&#x2F;pki&#x2F;tls&#x2F;openssl.cnf</span><br><span class=\"line\">Check that the request matches the signature</span><br><span class=\"line\">Signature ok</span><br><span class=\"line\">Certificate Details:</span><br><span class=\"line\">        Serial Number: 1 (0x1)</span><br><span class=\"line\">        Validity</span><br><span class=\"line\">            Not Before: Dec 18 03:33:30 2019 GMT</span><br><span class=\"line\">            Not After : Dec 17 03:33:30 2020 GMT</span><br><span class=\"line\">        Subject:</span><br><span class=\"line\">            countryName               &#x3D; CN</span><br><span class=\"line\">            stateOrProvinceName       &#x3D; ZheJiang</span><br><span class=\"line\">            organizationName          &#x3D; ZTYC</span><br><span class=\"line\">            organizationalUnitName    &#x3D; ztyc</span><br><span class=\"line\">            commonName                &#x3D; wms.qa.ops.com</span><br><span class=\"line\">        X509v3 extensions:</span><br><span class=\"line\">            X509v3 Basic Constraints: </span><br><span class=\"line\">                CA:FALSE</span><br><span class=\"line\">            Netscape Comment: </span><br><span class=\"line\">                OpenSSL Generated Certificate</span><br><span class=\"line\">            X509v3 Subject Key Identifier: </span><br><span class=\"line\">                B2:35:6B:B9:16:86:4C:76:99:C8:27:64:7A:60:FC:B0:82:59:64:8A</span><br><span class=\"line\">            X509v3 Authority Key Identifier: </span><br><span class=\"line\">                keyid:70:EB:D1:7E:7A:D0:29:AE:65:10:73:D3:16:7D:6C:CD:12:C8:F1:FB</span><br><span class=\"line\"></span><br><span class=\"line\">Certificate is to be certified until Dec 17 03:33:30 2020 GMT (365 days)</span><br><span class=\"line\">Sign the certificate? [y&#x2F;n]:y</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">1 out of 1 certificate requests certified, commit? [y&#x2F;n]y</span><br><span class=\"line\">Write out database with 1 new entries</span><br><span class=\"line\">Data Base Updated</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"5、将CA上将签署好的证书传输给申请的客户\"><a href=\"#5、将CA上将签署好的证书传输给申请的客户\" class=\"headerlink\" title=\"5、将CA上将签署好的证书传输给申请的客户\"></a>5、将CA上将签署好的证书传输给申请的客户</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">client opt]<span class=\"comment\"># ls </span></span><br><span class=\"line\">wms.qa.ops.com.crt  wms.qa.ops.com.csr  wms.qa.ops.com.key</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"6、查看颁发的证书\"><a href=\"#6、查看颁发的证书\" class=\"headerlink\" title=\"6、查看颁发的证书\"></a>6、查看颁发的证书</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">client opt]<span class=\"comment\"># openssl x509 -in wms.qa.ops.com.crt -noout -text</span></span><br><span class=\"line\"></span><br><span class=\"line\">Certificate:</span><br><span class=\"line\">    Data:</span><br><span class=\"line\">        Version: 3 (0x2)</span><br><span class=\"line\">        Serial Number: 1 (0x1)</span><br><span class=\"line\">    Signature Algorithm: sha256WithRSAEncryption</span><br><span class=\"line\">        Issuer: C=CN, ST=ZheJiang, L=HangZhou, O=ZTYC, OU=ztyc</span><br><span class=\"line\">        Validity</span><br><span class=\"line\">            Not Before: Dec 18 03:33:30 2019 GMT</span><br><span class=\"line\">            Not After : Dec 17 03:33:30 2020 GMT</span><br><span class=\"line\">        Subject: C=CN, ST=ZheJiang, O=ZTYC, OU=ztyc, CN=wms.qa.ops.com</span><br><span class=\"line\">        Subject Public Key Info:</span><br><span class=\"line\">            Public Key Algorithm: rsaEncryption</span><br><span class=\"line\">                Public-Key: (2048 bit)</span><br><span class=\"line\">                Modulus:</span><br><span class=\"line\">                    00:b9:20:cf:dc:bc:d4:06:b6:a0:15:1a:22:52:21:</span><br><span class=\"line\">                    1f:64:c1:81:90:47:83:70:21:00:0a:ba:2a:ac:00:</span><br><span class=\"line\">                    22:3d:3d:c3:d7:4a:2c:51:11:5e:df:e8:6c:41:2e:</span><br><span class=\"line\">.....</span><br><span class=\"line\">.....</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"7、crt转pem格式\"><a href=\"#7、crt转pem格式\" class=\"headerlink\" title=\"7、crt转pem格式\"></a>7、crt转pem格式</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">client opt]<span class=\"comment\"># openssl x509 -in wms.qa.ops.com.crt -inform DER -outform PEM -out wms.qa.ops.com.pem</span></span><br><span class=\"line\">client opt]<span class=\"comment\"># ls</span></span><br><span class=\"line\">wms.qa.ops.com.crt  wms.qa.ops.com.csr  wms.qa.ops.com.key  wms.qa.ops.com.pem</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"8、证书转换为PKCS12文件\"><a href=\"#8、证书转换为PKCS12文件\" class=\"headerlink\" title=\"8、证书转换为PKCS12文件\"></a>8、证书转换为PKCS12文件</h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">client opt]# openssl pkcs12 -export -clcerts -in wms.qa.ops.com.crt \\</span><br><span class=\"line\">-inkey wms.qa.ops.com.key -out wms.qa.ops.com.key.p12</span><br><span class=\"line\">client opt]# ls</span><br><span class=\"line\">wms.qa.ops.com.crt  wms.qa.ops.com.csr  wms.qa.ops.com.key  wms.qa.ops.com.pem   wms.qa.ops.com.key.p12</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"三、CA上吊销证书\"><a href=\"#三、CA上吊销证书\" class=\"headerlink\" title=\"三、CA上吊销证书\"></a>三、CA上吊销证书</h2><h3 id=\"查看证书的serial以及subject信息\"><a href=\"#查看证书的serial以及subject信息\" class=\"headerlink\" title=\"查看证书的serial以及subject信息\"></a>查看证书的serial以及subject信息</h3><p>1、在申请吊销证书的客户机上查看需要吊销的证书的serial以及subject信息，并提交给CA</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">client opt]<span class=\"comment\"># openssl x509 -in qa.ops.com.crt -noout -serial -subject</span></span><br><span class=\"line\">serial=03</span><br><span class=\"line\">subject= /C=CN/ST=ZheJiang/O=ZTYC/OU=ops/CN=qa.ops.com/emailAddress=ops@ztyc.com</span><br></pre></td></tr></table></figure>\n\n<p>2、在CA上根据客户提交的serial以及subject信息，比对服务器上index.txt文件中的信息一致后，执行吊销证书操作</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># pwd</span></span><br><span class=\"line\">/etc/pki/CA</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># openssl x509 -in certs/qa.ops.com.crt -noout -serial -subject</span></span><br><span class=\"line\">serial=03</span><br><span class=\"line\">subject= /C=CN/ST=ZheJiang/O=ZTYC/OU=ops/CN=qa.ops.com/emailAddress=ops@ztyc.com</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># cat index.txt</span></span><br><span class=\"line\"></span><br><span class=\"line\">V\t291215081847Z\t\t03\tunknown\t/C=CN/ST=ZheJiang/O=ZTYC/OU=ops/CN=qa.ops.com/emailAddress=ops@ztyc.com</span><br></pre></td></tr></table></figure>\n\n<p>3、信息确认一致，正式执行吊销操作</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># openssl ca -revoke newcerts/03.pem </span></span><br><span class=\"line\">Using configuration from /etc/pki/tls/openssl.cnf</span><br><span class=\"line\">Revoking Certificate 03.</span><br><span class=\"line\">Data Base Updated</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>4、生成吊销证书的编号（第一次吊销证书时才需要执行本操作)</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># pwd</span></span><br><span class=\"line\">/etc/pki/CA</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># echo 01 &gt; crlnumber</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># openssl ca -gencrl -out crl/qa.ops.com.csr </span></span><br><span class=\"line\">Using configuration from /etc/pki/tls/openssl.cnf</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># openssl crl -in crl/qa.ops.com.csr -noout -text</span></span><br><span class=\"line\">Certificate Revocation List (CRL):</span><br><span class=\"line\">        Version 2 (0x1)</span><br><span class=\"line\">    Signature Algorithm: sha256WithRSAEncryption</span><br><span class=\"line\">        Issuer: /C=CN/ST=ZheJiang/L=HangZhou/O=ZTYC/OU=ztyc</span><br><span class=\"line\">        Last Update: Dec 18 08:32:01 2019 GMT</span><br><span class=\"line\">        Next Update: Jan 17 08:32:01 2020 GMT</span><br><span class=\"line\">        CRL extensions:</span><br><span class=\"line\">            X509v3 CRL Number: </span><br><span class=\"line\">                1</span><br><span class=\"line\">Revoked Certificates:</span><br><span class=\"line\">    Serial Number: 01</span><br><span class=\"line\">        Revocation Date: Dec 18 08:29:24 2019 GMT</span><br><span class=\"line\">    Serial Number: 03</span><br><span class=\"line\">        Revocation Date: Dec 18 08:29:31 2019 GMT</span><br><span class=\"line\">    Signature Algorithm: sha256WithRSAEncryption</span><br><span class=\"line\">         5e:68:d9:a1:ef:1d:7f:83:23:a4:57:95:19:1b:7a:36:82:cc:</span><br><span class=\"line\">         3a:2a:73:d8:1d:77:03:1a:e5:fd:5d:40:a8:e2:0a:af:34:d7:</span><br><span class=\"line\">         04:e5:7e:a8:c6:58:36:34:33:d7:79:bf:e0:07:29:f3:72:5b:</span><br><span class=\"line\">         e8:5d:f4:06:ba:e3:1f:00:2e:f5:4b:47:18:7c:e1:0d:00:3e:</span><br><span class=\"line\">         2e:13:eb:57:06:be:7f:48:5a:13:ef:62:cc:1e:92:76:22:f3:</span><br><span class=\"line\">         c2:6b:d0:12:e0:26:4c:33:be:fe:fd:14:de:77:da:6a:20:ce:</span><br><span class=\"line\">         f5:41:6e:e7:f1:e0:5d:d1:4f:91:e3:97:49:0d:a4:c9:0d:c4:</span><br><span class=\"line\">         <span class=\"built_in\">cd</span>:3a:51:5f:31:5b:ed:<span class=\"built_in\">fc</span>:55:9f:6b:9c:72:c9:7d:92:25:7b:</span><br><span class=\"line\">         e8:ec:e0:96:b6:98:96:ac:b7:63:40:d5:ec:b7:09:74:e9:c0:</span><br><span class=\"line\">         96:b6:2c:55:4b:de:fa:fa:2c:74:2e:f8:96:2e:4f:bc:5f:d2:</span><br><span class=\"line\">         0b:15:1a:6d:1f:e7:1e:8b:d3:af:51:d6:ca:2d:90:9f:9f:03:</span><br><span class=\"line\">         c2:da:03:f7:0f:a5:6a:e4:f7:3d:25:a1:06:05:c4:de:5e:62:</span><br><span class=\"line\">         5e:a5:7d:25:7e:9c:16:82:7f:21:28:d0:a3:d6:5c:e7:26:48:</span><br><span class=\"line\">         03:e0:93:84:fb:f3:b3:0a:d9:e6:35:3e:ae:d7:9f:65:b5:b6:</span><br><span class=\"line\">         fa:6a:69:67</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"四、在浏览器中访问\"><a href=\"#四、在浏览器中访问\" class=\"headerlink\" title=\"四、在浏览器中访问\"></a>四、在浏览器中访问</h2><p>在浏览器中打开https://<domain_name>来访问。</p>\n<p>在Firefox浏览器中可以添加 Security Exception 来忽略HTTPS错误警告。</p>\n<p>Chrome浏览器可以尝试通过导入CA证书的方式来忽略HTTPS错误警告。</p>\n<blockquote>\n<p>注意：Chrome 浏览器可能有导入CA证书后仍然无法访问的问题；不同浏览器对自签名SSL证书的检查和限制也有所区别。</p>\n</blockquote>\n<h2 id=\"五、脚本\"><a href=\"#五、脚本\" class=\"headerlink\" title=\"五、脚本\"></a>五、脚本</h2><h3 id=\"一、结合上面文档使用\"><a href=\"#一、结合上面文档使用\" class=\"headerlink\" title=\"一、结合上面文档使用\"></a>一、结合上面文档使用</h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">!/bin/bash -e</span></span><br><span class=\"line\"></span><br><span class=\"line\">SSL_IP=&#x27;&#x27;</span><br><span class=\"line\">SSL_DNS=&#x27;wms.qa.opt.com&#x27;</span><br><span class=\"line\">CN=$&#123;SSL_DNS&#125;</span><br><span class=\"line\">SSL_SIZE=2048</span><br><span class=\"line\"></span><br><span class=\"line\">DATE=$&#123;DATE:-3650&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">SSL_CONFIG=&#x27;openssl.cnf&#x27;</span><br><span class=\"line\">SSL_SUBJECT=&quot;/C=CN/ST=ZheJiang/L=HangZhou/O=ZTYC/OU=ops/CN=$&#123;CN&#125;/emailAddress=ops@ztyc.com&quot;</span><br><span class=\"line\">CA_DIR=&#x27;/etc/pki/CA&#x27;</span><br><span class=\"line\"></span><br><span class=\"line\">if [[ -z $SILENT ]]; then</span><br><span class=\"line\">echo &quot;----------------------------&quot;</span><br><span class=\"line\">echo &quot;| SSL Cert Generator |&quot;</span><br><span class=\"line\">echo &quot;----------------------------&quot;</span><br><span class=\"line\">echo</span><br><span class=\"line\">fi</span><br><span class=\"line\"></span><br><span class=\"line\">export SSL_DNS=$&#123;SSL_DNS&#125;</span><br><span class=\"line\">export SSL_IP=$&#123;SSL_IP&#125;</span><br><span class=\"line\">export SSL_KEY=$CN.key</span><br><span class=\"line\">export SSL_CSR=$CN.csr</span><br><span class=\"line\">export SSL_SUBJECT=$&#123;SSL_SUBJECT&#125;</span><br><span class=\"line\">export CA_DIR=$&#123;CA_DIR&#125;</span><br><span class=\"line\">export SSL_CERT=$CN.crt</span><br><span class=\"line\">export SSL_PEM=$CN.pem</span><br><span class=\"line\"></span><br><span class=\"line\">dir=$(pwd)</span><br><span class=\"line\">echo -e &quot;The current working directory is \\033[36m $&#123;dir&#125; \\033[0m&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">echo &quot;====&gt; Generating new config file $&#123;SSL_CONFIG&#125;&quot;</span><br><span class=\"line\">cat &gt; $&#123;SSL_CONFIG&#125; &lt;&lt;EOM</span><br><span class=\"line\">[req]</span><br><span class=\"line\">req_extensions = v3_req</span><br><span class=\"line\">distinguished_name = req_distinguished_name</span><br><span class=\"line\">[req_distinguished_name]</span><br><span class=\"line\">[ v3_req ]</span><br><span class=\"line\">basicConstraints = CA:FALSE</span><br><span class=\"line\">keyUsage = nonRepudiation, digitalSignature, keyEncipherment</span><br><span class=\"line\">extendedKeyUsage = clientAuth, serverAuth</span><br><span class=\"line\">EOM</span><br><span class=\"line\"></span><br><span class=\"line\">if [[ -n $&#123;SSL_DNS&#125; || -n $&#123;SSL_IP&#125; ]]; then</span><br><span class=\"line\">cat &gt;&gt; $&#123;SSL_CONFIG&#125; &lt;&lt;EOM</span><br><span class=\"line\">subjectAltName = @alt_names</span><br><span class=\"line\">[alt_names]</span><br><span class=\"line\">EOM</span><br><span class=\"line\">    IFS=&quot;,&quot;</span><br><span class=\"line\">    dns=($&#123;SSL_DNS&#125;)</span><br><span class=\"line\">    for i in &quot;$&#123;!dns[@]&#125;&quot;; do</span><br><span class=\"line\">      echo DNS.$((i+1)) = $&#123;dns[$i]&#125; &gt;&gt; $&#123;SSL_CONFIG&#125;</span><br><span class=\"line\">    done</span><br><span class=\"line\"></span><br><span class=\"line\">    if [[ -n $&#123;SSL_IP&#125; ]]; then</span><br><span class=\"line\">        ip=($&#123;SSL_IP&#125;)</span><br><span class=\"line\">        for i in &quot;$&#123;!ip[@]&#125;&quot;; do</span><br><span class=\"line\">          echo IP.$((i+1)) = $&#123;ip[$i]&#125; &gt;&gt; $&#123;SSL_CONFIG&#125;</span><br><span class=\"line\">        done</span><br><span class=\"line\">    fi</span><br><span class=\"line\">fi</span><br><span class=\"line\"></span><br><span class=\"line\">[[ -z $SILENT ]] &amp;&amp; echo &quot;====&gt; Generating new SSL KEY $&#123;SSL_KEY&#125;&quot;</span><br><span class=\"line\">echo -e &quot;\\033[36m openssl genrsa -out $&#123;SSL_KEY&#125; $&#123;SSL_SIZE&#125; \\033[0m&quot;</span><br><span class=\"line\">openssl genrsa -out $&#123;SSL_KEY&#125; $&#123;SSL_SIZE&#125; &gt; /dev/null || exit 1</span><br><span class=\"line\"></span><br><span class=\"line\">[[ -z $SILENT ]] &amp;&amp; echo &quot;====&gt; Generating new SSL CSR $&#123;SSL_CSR&#125;&quot;</span><br><span class=\"line\">echo -e &quot;\\033[36m openssl req -sha256 -new -key $&#123;SSL_KEY&#125; -out $&#123;SSL_CSR&#125; -subj \\&quot;$&#123;SSL_SUBJECT&#125;\\&quot; -config $&#123;SSL_CONFIG&#125; \\033[0m&quot;</span><br><span class=\"line\">openssl req -sha256 -new -key $&#123;SSL_KEY&#125; -out $&#123;SSL_CSR&#125; \\</span><br><span class=\"line\">-subj &quot;$&#123;SSL_SUBJECT&#125;&quot; -config $&#123;SSL_CONFIG&#125; &gt; /dev/null || exit 1</span><br><span class=\"line\"></span><br><span class=\"line\">[[ -z $SILENT ]] &amp;&amp; echo &quot;====&gt; Generating new SSL CERT $&#123;SSL_CERT&#125;&quot;</span><br><span class=\"line\">\\cp $&#123;SSL_CSR&#125; $&#123;CA_DIR&#125;/crl</span><br><span class=\"line\">cd $&#123;CA_DIR&#125;</span><br><span class=\"line\">echo -e &quot;The current working directory is \\033[36m $(pwd)\\033[0m&quot;</span><br><span class=\"line\">echo -e &quot;\\033[36m openssl ca -in crl/$&#123;SSL_CSR&#125; -out certs/$&#123;SSL_CERT&#125;  -days $&#123;DATE&#125; \\033[0m&quot;</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">openssl ca -<span class=\"keyword\">in</span> crl/<span class=\"variable\">$&#123;SSL_CSR&#125;</span> -out certs/<span class=\"variable\">$&#123;SSL_CERT&#125;</span>  -days <span class=\"variable\">$&#123;DATE&#125;</span>  || <span class=\"built_in\">exit</span> 1</span></span><br><span class=\"line\">/usr/bin/expect &lt;&lt;END</span><br><span class=\"line\">  spawn openssl ca -in crl/$&#123;SSL_CSR&#125; -out certs/$&#123;SSL_CERT&#125;  -days $&#123;DATE&#125;</span><br><span class=\"line\">  expect &#123;</span><br><span class=\"line\">    &quot;*y/n]:&quot; &#123;send &quot;y\\r&quot;;exp_continue&#125;</span><br><span class=\"line\">    &quot;*y/n]&quot; &#123;send &quot;y\\r&quot;;exp_continue&#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">END</span><br><span class=\"line\">\\cp certs/$&#123;SSL_CERT&#125; $&#123;dir&#125;</span><br><span class=\"line\">cd $&#123;dir&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">echo -e &quot;The current working directory is \\033[36m $(pwd)\\033[0m&quot;</span><br><span class=\"line\">echo -e &quot;\\033[36m openssl x509 -in $&#123;SSL_CERT&#125; -out $&#123;SSL_PEM&#125; -outform PEM \\033[0m&quot;</span><br><span class=\"line\">openssl x509 -in $&#123;SSL_CERT&#125;  -out $&#123;SSL_PEM&#125; -outform PEM</span><br><span class=\"line\">ls</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">if [[ -z $SILENT ]]; then</span><br><span class=\"line\">echo &quot;====&gt; Complete&quot;</span><br><span class=\"line\">echo -e &quot;keys can be found in volume mapped to \\033[36m $(pwd)\\033[0m&quot;</span><br><span class=\"line\">echo</span><br><span class=\"line\">echo &quot;====&gt; Output results as YAML&quot;</span><br><span class=\"line\">openssl x509 -in $&#123;SSL_CERT&#125; -noout -text</span><br><span class=\"line\">fi</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"二、独立使用\"><a href=\"#二、独立使用\" class=\"headerlink\" title=\"二、独立使用\"></a>二、独立使用</h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">!/bin/bash -e</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> * 为必改项</span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> * 更换为你自己的域名</span></span><br><span class=\"line\">CN=&#x27;&#x27; # 例如: demo.rancher.com</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> 扩展信任IP或域名</span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"><span class=\"comment\"># 一般ssl证书只信任域名的访问请求，有时候需要使用ip去访问server，那么需要给ssl证书添加扩展IP，</span></span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"><span class=\"comment\"># 多个IP用逗号隔开。如果想多个域名访问，则添加扩展域名（SSL_DNS）,多个SSL_DNS用逗号隔开</span></span></span><br><span class=\"line\">SSL_IP=&#x27;&#x27; # 例如: 1.2.3.4</span><br><span class=\"line\">SSL_DNS=&#x27;&#x27; # 例如: demo.rancher.com</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> 国家名(2个字母的代号)</span></span><br><span class=\"line\">C=CN</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> 证书加密位数</span></span><br><span class=\"line\">SSL_SIZE=2048</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> 证书有效期</span></span><br><span class=\"line\">DATE=$&#123;DATE:-3650&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> 配置文件</span></span><br><span class=\"line\">SSL_CONFIG=&#x27;openssl.cnf&#x27;</span><br><span class=\"line\"></span><br><span class=\"line\">if [[ -z $SILENT ]]; then</span><br><span class=\"line\">echo &quot;----------------------------&quot;</span><br><span class=\"line\">echo &quot;| SSL Cert Generator |&quot;</span><br><span class=\"line\">echo &quot;----------------------------&quot;</span><br><span class=\"line\">echo</span><br><span class=\"line\">fi</span><br><span class=\"line\"></span><br><span class=\"line\">export CA_KEY=$&#123;CA_KEY-&quot;cakey.pem&quot;&#125;</span><br><span class=\"line\">export CA_CERT=$&#123;CA_CERT-&quot;cacerts.pem&quot;&#125;</span><br><span class=\"line\">export CA_SUBJECT=ca-$CN</span><br><span class=\"line\">export CA_EXPIRE=$&#123;DATE&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">export SSL_CONFIG=$&#123;SSL_CONFIG&#125;</span><br><span class=\"line\">export SSL_KEY=$CN.key</span><br><span class=\"line\">export SSL_CSR=$CN.csr</span><br><span class=\"line\">export SSL_CERT=$CN.crt</span><br><span class=\"line\">export SSL_EXPIRE=$&#123;DATE&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">export SSL_SUBJECT=$&#123;CN&#125;</span><br><span class=\"line\">export SSL_DNS=$&#123;SSL_DNS&#125;</span><br><span class=\"line\">export SSL_IP=$&#123;SSL_IP&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">export K8S_SECRET_COMBINE_CA=$&#123;K8S_SECRET_COMBINE_CA:-&#x27;true&#x27;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">[[ -z $SILENT ]] &amp;&amp; echo &quot;--&gt; Certificate Authority&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">if [[ -e ./$&#123;CA_KEY&#125; ]]; then</span><br><span class=\"line\">    [[ -z $SILENT ]] &amp;&amp; echo &quot;====&gt; Using existing CA Key $&#123;CA_KEY&#125;&quot;</span><br><span class=\"line\">else</span><br><span class=\"line\">    [[ -z $SILENT ]] &amp;&amp; echo &quot;====&gt; Generating new CA key $&#123;CA_KEY&#125;&quot;</span><br><span class=\"line\">    openssl genrsa -out $&#123;CA_KEY&#125; $&#123;SSL_SIZE&#125; &gt; /dev/null</span><br><span class=\"line\">fi</span><br><span class=\"line\"></span><br><span class=\"line\">if [[ -e ./$&#123;CA_CERT&#125; ]]; then</span><br><span class=\"line\">    [[ -z $SILENT ]] &amp;&amp; echo &quot;====&gt; Using existing CA Certificate $&#123;CA_CERT&#125;&quot;</span><br><span class=\"line\">else</span><br><span class=\"line\">    [[ -z $SILENT ]] &amp;&amp; echo &quot;====&gt; Generating new CA Certificate $&#123;CA_CERT&#125;&quot;</span><br><span class=\"line\">    openssl req -x509 -sha256 -new -nodes -key $&#123;CA_KEY&#125; \\</span><br><span class=\"line\">    -days $&#123;CA_EXPIRE&#125; -out $&#123;CA_CERT&#125; -subj &quot;/CN=$&#123;CA_SUBJECT&#125;&quot; &gt; /dev/null || exit 1</span><br><span class=\"line\">fi</span><br><span class=\"line\"></span><br><span class=\"line\">echo &quot;====&gt; Generating new config file $&#123;SSL_CONFIG&#125;&quot;</span><br><span class=\"line\">cat &gt; $&#123;SSL_CONFIG&#125; &lt;&lt;EOM</span><br><span class=\"line\">[req]</span><br><span class=\"line\">req_extensions = v3_req</span><br><span class=\"line\">distinguished_name = req_distinguished_name</span><br><span class=\"line\">[req_distinguished_name]</span><br><span class=\"line\">[ v3_req ]</span><br><span class=\"line\">basicConstraints = CA:FALSE</span><br><span class=\"line\">keyUsage = nonRepudiation, digitalSignature, keyEncipherment</span><br><span class=\"line\">extendedKeyUsage = clientAuth, serverAuth</span><br><span class=\"line\">EOM</span><br><span class=\"line\"></span><br><span class=\"line\">if [[ -n $&#123;SSL_DNS&#125; || -n $&#123;SSL_IP&#125; ]]; then</span><br><span class=\"line\">    cat &gt;&gt; $&#123;SSL_CONFIG&#125; &lt;&lt;EOM</span><br><span class=\"line\">subjectAltName = @alt_names</span><br><span class=\"line\">[alt_names]</span><br><span class=\"line\">EOM</span><br><span class=\"line\">    IFS=&quot;,&quot;</span><br><span class=\"line\">    dns=($&#123;SSL_DNS&#125;)</span><br><span class=\"line\">    dns+=($&#123;SSL_SUBJECT&#125;)</span><br><span class=\"line\">    for i in &quot;$&#123;!dns[@]&#125;&quot;; do</span><br><span class=\"line\">      echo DNS.$((i+1)) = $&#123;dns[$i]&#125; &gt;&gt; $&#123;SSL_CONFIG&#125;</span><br><span class=\"line\">    done</span><br><span class=\"line\"></span><br><span class=\"line\">    if [[ -n $&#123;SSL_IP&#125; ]]; then</span><br><span class=\"line\">        ip=($&#123;SSL_IP&#125;)</span><br><span class=\"line\">        for i in &quot;$&#123;!ip[@]&#125;&quot;; do</span><br><span class=\"line\">          echo IP.$((i+1)) = $&#123;ip[$i]&#125; &gt;&gt; $&#123;SSL_CONFIG&#125;</span><br><span class=\"line\">        done</span><br><span class=\"line\">    fi</span><br><span class=\"line\">fi</span><br><span class=\"line\"></span><br><span class=\"line\">[[ -z $SILENT ]] &amp;&amp; echo &quot;====&gt; Generating new SSL KEY $&#123;SSL_KEY&#125;&quot;</span><br><span class=\"line\">openssl genrsa -out $&#123;SSL_KEY&#125; $&#123;SSL_SIZE&#125; &gt; /dev/null || exit 1</span><br><span class=\"line\"></span><br><span class=\"line\">[[ -z $SILENT ]] &amp;&amp; echo &quot;====&gt; Generating new SSL CSR $&#123;SSL_CSR&#125;&quot;</span><br><span class=\"line\">openssl req -sha256 -new -key $&#123;SSL_KEY&#125; -out $&#123;SSL_CSR&#125; \\</span><br><span class=\"line\">-subj &quot;/CN=$&#123;SSL_SUBJECT&#125;&quot; -config $&#123;SSL_CONFIG&#125; &gt; /dev/null || exit 1</span><br><span class=\"line\"></span><br><span class=\"line\">[[ -z $SILENT ]] &amp;&amp; echo &quot;====&gt; Generating new SSL CERT $&#123;SSL_CERT&#125;&quot;</span><br><span class=\"line\">openssl x509 -sha256 -req -in $&#123;SSL_CSR&#125; -CA $&#123;CA_CERT&#125; \\</span><br><span class=\"line\">    -CAkey $&#123;CA_KEY&#125; -CAcreateserial -out $&#123;SSL_CERT&#125; \\</span><br><span class=\"line\">    -days $&#123;SSL_EXPIRE&#125; -extensions v3_req \\</span><br><span class=\"line\">    -extfile $&#123;SSL_CONFIG&#125; &gt; /dev/null || exit 1</span><br><span class=\"line\"></span><br><span class=\"line\">if [[ -z $SILENT ]]; then</span><br><span class=\"line\">echo &quot;====&gt; Complete&quot;</span><br><span class=\"line\">echo &quot;keys can be found in volume mapped to $(pwd)&quot;</span><br><span class=\"line\">echo</span><br><span class=\"line\">echo &quot;====&gt; Output results as YAML&quot;</span><br><span class=\"line\">echo &quot;---&quot;</span><br><span class=\"line\">echo &quot;ca_key: |&quot;</span><br><span class=\"line\">cat $CA_KEY | sed &#x27;s/^/  /&#x27;</span><br><span class=\"line\">echo</span><br><span class=\"line\">echo &quot;ca_cert: |&quot;</span><br><span class=\"line\">cat $CA_CERT | sed &#x27;s/^/  /&#x27;</span><br><span class=\"line\">echo</span><br><span class=\"line\">echo &quot;ssl_key: |&quot;</span><br><span class=\"line\">cat $SSL_KEY | sed &#x27;s/^/  /&#x27;</span><br><span class=\"line\">echo</span><br><span class=\"line\">echo &quot;ssl_csr: |&quot;</span><br><span class=\"line\">cat $SSL_CSR | sed &#x27;s/^/  /&#x27;</span><br><span class=\"line\">echo</span><br><span class=\"line\">echo &quot;ssl_cert: |&quot;</span><br><span class=\"line\">cat $SSL_CERT | sed &#x27;s/^/  /&#x27;</span><br><span class=\"line\">echo</span><br><span class=\"line\">fi</span><br><span class=\"line\"></span><br><span class=\"line\">if [[ -n $K8S_SECRET_NAME ]]; then</span><br><span class=\"line\"></span><br><span class=\"line\">  if [[ -n $K8S_SECRET_COMBINE_CA ]]; then</span><br><span class=\"line\">    [[ -z $SILENT ]] &amp;&amp; echo &quot;====&gt; Adding CA to Cert file&quot;</span><br><span class=\"line\">    cat $&#123;CA_CERT&#125; &gt;&gt; $&#123;SSL_CERT&#125;</span><br><span class=\"line\">  fi</span><br><span class=\"line\"></span><br><span class=\"line\">  [[ -z $SILENT ]] &amp;&amp; echo &quot;====&gt; Creating Kubernetes secret: $K8S_SECRET_NAME&quot;</span><br><span class=\"line\">  kubectl delete secret $K8S_SECRET_NAME --ignore-not-found</span><br><span class=\"line\"></span><br><span class=\"line\">  if [[ -n $K8S_SECRET_SEPARATE_CA ]]; then</span><br><span class=\"line\">    kubectl create secret generic \\</span><br><span class=\"line\">    $K8S_SECRET_NAME \\</span><br><span class=\"line\">    --from-file=&quot;tls.crt=$&#123;SSL_CERT&#125;&quot; \\</span><br><span class=\"line\">    --from-file=&quot;tls.key=$&#123;SSL_KEY&#125;&quot; \\</span><br><span class=\"line\">    --from-file=&quot;ca.crt=$&#123;CA_CERT&#125;&quot;</span><br><span class=\"line\">  else</span><br><span class=\"line\">    kubectl create secret tls \\</span><br><span class=\"line\">    $K8S_SECRET_NAME \\</span><br><span class=\"line\">    --cert=$&#123;SSL_CERT&#125; \\</span><br><span class=\"line\">    --key=$&#123;SSL_KEY&#125;</span><br><span class=\"line\">  fi</span><br><span class=\"line\"></span><br><span class=\"line\">  if [[ -n $K8S_SECRET_LABELS ]]; then</span><br><span class=\"line\">    [[ -z $SILENT ]] &amp;&amp; echo &quot;====&gt; Labeling Kubernetes secret&quot;</span><br><span class=\"line\">    IFS=$&#x27; \\n\\t&#x27; # We have to reset IFS or label secret will misbehave on some systems</span><br><span class=\"line\">    kubectl label secret \\</span><br><span class=\"line\">      $K8S_SECRET_NAME \\</span><br><span class=\"line\">      $K8S_SECRET_LABELS</span><br><span class=\"line\">  fi</span><br><span class=\"line\">fi</span><br><span class=\"line\"></span><br><span class=\"line\">echo &quot;4. 重命名服务证书&quot;</span><br><span class=\"line\">mv $&#123;CN&#125;.key tls.key</span><br><span class=\"line\">mv $&#123;CN&#125;.crt tls.crt</span><br></pre></td></tr></table></figure>\n\n"},{"title":"filebeat 使用","date":"2021-07-05T06:09:00.000Z","_content":"\t\n\t\n摘要: filebeat 使用\n<!-- more -->\n\n\n# filebeat 使用\n\n## 一、前言\n这里使用的7.7.0版本，在官方文档快速上手的中，只要简单配置了filelbeat.yml ，启动filebeat就可以收集日志了。\n\n```\n# 定义输入\nfilebeat.inputs:\n- type: log\n  enabled: true\n  paths:\n    - /var/log/*.log\n# 定义输出\noutput.elasticsearch:\n  hosts: [\"myEShost:9200\"]\n  username: \"filebeat_internal\"\n  password: \"YOUR_PASSWORD\" \nsetup.kibana:\n  host: \"mykibanahost:5601\"\n  username: \"my_kibana_user\"  \n  password: \"YOUR_PASSWORD\"\n```\n\n其实filebeat提供的可配置项有很多，这里就以大模块角度了解下其分类。 更多详细内容，[点击查看官网](https://www.elastic.co/guide/en/beats/filebeat/7.7/index.html)。\n\n\n## 二、参数配置分类\n\n### 1、 Paths\n用于定义Filebeat查找相关文件的位置。例如，Filebeat在config路径中查找启动文件，并在log路径中写入日志文件。Filebeat在data路径中查找其registry文件。\n\n用户可以不配置，使用默认的路径。也可以自定义配置路径：\n```\npath.home: /usr/share/filebeat\npath.config: /etc/filebeat\npath.data: /var/lib/filebeat\npath.logs: /var/log/\n```\n\n\n```\n#================================= Paths ======================================\n\n# The home path for the Filebeat installation. This is the default base path\n# for all other path settings and for miscellaneous files that come with the\n# distribution (for example, the sample dashboards).\n# If not set by a CLI flag or in the configuration file, the default for the\n# home path is the location of the binary.\n#path.home:\n\n# The configuration path for the Filebeat installation. This is the default\n# base path for configuration files, including the main YAML configuration file\n# and the Elasticsearch template file. If not set by a CLI flag or in the\n# configuration file, the default for the configuration path is the home path.\n#path.config: ${path.home}\n\n# The data path for the Filebeat installation. This is the default base path\n# for all the files in which Filebeat needs to store its data. If not set by a\n# CLI flag or in the configuration file, the default for the data path is a data\n# subdirectory inside the home path.\n#path.data: ${path.home}/data\n\n# The logs path for a Filebeat installation. This is the default location for\n# the Beat's log files. If not set by a CLI flag or in the configuration file,\n# the default for the logs path is a logs subdirectory inside the home path.\n#path.logs: ${path.home}/logs\n```\n\n#### 配置参数说明\n```\n1、path.home\nFilebeat安装的主路径。这是所有其他路径设置和发行版附带的其他文件（例如，示例仪表板）的默认基本路径。如果未设置，则主路径的默认值是Filebeat二进制文件的位置。\n\n2、path.config\nFilebeat安装的配置路径。这是配置文件的默认基本路径，包括主YAML配置文件和Elasticsearch模板文件。如果设置，则配置路径的默认值为{path.home}路径。\n\n3、path.data\nFilebeat的数据路径。这是Filebeat需要存储其数据的所有文件的默认基本路径。如果设置，则数据路径的默认值是{path.home}/data。\n\n注意： 每个filebeat实例的path.data必须是唯一的。\n\n4、path.log\nFilebeat的日志路径。这是Filebeat日志文件的默认位置。如果未设置，则日志路径的默认值为{path.home}/log。\n```\n\n#### 默认启动时的路径\n比如说用户在 /home/abc/work 路径下启动filebeat，那么path.home 就默认为 当前路径。并且可以看到 多了两个文件夹data和 log\n\n\n\n\n### 2、Modules configuration\nFilebeat模块简化了常见日志格式的收集、解析和可视化。典型的模块（比如Nginx日志）由一个或多个文件集组成（对于Nginx，是access和error），如果你启用了下面的module, fileabeat就可以根据系统自动去寻找access、error 对应的log文件进行收集。\n```\n- module: nginx\n  # Access logs\n  #access:\n    #enabled: true\n\n    # Set custom paths for the log files. If left empty,\n    # Filebeat will choose the paths depending on your OS.\n    #var.paths:\n\n    # Input configuration (advanced). Any input configuration option\n    # can be added under this section.\n    #input:\n```\n\nFilebeat会根据您的环境自动调整这些配置，并将它们加载到相应的Elastic stack组件中\n\n配置文件的方式：\n```\nfilebeat.config:\n  modules:\n    # 通过这里开启， 默认是关闭\n    enabled: true\n    path: modules.d/*.yml\n    reload.enabled: true\n    reload.period: 10s\n\n```\n\n\n### 3、Filebeat inputs\n如果你想手动配置Filebeat（而不是使用模块），可以在配置文件filebeat.inputs部分设置Filebeat采集源以及相关参数配置。每个输入源都以破折号（-）开头。用户可以指定多个输入源，并且可以多次指定同一输入类型。例如：\n```\nfilebeat.inputs:\n- type: log\n  paths:\n    - /var/log/system.log\n    - /var/log/wifi.log\n- type: log\n  paths:\n    - \"/var/log/apache2/*\"\n  fields:\n    apache: true\n  fields_under_root: true\n- type: tcp\n  max_message_size: 10MiB\n  host: \"localhost:9000\"\n```\n点击查看更多input 配置\n\n### 4、Filebeat autodiscover\n在容器上运行应用程序时，它们会成为监视系统的移动目标。“自动发现”允许您跟踪它们并在更改发生时调整设置。通过定义配置模板，自动发现子系统可以在服务开始运行时监视它们。\n```\nfilebeat.autodiscover:\n  List of enabled autodiscover providers\n providers:\n   - type: docker\n     templates:\n       - condition:\n           equals.docker.container.image: busybox\n         config:\n           - type: container\n             paths:\n               - /var/lib/docker/containers/${data.docker.container.id}/*.log\n```\n\n### 5、Filebeat global options\n定义publisher行为或者某些文件的位置信息，这些参数是filebeat根节点参数。比如register文件路径、或者是否启用modules、多个inputs等等\n```\n# Registry data path. If a relative path is used, it is considered relative to the\n# data path.\n#filebeat.registry.path: ${path.data}/registry\n\n# The permissions mask to apply on registry data, and meta files. The default\n# value is 0600.  Must be a valid Unix-style file permissions mask expressed in\n# octal notation.  This option is not supported on Windows.\n#filebeat.registry.file_permissions: 0600\n\n# The timeout value that controls when registry entries are written to disk\n# (flushed). When an unwritten update exceeds this value, it triggers a write\n# to disk. When flush is set to 0s, the registry is written to disk after each\n# batch of events has been published successfully. The default value is 0s.\n#filebeat.registry.flush: 0s\n\n\n# Starting with Filebeat 7.0, the registry uses a new directory format to store\n# Filebeat state. After you upgrade, Filebeat will automatically migrate a 6.x\n# registry file to use the new directory format. If you changed\n# filebeat.registry.path while upgrading, set filebeat.registry.migrate_file to\n# point to the old registry file.\n#filebeat.registry.migrate_file: ${path.data}/registry\n\n# By default Ingest pipelines are not updated if a pipeline with the same ID\n# already exists. If this option is enabled Filebeat overwrites pipelines\n# everytime a new Elasticsearch connection is established.\n#filebeat.overwrite_pipelines: false\n\n# How long filebeat waits on shutdown for the publisher to finish.\n# Default is 0, not waiting.\n#filebeat.shutdown_timeout: 0\n\n# Enable filebeat config reloading\n#filebeat.config:\n  #inputs:\n    #enabled: false\n    #path: inputs.d/*.yml\n    #reload.enabled: true\n    #reload.period: 10s\n  #modules:\n    #enabled: false\n    #path: modules.d/*.yml\n    #reload.enabled: true\n    #reload.period: 10s\n```\n\n#### 相关参数说明\nregistry文件夹里记录了filebeat当前采集文件的元信息（包含文件名、读取的offset、文件id等等）\n\n1、filebeat.registry.path\n如果不设置，默认路径是${path.data}/registry ，一般不设置 。\n\n2、filebeat.registry.file_permissions\nregistry文件操作权限码，默认是0600 ，如果没有特殊需求 使用默认值即可。注意：在windows上不支持此参数。\n\n3、filebeat.registry.flush\n默认值为0. 表示 当filebeat成功发送了采集的数据，立即刷新registry 。 用户可以合理设置刷新间隔， 减轻IO压力。\n\n4、filebeat.registry.migrate_file\n迁移文件路径： 从7.0后，registry存储方式和6.x的不一样。 如果你以前使用的是6.x版本的filebeat，然后想更新到7.x ，并且想沿用以前的registry信息，那么你可以使用这个参数：\n```\nfilebeat.registry.path: ${path.data}/registry\nfilebeat.registry.migrate_file: /path/to/old/registry_file\n```\n5、filebeat.shutdown_timeout\nFilebeat在关闭之前等待发布者完成发送事件的时间，然后Filebeat关闭。不建议设置该参数，因为确定shutdown_timeout的正确值很大程度上取决于Filebeat运行的环境以及输出的当前状态。\n\n6、filebeat.config\n可选配置 是否启动modules\n```\nfilebeat.config:\n  #modules:\n    #enabled: false\n    #path: modules.d/*.yml\n    #reload.enabled: true\n    #reload.period: 10s\n```\n如果你想在一个配置文件filebeat.yml里想采集复杂的多个log文件或者复杂输入源，你可以开启下面的配置（），然后自定义多个输入源文件即可。\n```\nfilebeat.config:\n  inputs:\n    enabled: true\n    path: inputs.d/*.yml\n    reload.enabled: true\n    reload.period: 10s\n```\n\n\n### 6、General\n所有Elastic Beats都支持这些选项。因为它们是通用选项，所以它们没有命名空间\n```\n#================================ General ======================================\n\n# The name of the shipper that publishes the network data. It can be used to group\n# all the transactions sent by a single shipper in the web interface.\n# If this options is not defined, the hostname is used.\n#name:\n\n# The tags of the shipper are included in their own field with each\n# transaction published. Tags make it easy to group servers by different\n# logical properties.\n#tags: [\"service-X\", \"web-tier\"]\n\n# Optional fields that you can specify to add additional information to the\n# output. Fields can be scalar values, arrays, dictionaries, or any nested\n# combination of these.\n#fields:\n#  env: staging\n\n# If this option is set to true, the custom fields are stored as top-level\n# fields in the output document instead of being grouped under a fields\n# sub-dictionary. Default is false.\n#fields_under_root: false\n\n# Internal queue configuration for buffering events to be published.\n#queue:\n  # Queue type by name (default 'mem')\n  # The memory queue will present all available events (up to the outputs\n  # bulk_max_size) to the output, the moment the output is ready to server\n  # another batch of events.\n  #mem:\n    # Max number of events the queue can buffer.\n    #events: 4096\n\n    # Hints the minimum number of events stored in the queue,\n    # before providing a batch of events to the outputs.\n    # The default value is set to 2048.\n    # A value of 0 ensures events are immediately available\n    # to be sent to the outputs.\n    #flush.min_events: 2048\n\n    # Maximum duration after which events are available to the outputs,\n    # if the number of events stored in the queue is < `flush.min_events`.\n    #flush.timeout: 1s\n\n  # The spool queue will store events in a local spool file, before\n  # forwarding the events to the outputs.\n  #\n  # Beta: spooling to disk is currently a beta feature. Use with care.\n  #\n  # The spool file is a circular buffer, which blocks once the file/buffer is full.\n  # Events are put into a write buffer and flushed once the write buffer\n  # is full or the flush_timeout is triggered.\n  # Once ACKed by the output, events are removed immediately from the queue,\n  # making space for new events to be persisted.\n  #spool:\n    # The file namespace configures the file path and the file creation settings.\n    # Once the file exists, the `size`, `page_size` and `prealloc` settings\n    # will have no more effect.\n    #file:\n      # Location of spool file. The default value is ${path.data}/spool.dat.\n      #path: \"${path.data}/spool.dat\"\n\n      # Configure file permissions if file is created. The default value is 0600.\n      #permissions: 0600\n\n      # File size hint. The spool blocks, once this limit is reached. The default value is 100 MiB.\n      #size: 100MiB\n\n      # The files page size. A file is split into multiple pages of the same size. The default value is 4KiB.\n      #page_size: 4KiB\n\n      # If prealloc is set, the required space for the file is reserved using\n      # truncate. The default value is true.\n      #prealloc: true\n\n    # Spool writer settings\n    # Events are serialized into a write buffer. The write buffer is flushed if:\n    # - The buffer limit has been reached.\n    # - The configured limit of buffered events is reached.\n    # - The flush timeout is triggered.\n    #write:\n      # Sets the write buffer size.\n      #buffer_size: 1MiB\n\n      # Maximum duration after which events are flushed if the write buffer\n      # is not full yet. The default value is 1s.\n      #flush.timeout: 1s\n\n      # Number of maximum buffered events. The write buffer is flushed once the\n      # limit is reached.\n      #flush.events: 16384\n\n      # Configure the on-disk event encoding. The encoding can be changed\n      # between restarts.\n      # Valid encodings are: json, ubjson, and cbor.\n      #codec: cbor\n    #read:\n      # Reader flush timeout, waiting for more events to become available, so\n      # to fill a complete batch as required by the outputs.\n      # If flush_timeout is 0, all available events are forwarded to the\n      # outputs immediately.\n      # The default value is 0s.\n      #flush.timeout: 0s\n\n# Sets the maximum number of CPUs that can be executing simultaneously. The\n# default is the number of logical CPUs available in the system.\n#max_procs:\n```\n\n#### 参数说明\n1、name\n默认是用服务器的主机名。该名称以agent.name字段而存在。\n\n2、tag\n为采集的日志消息定义tag信息标识，用于接收端处理响应的逻辑。\n```\ntags: [\"web-service\",\"info-file\"]\n```\n3、fields\n定义额外的字段信息，定义的字段以KV形式出现。默认是在fields下。\n\nfields: {project: \"credit\", env: \"prod\"}\n1\n如果设置了fields_under_root为true，那么自定义的KV 将作为根字段出现在发送的消息里。\n\n4、fields_under_root\n自定义的字段是否作为根字段。 使用实例\n```\nfields_under_root: true\nfields: {project: \"credit\", env: \"prod\"}\n```\n5、processors\nbeat提供的数据预处理 功能，如果定义了多个processors ，那么beat将会顺序执行。 更多定义的processor\n\n6、max_procs\n设置可以同时执行的最大CPU数。默认值为系统中可用的逻辑CPU的数量。\n\n\n### 7、 Processors\nbeat提供的数据预处理 功能，用于增强数据或者过滤数据。如果定义了多个processors ，那么beat将会顺序执行\n```\nevent -> processor 1 -> event1 -> processor 2 -> event2 ...\n```\n\n\n1、add_cloud_metadata\n添加云服务器实例元数据\n\n增加云服务器提供商的实例元数据来丰富每个事件。在启动时，它将查询托管提供程序的列表并缓存实例元数据。\n\n例如添加上这个配置\n```\nprocessors:\n  - add_cloud_metadata: ~\n```\n在阿里云上输出为\n```\n{\n  \"cloud\": {\n    \"availability_zone\": \"cn-shenzhen\",\n    \"instance.id\": \"i-wz9g2hqiikg0aliyun2b\",\n    \"provider\": \"ecs\",\n    \"region\": \"cn-shenzhen-a\"\n  }\n}\n```\n在腾讯云上输出为\n```\n{\n  \"cloud\": {\n    \"availability_zone\": \"gz-azone2\",\n    \"instance.id\": \"ins-qcloudv5\",\n    \"provider\": \"qcloud\",\n    \"region\": \"china-south-gz\"\n  }\n}\n```\n在aws上输出为\n```\n{\n  \"cloud\": {\n    \"account.id\": \"123456789012\",\n    \"availability_zone\": \"us-east-1c\",\n    \"instance.id\": \"i-4e123456\",\n    \"machine.type\": \"t2.medium\",\n    \"image.id\": \"ami-abcd1234\",\n    \"provider\": \"aws\",\n    \"region\": \"us-east-1\"\n  }\n}\n```\n\n2、add_cloudfoundry_metadata\n自动添加cloudfoundry应用程序的相关元数据\n\n该处理器使用来自cloudfoundry应用程序的相关元数据对每个事件进行增强。\n\n前提条件：只有当事件包含对CloudFoundry应用程序的引用（使用字段cloudfoundry.app.id)，并且配置了cloudfoundry客户端信息，才能能够检索应用程序的信息。\n\n配置示例：\n\n```\nprocessors:\n  - add_cloudfoundry_metadata:\n      api_address: https://api.dev.cfdev.sh\n      client_id: uaa-filebeat\n      client_secret: verysecret\n      ssl:\n        verification_mode: none\n      # To connect to Cloud Foundry over verified TLS you can specify a client and CA certificate.\n      #ssl:\n      #  certificate_authorities: [\"/etc/pki/cf/ca.pem\"]\n      #  certificate:              \"/etc/pki/cf/cert.pem\"\n      #  key:                      \"/etc/pki/cf/cert.key\"\n```\n\n\n3、add_docker_metadata\n自动添加docker容器相关元数据\n\nfilebeat在启动时，它检测一个docker环境元数据并缓存。只有在检测到有效配置并且处理器能够访问Docker API时，才会使用Docker元数据对事件数据进行追加。 目前在k8s场景下 一般使用log-pilot来协助采集日志。\n```\nprocessors:\n  - add_docker_metadata:\n      host: \"unix:///var/run/docker.sock\"\n      #match_fields: [\"system.process.cgroup.id\"]\n      #match_pids: [\"process.pid\", \"process.ppid\"]\n      #match_source: true\n      #match_source_index: 4\n      #match_short_id: true\n      #cleanup_timeout: 60\n      #labels.dedot: false\n      # To connect to Docker over TLS you must specify a client and CA certificate.\n      #ssl:\n      #  certificate_authority: \"/etc/pki/root/ca.pem\"\n      #  certificate:           \"/etc/pki/client/cert.pem\"\n      #  key:                   \"/etc/pki/client/cert.key\"\n```\n\n4、add_fields\n\n添加自定义字段信息\n\n添加字段信息（同这里用法类似），配置如下\n```\nprocessors:\n  - add_fields:\n      #  如果不指定，默认添加到 fields 里 \n      target: project\n      fields:\n        name: myproject\n        id: '574734885120952459'\n```\n输出为：\n```\n{\n  \"project\": {\n    \"name\": \"myproject\",\n    \"id\": \"574734885120952459\"\n  }\n}\n```\n\n5、add_host_metadata\n\n自动追加host相关信息，配置如下\n```\nprocessors:\n  - add_host_metadata:\n      cache.ttl: 5m\n      geo:\n        name: nyc-dc1-rack1\n        location: 40.7128, -74.0060\n        continent_name: North America\n        country_iso_code: US\n        region_name: New York\n        region_iso_code: NY\n        city_name: New York\n```\n结果为\n```\n{\n   \"host\":{\n      \"architecture\":\"x86_64\",\n      \"name\":\"example-host\",\n      \"id\":\"\",\n      \"os\":{\n         \"family\":\"darwin\",\n         \"build\":\"16G1212\",\n         \"platform\":\"darwin\",\n         \"version\":\"10.12.6\",\n         \"kernel\":\"16.7.0\",\n         \"name\":\"Mac OS X\"\n      },\n      \"ip\": [\"192.168.0.1\", \"10.0.0.1\"],\n      \"mac\": [\"00:25:96:12:34:56\", \"72:00:06:ff:79:f1\"],\n      \"geo\": {\n          \"continent_name\": \"North America\",\n          \"country_iso_code\": \"US\",\n          \"region_name\": \"New York\",\n          \"region_iso_code\": \"NY\",\n          \"city_name\": \"New York\",\n          \"name\": \"nyc-dc1-rack1\",\n          \"location\": \"40.7128, -74.0060\"\n        }\n   }\n}\n```\n\n\n6、add_id\n\n根据envet生成唯一的ID\n\n自动追加 根据envet生成唯一的ID\n\n配置如下：\n```\nprocessors:\n  - add_id: ~\n```\n输出为：\n```\n\"@metadata\": {                                                                                                                     \n    \"beat\": \"filebeat\",                                                                                                              \n    \"type\": \"_doc\",                                                                                                                  \n    \"version\": \"7.7.0\",                                                                                                              \n    \"_id\": \"jfXPVHQB95_6f7tCZ5hg\"                                                                                                    \n},\n```\n\n7、add_kubernetes_metadata\n该处理器使用相关元数据对每个事件进行注释，基于kubernetes pod生成事件的元数据。在启动时，它会检测到集群内的环境并缓存Kubernetes相关的元数据。只有在检测到有效配置时才会对事件进行注释。如果它不能检测到有效的Kubernetes配置，那么事件不会用Kubernetes相关的元数据进行注释。\n添加的注释有Pod Name 、Pod UID、Namespace、Labels\n```\nprocessors:\n  - add_kubernetes_metadata: ~\n```\n\n8、add_labels\n\n添加自定义标签，类似add_fileds功能 ，添加的kv输出后默认在labels字段下\n```\nprocessors:\n  - add_labels:\n      labels:\n        number: 1\n        with.dots: test\n        nested:\n          with.dots: nested\n        array:\n          - do\n          - re\n          - with.field: mi\n```\n输出：\n```\n{\n  \"labels\": {\n    \"number\": 1,\n    \"with.dots\": \"test\",\n    \"nested.with.dots\": \"nested\",\n    \"array.0\": \"do\",\n    \"array.1\": \"re\",\n    \"array.2.with.field\": \"mi\"\n  }\n}\n```\n\n9、add_locale\n自动添加时区信息，常用语国际业务中。\n```\nprocessors:\n  - add_locale: ~\n```\n下面的意思是 使用缩写模式 ， 例如国内输出结果为CST\n```\nprocessors:\n  - add_locale:\n      format: abbreviation\n```\n10、add_observer_metadata\n自动添加观察者机器的相关元数据\n```\nprocessors:\n  - add_observer_metadata:\n      cache.ttl: 5m\n```\n输出为：\n```\n{\n  \"observer\" : {\n    \"hostname\" : \"avce\",\n    \"type\" : \"heartbeat\",\n    \"vendor\" : \"elastic\",\n    \"ip\" : [\n      \"192.168.1.251\",\n      \"fe80::64b2:c3ff:fe5b:b974\",\n    ],\n    \"mac\" : [\n      \"dc:c1:02:6f:1b:ed\",\n    ]\n  }\n}\n```\n11、add_tags\n添加标签，并可指定标签在哪个字段下。\n\n例如：\n```\nprocessors:\n  - add_tags:\n      tags: [web, production]\n      target: \"environment\"\n```\n输出为：\n```\n{\n  \"environment\": [\"web\", \"production\"]\n}\n```\n12、convert\n将event中的某个字段转换为其他类型，例如将字符串转换为整数。\n```\nprocessors:\n  - convert:\n      fields:\n        - {from: \"src_ip\", to: \"source.ip\", type: \"ip\"}\n        - {from: \"src_port\", to: \"source.port\", type: \"integer\"}\n      ignore_missing: true\n      fail_on_error: false\n```\n13、copy_fields\n将event中的某个字段的值赋值给另一个字段\n```\nprocessors:\n  - copy_fields:\n      fields:\n        - from: message\n          to: event.original\n      fail_on_error: false\n      ignore_missing: true\n```\n输出：\n```\n{\n  \"message\": \"my-interesting-message\",\n  \"event\": {\n      \"original\": \"my-interesting-message\"\n  }\n}\n```\n\n14、decode_base64_field\nbase64解码，从一个字段里获取值，解码后赋值给另一个字段。\n```\nprocessors:\n  - decode_base64_field:\n      field:\n        from: \"message\"\n        to: \"decode\"\n      ignore_missing: true\n      fail_on_error: false\n```\n15、decode_cef\n如果你的日式符合Common Event Format (CEF) 标准，你可以使用它进行解码：\n```\nprocessors:\n  - rename:\n      fields:\n        - {from: \"message\", to: \"event.original\"}\n  - decode_cef:\n      field: event.original\n```\n更多关于cef的介绍\n\n16、decode_csv_fields\n解析CSF格式的日志到指定字段，内容为数组。\n```\nprocessors:\n  - decode_csv_fields:\n     # 解析到哪里\n      fields:\n        message: decoded.csv\n      separator: \",\"\n      ignore_missing: false\n      overwrite_keys: true\n      trim_leading_space: false\n      fail_on_error: true\n```\n17、decode_json_fields\n处理对包含JSON字符串的字段进行解码，并将字符串替换为有效的JSON对象。默认是在当前字段替换。\n```\nprocessors:\n  - decode_json_fields:\n      fields: [\"field1\", \"field2\", ...]\n     # process_array: false\n      # max_depth: 1\n     # overwrite_keys: false\n     # add_error_key: true\n```\n18、decompress_gzip_field\ngzip解压缩，从一个字段值中加压缩到另一个字段中 。 使用场景少。\n```\nprocessors:\n  - decompress_gzip_field:\n      field:\n        from: \"field1\"\n        to: \"field2\"\n      ignore_missing: false\n      fail_on_error: true\n```\n感兴趣的可以看下 gzip压缩初探\n\n19、dissect\n从某个字段里（默认message）取值，按照tokenizer定义的格式 拆分（切割）数据，并输出到target_prefix 字段里，默认是dissect\n```\nprocessors:\n  - dissect:\n      tokenizer: \"%{key1} %{key2}\"\n      # field: \"message\"\n     # target_prefix: \"dissect\"\n```\n如果是这样的log\"App01 - WebServer is up and running\" ，输出为\n```\n\"service\": {\n  \"name\": \"App01\",\n  \"status\": \"WebServer is up and running\"\n},\n```\n20、dns\n反向解析 根据id查找hostname 。每个processor有自己查询结果的缓存。该processor使用自己的域名服务器，不会查找/etc/hosts ，默认使用/etc/resolv.conf里面的域名服务器。\n```\nprocessors:\n  - dns:\n      type: reverse\n      fields:\n        source.ip: source.hostname\n        destination.ip: destination.hostname\n```\nfields字段里source.ip是指ip所在的字段，source.hostname是指新值存入的字段。\n\n21、drop_event\n丢弃该event，一般要设置特定条件 。\n\n例如 http响应码为200 就不上报event：\n```\nprocessors:\n  - drop_event:\n      when:\n        equals:\n          http.code: 200\n```\n\n22、drop_fields\n丢弃（过滤掉）特定字段， 一般防止敏感信息上报，例如ip 、mac地址…\n```\nprocessors:\n  - drop_fields:\n      fields: [\"cpu.user\", \"cpu.system\"]\n```\n23、extract_array\n\n从数组中取值并填充（映射到）指定字段\n\n配置示例：\n```\n  - add_tags:\n      tags: [\"127.0.0.1\", \"114.114.114.114\",\"8080\"]\n      target: \"my_array\"\n  - extract_array:\n      field: my_array\n      mappings:\n        source.ip: 0\n        source.destination.ip: 1\n        source.network.transport: 2\n      fail_on_error: true\n      ignore_missing: false\n```\n\n\n24、fingerprint\n\n根据事件指定字段字段值生成事件的指纹。\n```\nprocessors:\n  - fingerprint:\n      fields: [\"field1\", \"field2\", ...]\n```\n\n25、include_fields\n\n输出的event里 会包含哪些字段值。@timestamp和type字段会始终出现在event中，即使未在include_fields列表中定义。\n```\nprocessors:\n  - include_fields:\n      when:\n        condition\n      fields: [\"field1\", \"field2\", ...]\n```\n26、registered_domain\n域名注册，识别一个长串域名，转化成一个简短域名 。\n\n比如我有一条日志：\n```\nhttps://www.netcn.console.aliyun.com/\n```\nfilebeat配置：\n```\nprocessors:\n  - registered_domain:\n      field: message\n      target_field: result.registered_domain\n      ignore_missing: true\n      ignore_failure: true\n```\n输出为\n```\n\"result\": {\n  \"registered_domain\": \"aliyun.com/\"\n}\n```\n\n27、rename\n\n重命名字段\n\n示例： 把host重命名为hostRename\n```\nprocessors:\n  - rename:\n      fields:\n        - from: \"host\"\n          to: \"hostRename\"\n      ignore_missing: false\n      fail_on_error: true\n```\n\n28、script\n\n使用Javascript 处理event ，可以更加灵活的预处理业务\n\n29、timestamp\n\n从字段解析时间戳并将解析结果写入@timestamp（日志采集时间）字段\n\n从某个字段解析时间戳，并将解析结果写入@timestamp中，可以自定义日志采集时间。\n\n配置如下：\n```\nprocessors:\n   timestamp:\n      field: start_time\n      layouts:\n        - '2006-01-02T15:04:05Z'\n        - '2006-01-02T15:04:05.999Z'\n      test:\n        - '2019-06-22T16:33:51Z'\n        - '2019-11-18T04:59:51.123Z'\n   drop_fields:\n      fields: [start_time]\n```\n\n```\nlayouts 是时间格式，用于格式化start_time里的时间，这个是go语言的时间格式。 类似java中的yyyy-MM-dd HH:mm:ss 。\ntest 是在filebeat启动时 验证layouts的格式能否格式化 测试时间。\n```\n\n\n30、translate_sid\n将Windows安全标识符（SID）转换为帐户名，使用仅限Windows系统。\n```\nprocessors:\n  - translate_sid:\n      field: winlog.event_data.MemberSid\n      account_name_target: user.name\n      domain_target: user.domain\n      ignore_missing: true\n      ignore_failure: true\n```\n31、translate_sid\n按照指定大小截取字段值\n```\nprocessors:\n  - truncate_fields:\n    fields:\n    - message\n    max_characters: 5\n    #max_bytes: 128\n    fail_on_error: false\n    ignore_missing: true\n```\n32、urldecode\nurl 解码\n```\nprocessors:\n  - urldecode:\n      fields:\n        - from: \"field1\"\n          to: \"field2\"\n      #  - from: \"fieldx\"\n       #  to: \"fieldy\"\n      ignore_missing: false\n      fail_on_error: true\n```\n\n### Outputs\n\nElasticsearch\n\n\n常规配置\n```\noutput.elasticsearch:\n  hosts: [\"https://es.bingmaning:9200\"]\n  username: \"bingmaning\"\n  password: \"lingshui2008@qq.com\"\n  index: \"%{[fields.log_type]}-%{[agent.version]}-%{+yyyy.MM.dd}\"\n```\n更多配置\n```\noutput.elasticsearch:\n  # Boolean flag to enable or disable the output module.\n  #enabled: true\n\n  #es地址\n  hosts: [\"https://es.bingmaning:9200\"]\n\n  # 设置压缩级别\n  compression_level: 0\n\n  # 是否转义html符号\n  escape_html: false\n\n  # 协议，默认http\n  protocol: \"https\"\n\n  # 认证方式一\n  api_key: \"id:api_key\"\n  # 认证方式二\n  username: \"elastic\"\n  password: \"changeme\"\n\n  # 通过索引操作在URL中传递的HTTP参数字典\n  parameters:\n    #param1: value1\n    #param2: value2\n\n  # 每个Elasticsearch主机worker数量。  \n  worker: 1\n\n  #默认索引 filebeat-YYYY.MM.DD  。 可自定义\n  index: \"filebeat-%{[agent.version]}-%{+yyyy.MM.dd}\"\n\n  # 自定义 pipeline\n  pipeline: \"\"\n\n  # 默认http路径\n  path: \"/elasticsearch\"\n\n  # 自定义http header\n  headers:\n    X-My-Header: Contents of the header\n\n  # 代理地址\n  proxy_url: http://proxy:3128\n\n  # 是否禁用代理 默认false\n  proxy_disable: false\n\n  # 尝试特定Elasticsearch索引操作的次数。如果多次重试后，索引操作未成功，事件被丢弃。默认为3。\n  max_retries: 3\n\n  # 单个Elasticsearch批量API索引请求中要批量处理的最大事件数\n  # The default is 50.\n  bulk_max_size: 50\n\n  # 重连 初始等待时间，如果失败会指数值增长。\n  backoff.init: 1s\n\n  # 最大等待重连时间。默认60秒\n  backoff.max: 60s\n\n  # 请求超时时间\n  timeout: 90\n\n  # 使用ssl？\n  ssl.enabled: true\n\n  # ssl认证方式，默认为full。 测试时 可以使用 none\n  ssl.verification_mode: full\n\n  #可用 tls 版本\n  ssl.supported_protocols: [TLSv1.1, TLSv1.2, TLSv1.3]\n\n  # 根证书地址\n  ssl.certificate_authorities: [\"/etc/pki/root/ca.pem\"]\n\n  # 客户端证书\n  ssl.certificate: \"/etc/pki/client/cert.pem\"\n\n  # 客户端密钥\n  ssl.key: \"/etc/pki/client/cert.key\"\n\n  # 密码短语\n  ssl.key_passphrase: ''\n\n  # 配置密码套件以用于SSL连接\n  ssl.cipher_suites: []\n\n  # 为基于ECDHE的密码套件配置曲线类型\n  ssl.curve_types: []\n\n  # 配置支持哪些类型的重新协商。有效选项是 \n  # never, once, and freely. 默认是 never.\n  ssl.renegotiation: never\n\n  # 配置一个可用于对已验证证书链进行额外验证的pin， 这可以确保使用特定证书来验证信任链。\n  # 该pin是SHA-256指纹的base64编码字符串。.\n  ssl.ca_sha256: \"\"\n\n  # 是否支持 Kerberos \n  kerberos.enabled: true\n\n  # Kerberos认证类型： keytab, password.\n  kerberos.auth_type: password\n\n  # 密钥表文件的路径。当auth_type设置为keytab时使用。\n  kerberos.keytab: /etc/elastic.keytab\n\n  #  Kerberos configuration.\n  kerberos.config_path: /etc/krb5.conf\n\n  # Name of the Kerberos user.\n  kerberos.username: elastic\n\n  # Kerberos用户的密码。当auth_type设置为password时使用。\n  kerberos.password: changeme\n\n  # Kerberos realm.\n  kerberos.realm: ELASTIC\n```\n\nlogstash\n\n常规配置\n1、filebeat.yml中配置如下：\n```\noutput.logstash:\n  hosts: [\"localhost:5044\", \"localhost:5045\"]\n  # 开这个参数 需要多个hosts\n  loadbalance: true\n```\n\n2、logstash-pipeline.conf中配置如下：\n```\ninput {\n  beats {\n    port => 5044\n  }\n}\nfilter{\n// 数据的各种处理  \n....\n}\noutput {\n  elasticsearch {\n    hosts => [\"http://localhost:9200\"]\n    #  @metadata 解释如下\n    index => \"%{[@metadata][beat]}-%{[@metadata][version]}-%{+YYYY.MM.dd}\" \n  }\n}\n```\n\nfilebeat详细配置\n```\noutput.logstash:\n\n  enabled: true\n  \n  hosts: [\"localhost:5044\"]\n\n  # 每个logstash worker数量。  \n  worker: 1\n\n  # 压缩级别\n  compression_level: 3\n\n  # 是否转义html符号\n  escape_html: false\n\n  #最大链接时间 。 0 代表不启用此功能\n  # 不支持async connections\n  ttl: 30s\n\n  # 是否需要负载均衡\n  loadbalance: false\n\n  # 处理时异步发送到Logstash的批次数\n  pipelining: 2\n\n  # 如果启用，在没有没有遇到错误的情况下，则每次仅传输一批事件中的一部分事件 ，直到要发送的事件数量增加到`bulk_max_size`\n  slow_start: false\n\n  # 重连时间策略 \n  backoff.init: 1s\n  backoff.max: 60s\n\n  # 默认索引 一般都会重写\n  index: 'filebeat'\n\n  # SOCKS5 proxy server URL\n  proxy_url: socks5://user:password@socks5-server:2233\n\n  # 是否启用本地解析器\n  proxy_use_local_resolver: false\n\n # 使用ssl？\n  ssl.enabled: true\n\n  # ssl认证方式，默认为full。 测试时 可以使用 none\n  ssl.verification_mode: full\n\n  #可用 tls 版本\n  ssl.supported_protocols: [TLSv1.1, TLSv1.2, TLSv1.3]\n\n  # 根证书地址\n  ssl.certificate_authorities: [\"/etc/pki/root/ca.pem\"]\n\n  # 客户端证书\n  ssl.certificate: \"/etc/pki/client/cert.pem\"\n\n  # 客户端密钥\n  ssl.key: \"/etc/pki/client/cert.key\"\n\n  # 密码短语\n  ssl.key_passphrase: ''\n\n  # 配置密码套件以用于SSL连接\n  ssl.cipher_suites: []\n\n  # 为基于ECDHE的密码套件配置曲线类型\n  ssl.curve_types: []\n\n  # 配置支持哪些类型的重新协商。有效选项是 \n  # never, once, and freely. 默认是 never.\n  ssl.renegotiation: never\n\n  # 配置一个可用于对已验证证书链进行额外验证的pin， 这可以确保使用特定证书来验证信任链。\n  # 该pin是SHA-256指纹的base64编码字符串。.\n  ssl.ca_sha256: \"\"\n  \n  # 尝试特定Elasticsearch索引操作的次数。如果多次重试后，索引操作未成功，事件被丢弃。默认为3。\n  max_retries: 3\n  # 单个Logstash request 最大event数量 default is 2048.\n  bulk_max_size: 2048\n\n  # 等待Logstash server响应最大超时时间。默认是 30s.\n  timeout: 30s\n```\n\n\nredis\nRedis输出将event插入Redis列表或Redis通道。该输出插件与Logstash的Redis输入插件兼容。\n\n常规配置\n```\n# 采集配置\nfilebeat.inputs:     #收集日志\n- type: log         #类型\n  enabled: true     #始终收集\n  paths:\n    - /etc/log/*.log    \n# 输出配置\noutput.redis:        \n  hosts: [\"127.0.0.1:6379\"]  #输出在redis里\n  password: \"123456\"   #redis认证密码，我没有\n  key: \"filebeat7.7\"       #日志redis的key值\n  db: 0                 #redis数据库0\n  timeout: 5             #redis链接超时  默认5s\n```\n\n所有可配置参数\n```\noutput.redis:\n  # Boolean flag to enable or disable the output module.\n  enabled: true\n\n  # Configure JSON encoding\n  codec.json:\n    # Pretty print json event\n    pretty: false\n\n    # Configure escaping HTML symbols in strings.\n    escape_html: false\n\n  # The list of Redis servers to connect to. If load-balancing is enabled, the\n  # events are distributed to the servers in the list. If one server becomes\n  # unreachable, the events are distributed to the reachable servers only.\n  # The hosts setting supports redis and rediss urls with custom password like\n  # redis://:password@localhost:6379.\n  hosts: [\"localhost:6379\"]\n\n  # The name of the Redis list or channel the events are published to. The\n  # default is filebeat.\n  key: filebeat\n\n  # The password to authenticate to Redis with. The default is no authentication.\n  password:\n\n  # The Redis database number where the events are published. The default is 0.\n  db: 0\n\n  # The Redis data type to use for publishing events. If the data type is list,\n  # the Redis RPUSH command is used. If the data type is channel, the Redis\n  # PUBLISH command is used. The default value is list.\n  datatype: list\n\n  # The number of workers to use for each host configured to publish events to\n  # Redis. Use this setting along with the loadbalance option. For example, if\n  # you have 2 hosts and 3 workers, in total 6 workers are started (3 for each\n  # host).\n  worker: 1\n\n  # If set to true and multiple hosts or workers are configured, the output\n  # plugin load balances published events onto all Redis hosts. If set to false,\n  # the output plugin sends all events to only one host (determined at random)\n  # and will switch to another host if the currently selected one becomes\n  # unreachable. The default value is true.\n  loadbalance: true\n\n  # The Redis connection timeout in seconds. The default is 5 seconds.\n  timeout: 5s\n\n  # The number of times to retry publishing an event after a publishing failure.\n  # After the specified number of retries, the events are typically dropped.\n  # Some Beats, such as Filebeat, ignore the max_retries setting and retry until\n  # all events are published. Set max_retries to a value less than 0 to retry\n  # until all events are published. The default is 3.\n  max_retries: 3\n\n  # The number of seconds to wait before trying to reconnect to Redis\n  # after a network error. After waiting backoff.init seconds, the Beat\n  # tries to reconnect. If the attempt fails, the backoff timer is increased\n  # exponentially up to backoff.max. After a successful connection, the backoff\n  # timer is reset. The default is 1s.\n  backoff.init: 1s\n\n  # The maximum number of seconds to wait before attempting to connect to\n  # Redis after a network error. The default is 60s.\n  backoff.max: 60s\n\n  # The maximum number of events to bulk in a single Redis request or pipeline.\n  # The default is 2048.\n  bulk_max_size: 2048\n\n  # The URL of the SOCKS5 proxy to use when connecting to the Redis servers. The\n  # value must be a URL with a scheme of socks5://.\n  proxy_url:\n\n  # This option determines whether Redis hostnames are resolved locally when\n  # using a proxy. The default value is false, which means that name resolution\n  # occurs on the proxy server.\n  proxy_use_local_resolver: false\n\n  # Enable SSL support. SSL is automatically enabled, if any SSL setting is set.\n  ssl.enabled: true\n\n  # Configure SSL verification mode. If `none` is configured, all server hosts\n  # and certificates will be accepted. In this mode, SSL based connections are\n  # susceptible to man-in-the-middle attacks. Use only for testing. Default is\n  # `full`.\n  ssl.verification_mode: full\n\n  # List of supported/valid TLS versions. By default all TLS versions from 1.1\n  # up to 1.3 are enabled.\n  ssl.supported_protocols: [TLSv1.1, TLSv1.2, TLSv1.3]\n\n  # Optional SSL configuration options. SSL is off by default.\n  # List of root certificates for HTTPS server verifications\n  ssl.certificate_authorities: [\"/etc/pki/root/ca.pem\"]\n\n  # Certificate for SSL client authentication\n  ssl.certificate: \"/etc/pki/client/cert.pem\"\n\n  # Client Certificate Key\n  ssl.key: \"/etc/pki/client/cert.key\"\n\n  # Optional passphrase for decrypting the Certificate Key.\n  ssl.key_passphrase: ''\n\n  # Configure cipher suites to be used for SSL connections\n  ssl.cipher_suites: []\n\n  # Configure curve types for ECDHE based cipher suites\n  ssl.curve_types: []\n\n  # Configure what types of renegotiation are supported. Valid options are\n  # never, once, and freely. Default is never.\n  ssl.renegotiation: never\n```\n\n\nfile\n\n配置filebeat的输出方式为文件， 一般用于测试。\n\n常规配置\n```\n# 采集配置\nfilebeat.inputs:     #收集日志\n- type: log         #类型\n  enabled: true     #始终收集\n  paths:\n    - /etc/log/*.log    \n# 输出配置\noutput.file:\n  path: \"/tmp/filebeat\"  #  输出路径\n  filename: filebeat    # 输出文件名\n```\n\n所有可配置参数\n```\noutput.file:\n  # Boolean flag to enable or disable the output module.\n  enabled: true\n\n  # Configure JSON encoding\n  codec.json:\n    # Pretty-print JSON event\n    pretty: false\n\n    # Configure escaping HTML symbols in strings.\n    escape_html: false\n\n  # Path to the directory where to save the generated files. The option is\n  # mandatory.\n  path: \"/tmp/filebeat\"\n\n  # Name of the generated files. The default is `filebeat` and it generates\n  # files: `filebeat`, `filebeat.1`, `filebeat.2`, etc.\n  filename: filebeat\n\n  # Maximum size in kilobytes of each file. When this size is reached, and on\n  # every Filebeat restart, the files are rotated. The default value is 10240\n  # kB.\n  rotate_every_kb: 10000\n\n  # Maximum number of files under path. When this number of files is reached,\n  # the oldest file is deleted and the rest are shifted from last to first. The\n  # default is 7 files.\n  number_of_files: 7\n\n  # Permissions to use for file creation. The default is 0600.\n  permissions: 0600\n```\n\nconsole\n\n输出到控制面板，测试输出最佳方式。\n\n常规配置\n```\n# 采集配置\nfilebeat.inputs:     #收集日志\n- type: log         #类型\n  enabled: true     #始终收集\n  paths:\n    - /etc/log/*.log    \n# 输出配置\noutput.console:\n  codec.json:\n    # 漂亮输出（格式化）\n    pretty: true\n    #  转义HTML符号\n    escape_html: true\n```\n\n\n### Keystore\n\n密钥库地址（一般是包含私钥以及关键数据的文件路径）\n```\nkeystore.path: \"${path.config}/beats.keystore\"\n```\n\n命令\n```\n创建一个存储密码的keystore：   filebeat keystore create\n然后往其中添加键值对，例如：    filebeatk eystore add ES_PWD\n使用覆盖原来键的值：           filebeat key store add ES_PWD–force\n删除键值对：                  filebeat key store remove ES_PWD\n查看已有的键值对：             filebeat key store list\n```\n\n\n### Setup ILM\n\n从7.0版开始，Filebeat在连接到支持生命周期管理的群集时默认使用索引生命周期管理。Filebeat自动加载默认策略并将其应用于Filebeat创建的任何索引。\n\nindex lifecycle management (ILM) 索引生命管理，如果它启用了，那么会忽略output.elasticsearch.index 里面的设置。\n\n新特性：当现有索引达到指定的大小或期限时，使用索引生命周期策略自动将过渡到新索引\n\n常规配置\n```\nsetup.ilm.enabled: auto\nsetup.ilm.rollover_alias: \"filebeat\"  # 前缀\n# filebeat-2020.09.28-000001\nsetup.ilm.pattern: \"{now/d}-000001\"   \n```\n\n需要了解Date math\n\n详细配置\n```\n# Configure index lifecycle management (ILM). These settings create a write\n# alias and add additional settings to the index template. When ILM is enabled,\n# output.elasticsearch.index is ignored, and the write alias is used to set the\n# index name.\n\n# Enable ILM support. Valid values are true, false, and auto. When set to auto\n# (the default), the Beat uses index lifecycle management when it connects to a\n# cluster that supports ILM; otherwise, it creates daily indices.\nsetup.ilm.enabled: auto\n\n# Set the prefix used in the index lifecycle write alias name. The default alias\n# name is 'filebeat-%{[agent.version]}'.\nsetup.ilm.rollover_alias: \"filebeat\"\n\n# Set the rollover index pattern. The default is \"%{now/d}-000001\".\n# filebeat-2020.09.28-000001\nsetup.ilm.pattern: \"{now/d}-000001\"\n\n# Set the lifecycle policy name. The default policy name is\n# 'filebeat'.\nsetup.ilm.policy_name: \"mypolicy\"\n\n# The path to a JSON file that contains a lifecycle policy configuration. Used\n# to load your own lifecycle policy.\nsetup.ilm.policy_file:\n\n# Disable the check for an existing lifecycle policy. The default is true. If\n# you disable this check, set setup.ilm.overwrite: true so the lifecycle policy\n# can be installed.\nsetup.ilm.check_exists: true\n\n# Overwrite the lifecycle policy at startup. The default is false.\nsetup.ilm.overwrite: false\n```\n\n\nLogging\n\n配置日志输出的选项。日志记录系统可以将日志写入syslog或轮换日志文件。如果未显式配置日志记录，则使用文件输出，输出路径为/var/log/filebeat。\n\n常规配置\n```\n#log 输出级别 \nlogging.level: info \n# 输出方式\nlogging.to_files: true\n# 输出路径、名字、 log文件最大数、文件操作权限\nlogging.files:\n  path: /var/log/filebeat\n  name: filebeat\n  keepfiles: 7\n  permissions: 0644\n```\n\n\n详细参数\n```\n# There are four options for the log output: file, stderr, syslog, eventlog\n# The file output is the default.\n\n# Sets log level. The default log level is info.\n# Available log levels are: error, warning, info, debug\nlogging.level: info\n\n# Enable debug output for selected components. To enable all selectors use [\"*\"]\n# Other available selectors are \"beat\", \"publish\", \"service\"\n# Multiple selectors can be chained.\n# 输出哪些服务的log\nlogging.selectors: [ ]\n\n# Send all logging output to stderr. The default is false.\nlogging.to_stderr: false\n\n# Send all logging output to syslog. The default is false.\nlogging.to_syslog: false\n\n# Send all logging output to Windows Event Logs. The default is false.\nlogging.to_eventlog: false\n\n# If enabled, Filebeat periodically logs its internal metrics that have changed\n# in the last period. For each metric that changed, the delta from the value at\n# the beginning of the period is logged. Also, the total values for\n# all non-zero internal metrics are logged on shutdown. The default is true.\nlogging.metrics.enabled: true\n\n# The period after which to log the internal metrics. The default is 30s.\nlogging.metrics.period: 30s\n\n# Logging to rotating files. Set logging.to_files to false to disable logging to\n# files.\nlogging.to_files: true\nlogging.files:\n  # Configure the path where the logs are written. The default is the logs directory\n  # under the home path (the binary location).\n  path: /var/log/filebeat\n\n  # The name of the files where the logs are written to.\n  name: filebeat\n\n  # Configure log file size limit. If limit is reached, log file will be\n  # automatically rotated\n  rotateeverybytes: 10485760 # = 10MB\n\n  # Number of rotated log files to keep. Oldest files will be deleted first.\n  keepfiles: 7\n\n  # The permissions mask to apply when rotating log files. The default value is 0600.\n  # Must be a valid Unix-style file permissions mask expressed in octal notation.\n  permissions: 0600\n\n  # Enable log file rotation on time intervals in addition to size-based rotation.\n  # Intervals must be at least 1s. Values of 1m, 1h, 24h, 7*24h, 30*24h, and 365*24h\n  # are boundary-aligned with minutes, hours, days, weeks, months, and years as\n  # reported by the local system clock. All other intervals are calculated from the\n  # Unix epoch. Defaults to disabled.\n  interval: 0\n\n  # Rotate existing logs on startup rather than appending to the existing\n  # file. Defaults to true.\n   rotateonstartup: true\n\n# Set to true to log messages in JSON format.\nlogging.json: false\n\n# Set to true, to log messages with minimal required Elastic Common Schema (ECS)\n# information. Recommended to use in combination with `logging.json=true`\n# Defaults to false.\nlogging.ecs: false\n```\n\n\n\n","source":"_posts/elk/filebeat.md","raw":"---\ntitle: filebeat 使用\ndate: 2021-07-05 14:09\ncategories:\n- elk\ntags:\n- filebeat\n- elk\n---\n\t\n\t\n摘要: filebeat 使用\n<!-- more -->\n\n\n# filebeat 使用\n\n## 一、前言\n这里使用的7.7.0版本，在官方文档快速上手的中，只要简单配置了filelbeat.yml ，启动filebeat就可以收集日志了。\n\n```\n# 定义输入\nfilebeat.inputs:\n- type: log\n  enabled: true\n  paths:\n    - /var/log/*.log\n# 定义输出\noutput.elasticsearch:\n  hosts: [\"myEShost:9200\"]\n  username: \"filebeat_internal\"\n  password: \"YOUR_PASSWORD\" \nsetup.kibana:\n  host: \"mykibanahost:5601\"\n  username: \"my_kibana_user\"  \n  password: \"YOUR_PASSWORD\"\n```\n\n其实filebeat提供的可配置项有很多，这里就以大模块角度了解下其分类。 更多详细内容，[点击查看官网](https://www.elastic.co/guide/en/beats/filebeat/7.7/index.html)。\n\n\n## 二、参数配置分类\n\n### 1、 Paths\n用于定义Filebeat查找相关文件的位置。例如，Filebeat在config路径中查找启动文件，并在log路径中写入日志文件。Filebeat在data路径中查找其registry文件。\n\n用户可以不配置，使用默认的路径。也可以自定义配置路径：\n```\npath.home: /usr/share/filebeat\npath.config: /etc/filebeat\npath.data: /var/lib/filebeat\npath.logs: /var/log/\n```\n\n\n```\n#================================= Paths ======================================\n\n# The home path for the Filebeat installation. This is the default base path\n# for all other path settings and for miscellaneous files that come with the\n# distribution (for example, the sample dashboards).\n# If not set by a CLI flag or in the configuration file, the default for the\n# home path is the location of the binary.\n#path.home:\n\n# The configuration path for the Filebeat installation. This is the default\n# base path for configuration files, including the main YAML configuration file\n# and the Elasticsearch template file. If not set by a CLI flag or in the\n# configuration file, the default for the configuration path is the home path.\n#path.config: ${path.home}\n\n# The data path for the Filebeat installation. This is the default base path\n# for all the files in which Filebeat needs to store its data. If not set by a\n# CLI flag or in the configuration file, the default for the data path is a data\n# subdirectory inside the home path.\n#path.data: ${path.home}/data\n\n# The logs path for a Filebeat installation. This is the default location for\n# the Beat's log files. If not set by a CLI flag or in the configuration file,\n# the default for the logs path is a logs subdirectory inside the home path.\n#path.logs: ${path.home}/logs\n```\n\n#### 配置参数说明\n```\n1、path.home\nFilebeat安装的主路径。这是所有其他路径设置和发行版附带的其他文件（例如，示例仪表板）的默认基本路径。如果未设置，则主路径的默认值是Filebeat二进制文件的位置。\n\n2、path.config\nFilebeat安装的配置路径。这是配置文件的默认基本路径，包括主YAML配置文件和Elasticsearch模板文件。如果设置，则配置路径的默认值为{path.home}路径。\n\n3、path.data\nFilebeat的数据路径。这是Filebeat需要存储其数据的所有文件的默认基本路径。如果设置，则数据路径的默认值是{path.home}/data。\n\n注意： 每个filebeat实例的path.data必须是唯一的。\n\n4、path.log\nFilebeat的日志路径。这是Filebeat日志文件的默认位置。如果未设置，则日志路径的默认值为{path.home}/log。\n```\n\n#### 默认启动时的路径\n比如说用户在 /home/abc/work 路径下启动filebeat，那么path.home 就默认为 当前路径。并且可以看到 多了两个文件夹data和 log\n\n\n\n\n### 2、Modules configuration\nFilebeat模块简化了常见日志格式的收集、解析和可视化。典型的模块（比如Nginx日志）由一个或多个文件集组成（对于Nginx，是access和error），如果你启用了下面的module, fileabeat就可以根据系统自动去寻找access、error 对应的log文件进行收集。\n```\n- module: nginx\n  # Access logs\n  #access:\n    #enabled: true\n\n    # Set custom paths for the log files. If left empty,\n    # Filebeat will choose the paths depending on your OS.\n    #var.paths:\n\n    # Input configuration (advanced). Any input configuration option\n    # can be added under this section.\n    #input:\n```\n\nFilebeat会根据您的环境自动调整这些配置，并将它们加载到相应的Elastic stack组件中\n\n配置文件的方式：\n```\nfilebeat.config:\n  modules:\n    # 通过这里开启， 默认是关闭\n    enabled: true\n    path: modules.d/*.yml\n    reload.enabled: true\n    reload.period: 10s\n\n```\n\n\n### 3、Filebeat inputs\n如果你想手动配置Filebeat（而不是使用模块），可以在配置文件filebeat.inputs部分设置Filebeat采集源以及相关参数配置。每个输入源都以破折号（-）开头。用户可以指定多个输入源，并且可以多次指定同一输入类型。例如：\n```\nfilebeat.inputs:\n- type: log\n  paths:\n    - /var/log/system.log\n    - /var/log/wifi.log\n- type: log\n  paths:\n    - \"/var/log/apache2/*\"\n  fields:\n    apache: true\n  fields_under_root: true\n- type: tcp\n  max_message_size: 10MiB\n  host: \"localhost:9000\"\n```\n点击查看更多input 配置\n\n### 4、Filebeat autodiscover\n在容器上运行应用程序时，它们会成为监视系统的移动目标。“自动发现”允许您跟踪它们并在更改发生时调整设置。通过定义配置模板，自动发现子系统可以在服务开始运行时监视它们。\n```\nfilebeat.autodiscover:\n  List of enabled autodiscover providers\n providers:\n   - type: docker\n     templates:\n       - condition:\n           equals.docker.container.image: busybox\n         config:\n           - type: container\n             paths:\n               - /var/lib/docker/containers/${data.docker.container.id}/*.log\n```\n\n### 5、Filebeat global options\n定义publisher行为或者某些文件的位置信息，这些参数是filebeat根节点参数。比如register文件路径、或者是否启用modules、多个inputs等等\n```\n# Registry data path. If a relative path is used, it is considered relative to the\n# data path.\n#filebeat.registry.path: ${path.data}/registry\n\n# The permissions mask to apply on registry data, and meta files. The default\n# value is 0600.  Must be a valid Unix-style file permissions mask expressed in\n# octal notation.  This option is not supported on Windows.\n#filebeat.registry.file_permissions: 0600\n\n# The timeout value that controls when registry entries are written to disk\n# (flushed). When an unwritten update exceeds this value, it triggers a write\n# to disk. When flush is set to 0s, the registry is written to disk after each\n# batch of events has been published successfully. The default value is 0s.\n#filebeat.registry.flush: 0s\n\n\n# Starting with Filebeat 7.0, the registry uses a new directory format to store\n# Filebeat state. After you upgrade, Filebeat will automatically migrate a 6.x\n# registry file to use the new directory format. If you changed\n# filebeat.registry.path while upgrading, set filebeat.registry.migrate_file to\n# point to the old registry file.\n#filebeat.registry.migrate_file: ${path.data}/registry\n\n# By default Ingest pipelines are not updated if a pipeline with the same ID\n# already exists. If this option is enabled Filebeat overwrites pipelines\n# everytime a new Elasticsearch connection is established.\n#filebeat.overwrite_pipelines: false\n\n# How long filebeat waits on shutdown for the publisher to finish.\n# Default is 0, not waiting.\n#filebeat.shutdown_timeout: 0\n\n# Enable filebeat config reloading\n#filebeat.config:\n  #inputs:\n    #enabled: false\n    #path: inputs.d/*.yml\n    #reload.enabled: true\n    #reload.period: 10s\n  #modules:\n    #enabled: false\n    #path: modules.d/*.yml\n    #reload.enabled: true\n    #reload.period: 10s\n```\n\n#### 相关参数说明\nregistry文件夹里记录了filebeat当前采集文件的元信息（包含文件名、读取的offset、文件id等等）\n\n1、filebeat.registry.path\n如果不设置，默认路径是${path.data}/registry ，一般不设置 。\n\n2、filebeat.registry.file_permissions\nregistry文件操作权限码，默认是0600 ，如果没有特殊需求 使用默认值即可。注意：在windows上不支持此参数。\n\n3、filebeat.registry.flush\n默认值为0. 表示 当filebeat成功发送了采集的数据，立即刷新registry 。 用户可以合理设置刷新间隔， 减轻IO压力。\n\n4、filebeat.registry.migrate_file\n迁移文件路径： 从7.0后，registry存储方式和6.x的不一样。 如果你以前使用的是6.x版本的filebeat，然后想更新到7.x ，并且想沿用以前的registry信息，那么你可以使用这个参数：\n```\nfilebeat.registry.path: ${path.data}/registry\nfilebeat.registry.migrate_file: /path/to/old/registry_file\n```\n5、filebeat.shutdown_timeout\nFilebeat在关闭之前等待发布者完成发送事件的时间，然后Filebeat关闭。不建议设置该参数，因为确定shutdown_timeout的正确值很大程度上取决于Filebeat运行的环境以及输出的当前状态。\n\n6、filebeat.config\n可选配置 是否启动modules\n```\nfilebeat.config:\n  #modules:\n    #enabled: false\n    #path: modules.d/*.yml\n    #reload.enabled: true\n    #reload.period: 10s\n```\n如果你想在一个配置文件filebeat.yml里想采集复杂的多个log文件或者复杂输入源，你可以开启下面的配置（），然后自定义多个输入源文件即可。\n```\nfilebeat.config:\n  inputs:\n    enabled: true\n    path: inputs.d/*.yml\n    reload.enabled: true\n    reload.period: 10s\n```\n\n\n### 6、General\n所有Elastic Beats都支持这些选项。因为它们是通用选项，所以它们没有命名空间\n```\n#================================ General ======================================\n\n# The name of the shipper that publishes the network data. It can be used to group\n# all the transactions sent by a single shipper in the web interface.\n# If this options is not defined, the hostname is used.\n#name:\n\n# The tags of the shipper are included in their own field with each\n# transaction published. Tags make it easy to group servers by different\n# logical properties.\n#tags: [\"service-X\", \"web-tier\"]\n\n# Optional fields that you can specify to add additional information to the\n# output. Fields can be scalar values, arrays, dictionaries, or any nested\n# combination of these.\n#fields:\n#  env: staging\n\n# If this option is set to true, the custom fields are stored as top-level\n# fields in the output document instead of being grouped under a fields\n# sub-dictionary. Default is false.\n#fields_under_root: false\n\n# Internal queue configuration for buffering events to be published.\n#queue:\n  # Queue type by name (default 'mem')\n  # The memory queue will present all available events (up to the outputs\n  # bulk_max_size) to the output, the moment the output is ready to server\n  # another batch of events.\n  #mem:\n    # Max number of events the queue can buffer.\n    #events: 4096\n\n    # Hints the minimum number of events stored in the queue,\n    # before providing a batch of events to the outputs.\n    # The default value is set to 2048.\n    # A value of 0 ensures events are immediately available\n    # to be sent to the outputs.\n    #flush.min_events: 2048\n\n    # Maximum duration after which events are available to the outputs,\n    # if the number of events stored in the queue is < `flush.min_events`.\n    #flush.timeout: 1s\n\n  # The spool queue will store events in a local spool file, before\n  # forwarding the events to the outputs.\n  #\n  # Beta: spooling to disk is currently a beta feature. Use with care.\n  #\n  # The spool file is a circular buffer, which blocks once the file/buffer is full.\n  # Events are put into a write buffer and flushed once the write buffer\n  # is full or the flush_timeout is triggered.\n  # Once ACKed by the output, events are removed immediately from the queue,\n  # making space for new events to be persisted.\n  #spool:\n    # The file namespace configures the file path and the file creation settings.\n    # Once the file exists, the `size`, `page_size` and `prealloc` settings\n    # will have no more effect.\n    #file:\n      # Location of spool file. The default value is ${path.data}/spool.dat.\n      #path: \"${path.data}/spool.dat\"\n\n      # Configure file permissions if file is created. The default value is 0600.\n      #permissions: 0600\n\n      # File size hint. The spool blocks, once this limit is reached. The default value is 100 MiB.\n      #size: 100MiB\n\n      # The files page size. A file is split into multiple pages of the same size. The default value is 4KiB.\n      #page_size: 4KiB\n\n      # If prealloc is set, the required space for the file is reserved using\n      # truncate. The default value is true.\n      #prealloc: true\n\n    # Spool writer settings\n    # Events are serialized into a write buffer. The write buffer is flushed if:\n    # - The buffer limit has been reached.\n    # - The configured limit of buffered events is reached.\n    # - The flush timeout is triggered.\n    #write:\n      # Sets the write buffer size.\n      #buffer_size: 1MiB\n\n      # Maximum duration after which events are flushed if the write buffer\n      # is not full yet. The default value is 1s.\n      #flush.timeout: 1s\n\n      # Number of maximum buffered events. The write buffer is flushed once the\n      # limit is reached.\n      #flush.events: 16384\n\n      # Configure the on-disk event encoding. The encoding can be changed\n      # between restarts.\n      # Valid encodings are: json, ubjson, and cbor.\n      #codec: cbor\n    #read:\n      # Reader flush timeout, waiting for more events to become available, so\n      # to fill a complete batch as required by the outputs.\n      # If flush_timeout is 0, all available events are forwarded to the\n      # outputs immediately.\n      # The default value is 0s.\n      #flush.timeout: 0s\n\n# Sets the maximum number of CPUs that can be executing simultaneously. The\n# default is the number of logical CPUs available in the system.\n#max_procs:\n```\n\n#### 参数说明\n1、name\n默认是用服务器的主机名。该名称以agent.name字段而存在。\n\n2、tag\n为采集的日志消息定义tag信息标识，用于接收端处理响应的逻辑。\n```\ntags: [\"web-service\",\"info-file\"]\n```\n3、fields\n定义额外的字段信息，定义的字段以KV形式出现。默认是在fields下。\n\nfields: {project: \"credit\", env: \"prod\"}\n1\n如果设置了fields_under_root为true，那么自定义的KV 将作为根字段出现在发送的消息里。\n\n4、fields_under_root\n自定义的字段是否作为根字段。 使用实例\n```\nfields_under_root: true\nfields: {project: \"credit\", env: \"prod\"}\n```\n5、processors\nbeat提供的数据预处理 功能，如果定义了多个processors ，那么beat将会顺序执行。 更多定义的processor\n\n6、max_procs\n设置可以同时执行的最大CPU数。默认值为系统中可用的逻辑CPU的数量。\n\n\n### 7、 Processors\nbeat提供的数据预处理 功能，用于增强数据或者过滤数据。如果定义了多个processors ，那么beat将会顺序执行\n```\nevent -> processor 1 -> event1 -> processor 2 -> event2 ...\n```\n\n\n1、add_cloud_metadata\n添加云服务器实例元数据\n\n增加云服务器提供商的实例元数据来丰富每个事件。在启动时，它将查询托管提供程序的列表并缓存实例元数据。\n\n例如添加上这个配置\n```\nprocessors:\n  - add_cloud_metadata: ~\n```\n在阿里云上输出为\n```\n{\n  \"cloud\": {\n    \"availability_zone\": \"cn-shenzhen\",\n    \"instance.id\": \"i-wz9g2hqiikg0aliyun2b\",\n    \"provider\": \"ecs\",\n    \"region\": \"cn-shenzhen-a\"\n  }\n}\n```\n在腾讯云上输出为\n```\n{\n  \"cloud\": {\n    \"availability_zone\": \"gz-azone2\",\n    \"instance.id\": \"ins-qcloudv5\",\n    \"provider\": \"qcloud\",\n    \"region\": \"china-south-gz\"\n  }\n}\n```\n在aws上输出为\n```\n{\n  \"cloud\": {\n    \"account.id\": \"123456789012\",\n    \"availability_zone\": \"us-east-1c\",\n    \"instance.id\": \"i-4e123456\",\n    \"machine.type\": \"t2.medium\",\n    \"image.id\": \"ami-abcd1234\",\n    \"provider\": \"aws\",\n    \"region\": \"us-east-1\"\n  }\n}\n```\n\n2、add_cloudfoundry_metadata\n自动添加cloudfoundry应用程序的相关元数据\n\n该处理器使用来自cloudfoundry应用程序的相关元数据对每个事件进行增强。\n\n前提条件：只有当事件包含对CloudFoundry应用程序的引用（使用字段cloudfoundry.app.id)，并且配置了cloudfoundry客户端信息，才能能够检索应用程序的信息。\n\n配置示例：\n\n```\nprocessors:\n  - add_cloudfoundry_metadata:\n      api_address: https://api.dev.cfdev.sh\n      client_id: uaa-filebeat\n      client_secret: verysecret\n      ssl:\n        verification_mode: none\n      # To connect to Cloud Foundry over verified TLS you can specify a client and CA certificate.\n      #ssl:\n      #  certificate_authorities: [\"/etc/pki/cf/ca.pem\"]\n      #  certificate:              \"/etc/pki/cf/cert.pem\"\n      #  key:                      \"/etc/pki/cf/cert.key\"\n```\n\n\n3、add_docker_metadata\n自动添加docker容器相关元数据\n\nfilebeat在启动时，它检测一个docker环境元数据并缓存。只有在检测到有效配置并且处理器能够访问Docker API时，才会使用Docker元数据对事件数据进行追加。 目前在k8s场景下 一般使用log-pilot来协助采集日志。\n```\nprocessors:\n  - add_docker_metadata:\n      host: \"unix:///var/run/docker.sock\"\n      #match_fields: [\"system.process.cgroup.id\"]\n      #match_pids: [\"process.pid\", \"process.ppid\"]\n      #match_source: true\n      #match_source_index: 4\n      #match_short_id: true\n      #cleanup_timeout: 60\n      #labels.dedot: false\n      # To connect to Docker over TLS you must specify a client and CA certificate.\n      #ssl:\n      #  certificate_authority: \"/etc/pki/root/ca.pem\"\n      #  certificate:           \"/etc/pki/client/cert.pem\"\n      #  key:                   \"/etc/pki/client/cert.key\"\n```\n\n4、add_fields\n\n添加自定义字段信息\n\n添加字段信息（同这里用法类似），配置如下\n```\nprocessors:\n  - add_fields:\n      #  如果不指定，默认添加到 fields 里 \n      target: project\n      fields:\n        name: myproject\n        id: '574734885120952459'\n```\n输出为：\n```\n{\n  \"project\": {\n    \"name\": \"myproject\",\n    \"id\": \"574734885120952459\"\n  }\n}\n```\n\n5、add_host_metadata\n\n自动追加host相关信息，配置如下\n```\nprocessors:\n  - add_host_metadata:\n      cache.ttl: 5m\n      geo:\n        name: nyc-dc1-rack1\n        location: 40.7128, -74.0060\n        continent_name: North America\n        country_iso_code: US\n        region_name: New York\n        region_iso_code: NY\n        city_name: New York\n```\n结果为\n```\n{\n   \"host\":{\n      \"architecture\":\"x86_64\",\n      \"name\":\"example-host\",\n      \"id\":\"\",\n      \"os\":{\n         \"family\":\"darwin\",\n         \"build\":\"16G1212\",\n         \"platform\":\"darwin\",\n         \"version\":\"10.12.6\",\n         \"kernel\":\"16.7.0\",\n         \"name\":\"Mac OS X\"\n      },\n      \"ip\": [\"192.168.0.1\", \"10.0.0.1\"],\n      \"mac\": [\"00:25:96:12:34:56\", \"72:00:06:ff:79:f1\"],\n      \"geo\": {\n          \"continent_name\": \"North America\",\n          \"country_iso_code\": \"US\",\n          \"region_name\": \"New York\",\n          \"region_iso_code\": \"NY\",\n          \"city_name\": \"New York\",\n          \"name\": \"nyc-dc1-rack1\",\n          \"location\": \"40.7128, -74.0060\"\n        }\n   }\n}\n```\n\n\n6、add_id\n\n根据envet生成唯一的ID\n\n自动追加 根据envet生成唯一的ID\n\n配置如下：\n```\nprocessors:\n  - add_id: ~\n```\n输出为：\n```\n\"@metadata\": {                                                                                                                     \n    \"beat\": \"filebeat\",                                                                                                              \n    \"type\": \"_doc\",                                                                                                                  \n    \"version\": \"7.7.0\",                                                                                                              \n    \"_id\": \"jfXPVHQB95_6f7tCZ5hg\"                                                                                                    \n},\n```\n\n7、add_kubernetes_metadata\n该处理器使用相关元数据对每个事件进行注释，基于kubernetes pod生成事件的元数据。在启动时，它会检测到集群内的环境并缓存Kubernetes相关的元数据。只有在检测到有效配置时才会对事件进行注释。如果它不能检测到有效的Kubernetes配置，那么事件不会用Kubernetes相关的元数据进行注释。\n添加的注释有Pod Name 、Pod UID、Namespace、Labels\n```\nprocessors:\n  - add_kubernetes_metadata: ~\n```\n\n8、add_labels\n\n添加自定义标签，类似add_fileds功能 ，添加的kv输出后默认在labels字段下\n```\nprocessors:\n  - add_labels:\n      labels:\n        number: 1\n        with.dots: test\n        nested:\n          with.dots: nested\n        array:\n          - do\n          - re\n          - with.field: mi\n```\n输出：\n```\n{\n  \"labels\": {\n    \"number\": 1,\n    \"with.dots\": \"test\",\n    \"nested.with.dots\": \"nested\",\n    \"array.0\": \"do\",\n    \"array.1\": \"re\",\n    \"array.2.with.field\": \"mi\"\n  }\n}\n```\n\n9、add_locale\n自动添加时区信息，常用语国际业务中。\n```\nprocessors:\n  - add_locale: ~\n```\n下面的意思是 使用缩写模式 ， 例如国内输出结果为CST\n```\nprocessors:\n  - add_locale:\n      format: abbreviation\n```\n10、add_observer_metadata\n自动添加观察者机器的相关元数据\n```\nprocessors:\n  - add_observer_metadata:\n      cache.ttl: 5m\n```\n输出为：\n```\n{\n  \"observer\" : {\n    \"hostname\" : \"avce\",\n    \"type\" : \"heartbeat\",\n    \"vendor\" : \"elastic\",\n    \"ip\" : [\n      \"192.168.1.251\",\n      \"fe80::64b2:c3ff:fe5b:b974\",\n    ],\n    \"mac\" : [\n      \"dc:c1:02:6f:1b:ed\",\n    ]\n  }\n}\n```\n11、add_tags\n添加标签，并可指定标签在哪个字段下。\n\n例如：\n```\nprocessors:\n  - add_tags:\n      tags: [web, production]\n      target: \"environment\"\n```\n输出为：\n```\n{\n  \"environment\": [\"web\", \"production\"]\n}\n```\n12、convert\n将event中的某个字段转换为其他类型，例如将字符串转换为整数。\n```\nprocessors:\n  - convert:\n      fields:\n        - {from: \"src_ip\", to: \"source.ip\", type: \"ip\"}\n        - {from: \"src_port\", to: \"source.port\", type: \"integer\"}\n      ignore_missing: true\n      fail_on_error: false\n```\n13、copy_fields\n将event中的某个字段的值赋值给另一个字段\n```\nprocessors:\n  - copy_fields:\n      fields:\n        - from: message\n          to: event.original\n      fail_on_error: false\n      ignore_missing: true\n```\n输出：\n```\n{\n  \"message\": \"my-interesting-message\",\n  \"event\": {\n      \"original\": \"my-interesting-message\"\n  }\n}\n```\n\n14、decode_base64_field\nbase64解码，从一个字段里获取值，解码后赋值给另一个字段。\n```\nprocessors:\n  - decode_base64_field:\n      field:\n        from: \"message\"\n        to: \"decode\"\n      ignore_missing: true\n      fail_on_error: false\n```\n15、decode_cef\n如果你的日式符合Common Event Format (CEF) 标准，你可以使用它进行解码：\n```\nprocessors:\n  - rename:\n      fields:\n        - {from: \"message\", to: \"event.original\"}\n  - decode_cef:\n      field: event.original\n```\n更多关于cef的介绍\n\n16、decode_csv_fields\n解析CSF格式的日志到指定字段，内容为数组。\n```\nprocessors:\n  - decode_csv_fields:\n     # 解析到哪里\n      fields:\n        message: decoded.csv\n      separator: \",\"\n      ignore_missing: false\n      overwrite_keys: true\n      trim_leading_space: false\n      fail_on_error: true\n```\n17、decode_json_fields\n处理对包含JSON字符串的字段进行解码，并将字符串替换为有效的JSON对象。默认是在当前字段替换。\n```\nprocessors:\n  - decode_json_fields:\n      fields: [\"field1\", \"field2\", ...]\n     # process_array: false\n      # max_depth: 1\n     # overwrite_keys: false\n     # add_error_key: true\n```\n18、decompress_gzip_field\ngzip解压缩，从一个字段值中加压缩到另一个字段中 。 使用场景少。\n```\nprocessors:\n  - decompress_gzip_field:\n      field:\n        from: \"field1\"\n        to: \"field2\"\n      ignore_missing: false\n      fail_on_error: true\n```\n感兴趣的可以看下 gzip压缩初探\n\n19、dissect\n从某个字段里（默认message）取值，按照tokenizer定义的格式 拆分（切割）数据，并输出到target_prefix 字段里，默认是dissect\n```\nprocessors:\n  - dissect:\n      tokenizer: \"%{key1} %{key2}\"\n      # field: \"message\"\n     # target_prefix: \"dissect\"\n```\n如果是这样的log\"App01 - WebServer is up and running\" ，输出为\n```\n\"service\": {\n  \"name\": \"App01\",\n  \"status\": \"WebServer is up and running\"\n},\n```\n20、dns\n反向解析 根据id查找hostname 。每个processor有自己查询结果的缓存。该processor使用自己的域名服务器，不会查找/etc/hosts ，默认使用/etc/resolv.conf里面的域名服务器。\n```\nprocessors:\n  - dns:\n      type: reverse\n      fields:\n        source.ip: source.hostname\n        destination.ip: destination.hostname\n```\nfields字段里source.ip是指ip所在的字段，source.hostname是指新值存入的字段。\n\n21、drop_event\n丢弃该event，一般要设置特定条件 。\n\n例如 http响应码为200 就不上报event：\n```\nprocessors:\n  - drop_event:\n      when:\n        equals:\n          http.code: 200\n```\n\n22、drop_fields\n丢弃（过滤掉）特定字段， 一般防止敏感信息上报，例如ip 、mac地址…\n```\nprocessors:\n  - drop_fields:\n      fields: [\"cpu.user\", \"cpu.system\"]\n```\n23、extract_array\n\n从数组中取值并填充（映射到）指定字段\n\n配置示例：\n```\n  - add_tags:\n      tags: [\"127.0.0.1\", \"114.114.114.114\",\"8080\"]\n      target: \"my_array\"\n  - extract_array:\n      field: my_array\n      mappings:\n        source.ip: 0\n        source.destination.ip: 1\n        source.network.transport: 2\n      fail_on_error: true\n      ignore_missing: false\n```\n\n\n24、fingerprint\n\n根据事件指定字段字段值生成事件的指纹。\n```\nprocessors:\n  - fingerprint:\n      fields: [\"field1\", \"field2\", ...]\n```\n\n25、include_fields\n\n输出的event里 会包含哪些字段值。@timestamp和type字段会始终出现在event中，即使未在include_fields列表中定义。\n```\nprocessors:\n  - include_fields:\n      when:\n        condition\n      fields: [\"field1\", \"field2\", ...]\n```\n26、registered_domain\n域名注册，识别一个长串域名，转化成一个简短域名 。\n\n比如我有一条日志：\n```\nhttps://www.netcn.console.aliyun.com/\n```\nfilebeat配置：\n```\nprocessors:\n  - registered_domain:\n      field: message\n      target_field: result.registered_domain\n      ignore_missing: true\n      ignore_failure: true\n```\n输出为\n```\n\"result\": {\n  \"registered_domain\": \"aliyun.com/\"\n}\n```\n\n27、rename\n\n重命名字段\n\n示例： 把host重命名为hostRename\n```\nprocessors:\n  - rename:\n      fields:\n        - from: \"host\"\n          to: \"hostRename\"\n      ignore_missing: false\n      fail_on_error: true\n```\n\n28、script\n\n使用Javascript 处理event ，可以更加灵活的预处理业务\n\n29、timestamp\n\n从字段解析时间戳并将解析结果写入@timestamp（日志采集时间）字段\n\n从某个字段解析时间戳，并将解析结果写入@timestamp中，可以自定义日志采集时间。\n\n配置如下：\n```\nprocessors:\n   timestamp:\n      field: start_time\n      layouts:\n        - '2006-01-02T15:04:05Z'\n        - '2006-01-02T15:04:05.999Z'\n      test:\n        - '2019-06-22T16:33:51Z'\n        - '2019-11-18T04:59:51.123Z'\n   drop_fields:\n      fields: [start_time]\n```\n\n```\nlayouts 是时间格式，用于格式化start_time里的时间，这个是go语言的时间格式。 类似java中的yyyy-MM-dd HH:mm:ss 。\ntest 是在filebeat启动时 验证layouts的格式能否格式化 测试时间。\n```\n\n\n30、translate_sid\n将Windows安全标识符（SID）转换为帐户名，使用仅限Windows系统。\n```\nprocessors:\n  - translate_sid:\n      field: winlog.event_data.MemberSid\n      account_name_target: user.name\n      domain_target: user.domain\n      ignore_missing: true\n      ignore_failure: true\n```\n31、translate_sid\n按照指定大小截取字段值\n```\nprocessors:\n  - truncate_fields:\n    fields:\n    - message\n    max_characters: 5\n    #max_bytes: 128\n    fail_on_error: false\n    ignore_missing: true\n```\n32、urldecode\nurl 解码\n```\nprocessors:\n  - urldecode:\n      fields:\n        - from: \"field1\"\n          to: \"field2\"\n      #  - from: \"fieldx\"\n       #  to: \"fieldy\"\n      ignore_missing: false\n      fail_on_error: true\n```\n\n### Outputs\n\nElasticsearch\n\n\n常规配置\n```\noutput.elasticsearch:\n  hosts: [\"https://es.bingmaning:9200\"]\n  username: \"bingmaning\"\n  password: \"lingshui2008@qq.com\"\n  index: \"%{[fields.log_type]}-%{[agent.version]}-%{+yyyy.MM.dd}\"\n```\n更多配置\n```\noutput.elasticsearch:\n  # Boolean flag to enable or disable the output module.\n  #enabled: true\n\n  #es地址\n  hosts: [\"https://es.bingmaning:9200\"]\n\n  # 设置压缩级别\n  compression_level: 0\n\n  # 是否转义html符号\n  escape_html: false\n\n  # 协议，默认http\n  protocol: \"https\"\n\n  # 认证方式一\n  api_key: \"id:api_key\"\n  # 认证方式二\n  username: \"elastic\"\n  password: \"changeme\"\n\n  # 通过索引操作在URL中传递的HTTP参数字典\n  parameters:\n    #param1: value1\n    #param2: value2\n\n  # 每个Elasticsearch主机worker数量。  \n  worker: 1\n\n  #默认索引 filebeat-YYYY.MM.DD  。 可自定义\n  index: \"filebeat-%{[agent.version]}-%{+yyyy.MM.dd}\"\n\n  # 自定义 pipeline\n  pipeline: \"\"\n\n  # 默认http路径\n  path: \"/elasticsearch\"\n\n  # 自定义http header\n  headers:\n    X-My-Header: Contents of the header\n\n  # 代理地址\n  proxy_url: http://proxy:3128\n\n  # 是否禁用代理 默认false\n  proxy_disable: false\n\n  # 尝试特定Elasticsearch索引操作的次数。如果多次重试后，索引操作未成功，事件被丢弃。默认为3。\n  max_retries: 3\n\n  # 单个Elasticsearch批量API索引请求中要批量处理的最大事件数\n  # The default is 50.\n  bulk_max_size: 50\n\n  # 重连 初始等待时间，如果失败会指数值增长。\n  backoff.init: 1s\n\n  # 最大等待重连时间。默认60秒\n  backoff.max: 60s\n\n  # 请求超时时间\n  timeout: 90\n\n  # 使用ssl？\n  ssl.enabled: true\n\n  # ssl认证方式，默认为full。 测试时 可以使用 none\n  ssl.verification_mode: full\n\n  #可用 tls 版本\n  ssl.supported_protocols: [TLSv1.1, TLSv1.2, TLSv1.3]\n\n  # 根证书地址\n  ssl.certificate_authorities: [\"/etc/pki/root/ca.pem\"]\n\n  # 客户端证书\n  ssl.certificate: \"/etc/pki/client/cert.pem\"\n\n  # 客户端密钥\n  ssl.key: \"/etc/pki/client/cert.key\"\n\n  # 密码短语\n  ssl.key_passphrase: ''\n\n  # 配置密码套件以用于SSL连接\n  ssl.cipher_suites: []\n\n  # 为基于ECDHE的密码套件配置曲线类型\n  ssl.curve_types: []\n\n  # 配置支持哪些类型的重新协商。有效选项是 \n  # never, once, and freely. 默认是 never.\n  ssl.renegotiation: never\n\n  # 配置一个可用于对已验证证书链进行额外验证的pin， 这可以确保使用特定证书来验证信任链。\n  # 该pin是SHA-256指纹的base64编码字符串。.\n  ssl.ca_sha256: \"\"\n\n  # 是否支持 Kerberos \n  kerberos.enabled: true\n\n  # Kerberos认证类型： keytab, password.\n  kerberos.auth_type: password\n\n  # 密钥表文件的路径。当auth_type设置为keytab时使用。\n  kerberos.keytab: /etc/elastic.keytab\n\n  #  Kerberos configuration.\n  kerberos.config_path: /etc/krb5.conf\n\n  # Name of the Kerberos user.\n  kerberos.username: elastic\n\n  # Kerberos用户的密码。当auth_type设置为password时使用。\n  kerberos.password: changeme\n\n  # Kerberos realm.\n  kerberos.realm: ELASTIC\n```\n\nlogstash\n\n常规配置\n1、filebeat.yml中配置如下：\n```\noutput.logstash:\n  hosts: [\"localhost:5044\", \"localhost:5045\"]\n  # 开这个参数 需要多个hosts\n  loadbalance: true\n```\n\n2、logstash-pipeline.conf中配置如下：\n```\ninput {\n  beats {\n    port => 5044\n  }\n}\nfilter{\n// 数据的各种处理  \n....\n}\noutput {\n  elasticsearch {\n    hosts => [\"http://localhost:9200\"]\n    #  @metadata 解释如下\n    index => \"%{[@metadata][beat]}-%{[@metadata][version]}-%{+YYYY.MM.dd}\" \n  }\n}\n```\n\nfilebeat详细配置\n```\noutput.logstash:\n\n  enabled: true\n  \n  hosts: [\"localhost:5044\"]\n\n  # 每个logstash worker数量。  \n  worker: 1\n\n  # 压缩级别\n  compression_level: 3\n\n  # 是否转义html符号\n  escape_html: false\n\n  #最大链接时间 。 0 代表不启用此功能\n  # 不支持async connections\n  ttl: 30s\n\n  # 是否需要负载均衡\n  loadbalance: false\n\n  # 处理时异步发送到Logstash的批次数\n  pipelining: 2\n\n  # 如果启用，在没有没有遇到错误的情况下，则每次仅传输一批事件中的一部分事件 ，直到要发送的事件数量增加到`bulk_max_size`\n  slow_start: false\n\n  # 重连时间策略 \n  backoff.init: 1s\n  backoff.max: 60s\n\n  # 默认索引 一般都会重写\n  index: 'filebeat'\n\n  # SOCKS5 proxy server URL\n  proxy_url: socks5://user:password@socks5-server:2233\n\n  # 是否启用本地解析器\n  proxy_use_local_resolver: false\n\n # 使用ssl？\n  ssl.enabled: true\n\n  # ssl认证方式，默认为full。 测试时 可以使用 none\n  ssl.verification_mode: full\n\n  #可用 tls 版本\n  ssl.supported_protocols: [TLSv1.1, TLSv1.2, TLSv1.3]\n\n  # 根证书地址\n  ssl.certificate_authorities: [\"/etc/pki/root/ca.pem\"]\n\n  # 客户端证书\n  ssl.certificate: \"/etc/pki/client/cert.pem\"\n\n  # 客户端密钥\n  ssl.key: \"/etc/pki/client/cert.key\"\n\n  # 密码短语\n  ssl.key_passphrase: ''\n\n  # 配置密码套件以用于SSL连接\n  ssl.cipher_suites: []\n\n  # 为基于ECDHE的密码套件配置曲线类型\n  ssl.curve_types: []\n\n  # 配置支持哪些类型的重新协商。有效选项是 \n  # never, once, and freely. 默认是 never.\n  ssl.renegotiation: never\n\n  # 配置一个可用于对已验证证书链进行额外验证的pin， 这可以确保使用特定证书来验证信任链。\n  # 该pin是SHA-256指纹的base64编码字符串。.\n  ssl.ca_sha256: \"\"\n  \n  # 尝试特定Elasticsearch索引操作的次数。如果多次重试后，索引操作未成功，事件被丢弃。默认为3。\n  max_retries: 3\n  # 单个Logstash request 最大event数量 default is 2048.\n  bulk_max_size: 2048\n\n  # 等待Logstash server响应最大超时时间。默认是 30s.\n  timeout: 30s\n```\n\n\nredis\nRedis输出将event插入Redis列表或Redis通道。该输出插件与Logstash的Redis输入插件兼容。\n\n常规配置\n```\n# 采集配置\nfilebeat.inputs:     #收集日志\n- type: log         #类型\n  enabled: true     #始终收集\n  paths:\n    - /etc/log/*.log    \n# 输出配置\noutput.redis:        \n  hosts: [\"127.0.0.1:6379\"]  #输出在redis里\n  password: \"123456\"   #redis认证密码，我没有\n  key: \"filebeat7.7\"       #日志redis的key值\n  db: 0                 #redis数据库0\n  timeout: 5             #redis链接超时  默认5s\n```\n\n所有可配置参数\n```\noutput.redis:\n  # Boolean flag to enable or disable the output module.\n  enabled: true\n\n  # Configure JSON encoding\n  codec.json:\n    # Pretty print json event\n    pretty: false\n\n    # Configure escaping HTML symbols in strings.\n    escape_html: false\n\n  # The list of Redis servers to connect to. If load-balancing is enabled, the\n  # events are distributed to the servers in the list. If one server becomes\n  # unreachable, the events are distributed to the reachable servers only.\n  # The hosts setting supports redis and rediss urls with custom password like\n  # redis://:password@localhost:6379.\n  hosts: [\"localhost:6379\"]\n\n  # The name of the Redis list or channel the events are published to. The\n  # default is filebeat.\n  key: filebeat\n\n  # The password to authenticate to Redis with. The default is no authentication.\n  password:\n\n  # The Redis database number where the events are published. The default is 0.\n  db: 0\n\n  # The Redis data type to use for publishing events. If the data type is list,\n  # the Redis RPUSH command is used. If the data type is channel, the Redis\n  # PUBLISH command is used. The default value is list.\n  datatype: list\n\n  # The number of workers to use for each host configured to publish events to\n  # Redis. Use this setting along with the loadbalance option. For example, if\n  # you have 2 hosts and 3 workers, in total 6 workers are started (3 for each\n  # host).\n  worker: 1\n\n  # If set to true and multiple hosts or workers are configured, the output\n  # plugin load balances published events onto all Redis hosts. If set to false,\n  # the output plugin sends all events to only one host (determined at random)\n  # and will switch to another host if the currently selected one becomes\n  # unreachable. The default value is true.\n  loadbalance: true\n\n  # The Redis connection timeout in seconds. The default is 5 seconds.\n  timeout: 5s\n\n  # The number of times to retry publishing an event after a publishing failure.\n  # After the specified number of retries, the events are typically dropped.\n  # Some Beats, such as Filebeat, ignore the max_retries setting and retry until\n  # all events are published. Set max_retries to a value less than 0 to retry\n  # until all events are published. The default is 3.\n  max_retries: 3\n\n  # The number of seconds to wait before trying to reconnect to Redis\n  # after a network error. After waiting backoff.init seconds, the Beat\n  # tries to reconnect. If the attempt fails, the backoff timer is increased\n  # exponentially up to backoff.max. After a successful connection, the backoff\n  # timer is reset. The default is 1s.\n  backoff.init: 1s\n\n  # The maximum number of seconds to wait before attempting to connect to\n  # Redis after a network error. The default is 60s.\n  backoff.max: 60s\n\n  # The maximum number of events to bulk in a single Redis request or pipeline.\n  # The default is 2048.\n  bulk_max_size: 2048\n\n  # The URL of the SOCKS5 proxy to use when connecting to the Redis servers. The\n  # value must be a URL with a scheme of socks5://.\n  proxy_url:\n\n  # This option determines whether Redis hostnames are resolved locally when\n  # using a proxy. The default value is false, which means that name resolution\n  # occurs on the proxy server.\n  proxy_use_local_resolver: false\n\n  # Enable SSL support. SSL is automatically enabled, if any SSL setting is set.\n  ssl.enabled: true\n\n  # Configure SSL verification mode. If `none` is configured, all server hosts\n  # and certificates will be accepted. In this mode, SSL based connections are\n  # susceptible to man-in-the-middle attacks. Use only for testing. Default is\n  # `full`.\n  ssl.verification_mode: full\n\n  # List of supported/valid TLS versions. By default all TLS versions from 1.1\n  # up to 1.3 are enabled.\n  ssl.supported_protocols: [TLSv1.1, TLSv1.2, TLSv1.3]\n\n  # Optional SSL configuration options. SSL is off by default.\n  # List of root certificates for HTTPS server verifications\n  ssl.certificate_authorities: [\"/etc/pki/root/ca.pem\"]\n\n  # Certificate for SSL client authentication\n  ssl.certificate: \"/etc/pki/client/cert.pem\"\n\n  # Client Certificate Key\n  ssl.key: \"/etc/pki/client/cert.key\"\n\n  # Optional passphrase for decrypting the Certificate Key.\n  ssl.key_passphrase: ''\n\n  # Configure cipher suites to be used for SSL connections\n  ssl.cipher_suites: []\n\n  # Configure curve types for ECDHE based cipher suites\n  ssl.curve_types: []\n\n  # Configure what types of renegotiation are supported. Valid options are\n  # never, once, and freely. Default is never.\n  ssl.renegotiation: never\n```\n\n\nfile\n\n配置filebeat的输出方式为文件， 一般用于测试。\n\n常规配置\n```\n# 采集配置\nfilebeat.inputs:     #收集日志\n- type: log         #类型\n  enabled: true     #始终收集\n  paths:\n    - /etc/log/*.log    \n# 输出配置\noutput.file:\n  path: \"/tmp/filebeat\"  #  输出路径\n  filename: filebeat    # 输出文件名\n```\n\n所有可配置参数\n```\noutput.file:\n  # Boolean flag to enable or disable the output module.\n  enabled: true\n\n  # Configure JSON encoding\n  codec.json:\n    # Pretty-print JSON event\n    pretty: false\n\n    # Configure escaping HTML symbols in strings.\n    escape_html: false\n\n  # Path to the directory where to save the generated files. The option is\n  # mandatory.\n  path: \"/tmp/filebeat\"\n\n  # Name of the generated files. The default is `filebeat` and it generates\n  # files: `filebeat`, `filebeat.1`, `filebeat.2`, etc.\n  filename: filebeat\n\n  # Maximum size in kilobytes of each file. When this size is reached, and on\n  # every Filebeat restart, the files are rotated. The default value is 10240\n  # kB.\n  rotate_every_kb: 10000\n\n  # Maximum number of files under path. When this number of files is reached,\n  # the oldest file is deleted and the rest are shifted from last to first. The\n  # default is 7 files.\n  number_of_files: 7\n\n  # Permissions to use for file creation. The default is 0600.\n  permissions: 0600\n```\n\nconsole\n\n输出到控制面板，测试输出最佳方式。\n\n常规配置\n```\n# 采集配置\nfilebeat.inputs:     #收集日志\n- type: log         #类型\n  enabled: true     #始终收集\n  paths:\n    - /etc/log/*.log    \n# 输出配置\noutput.console:\n  codec.json:\n    # 漂亮输出（格式化）\n    pretty: true\n    #  转义HTML符号\n    escape_html: true\n```\n\n\n### Keystore\n\n密钥库地址（一般是包含私钥以及关键数据的文件路径）\n```\nkeystore.path: \"${path.config}/beats.keystore\"\n```\n\n命令\n```\n创建一个存储密码的keystore：   filebeat keystore create\n然后往其中添加键值对，例如：    filebeatk eystore add ES_PWD\n使用覆盖原来键的值：           filebeat key store add ES_PWD–force\n删除键值对：                  filebeat key store remove ES_PWD\n查看已有的键值对：             filebeat key store list\n```\n\n\n### Setup ILM\n\n从7.0版开始，Filebeat在连接到支持生命周期管理的群集时默认使用索引生命周期管理。Filebeat自动加载默认策略并将其应用于Filebeat创建的任何索引。\n\nindex lifecycle management (ILM) 索引生命管理，如果它启用了，那么会忽略output.elasticsearch.index 里面的设置。\n\n新特性：当现有索引达到指定的大小或期限时，使用索引生命周期策略自动将过渡到新索引\n\n常规配置\n```\nsetup.ilm.enabled: auto\nsetup.ilm.rollover_alias: \"filebeat\"  # 前缀\n# filebeat-2020.09.28-000001\nsetup.ilm.pattern: \"{now/d}-000001\"   \n```\n\n需要了解Date math\n\n详细配置\n```\n# Configure index lifecycle management (ILM). These settings create a write\n# alias and add additional settings to the index template. When ILM is enabled,\n# output.elasticsearch.index is ignored, and the write alias is used to set the\n# index name.\n\n# Enable ILM support. Valid values are true, false, and auto. When set to auto\n# (the default), the Beat uses index lifecycle management when it connects to a\n# cluster that supports ILM; otherwise, it creates daily indices.\nsetup.ilm.enabled: auto\n\n# Set the prefix used in the index lifecycle write alias name. The default alias\n# name is 'filebeat-%{[agent.version]}'.\nsetup.ilm.rollover_alias: \"filebeat\"\n\n# Set the rollover index pattern. The default is \"%{now/d}-000001\".\n# filebeat-2020.09.28-000001\nsetup.ilm.pattern: \"{now/d}-000001\"\n\n# Set the lifecycle policy name. The default policy name is\n# 'filebeat'.\nsetup.ilm.policy_name: \"mypolicy\"\n\n# The path to a JSON file that contains a lifecycle policy configuration. Used\n# to load your own lifecycle policy.\nsetup.ilm.policy_file:\n\n# Disable the check for an existing lifecycle policy. The default is true. If\n# you disable this check, set setup.ilm.overwrite: true so the lifecycle policy\n# can be installed.\nsetup.ilm.check_exists: true\n\n# Overwrite the lifecycle policy at startup. The default is false.\nsetup.ilm.overwrite: false\n```\n\n\nLogging\n\n配置日志输出的选项。日志记录系统可以将日志写入syslog或轮换日志文件。如果未显式配置日志记录，则使用文件输出，输出路径为/var/log/filebeat。\n\n常规配置\n```\n#log 输出级别 \nlogging.level: info \n# 输出方式\nlogging.to_files: true\n# 输出路径、名字、 log文件最大数、文件操作权限\nlogging.files:\n  path: /var/log/filebeat\n  name: filebeat\n  keepfiles: 7\n  permissions: 0644\n```\n\n\n详细参数\n```\n# There are four options for the log output: file, stderr, syslog, eventlog\n# The file output is the default.\n\n# Sets log level. The default log level is info.\n# Available log levels are: error, warning, info, debug\nlogging.level: info\n\n# Enable debug output for selected components. To enable all selectors use [\"*\"]\n# Other available selectors are \"beat\", \"publish\", \"service\"\n# Multiple selectors can be chained.\n# 输出哪些服务的log\nlogging.selectors: [ ]\n\n# Send all logging output to stderr. The default is false.\nlogging.to_stderr: false\n\n# Send all logging output to syslog. The default is false.\nlogging.to_syslog: false\n\n# Send all logging output to Windows Event Logs. The default is false.\nlogging.to_eventlog: false\n\n# If enabled, Filebeat periodically logs its internal metrics that have changed\n# in the last period. For each metric that changed, the delta from the value at\n# the beginning of the period is logged. Also, the total values for\n# all non-zero internal metrics are logged on shutdown. The default is true.\nlogging.metrics.enabled: true\n\n# The period after which to log the internal metrics. The default is 30s.\nlogging.metrics.period: 30s\n\n# Logging to rotating files. Set logging.to_files to false to disable logging to\n# files.\nlogging.to_files: true\nlogging.files:\n  # Configure the path where the logs are written. The default is the logs directory\n  # under the home path (the binary location).\n  path: /var/log/filebeat\n\n  # The name of the files where the logs are written to.\n  name: filebeat\n\n  # Configure log file size limit. If limit is reached, log file will be\n  # automatically rotated\n  rotateeverybytes: 10485760 # = 10MB\n\n  # Number of rotated log files to keep. Oldest files will be deleted first.\n  keepfiles: 7\n\n  # The permissions mask to apply when rotating log files. The default value is 0600.\n  # Must be a valid Unix-style file permissions mask expressed in octal notation.\n  permissions: 0600\n\n  # Enable log file rotation on time intervals in addition to size-based rotation.\n  # Intervals must be at least 1s. Values of 1m, 1h, 24h, 7*24h, 30*24h, and 365*24h\n  # are boundary-aligned with minutes, hours, days, weeks, months, and years as\n  # reported by the local system clock. All other intervals are calculated from the\n  # Unix epoch. Defaults to disabled.\n  interval: 0\n\n  # Rotate existing logs on startup rather than appending to the existing\n  # file. Defaults to true.\n   rotateonstartup: true\n\n# Set to true to log messages in JSON format.\nlogging.json: false\n\n# Set to true, to log messages with minimal required Elastic Common Schema (ECS)\n# information. Recommended to use in combination with `logging.json=true`\n# Defaults to false.\nlogging.ecs: false\n```\n\n\n\n","slug":"elk/filebeat","published":1,"updated":"2021-07-05T07:25:14.383Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cku697a2l00c500uhdiun8ktu","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><p>摘要: filebeat 使用</p>\n<span id=\"more\"></span>\n\n\n<h1 id=\"filebeat-使用\"><a href=\"#filebeat-使用\" class=\"headerlink\" title=\"filebeat 使用\"></a>filebeat 使用</h1><h2 id=\"一、前言\"><a href=\"#一、前言\" class=\"headerlink\" title=\"一、前言\"></a>一、前言</h2><p>这里使用的7.7.0版本，在官方文档快速上手的中，只要简单配置了filelbeat.yml ，启动filebeat就可以收集日志了。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 定义输入</span><br><span class=\"line\">filebeat.inputs:</span><br><span class=\"line\">- type: log</span><br><span class=\"line\">  enabled: true</span><br><span class=\"line\">  paths:</span><br><span class=\"line\">    - &#x2F;var&#x2F;log&#x2F;*.log</span><br><span class=\"line\"># 定义输出</span><br><span class=\"line\">output.elasticsearch:</span><br><span class=\"line\">  hosts: [&quot;myEShost:9200&quot;]</span><br><span class=\"line\">  username: &quot;filebeat_internal&quot;</span><br><span class=\"line\">  password: &quot;YOUR_PASSWORD&quot; </span><br><span class=\"line\">setup.kibana:</span><br><span class=\"line\">  host: &quot;mykibanahost:5601&quot;</span><br><span class=\"line\">  username: &quot;my_kibana_user&quot;  </span><br><span class=\"line\">  password: &quot;YOUR_PASSWORD&quot;</span><br></pre></td></tr></table></figure>\n\n<p>其实filebeat提供的可配置项有很多，这里就以大模块角度了解下其分类。 更多详细内容，<a href=\"https://www.elastic.co/guide/en/beats/filebeat/7.7/index.html\">点击查看官网</a>。</p>\n<h2 id=\"二、参数配置分类\"><a href=\"#二、参数配置分类\" class=\"headerlink\" title=\"二、参数配置分类\"></a>二、参数配置分类</h2><h3 id=\"1、-Paths\"><a href=\"#1、-Paths\" class=\"headerlink\" title=\"1、 Paths\"></a>1、 Paths</h3><p>用于定义Filebeat查找相关文件的位置。例如，Filebeat在config路径中查找启动文件，并在log路径中写入日志文件。Filebeat在data路径中查找其registry文件。</p>\n<p>用户可以不配置，使用默认的路径。也可以自定义配置路径：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">path.home: &#x2F;usr&#x2F;share&#x2F;filebeat</span><br><span class=\"line\">path.config: &#x2F;etc&#x2F;filebeat</span><br><span class=\"line\">path.data: &#x2F;var&#x2F;lib&#x2F;filebeat</span><br><span class=\"line\">path.logs: &#x2F;var&#x2F;log&#x2F;</span><br></pre></td></tr></table></figure>\n\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; Paths &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class=\"line\"></span><br><span class=\"line\"># The home path for the Filebeat installation. This is the default base path</span><br><span class=\"line\"># for all other path settings and for miscellaneous files that come with the</span><br><span class=\"line\"># distribution (for example, the sample dashboards).</span><br><span class=\"line\"># If not set by a CLI flag or in the configuration file, the default for the</span><br><span class=\"line\"># home path is the location of the binary.</span><br><span class=\"line\">#path.home:</span><br><span class=\"line\"></span><br><span class=\"line\"># The configuration path for the Filebeat installation. This is the default</span><br><span class=\"line\"># base path for configuration files, including the main YAML configuration file</span><br><span class=\"line\"># and the Elasticsearch template file. If not set by a CLI flag or in the</span><br><span class=\"line\"># configuration file, the default for the configuration path is the home path.</span><br><span class=\"line\">#path.config: $&#123;path.home&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"># The data path for the Filebeat installation. This is the default base path</span><br><span class=\"line\"># for all the files in which Filebeat needs to store its data. If not set by a</span><br><span class=\"line\"># CLI flag or in the configuration file, the default for the data path is a data</span><br><span class=\"line\"># subdirectory inside the home path.</span><br><span class=\"line\">#path.data: $&#123;path.home&#125;&#x2F;data</span><br><span class=\"line\"></span><br><span class=\"line\"># The logs path for a Filebeat installation. This is the default location for</span><br><span class=\"line\"># the Beat&#39;s log files. If not set by a CLI flag or in the configuration file,</span><br><span class=\"line\"># the default for the logs path is a logs subdirectory inside the home path.</span><br><span class=\"line\">#path.logs: $&#123;path.home&#125;&#x2F;logs</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"配置参数说明\"><a href=\"#配置参数说明\" class=\"headerlink\" title=\"配置参数说明\"></a>配置参数说明</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1、path.home</span><br><span class=\"line\">Filebeat安装的主路径。这是所有其他路径设置和发行版附带的其他文件（例如，示例仪表板）的默认基本路径。如果未设置，则主路径的默认值是Filebeat二进制文件的位置。</span><br><span class=\"line\"></span><br><span class=\"line\">2、path.config</span><br><span class=\"line\">Filebeat安装的配置路径。这是配置文件的默认基本路径，包括主YAML配置文件和Elasticsearch模板文件。如果设置，则配置路径的默认值为&#123;path.home&#125;路径。</span><br><span class=\"line\"></span><br><span class=\"line\">3、path.data</span><br><span class=\"line\">Filebeat的数据路径。这是Filebeat需要存储其数据的所有文件的默认基本路径。如果设置，则数据路径的默认值是&#123;path.home&#125;&#x2F;data。</span><br><span class=\"line\"></span><br><span class=\"line\">注意： 每个filebeat实例的path.data必须是唯一的。</span><br><span class=\"line\"></span><br><span class=\"line\">4、path.log</span><br><span class=\"line\">Filebeat的日志路径。这是Filebeat日志文件的默认位置。如果未设置，则日志路径的默认值为&#123;path.home&#125;&#x2F;log。</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"默认启动时的路径\"><a href=\"#默认启动时的路径\" class=\"headerlink\" title=\"默认启动时的路径\"></a>默认启动时的路径</h4><p>比如说用户在 /home/abc/work 路径下启动filebeat，那么path.home 就默认为 当前路径。并且可以看到 多了两个文件夹data和 log</p>\n<h3 id=\"2、Modules-configuration\"><a href=\"#2、Modules-configuration\" class=\"headerlink\" title=\"2、Modules configuration\"></a>2、Modules configuration</h3><p>Filebeat模块简化了常见日志格式的收集、解析和可视化。典型的模块（比如Nginx日志）由一个或多个文件集组成（对于Nginx，是access和error），如果你启用了下面的module, fileabeat就可以根据系统自动去寻找access、error 对应的log文件进行收集。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- module: nginx</span><br><span class=\"line\">  # Access logs</span><br><span class=\"line\">  #access:</span><br><span class=\"line\">    #enabled: true</span><br><span class=\"line\"></span><br><span class=\"line\">    # Set custom paths for the log files. If left empty,</span><br><span class=\"line\">    # Filebeat will choose the paths depending on your OS.</span><br><span class=\"line\">    #var.paths:</span><br><span class=\"line\"></span><br><span class=\"line\">    # Input configuration (advanced). Any input configuration option</span><br><span class=\"line\">    # can be added under this section.</span><br><span class=\"line\">    #input:</span><br></pre></td></tr></table></figure>\n\n<p>Filebeat会根据您的环境自动调整这些配置，并将它们加载到相应的Elastic stack组件中</p>\n<p>配置文件的方式：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">filebeat.config:</span><br><span class=\"line\">  modules:</span><br><span class=\"line\">    # 通过这里开启， 默认是关闭</span><br><span class=\"line\">    enabled: true</span><br><span class=\"line\">    path: modules.d&#x2F;*.yml</span><br><span class=\"line\">    reload.enabled: true</span><br><span class=\"line\">    reload.period: 10s</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n<h3 id=\"3、Filebeat-inputs\"><a href=\"#3、Filebeat-inputs\" class=\"headerlink\" title=\"3、Filebeat inputs\"></a>3、Filebeat inputs</h3><p>如果你想手动配置Filebeat（而不是使用模块），可以在配置文件filebeat.inputs部分设置Filebeat采集源以及相关参数配置。每个输入源都以破折号（-）开头。用户可以指定多个输入源，并且可以多次指定同一输入类型。例如：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">filebeat.inputs:</span><br><span class=\"line\">- type: log</span><br><span class=\"line\">  paths:</span><br><span class=\"line\">    - &#x2F;var&#x2F;log&#x2F;system.log</span><br><span class=\"line\">    - &#x2F;var&#x2F;log&#x2F;wifi.log</span><br><span class=\"line\">- type: log</span><br><span class=\"line\">  paths:</span><br><span class=\"line\">    - &quot;&#x2F;var&#x2F;log&#x2F;apache2&#x2F;*&quot;</span><br><span class=\"line\">  fields:</span><br><span class=\"line\">    apache: true</span><br><span class=\"line\">  fields_under_root: true</span><br><span class=\"line\">- type: tcp</span><br><span class=\"line\">  max_message_size: 10MiB</span><br><span class=\"line\">  host: &quot;localhost:9000&quot;</span><br></pre></td></tr></table></figure>\n<p>点击查看更多input 配置</p>\n<h3 id=\"4、Filebeat-autodiscover\"><a href=\"#4、Filebeat-autodiscover\" class=\"headerlink\" title=\"4、Filebeat autodiscover\"></a>4、Filebeat autodiscover</h3><p>在容器上运行应用程序时，它们会成为监视系统的移动目标。“自动发现”允许您跟踪它们并在更改发生时调整设置。通过定义配置模板，自动发现子系统可以在服务开始运行时监视它们。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">filebeat.autodiscover:</span><br><span class=\"line\">  List of enabled autodiscover providers</span><br><span class=\"line\"> providers:</span><br><span class=\"line\">   - type: docker</span><br><span class=\"line\">     templates:</span><br><span class=\"line\">       - condition:</span><br><span class=\"line\">           equals.docker.container.image: busybox</span><br><span class=\"line\">         config:</span><br><span class=\"line\">           - type: container</span><br><span class=\"line\">             paths:</span><br><span class=\"line\">               - &#x2F;var&#x2F;lib&#x2F;docker&#x2F;containers&#x2F;$&#123;data.docker.container.id&#125;&#x2F;*.log</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"5、Filebeat-global-options\"><a href=\"#5、Filebeat-global-options\" class=\"headerlink\" title=\"5、Filebeat global options\"></a>5、Filebeat global options</h3><p>定义publisher行为或者某些文件的位置信息，这些参数是filebeat根节点参数。比如register文件路径、或者是否启用modules、多个inputs等等</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># Registry data path. If a relative path is used, it is considered relative to the</span><br><span class=\"line\"># data path.</span><br><span class=\"line\">#filebeat.registry.path: $&#123;path.data&#125;&#x2F;registry</span><br><span class=\"line\"></span><br><span class=\"line\"># The permissions mask to apply on registry data, and meta files. The default</span><br><span class=\"line\"># value is 0600.  Must be a valid Unix-style file permissions mask expressed in</span><br><span class=\"line\"># octal notation.  This option is not supported on Windows.</span><br><span class=\"line\">#filebeat.registry.file_permissions: 0600</span><br><span class=\"line\"></span><br><span class=\"line\"># The timeout value that controls when registry entries are written to disk</span><br><span class=\"line\"># (flushed). When an unwritten update exceeds this value, it triggers a write</span><br><span class=\"line\"># to disk. When flush is set to 0s, the registry is written to disk after each</span><br><span class=\"line\"># batch of events has been published successfully. The default value is 0s.</span><br><span class=\"line\">#filebeat.registry.flush: 0s</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># Starting with Filebeat 7.0, the registry uses a new directory format to store</span><br><span class=\"line\"># Filebeat state. After you upgrade, Filebeat will automatically migrate a 6.x</span><br><span class=\"line\"># registry file to use the new directory format. If you changed</span><br><span class=\"line\"># filebeat.registry.path while upgrading, set filebeat.registry.migrate_file to</span><br><span class=\"line\"># point to the old registry file.</span><br><span class=\"line\">#filebeat.registry.migrate_file: $&#123;path.data&#125;&#x2F;registry</span><br><span class=\"line\"></span><br><span class=\"line\"># By default Ingest pipelines are not updated if a pipeline with the same ID</span><br><span class=\"line\"># already exists. If this option is enabled Filebeat overwrites pipelines</span><br><span class=\"line\"># everytime a new Elasticsearch connection is established.</span><br><span class=\"line\">#filebeat.overwrite_pipelines: false</span><br><span class=\"line\"></span><br><span class=\"line\"># How long filebeat waits on shutdown for the publisher to finish.</span><br><span class=\"line\"># Default is 0, not waiting.</span><br><span class=\"line\">#filebeat.shutdown_timeout: 0</span><br><span class=\"line\"></span><br><span class=\"line\"># Enable filebeat config reloading</span><br><span class=\"line\">#filebeat.config:</span><br><span class=\"line\">  #inputs:</span><br><span class=\"line\">    #enabled: false</span><br><span class=\"line\">    #path: inputs.d&#x2F;*.yml</span><br><span class=\"line\">    #reload.enabled: true</span><br><span class=\"line\">    #reload.period: 10s</span><br><span class=\"line\">  #modules:</span><br><span class=\"line\">    #enabled: false</span><br><span class=\"line\">    #path: modules.d&#x2F;*.yml</span><br><span class=\"line\">    #reload.enabled: true</span><br><span class=\"line\">    #reload.period: 10s</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"相关参数说明\"><a href=\"#相关参数说明\" class=\"headerlink\" title=\"相关参数说明\"></a>相关参数说明</h4><p>registry文件夹里记录了filebeat当前采集文件的元信息（包含文件名、读取的offset、文件id等等）</p>\n<p>1、filebeat.registry.path<br>如果不设置，默认路径是${path.data}/registry ，一般不设置 。</p>\n<p>2、filebeat.registry.file_permissions<br>registry文件操作权限码，默认是0600 ，如果没有特殊需求 使用默认值即可。注意：在windows上不支持此参数。</p>\n<p>3、filebeat.registry.flush<br>默认值为0. 表示 当filebeat成功发送了采集的数据，立即刷新registry 。 用户可以合理设置刷新间隔， 减轻IO压力。</p>\n<p>4、filebeat.registry.migrate_file<br>迁移文件路径： 从7.0后，registry存储方式和6.x的不一样。 如果你以前使用的是6.x版本的filebeat，然后想更新到7.x ，并且想沿用以前的registry信息，那么你可以使用这个参数：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">filebeat.registry.path: $&#123;path.data&#125;&#x2F;registry</span><br><span class=\"line\">filebeat.registry.migrate_file: &#x2F;path&#x2F;to&#x2F;old&#x2F;registry_file</span><br></pre></td></tr></table></figure>\n<p>5、filebeat.shutdown_timeout<br>Filebeat在关闭之前等待发布者完成发送事件的时间，然后Filebeat关闭。不建议设置该参数，因为确定shutdown_timeout的正确值很大程度上取决于Filebeat运行的环境以及输出的当前状态。</p>\n<p>6、filebeat.config<br>可选配置 是否启动modules</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">filebeat.config:</span><br><span class=\"line\">  #modules:</span><br><span class=\"line\">    #enabled: false</span><br><span class=\"line\">    #path: modules.d&#x2F;*.yml</span><br><span class=\"line\">    #reload.enabled: true</span><br><span class=\"line\">    #reload.period: 10s</span><br></pre></td></tr></table></figure>\n<p>如果你想在一个配置文件filebeat.yml里想采集复杂的多个log文件或者复杂输入源，你可以开启下面的配置（），然后自定义多个输入源文件即可。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">filebeat.config:</span><br><span class=\"line\">  inputs:</span><br><span class=\"line\">    enabled: true</span><br><span class=\"line\">    path: inputs.d&#x2F;*.yml</span><br><span class=\"line\">    reload.enabled: true</span><br><span class=\"line\">    reload.period: 10s</span><br></pre></td></tr></table></figure>\n\n\n<h3 id=\"6、General\"><a href=\"#6、General\" class=\"headerlink\" title=\"6、General\"></a>6、General</h3><p>所有Elastic Beats都支持这些选项。因为它们是通用选项，所以它们没有命名空间</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; General &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class=\"line\"></span><br><span class=\"line\"># The name of the shipper that publishes the network data. It can be used to group</span><br><span class=\"line\"># all the transactions sent by a single shipper in the web interface.</span><br><span class=\"line\"># If this options is not defined, the hostname is used.</span><br><span class=\"line\">#name:</span><br><span class=\"line\"></span><br><span class=\"line\"># The tags of the shipper are included in their own field with each</span><br><span class=\"line\"># transaction published. Tags make it easy to group servers by different</span><br><span class=\"line\"># logical properties.</span><br><span class=\"line\">#tags: [&quot;service-X&quot;, &quot;web-tier&quot;]</span><br><span class=\"line\"></span><br><span class=\"line\"># Optional fields that you can specify to add additional information to the</span><br><span class=\"line\"># output. Fields can be scalar values, arrays, dictionaries, or any nested</span><br><span class=\"line\"># combination of these.</span><br><span class=\"line\">#fields:</span><br><span class=\"line\">#  env: staging</span><br><span class=\"line\"></span><br><span class=\"line\"># If this option is set to true, the custom fields are stored as top-level</span><br><span class=\"line\"># fields in the output document instead of being grouped under a fields</span><br><span class=\"line\"># sub-dictionary. Default is false.</span><br><span class=\"line\">#fields_under_root: false</span><br><span class=\"line\"></span><br><span class=\"line\"># Internal queue configuration for buffering events to be published.</span><br><span class=\"line\">#queue:</span><br><span class=\"line\">  # Queue type by name (default &#39;mem&#39;)</span><br><span class=\"line\">  # The memory queue will present all available events (up to the outputs</span><br><span class=\"line\">  # bulk_max_size) to the output, the moment the output is ready to server</span><br><span class=\"line\">  # another batch of events.</span><br><span class=\"line\">  #mem:</span><br><span class=\"line\">    # Max number of events the queue can buffer.</span><br><span class=\"line\">    #events: 4096</span><br><span class=\"line\"></span><br><span class=\"line\">    # Hints the minimum number of events stored in the queue,</span><br><span class=\"line\">    # before providing a batch of events to the outputs.</span><br><span class=\"line\">    # The default value is set to 2048.</span><br><span class=\"line\">    # A value of 0 ensures events are immediately available</span><br><span class=\"line\">    # to be sent to the outputs.</span><br><span class=\"line\">    #flush.min_events: 2048</span><br><span class=\"line\"></span><br><span class=\"line\">    # Maximum duration after which events are available to the outputs,</span><br><span class=\"line\">    # if the number of events stored in the queue is &lt; &#96;flush.min_events&#96;.</span><br><span class=\"line\">    #flush.timeout: 1s</span><br><span class=\"line\"></span><br><span class=\"line\">  # The spool queue will store events in a local spool file, before</span><br><span class=\"line\">  # forwarding the events to the outputs.</span><br><span class=\"line\">  #</span><br><span class=\"line\">  # Beta: spooling to disk is currently a beta feature. Use with care.</span><br><span class=\"line\">  #</span><br><span class=\"line\">  # The spool file is a circular buffer, which blocks once the file&#x2F;buffer is full.</span><br><span class=\"line\">  # Events are put into a write buffer and flushed once the write buffer</span><br><span class=\"line\">  # is full or the flush_timeout is triggered.</span><br><span class=\"line\">  # Once ACKed by the output, events are removed immediately from the queue,</span><br><span class=\"line\">  # making space for new events to be persisted.</span><br><span class=\"line\">  #spool:</span><br><span class=\"line\">    # The file namespace configures the file path and the file creation settings.</span><br><span class=\"line\">    # Once the file exists, the &#96;size&#96;, &#96;page_size&#96; and &#96;prealloc&#96; settings</span><br><span class=\"line\">    # will have no more effect.</span><br><span class=\"line\">    #file:</span><br><span class=\"line\">      # Location of spool file. The default value is $&#123;path.data&#125;&#x2F;spool.dat.</span><br><span class=\"line\">      #path: &quot;$&#123;path.data&#125;&#x2F;spool.dat&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">      # Configure file permissions if file is created. The default value is 0600.</span><br><span class=\"line\">      #permissions: 0600</span><br><span class=\"line\"></span><br><span class=\"line\">      # File size hint. The spool blocks, once this limit is reached. The default value is 100 MiB.</span><br><span class=\"line\">      #size: 100MiB</span><br><span class=\"line\"></span><br><span class=\"line\">      # The files page size. A file is split into multiple pages of the same size. The default value is 4KiB.</span><br><span class=\"line\">      #page_size: 4KiB</span><br><span class=\"line\"></span><br><span class=\"line\">      # If prealloc is set, the required space for the file is reserved using</span><br><span class=\"line\">      # truncate. The default value is true.</span><br><span class=\"line\">      #prealloc: true</span><br><span class=\"line\"></span><br><span class=\"line\">    # Spool writer settings</span><br><span class=\"line\">    # Events are serialized into a write buffer. The write buffer is flushed if:</span><br><span class=\"line\">    # - The buffer limit has been reached.</span><br><span class=\"line\">    # - The configured limit of buffered events is reached.</span><br><span class=\"line\">    # - The flush timeout is triggered.</span><br><span class=\"line\">    #write:</span><br><span class=\"line\">      # Sets the write buffer size.</span><br><span class=\"line\">      #buffer_size: 1MiB</span><br><span class=\"line\"></span><br><span class=\"line\">      # Maximum duration after which events are flushed if the write buffer</span><br><span class=\"line\">      # is not full yet. The default value is 1s.</span><br><span class=\"line\">      #flush.timeout: 1s</span><br><span class=\"line\"></span><br><span class=\"line\">      # Number of maximum buffered events. The write buffer is flushed once the</span><br><span class=\"line\">      # limit is reached.</span><br><span class=\"line\">      #flush.events: 16384</span><br><span class=\"line\"></span><br><span class=\"line\">      # Configure the on-disk event encoding. The encoding can be changed</span><br><span class=\"line\">      # between restarts.</span><br><span class=\"line\">      # Valid encodings are: json, ubjson, and cbor.</span><br><span class=\"line\">      #codec: cbor</span><br><span class=\"line\">    #read:</span><br><span class=\"line\">      # Reader flush timeout, waiting for more events to become available, so</span><br><span class=\"line\">      # to fill a complete batch as required by the outputs.</span><br><span class=\"line\">      # If flush_timeout is 0, all available events are forwarded to the</span><br><span class=\"line\">      # outputs immediately.</span><br><span class=\"line\">      # The default value is 0s.</span><br><span class=\"line\">      #flush.timeout: 0s</span><br><span class=\"line\"></span><br><span class=\"line\"># Sets the maximum number of CPUs that can be executing simultaneously. The</span><br><span class=\"line\"># default is the number of logical CPUs available in the system.</span><br><span class=\"line\">#max_procs:</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"参数说明\"><a href=\"#参数说明\" class=\"headerlink\" title=\"参数说明\"></a>参数说明</h4><p>1、name<br>默认是用服务器的主机名。该名称以agent.name字段而存在。</p>\n<p>2、tag<br>为采集的日志消息定义tag信息标识，用于接收端处理响应的逻辑。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tags: [&quot;web-service&quot;,&quot;info-file&quot;]</span><br></pre></td></tr></table></figure>\n<p>3、fields<br>定义额外的字段信息，定义的字段以KV形式出现。默认是在fields下。</p>\n<p>fields: {project: “credit”, env: “prod”}<br>1<br>如果设置了fields_under_root为true，那么自定义的KV 将作为根字段出现在发送的消息里。</p>\n<p>4、fields_under_root<br>自定义的字段是否作为根字段。 使用实例</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">fields_under_root: true</span><br><span class=\"line\">fields: &#123;project: &quot;credit&quot;, env: &quot;prod&quot;&#125;</span><br></pre></td></tr></table></figure>\n<p>5、processors<br>beat提供的数据预处理 功能，如果定义了多个processors ，那么beat将会顺序执行。 更多定义的processor</p>\n<p>6、max_procs<br>设置可以同时执行的最大CPU数。默认值为系统中可用的逻辑CPU的数量。</p>\n<h3 id=\"7、-Processors\"><a href=\"#7、-Processors\" class=\"headerlink\" title=\"7、 Processors\"></a>7、 Processors</h3><p>beat提供的数据预处理 功能，用于增强数据或者过滤数据。如果定义了多个processors ，那么beat将会顺序执行</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">event -&gt; processor 1 -&gt; event1 -&gt; processor 2 -&gt; event2 ...</span><br></pre></td></tr></table></figure>\n\n\n<p>1、add_cloud_metadata<br>添加云服务器实例元数据</p>\n<p>增加云服务器提供商的实例元数据来丰富每个事件。在启动时，它将查询托管提供程序的列表并缓存实例元数据。</p>\n<p>例如添加上这个配置</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">processors:</span><br><span class=\"line\">  - add_cloud_metadata: ~</span><br></pre></td></tr></table></figure>\n<p>在阿里云上输出为</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  &quot;cloud&quot;: &#123;</span><br><span class=\"line\">    &quot;availability_zone&quot;: &quot;cn-shenzhen&quot;,</span><br><span class=\"line\">    &quot;instance.id&quot;: &quot;i-wz9g2hqiikg0aliyun2b&quot;,</span><br><span class=\"line\">    &quot;provider&quot;: &quot;ecs&quot;,</span><br><span class=\"line\">    &quot;region&quot;: &quot;cn-shenzhen-a&quot;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>在腾讯云上输出为</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  &quot;cloud&quot;: &#123;</span><br><span class=\"line\">    &quot;availability_zone&quot;: &quot;gz-azone2&quot;,</span><br><span class=\"line\">    &quot;instance.id&quot;: &quot;ins-qcloudv5&quot;,</span><br><span class=\"line\">    &quot;provider&quot;: &quot;qcloud&quot;,</span><br><span class=\"line\">    &quot;region&quot;: &quot;china-south-gz&quot;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>在aws上输出为</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  &quot;cloud&quot;: &#123;</span><br><span class=\"line\">    &quot;account.id&quot;: &quot;123456789012&quot;,</span><br><span class=\"line\">    &quot;availability_zone&quot;: &quot;us-east-1c&quot;,</span><br><span class=\"line\">    &quot;instance.id&quot;: &quot;i-4e123456&quot;,</span><br><span class=\"line\">    &quot;machine.type&quot;: &quot;t2.medium&quot;,</span><br><span class=\"line\">    &quot;image.id&quot;: &quot;ami-abcd1234&quot;,</span><br><span class=\"line\">    &quot;provider&quot;: &quot;aws&quot;,</span><br><span class=\"line\">    &quot;region&quot;: &quot;us-east-1&quot;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>2、add_cloudfoundry_metadata<br>自动添加cloudfoundry应用程序的相关元数据</p>\n<p>该处理器使用来自cloudfoundry应用程序的相关元数据对每个事件进行增强。</p>\n<p>前提条件：只有当事件包含对CloudFoundry应用程序的引用（使用字段cloudfoundry.app.id)，并且配置了cloudfoundry客户端信息，才能能够检索应用程序的信息。</p>\n<p>配置示例：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">processors:</span><br><span class=\"line\">  - add_cloudfoundry_metadata:</span><br><span class=\"line\">      api_address: https:&#x2F;&#x2F;api.dev.cfdev.sh</span><br><span class=\"line\">      client_id: uaa-filebeat</span><br><span class=\"line\">      client_secret: verysecret</span><br><span class=\"line\">      ssl:</span><br><span class=\"line\">        verification_mode: none</span><br><span class=\"line\">      # To connect to Cloud Foundry over verified TLS you can specify a client and CA certificate.</span><br><span class=\"line\">      #ssl:</span><br><span class=\"line\">      #  certificate_authorities: [&quot;&#x2F;etc&#x2F;pki&#x2F;cf&#x2F;ca.pem&quot;]</span><br><span class=\"line\">      #  certificate:              &quot;&#x2F;etc&#x2F;pki&#x2F;cf&#x2F;cert.pem&quot;</span><br><span class=\"line\">      #  key:                      &quot;&#x2F;etc&#x2F;pki&#x2F;cf&#x2F;cert.key&quot;</span><br></pre></td></tr></table></figure>\n\n\n<p>3、add_docker_metadata<br>自动添加docker容器相关元数据</p>\n<p>filebeat在启动时，它检测一个docker环境元数据并缓存。只有在检测到有效配置并且处理器能够访问Docker API时，才会使用Docker元数据对事件数据进行追加。 目前在k8s场景下 一般使用log-pilot来协助采集日志。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">processors:</span><br><span class=\"line\">  - add_docker_metadata:</span><br><span class=\"line\">      host: &quot;unix:&#x2F;&#x2F;&#x2F;var&#x2F;run&#x2F;docker.sock&quot;</span><br><span class=\"line\">      #match_fields: [&quot;system.process.cgroup.id&quot;]</span><br><span class=\"line\">      #match_pids: [&quot;process.pid&quot;, &quot;process.ppid&quot;]</span><br><span class=\"line\">      #match_source: true</span><br><span class=\"line\">      #match_source_index: 4</span><br><span class=\"line\">      #match_short_id: true</span><br><span class=\"line\">      #cleanup_timeout: 60</span><br><span class=\"line\">      #labels.dedot: false</span><br><span class=\"line\">      # To connect to Docker over TLS you must specify a client and CA certificate.</span><br><span class=\"line\">      #ssl:</span><br><span class=\"line\">      #  certificate_authority: &quot;&#x2F;etc&#x2F;pki&#x2F;root&#x2F;ca.pem&quot;</span><br><span class=\"line\">      #  certificate:           &quot;&#x2F;etc&#x2F;pki&#x2F;client&#x2F;cert.pem&quot;</span><br><span class=\"line\">      #  key:                   &quot;&#x2F;etc&#x2F;pki&#x2F;client&#x2F;cert.key&quot;</span><br></pre></td></tr></table></figure>\n\n<p>4、add_fields</p>\n<p>添加自定义字段信息</p>\n<p>添加字段信息（同这里用法类似），配置如下</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">processors:</span><br><span class=\"line\">  - add_fields:</span><br><span class=\"line\">      #  如果不指定，默认添加到 fields 里 </span><br><span class=\"line\">      target: project</span><br><span class=\"line\">      fields:</span><br><span class=\"line\">        name: myproject</span><br><span class=\"line\">        id: &#39;574734885120952459&#39;</span><br></pre></td></tr></table></figure>\n<p>输出为：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  &quot;project&quot;: &#123;</span><br><span class=\"line\">    &quot;name&quot;: &quot;myproject&quot;,</span><br><span class=\"line\">    &quot;id&quot;: &quot;574734885120952459&quot;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>5、add_host_metadata</p>\n<p>自动追加host相关信息，配置如下</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">processors:</span><br><span class=\"line\">  - add_host_metadata:</span><br><span class=\"line\">      cache.ttl: 5m</span><br><span class=\"line\">      geo:</span><br><span class=\"line\">        name: nyc-dc1-rack1</span><br><span class=\"line\">        location: 40.7128, -74.0060</span><br><span class=\"line\">        continent_name: North America</span><br><span class=\"line\">        country_iso_code: US</span><br><span class=\"line\">        region_name: New York</span><br><span class=\"line\">        region_iso_code: NY</span><br><span class=\"line\">        city_name: New York</span><br></pre></td></tr></table></figure>\n<p>结果为</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">   &quot;host&quot;:&#123;</span><br><span class=\"line\">      &quot;architecture&quot;:&quot;x86_64&quot;,</span><br><span class=\"line\">      &quot;name&quot;:&quot;example-host&quot;,</span><br><span class=\"line\">      &quot;id&quot;:&quot;&quot;,</span><br><span class=\"line\">      &quot;os&quot;:&#123;</span><br><span class=\"line\">         &quot;family&quot;:&quot;darwin&quot;,</span><br><span class=\"line\">         &quot;build&quot;:&quot;16G1212&quot;,</span><br><span class=\"line\">         &quot;platform&quot;:&quot;darwin&quot;,</span><br><span class=\"line\">         &quot;version&quot;:&quot;10.12.6&quot;,</span><br><span class=\"line\">         &quot;kernel&quot;:&quot;16.7.0&quot;,</span><br><span class=\"line\">         &quot;name&quot;:&quot;Mac OS X&quot;</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      &quot;ip&quot;: [&quot;192.168.0.1&quot;, &quot;10.0.0.1&quot;],</span><br><span class=\"line\">      &quot;mac&quot;: [&quot;00:25:96:12:34:56&quot;, &quot;72:00:06:ff:79:f1&quot;],</span><br><span class=\"line\">      &quot;geo&quot;: &#123;</span><br><span class=\"line\">          &quot;continent_name&quot;: &quot;North America&quot;,</span><br><span class=\"line\">          &quot;country_iso_code&quot;: &quot;US&quot;,</span><br><span class=\"line\">          &quot;region_name&quot;: &quot;New York&quot;,</span><br><span class=\"line\">          &quot;region_iso_code&quot;: &quot;NY&quot;,</span><br><span class=\"line\">          &quot;city_name&quot;: &quot;New York&quot;,</span><br><span class=\"line\">          &quot;name&quot;: &quot;nyc-dc1-rack1&quot;,</span><br><span class=\"line\">          &quot;location&quot;: &quot;40.7128, -74.0060&quot;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n<p>6、add_id</p>\n<p>根据envet生成唯一的ID</p>\n<p>自动追加 根据envet生成唯一的ID</p>\n<p>配置如下：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">processors:</span><br><span class=\"line\">  - add_id: ~</span><br></pre></td></tr></table></figure>\n<p>输出为：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&quot;@metadata&quot;: &#123;                                                                                                                     </span><br><span class=\"line\">    &quot;beat&quot;: &quot;filebeat&quot;,                                                                                                              </span><br><span class=\"line\">    &quot;type&quot;: &quot;_doc&quot;,                                                                                                                  </span><br><span class=\"line\">    &quot;version&quot;: &quot;7.7.0&quot;,                                                                                                              </span><br><span class=\"line\">    &quot;_id&quot;: &quot;jfXPVHQB95_6f7tCZ5hg&quot;                                                                                                    </span><br><span class=\"line\">&#125;,</span><br></pre></td></tr></table></figure>\n\n<p>7、add_kubernetes_metadata<br>该处理器使用相关元数据对每个事件进行注释，基于kubernetes pod生成事件的元数据。在启动时，它会检测到集群内的环境并缓存Kubernetes相关的元数据。只有在检测到有效配置时才会对事件进行注释。如果它不能检测到有效的Kubernetes配置，那么事件不会用Kubernetes相关的元数据进行注释。<br>添加的注释有Pod Name 、Pod UID、Namespace、Labels</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">processors:</span><br><span class=\"line\">  - add_kubernetes_metadata: ~</span><br></pre></td></tr></table></figure>\n\n<p>8、add_labels</p>\n<p>添加自定义标签，类似add_fileds功能 ，添加的kv输出后默认在labels字段下</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">processors:</span><br><span class=\"line\">  - add_labels:</span><br><span class=\"line\">      labels:</span><br><span class=\"line\">        number: 1</span><br><span class=\"line\">        with.dots: test</span><br><span class=\"line\">        nested:</span><br><span class=\"line\">          with.dots: nested</span><br><span class=\"line\">        array:</span><br><span class=\"line\">          - do</span><br><span class=\"line\">          - re</span><br><span class=\"line\">          - with.field: mi</span><br></pre></td></tr></table></figure>\n<p>输出：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  &quot;labels&quot;: &#123;</span><br><span class=\"line\">    &quot;number&quot;: 1,</span><br><span class=\"line\">    &quot;with.dots&quot;: &quot;test&quot;,</span><br><span class=\"line\">    &quot;nested.with.dots&quot;: &quot;nested&quot;,</span><br><span class=\"line\">    &quot;array.0&quot;: &quot;do&quot;,</span><br><span class=\"line\">    &quot;array.1&quot;: &quot;re&quot;,</span><br><span class=\"line\">    &quot;array.2.with.field&quot;: &quot;mi&quot;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>9、add_locale<br>自动添加时区信息，常用语国际业务中。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">processors:</span><br><span class=\"line\">  - add_locale: ~</span><br></pre></td></tr></table></figure>\n<p>下面的意思是 使用缩写模式 ， 例如国内输出结果为CST</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">processors:</span><br><span class=\"line\">  - add_locale:</span><br><span class=\"line\">      format: abbreviation</span><br></pre></td></tr></table></figure>\n<p>10、add_observer_metadata<br>自动添加观察者机器的相关元数据</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">processors:</span><br><span class=\"line\">  - add_observer_metadata:</span><br><span class=\"line\">      cache.ttl: 5m</span><br></pre></td></tr></table></figure>\n<p>输出为：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  &quot;observer&quot; : &#123;</span><br><span class=\"line\">    &quot;hostname&quot; : &quot;avce&quot;,</span><br><span class=\"line\">    &quot;type&quot; : &quot;heartbeat&quot;,</span><br><span class=\"line\">    &quot;vendor&quot; : &quot;elastic&quot;,</span><br><span class=\"line\">    &quot;ip&quot; : [</span><br><span class=\"line\">      &quot;192.168.1.251&quot;,</span><br><span class=\"line\">      &quot;fe80::64b2:c3ff:fe5b:b974&quot;,</span><br><span class=\"line\">    ],</span><br><span class=\"line\">    &quot;mac&quot; : [</span><br><span class=\"line\">      &quot;dc:c1:02:6f:1b:ed&quot;,</span><br><span class=\"line\">    ]</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>11、add_tags<br>添加标签，并可指定标签在哪个字段下。</p>\n<p>例如：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">processors:</span><br><span class=\"line\">  - add_tags:</span><br><span class=\"line\">      tags: [web, production]</span><br><span class=\"line\">      target: &quot;environment&quot;</span><br></pre></td></tr></table></figure>\n<p>输出为：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  &quot;environment&quot;: [&quot;web&quot;, &quot;production&quot;]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>12、convert<br>将event中的某个字段转换为其他类型，例如将字符串转换为整数。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">processors:</span><br><span class=\"line\">  - convert:</span><br><span class=\"line\">      fields:</span><br><span class=\"line\">        - &#123;from: &quot;src_ip&quot;, to: &quot;source.ip&quot;, type: &quot;ip&quot;&#125;</span><br><span class=\"line\">        - &#123;from: &quot;src_port&quot;, to: &quot;source.port&quot;, type: &quot;integer&quot;&#125;</span><br><span class=\"line\">      ignore_missing: true</span><br><span class=\"line\">      fail_on_error: false</span><br></pre></td></tr></table></figure>\n<p>13、copy_fields<br>将event中的某个字段的值赋值给另一个字段</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">processors:</span><br><span class=\"line\">  - copy_fields:</span><br><span class=\"line\">      fields:</span><br><span class=\"line\">        - from: message</span><br><span class=\"line\">          to: event.original</span><br><span class=\"line\">      fail_on_error: false</span><br><span class=\"line\">      ignore_missing: true</span><br></pre></td></tr></table></figure>\n<p>输出：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  &quot;message&quot;: &quot;my-interesting-message&quot;,</span><br><span class=\"line\">  &quot;event&quot;: &#123;</span><br><span class=\"line\">      &quot;original&quot;: &quot;my-interesting-message&quot;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>14、decode_base64_field<br>base64解码，从一个字段里获取值，解码后赋值给另一个字段。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">processors:</span><br><span class=\"line\">  - decode_base64_field:</span><br><span class=\"line\">      field:</span><br><span class=\"line\">        from: &quot;message&quot;</span><br><span class=\"line\">        to: &quot;decode&quot;</span><br><span class=\"line\">      ignore_missing: true</span><br><span class=\"line\">      fail_on_error: false</span><br></pre></td></tr></table></figure>\n<p>15、decode_cef<br>如果你的日式符合Common Event Format (CEF) 标准，你可以使用它进行解码：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">processors:</span><br><span class=\"line\">  - rename:</span><br><span class=\"line\">      fields:</span><br><span class=\"line\">        - &#123;from: &quot;message&quot;, to: &quot;event.original&quot;&#125;</span><br><span class=\"line\">  - decode_cef:</span><br><span class=\"line\">      field: event.original</span><br></pre></td></tr></table></figure>\n<p>更多关于cef的介绍</p>\n<p>16、decode_csv_fields<br>解析CSF格式的日志到指定字段，内容为数组。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">processors:</span><br><span class=\"line\">  - decode_csv_fields:</span><br><span class=\"line\">     # 解析到哪里</span><br><span class=\"line\">      fields:</span><br><span class=\"line\">        message: decoded.csv</span><br><span class=\"line\">      separator: &quot;,&quot;</span><br><span class=\"line\">      ignore_missing: false</span><br><span class=\"line\">      overwrite_keys: true</span><br><span class=\"line\">      trim_leading_space: false</span><br><span class=\"line\">      fail_on_error: true</span><br></pre></td></tr></table></figure>\n<p>17、decode_json_fields<br>处理对包含JSON字符串的字段进行解码，并将字符串替换为有效的JSON对象。默认是在当前字段替换。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">processors:</span><br><span class=\"line\">  - decode_json_fields:</span><br><span class=\"line\">      fields: [&quot;field1&quot;, &quot;field2&quot;, ...]</span><br><span class=\"line\">     # process_array: false</span><br><span class=\"line\">      # max_depth: 1</span><br><span class=\"line\">     # overwrite_keys: false</span><br><span class=\"line\">     # add_error_key: true</span><br></pre></td></tr></table></figure>\n<p>18、decompress_gzip_field<br>gzip解压缩，从一个字段值中加压缩到另一个字段中 。 使用场景少。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">processors:</span><br><span class=\"line\">  - decompress_gzip_field:</span><br><span class=\"line\">      field:</span><br><span class=\"line\">        from: &quot;field1&quot;</span><br><span class=\"line\">        to: &quot;field2&quot;</span><br><span class=\"line\">      ignore_missing: false</span><br><span class=\"line\">      fail_on_error: true</span><br></pre></td></tr></table></figure>\n<p>感兴趣的可以看下 gzip压缩初探</p>\n<p>19、dissect<br>从某个字段里（默认message）取值，按照tokenizer定义的格式 拆分（切割）数据，并输出到target_prefix 字段里，默认是dissect</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">processors:</span><br><span class=\"line\">  - dissect:</span><br><span class=\"line\">      tokenizer: &quot;%&#123;key1&#125; %&#123;key2&#125;&quot;</span><br><span class=\"line\">      # field: &quot;message&quot;</span><br><span class=\"line\">     # target_prefix: &quot;dissect&quot;</span><br></pre></td></tr></table></figure>\n<p>如果是这样的log”App01 - WebServer is up and running” ，输出为</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&quot;service&quot;: &#123;</span><br><span class=\"line\">  &quot;name&quot;: &quot;App01&quot;,</span><br><span class=\"line\">  &quot;status&quot;: &quot;WebServer is up and running&quot;</span><br><span class=\"line\">&#125;,</span><br></pre></td></tr></table></figure>\n<p>20、dns<br>反向解析 根据id查找hostname 。每个processor有自己查询结果的缓存。该processor使用自己的域名服务器，不会查找/etc/hosts ，默认使用/etc/resolv.conf里面的域名服务器。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">processors:</span><br><span class=\"line\">  - dns:</span><br><span class=\"line\">      type: reverse</span><br><span class=\"line\">      fields:</span><br><span class=\"line\">        source.ip: source.hostname</span><br><span class=\"line\">        destination.ip: destination.hostname</span><br></pre></td></tr></table></figure>\n<p>fields字段里source.ip是指ip所在的字段，source.hostname是指新值存入的字段。</p>\n<p>21、drop_event<br>丢弃该event，一般要设置特定条件 。</p>\n<p>例如 http响应码为200 就不上报event：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">processors:</span><br><span class=\"line\">  - drop_event:</span><br><span class=\"line\">      when:</span><br><span class=\"line\">        equals:</span><br><span class=\"line\">          http.code: 200</span><br></pre></td></tr></table></figure>\n\n<p>22、drop_fields<br>丢弃（过滤掉）特定字段， 一般防止敏感信息上报，例如ip 、mac地址…</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">processors:</span><br><span class=\"line\">  - drop_fields:</span><br><span class=\"line\">      fields: [&quot;cpu.user&quot;, &quot;cpu.system&quot;]</span><br></pre></td></tr></table></figure>\n<p>23、extract_array</p>\n<p>从数组中取值并填充（映射到）指定字段</p>\n<p>配置示例：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- add_tags:</span><br><span class=\"line\">    tags: [&quot;127.0.0.1&quot;, &quot;114.114.114.114&quot;,&quot;8080&quot;]</span><br><span class=\"line\">    target: &quot;my_array&quot;</span><br><span class=\"line\">- extract_array:</span><br><span class=\"line\">    field: my_array</span><br><span class=\"line\">    mappings:</span><br><span class=\"line\">      source.ip: 0</span><br><span class=\"line\">      source.destination.ip: 1</span><br><span class=\"line\">      source.network.transport: 2</span><br><span class=\"line\">    fail_on_error: true</span><br><span class=\"line\">    ignore_missing: false</span><br></pre></td></tr></table></figure>\n\n\n<p>24、fingerprint</p>\n<p>根据事件指定字段字段值生成事件的指纹。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">processors:</span><br><span class=\"line\">  - fingerprint:</span><br><span class=\"line\">      fields: [&quot;field1&quot;, &quot;field2&quot;, ...]</span><br></pre></td></tr></table></figure>\n\n<p>25、include_fields</p>\n<p>输出的event里 会包含哪些字段值。@timestamp和type字段会始终出现在event中，即使未在include_fields列表中定义。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">processors:</span><br><span class=\"line\">  - include_fields:</span><br><span class=\"line\">      when:</span><br><span class=\"line\">        condition</span><br><span class=\"line\">      fields: [&quot;field1&quot;, &quot;field2&quot;, ...]</span><br></pre></td></tr></table></figure>\n<p>26、registered_domain<br>域名注册，识别一个长串域名，转化成一个简短域名 。</p>\n<p>比如我有一条日志：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">https:&#x2F;&#x2F;www.netcn.console.aliyun.com&#x2F;</span><br></pre></td></tr></table></figure>\n<p>filebeat配置：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">processors:</span><br><span class=\"line\">  - registered_domain:</span><br><span class=\"line\">      field: message</span><br><span class=\"line\">      target_field: result.registered_domain</span><br><span class=\"line\">      ignore_missing: true</span><br><span class=\"line\">      ignore_failure: true</span><br></pre></td></tr></table></figure>\n<p>输出为</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&quot;result&quot;: &#123;</span><br><span class=\"line\">  &quot;registered_domain&quot;: &quot;aliyun.com&#x2F;&quot;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>27、rename</p>\n<p>重命名字段</p>\n<p>示例： 把host重命名为hostRename</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">processors:</span><br><span class=\"line\">  - rename:</span><br><span class=\"line\">      fields:</span><br><span class=\"line\">        - from: &quot;host&quot;</span><br><span class=\"line\">          to: &quot;hostRename&quot;</span><br><span class=\"line\">      ignore_missing: false</span><br><span class=\"line\">      fail_on_error: true</span><br></pre></td></tr></table></figure>\n\n<p>28、script</p>\n<p>使用Javascript 处理event ，可以更加灵活的预处理业务</p>\n<p>29、timestamp</p>\n<p>从字段解析时间戳并将解析结果写入@timestamp（日志采集时间）字段</p>\n<p>从某个字段解析时间戳，并将解析结果写入@timestamp中，可以自定义日志采集时间。</p>\n<p>配置如下：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">processors:</span><br><span class=\"line\">   timestamp:</span><br><span class=\"line\">      field: start_time</span><br><span class=\"line\">      layouts:</span><br><span class=\"line\">        - &#39;2006-01-02T15:04:05Z&#39;</span><br><span class=\"line\">        - &#39;2006-01-02T15:04:05.999Z&#39;</span><br><span class=\"line\">      test:</span><br><span class=\"line\">        - &#39;2019-06-22T16:33:51Z&#39;</span><br><span class=\"line\">        - &#39;2019-11-18T04:59:51.123Z&#39;</span><br><span class=\"line\">   drop_fields:</span><br><span class=\"line\">      fields: [start_time]</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">layouts 是时间格式，用于格式化start_time里的时间，这个是go语言的时间格式。 类似java中的yyyy-MM-dd HH:mm:ss 。</span><br><span class=\"line\">test 是在filebeat启动时 验证layouts的格式能否格式化 测试时间。</span><br></pre></td></tr></table></figure>\n\n\n<p>30、translate_sid<br>将Windows安全标识符（SID）转换为帐户名，使用仅限Windows系统。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">processors:</span><br><span class=\"line\">  - translate_sid:</span><br><span class=\"line\">      field: winlog.event_data.MemberSid</span><br><span class=\"line\">      account_name_target: user.name</span><br><span class=\"line\">      domain_target: user.domain</span><br><span class=\"line\">      ignore_missing: true</span><br><span class=\"line\">      ignore_failure: true</span><br></pre></td></tr></table></figure>\n<p>31、translate_sid<br>按照指定大小截取字段值</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">processors:</span><br><span class=\"line\">  - truncate_fields:</span><br><span class=\"line\">    fields:</span><br><span class=\"line\">    - message</span><br><span class=\"line\">    max_characters: 5</span><br><span class=\"line\">    #max_bytes: 128</span><br><span class=\"line\">    fail_on_error: false</span><br><span class=\"line\">    ignore_missing: true</span><br></pre></td></tr></table></figure>\n<p>32、urldecode<br>url 解码</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">processors:</span><br><span class=\"line\">  - urldecode:</span><br><span class=\"line\">      fields:</span><br><span class=\"line\">        - from: &quot;field1&quot;</span><br><span class=\"line\">          to: &quot;field2&quot;</span><br><span class=\"line\">      #  - from: &quot;fieldx&quot;</span><br><span class=\"line\">       #  to: &quot;fieldy&quot;</span><br><span class=\"line\">      ignore_missing: false</span><br><span class=\"line\">      fail_on_error: true</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Outputs\"><a href=\"#Outputs\" class=\"headerlink\" title=\"Outputs\"></a>Outputs</h3><p>Elasticsearch</p>\n<p>常规配置</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">output.elasticsearch:</span><br><span class=\"line\">  hosts: [&quot;https:&#x2F;&#x2F;es.bingmaning:9200&quot;]</span><br><span class=\"line\">  username: &quot;bingmaning&quot;</span><br><span class=\"line\">  password: &quot;lingshui2008@qq.com&quot;</span><br><span class=\"line\">  index: &quot;%&#123;[fields.log_type]&#125;-%&#123;[agent.version]&#125;-%&#123;+yyyy.MM.dd&#125;&quot;</span><br></pre></td></tr></table></figure>\n<p>更多配置</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">output.elasticsearch:</span><br><span class=\"line\">  # Boolean flag to enable or disable the output module.</span><br><span class=\"line\">  #enabled: true</span><br><span class=\"line\"></span><br><span class=\"line\">  #es地址</span><br><span class=\"line\">  hosts: [&quot;https:&#x2F;&#x2F;es.bingmaning:9200&quot;]</span><br><span class=\"line\"></span><br><span class=\"line\">  # 设置压缩级别</span><br><span class=\"line\">  compression_level: 0</span><br><span class=\"line\"></span><br><span class=\"line\">  # 是否转义html符号</span><br><span class=\"line\">  escape_html: false</span><br><span class=\"line\"></span><br><span class=\"line\">  # 协议，默认http</span><br><span class=\"line\">  protocol: &quot;https&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">  # 认证方式一</span><br><span class=\"line\">  api_key: &quot;id:api_key&quot;</span><br><span class=\"line\">  # 认证方式二</span><br><span class=\"line\">  username: &quot;elastic&quot;</span><br><span class=\"line\">  password: &quot;changeme&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">  # 通过索引操作在URL中传递的HTTP参数字典</span><br><span class=\"line\">  parameters:</span><br><span class=\"line\">    #param1: value1</span><br><span class=\"line\">    #param2: value2</span><br><span class=\"line\"></span><br><span class=\"line\">  # 每个Elasticsearch主机worker数量。  </span><br><span class=\"line\">  worker: 1</span><br><span class=\"line\"></span><br><span class=\"line\">  #默认索引 filebeat-YYYY.MM.DD  。 可自定义</span><br><span class=\"line\">  index: &quot;filebeat-%&#123;[agent.version]&#125;-%&#123;+yyyy.MM.dd&#125;&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">  # 自定义 pipeline</span><br><span class=\"line\">  pipeline: &quot;&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">  # 默认http路径</span><br><span class=\"line\">  path: &quot;&#x2F;elasticsearch&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">  # 自定义http header</span><br><span class=\"line\">  headers:</span><br><span class=\"line\">    X-My-Header: Contents of the header</span><br><span class=\"line\"></span><br><span class=\"line\">  # 代理地址</span><br><span class=\"line\">  proxy_url: http:&#x2F;&#x2F;proxy:3128</span><br><span class=\"line\"></span><br><span class=\"line\">  # 是否禁用代理 默认false</span><br><span class=\"line\">  proxy_disable: false</span><br><span class=\"line\"></span><br><span class=\"line\">  # 尝试特定Elasticsearch索引操作的次数。如果多次重试后，索引操作未成功，事件被丢弃。默认为3。</span><br><span class=\"line\">  max_retries: 3</span><br><span class=\"line\"></span><br><span class=\"line\">  # 单个Elasticsearch批量API索引请求中要批量处理的最大事件数</span><br><span class=\"line\">  # The default is 50.</span><br><span class=\"line\">  bulk_max_size: 50</span><br><span class=\"line\"></span><br><span class=\"line\">  # 重连 初始等待时间，如果失败会指数值增长。</span><br><span class=\"line\">  backoff.init: 1s</span><br><span class=\"line\"></span><br><span class=\"line\">  # 最大等待重连时间。默认60秒</span><br><span class=\"line\">  backoff.max: 60s</span><br><span class=\"line\"></span><br><span class=\"line\">  # 请求超时时间</span><br><span class=\"line\">  timeout: 90</span><br><span class=\"line\"></span><br><span class=\"line\">  # 使用ssl？</span><br><span class=\"line\">  ssl.enabled: true</span><br><span class=\"line\"></span><br><span class=\"line\">  # ssl认证方式，默认为full。 测试时 可以使用 none</span><br><span class=\"line\">  ssl.verification_mode: full</span><br><span class=\"line\"></span><br><span class=\"line\">  #可用 tls 版本</span><br><span class=\"line\">  ssl.supported_protocols: [TLSv1.1, TLSv1.2, TLSv1.3]</span><br><span class=\"line\"></span><br><span class=\"line\">  # 根证书地址</span><br><span class=\"line\">  ssl.certificate_authorities: [&quot;&#x2F;etc&#x2F;pki&#x2F;root&#x2F;ca.pem&quot;]</span><br><span class=\"line\"></span><br><span class=\"line\">  # 客户端证书</span><br><span class=\"line\">  ssl.certificate: &quot;&#x2F;etc&#x2F;pki&#x2F;client&#x2F;cert.pem&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">  # 客户端密钥</span><br><span class=\"line\">  ssl.key: &quot;&#x2F;etc&#x2F;pki&#x2F;client&#x2F;cert.key&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">  # 密码短语</span><br><span class=\"line\">  ssl.key_passphrase: &#39;&#39;</span><br><span class=\"line\"></span><br><span class=\"line\">  # 配置密码套件以用于SSL连接</span><br><span class=\"line\">  ssl.cipher_suites: []</span><br><span class=\"line\"></span><br><span class=\"line\">  # 为基于ECDHE的密码套件配置曲线类型</span><br><span class=\"line\">  ssl.curve_types: []</span><br><span class=\"line\"></span><br><span class=\"line\">  # 配置支持哪些类型的重新协商。有效选项是 </span><br><span class=\"line\">  # never, once, and freely. 默认是 never.</span><br><span class=\"line\">  ssl.renegotiation: never</span><br><span class=\"line\"></span><br><span class=\"line\">  # 配置一个可用于对已验证证书链进行额外验证的pin， 这可以确保使用特定证书来验证信任链。</span><br><span class=\"line\">  # 该pin是SHA-256指纹的base64编码字符串。.</span><br><span class=\"line\">  ssl.ca_sha256: &quot;&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">  # 是否支持 Kerberos </span><br><span class=\"line\">  kerberos.enabled: true</span><br><span class=\"line\"></span><br><span class=\"line\">  # Kerberos认证类型： keytab, password.</span><br><span class=\"line\">  kerberos.auth_type: password</span><br><span class=\"line\"></span><br><span class=\"line\">  # 密钥表文件的路径。当auth_type设置为keytab时使用。</span><br><span class=\"line\">  kerberos.keytab: &#x2F;etc&#x2F;elastic.keytab</span><br><span class=\"line\"></span><br><span class=\"line\">  #  Kerberos configuration.</span><br><span class=\"line\">  kerberos.config_path: &#x2F;etc&#x2F;krb5.conf</span><br><span class=\"line\"></span><br><span class=\"line\">  # Name of the Kerberos user.</span><br><span class=\"line\">  kerberos.username: elastic</span><br><span class=\"line\"></span><br><span class=\"line\">  # Kerberos用户的密码。当auth_type设置为password时使用。</span><br><span class=\"line\">  kerberos.password: changeme</span><br><span class=\"line\"></span><br><span class=\"line\">  # Kerberos realm.</span><br><span class=\"line\">  kerberos.realm: ELASTIC</span><br></pre></td></tr></table></figure>\n\n<p>logstash</p>\n<p>常规配置<br>1、filebeat.yml中配置如下：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">output.logstash:</span><br><span class=\"line\">  hosts: [&quot;localhost:5044&quot;, &quot;localhost:5045&quot;]</span><br><span class=\"line\">  # 开这个参数 需要多个hosts</span><br><span class=\"line\">  loadbalance: true</span><br></pre></td></tr></table></figure>\n\n<p>2、logstash-pipeline.conf中配置如下：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">input &#123;</span><br><span class=\"line\">  beats &#123;</span><br><span class=\"line\">    port &#x3D;&gt; 5044</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">filter&#123;</span><br><span class=\"line\">&#x2F;&#x2F; 数据的各种处理  </span><br><span class=\"line\">....</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">output &#123;</span><br><span class=\"line\">  elasticsearch &#123;</span><br><span class=\"line\">    hosts &#x3D;&gt; [&quot;http:&#x2F;&#x2F;localhost:9200&quot;]</span><br><span class=\"line\">    #  @metadata 解释如下</span><br><span class=\"line\">    index &#x3D;&gt; &quot;%&#123;[@metadata][beat]&#125;-%&#123;[@metadata][version]&#125;-%&#123;+YYYY.MM.dd&#125;&quot; </span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>filebeat详细配置</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">output.logstash:</span><br><span class=\"line\"></span><br><span class=\"line\">  enabled: true</span><br><span class=\"line\">  </span><br><span class=\"line\">  hosts: [&quot;localhost:5044&quot;]</span><br><span class=\"line\"></span><br><span class=\"line\">  # 每个logstash worker数量。  </span><br><span class=\"line\">  worker: 1</span><br><span class=\"line\"></span><br><span class=\"line\">  # 压缩级别</span><br><span class=\"line\">  compression_level: 3</span><br><span class=\"line\"></span><br><span class=\"line\">  # 是否转义html符号</span><br><span class=\"line\">  escape_html: false</span><br><span class=\"line\"></span><br><span class=\"line\">  #最大链接时间 。 0 代表不启用此功能</span><br><span class=\"line\">  # 不支持async connections</span><br><span class=\"line\">  ttl: 30s</span><br><span class=\"line\"></span><br><span class=\"line\">  # 是否需要负载均衡</span><br><span class=\"line\">  loadbalance: false</span><br><span class=\"line\"></span><br><span class=\"line\">  # 处理时异步发送到Logstash的批次数</span><br><span class=\"line\">  pipelining: 2</span><br><span class=\"line\"></span><br><span class=\"line\">  # 如果启用，在没有没有遇到错误的情况下，则每次仅传输一批事件中的一部分事件 ，直到要发送的事件数量增加到&#96;bulk_max_size&#96;</span><br><span class=\"line\">  slow_start: false</span><br><span class=\"line\"></span><br><span class=\"line\">  # 重连时间策略 </span><br><span class=\"line\">  backoff.init: 1s</span><br><span class=\"line\">  backoff.max: 60s</span><br><span class=\"line\"></span><br><span class=\"line\">  # 默认索引 一般都会重写</span><br><span class=\"line\">  index: &#39;filebeat&#39;</span><br><span class=\"line\"></span><br><span class=\"line\">  # SOCKS5 proxy server URL</span><br><span class=\"line\">  proxy_url: socks5:&#x2F;&#x2F;user:password@socks5-server:2233</span><br><span class=\"line\"></span><br><span class=\"line\">  # 是否启用本地解析器</span><br><span class=\"line\">  proxy_use_local_resolver: false</span><br><span class=\"line\"></span><br><span class=\"line\"> # 使用ssl？</span><br><span class=\"line\">  ssl.enabled: true</span><br><span class=\"line\"></span><br><span class=\"line\">  # ssl认证方式，默认为full。 测试时 可以使用 none</span><br><span class=\"line\">  ssl.verification_mode: full</span><br><span class=\"line\"></span><br><span class=\"line\">  #可用 tls 版本</span><br><span class=\"line\">  ssl.supported_protocols: [TLSv1.1, TLSv1.2, TLSv1.3]</span><br><span class=\"line\"></span><br><span class=\"line\">  # 根证书地址</span><br><span class=\"line\">  ssl.certificate_authorities: [&quot;&#x2F;etc&#x2F;pki&#x2F;root&#x2F;ca.pem&quot;]</span><br><span class=\"line\"></span><br><span class=\"line\">  # 客户端证书</span><br><span class=\"line\">  ssl.certificate: &quot;&#x2F;etc&#x2F;pki&#x2F;client&#x2F;cert.pem&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">  # 客户端密钥</span><br><span class=\"line\">  ssl.key: &quot;&#x2F;etc&#x2F;pki&#x2F;client&#x2F;cert.key&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">  # 密码短语</span><br><span class=\"line\">  ssl.key_passphrase: &#39;&#39;</span><br><span class=\"line\"></span><br><span class=\"line\">  # 配置密码套件以用于SSL连接</span><br><span class=\"line\">  ssl.cipher_suites: []</span><br><span class=\"line\"></span><br><span class=\"line\">  # 为基于ECDHE的密码套件配置曲线类型</span><br><span class=\"line\">  ssl.curve_types: []</span><br><span class=\"line\"></span><br><span class=\"line\">  # 配置支持哪些类型的重新协商。有效选项是 </span><br><span class=\"line\">  # never, once, and freely. 默认是 never.</span><br><span class=\"line\">  ssl.renegotiation: never</span><br><span class=\"line\"></span><br><span class=\"line\">  # 配置一个可用于对已验证证书链进行额外验证的pin， 这可以确保使用特定证书来验证信任链。</span><br><span class=\"line\">  # 该pin是SHA-256指纹的base64编码字符串。.</span><br><span class=\"line\">  ssl.ca_sha256: &quot;&quot;</span><br><span class=\"line\">  </span><br><span class=\"line\">  # 尝试特定Elasticsearch索引操作的次数。如果多次重试后，索引操作未成功，事件被丢弃。默认为3。</span><br><span class=\"line\">  max_retries: 3</span><br><span class=\"line\">  # 单个Logstash request 最大event数量 default is 2048.</span><br><span class=\"line\">  bulk_max_size: 2048</span><br><span class=\"line\"></span><br><span class=\"line\">  # 等待Logstash server响应最大超时时间。默认是 30s.</span><br><span class=\"line\">  timeout: 30s</span><br></pre></td></tr></table></figure>\n\n\n<p>redis<br>Redis输出将event插入Redis列表或Redis通道。该输出插件与Logstash的Redis输入插件兼容。</p>\n<p>常规配置</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 采集配置</span><br><span class=\"line\">filebeat.inputs:     #收集日志</span><br><span class=\"line\">- type: log         #类型</span><br><span class=\"line\">  enabled: true     #始终收集</span><br><span class=\"line\">  paths:</span><br><span class=\"line\">    - &#x2F;etc&#x2F;log&#x2F;*.log    </span><br><span class=\"line\"># 输出配置</span><br><span class=\"line\">output.redis:        </span><br><span class=\"line\">  hosts: [&quot;127.0.0.1:6379&quot;]  #输出在redis里</span><br><span class=\"line\">  password: &quot;123456&quot;   #redis认证密码，我没有</span><br><span class=\"line\">  key: &quot;filebeat7.7&quot;       #日志redis的key值</span><br><span class=\"line\">  db: 0                 #redis数据库0</span><br><span class=\"line\">  timeout: 5             #redis链接超时  默认5s</span><br></pre></td></tr></table></figure>\n\n<p>所有可配置参数</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">output.redis:</span><br><span class=\"line\">  # Boolean flag to enable or disable the output module.</span><br><span class=\"line\">  enabled: true</span><br><span class=\"line\"></span><br><span class=\"line\">  # Configure JSON encoding</span><br><span class=\"line\">  codec.json:</span><br><span class=\"line\">    # Pretty print json event</span><br><span class=\"line\">    pretty: false</span><br><span class=\"line\"></span><br><span class=\"line\">    # Configure escaping HTML symbols in strings.</span><br><span class=\"line\">    escape_html: false</span><br><span class=\"line\"></span><br><span class=\"line\">  # The list of Redis servers to connect to. If load-balancing is enabled, the</span><br><span class=\"line\">  # events are distributed to the servers in the list. If one server becomes</span><br><span class=\"line\">  # unreachable, the events are distributed to the reachable servers only.</span><br><span class=\"line\">  # The hosts setting supports redis and rediss urls with custom password like</span><br><span class=\"line\">  # redis:&#x2F;&#x2F;:password@localhost:6379.</span><br><span class=\"line\">  hosts: [&quot;localhost:6379&quot;]</span><br><span class=\"line\"></span><br><span class=\"line\">  # The name of the Redis list or channel the events are published to. The</span><br><span class=\"line\">  # default is filebeat.</span><br><span class=\"line\">  key: filebeat</span><br><span class=\"line\"></span><br><span class=\"line\">  # The password to authenticate to Redis with. The default is no authentication.</span><br><span class=\"line\">  password:</span><br><span class=\"line\"></span><br><span class=\"line\">  # The Redis database number where the events are published. The default is 0.</span><br><span class=\"line\">  db: 0</span><br><span class=\"line\"></span><br><span class=\"line\">  # The Redis data type to use for publishing events. If the data type is list,</span><br><span class=\"line\">  # the Redis RPUSH command is used. If the data type is channel, the Redis</span><br><span class=\"line\">  # PUBLISH command is used. The default value is list.</span><br><span class=\"line\">  datatype: list</span><br><span class=\"line\"></span><br><span class=\"line\">  # The number of workers to use for each host configured to publish events to</span><br><span class=\"line\">  # Redis. Use this setting along with the loadbalance option. For example, if</span><br><span class=\"line\">  # you have 2 hosts and 3 workers, in total 6 workers are started (3 for each</span><br><span class=\"line\">  # host).</span><br><span class=\"line\">  worker: 1</span><br><span class=\"line\"></span><br><span class=\"line\">  # If set to true and multiple hosts or workers are configured, the output</span><br><span class=\"line\">  # plugin load balances published events onto all Redis hosts. If set to false,</span><br><span class=\"line\">  # the output plugin sends all events to only one host (determined at random)</span><br><span class=\"line\">  # and will switch to another host if the currently selected one becomes</span><br><span class=\"line\">  # unreachable. The default value is true.</span><br><span class=\"line\">  loadbalance: true</span><br><span class=\"line\"></span><br><span class=\"line\">  # The Redis connection timeout in seconds. The default is 5 seconds.</span><br><span class=\"line\">  timeout: 5s</span><br><span class=\"line\"></span><br><span class=\"line\">  # The number of times to retry publishing an event after a publishing failure.</span><br><span class=\"line\">  # After the specified number of retries, the events are typically dropped.</span><br><span class=\"line\">  # Some Beats, such as Filebeat, ignore the max_retries setting and retry until</span><br><span class=\"line\">  # all events are published. Set max_retries to a value less than 0 to retry</span><br><span class=\"line\">  # until all events are published. The default is 3.</span><br><span class=\"line\">  max_retries: 3</span><br><span class=\"line\"></span><br><span class=\"line\">  # The number of seconds to wait before trying to reconnect to Redis</span><br><span class=\"line\">  # after a network error. After waiting backoff.init seconds, the Beat</span><br><span class=\"line\">  # tries to reconnect. If the attempt fails, the backoff timer is increased</span><br><span class=\"line\">  # exponentially up to backoff.max. After a successful connection, the backoff</span><br><span class=\"line\">  # timer is reset. The default is 1s.</span><br><span class=\"line\">  backoff.init: 1s</span><br><span class=\"line\"></span><br><span class=\"line\">  # The maximum number of seconds to wait before attempting to connect to</span><br><span class=\"line\">  # Redis after a network error. The default is 60s.</span><br><span class=\"line\">  backoff.max: 60s</span><br><span class=\"line\"></span><br><span class=\"line\">  # The maximum number of events to bulk in a single Redis request or pipeline.</span><br><span class=\"line\">  # The default is 2048.</span><br><span class=\"line\">  bulk_max_size: 2048</span><br><span class=\"line\"></span><br><span class=\"line\">  # The URL of the SOCKS5 proxy to use when connecting to the Redis servers. The</span><br><span class=\"line\">  # value must be a URL with a scheme of socks5:&#x2F;&#x2F;.</span><br><span class=\"line\">  proxy_url:</span><br><span class=\"line\"></span><br><span class=\"line\">  # This option determines whether Redis hostnames are resolved locally when</span><br><span class=\"line\">  # using a proxy. The default value is false, which means that name resolution</span><br><span class=\"line\">  # occurs on the proxy server.</span><br><span class=\"line\">  proxy_use_local_resolver: false</span><br><span class=\"line\"></span><br><span class=\"line\">  # Enable SSL support. SSL is automatically enabled, if any SSL setting is set.</span><br><span class=\"line\">  ssl.enabled: true</span><br><span class=\"line\"></span><br><span class=\"line\">  # Configure SSL verification mode. If &#96;none&#96; is configured, all server hosts</span><br><span class=\"line\">  # and certificates will be accepted. In this mode, SSL based connections are</span><br><span class=\"line\">  # susceptible to man-in-the-middle attacks. Use only for testing. Default is</span><br><span class=\"line\">  # &#96;full&#96;.</span><br><span class=\"line\">  ssl.verification_mode: full</span><br><span class=\"line\"></span><br><span class=\"line\">  # List of supported&#x2F;valid TLS versions. By default all TLS versions from 1.1</span><br><span class=\"line\">  # up to 1.3 are enabled.</span><br><span class=\"line\">  ssl.supported_protocols: [TLSv1.1, TLSv1.2, TLSv1.3]</span><br><span class=\"line\"></span><br><span class=\"line\">  # Optional SSL configuration options. SSL is off by default.</span><br><span class=\"line\">  # List of root certificates for HTTPS server verifications</span><br><span class=\"line\">  ssl.certificate_authorities: [&quot;&#x2F;etc&#x2F;pki&#x2F;root&#x2F;ca.pem&quot;]</span><br><span class=\"line\"></span><br><span class=\"line\">  # Certificate for SSL client authentication</span><br><span class=\"line\">  ssl.certificate: &quot;&#x2F;etc&#x2F;pki&#x2F;client&#x2F;cert.pem&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">  # Client Certificate Key</span><br><span class=\"line\">  ssl.key: &quot;&#x2F;etc&#x2F;pki&#x2F;client&#x2F;cert.key&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">  # Optional passphrase for decrypting the Certificate Key.</span><br><span class=\"line\">  ssl.key_passphrase: &#39;&#39;</span><br><span class=\"line\"></span><br><span class=\"line\">  # Configure cipher suites to be used for SSL connections</span><br><span class=\"line\">  ssl.cipher_suites: []</span><br><span class=\"line\"></span><br><span class=\"line\">  # Configure curve types for ECDHE based cipher suites</span><br><span class=\"line\">  ssl.curve_types: []</span><br><span class=\"line\"></span><br><span class=\"line\">  # Configure what types of renegotiation are supported. Valid options are</span><br><span class=\"line\">  # never, once, and freely. Default is never.</span><br><span class=\"line\">  ssl.renegotiation: never</span><br></pre></td></tr></table></figure>\n\n\n<p>file</p>\n<p>配置filebeat的输出方式为文件， 一般用于测试。</p>\n<p>常规配置</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 采集配置</span><br><span class=\"line\">filebeat.inputs:     #收集日志</span><br><span class=\"line\">- type: log         #类型</span><br><span class=\"line\">  enabled: true     #始终收集</span><br><span class=\"line\">  paths:</span><br><span class=\"line\">    - &#x2F;etc&#x2F;log&#x2F;*.log    </span><br><span class=\"line\"># 输出配置</span><br><span class=\"line\">output.file:</span><br><span class=\"line\">  path: &quot;&#x2F;tmp&#x2F;filebeat&quot;  #  输出路径</span><br><span class=\"line\">  filename: filebeat    # 输出文件名</span><br></pre></td></tr></table></figure>\n\n<p>所有可配置参数</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">output.file:</span><br><span class=\"line\">  # Boolean flag to enable or disable the output module.</span><br><span class=\"line\">  enabled: true</span><br><span class=\"line\"></span><br><span class=\"line\">  # Configure JSON encoding</span><br><span class=\"line\">  codec.json:</span><br><span class=\"line\">    # Pretty-print JSON event</span><br><span class=\"line\">    pretty: false</span><br><span class=\"line\"></span><br><span class=\"line\">    # Configure escaping HTML symbols in strings.</span><br><span class=\"line\">    escape_html: false</span><br><span class=\"line\"></span><br><span class=\"line\">  # Path to the directory where to save the generated files. The option is</span><br><span class=\"line\">  # mandatory.</span><br><span class=\"line\">  path: &quot;&#x2F;tmp&#x2F;filebeat&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">  # Name of the generated files. The default is &#96;filebeat&#96; and it generates</span><br><span class=\"line\">  # files: &#96;filebeat&#96;, &#96;filebeat.1&#96;, &#96;filebeat.2&#96;, etc.</span><br><span class=\"line\">  filename: filebeat</span><br><span class=\"line\"></span><br><span class=\"line\">  # Maximum size in kilobytes of each file. When this size is reached, and on</span><br><span class=\"line\">  # every Filebeat restart, the files are rotated. The default value is 10240</span><br><span class=\"line\">  # kB.</span><br><span class=\"line\">  rotate_every_kb: 10000</span><br><span class=\"line\"></span><br><span class=\"line\">  # Maximum number of files under path. When this number of files is reached,</span><br><span class=\"line\">  # the oldest file is deleted and the rest are shifted from last to first. The</span><br><span class=\"line\">  # default is 7 files.</span><br><span class=\"line\">  number_of_files: 7</span><br><span class=\"line\"></span><br><span class=\"line\">  # Permissions to use for file creation. The default is 0600.</span><br><span class=\"line\">  permissions: 0600</span><br></pre></td></tr></table></figure>\n\n<p>console</p>\n<p>输出到控制面板，测试输出最佳方式。</p>\n<p>常规配置</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 采集配置</span><br><span class=\"line\">filebeat.inputs:     #收集日志</span><br><span class=\"line\">- type: log         #类型</span><br><span class=\"line\">  enabled: true     #始终收集</span><br><span class=\"line\">  paths:</span><br><span class=\"line\">    - &#x2F;etc&#x2F;log&#x2F;*.log    </span><br><span class=\"line\"># 输出配置</span><br><span class=\"line\">output.console:</span><br><span class=\"line\">  codec.json:</span><br><span class=\"line\">    # 漂亮输出（格式化）</span><br><span class=\"line\">    pretty: true</span><br><span class=\"line\">    #  转义HTML符号</span><br><span class=\"line\">    escape_html: true</span><br></pre></td></tr></table></figure>\n\n\n<h3 id=\"Keystore\"><a href=\"#Keystore\" class=\"headerlink\" title=\"Keystore\"></a>Keystore</h3><p>密钥库地址（一般是包含私钥以及关键数据的文件路径）</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">keystore.path: &quot;$&#123;path.config&#125;&#x2F;beats.keystore&quot;</span><br></pre></td></tr></table></figure>\n\n<p>命令</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">创建一个存储密码的keystore：   filebeat keystore create</span><br><span class=\"line\">然后往其中添加键值对，例如：    filebeatk eystore add ES_PWD</span><br><span class=\"line\">使用覆盖原来键的值：           filebeat key store add ES_PWD–force</span><br><span class=\"line\">删除键值对：                  filebeat key store remove ES_PWD</span><br><span class=\"line\">查看已有的键值对：             filebeat key store list</span><br></pre></td></tr></table></figure>\n\n\n<h3 id=\"Setup-ILM\"><a href=\"#Setup-ILM\" class=\"headerlink\" title=\"Setup ILM\"></a>Setup ILM</h3><p>从7.0版开始，Filebeat在连接到支持生命周期管理的群集时默认使用索引生命周期管理。Filebeat自动加载默认策略并将其应用于Filebeat创建的任何索引。</p>\n<p>index lifecycle management (ILM) 索引生命管理，如果它启用了，那么会忽略output.elasticsearch.index 里面的设置。</p>\n<p>新特性：当现有索引达到指定的大小或期限时，使用索引生命周期策略自动将过渡到新索引</p>\n<p>常规配置</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">setup.ilm.enabled: auto</span><br><span class=\"line\">setup.ilm.rollover_alias: &quot;filebeat&quot;  # 前缀</span><br><span class=\"line\"># filebeat-2020.09.28-000001</span><br><span class=\"line\">setup.ilm.pattern: &quot;&#123;now&#x2F;d&#125;-000001&quot;   </span><br></pre></td></tr></table></figure>\n\n<p>需要了解Date math</p>\n<p>详细配置</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># Configure index lifecycle management (ILM). These settings create a write</span><br><span class=\"line\"># alias and add additional settings to the index template. When ILM is enabled,</span><br><span class=\"line\"># output.elasticsearch.index is ignored, and the write alias is used to set the</span><br><span class=\"line\"># index name.</span><br><span class=\"line\"></span><br><span class=\"line\"># Enable ILM support. Valid values are true, false, and auto. When set to auto</span><br><span class=\"line\"># (the default), the Beat uses index lifecycle management when it connects to a</span><br><span class=\"line\"># cluster that supports ILM; otherwise, it creates daily indices.</span><br><span class=\"line\">setup.ilm.enabled: auto</span><br><span class=\"line\"></span><br><span class=\"line\"># Set the prefix used in the index lifecycle write alias name. The default alias</span><br><span class=\"line\"># name is &#39;filebeat-%&#123;[agent.version]&#125;&#39;.</span><br><span class=\"line\">setup.ilm.rollover_alias: &quot;filebeat&quot;</span><br><span class=\"line\"></span><br><span class=\"line\"># Set the rollover index pattern. The default is &quot;%&#123;now&#x2F;d&#125;-000001&quot;.</span><br><span class=\"line\"># filebeat-2020.09.28-000001</span><br><span class=\"line\">setup.ilm.pattern: &quot;&#123;now&#x2F;d&#125;-000001&quot;</span><br><span class=\"line\"></span><br><span class=\"line\"># Set the lifecycle policy name. The default policy name is</span><br><span class=\"line\"># &#39;filebeat&#39;.</span><br><span class=\"line\">setup.ilm.policy_name: &quot;mypolicy&quot;</span><br><span class=\"line\"></span><br><span class=\"line\"># The path to a JSON file that contains a lifecycle policy configuration. Used</span><br><span class=\"line\"># to load your own lifecycle policy.</span><br><span class=\"line\">setup.ilm.policy_file:</span><br><span class=\"line\"></span><br><span class=\"line\"># Disable the check for an existing lifecycle policy. The default is true. If</span><br><span class=\"line\"># you disable this check, set setup.ilm.overwrite: true so the lifecycle policy</span><br><span class=\"line\"># can be installed.</span><br><span class=\"line\">setup.ilm.check_exists: true</span><br><span class=\"line\"></span><br><span class=\"line\"># Overwrite the lifecycle policy at startup. The default is false.</span><br><span class=\"line\">setup.ilm.overwrite: false</span><br></pre></td></tr></table></figure>\n\n\n<p>Logging</p>\n<p>配置日志输出的选项。日志记录系统可以将日志写入syslog或轮换日志文件。如果未显式配置日志记录，则使用文件输出，输出路径为/var/log/filebeat。</p>\n<p>常规配置</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#log 输出级别 </span><br><span class=\"line\">logging.level: info </span><br><span class=\"line\"># 输出方式</span><br><span class=\"line\">logging.to_files: true</span><br><span class=\"line\"># 输出路径、名字、 log文件最大数、文件操作权限</span><br><span class=\"line\">logging.files:</span><br><span class=\"line\">  path: &#x2F;var&#x2F;log&#x2F;filebeat</span><br><span class=\"line\">  name: filebeat</span><br><span class=\"line\">  keepfiles: 7</span><br><span class=\"line\">  permissions: 0644</span><br></pre></td></tr></table></figure>\n\n\n<p>详细参数</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># There are four options for the log output: file, stderr, syslog, eventlog</span><br><span class=\"line\"># The file output is the default.</span><br><span class=\"line\"></span><br><span class=\"line\"># Sets log level. The default log level is info.</span><br><span class=\"line\"># Available log levels are: error, warning, info, debug</span><br><span class=\"line\">logging.level: info</span><br><span class=\"line\"></span><br><span class=\"line\"># Enable debug output for selected components. To enable all selectors use [&quot;*&quot;]</span><br><span class=\"line\"># Other available selectors are &quot;beat&quot;, &quot;publish&quot;, &quot;service&quot;</span><br><span class=\"line\"># Multiple selectors can be chained.</span><br><span class=\"line\"># 输出哪些服务的log</span><br><span class=\"line\">logging.selectors: [ ]</span><br><span class=\"line\"></span><br><span class=\"line\"># Send all logging output to stderr. The default is false.</span><br><span class=\"line\">logging.to_stderr: false</span><br><span class=\"line\"></span><br><span class=\"line\"># Send all logging output to syslog. The default is false.</span><br><span class=\"line\">logging.to_syslog: false</span><br><span class=\"line\"></span><br><span class=\"line\"># Send all logging output to Windows Event Logs. The default is false.</span><br><span class=\"line\">logging.to_eventlog: false</span><br><span class=\"line\"></span><br><span class=\"line\"># If enabled, Filebeat periodically logs its internal metrics that have changed</span><br><span class=\"line\"># in the last period. For each metric that changed, the delta from the value at</span><br><span class=\"line\"># the beginning of the period is logged. Also, the total values for</span><br><span class=\"line\"># all non-zero internal metrics are logged on shutdown. The default is true.</span><br><span class=\"line\">logging.metrics.enabled: true</span><br><span class=\"line\"></span><br><span class=\"line\"># The period after which to log the internal metrics. The default is 30s.</span><br><span class=\"line\">logging.metrics.period: 30s</span><br><span class=\"line\"></span><br><span class=\"line\"># Logging to rotating files. Set logging.to_files to false to disable logging to</span><br><span class=\"line\"># files.</span><br><span class=\"line\">logging.to_files: true</span><br><span class=\"line\">logging.files:</span><br><span class=\"line\">  # Configure the path where the logs are written. The default is the logs directory</span><br><span class=\"line\">  # under the home path (the binary location).</span><br><span class=\"line\">  path: &#x2F;var&#x2F;log&#x2F;filebeat</span><br><span class=\"line\"></span><br><span class=\"line\">  # The name of the files where the logs are written to.</span><br><span class=\"line\">  name: filebeat</span><br><span class=\"line\"></span><br><span class=\"line\">  # Configure log file size limit. If limit is reached, log file will be</span><br><span class=\"line\">  # automatically rotated</span><br><span class=\"line\">  rotateeverybytes: 10485760 # &#x3D; 10MB</span><br><span class=\"line\"></span><br><span class=\"line\">  # Number of rotated log files to keep. Oldest files will be deleted first.</span><br><span class=\"line\">  keepfiles: 7</span><br><span class=\"line\"></span><br><span class=\"line\">  # The permissions mask to apply when rotating log files. The default value is 0600.</span><br><span class=\"line\">  # Must be a valid Unix-style file permissions mask expressed in octal notation.</span><br><span class=\"line\">  permissions: 0600</span><br><span class=\"line\"></span><br><span class=\"line\">  # Enable log file rotation on time intervals in addition to size-based rotation.</span><br><span class=\"line\">  # Intervals must be at least 1s. Values of 1m, 1h, 24h, 7*24h, 30*24h, and 365*24h</span><br><span class=\"line\">  # are boundary-aligned with minutes, hours, days, weeks, months, and years as</span><br><span class=\"line\">  # reported by the local system clock. All other intervals are calculated from the</span><br><span class=\"line\">  # Unix epoch. Defaults to disabled.</span><br><span class=\"line\">  interval: 0</span><br><span class=\"line\"></span><br><span class=\"line\">  # Rotate existing logs on startup rather than appending to the existing</span><br><span class=\"line\">  # file. Defaults to true.</span><br><span class=\"line\">   rotateonstartup: true</span><br><span class=\"line\"></span><br><span class=\"line\"># Set to true to log messages in JSON format.</span><br><span class=\"line\">logging.json: false</span><br><span class=\"line\"></span><br><span class=\"line\"># Set to true, to log messages with minimal required Elastic Common Schema (ECS)</span><br><span class=\"line\"># information. Recommended to use in combination with &#96;logging.json&#x3D;true&#96;</span><br><span class=\"line\"># Defaults to false.</span><br><span class=\"line\">logging.ecs: false</span><br></pre></td></tr></table></figure>\n\n\n\n","site":{"data":{}},"excerpt":"<p>摘要: filebeat 使用</p>","more":"<h1 id=\"filebeat-使用\"><a href=\"#filebeat-使用\" class=\"headerlink\" title=\"filebeat 使用\"></a>filebeat 使用</h1><h2 id=\"一、前言\"><a href=\"#一、前言\" class=\"headerlink\" title=\"一、前言\"></a>一、前言</h2><p>这里使用的7.7.0版本，在官方文档快速上手的中，只要简单配置了filelbeat.yml ，启动filebeat就可以收集日志了。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 定义输入</span><br><span class=\"line\">filebeat.inputs:</span><br><span class=\"line\">- type: log</span><br><span class=\"line\">  enabled: true</span><br><span class=\"line\">  paths:</span><br><span class=\"line\">    - &#x2F;var&#x2F;log&#x2F;*.log</span><br><span class=\"line\"># 定义输出</span><br><span class=\"line\">output.elasticsearch:</span><br><span class=\"line\">  hosts: [&quot;myEShost:9200&quot;]</span><br><span class=\"line\">  username: &quot;filebeat_internal&quot;</span><br><span class=\"line\">  password: &quot;YOUR_PASSWORD&quot; </span><br><span class=\"line\">setup.kibana:</span><br><span class=\"line\">  host: &quot;mykibanahost:5601&quot;</span><br><span class=\"line\">  username: &quot;my_kibana_user&quot;  </span><br><span class=\"line\">  password: &quot;YOUR_PASSWORD&quot;</span><br></pre></td></tr></table></figure>\n\n<p>其实filebeat提供的可配置项有很多，这里就以大模块角度了解下其分类。 更多详细内容，<a href=\"https://www.elastic.co/guide/en/beats/filebeat/7.7/index.html\">点击查看官网</a>。</p>\n<h2 id=\"二、参数配置分类\"><a href=\"#二、参数配置分类\" class=\"headerlink\" title=\"二、参数配置分类\"></a>二、参数配置分类</h2><h3 id=\"1、-Paths\"><a href=\"#1、-Paths\" class=\"headerlink\" title=\"1、 Paths\"></a>1、 Paths</h3><p>用于定义Filebeat查找相关文件的位置。例如，Filebeat在config路径中查找启动文件，并在log路径中写入日志文件。Filebeat在data路径中查找其registry文件。</p>\n<p>用户可以不配置，使用默认的路径。也可以自定义配置路径：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">path.home: &#x2F;usr&#x2F;share&#x2F;filebeat</span><br><span class=\"line\">path.config: &#x2F;etc&#x2F;filebeat</span><br><span class=\"line\">path.data: &#x2F;var&#x2F;lib&#x2F;filebeat</span><br><span class=\"line\">path.logs: &#x2F;var&#x2F;log&#x2F;</span><br></pre></td></tr></table></figure>\n\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; Paths &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class=\"line\"></span><br><span class=\"line\"># The home path for the Filebeat installation. This is the default base path</span><br><span class=\"line\"># for all other path settings and for miscellaneous files that come with the</span><br><span class=\"line\"># distribution (for example, the sample dashboards).</span><br><span class=\"line\"># If not set by a CLI flag or in the configuration file, the default for the</span><br><span class=\"line\"># home path is the location of the binary.</span><br><span class=\"line\">#path.home:</span><br><span class=\"line\"></span><br><span class=\"line\"># The configuration path for the Filebeat installation. This is the default</span><br><span class=\"line\"># base path for configuration files, including the main YAML configuration file</span><br><span class=\"line\"># and the Elasticsearch template file. If not set by a CLI flag or in the</span><br><span class=\"line\"># configuration file, the default for the configuration path is the home path.</span><br><span class=\"line\">#path.config: $&#123;path.home&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"># The data path for the Filebeat installation. This is the default base path</span><br><span class=\"line\"># for all the files in which Filebeat needs to store its data. If not set by a</span><br><span class=\"line\"># CLI flag or in the configuration file, the default for the data path is a data</span><br><span class=\"line\"># subdirectory inside the home path.</span><br><span class=\"line\">#path.data: $&#123;path.home&#125;&#x2F;data</span><br><span class=\"line\"></span><br><span class=\"line\"># The logs path for a Filebeat installation. This is the default location for</span><br><span class=\"line\"># the Beat&#39;s log files. If not set by a CLI flag or in the configuration file,</span><br><span class=\"line\"># the default for the logs path is a logs subdirectory inside the home path.</span><br><span class=\"line\">#path.logs: $&#123;path.home&#125;&#x2F;logs</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"配置参数说明\"><a href=\"#配置参数说明\" class=\"headerlink\" title=\"配置参数说明\"></a>配置参数说明</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1、path.home</span><br><span class=\"line\">Filebeat安装的主路径。这是所有其他路径设置和发行版附带的其他文件（例如，示例仪表板）的默认基本路径。如果未设置，则主路径的默认值是Filebeat二进制文件的位置。</span><br><span class=\"line\"></span><br><span class=\"line\">2、path.config</span><br><span class=\"line\">Filebeat安装的配置路径。这是配置文件的默认基本路径，包括主YAML配置文件和Elasticsearch模板文件。如果设置，则配置路径的默认值为&#123;path.home&#125;路径。</span><br><span class=\"line\"></span><br><span class=\"line\">3、path.data</span><br><span class=\"line\">Filebeat的数据路径。这是Filebeat需要存储其数据的所有文件的默认基本路径。如果设置，则数据路径的默认值是&#123;path.home&#125;&#x2F;data。</span><br><span class=\"line\"></span><br><span class=\"line\">注意： 每个filebeat实例的path.data必须是唯一的。</span><br><span class=\"line\"></span><br><span class=\"line\">4、path.log</span><br><span class=\"line\">Filebeat的日志路径。这是Filebeat日志文件的默认位置。如果未设置，则日志路径的默认值为&#123;path.home&#125;&#x2F;log。</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"默认启动时的路径\"><a href=\"#默认启动时的路径\" class=\"headerlink\" title=\"默认启动时的路径\"></a>默认启动时的路径</h4><p>比如说用户在 /home/abc/work 路径下启动filebeat，那么path.home 就默认为 当前路径。并且可以看到 多了两个文件夹data和 log</p>\n<h3 id=\"2、Modules-configuration\"><a href=\"#2、Modules-configuration\" class=\"headerlink\" title=\"2、Modules configuration\"></a>2、Modules configuration</h3><p>Filebeat模块简化了常见日志格式的收集、解析和可视化。典型的模块（比如Nginx日志）由一个或多个文件集组成（对于Nginx，是access和error），如果你启用了下面的module, fileabeat就可以根据系统自动去寻找access、error 对应的log文件进行收集。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- module: nginx</span><br><span class=\"line\">  # Access logs</span><br><span class=\"line\">  #access:</span><br><span class=\"line\">    #enabled: true</span><br><span class=\"line\"></span><br><span class=\"line\">    # Set custom paths for the log files. If left empty,</span><br><span class=\"line\">    # Filebeat will choose the paths depending on your OS.</span><br><span class=\"line\">    #var.paths:</span><br><span class=\"line\"></span><br><span class=\"line\">    # Input configuration (advanced). Any input configuration option</span><br><span class=\"line\">    # can be added under this section.</span><br><span class=\"line\">    #input:</span><br></pre></td></tr></table></figure>\n\n<p>Filebeat会根据您的环境自动调整这些配置，并将它们加载到相应的Elastic stack组件中</p>\n<p>配置文件的方式：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">filebeat.config:</span><br><span class=\"line\">  modules:</span><br><span class=\"line\">    # 通过这里开启， 默认是关闭</span><br><span class=\"line\">    enabled: true</span><br><span class=\"line\">    path: modules.d&#x2F;*.yml</span><br><span class=\"line\">    reload.enabled: true</span><br><span class=\"line\">    reload.period: 10s</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n<h3 id=\"3、Filebeat-inputs\"><a href=\"#3、Filebeat-inputs\" class=\"headerlink\" title=\"3、Filebeat inputs\"></a>3、Filebeat inputs</h3><p>如果你想手动配置Filebeat（而不是使用模块），可以在配置文件filebeat.inputs部分设置Filebeat采集源以及相关参数配置。每个输入源都以破折号（-）开头。用户可以指定多个输入源，并且可以多次指定同一输入类型。例如：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">filebeat.inputs:</span><br><span class=\"line\">- type: log</span><br><span class=\"line\">  paths:</span><br><span class=\"line\">    - &#x2F;var&#x2F;log&#x2F;system.log</span><br><span class=\"line\">    - &#x2F;var&#x2F;log&#x2F;wifi.log</span><br><span class=\"line\">- type: log</span><br><span class=\"line\">  paths:</span><br><span class=\"line\">    - &quot;&#x2F;var&#x2F;log&#x2F;apache2&#x2F;*&quot;</span><br><span class=\"line\">  fields:</span><br><span class=\"line\">    apache: true</span><br><span class=\"line\">  fields_under_root: true</span><br><span class=\"line\">- type: tcp</span><br><span class=\"line\">  max_message_size: 10MiB</span><br><span class=\"line\">  host: &quot;localhost:9000&quot;</span><br></pre></td></tr></table></figure>\n<p>点击查看更多input 配置</p>\n<h3 id=\"4、Filebeat-autodiscover\"><a href=\"#4、Filebeat-autodiscover\" class=\"headerlink\" title=\"4、Filebeat autodiscover\"></a>4、Filebeat autodiscover</h3><p>在容器上运行应用程序时，它们会成为监视系统的移动目标。“自动发现”允许您跟踪它们并在更改发生时调整设置。通过定义配置模板，自动发现子系统可以在服务开始运行时监视它们。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">filebeat.autodiscover:</span><br><span class=\"line\">  List of enabled autodiscover providers</span><br><span class=\"line\"> providers:</span><br><span class=\"line\">   - type: docker</span><br><span class=\"line\">     templates:</span><br><span class=\"line\">       - condition:</span><br><span class=\"line\">           equals.docker.container.image: busybox</span><br><span class=\"line\">         config:</span><br><span class=\"line\">           - type: container</span><br><span class=\"line\">             paths:</span><br><span class=\"line\">               - &#x2F;var&#x2F;lib&#x2F;docker&#x2F;containers&#x2F;$&#123;data.docker.container.id&#125;&#x2F;*.log</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"5、Filebeat-global-options\"><a href=\"#5、Filebeat-global-options\" class=\"headerlink\" title=\"5、Filebeat global options\"></a>5、Filebeat global options</h3><p>定义publisher行为或者某些文件的位置信息，这些参数是filebeat根节点参数。比如register文件路径、或者是否启用modules、多个inputs等等</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># Registry data path. If a relative path is used, it is considered relative to the</span><br><span class=\"line\"># data path.</span><br><span class=\"line\">#filebeat.registry.path: $&#123;path.data&#125;&#x2F;registry</span><br><span class=\"line\"></span><br><span class=\"line\"># The permissions mask to apply on registry data, and meta files. The default</span><br><span class=\"line\"># value is 0600.  Must be a valid Unix-style file permissions mask expressed in</span><br><span class=\"line\"># octal notation.  This option is not supported on Windows.</span><br><span class=\"line\">#filebeat.registry.file_permissions: 0600</span><br><span class=\"line\"></span><br><span class=\"line\"># The timeout value that controls when registry entries are written to disk</span><br><span class=\"line\"># (flushed). When an unwritten update exceeds this value, it triggers a write</span><br><span class=\"line\"># to disk. When flush is set to 0s, the registry is written to disk after each</span><br><span class=\"line\"># batch of events has been published successfully. The default value is 0s.</span><br><span class=\"line\">#filebeat.registry.flush: 0s</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># Starting with Filebeat 7.0, the registry uses a new directory format to store</span><br><span class=\"line\"># Filebeat state. After you upgrade, Filebeat will automatically migrate a 6.x</span><br><span class=\"line\"># registry file to use the new directory format. If you changed</span><br><span class=\"line\"># filebeat.registry.path while upgrading, set filebeat.registry.migrate_file to</span><br><span class=\"line\"># point to the old registry file.</span><br><span class=\"line\">#filebeat.registry.migrate_file: $&#123;path.data&#125;&#x2F;registry</span><br><span class=\"line\"></span><br><span class=\"line\"># By default Ingest pipelines are not updated if a pipeline with the same ID</span><br><span class=\"line\"># already exists. If this option is enabled Filebeat overwrites pipelines</span><br><span class=\"line\"># everytime a new Elasticsearch connection is established.</span><br><span class=\"line\">#filebeat.overwrite_pipelines: false</span><br><span class=\"line\"></span><br><span class=\"line\"># How long filebeat waits on shutdown for the publisher to finish.</span><br><span class=\"line\"># Default is 0, not waiting.</span><br><span class=\"line\">#filebeat.shutdown_timeout: 0</span><br><span class=\"line\"></span><br><span class=\"line\"># Enable filebeat config reloading</span><br><span class=\"line\">#filebeat.config:</span><br><span class=\"line\">  #inputs:</span><br><span class=\"line\">    #enabled: false</span><br><span class=\"line\">    #path: inputs.d&#x2F;*.yml</span><br><span class=\"line\">    #reload.enabled: true</span><br><span class=\"line\">    #reload.period: 10s</span><br><span class=\"line\">  #modules:</span><br><span class=\"line\">    #enabled: false</span><br><span class=\"line\">    #path: modules.d&#x2F;*.yml</span><br><span class=\"line\">    #reload.enabled: true</span><br><span class=\"line\">    #reload.period: 10s</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"相关参数说明\"><a href=\"#相关参数说明\" class=\"headerlink\" title=\"相关参数说明\"></a>相关参数说明</h4><p>registry文件夹里记录了filebeat当前采集文件的元信息（包含文件名、读取的offset、文件id等等）</p>\n<p>1、filebeat.registry.path<br>如果不设置，默认路径是${path.data}/registry ，一般不设置 。</p>\n<p>2、filebeat.registry.file_permissions<br>registry文件操作权限码，默认是0600 ，如果没有特殊需求 使用默认值即可。注意：在windows上不支持此参数。</p>\n<p>3、filebeat.registry.flush<br>默认值为0. 表示 当filebeat成功发送了采集的数据，立即刷新registry 。 用户可以合理设置刷新间隔， 减轻IO压力。</p>\n<p>4、filebeat.registry.migrate_file<br>迁移文件路径： 从7.0后，registry存储方式和6.x的不一样。 如果你以前使用的是6.x版本的filebeat，然后想更新到7.x ，并且想沿用以前的registry信息，那么你可以使用这个参数：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">filebeat.registry.path: $&#123;path.data&#125;&#x2F;registry</span><br><span class=\"line\">filebeat.registry.migrate_file: &#x2F;path&#x2F;to&#x2F;old&#x2F;registry_file</span><br></pre></td></tr></table></figure>\n<p>5、filebeat.shutdown_timeout<br>Filebeat在关闭之前等待发布者完成发送事件的时间，然后Filebeat关闭。不建议设置该参数，因为确定shutdown_timeout的正确值很大程度上取决于Filebeat运行的环境以及输出的当前状态。</p>\n<p>6、filebeat.config<br>可选配置 是否启动modules</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">filebeat.config:</span><br><span class=\"line\">  #modules:</span><br><span class=\"line\">    #enabled: false</span><br><span class=\"line\">    #path: modules.d&#x2F;*.yml</span><br><span class=\"line\">    #reload.enabled: true</span><br><span class=\"line\">    #reload.period: 10s</span><br></pre></td></tr></table></figure>\n<p>如果你想在一个配置文件filebeat.yml里想采集复杂的多个log文件或者复杂输入源，你可以开启下面的配置（），然后自定义多个输入源文件即可。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">filebeat.config:</span><br><span class=\"line\">  inputs:</span><br><span class=\"line\">    enabled: true</span><br><span class=\"line\">    path: inputs.d&#x2F;*.yml</span><br><span class=\"line\">    reload.enabled: true</span><br><span class=\"line\">    reload.period: 10s</span><br></pre></td></tr></table></figure>\n\n\n<h3 id=\"6、General\"><a href=\"#6、General\" class=\"headerlink\" title=\"6、General\"></a>6、General</h3><p>所有Elastic Beats都支持这些选项。因为它们是通用选项，所以它们没有命名空间</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; General &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class=\"line\"></span><br><span class=\"line\"># The name of the shipper that publishes the network data. It can be used to group</span><br><span class=\"line\"># all the transactions sent by a single shipper in the web interface.</span><br><span class=\"line\"># If this options is not defined, the hostname is used.</span><br><span class=\"line\">#name:</span><br><span class=\"line\"></span><br><span class=\"line\"># The tags of the shipper are included in their own field with each</span><br><span class=\"line\"># transaction published. Tags make it easy to group servers by different</span><br><span class=\"line\"># logical properties.</span><br><span class=\"line\">#tags: [&quot;service-X&quot;, &quot;web-tier&quot;]</span><br><span class=\"line\"></span><br><span class=\"line\"># Optional fields that you can specify to add additional information to the</span><br><span class=\"line\"># output. Fields can be scalar values, arrays, dictionaries, or any nested</span><br><span class=\"line\"># combination of these.</span><br><span class=\"line\">#fields:</span><br><span class=\"line\">#  env: staging</span><br><span class=\"line\"></span><br><span class=\"line\"># If this option is set to true, the custom fields are stored as top-level</span><br><span class=\"line\"># fields in the output document instead of being grouped under a fields</span><br><span class=\"line\"># sub-dictionary. Default is false.</span><br><span class=\"line\">#fields_under_root: false</span><br><span class=\"line\"></span><br><span class=\"line\"># Internal queue configuration for buffering events to be published.</span><br><span class=\"line\">#queue:</span><br><span class=\"line\">  # Queue type by name (default &#39;mem&#39;)</span><br><span class=\"line\">  # The memory queue will present all available events (up to the outputs</span><br><span class=\"line\">  # bulk_max_size) to the output, the moment the output is ready to server</span><br><span class=\"line\">  # another batch of events.</span><br><span class=\"line\">  #mem:</span><br><span class=\"line\">    # Max number of events the queue can buffer.</span><br><span class=\"line\">    #events: 4096</span><br><span class=\"line\"></span><br><span class=\"line\">    # Hints the minimum number of events stored in the queue,</span><br><span class=\"line\">    # before providing a batch of events to the outputs.</span><br><span class=\"line\">    # The default value is set to 2048.</span><br><span class=\"line\">    # A value of 0 ensures events are immediately available</span><br><span class=\"line\">    # to be sent to the outputs.</span><br><span class=\"line\">    #flush.min_events: 2048</span><br><span class=\"line\"></span><br><span class=\"line\">    # Maximum duration after which events are available to the outputs,</span><br><span class=\"line\">    # if the number of events stored in the queue is &lt; &#96;flush.min_events&#96;.</span><br><span class=\"line\">    #flush.timeout: 1s</span><br><span class=\"line\"></span><br><span class=\"line\">  # The spool queue will store events in a local spool file, before</span><br><span class=\"line\">  # forwarding the events to the outputs.</span><br><span class=\"line\">  #</span><br><span class=\"line\">  # Beta: spooling to disk is currently a beta feature. Use with care.</span><br><span class=\"line\">  #</span><br><span class=\"line\">  # The spool file is a circular buffer, which blocks once the file&#x2F;buffer is full.</span><br><span class=\"line\">  # Events are put into a write buffer and flushed once the write buffer</span><br><span class=\"line\">  # is full or the flush_timeout is triggered.</span><br><span class=\"line\">  # Once ACKed by the output, events are removed immediately from the queue,</span><br><span class=\"line\">  # making space for new events to be persisted.</span><br><span class=\"line\">  #spool:</span><br><span class=\"line\">    # The file namespace configures the file path and the file creation settings.</span><br><span class=\"line\">    # Once the file exists, the &#96;size&#96;, &#96;page_size&#96; and &#96;prealloc&#96; settings</span><br><span class=\"line\">    # will have no more effect.</span><br><span class=\"line\">    #file:</span><br><span class=\"line\">      # Location of spool file. The default value is $&#123;path.data&#125;&#x2F;spool.dat.</span><br><span class=\"line\">      #path: &quot;$&#123;path.data&#125;&#x2F;spool.dat&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">      # Configure file permissions if file is created. The default value is 0600.</span><br><span class=\"line\">      #permissions: 0600</span><br><span class=\"line\"></span><br><span class=\"line\">      # File size hint. The spool blocks, once this limit is reached. The default value is 100 MiB.</span><br><span class=\"line\">      #size: 100MiB</span><br><span class=\"line\"></span><br><span class=\"line\">      # The files page size. A file is split into multiple pages of the same size. The default value is 4KiB.</span><br><span class=\"line\">      #page_size: 4KiB</span><br><span class=\"line\"></span><br><span class=\"line\">      # If prealloc is set, the required space for the file is reserved using</span><br><span class=\"line\">      # truncate. The default value is true.</span><br><span class=\"line\">      #prealloc: true</span><br><span class=\"line\"></span><br><span class=\"line\">    # Spool writer settings</span><br><span class=\"line\">    # Events are serialized into a write buffer. The write buffer is flushed if:</span><br><span class=\"line\">    # - The buffer limit has been reached.</span><br><span class=\"line\">    # - The configured limit of buffered events is reached.</span><br><span class=\"line\">    # - The flush timeout is triggered.</span><br><span class=\"line\">    #write:</span><br><span class=\"line\">      # Sets the write buffer size.</span><br><span class=\"line\">      #buffer_size: 1MiB</span><br><span class=\"line\"></span><br><span class=\"line\">      # Maximum duration after which events are flushed if the write buffer</span><br><span class=\"line\">      # is not full yet. The default value is 1s.</span><br><span class=\"line\">      #flush.timeout: 1s</span><br><span class=\"line\"></span><br><span class=\"line\">      # Number of maximum buffered events. The write buffer is flushed once the</span><br><span class=\"line\">      # limit is reached.</span><br><span class=\"line\">      #flush.events: 16384</span><br><span class=\"line\"></span><br><span class=\"line\">      # Configure the on-disk event encoding. The encoding can be changed</span><br><span class=\"line\">      # between restarts.</span><br><span class=\"line\">      # Valid encodings are: json, ubjson, and cbor.</span><br><span class=\"line\">      #codec: cbor</span><br><span class=\"line\">    #read:</span><br><span class=\"line\">      # Reader flush timeout, waiting for more events to become available, so</span><br><span class=\"line\">      # to fill a complete batch as required by the outputs.</span><br><span class=\"line\">      # If flush_timeout is 0, all available events are forwarded to the</span><br><span class=\"line\">      # outputs immediately.</span><br><span class=\"line\">      # The default value is 0s.</span><br><span class=\"line\">      #flush.timeout: 0s</span><br><span class=\"line\"></span><br><span class=\"line\"># Sets the maximum number of CPUs that can be executing simultaneously. The</span><br><span class=\"line\"># default is the number of logical CPUs available in the system.</span><br><span class=\"line\">#max_procs:</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"参数说明\"><a href=\"#参数说明\" class=\"headerlink\" title=\"参数说明\"></a>参数说明</h4><p>1、name<br>默认是用服务器的主机名。该名称以agent.name字段而存在。</p>\n<p>2、tag<br>为采集的日志消息定义tag信息标识，用于接收端处理响应的逻辑。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tags: [&quot;web-service&quot;,&quot;info-file&quot;]</span><br></pre></td></tr></table></figure>\n<p>3、fields<br>定义额外的字段信息，定义的字段以KV形式出现。默认是在fields下。</p>\n<p>fields: {project: “credit”, env: “prod”}<br>1<br>如果设置了fields_under_root为true，那么自定义的KV 将作为根字段出现在发送的消息里。</p>\n<p>4、fields_under_root<br>自定义的字段是否作为根字段。 使用实例</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">fields_under_root: true</span><br><span class=\"line\">fields: &#123;project: &quot;credit&quot;, env: &quot;prod&quot;&#125;</span><br></pre></td></tr></table></figure>\n<p>5、processors<br>beat提供的数据预处理 功能，如果定义了多个processors ，那么beat将会顺序执行。 更多定义的processor</p>\n<p>6、max_procs<br>设置可以同时执行的最大CPU数。默认值为系统中可用的逻辑CPU的数量。</p>\n<h3 id=\"7、-Processors\"><a href=\"#7、-Processors\" class=\"headerlink\" title=\"7、 Processors\"></a>7、 Processors</h3><p>beat提供的数据预处理 功能，用于增强数据或者过滤数据。如果定义了多个processors ，那么beat将会顺序执行</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">event -&gt; processor 1 -&gt; event1 -&gt; processor 2 -&gt; event2 ...</span><br></pre></td></tr></table></figure>\n\n\n<p>1、add_cloud_metadata<br>添加云服务器实例元数据</p>\n<p>增加云服务器提供商的实例元数据来丰富每个事件。在启动时，它将查询托管提供程序的列表并缓存实例元数据。</p>\n<p>例如添加上这个配置</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">processors:</span><br><span class=\"line\">  - add_cloud_metadata: ~</span><br></pre></td></tr></table></figure>\n<p>在阿里云上输出为</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  &quot;cloud&quot;: &#123;</span><br><span class=\"line\">    &quot;availability_zone&quot;: &quot;cn-shenzhen&quot;,</span><br><span class=\"line\">    &quot;instance.id&quot;: &quot;i-wz9g2hqiikg0aliyun2b&quot;,</span><br><span class=\"line\">    &quot;provider&quot;: &quot;ecs&quot;,</span><br><span class=\"line\">    &quot;region&quot;: &quot;cn-shenzhen-a&quot;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>在腾讯云上输出为</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  &quot;cloud&quot;: &#123;</span><br><span class=\"line\">    &quot;availability_zone&quot;: &quot;gz-azone2&quot;,</span><br><span class=\"line\">    &quot;instance.id&quot;: &quot;ins-qcloudv5&quot;,</span><br><span class=\"line\">    &quot;provider&quot;: &quot;qcloud&quot;,</span><br><span class=\"line\">    &quot;region&quot;: &quot;china-south-gz&quot;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>在aws上输出为</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  &quot;cloud&quot;: &#123;</span><br><span class=\"line\">    &quot;account.id&quot;: &quot;123456789012&quot;,</span><br><span class=\"line\">    &quot;availability_zone&quot;: &quot;us-east-1c&quot;,</span><br><span class=\"line\">    &quot;instance.id&quot;: &quot;i-4e123456&quot;,</span><br><span class=\"line\">    &quot;machine.type&quot;: &quot;t2.medium&quot;,</span><br><span class=\"line\">    &quot;image.id&quot;: &quot;ami-abcd1234&quot;,</span><br><span class=\"line\">    &quot;provider&quot;: &quot;aws&quot;,</span><br><span class=\"line\">    &quot;region&quot;: &quot;us-east-1&quot;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>2、add_cloudfoundry_metadata<br>自动添加cloudfoundry应用程序的相关元数据</p>\n<p>该处理器使用来自cloudfoundry应用程序的相关元数据对每个事件进行增强。</p>\n<p>前提条件：只有当事件包含对CloudFoundry应用程序的引用（使用字段cloudfoundry.app.id)，并且配置了cloudfoundry客户端信息，才能能够检索应用程序的信息。</p>\n<p>配置示例：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">processors:</span><br><span class=\"line\">  - add_cloudfoundry_metadata:</span><br><span class=\"line\">      api_address: https:&#x2F;&#x2F;api.dev.cfdev.sh</span><br><span class=\"line\">      client_id: uaa-filebeat</span><br><span class=\"line\">      client_secret: verysecret</span><br><span class=\"line\">      ssl:</span><br><span class=\"line\">        verification_mode: none</span><br><span class=\"line\">      # To connect to Cloud Foundry over verified TLS you can specify a client and CA certificate.</span><br><span class=\"line\">      #ssl:</span><br><span class=\"line\">      #  certificate_authorities: [&quot;&#x2F;etc&#x2F;pki&#x2F;cf&#x2F;ca.pem&quot;]</span><br><span class=\"line\">      #  certificate:              &quot;&#x2F;etc&#x2F;pki&#x2F;cf&#x2F;cert.pem&quot;</span><br><span class=\"line\">      #  key:                      &quot;&#x2F;etc&#x2F;pki&#x2F;cf&#x2F;cert.key&quot;</span><br></pre></td></tr></table></figure>\n\n\n<p>3、add_docker_metadata<br>自动添加docker容器相关元数据</p>\n<p>filebeat在启动时，它检测一个docker环境元数据并缓存。只有在检测到有效配置并且处理器能够访问Docker API时，才会使用Docker元数据对事件数据进行追加。 目前在k8s场景下 一般使用log-pilot来协助采集日志。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">processors:</span><br><span class=\"line\">  - add_docker_metadata:</span><br><span class=\"line\">      host: &quot;unix:&#x2F;&#x2F;&#x2F;var&#x2F;run&#x2F;docker.sock&quot;</span><br><span class=\"line\">      #match_fields: [&quot;system.process.cgroup.id&quot;]</span><br><span class=\"line\">      #match_pids: [&quot;process.pid&quot;, &quot;process.ppid&quot;]</span><br><span class=\"line\">      #match_source: true</span><br><span class=\"line\">      #match_source_index: 4</span><br><span class=\"line\">      #match_short_id: true</span><br><span class=\"line\">      #cleanup_timeout: 60</span><br><span class=\"line\">      #labels.dedot: false</span><br><span class=\"line\">      # To connect to Docker over TLS you must specify a client and CA certificate.</span><br><span class=\"line\">      #ssl:</span><br><span class=\"line\">      #  certificate_authority: &quot;&#x2F;etc&#x2F;pki&#x2F;root&#x2F;ca.pem&quot;</span><br><span class=\"line\">      #  certificate:           &quot;&#x2F;etc&#x2F;pki&#x2F;client&#x2F;cert.pem&quot;</span><br><span class=\"line\">      #  key:                   &quot;&#x2F;etc&#x2F;pki&#x2F;client&#x2F;cert.key&quot;</span><br></pre></td></tr></table></figure>\n\n<p>4、add_fields</p>\n<p>添加自定义字段信息</p>\n<p>添加字段信息（同这里用法类似），配置如下</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">processors:</span><br><span class=\"line\">  - add_fields:</span><br><span class=\"line\">      #  如果不指定，默认添加到 fields 里 </span><br><span class=\"line\">      target: project</span><br><span class=\"line\">      fields:</span><br><span class=\"line\">        name: myproject</span><br><span class=\"line\">        id: &#39;574734885120952459&#39;</span><br></pre></td></tr></table></figure>\n<p>输出为：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  &quot;project&quot;: &#123;</span><br><span class=\"line\">    &quot;name&quot;: &quot;myproject&quot;,</span><br><span class=\"line\">    &quot;id&quot;: &quot;574734885120952459&quot;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>5、add_host_metadata</p>\n<p>自动追加host相关信息，配置如下</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">processors:</span><br><span class=\"line\">  - add_host_metadata:</span><br><span class=\"line\">      cache.ttl: 5m</span><br><span class=\"line\">      geo:</span><br><span class=\"line\">        name: nyc-dc1-rack1</span><br><span class=\"line\">        location: 40.7128, -74.0060</span><br><span class=\"line\">        continent_name: North America</span><br><span class=\"line\">        country_iso_code: US</span><br><span class=\"line\">        region_name: New York</span><br><span class=\"line\">        region_iso_code: NY</span><br><span class=\"line\">        city_name: New York</span><br></pre></td></tr></table></figure>\n<p>结果为</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">   &quot;host&quot;:&#123;</span><br><span class=\"line\">      &quot;architecture&quot;:&quot;x86_64&quot;,</span><br><span class=\"line\">      &quot;name&quot;:&quot;example-host&quot;,</span><br><span class=\"line\">      &quot;id&quot;:&quot;&quot;,</span><br><span class=\"line\">      &quot;os&quot;:&#123;</span><br><span class=\"line\">         &quot;family&quot;:&quot;darwin&quot;,</span><br><span class=\"line\">         &quot;build&quot;:&quot;16G1212&quot;,</span><br><span class=\"line\">         &quot;platform&quot;:&quot;darwin&quot;,</span><br><span class=\"line\">         &quot;version&quot;:&quot;10.12.6&quot;,</span><br><span class=\"line\">         &quot;kernel&quot;:&quot;16.7.0&quot;,</span><br><span class=\"line\">         &quot;name&quot;:&quot;Mac OS X&quot;</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      &quot;ip&quot;: [&quot;192.168.0.1&quot;, &quot;10.0.0.1&quot;],</span><br><span class=\"line\">      &quot;mac&quot;: [&quot;00:25:96:12:34:56&quot;, &quot;72:00:06:ff:79:f1&quot;],</span><br><span class=\"line\">      &quot;geo&quot;: &#123;</span><br><span class=\"line\">          &quot;continent_name&quot;: &quot;North America&quot;,</span><br><span class=\"line\">          &quot;country_iso_code&quot;: &quot;US&quot;,</span><br><span class=\"line\">          &quot;region_name&quot;: &quot;New York&quot;,</span><br><span class=\"line\">          &quot;region_iso_code&quot;: &quot;NY&quot;,</span><br><span class=\"line\">          &quot;city_name&quot;: &quot;New York&quot;,</span><br><span class=\"line\">          &quot;name&quot;: &quot;nyc-dc1-rack1&quot;,</span><br><span class=\"line\">          &quot;location&quot;: &quot;40.7128, -74.0060&quot;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n<p>6、add_id</p>\n<p>根据envet生成唯一的ID</p>\n<p>自动追加 根据envet生成唯一的ID</p>\n<p>配置如下：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">processors:</span><br><span class=\"line\">  - add_id: ~</span><br></pre></td></tr></table></figure>\n<p>输出为：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&quot;@metadata&quot;: &#123;                                                                                                                     </span><br><span class=\"line\">    &quot;beat&quot;: &quot;filebeat&quot;,                                                                                                              </span><br><span class=\"line\">    &quot;type&quot;: &quot;_doc&quot;,                                                                                                                  </span><br><span class=\"line\">    &quot;version&quot;: &quot;7.7.0&quot;,                                                                                                              </span><br><span class=\"line\">    &quot;_id&quot;: &quot;jfXPVHQB95_6f7tCZ5hg&quot;                                                                                                    </span><br><span class=\"line\">&#125;,</span><br></pre></td></tr></table></figure>\n\n<p>7、add_kubernetes_metadata<br>该处理器使用相关元数据对每个事件进行注释，基于kubernetes pod生成事件的元数据。在启动时，它会检测到集群内的环境并缓存Kubernetes相关的元数据。只有在检测到有效配置时才会对事件进行注释。如果它不能检测到有效的Kubernetes配置，那么事件不会用Kubernetes相关的元数据进行注释。<br>添加的注释有Pod Name 、Pod UID、Namespace、Labels</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">processors:</span><br><span class=\"line\">  - add_kubernetes_metadata: ~</span><br></pre></td></tr></table></figure>\n\n<p>8、add_labels</p>\n<p>添加自定义标签，类似add_fileds功能 ，添加的kv输出后默认在labels字段下</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">processors:</span><br><span class=\"line\">  - add_labels:</span><br><span class=\"line\">      labels:</span><br><span class=\"line\">        number: 1</span><br><span class=\"line\">        with.dots: test</span><br><span class=\"line\">        nested:</span><br><span class=\"line\">          with.dots: nested</span><br><span class=\"line\">        array:</span><br><span class=\"line\">          - do</span><br><span class=\"line\">          - re</span><br><span class=\"line\">          - with.field: mi</span><br></pre></td></tr></table></figure>\n<p>输出：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  &quot;labels&quot;: &#123;</span><br><span class=\"line\">    &quot;number&quot;: 1,</span><br><span class=\"line\">    &quot;with.dots&quot;: &quot;test&quot;,</span><br><span class=\"line\">    &quot;nested.with.dots&quot;: &quot;nested&quot;,</span><br><span class=\"line\">    &quot;array.0&quot;: &quot;do&quot;,</span><br><span class=\"line\">    &quot;array.1&quot;: &quot;re&quot;,</span><br><span class=\"line\">    &quot;array.2.with.field&quot;: &quot;mi&quot;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>9、add_locale<br>自动添加时区信息，常用语国际业务中。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">processors:</span><br><span class=\"line\">  - add_locale: ~</span><br></pre></td></tr></table></figure>\n<p>下面的意思是 使用缩写模式 ， 例如国内输出结果为CST</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">processors:</span><br><span class=\"line\">  - add_locale:</span><br><span class=\"line\">      format: abbreviation</span><br></pre></td></tr></table></figure>\n<p>10、add_observer_metadata<br>自动添加观察者机器的相关元数据</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">processors:</span><br><span class=\"line\">  - add_observer_metadata:</span><br><span class=\"line\">      cache.ttl: 5m</span><br></pre></td></tr></table></figure>\n<p>输出为：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  &quot;observer&quot; : &#123;</span><br><span class=\"line\">    &quot;hostname&quot; : &quot;avce&quot;,</span><br><span class=\"line\">    &quot;type&quot; : &quot;heartbeat&quot;,</span><br><span class=\"line\">    &quot;vendor&quot; : &quot;elastic&quot;,</span><br><span class=\"line\">    &quot;ip&quot; : [</span><br><span class=\"line\">      &quot;192.168.1.251&quot;,</span><br><span class=\"line\">      &quot;fe80::64b2:c3ff:fe5b:b974&quot;,</span><br><span class=\"line\">    ],</span><br><span class=\"line\">    &quot;mac&quot; : [</span><br><span class=\"line\">      &quot;dc:c1:02:6f:1b:ed&quot;,</span><br><span class=\"line\">    ]</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>11、add_tags<br>添加标签，并可指定标签在哪个字段下。</p>\n<p>例如：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">processors:</span><br><span class=\"line\">  - add_tags:</span><br><span class=\"line\">      tags: [web, production]</span><br><span class=\"line\">      target: &quot;environment&quot;</span><br></pre></td></tr></table></figure>\n<p>输出为：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  &quot;environment&quot;: [&quot;web&quot;, &quot;production&quot;]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>12、convert<br>将event中的某个字段转换为其他类型，例如将字符串转换为整数。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">processors:</span><br><span class=\"line\">  - convert:</span><br><span class=\"line\">      fields:</span><br><span class=\"line\">        - &#123;from: &quot;src_ip&quot;, to: &quot;source.ip&quot;, type: &quot;ip&quot;&#125;</span><br><span class=\"line\">        - &#123;from: &quot;src_port&quot;, to: &quot;source.port&quot;, type: &quot;integer&quot;&#125;</span><br><span class=\"line\">      ignore_missing: true</span><br><span class=\"line\">      fail_on_error: false</span><br></pre></td></tr></table></figure>\n<p>13、copy_fields<br>将event中的某个字段的值赋值给另一个字段</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">processors:</span><br><span class=\"line\">  - copy_fields:</span><br><span class=\"line\">      fields:</span><br><span class=\"line\">        - from: message</span><br><span class=\"line\">          to: event.original</span><br><span class=\"line\">      fail_on_error: false</span><br><span class=\"line\">      ignore_missing: true</span><br></pre></td></tr></table></figure>\n<p>输出：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  &quot;message&quot;: &quot;my-interesting-message&quot;,</span><br><span class=\"line\">  &quot;event&quot;: &#123;</span><br><span class=\"line\">      &quot;original&quot;: &quot;my-interesting-message&quot;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>14、decode_base64_field<br>base64解码，从一个字段里获取值，解码后赋值给另一个字段。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">processors:</span><br><span class=\"line\">  - decode_base64_field:</span><br><span class=\"line\">      field:</span><br><span class=\"line\">        from: &quot;message&quot;</span><br><span class=\"line\">        to: &quot;decode&quot;</span><br><span class=\"line\">      ignore_missing: true</span><br><span class=\"line\">      fail_on_error: false</span><br></pre></td></tr></table></figure>\n<p>15、decode_cef<br>如果你的日式符合Common Event Format (CEF) 标准，你可以使用它进行解码：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">processors:</span><br><span class=\"line\">  - rename:</span><br><span class=\"line\">      fields:</span><br><span class=\"line\">        - &#123;from: &quot;message&quot;, to: &quot;event.original&quot;&#125;</span><br><span class=\"line\">  - decode_cef:</span><br><span class=\"line\">      field: event.original</span><br></pre></td></tr></table></figure>\n<p>更多关于cef的介绍</p>\n<p>16、decode_csv_fields<br>解析CSF格式的日志到指定字段，内容为数组。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">processors:</span><br><span class=\"line\">  - decode_csv_fields:</span><br><span class=\"line\">     # 解析到哪里</span><br><span class=\"line\">      fields:</span><br><span class=\"line\">        message: decoded.csv</span><br><span class=\"line\">      separator: &quot;,&quot;</span><br><span class=\"line\">      ignore_missing: false</span><br><span class=\"line\">      overwrite_keys: true</span><br><span class=\"line\">      trim_leading_space: false</span><br><span class=\"line\">      fail_on_error: true</span><br></pre></td></tr></table></figure>\n<p>17、decode_json_fields<br>处理对包含JSON字符串的字段进行解码，并将字符串替换为有效的JSON对象。默认是在当前字段替换。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">processors:</span><br><span class=\"line\">  - decode_json_fields:</span><br><span class=\"line\">      fields: [&quot;field1&quot;, &quot;field2&quot;, ...]</span><br><span class=\"line\">     # process_array: false</span><br><span class=\"line\">      # max_depth: 1</span><br><span class=\"line\">     # overwrite_keys: false</span><br><span class=\"line\">     # add_error_key: true</span><br></pre></td></tr></table></figure>\n<p>18、decompress_gzip_field<br>gzip解压缩，从一个字段值中加压缩到另一个字段中 。 使用场景少。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">processors:</span><br><span class=\"line\">  - decompress_gzip_field:</span><br><span class=\"line\">      field:</span><br><span class=\"line\">        from: &quot;field1&quot;</span><br><span class=\"line\">        to: &quot;field2&quot;</span><br><span class=\"line\">      ignore_missing: false</span><br><span class=\"line\">      fail_on_error: true</span><br></pre></td></tr></table></figure>\n<p>感兴趣的可以看下 gzip压缩初探</p>\n<p>19、dissect<br>从某个字段里（默认message）取值，按照tokenizer定义的格式 拆分（切割）数据，并输出到target_prefix 字段里，默认是dissect</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">processors:</span><br><span class=\"line\">  - dissect:</span><br><span class=\"line\">      tokenizer: &quot;%&#123;key1&#125; %&#123;key2&#125;&quot;</span><br><span class=\"line\">      # field: &quot;message&quot;</span><br><span class=\"line\">     # target_prefix: &quot;dissect&quot;</span><br></pre></td></tr></table></figure>\n<p>如果是这样的log”App01 - WebServer is up and running” ，输出为</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&quot;service&quot;: &#123;</span><br><span class=\"line\">  &quot;name&quot;: &quot;App01&quot;,</span><br><span class=\"line\">  &quot;status&quot;: &quot;WebServer is up and running&quot;</span><br><span class=\"line\">&#125;,</span><br></pre></td></tr></table></figure>\n<p>20、dns<br>反向解析 根据id查找hostname 。每个processor有自己查询结果的缓存。该processor使用自己的域名服务器，不会查找/etc/hosts ，默认使用/etc/resolv.conf里面的域名服务器。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">processors:</span><br><span class=\"line\">  - dns:</span><br><span class=\"line\">      type: reverse</span><br><span class=\"line\">      fields:</span><br><span class=\"line\">        source.ip: source.hostname</span><br><span class=\"line\">        destination.ip: destination.hostname</span><br></pre></td></tr></table></figure>\n<p>fields字段里source.ip是指ip所在的字段，source.hostname是指新值存入的字段。</p>\n<p>21、drop_event<br>丢弃该event，一般要设置特定条件 。</p>\n<p>例如 http响应码为200 就不上报event：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">processors:</span><br><span class=\"line\">  - drop_event:</span><br><span class=\"line\">      when:</span><br><span class=\"line\">        equals:</span><br><span class=\"line\">          http.code: 200</span><br></pre></td></tr></table></figure>\n\n<p>22、drop_fields<br>丢弃（过滤掉）特定字段， 一般防止敏感信息上报，例如ip 、mac地址…</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">processors:</span><br><span class=\"line\">  - drop_fields:</span><br><span class=\"line\">      fields: [&quot;cpu.user&quot;, &quot;cpu.system&quot;]</span><br></pre></td></tr></table></figure>\n<p>23、extract_array</p>\n<p>从数组中取值并填充（映射到）指定字段</p>\n<p>配置示例：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- add_tags:</span><br><span class=\"line\">    tags: [&quot;127.0.0.1&quot;, &quot;114.114.114.114&quot;,&quot;8080&quot;]</span><br><span class=\"line\">    target: &quot;my_array&quot;</span><br><span class=\"line\">- extract_array:</span><br><span class=\"line\">    field: my_array</span><br><span class=\"line\">    mappings:</span><br><span class=\"line\">      source.ip: 0</span><br><span class=\"line\">      source.destination.ip: 1</span><br><span class=\"line\">      source.network.transport: 2</span><br><span class=\"line\">    fail_on_error: true</span><br><span class=\"line\">    ignore_missing: false</span><br></pre></td></tr></table></figure>\n\n\n<p>24、fingerprint</p>\n<p>根据事件指定字段字段值生成事件的指纹。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">processors:</span><br><span class=\"line\">  - fingerprint:</span><br><span class=\"line\">      fields: [&quot;field1&quot;, &quot;field2&quot;, ...]</span><br></pre></td></tr></table></figure>\n\n<p>25、include_fields</p>\n<p>输出的event里 会包含哪些字段值。@timestamp和type字段会始终出现在event中，即使未在include_fields列表中定义。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">processors:</span><br><span class=\"line\">  - include_fields:</span><br><span class=\"line\">      when:</span><br><span class=\"line\">        condition</span><br><span class=\"line\">      fields: [&quot;field1&quot;, &quot;field2&quot;, ...]</span><br></pre></td></tr></table></figure>\n<p>26、registered_domain<br>域名注册，识别一个长串域名，转化成一个简短域名 。</p>\n<p>比如我有一条日志：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">https:&#x2F;&#x2F;www.netcn.console.aliyun.com&#x2F;</span><br></pre></td></tr></table></figure>\n<p>filebeat配置：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">processors:</span><br><span class=\"line\">  - registered_domain:</span><br><span class=\"line\">      field: message</span><br><span class=\"line\">      target_field: result.registered_domain</span><br><span class=\"line\">      ignore_missing: true</span><br><span class=\"line\">      ignore_failure: true</span><br></pre></td></tr></table></figure>\n<p>输出为</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&quot;result&quot;: &#123;</span><br><span class=\"line\">  &quot;registered_domain&quot;: &quot;aliyun.com&#x2F;&quot;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>27、rename</p>\n<p>重命名字段</p>\n<p>示例： 把host重命名为hostRename</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">processors:</span><br><span class=\"line\">  - rename:</span><br><span class=\"line\">      fields:</span><br><span class=\"line\">        - from: &quot;host&quot;</span><br><span class=\"line\">          to: &quot;hostRename&quot;</span><br><span class=\"line\">      ignore_missing: false</span><br><span class=\"line\">      fail_on_error: true</span><br></pre></td></tr></table></figure>\n\n<p>28、script</p>\n<p>使用Javascript 处理event ，可以更加灵活的预处理业务</p>\n<p>29、timestamp</p>\n<p>从字段解析时间戳并将解析结果写入@timestamp（日志采集时间）字段</p>\n<p>从某个字段解析时间戳，并将解析结果写入@timestamp中，可以自定义日志采集时间。</p>\n<p>配置如下：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">processors:</span><br><span class=\"line\">   timestamp:</span><br><span class=\"line\">      field: start_time</span><br><span class=\"line\">      layouts:</span><br><span class=\"line\">        - &#39;2006-01-02T15:04:05Z&#39;</span><br><span class=\"line\">        - &#39;2006-01-02T15:04:05.999Z&#39;</span><br><span class=\"line\">      test:</span><br><span class=\"line\">        - &#39;2019-06-22T16:33:51Z&#39;</span><br><span class=\"line\">        - &#39;2019-11-18T04:59:51.123Z&#39;</span><br><span class=\"line\">   drop_fields:</span><br><span class=\"line\">      fields: [start_time]</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">layouts 是时间格式，用于格式化start_time里的时间，这个是go语言的时间格式。 类似java中的yyyy-MM-dd HH:mm:ss 。</span><br><span class=\"line\">test 是在filebeat启动时 验证layouts的格式能否格式化 测试时间。</span><br></pre></td></tr></table></figure>\n\n\n<p>30、translate_sid<br>将Windows安全标识符（SID）转换为帐户名，使用仅限Windows系统。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">processors:</span><br><span class=\"line\">  - translate_sid:</span><br><span class=\"line\">      field: winlog.event_data.MemberSid</span><br><span class=\"line\">      account_name_target: user.name</span><br><span class=\"line\">      domain_target: user.domain</span><br><span class=\"line\">      ignore_missing: true</span><br><span class=\"line\">      ignore_failure: true</span><br></pre></td></tr></table></figure>\n<p>31、translate_sid<br>按照指定大小截取字段值</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">processors:</span><br><span class=\"line\">  - truncate_fields:</span><br><span class=\"line\">    fields:</span><br><span class=\"line\">    - message</span><br><span class=\"line\">    max_characters: 5</span><br><span class=\"line\">    #max_bytes: 128</span><br><span class=\"line\">    fail_on_error: false</span><br><span class=\"line\">    ignore_missing: true</span><br></pre></td></tr></table></figure>\n<p>32、urldecode<br>url 解码</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">processors:</span><br><span class=\"line\">  - urldecode:</span><br><span class=\"line\">      fields:</span><br><span class=\"line\">        - from: &quot;field1&quot;</span><br><span class=\"line\">          to: &quot;field2&quot;</span><br><span class=\"line\">      #  - from: &quot;fieldx&quot;</span><br><span class=\"line\">       #  to: &quot;fieldy&quot;</span><br><span class=\"line\">      ignore_missing: false</span><br><span class=\"line\">      fail_on_error: true</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Outputs\"><a href=\"#Outputs\" class=\"headerlink\" title=\"Outputs\"></a>Outputs</h3><p>Elasticsearch</p>\n<p>常规配置</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">output.elasticsearch:</span><br><span class=\"line\">  hosts: [&quot;https:&#x2F;&#x2F;es.bingmaning:9200&quot;]</span><br><span class=\"line\">  username: &quot;bingmaning&quot;</span><br><span class=\"line\">  password: &quot;lingshui2008@qq.com&quot;</span><br><span class=\"line\">  index: &quot;%&#123;[fields.log_type]&#125;-%&#123;[agent.version]&#125;-%&#123;+yyyy.MM.dd&#125;&quot;</span><br></pre></td></tr></table></figure>\n<p>更多配置</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">output.elasticsearch:</span><br><span class=\"line\">  # Boolean flag to enable or disable the output module.</span><br><span class=\"line\">  #enabled: true</span><br><span class=\"line\"></span><br><span class=\"line\">  #es地址</span><br><span class=\"line\">  hosts: [&quot;https:&#x2F;&#x2F;es.bingmaning:9200&quot;]</span><br><span class=\"line\"></span><br><span class=\"line\">  # 设置压缩级别</span><br><span class=\"line\">  compression_level: 0</span><br><span class=\"line\"></span><br><span class=\"line\">  # 是否转义html符号</span><br><span class=\"line\">  escape_html: false</span><br><span class=\"line\"></span><br><span class=\"line\">  # 协议，默认http</span><br><span class=\"line\">  protocol: &quot;https&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">  # 认证方式一</span><br><span class=\"line\">  api_key: &quot;id:api_key&quot;</span><br><span class=\"line\">  # 认证方式二</span><br><span class=\"line\">  username: &quot;elastic&quot;</span><br><span class=\"line\">  password: &quot;changeme&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">  # 通过索引操作在URL中传递的HTTP参数字典</span><br><span class=\"line\">  parameters:</span><br><span class=\"line\">    #param1: value1</span><br><span class=\"line\">    #param2: value2</span><br><span class=\"line\"></span><br><span class=\"line\">  # 每个Elasticsearch主机worker数量。  </span><br><span class=\"line\">  worker: 1</span><br><span class=\"line\"></span><br><span class=\"line\">  #默认索引 filebeat-YYYY.MM.DD  。 可自定义</span><br><span class=\"line\">  index: &quot;filebeat-%&#123;[agent.version]&#125;-%&#123;+yyyy.MM.dd&#125;&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">  # 自定义 pipeline</span><br><span class=\"line\">  pipeline: &quot;&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">  # 默认http路径</span><br><span class=\"line\">  path: &quot;&#x2F;elasticsearch&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">  # 自定义http header</span><br><span class=\"line\">  headers:</span><br><span class=\"line\">    X-My-Header: Contents of the header</span><br><span class=\"line\"></span><br><span class=\"line\">  # 代理地址</span><br><span class=\"line\">  proxy_url: http:&#x2F;&#x2F;proxy:3128</span><br><span class=\"line\"></span><br><span class=\"line\">  # 是否禁用代理 默认false</span><br><span class=\"line\">  proxy_disable: false</span><br><span class=\"line\"></span><br><span class=\"line\">  # 尝试特定Elasticsearch索引操作的次数。如果多次重试后，索引操作未成功，事件被丢弃。默认为3。</span><br><span class=\"line\">  max_retries: 3</span><br><span class=\"line\"></span><br><span class=\"line\">  # 单个Elasticsearch批量API索引请求中要批量处理的最大事件数</span><br><span class=\"line\">  # The default is 50.</span><br><span class=\"line\">  bulk_max_size: 50</span><br><span class=\"line\"></span><br><span class=\"line\">  # 重连 初始等待时间，如果失败会指数值增长。</span><br><span class=\"line\">  backoff.init: 1s</span><br><span class=\"line\"></span><br><span class=\"line\">  # 最大等待重连时间。默认60秒</span><br><span class=\"line\">  backoff.max: 60s</span><br><span class=\"line\"></span><br><span class=\"line\">  # 请求超时时间</span><br><span class=\"line\">  timeout: 90</span><br><span class=\"line\"></span><br><span class=\"line\">  # 使用ssl？</span><br><span class=\"line\">  ssl.enabled: true</span><br><span class=\"line\"></span><br><span class=\"line\">  # ssl认证方式，默认为full。 测试时 可以使用 none</span><br><span class=\"line\">  ssl.verification_mode: full</span><br><span class=\"line\"></span><br><span class=\"line\">  #可用 tls 版本</span><br><span class=\"line\">  ssl.supported_protocols: [TLSv1.1, TLSv1.2, TLSv1.3]</span><br><span class=\"line\"></span><br><span class=\"line\">  # 根证书地址</span><br><span class=\"line\">  ssl.certificate_authorities: [&quot;&#x2F;etc&#x2F;pki&#x2F;root&#x2F;ca.pem&quot;]</span><br><span class=\"line\"></span><br><span class=\"line\">  # 客户端证书</span><br><span class=\"line\">  ssl.certificate: &quot;&#x2F;etc&#x2F;pki&#x2F;client&#x2F;cert.pem&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">  # 客户端密钥</span><br><span class=\"line\">  ssl.key: &quot;&#x2F;etc&#x2F;pki&#x2F;client&#x2F;cert.key&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">  # 密码短语</span><br><span class=\"line\">  ssl.key_passphrase: &#39;&#39;</span><br><span class=\"line\"></span><br><span class=\"line\">  # 配置密码套件以用于SSL连接</span><br><span class=\"line\">  ssl.cipher_suites: []</span><br><span class=\"line\"></span><br><span class=\"line\">  # 为基于ECDHE的密码套件配置曲线类型</span><br><span class=\"line\">  ssl.curve_types: []</span><br><span class=\"line\"></span><br><span class=\"line\">  # 配置支持哪些类型的重新协商。有效选项是 </span><br><span class=\"line\">  # never, once, and freely. 默认是 never.</span><br><span class=\"line\">  ssl.renegotiation: never</span><br><span class=\"line\"></span><br><span class=\"line\">  # 配置一个可用于对已验证证书链进行额外验证的pin， 这可以确保使用特定证书来验证信任链。</span><br><span class=\"line\">  # 该pin是SHA-256指纹的base64编码字符串。.</span><br><span class=\"line\">  ssl.ca_sha256: &quot;&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">  # 是否支持 Kerberos </span><br><span class=\"line\">  kerberos.enabled: true</span><br><span class=\"line\"></span><br><span class=\"line\">  # Kerberos认证类型： keytab, password.</span><br><span class=\"line\">  kerberos.auth_type: password</span><br><span class=\"line\"></span><br><span class=\"line\">  # 密钥表文件的路径。当auth_type设置为keytab时使用。</span><br><span class=\"line\">  kerberos.keytab: &#x2F;etc&#x2F;elastic.keytab</span><br><span class=\"line\"></span><br><span class=\"line\">  #  Kerberos configuration.</span><br><span class=\"line\">  kerberos.config_path: &#x2F;etc&#x2F;krb5.conf</span><br><span class=\"line\"></span><br><span class=\"line\">  # Name of the Kerberos user.</span><br><span class=\"line\">  kerberos.username: elastic</span><br><span class=\"line\"></span><br><span class=\"line\">  # Kerberos用户的密码。当auth_type设置为password时使用。</span><br><span class=\"line\">  kerberos.password: changeme</span><br><span class=\"line\"></span><br><span class=\"line\">  # Kerberos realm.</span><br><span class=\"line\">  kerberos.realm: ELASTIC</span><br></pre></td></tr></table></figure>\n\n<p>logstash</p>\n<p>常规配置<br>1、filebeat.yml中配置如下：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">output.logstash:</span><br><span class=\"line\">  hosts: [&quot;localhost:5044&quot;, &quot;localhost:5045&quot;]</span><br><span class=\"line\">  # 开这个参数 需要多个hosts</span><br><span class=\"line\">  loadbalance: true</span><br></pre></td></tr></table></figure>\n\n<p>2、logstash-pipeline.conf中配置如下：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">input &#123;</span><br><span class=\"line\">  beats &#123;</span><br><span class=\"line\">    port &#x3D;&gt; 5044</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">filter&#123;</span><br><span class=\"line\">&#x2F;&#x2F; 数据的各种处理  </span><br><span class=\"line\">....</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">output &#123;</span><br><span class=\"line\">  elasticsearch &#123;</span><br><span class=\"line\">    hosts &#x3D;&gt; [&quot;http:&#x2F;&#x2F;localhost:9200&quot;]</span><br><span class=\"line\">    #  @metadata 解释如下</span><br><span class=\"line\">    index &#x3D;&gt; &quot;%&#123;[@metadata][beat]&#125;-%&#123;[@metadata][version]&#125;-%&#123;+YYYY.MM.dd&#125;&quot; </span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>filebeat详细配置</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">output.logstash:</span><br><span class=\"line\"></span><br><span class=\"line\">  enabled: true</span><br><span class=\"line\">  </span><br><span class=\"line\">  hosts: [&quot;localhost:5044&quot;]</span><br><span class=\"line\"></span><br><span class=\"line\">  # 每个logstash worker数量。  </span><br><span class=\"line\">  worker: 1</span><br><span class=\"line\"></span><br><span class=\"line\">  # 压缩级别</span><br><span class=\"line\">  compression_level: 3</span><br><span class=\"line\"></span><br><span class=\"line\">  # 是否转义html符号</span><br><span class=\"line\">  escape_html: false</span><br><span class=\"line\"></span><br><span class=\"line\">  #最大链接时间 。 0 代表不启用此功能</span><br><span class=\"line\">  # 不支持async connections</span><br><span class=\"line\">  ttl: 30s</span><br><span class=\"line\"></span><br><span class=\"line\">  # 是否需要负载均衡</span><br><span class=\"line\">  loadbalance: false</span><br><span class=\"line\"></span><br><span class=\"line\">  # 处理时异步发送到Logstash的批次数</span><br><span class=\"line\">  pipelining: 2</span><br><span class=\"line\"></span><br><span class=\"line\">  # 如果启用，在没有没有遇到错误的情况下，则每次仅传输一批事件中的一部分事件 ，直到要发送的事件数量增加到&#96;bulk_max_size&#96;</span><br><span class=\"line\">  slow_start: false</span><br><span class=\"line\"></span><br><span class=\"line\">  # 重连时间策略 </span><br><span class=\"line\">  backoff.init: 1s</span><br><span class=\"line\">  backoff.max: 60s</span><br><span class=\"line\"></span><br><span class=\"line\">  # 默认索引 一般都会重写</span><br><span class=\"line\">  index: &#39;filebeat&#39;</span><br><span class=\"line\"></span><br><span class=\"line\">  # SOCKS5 proxy server URL</span><br><span class=\"line\">  proxy_url: socks5:&#x2F;&#x2F;user:password@socks5-server:2233</span><br><span class=\"line\"></span><br><span class=\"line\">  # 是否启用本地解析器</span><br><span class=\"line\">  proxy_use_local_resolver: false</span><br><span class=\"line\"></span><br><span class=\"line\"> # 使用ssl？</span><br><span class=\"line\">  ssl.enabled: true</span><br><span class=\"line\"></span><br><span class=\"line\">  # ssl认证方式，默认为full。 测试时 可以使用 none</span><br><span class=\"line\">  ssl.verification_mode: full</span><br><span class=\"line\"></span><br><span class=\"line\">  #可用 tls 版本</span><br><span class=\"line\">  ssl.supported_protocols: [TLSv1.1, TLSv1.2, TLSv1.3]</span><br><span class=\"line\"></span><br><span class=\"line\">  # 根证书地址</span><br><span class=\"line\">  ssl.certificate_authorities: [&quot;&#x2F;etc&#x2F;pki&#x2F;root&#x2F;ca.pem&quot;]</span><br><span class=\"line\"></span><br><span class=\"line\">  # 客户端证书</span><br><span class=\"line\">  ssl.certificate: &quot;&#x2F;etc&#x2F;pki&#x2F;client&#x2F;cert.pem&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">  # 客户端密钥</span><br><span class=\"line\">  ssl.key: &quot;&#x2F;etc&#x2F;pki&#x2F;client&#x2F;cert.key&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">  # 密码短语</span><br><span class=\"line\">  ssl.key_passphrase: &#39;&#39;</span><br><span class=\"line\"></span><br><span class=\"line\">  # 配置密码套件以用于SSL连接</span><br><span class=\"line\">  ssl.cipher_suites: []</span><br><span class=\"line\"></span><br><span class=\"line\">  # 为基于ECDHE的密码套件配置曲线类型</span><br><span class=\"line\">  ssl.curve_types: []</span><br><span class=\"line\"></span><br><span class=\"line\">  # 配置支持哪些类型的重新协商。有效选项是 </span><br><span class=\"line\">  # never, once, and freely. 默认是 never.</span><br><span class=\"line\">  ssl.renegotiation: never</span><br><span class=\"line\"></span><br><span class=\"line\">  # 配置一个可用于对已验证证书链进行额外验证的pin， 这可以确保使用特定证书来验证信任链。</span><br><span class=\"line\">  # 该pin是SHA-256指纹的base64编码字符串。.</span><br><span class=\"line\">  ssl.ca_sha256: &quot;&quot;</span><br><span class=\"line\">  </span><br><span class=\"line\">  # 尝试特定Elasticsearch索引操作的次数。如果多次重试后，索引操作未成功，事件被丢弃。默认为3。</span><br><span class=\"line\">  max_retries: 3</span><br><span class=\"line\">  # 单个Logstash request 最大event数量 default is 2048.</span><br><span class=\"line\">  bulk_max_size: 2048</span><br><span class=\"line\"></span><br><span class=\"line\">  # 等待Logstash server响应最大超时时间。默认是 30s.</span><br><span class=\"line\">  timeout: 30s</span><br></pre></td></tr></table></figure>\n\n\n<p>redis<br>Redis输出将event插入Redis列表或Redis通道。该输出插件与Logstash的Redis输入插件兼容。</p>\n<p>常规配置</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 采集配置</span><br><span class=\"line\">filebeat.inputs:     #收集日志</span><br><span class=\"line\">- type: log         #类型</span><br><span class=\"line\">  enabled: true     #始终收集</span><br><span class=\"line\">  paths:</span><br><span class=\"line\">    - &#x2F;etc&#x2F;log&#x2F;*.log    </span><br><span class=\"line\"># 输出配置</span><br><span class=\"line\">output.redis:        </span><br><span class=\"line\">  hosts: [&quot;127.0.0.1:6379&quot;]  #输出在redis里</span><br><span class=\"line\">  password: &quot;123456&quot;   #redis认证密码，我没有</span><br><span class=\"line\">  key: &quot;filebeat7.7&quot;       #日志redis的key值</span><br><span class=\"line\">  db: 0                 #redis数据库0</span><br><span class=\"line\">  timeout: 5             #redis链接超时  默认5s</span><br></pre></td></tr></table></figure>\n\n<p>所有可配置参数</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">output.redis:</span><br><span class=\"line\">  # Boolean flag to enable or disable the output module.</span><br><span class=\"line\">  enabled: true</span><br><span class=\"line\"></span><br><span class=\"line\">  # Configure JSON encoding</span><br><span class=\"line\">  codec.json:</span><br><span class=\"line\">    # Pretty print json event</span><br><span class=\"line\">    pretty: false</span><br><span class=\"line\"></span><br><span class=\"line\">    # Configure escaping HTML symbols in strings.</span><br><span class=\"line\">    escape_html: false</span><br><span class=\"line\"></span><br><span class=\"line\">  # The list of Redis servers to connect to. If load-balancing is enabled, the</span><br><span class=\"line\">  # events are distributed to the servers in the list. If one server becomes</span><br><span class=\"line\">  # unreachable, the events are distributed to the reachable servers only.</span><br><span class=\"line\">  # The hosts setting supports redis and rediss urls with custom password like</span><br><span class=\"line\">  # redis:&#x2F;&#x2F;:password@localhost:6379.</span><br><span class=\"line\">  hosts: [&quot;localhost:6379&quot;]</span><br><span class=\"line\"></span><br><span class=\"line\">  # The name of the Redis list or channel the events are published to. The</span><br><span class=\"line\">  # default is filebeat.</span><br><span class=\"line\">  key: filebeat</span><br><span class=\"line\"></span><br><span class=\"line\">  # The password to authenticate to Redis with. The default is no authentication.</span><br><span class=\"line\">  password:</span><br><span class=\"line\"></span><br><span class=\"line\">  # The Redis database number where the events are published. The default is 0.</span><br><span class=\"line\">  db: 0</span><br><span class=\"line\"></span><br><span class=\"line\">  # The Redis data type to use for publishing events. If the data type is list,</span><br><span class=\"line\">  # the Redis RPUSH command is used. If the data type is channel, the Redis</span><br><span class=\"line\">  # PUBLISH command is used. The default value is list.</span><br><span class=\"line\">  datatype: list</span><br><span class=\"line\"></span><br><span class=\"line\">  # The number of workers to use for each host configured to publish events to</span><br><span class=\"line\">  # Redis. Use this setting along with the loadbalance option. For example, if</span><br><span class=\"line\">  # you have 2 hosts and 3 workers, in total 6 workers are started (3 for each</span><br><span class=\"line\">  # host).</span><br><span class=\"line\">  worker: 1</span><br><span class=\"line\"></span><br><span class=\"line\">  # If set to true and multiple hosts or workers are configured, the output</span><br><span class=\"line\">  # plugin load balances published events onto all Redis hosts. If set to false,</span><br><span class=\"line\">  # the output plugin sends all events to only one host (determined at random)</span><br><span class=\"line\">  # and will switch to another host if the currently selected one becomes</span><br><span class=\"line\">  # unreachable. The default value is true.</span><br><span class=\"line\">  loadbalance: true</span><br><span class=\"line\"></span><br><span class=\"line\">  # The Redis connection timeout in seconds. The default is 5 seconds.</span><br><span class=\"line\">  timeout: 5s</span><br><span class=\"line\"></span><br><span class=\"line\">  # The number of times to retry publishing an event after a publishing failure.</span><br><span class=\"line\">  # After the specified number of retries, the events are typically dropped.</span><br><span class=\"line\">  # Some Beats, such as Filebeat, ignore the max_retries setting and retry until</span><br><span class=\"line\">  # all events are published. Set max_retries to a value less than 0 to retry</span><br><span class=\"line\">  # until all events are published. The default is 3.</span><br><span class=\"line\">  max_retries: 3</span><br><span class=\"line\"></span><br><span class=\"line\">  # The number of seconds to wait before trying to reconnect to Redis</span><br><span class=\"line\">  # after a network error. After waiting backoff.init seconds, the Beat</span><br><span class=\"line\">  # tries to reconnect. If the attempt fails, the backoff timer is increased</span><br><span class=\"line\">  # exponentially up to backoff.max. After a successful connection, the backoff</span><br><span class=\"line\">  # timer is reset. The default is 1s.</span><br><span class=\"line\">  backoff.init: 1s</span><br><span class=\"line\"></span><br><span class=\"line\">  # The maximum number of seconds to wait before attempting to connect to</span><br><span class=\"line\">  # Redis after a network error. The default is 60s.</span><br><span class=\"line\">  backoff.max: 60s</span><br><span class=\"line\"></span><br><span class=\"line\">  # The maximum number of events to bulk in a single Redis request or pipeline.</span><br><span class=\"line\">  # The default is 2048.</span><br><span class=\"line\">  bulk_max_size: 2048</span><br><span class=\"line\"></span><br><span class=\"line\">  # The URL of the SOCKS5 proxy to use when connecting to the Redis servers. The</span><br><span class=\"line\">  # value must be a URL with a scheme of socks5:&#x2F;&#x2F;.</span><br><span class=\"line\">  proxy_url:</span><br><span class=\"line\"></span><br><span class=\"line\">  # This option determines whether Redis hostnames are resolved locally when</span><br><span class=\"line\">  # using a proxy. The default value is false, which means that name resolution</span><br><span class=\"line\">  # occurs on the proxy server.</span><br><span class=\"line\">  proxy_use_local_resolver: false</span><br><span class=\"line\"></span><br><span class=\"line\">  # Enable SSL support. SSL is automatically enabled, if any SSL setting is set.</span><br><span class=\"line\">  ssl.enabled: true</span><br><span class=\"line\"></span><br><span class=\"line\">  # Configure SSL verification mode. If &#96;none&#96; is configured, all server hosts</span><br><span class=\"line\">  # and certificates will be accepted. In this mode, SSL based connections are</span><br><span class=\"line\">  # susceptible to man-in-the-middle attacks. Use only for testing. Default is</span><br><span class=\"line\">  # &#96;full&#96;.</span><br><span class=\"line\">  ssl.verification_mode: full</span><br><span class=\"line\"></span><br><span class=\"line\">  # List of supported&#x2F;valid TLS versions. By default all TLS versions from 1.1</span><br><span class=\"line\">  # up to 1.3 are enabled.</span><br><span class=\"line\">  ssl.supported_protocols: [TLSv1.1, TLSv1.2, TLSv1.3]</span><br><span class=\"line\"></span><br><span class=\"line\">  # Optional SSL configuration options. SSL is off by default.</span><br><span class=\"line\">  # List of root certificates for HTTPS server verifications</span><br><span class=\"line\">  ssl.certificate_authorities: [&quot;&#x2F;etc&#x2F;pki&#x2F;root&#x2F;ca.pem&quot;]</span><br><span class=\"line\"></span><br><span class=\"line\">  # Certificate for SSL client authentication</span><br><span class=\"line\">  ssl.certificate: &quot;&#x2F;etc&#x2F;pki&#x2F;client&#x2F;cert.pem&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">  # Client Certificate Key</span><br><span class=\"line\">  ssl.key: &quot;&#x2F;etc&#x2F;pki&#x2F;client&#x2F;cert.key&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">  # Optional passphrase for decrypting the Certificate Key.</span><br><span class=\"line\">  ssl.key_passphrase: &#39;&#39;</span><br><span class=\"line\"></span><br><span class=\"line\">  # Configure cipher suites to be used for SSL connections</span><br><span class=\"line\">  ssl.cipher_suites: []</span><br><span class=\"line\"></span><br><span class=\"line\">  # Configure curve types for ECDHE based cipher suites</span><br><span class=\"line\">  ssl.curve_types: []</span><br><span class=\"line\"></span><br><span class=\"line\">  # Configure what types of renegotiation are supported. Valid options are</span><br><span class=\"line\">  # never, once, and freely. Default is never.</span><br><span class=\"line\">  ssl.renegotiation: never</span><br></pre></td></tr></table></figure>\n\n\n<p>file</p>\n<p>配置filebeat的输出方式为文件， 一般用于测试。</p>\n<p>常规配置</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 采集配置</span><br><span class=\"line\">filebeat.inputs:     #收集日志</span><br><span class=\"line\">- type: log         #类型</span><br><span class=\"line\">  enabled: true     #始终收集</span><br><span class=\"line\">  paths:</span><br><span class=\"line\">    - &#x2F;etc&#x2F;log&#x2F;*.log    </span><br><span class=\"line\"># 输出配置</span><br><span class=\"line\">output.file:</span><br><span class=\"line\">  path: &quot;&#x2F;tmp&#x2F;filebeat&quot;  #  输出路径</span><br><span class=\"line\">  filename: filebeat    # 输出文件名</span><br></pre></td></tr></table></figure>\n\n<p>所有可配置参数</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">output.file:</span><br><span class=\"line\">  # Boolean flag to enable or disable the output module.</span><br><span class=\"line\">  enabled: true</span><br><span class=\"line\"></span><br><span class=\"line\">  # Configure JSON encoding</span><br><span class=\"line\">  codec.json:</span><br><span class=\"line\">    # Pretty-print JSON event</span><br><span class=\"line\">    pretty: false</span><br><span class=\"line\"></span><br><span class=\"line\">    # Configure escaping HTML symbols in strings.</span><br><span class=\"line\">    escape_html: false</span><br><span class=\"line\"></span><br><span class=\"line\">  # Path to the directory where to save the generated files. The option is</span><br><span class=\"line\">  # mandatory.</span><br><span class=\"line\">  path: &quot;&#x2F;tmp&#x2F;filebeat&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">  # Name of the generated files. The default is &#96;filebeat&#96; and it generates</span><br><span class=\"line\">  # files: &#96;filebeat&#96;, &#96;filebeat.1&#96;, &#96;filebeat.2&#96;, etc.</span><br><span class=\"line\">  filename: filebeat</span><br><span class=\"line\"></span><br><span class=\"line\">  # Maximum size in kilobytes of each file. When this size is reached, and on</span><br><span class=\"line\">  # every Filebeat restart, the files are rotated. The default value is 10240</span><br><span class=\"line\">  # kB.</span><br><span class=\"line\">  rotate_every_kb: 10000</span><br><span class=\"line\"></span><br><span class=\"line\">  # Maximum number of files under path. When this number of files is reached,</span><br><span class=\"line\">  # the oldest file is deleted and the rest are shifted from last to first. The</span><br><span class=\"line\">  # default is 7 files.</span><br><span class=\"line\">  number_of_files: 7</span><br><span class=\"line\"></span><br><span class=\"line\">  # Permissions to use for file creation. The default is 0600.</span><br><span class=\"line\">  permissions: 0600</span><br></pre></td></tr></table></figure>\n\n<p>console</p>\n<p>输出到控制面板，测试输出最佳方式。</p>\n<p>常规配置</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 采集配置</span><br><span class=\"line\">filebeat.inputs:     #收集日志</span><br><span class=\"line\">- type: log         #类型</span><br><span class=\"line\">  enabled: true     #始终收集</span><br><span class=\"line\">  paths:</span><br><span class=\"line\">    - &#x2F;etc&#x2F;log&#x2F;*.log    </span><br><span class=\"line\"># 输出配置</span><br><span class=\"line\">output.console:</span><br><span class=\"line\">  codec.json:</span><br><span class=\"line\">    # 漂亮输出（格式化）</span><br><span class=\"line\">    pretty: true</span><br><span class=\"line\">    #  转义HTML符号</span><br><span class=\"line\">    escape_html: true</span><br></pre></td></tr></table></figure>\n\n\n<h3 id=\"Keystore\"><a href=\"#Keystore\" class=\"headerlink\" title=\"Keystore\"></a>Keystore</h3><p>密钥库地址（一般是包含私钥以及关键数据的文件路径）</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">keystore.path: &quot;$&#123;path.config&#125;&#x2F;beats.keystore&quot;</span><br></pre></td></tr></table></figure>\n\n<p>命令</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">创建一个存储密码的keystore：   filebeat keystore create</span><br><span class=\"line\">然后往其中添加键值对，例如：    filebeatk eystore add ES_PWD</span><br><span class=\"line\">使用覆盖原来键的值：           filebeat key store add ES_PWD–force</span><br><span class=\"line\">删除键值对：                  filebeat key store remove ES_PWD</span><br><span class=\"line\">查看已有的键值对：             filebeat key store list</span><br></pre></td></tr></table></figure>\n\n\n<h3 id=\"Setup-ILM\"><a href=\"#Setup-ILM\" class=\"headerlink\" title=\"Setup ILM\"></a>Setup ILM</h3><p>从7.0版开始，Filebeat在连接到支持生命周期管理的群集时默认使用索引生命周期管理。Filebeat自动加载默认策略并将其应用于Filebeat创建的任何索引。</p>\n<p>index lifecycle management (ILM) 索引生命管理，如果它启用了，那么会忽略output.elasticsearch.index 里面的设置。</p>\n<p>新特性：当现有索引达到指定的大小或期限时，使用索引生命周期策略自动将过渡到新索引</p>\n<p>常规配置</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">setup.ilm.enabled: auto</span><br><span class=\"line\">setup.ilm.rollover_alias: &quot;filebeat&quot;  # 前缀</span><br><span class=\"line\"># filebeat-2020.09.28-000001</span><br><span class=\"line\">setup.ilm.pattern: &quot;&#123;now&#x2F;d&#125;-000001&quot;   </span><br></pre></td></tr></table></figure>\n\n<p>需要了解Date math</p>\n<p>详细配置</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># Configure index lifecycle management (ILM). These settings create a write</span><br><span class=\"line\"># alias and add additional settings to the index template. When ILM is enabled,</span><br><span class=\"line\"># output.elasticsearch.index is ignored, and the write alias is used to set the</span><br><span class=\"line\"># index name.</span><br><span class=\"line\"></span><br><span class=\"line\"># Enable ILM support. Valid values are true, false, and auto. When set to auto</span><br><span class=\"line\"># (the default), the Beat uses index lifecycle management when it connects to a</span><br><span class=\"line\"># cluster that supports ILM; otherwise, it creates daily indices.</span><br><span class=\"line\">setup.ilm.enabled: auto</span><br><span class=\"line\"></span><br><span class=\"line\"># Set the prefix used in the index lifecycle write alias name. The default alias</span><br><span class=\"line\"># name is &#39;filebeat-%&#123;[agent.version]&#125;&#39;.</span><br><span class=\"line\">setup.ilm.rollover_alias: &quot;filebeat&quot;</span><br><span class=\"line\"></span><br><span class=\"line\"># Set the rollover index pattern. The default is &quot;%&#123;now&#x2F;d&#125;-000001&quot;.</span><br><span class=\"line\"># filebeat-2020.09.28-000001</span><br><span class=\"line\">setup.ilm.pattern: &quot;&#123;now&#x2F;d&#125;-000001&quot;</span><br><span class=\"line\"></span><br><span class=\"line\"># Set the lifecycle policy name. The default policy name is</span><br><span class=\"line\"># &#39;filebeat&#39;.</span><br><span class=\"line\">setup.ilm.policy_name: &quot;mypolicy&quot;</span><br><span class=\"line\"></span><br><span class=\"line\"># The path to a JSON file that contains a lifecycle policy configuration. Used</span><br><span class=\"line\"># to load your own lifecycle policy.</span><br><span class=\"line\">setup.ilm.policy_file:</span><br><span class=\"line\"></span><br><span class=\"line\"># Disable the check for an existing lifecycle policy. The default is true. If</span><br><span class=\"line\"># you disable this check, set setup.ilm.overwrite: true so the lifecycle policy</span><br><span class=\"line\"># can be installed.</span><br><span class=\"line\">setup.ilm.check_exists: true</span><br><span class=\"line\"></span><br><span class=\"line\"># Overwrite the lifecycle policy at startup. The default is false.</span><br><span class=\"line\">setup.ilm.overwrite: false</span><br></pre></td></tr></table></figure>\n\n\n<p>Logging</p>\n<p>配置日志输出的选项。日志记录系统可以将日志写入syslog或轮换日志文件。如果未显式配置日志记录，则使用文件输出，输出路径为/var/log/filebeat。</p>\n<p>常规配置</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#log 输出级别 </span><br><span class=\"line\">logging.level: info </span><br><span class=\"line\"># 输出方式</span><br><span class=\"line\">logging.to_files: true</span><br><span class=\"line\"># 输出路径、名字、 log文件最大数、文件操作权限</span><br><span class=\"line\">logging.files:</span><br><span class=\"line\">  path: &#x2F;var&#x2F;log&#x2F;filebeat</span><br><span class=\"line\">  name: filebeat</span><br><span class=\"line\">  keepfiles: 7</span><br><span class=\"line\">  permissions: 0644</span><br></pre></td></tr></table></figure>\n\n\n<p>详细参数</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># There are four options for the log output: file, stderr, syslog, eventlog</span><br><span class=\"line\"># The file output is the default.</span><br><span class=\"line\"></span><br><span class=\"line\"># Sets log level. The default log level is info.</span><br><span class=\"line\"># Available log levels are: error, warning, info, debug</span><br><span class=\"line\">logging.level: info</span><br><span class=\"line\"></span><br><span class=\"line\"># Enable debug output for selected components. To enable all selectors use [&quot;*&quot;]</span><br><span class=\"line\"># Other available selectors are &quot;beat&quot;, &quot;publish&quot;, &quot;service&quot;</span><br><span class=\"line\"># Multiple selectors can be chained.</span><br><span class=\"line\"># 输出哪些服务的log</span><br><span class=\"line\">logging.selectors: [ ]</span><br><span class=\"line\"></span><br><span class=\"line\"># Send all logging output to stderr. The default is false.</span><br><span class=\"line\">logging.to_stderr: false</span><br><span class=\"line\"></span><br><span class=\"line\"># Send all logging output to syslog. The default is false.</span><br><span class=\"line\">logging.to_syslog: false</span><br><span class=\"line\"></span><br><span class=\"line\"># Send all logging output to Windows Event Logs. The default is false.</span><br><span class=\"line\">logging.to_eventlog: false</span><br><span class=\"line\"></span><br><span class=\"line\"># If enabled, Filebeat periodically logs its internal metrics that have changed</span><br><span class=\"line\"># in the last period. For each metric that changed, the delta from the value at</span><br><span class=\"line\"># the beginning of the period is logged. Also, the total values for</span><br><span class=\"line\"># all non-zero internal metrics are logged on shutdown. The default is true.</span><br><span class=\"line\">logging.metrics.enabled: true</span><br><span class=\"line\"></span><br><span class=\"line\"># The period after which to log the internal metrics. The default is 30s.</span><br><span class=\"line\">logging.metrics.period: 30s</span><br><span class=\"line\"></span><br><span class=\"line\"># Logging to rotating files. Set logging.to_files to false to disable logging to</span><br><span class=\"line\"># files.</span><br><span class=\"line\">logging.to_files: true</span><br><span class=\"line\">logging.files:</span><br><span class=\"line\">  # Configure the path where the logs are written. The default is the logs directory</span><br><span class=\"line\">  # under the home path (the binary location).</span><br><span class=\"line\">  path: &#x2F;var&#x2F;log&#x2F;filebeat</span><br><span class=\"line\"></span><br><span class=\"line\">  # The name of the files where the logs are written to.</span><br><span class=\"line\">  name: filebeat</span><br><span class=\"line\"></span><br><span class=\"line\">  # Configure log file size limit. If limit is reached, log file will be</span><br><span class=\"line\">  # automatically rotated</span><br><span class=\"line\">  rotateeverybytes: 10485760 # &#x3D; 10MB</span><br><span class=\"line\"></span><br><span class=\"line\">  # Number of rotated log files to keep. Oldest files will be deleted first.</span><br><span class=\"line\">  keepfiles: 7</span><br><span class=\"line\"></span><br><span class=\"line\">  # The permissions mask to apply when rotating log files. The default value is 0600.</span><br><span class=\"line\">  # Must be a valid Unix-style file permissions mask expressed in octal notation.</span><br><span class=\"line\">  permissions: 0600</span><br><span class=\"line\"></span><br><span class=\"line\">  # Enable log file rotation on time intervals in addition to size-based rotation.</span><br><span class=\"line\">  # Intervals must be at least 1s. Values of 1m, 1h, 24h, 7*24h, 30*24h, and 365*24h</span><br><span class=\"line\">  # are boundary-aligned with minutes, hours, days, weeks, months, and years as</span><br><span class=\"line\">  # reported by the local system clock. All other intervals are calculated from the</span><br><span class=\"line\">  # Unix epoch. Defaults to disabled.</span><br><span class=\"line\">  interval: 0</span><br><span class=\"line\"></span><br><span class=\"line\">  # Rotate existing logs on startup rather than appending to the existing</span><br><span class=\"line\">  # file. Defaults to true.</span><br><span class=\"line\">   rotateonstartup: true</span><br><span class=\"line\"></span><br><span class=\"line\"># Set to true to log messages in JSON format.</span><br><span class=\"line\">logging.json: false</span><br><span class=\"line\"></span><br><span class=\"line\"># Set to true, to log messages with minimal required Elastic Common Schema (ECS)</span><br><span class=\"line\"># information. Recommended to use in combination with &#96;logging.json&#x3D;true&#96;</span><br><span class=\"line\"># Defaults to false.</span><br><span class=\"line\">logging.ecs: false</span><br></pre></td></tr></table></figure>"},{"title":"pipenv使用","date":"2019-12-13T06:00:00.000Z","_content":"\n## github\n\n```\nhttps://github.com/yahoo/kafka-manager/releases\n```\n\n## 简介\n\nkafka-manager是最受欢迎的kafka集群管理工具，有如下功能：\n\n- 管理多个集群\n- 轻松检查群集状态（主题，消费者，偏移，代理，副本分发，分区分发）\n- 运行首选副本选举\n- 使用选项生成分区分配以选择要使用的代理\n- 运行分区重新分配（基于生成的分配）\n- 使用可选主题配置创建主题（0.8.1.1具有与0.8.2+不同的配置）\n- 删除主题（仅支持0.8.2+并记住在代理配置中设置delete.topic.enable = true）\n- 主题列表现在指示标记为删除的主题（仅支持0.8.2+）\n- 批量生成多个主题的分区分配，并可选择要使用的代理\n- 批量运行重新分配多个主题的分区\n- 将分区添加到现有主题\n- 更新现有主题的配置\n- 可随意开启对broker级别或者对topic级别的JMX轮询\n- 可方便的过滤出没有id 、所有者、延迟或目录等的消费者\n\n## 安装和配置\n\n```\ncurl https://github.com/yahoo/kafka-manager/archive/2.0.0.2.tar.gz\ncurl https://bintray.com/sbt/rpm/rpm > bintray-sbt-rpm.repo\nmv bintray-sbt-rpm.repo /etc/yum.repos.d/\nyum install sbt\nsbt -version\ntar xf 2.0.0.2.tar.gz\ncd kafka-manager-2.0.0.2/\n./sbt clean dist     # 会编译很久\ncd /usr/local/kafka-manager/target/universal/\ncp kafka-manager-2.0.0.2.zip /usr/local/\nunzip kafka-manager-2.0.0.2.zip \ncd kafka-manager-2.0.0.2\n########修改kafka-manager.zkhosts\nconf/application.conf \n---------\nkafka-manager.zkhosts=\"172.19.168.92:2181,172.19.152.247:2181,172.19.152.245:2181\"\n---------\n```\n\n## 启动\n\n```\nnohub /usr/local/kafka-manager2/bin/kafka-manager &\n```\n\n\n## kafka-manager 添加集群\n\n![image][kafka-maager01]\n\n\n\n\n## 图片\n\n[kafka-maager01]:data:image/jpg;base64,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kfBiiIhmFkpO9dgQhFoQaMbNS1fs2+2f/wB865clXB2VqbXsKOQsa0JUDPUrDpmeBBH3yIPcAsywrs1+qeVCsRv5yxdeFfHAjFS/vD/ZXf7B/wCmrP8A4m/ovCLzaT/1Jf3h89S//wASayJtWRxcFbyeVPgMl3gYzAg1j+nd/sH/AKaNB5w4bSRaSLSRaSLSRaSLSRaSLSRaSLSRaSLSRaSLSRaSLSRaSLSRaSLSRTFNux3+LtQN6pOtZBiKYexCwlAVY4EAUQAgKH9O3F5amjpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJP8AcG9G/wBkT3F/01ObQbl9zrc63Otzrc63Otzrc63Otzrc63Otzrc63Otzrc63Otzrc63OpT7mdn7pLumu6a7prumu6a7prumu6a7prumu6a7prumu6a7prumou7OzvudbnW51udbnW51udbnW51udbnW51udbnW51udbnW51udbnW51udbnW51udbnW51udbnW51udbnW51udbnW51udbnW51udbnW51udbnW51udbnW51udbnW51udbnW51udbnW51udbnW51udbnW51udbnW51udbnW51udbnW51udbnW51udMVnfh/ph/7i+6y/wCPpp/7i/oW79KlMcLnxi8vRywzTx8pNGDyfE5WlmKLXMareWxlIrCuZDN43G1A2rn2SX/H00/9xf6Hdos7vF2kzO3x1XTL1bn81o6TyzZjpalfcPWp7xzTxP8ADC0FsHmbbi61PeAa3V/hP/6OJfxCzVjDdOc0cT0BhK1JmyPX+Nq4jpTE0aN3P+J1djsGspn/AAOpcViVf6qO2ZPi8H11lss3QzlD05mjg6Ta3m362tAAO/ez/WAMJlqNUvT2Ts5bGvat/XJf8fTT/wBxf6OsqWTu4zjHdL08rUCX8qs1kYYnC275ej8B1M+Ea/T6RDbxdrqLpE3QXUmIxvSUKN/pMJ7/AEB1QKt0z1Vhg9D1gP8Awn/9HEv4kYezlenGnQxX8QcBboQJb6/yVXL9KYm9R6tOLF/xHwGSu5bLU8p/E7p3wOpAYWGUu5TG5S/ezX8Gj3buaMLOfwo0YkNXpfJYOD3MxTCD+InSVT69L/j6af8AuL/Xaq17gJAtiHAQojE9Go95rrvjaD3vNerTq02m1OOMx8LcrcKlStSBopKxh8VaPvs2KNO0GArNqpWuAcNyOMoQmCcD4fF2LPkWHhGUHhKnQpUGm1FsNimteUxKdUtsVov12X/H00/9xfdZf8fTT/3F91l/x9NsPw4l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9k8mfhvps/cf3Uvo302fuP7qX0b6bP3H8nymPq24VbIyQI82H/oFZrmgSYRzgQcSD+1F9G+mz9x/PTnjPhiuWraLXyvZAl3I2w22o1O+z1FQuBwl/M29Ns3Tz2i4SrZuAf8AF463kVbvWgYCm1C/fyc4X7NYt3I418n34E2VnZfzPs5fRvps/cfyfFY6xchcOehTsAKCwXEYw1bxjTp1ZlASYsVjg3CWwiHAQojF4wNEwI+JxtpwvZepWeBIvqGxdrUsXj6E5yofZy+jfTZ+4/h3Zmd32yf+2ya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TW2a2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya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sX7jH9yT4L6N9Nn7j+LDc1iszO0m5b7fH+dkjsi+jfTZ+4/lwBf+b6ArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaAqMYwbiKL6N9Nn7j+6l9G+mz9x/N/O1MeC6Y+Xy1XE4x71kuVqgsWRWaxnPWGV6WTr3blqsFTylZgQNBTzsIWzjf/VUtwtbtf2Ivo302fuP4d+Gd0cJboLdkd3HXp0L9N87Ts5W/DQa9P8ACTvApY3K4q7jTHq7X/DUXrYkA8U9IOEpQoXMmCvVxM7OSyc7TBMTq6raHVqhankRMIVoGNqWaAcXdDWu0alGrU3znhGxtapjMO1npYGijaZvsRfRvps/cf3Uvo302fuP4nJoDlN2Y7suDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4Mhyl3ShNF9G+mz9x/Fj9sX7jH9yT4L6N9Nn7j+LH7Yv3GP7knwX0b6bP3H8WP2xfuMf3JPgvo302fuP4JHvFOC2T/52TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2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Xujodjvwe7O4+gtxbcaKKKKKKKKKKKKKKKKSNtvpW/BYMcN19Ofoz8RMXxPRRRRRRRRRRRRRRRRRRRX+Vooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooor+5Xqdfj3YSsvh0svF/G6afBbj3SIf8AKXmjebF7sEb5mWlFyI28smktOTHhJjwkx4waeVk0+x0HsmXmvi3ZHi4ak4f8M8LDUj73wirYnbchfonnqJU3ZHOo2aeGK+ZlJxcSNrDJtPTkiWYInmCGubfc0ncqZp+2iJJVpoXf4+WBf7Hp/Wn8d9T7pHWSJbxQtyDtD9xpr9BB2LoX8eriv7nYwlJNpbDhJJNrhk5HVkoShhiTk6RKDg6lwjBy2RyS5easfG6IUvDtR75NSD8qH+vQ1cTpmnfJF09yFamrKCWH/wDRru3bVM8MlCXNeehpRbk9TV2W5OfPJyI35HupWN80Vprpk1JQcEorPV/Gyo0f1Ly4mulFRUZWkuxN87u8mooeXppfk0IxXiaT7klHozwulCeolNmtrLVdVjsa+moTUYi8Qo6KglaT/wC5GSX6EtkzVguVTXX42/6j1XVLCHrStNdDV1nqdMi12oxj2IazjqeYdTR1XpTU10Od3Zq6z1Z2xalR5SGsoxarLLdZ/Yb61wb24vjeWuL4/dQneT8lC+L2VlsW7KymdSCwMYxrLY+DHw+4isI+39j1fR149f4PS/o6m/8AQKdChJptLbg9OSiptYZGLldL4F6i3Ii7Edh+1i2ELIt2dj7uPVcX1Op1NojXQbwjqIjuRERF/F9Pq1dMUHJ0iUHF00eXOro01GWjNtZVD05Qy0eXKrSIxbdJHlzTprJ5U0raFGUnSPLknT3PJ1L5ayVTpiyyenLyIf6k9JQWotlg1dNQlSZqQi/D6a5u5DSlByj+CWnOCTl1+BV/EX8Rf5BDcoRv75f+CNrQbXfInelHn7nPP1JpKChq3tg1YVqq/a//AIJyhp+Iu3j8GlyeVN3WTUnHkjHejXlP1glBaeo06yasovTjFO6NbUlGMa7DlzO3wnGS0NNr8mtKKlqJvejxFSkuV2tjVhWhpp43NbE5f+34uR6vW5ue8/8ARENScNmS1Jz9zPUavcjrTjFwTwyWvqSgoN4Q9ebw2Q1JQzE5+eS5jxPjJTnzQZDUlDMR6k20T15zilLgm07RPUnOVyY/ExeZRtmpr80UoqqFO3csj8Sm7aJzjJYVGb/YDn76Hg3FkixL7S6dDeLKxY3SfxzvY8qhYNhYNnZVjzwrD/uzUXJ0h6bik+5p6M5+1DTi6Ix5nSJR5Hyv4GXDbh1r+mTi56emlu7PJnz8lZJaU4q2aGi3pynjFdjRmp6yVHlS5eesEdCckmeGg1rqLIOD5VexPTU9WubclUZtLKPAQhPVUprCPFci1HJLDJO3aXwKuD4db/pkHCOlp8/W89jS0H5rjLoJqWhPljWxpX5Gp/oeC/nqzUjHU01KHTccVCMcXZOo+Mvp/wDhoSbhnZM0Fenz/dmhRbdGnKPNGEXiy9JTnGbwzUhGMqi7Xxoh6k3hserqN815PN1H1I62pFUmR1Jxdpi1JpNJi1Zpct4PMkRnKOBzfNzXk1NSeq7k8kJckkycuaTfxzXwl0/onT4f6vikRFkjkTIoT+i+KR1oTtXwYhfxetfDkvah7D2ofuYt2JZE8kXUhLFEdyGwtyCoayxbkNuEtuCwPIsGxLKTR0Qt+L3fYfuYzoLbJBvqfYIghbj97H/4H+Nx7KhkR7NHSiWWx9DqiW6oeyPtO3DqzqjZ4OloYveyCwdPhXp9aVf5rr+wmh4VGwh9zo2T2kIj72yPssZ91C3G8N8HjHxn1N+Cxw3HnjWB5R+TYa6cH/uAavBfXi+DxfB/W/jND4RHtZtFk8pi3PvY+p9wnlm1ULMskMIXuf8AuxVufcLJ1HsdUREdckbbyRfxy88etiVNPsIQiLEv7fOnyH1fF8Vwvb43l7UPYe1D9zFuxLI/eK8WLZ2RVl/qQ7cUP2fH27/Y+eEhIjln54XmuFYX5FlJ9zql3I5ZF2P9LKwX1Lxa4r3tDxwQjqxF8L4dLLEuEXzEc5Ie2xZNLKyLuLY6M60RdoW7XYWXQ9zpYhbX9Hb8j3SFk3eBO1ZfCyWIpkVmi8Xx6EdzTyIbwuF4b4p4Hhj6Ii7tl9+Hf8cXvQsuhDwQQtuEsUxIWaI9uL4drIiyXv8A+nW7pcEqZ+DqVmy+osJCxRWULDEqH+pl4PwVijZ3w/I88FgR1YiuFHWzdUUJ8EqF+lCwq4RXKJYoWx0ovNiVIW7ffg8uz8cOlfR2H0/AsGzEqVFcdyOCsVw6lUqE6I/pfCrS4Vhrith5Z2YlSrgkd/zx62LDsQ8l0dOD6G1CxQuL4dhYFgrf++FqkmPZjw64LhQsnS+PXl+rp8Yy2SO482dGhLhdURwiOFFEFSzw+6+LzQnVGmnHcWxqZuiWbOrOj/bzn7UPbhnnZ9zFvQz8E8JvhZJ1RLBtSE8M6MW7HhHWi8WPg1UmyHsQuDxg/BeLE7Vm1oaokNiHg7knUWV9puh9BbsXCOcG+RizxumkdLFmTReWLqN7sew9/hF/wa4vhebEqVfUsDyPI+DGMfBcFwSF9VZH+wkiLtHV8Oq4vqjrQtyOVwXF4obGMvJ1FlieBnThf0WN0rKzXGWL/HDY2HwbxY9uDNTUWnGzzUjnoT5jzI3R5kboWrFqyWpFNMTv4NRFUdWPoVsdhFZPusXQiNbiFhseUh9OL3Z3/Ihb2JYQ97OjHufdfBDzZsVsXwkSzY0fc2PYupsWCKN4sr9NDwqNSPNChQ3HD9LIKokU3GmRhJytnK0im6ZFVFfG3T9iHfH0X9KVs6/QrLX0vp8U7t2P3Oh9DudGbZK2R+BlcqoREQs8pH3EM8H0FQrIpWK+Y6MjuzuPoJ/t4dUL9wH/2Q==","source":"_posts/kafka-manager部署.md","raw":"---\ntitle: pipenv使用\ndate: 2019-12-13 14:00:00\ncategories: \n- python\ntags:\n- pipenv\n- python\n---\n\n## github\n\n```\nhttps://github.com/yahoo/kafka-manager/releases\n```\n\n## 简介\n\nkafka-manager是最受欢迎的kafka集群管理工具，有如下功能：\n\n- 管理多个集群\n- 轻松检查群集状态（主题，消费者，偏移，代理，副本分发，分区分发）\n- 运行首选副本选举\n- 使用选项生成分区分配以选择要使用的代理\n- 运行分区重新分配（基于生成的分配）\n- 使用可选主题配置创建主题（0.8.1.1具有与0.8.2+不同的配置）\n- 删除主题（仅支持0.8.2+并记住在代理配置中设置delete.topic.enable = true）\n- 主题列表现在指示标记为删除的主题（仅支持0.8.2+）\n- 批量生成多个主题的分区分配，并可选择要使用的代理\n- 批量运行重新分配多个主题的分区\n- 将分区添加到现有主题\n- 更新现有主题的配置\n- 可随意开启对broker级别或者对topic级别的JMX轮询\n- 可方便的过滤出没有id 、所有者、延迟或目录等的消费者\n\n## 安装和配置\n\n```\ncurl https://github.com/yahoo/kafka-manager/archive/2.0.0.2.tar.gz\ncurl https://bintray.com/sbt/rpm/rpm > bintray-sbt-rpm.repo\nmv bintray-sbt-rpm.repo /etc/yum.repos.d/\nyum install sbt\nsbt -version\ntar xf 2.0.0.2.tar.gz\ncd kafka-manager-2.0.0.2/\n./sbt clean dist     # 会编译很久\ncd /usr/local/kafka-manager/target/universal/\ncp kafka-manager-2.0.0.2.zip /usr/local/\nunzip kafka-manager-2.0.0.2.zip \ncd kafka-manager-2.0.0.2\n########修改kafka-manager.zkhosts\nconf/application.conf \n---------\nkafka-manager.zkhosts=\"172.19.168.92:2181,172.19.152.247:2181,172.19.152.245:2181\"\n---------\n```\n\n## 启动\n\n```\nnohub /usr/local/kafka-manager2/bin/kafka-manager &\n```\n\n\n## kafka-manager 添加集群\n\n![image][kafka-maager01]\n\n\n\n\n## 图片\n\n[kafka-maager01]:data:image/jpg;base64,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kfBiiIhmFkpO9dgQhFoQaMbNS1fs2+2f/wB865clXB2VqbXsKOQsa0JUDPUrDpmeBBH3yIPcAsywrs1+qeVCsRv5yxdeFfHAjFS/vD/ZXf7B/wCmrP8A4m/ovCLzaT/1Jf3h89S//wASayJtWRxcFbyeVPgMl3gYzAg1j+nd/sH/AKaNB5w4bSRaSLSRaSLSRaSLSRaSLSRaSLSRaSLSRaSLSRaSLSRaSLSRaSLSRTFNux3+LtQN6pOtZBiKYexCwlAVY4EAUQAgKH9O3F5amjpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJP8AcG9G/wBkT3F/01ObQbl9zrc63Otzrc63Otzrc63Otzrc63Otzrc63Otzrc63Otzrc63OpT7mdn7pLumu6a7prumu6a7prumu6a7prumu6a7prumu6a7prumou7OzvudbnW51udbnW51udbnW51udbnW51udbnW51udbnW51udbnW51udbnW51udbnW51udbnW51udbnW51udbnW51udbnW51udbnW51udbnW51udbnW51udbnW51udbnW51udbnW51udbnW51udbnW51udbnW51udbnW51udbnW51udbnW51udMVnfh/ph/7i+6y/wCPpp/7i/oW79KlMcLnxi8vRywzTx8pNGDyfE5WlmKLXMareWxlIrCuZDN43G1A2rn2SX/H00/9xf6Hdos7vF2kzO3x1XTL1bn81o6TyzZjpalfcPWp7xzTxP8ADC0FsHmbbi61PeAa3V/hP/6OJfxCzVjDdOc0cT0BhK1JmyPX+Nq4jpTE0aN3P+J1djsGspn/AAOpcViVf6qO2ZPi8H11lss3QzlD05mjg6Ta3m362tAAO/ez/WAMJlqNUvT2Ts5bGvat/XJf8fTT/wBxf6OsqWTu4zjHdL08rUCX8qs1kYYnC275ej8B1M+Ea/T6RDbxdrqLpE3QXUmIxvSUKN/pMJ7/AEB1QKt0z1Vhg9D1gP8Awn/9HEv4kYezlenGnQxX8QcBboQJb6/yVXL9KYm9R6tOLF/xHwGSu5bLU8p/E7p3wOpAYWGUu5TG5S/ezX8Gj3buaMLOfwo0YkNXpfJYOD3MxTCD+InSVT69L/j6af8AuL/Xaq17gJAtiHAQojE9Go95rrvjaD3vNerTq02m1OOMx8LcrcKlStSBopKxh8VaPvs2KNO0GArNqpWuAcNyOMoQmCcD4fF2LPkWHhGUHhKnQpUGm1FsNimteUxKdUtsVov12X/H00/9xfdZf8fTT/3F91l/x9NsPw4l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9k8mfhvps/cf3Uvo302fuP7qX0b6bP3H8nymPq24VbIyQI82H/oFZrmgSYRzgQcSD+1F9G+mz9x/PTnjPhiuWraLXyvZAl3I2w22o1O+z1FQuBwl/M29Ns3Tz2i4SrZuAf8AF463kVbvWgYCm1C/fyc4X7NYt3I418n34E2VnZfzPs5fRvps/cfyfFY6xchcOehTsAKCwXEYw1bxjTp1ZlASYsVjg3CWwiHAQojF4wNEwI+JxtpwvZepWeBIvqGxdrUsXj6E5yofZy+jfTZ+4/h3Zmd32yf+2ya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TW2a2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya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sX7jH9yT4L6N9Nn7j+LDc1iszO0m5b7fH+dkjsi+jfTZ+4/lwBf+b6ArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaAqMYwbiKL6N9Nn7j+6l9G+mz9x/N/O1MeC6Y+Xy1XE4x71kuVqgsWRWaxnPWGV6WTr3blqsFTylZgQNBTzsIWzjf/VUtwtbtf2Ivo302fuP4d+Gd0cJboLdkd3HXp0L9N87Ts5W/DQa9P8ACTvApY3K4q7jTHq7X/DUXrYkA8U9IOEpQoXMmCvVxM7OSyc7TBMTq6raHVqhankRMIVoGNqWaAcXdDWu0alGrU3znhGxtapjMO1npYGijaZvsRfRvps/cf3Uvo302fuP4nJoDlN2Y7suDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4Mhyl3ShNF9G+mz9x/Fj9sX7jH9yT4L6N9Nn7j+LH7Yv3GP7knwX0b6bP3H8WP2xfuMf3JPgvo302fuP4JHvFOC2T/52TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2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Xujodjvwe7O4+gtxbcaKKKKKKKKKKKKKKKKSNtvpW/BYMcN19Ofoz8RMXxPRRRRRRRRRRRRRRRRRRRX+Vooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooor+5Xqdfj3YSsvh0svF/G6afBbj3SIf8AKXmjebF7sEb5mWlFyI28smktOTHhJjwkx4waeVk0+x0HsmXmvi3ZHi4ak4f8M8LDUj73wirYnbchfonnqJU3ZHOo2aeGK+ZlJxcSNrDJtPTkiWYInmCGubfc0ncqZp+2iJJVpoXf4+WBf7Hp/Wn8d9T7pHWSJbxQtyDtD9xpr9BB2LoX8eriv7nYwlJNpbDhJJNrhk5HVkoShhiTk6RKDg6lwjBy2RyS5easfG6IUvDtR75NSD8qH+vQ1cTpmnfJF09yFamrKCWH/wDRru3bVM8MlCXNeehpRbk9TV2W5OfPJyI35HupWN80Vprpk1JQcEorPV/Gyo0f1Ly4mulFRUZWkuxN87u8mooeXppfk0IxXiaT7klHozwulCeolNmtrLVdVjsa+moTUYi8Qo6KglaT/wC5GSX6EtkzVguVTXX42/6j1XVLCHrStNdDV1nqdMi12oxj2IazjqeYdTR1XpTU10Od3Zq6z1Z2xalR5SGsoxarLLdZ/Yb61wb24vjeWuL4/dQneT8lC+L2VlsW7KymdSCwMYxrLY+DHw+4isI+39j1fR149f4PS/o6m/8AQKdChJptLbg9OSiptYZGLldL4F6i3Ii7Edh+1i2ELIt2dj7uPVcX1Op1NojXQbwjqIjuRERF/F9Pq1dMUHJ0iUHF00eXOro01GWjNtZVD05Qy0eXKrSIxbdJHlzTprJ5U0raFGUnSPLknT3PJ1L5ayVTpiyyenLyIf6k9JQWotlg1dNQlSZqQi/D6a5u5DSlByj+CWnOCTl1+BV/EX8Rf5BDcoRv75f+CNrQbXfInelHn7nPP1JpKChq3tg1YVqq/a//AIJyhp+Iu3j8GlyeVN3WTUnHkjHejXlP1glBaeo06yasovTjFO6NbUlGMa7DlzO3wnGS0NNr8mtKKlqJvejxFSkuV2tjVhWhpp43NbE5f+34uR6vW5ue8/8ARENScNmS1Jz9zPUavcjrTjFwTwyWvqSgoN4Q9ebw2Q1JQzE5+eS5jxPjJTnzQZDUlDMR6k20T15zilLgm07RPUnOVyY/ExeZRtmpr80UoqqFO3csj8Sm7aJzjJYVGb/YDn76Hg3FkixL7S6dDeLKxY3SfxzvY8qhYNhYNnZVjzwrD/uzUXJ0h6bik+5p6M5+1DTi6Ix5nSJR5Hyv4GXDbh1r+mTi56emlu7PJnz8lZJaU4q2aGi3pynjFdjRmp6yVHlS5eesEdCckmeGg1rqLIOD5VexPTU9WubclUZtLKPAQhPVUprCPFci1HJLDJO3aXwKuD4db/pkHCOlp8/W89jS0H5rjLoJqWhPljWxpX5Gp/oeC/nqzUjHU01KHTccVCMcXZOo+Mvp/wDhoSbhnZM0Fenz/dmhRbdGnKPNGEXiy9JTnGbwzUhGMqi7Xxoh6k3hserqN815PN1H1I62pFUmR1Jxdpi1JpNJi1Zpct4PMkRnKOBzfNzXk1NSeq7k8kJckkycuaTfxzXwl0/onT4f6vikRFkjkTIoT+i+KR1oTtXwYhfxetfDkvah7D2ofuYt2JZE8kXUhLFEdyGwtyCoayxbkNuEtuCwPIsGxLKTR0Qt+L3fYfuYzoLbJBvqfYIghbj97H/4H+Nx7KhkR7NHSiWWx9DqiW6oeyPtO3DqzqjZ4OloYveyCwdPhXp9aVf5rr+wmh4VGwh9zo2T2kIj72yPssZ91C3G8N8HjHxn1N+Cxw3HnjWB5R+TYa6cH/uAavBfXi+DxfB/W/jND4RHtZtFk8pi3PvY+p9wnlm1ULMskMIXuf8AuxVufcLJ1HsdUREdckbbyRfxy88etiVNPsIQiLEv7fOnyH1fF8Vwvb43l7UPYe1D9zFuxLI/eK8WLZ2RVl/qQ7cUP2fH27/Y+eEhIjln54XmuFYX5FlJ9zql3I5ZF2P9LKwX1Lxa4r3tDxwQjqxF8L4dLLEuEXzEc5Ie2xZNLKyLuLY6M60RdoW7XYWXQ9zpYhbX9Hb8j3SFk3eBO1ZfCyWIpkVmi8Xx6EdzTyIbwuF4b4p4Hhj6Ii7tl9+Hf8cXvQsuhDwQQtuEsUxIWaI9uL4drIiyXv8A+nW7pcEqZ+DqVmy+osJCxRWULDEqH+pl4PwVijZ3w/I88FgR1YiuFHWzdUUJ8EqF+lCwq4RXKJYoWx0ovNiVIW7ffg8uz8cOlfR2H0/AsGzEqVFcdyOCsVw6lUqE6I/pfCrS4Vhrith5Z2YlSrgkd/zx62LDsQ8l0dOD6G1CxQuL4dhYFgrf++FqkmPZjw64LhQsnS+PXl+rp8Yy2SO482dGhLhdURwiOFFEFSzw+6+LzQnVGmnHcWxqZuiWbOrOj/bzn7UPbhnnZ9zFvQz8E8JvhZJ1RLBtSE8M6MW7HhHWi8WPg1UmyHsQuDxg/BeLE7Vm1oaokNiHg7knUWV9puh9BbsXCOcG+RizxumkdLFmTReWLqN7sew9/hF/wa4vhebEqVfUsDyPI+DGMfBcFwSF9VZH+wkiLtHV8Oq4vqjrQtyOVwXF4obGMvJ1FlieBnThf0WN0rKzXGWL/HDY2HwbxY9uDNTUWnGzzUjnoT5jzI3R5kboWrFqyWpFNMTv4NRFUdWPoVsdhFZPusXQiNbiFhseUh9OL3Z3/Ihb2JYQ97OjHufdfBDzZsVsXwkSzY0fc2PYupsWCKN4sr9NDwqNSPNChQ3HD9LIKokU3GmRhJytnK0im6ZFVFfG3T9iHfH0X9KVs6/QrLX0vp8U7t2P3Oh9DudGbZK2R+BlcqoREQs8pH3EM8H0FQrIpWK+Y6MjuzuPoJ/t4dUL9wH/2Q==","slug":"kafka-manager部署","published":1,"updated":"2021-06-18T08:07:11.195Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cku697a2o00c900uhh34p91du","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><h2 id=\"github\"><a href=\"#github\" class=\"headerlink\" title=\"github\"></a>github</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">https:&#x2F;&#x2F;github.com&#x2F;yahoo&#x2F;kafka-manager&#x2F;releases</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"简介\"><a href=\"#简介\" class=\"headerlink\" title=\"简介\"></a>简介</h2><p>kafka-manager是最受欢迎的kafka集群管理工具，有如下功能：</p>\n<ul>\n<li>管理多个集群</li>\n<li>轻松检查群集状态（主题，消费者，偏移，代理，副本分发，分区分发）</li>\n<li>运行首选副本选举</li>\n<li>使用选项生成分区分配以选择要使用的代理</li>\n<li>运行分区重新分配（基于生成的分配）</li>\n<li>使用可选主题配置创建主题（0.8.1.1具有与0.8.2+不同的配置）</li>\n<li>删除主题（仅支持0.8.2+并记住在代理配置中设置delete.topic.enable = true）</li>\n<li>主题列表现在指示标记为删除的主题（仅支持0.8.2+）</li>\n<li>批量生成多个主题的分区分配，并可选择要使用的代理</li>\n<li>批量运行重新分配多个主题的分区</li>\n<li>将分区添加到现有主题</li>\n<li>更新现有主题的配置</li>\n<li>可随意开启对broker级别或者对topic级别的JMX轮询</li>\n<li>可方便的过滤出没有id 、所有者、延迟或目录等的消费者</li>\n</ul>\n<h2 id=\"安装和配置\"><a href=\"#安装和配置\" class=\"headerlink\" title=\"安装和配置\"></a>安装和配置</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl https:&#x2F;&#x2F;github.com&#x2F;yahoo&#x2F;kafka-manager&#x2F;archive&#x2F;2.0.0.2.tar.gz</span><br><span class=\"line\">curl https:&#x2F;&#x2F;bintray.com&#x2F;sbt&#x2F;rpm&#x2F;rpm &gt; bintray-sbt-rpm.repo</span><br><span class=\"line\">mv bintray-sbt-rpm.repo &#x2F;etc&#x2F;yum.repos.d&#x2F;</span><br><span class=\"line\">yum install sbt</span><br><span class=\"line\">sbt -version</span><br><span class=\"line\">tar xf 2.0.0.2.tar.gz</span><br><span class=\"line\">cd kafka-manager-2.0.0.2&#x2F;</span><br><span class=\"line\">.&#x2F;sbt clean dist     # 会编译很久</span><br><span class=\"line\">cd &#x2F;usr&#x2F;local&#x2F;kafka-manager&#x2F;target&#x2F;universal&#x2F;</span><br><span class=\"line\">cp kafka-manager-2.0.0.2.zip &#x2F;usr&#x2F;local&#x2F;</span><br><span class=\"line\">unzip kafka-manager-2.0.0.2.zip </span><br><span class=\"line\">cd kafka-manager-2.0.0.2</span><br><span class=\"line\">########修改kafka-manager.zkhosts</span><br><span class=\"line\">conf&#x2F;application.conf </span><br><span class=\"line\">---------</span><br><span class=\"line\">kafka-manager.zkhosts&#x3D;&quot;172.19.168.92:2181,172.19.152.247:2181,172.19.152.245:2181&quot;</span><br><span class=\"line\">---------</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"启动\"><a href=\"#启动\" class=\"headerlink\" title=\"启动\"></a>启动</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nohub &#x2F;usr&#x2F;local&#x2F;kafka-manager2&#x2F;bin&#x2F;kafka-manager &amp;</span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"kafka-manager-添加集群\"><a href=\"#kafka-manager-添加集群\" class=\"headerlink\" title=\"kafka-manager 添加集群\"></a>kafka-manager 添加集群</h2><p><img src=\"data:image/jpg;base64,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kfBiiIhmFkpO9dgQhFoQaMbNS1fs2+2f/wB865clXB2VqbXsKOQsa0JUDPUrDpmeBBH3yIPcAsywrs1+qeVCsRv5yxdeFfHAjFS/vD/ZXf7B/wCmrP8A4m/ovCLzaT/1Jf3h89S//wASayJtWRxcFbyeVPgMl3gYzAg1j+nd/sH/AKaNB5w4bSRaSLSRaSLSRaSLSRaSLSRaSLSRaSLSRaSLSRaSLSRaSLSRaSLSRTFNux3+LtQN6pOtZBiKYexCwlAVY4EAUQAgKH9O3F5amjpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJP8AcG9G/wBkT3F/01ObQbl9zrc63Otzrc63Otzrc63Otzrc63Otzrc63Otzrc63Otzrc63OpT7mdn7pLumu6a7prumu6a7prumu6a7prumu6a7prumu6a7prumou7OzvudbnW51udbnW51udbnW51udbnW51udbnW51udbnW51udbnW51udbnW51udbnW51udbnW51udbnW51udbnW51udbnW51udbnW51udbnW51udbnW51udbnW51udbnW51udbnW51udbnW51udbnW51udbnW51udbnW51udbnW51udbnW51udMVnfh/ph/7i+6y/wCPpp/7i/oW79KlMcLnxi8vRywzTx8pNGDyfE5WlmKLXMareWxlIrCuZDN43G1A2rn2SX/H00/9xf6Hdos7vF2kzO3x1XTL1bn81o6TyzZjpalfcPWp7xzTxP8ADC0FsHmbbi61PeAa3V/hP/6OJfxCzVjDdOc0cT0BhK1JmyPX+Nq4jpTE0aN3P+J1djsGspn/AAOpcViVf6qO2ZPi8H11lss3QzlD05mjg6Ta3m362tAAO/ez/WAMJlqNUvT2Ts5bGvat/XJf8fTT/wBxf6OsqWTu4zjHdL08rUCX8qs1kYYnC275ej8B1M+Ea/T6RDbxdrqLpE3QXUmIxvSUKN/pMJ7/AEB1QKt0z1Vhg9D1gP8Awn/9HEv4kYezlenGnQxX8QcBboQJb6/yVXL9KYm9R6tOLF/xHwGSu5bLU8p/E7p3wOpAYWGUu5TG5S/ezX8Gj3buaMLOfwo0YkNXpfJYOD3MxTCD+InSVT69L/j6af8AuL/Xaq17gJAtiHAQojE9Go95rrvjaD3vNerTq02m1OOMx8LcrcKlStSBopKxh8VaPvs2KNO0GArNqpWuAcNyOMoQmCcD4fF2LPkWHhGUHhKnQpUGm1FsNimteUxKdUtsVov12X/H00/9xfdZf8fTT/3F91l/x9NsPw4l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9k8mfhvps/cf3Uvo302fuP7qX0b6bP3H8nymPq24VbIyQI82H/oFZrmgSYRzgQcSD+1F9G+mz9x/PTnjPhiuWraLXyvZAl3I2w22o1O+z1FQuBwl/M29Ns3Tz2i4SrZuAf8AF463kVbvWgYCm1C/fyc4X7NYt3I418n34E2VnZfzPs5fRvps/cfyfFY6xchcOehTsAKCwXEYw1bxjTp1ZlASYsVjg3CWwiHAQojF4wNEwI+JxtpwvZepWeBIvqGxdrUsXj6E5yofZy+jfTZ+4/h3Zmd32yf+2ya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TW2a2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya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sX7jH9yT4L6N9Nn7j+LDc1iszO0m5b7fH+dkjsi+jfTZ+4/lwBf+b6ArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaAqMYwbiKL6N9Nn7j+6l9G+mz9x/N/O1MeC6Y+Xy1XE4x71kuVqgsWRWaxnPWGV6WTr3blqsFTylZgQNBTzsIWzjf/VUtwtbtf2Ivo302fuP4d+Gd0cJboLdkd3HXp0L9N87Ts5W/DQa9P8ACTvApY3K4q7jTHq7X/DUXrYkA8U9IOEpQoXMmCvVxM7OSyc7TBMTq6raHVqhankRMIVoGNqWaAcXdDWu0alGrU3znhGxtapjMO1npYGijaZvsRfRvps/cf3Uvo302fuP4nJoDlN2Y7suDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4Mhyl3ShNF9G+mz9x/Fj9sX7jH9yT4L6N9Nn7j+LH7Yv3GP7knwX0b6bP3H8WP2xfuMf3JPgvo302fuP4JHvFOC2T/52TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2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Xujodjvwe7O4+gtxbcaKKKKKKKKKKKKKKKKSNtvpW/BYMcN19Ofoz8RMXxPRRRRRRRRRRRRRRRRRRRX+Vooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooor+5Xqdfj3YSsvh0svF/G6afBbj3SIf8AKXmjebF7sEb5mWlFyI28smktOTHhJjwkx4waeVk0+x0HsmXmvi3ZHi4ak4f8M8LDUj73wirYnbchfonnqJU3ZHOo2aeGK+ZlJxcSNrDJtPTkiWYInmCGubfc0ncqZp+2iJJVpoXf4+WBf7Hp/Wn8d9T7pHWSJbxQtyDtD9xpr9BB2LoX8eriv7nYwlJNpbDhJJNrhk5HVkoShhiTk6RKDg6lwjBy2RyS5easfG6IUvDtR75NSD8qH+vQ1cTpmnfJF09yFamrKCWH/wDRru3bVM8MlCXNeehpRbk9TV2W5OfPJyI35HupWN80Vprpk1JQcEorPV/Gyo0f1Ly4mulFRUZWkuxN87u8mooeXppfk0IxXiaT7klHozwulCeolNmtrLVdVjsa+moTUYi8Qo6KglaT/wC5GSX6EtkzVguVTXX42/6j1XVLCHrStNdDV1nqdMi12oxj2IazjqeYdTR1XpTU10Od3Zq6z1Z2xalR5SGsoxarLLdZ/Yb61wb24vjeWuL4/dQneT8lC+L2VlsW7KymdSCwMYxrLY+DHw+4isI+39j1fR149f4PS/o6m/8AQKdChJptLbg9OSiptYZGLldL4F6i3Ii7Edh+1i2ELIt2dj7uPVcX1Op1NojXQbwjqIjuRERF/F9Pq1dMUHJ0iUHF00eXOro01GWjNtZVD05Qy0eXKrSIxbdJHlzTprJ5U0raFGUnSPLknT3PJ1L5ayVTpiyyenLyIf6k9JQWotlg1dNQlSZqQi/D6a5u5DSlByj+CWnOCTl1+BV/EX8Rf5BDcoRv75f+CNrQbXfInelHn7nPP1JpKChq3tg1YVqq/a//AIJyhp+Iu3j8GlyeVN3WTUnHkjHejXlP1glBaeo06yasovTjFO6NbUlGMa7DlzO3wnGS0NNr8mtKKlqJvejxFSkuV2tjVhWhpp43NbE5f+34uR6vW5ue8/8ARENScNmS1Jz9zPUavcjrTjFwTwyWvqSgoN4Q9ebw2Q1JQzE5+eS5jxPjJTnzQZDUlDMR6k20T15zilLgm07RPUnOVyY/ExeZRtmpr80UoqqFO3csj8Sm7aJzjJYVGb/YDn76Hg3FkixL7S6dDeLKxY3SfxzvY8qhYNhYNnZVjzwrD/uzUXJ0h6bik+5p6M5+1DTi6Ix5nSJR5Hyv4GXDbh1r+mTi56emlu7PJnz8lZJaU4q2aGi3pynjFdjRmp6yVHlS5eesEdCckmeGg1rqLIOD5VexPTU9WubclUZtLKPAQhPVUprCPFci1HJLDJO3aXwKuD4db/pkHCOlp8/W89jS0H5rjLoJqWhPljWxpX5Gp/oeC/nqzUjHU01KHTccVCMcXZOo+Mvp/wDhoSbhnZM0Fenz/dmhRbdGnKPNGEXiy9JTnGbwzUhGMqi7Xxoh6k3hserqN815PN1H1I62pFUmR1Jxdpi1JpNJi1Zpct4PMkRnKOBzfNzXk1NSeq7k8kJckkycuaTfxzXwl0/onT4f6vikRFkjkTIoT+i+KR1oTtXwYhfxetfDkvah7D2ofuYt2JZE8kXUhLFEdyGwtyCoayxbkNuEtuCwPIsGxLKTR0Qt+L3fYfuYzoLbJBvqfYIghbj97H/4H+Nx7KhkR7NHSiWWx9DqiW6oeyPtO3DqzqjZ4OloYveyCwdPhXp9aVf5rr+wmh4VGwh9zo2T2kIj72yPssZ91C3G8N8HjHxn1N+Cxw3HnjWB5R+TYa6cH/uAavBfXi+DxfB/W/jND4RHtZtFk8pi3PvY+p9wnlm1ULMskMIXuf8AuxVufcLJ1HsdUREdckbbyRfxy88etiVNPsIQiLEv7fOnyH1fF8Vwvb43l7UPYe1D9zFuxLI/eK8WLZ2RVl/qQ7cUP2fH27/Y+eEhIjln54XmuFYX5FlJ9zql3I5ZF2P9LKwX1Lxa4r3tDxwQjqxF8L4dLLEuEXzEc5Ie2xZNLKyLuLY6M60RdoW7XYWXQ9zpYhbX9Hb8j3SFk3eBO1ZfCyWIpkVmi8Xx6EdzTyIbwuF4b4p4Hhj6Ii7tl9+Hf8cXvQsuhDwQQtuEsUxIWaI9uL4drIiyXv8A+nW7pcEqZ+DqVmy+osJCxRWULDEqH+pl4PwVijZ3w/I88FgR1YiuFHWzdUUJ8EqF+lCwq4RXKJYoWx0ovNiVIW7ffg8uz8cOlfR2H0/AsGzEqVFcdyOCsVw6lUqE6I/pfCrS4Vhrith5Z2YlSrgkd/zx62LDsQ8l0dOD6G1CxQuL4dhYFgrf++FqkmPZjw64LhQsnS+PXl+rp8Yy2SO482dGhLhdURwiOFFEFSzw+6+LzQnVGmnHcWxqZuiWbOrOj/bzn7UPbhnnZ9zFvQz8E8JvhZJ1RLBtSE8M6MW7HhHWi8WPg1UmyHsQuDxg/BeLE7Vm1oaokNiHg7knUWV9puh9BbsXCOcG+RizxumkdLFmTReWLqN7sew9/hF/wa4vhebEqVfUsDyPI+DGMfBcFwSF9VZH+wkiLtHV8Oq4vqjrQtyOVwXF4obGMvJ1FlieBnThf0WN0rKzXGWL/HDY2HwbxY9uDNTUWnGzzUjnoT5jzI3R5kboWrFqyWpFNMTv4NRFUdWPoVsdhFZPusXQiNbiFhseUh9OL3Z3/Ihb2JYQ97OjHufdfBDzZsVsXwkSzY0fc2PYupsWCKN4sr9NDwqNSPNChQ3HD9LIKokU3GmRhJytnK0im6ZFVFfG3T9iHfH0X9KVs6/QrLX0vp8U7t2P3Oh9DudGbZK2R+BlcqoREQs8pH3EM8H0FQrIpWK+Y6MjuzuPoJ/t4dUL9wH/2Q==\" alt=\"image\"></p>\n<h2 id=\"图片\"><a href=\"#图片\" class=\"headerlink\" title=\"图片\"></a>图片</h2>","site":{"data":{}},"excerpt":"","more":"<h2 id=\"github\"><a href=\"#github\" class=\"headerlink\" title=\"github\"></a>github</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">https:&#x2F;&#x2F;github.com&#x2F;yahoo&#x2F;kafka-manager&#x2F;releases</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"简介\"><a href=\"#简介\" class=\"headerlink\" title=\"简介\"></a>简介</h2><p>kafka-manager是最受欢迎的kafka集群管理工具，有如下功能：</p>\n<ul>\n<li>管理多个集群</li>\n<li>轻松检查群集状态（主题，消费者，偏移，代理，副本分发，分区分发）</li>\n<li>运行首选副本选举</li>\n<li>使用选项生成分区分配以选择要使用的代理</li>\n<li>运行分区重新分配（基于生成的分配）</li>\n<li>使用可选主题配置创建主题（0.8.1.1具有与0.8.2+不同的配置）</li>\n<li>删除主题（仅支持0.8.2+并记住在代理配置中设置delete.topic.enable = true）</li>\n<li>主题列表现在指示标记为删除的主题（仅支持0.8.2+）</li>\n<li>批量生成多个主题的分区分配，并可选择要使用的代理</li>\n<li>批量运行重新分配多个主题的分区</li>\n<li>将分区添加到现有主题</li>\n<li>更新现有主题的配置</li>\n<li>可随意开启对broker级别或者对topic级别的JMX轮询</li>\n<li>可方便的过滤出没有id 、所有者、延迟或目录等的消费者</li>\n</ul>\n<h2 id=\"安装和配置\"><a href=\"#安装和配置\" class=\"headerlink\" title=\"安装和配置\"></a>安装和配置</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl https:&#x2F;&#x2F;github.com&#x2F;yahoo&#x2F;kafka-manager&#x2F;archive&#x2F;2.0.0.2.tar.gz</span><br><span class=\"line\">curl https:&#x2F;&#x2F;bintray.com&#x2F;sbt&#x2F;rpm&#x2F;rpm &gt; bintray-sbt-rpm.repo</span><br><span class=\"line\">mv bintray-sbt-rpm.repo &#x2F;etc&#x2F;yum.repos.d&#x2F;</span><br><span class=\"line\">yum install sbt</span><br><span class=\"line\">sbt -version</span><br><span class=\"line\">tar xf 2.0.0.2.tar.gz</span><br><span class=\"line\">cd kafka-manager-2.0.0.2&#x2F;</span><br><span class=\"line\">.&#x2F;sbt clean dist     # 会编译很久</span><br><span class=\"line\">cd &#x2F;usr&#x2F;local&#x2F;kafka-manager&#x2F;target&#x2F;universal&#x2F;</span><br><span class=\"line\">cp kafka-manager-2.0.0.2.zip &#x2F;usr&#x2F;local&#x2F;</span><br><span class=\"line\">unzip kafka-manager-2.0.0.2.zip </span><br><span class=\"line\">cd kafka-manager-2.0.0.2</span><br><span class=\"line\">########修改kafka-manager.zkhosts</span><br><span class=\"line\">conf&#x2F;application.conf </span><br><span class=\"line\">---------</span><br><span class=\"line\">kafka-manager.zkhosts&#x3D;&quot;172.19.168.92:2181,172.19.152.247:2181,172.19.152.245:2181&quot;</span><br><span class=\"line\">---------</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"启动\"><a href=\"#启动\" class=\"headerlink\" title=\"启动\"></a>启动</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nohub &#x2F;usr&#x2F;local&#x2F;kafka-manager2&#x2F;bin&#x2F;kafka-manager &amp;</span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"kafka-manager-添加集群\"><a href=\"#kafka-manager-添加集群\" class=\"headerlink\" title=\"kafka-manager 添加集群\"></a>kafka-manager 添加集群</h2><p><img src=\"data:image/jpg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDAAoHCAkIBgoJCAkMCwoMDxoRDw4ODx8WGBMaJSEnJiQhJCMpLjsyKSw4LCMkM0Y0OD0/QkNCKDFITUhATTtBQj//2wBDAQsMDA8NDx4RER4/KiQqPz8/Pz8/Pz8/Pz8/Pz8/Pz8/Pz8/Pz8/Pz8/Pz8/Pz8/Pz8/Pz8/Pz8/Pz8/Pz8/Pz//wgARCAOWBgwDAREAAhEBAxEB/8QAGwABAQADAQEBAAAAAAAAAAAAAAMBBAUCBgf/xAAaAQEBAQEBAQEAAAAAAAAAAAAAAQIDBAUG/9oADAMBAAIQAxAAAAD9mAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAANU/Mj7w7RkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEz8iPqTin6iDEa1bQAEKIVChkGAAAZAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPlz5Y5h9MXzO9bwU25Onde7n5tr3L2pMbVy0raTPpaWdxRoy6sN4LDMst7eGfXAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHMPzEG4v2kmvZ5jaylq7zPi70ErnVemNXGsRG59W9o6oNaNI1bB6l8XP0DWQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAah+Un2Bqn3QAQoCFBHg1K3gZBgQpChkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAmfBH25tAAAAAAAAweDAAAAAAAABgsDAMgwAADIMAAAyAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADBz+vH8y/Ufn1gAAAAAACO/8AO9/3/wAP7Awamem3rnk1M9NrXPXmsLgLtXnk1JsuxecZqU17s27gAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADwkqAAAAAAAAAGDm+jh+PftfyavWb0PL6ELJazXl00/Tx2OWvOrO51/RyAGT6f430/0z81+gGnjvzMerb356s83n69/p5ZzpoY79fp4+fj0669HXHn49Uk63Tx6PP16s6dLp5e108QAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA2JYpq0AAAAAAAAACc708PyT9p+UV0PJ26Xh9VJvxrGh6uHvl06Pn7eJMVr9scP6vgAGT6T4/0/0f8z+gHK5e3Z1zjNeV9TXm40s+mU1fXLbuOTj0dTfmxLy+ft7Xb52hz9Szo782/vygAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADoSxTVs1+mfFm3z34r0ZgpJEzZiNqSJarE4oqxLz/Rw/Mv1X5tQAAAAAAA7/AMz6H335/wC2NXPbwtbkYhWVlNbuuGrOhas+VyzCdKWC95ekAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHQlimrZoejl4NTtzhcmdvHXOW55vRtHJl8WROieDXJFjWt67O5m+V6MAAAAAAADBrEqCkKIlWIUEqki1ICqSFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHQlimrqAAADyegAAAABL5OlKOTHs4Op9ZFVAAAAA1UjqAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADoZ1JIUAAAAAAAAAB4N+Ua0a9eU3lqAAAAAayeKAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAG5KAAAAAAAAAABMoAAAAAAAATKAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHg8gAAAAAAAAAHk8gAAAAAAAAoAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABEwAAAAApAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMGwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACJgAAA1jZBom7Lp6zuy6UvjWehKAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMGwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACJgAxSMg/K5fut8+RnelWzi5689vn0jvHKPqJWWnbzc66HXnr5u3L07nqTQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwbAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAImAD533+Wucd3xe3Rzr8/3j1m7e5z8a6tzsbzfl0x0zyS2brs2m/OniZ0tzo5foMpQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABg2AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAARMAAAkeyJ5PZMqWNEtXqJHk3DXqReLgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGDYAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABEwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADBsAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAiYAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABg2AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQPIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMG0AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACZQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEygAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJlAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAATKAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAmUBpGwUCFECie1JlQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABMoAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACZQHCNNMnmTw12NZ+dx0pvna2+LfWe9NZAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABMoAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACZQGkeyRYkbSeFgWPZrm4ZAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABMoAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACZQ8kzIAQoAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGShMoAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACZQkVAAAAAAAAAAAAAAABghNi9xgm15iieFtcxmvK7FwMgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkVJlAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAATKEioAAAAAAAAAAAAAAAPB8vx+l5Xt9PFwOXvwdvp49WblN9rfk+c5+/c1x6WuPQ158qAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJFSZQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEyhIqAAAAAAAAAAAAAAADwvB5ezRno7nTwcbn7aXPc34udn0UT3c8Ln7ba5dfXm6u/PkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEipMoAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACZQmeTIAAAAAAAAAAAAAAB5NSdPE1gwvpN/XHTz1pczmspFvoa4ZMgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwWJlAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAATKAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAmUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABMoAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACZQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEygOObCVNWNq30nMXoAkzZoeT1Ga18M9JWNZd1NhQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABMoAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACZQHBNZJm4c+XvazzJqZiM6kZRPVpmdquVyteudeTZm+jrPSlAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEygAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJlAAAAAAATKAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEygAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJlDweDIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAKkygAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJlCRQHkweTKeT0vs8nk9kkosyh7PBNC1JFEwuLMygkVyZSqyMG0AAAAADAAAAACFBC+JfDVrzhOiy7IyAAAAAAAAAAAAAAAAAAAAACRUmUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABMoSKnMNCzcKxrzU9Yg12pOJW+Zj0aVtmfUvtdKy0XrEujZvEsa0uvOmN5ufS+5fRKyCd6XRrsSgAAAAYOXntvXmJLqY77e+GSrM2ptbF5zlk1uXBOBy9+jj0d3t87l49fpjs9PLt3nkAAAAAAAAAAAAAAAAAAAAAEipMoAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACZQkVNYyUInsHo8HkwejybBIyTPZ5PBskypI9mTyZIHsoZJGDaAAAAAPK/Mcffta5wm/B7m9vXHhY9PR1y2Ly5ePVW46GuE2u508dE4HL36uOvS6eTSz303T7Dt8vJkAAAAAAAAAAAAAAAAAAAAAEipMoAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACZQ8kzIAAAAAAAAQFAAAAAAAAAAAA8rxseno64F15qiCduwx4Xkc/X2unj8rBvpXh5WE1z8+mrG7rjz8ejd3w2tcsygAAAAAAAAAAAAAAAAAAAADJQmUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABMoAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACZQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEygAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJlAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAATKGD423eThsfRZ3sVxrKJuZeLsxvr1FAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAmUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABMoDnkjYTVXfSMsbKLk8ptLdCgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACZQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEygJAAAAAAAAAAAAAAAAAAAAAAAAAAAAwZQFICgAAAAAAAAAAAAAAAAAAAAAAAD2eiZQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEyhI9noAAAAAAAAAAAAAAAAAAAAAAAGDIMAyCSzmpTWzrn5lF7kAAAAAAAAAAAAAAAAAAAAAAAARLEygAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJlCRQ8mimFqZs3JQAAAAAAAAAAAAAAAAAAABg4XP27+vOOTn1Tze108nldPPWE6e7nr78vC5e6959jr5Ls5AAAAAAAAAAAAAAAAAAAAAAAOAdoqTKAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAmUJFCJyrMRVdhOgoAAAAAAAAAAAAAAAAAAAAxZ8p5vq7XTh4z03dcRCahNQdfDOJv6nt83gc/ZCdPo+ng2tc8gAAAAAAAAAAAAAAAAAAAAAAGoWKkygAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJlCR7PQAAAAAAAAAAAAAAAAAAAAAAB5NSbxKqctmcW5QvpMnmX3cjYuQAAAAAAAAAAAAAAAAAAAAAAABEsTKAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAmUBIAAAAAAAAAAAAAAAAAAAAAAABCkKQpMGVICgAAAAAAAAAAAAAAAAAAAAAAAAAez0TKAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAmUABgyYAkWgAAZhWADIBgyYAhWTBkAGDIABiRaBkGAZABgGQAAYMmDIAAAAAAAAAAAAAAAAAAAAAAAABMoAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACZQkaJvHPOohdaRbspy5r3Z6T3Lr1uxr6z0Joa5o2dWWJPNhqRs3Y1pfNJPK2rpAAEzJGFbJqpsrpG6ZBAtEa9FQasbNcw6gAANU2DJkAAAAAAAAAAAAAAAAAAAAAAAAEygAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJlCJzTpnzSx1IyEpm9jU0M61da23Pq898npiGNU1jwund/Rs6UvNTr3V8OJ0mzJ1jVwxq60m9bbT53Muu7ZsZvz2nUw5m8bOOlNY3LeVIWrWLhnXcs+dTNt8vR6lzrOc60dTYaR0rniyrnptc1Onl2N53JvIAAAAAAAAAAAAAAAAAAAAAAAAJlAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAATKAAwAAAAIUAjn1vngoIUBqRWyyhCkKAABCgBCgAAJxram7KAACFEykDNAAAAAAAAAAAAAAAAAAAAAAAACZQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEygAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJlAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAATKAAAAwZMGQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACZQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEygPjZqOue5L9EfL11JrkM/Qmtho9c+86zbeNVPVuI+pAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABMoAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACZQ8miek9y+aqmnNUudldM9pgpdYkkl1knRUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAATKAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAmUBIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHs9EygAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJlCR7PQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABEsTKAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAmUJFQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAASKkygAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJlCRUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEipMoAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACZQkez0AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAARLEygAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJlASAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB7PRMoAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACZQGAABCgBkAGBGaAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEygAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJlAciWtz6XZNdN5dA3zjp2Jc0AMGtG1QAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAmUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABMoeT5ZdbWd7N6xxbmM3Fnumoc2vOV6FJZ6z1cu5dAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACZQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEygMQAFESqAACFDIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJlAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAATKHg8GQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVJlAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAATKEioAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJFSZQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEyhIqAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACRUmUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABMoSKgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkVJlAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAATKHg8GQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVJlAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAATKAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAmUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABMoADEKAAAAGQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACZQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEyhrnLOoamLyesxmdipy6+UOk7OLyK8ZdzedmayAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACZQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEyh5NM3DQjT0pJtS6BsJjbaxdOvEu1rHSmgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJlAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAATKAAwAABAUMgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAmUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABMoADBkwBItIXIMAyAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACZQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEyhM1DbOcdRC60i3ZNY2QmsWl0LnptAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACZQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEyhA5Z1T5tY6kZElJezqc+dJMae7sc86c1sb5ya+6lyoAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAmUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABMoADAAAAOcdAyIVkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAmUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABMoAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACZQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEyhggXMgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAmUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABMoax8afZnzM1u3Gtp3Ma1LJJOXft57NjR1foMzjWwl37mUeapLrWbUYt3Y4ybEeNXrycqXY1PMvk9JJrCe0Z1qbxu43W409NlbtauZmyR0T5hfqo4unZk11kkmulJztKmpFE6ZoxO3W1e1lrs70vKqSG99nTsvJtzXGSWruR5rdyjb5ufca6XlW7hpphrpJx0NeLjqTXNytpz5errHuXK6B6LxkVqWfTygAAACZQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEyh5Nc2TVXTKXN83VqiTl8VVKmvb1JNBcSz1muWdXWih5LVWMJpLU2klLOzwbC+U93UpKRqlLEu0mtVFsc+J2eDsmF8GubRqHuTFs4pXupwTYs951oVVbJFKy6p6s8Nb6ayUT01KTNsS9ecvZGzwvqShqXXu595t7bJpp4asztEpdE2aibSZWYJwL1pp3FAAAAEygAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJlAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAATKAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAmUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABMoAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACZQic86BzSseK2DYiFnhq7OuVXJpHRJg8SZr0vskejyDdAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJlAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAATKEjnnQOQsc51da96z1c3myT1vu5zyNTl1283WNiXR1npZuopjztPNtExW0veTKgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACZQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEygAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJlAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAATKAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAmUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABMoeTXNgyAAIUhSFICgAAQoAyYAhQAAQARaEKACApAUAAAMgAAAAAAAAAAAAAAAAAAAAAAAAAAmUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABMoax8QfcHza2s9RrMF7S/Py9yzkHSmtXeNjGuVqUlqk5d2yRvHLildKX5+a6PTj5zvpHLN+WGpDL3bizzHuNXWrzMLrfzmVm+uti6XSb+bztO3Hzlz3865NnZXWIp4jaNWvUs7naltq9iAAAAAAAAAAAAAAAAAAAAAAAAAABMoAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACZQwYPRzS1mvKKlyZIylliUJ2Vl1z0YJ2Xl9ROqRippQuayk8l18plZnuNeqkjeNQ2yMQ1NPOtnWelLk1T2YIGymouY2KROwvs3QAAAAAAAAAAAAAAAAAAAAAAAAAATKAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAmUABgyYAjNAYBkGADJgAGTAQuQAYAAAABkGAAAhRkGEKAEBWQAAAAAAAAAAAAAAAAAAAAAAAAAATKAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAmUBgAAAyYAAMmDJhCgBCgCFAAAQoAADJgAyYCFAQpChkAAAAAAAAAAAAAAAAAAAAAAAAAAAAEygAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJlCJzzdy4e89GUuEybq/OM9iajLXecRuLpnqIaTjYRL7Sy89Kal5cr4PKLdvCWkUsak1v3MV4h2iieFmmZrFxSa8WYWvTnDc2ca2Ma1d4yR1nyteO+jNZoAAAAAAAAAAAAAAAAAAAAAAAAAAAATKAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAmUJHPN3LibzmWEuwzo3XZs0Y2YlNa280k7M1wbNy6qm1JzJdWTcrrW8mJaxOa6q6JaZ0r07zHz50JaJzmunc8xrYTWs7OXIWVzTOvepWSi8LT6reI7k03ueuR350zPbW3z3pS9zG8gAAAAAAAAAAAAAAAAAAAAAAAAAAAAmUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABMoDAAgKQoAAAAABCkKCAoAAAESqAAAAQpCkBSArIAAAAAAAAAAAAAAAAAAAAAAAAAAAAJlAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAATKAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAmUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABMoAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACZQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEygIFojZZRrxizZUaabhhZHoZaWp0VmUiFa9m/KCFgbBgyAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACZQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEygPhbNlZM+s6Ja22WhqbdkSmdeTl6dQ08N7c1E6PPWvtOqRrJtyz3PeWtdfQMdeayAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACZQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEygBgyAAADVTZXIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJlAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAATKHkmZAAAAAQoAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAyUJlAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAATKEioMQrIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJFSZQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEyhIqc2Xn6x0l6EoAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkVJlAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAATKEippkTbLgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkVJlAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAATKHg8GQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVJlAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAATKAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAmUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP//EADMQAAEEAgEEAgECBQQCAwEAAAMAAQIEBRMRBhIUMhBgFRY0ByEwMVAgQEFwMzYiIyQ1/9oACAEBAAEIAP8AsXJ2vBxlm2qgurMv06XqeHR+XnnOmKd83/X5hQOGYi3um3p9UB6XqdX3p9HdHVaWCvt1H0UWjftN8O7Mzu9TIUbrM9L/AK6/iJlz4Xo61ap4z+GNC7gIWrnSOCn1hUvVM/Q6AK1+qfNnvGh1lk8VSLCGAwsIY3M5ueZ6DyZqZ8g2Oz47WTPkb4MRC4fAZgeaoTOO9OdH+IdnKLrYs7doFUefzZsM21Ez05mxg8dSy1m1Uussd1ZVOLJPZNnMlVJR821nbUGuHpvmjFyzUKHxlbk6ONNYHGrfqDLZPi8qx6cYmhm4GOANWnnpu2SnefOjFVmQ9+5eBhZW6XRvVd/qZzTn/wBS5/DgzuFsY21o64xV0HSVbLYnLdAYgM8TkQZ7og1DJTPgGv2cs9suMzZXxlq1+AyM8Lnax8tgPyeYhcc+OzRrONvnwGOt0Gvvdnhd+Vy5LY+nLjdOeGU+JyUMrlD08VhrNN8JtyPT1qy+Sdj4S5dPlj5bKflzW8HWvz6XYV+3Nq+OkDPluQ+LtUd2mWsYFPKcTDdfBWh9jUy4ApXx8HtYDywZKuan06wKmn/qjKWno4q1baphszm8HPrKeNEDrzoAH5jHfw8YV8B8t/TJCBRyGShicbjnnLH/APWJRwMKYyF/hoLkoK2Oo18bQDSp/wCxJJ4w5bskuyS7JLXJa5LXJa5LXJa5LXJa5LXJa5LXJa5LXJa5L/5QnBn/AOr86YlfB3Dh/WGfX6wz6/WGfX6wz6/WGfX6wz6/WGfX6wz6/WGfX6wz6/WGfX6wz6/WGfX6wz6/WGfX6wz6/WGfXRueymUzmi9817wbF23Wh8BuCNdsVYKFsErRKzedUVS7VtyNGtZvBr26tcnxeuipQHI0bgpX51Ezs7uzTuVoSeM45KnLQ8atwVotgYv+hSTaEeX8leSvJXkryV5K8leSvJXkryV5K8leSvJXkryV5K8leSvJXUZ+enL7fMISnNoQzOKfFmHFfh7I8ZZt2YYiz+MtXT0aLWAmsHFQr2d71XrWIzJCVbE37BQQhPGXo3S1WHStkhOY/wDT0BPs6ideSvJVvKwq2awHqDPDMZSyfCWax6r3a07wpTk7ULQ2y+TdVMhXjdnXd7UzXWdwHOXM2746dk5ZtYbKQLPO4ibQyN3eCCBaswz8wzy20ubxx7Ips/UVmL4aQYQOWF2w/wCoqUVXdw9NbS4YvBIO3kryV5K8leSvJXkryV5K8leSvJXkryV5K8leSvJXkryV5K8leSvJXkryV5K8leSvJXkryV5K8leSvJXkryV5K8leSvJXkryV5K8leSvJXkryV5K8leSvJXkryV5K8leSvJXkryV5K8leSvJXkryV5K8leSvJXkryV5K8leSvJXkryV5K8leSvJXkryV5K8leSvJXkryV5K8leSvJXkryV5K8leSvJXkryV5K8leSvJXkryV5K8leSvJXkryV5K8leSvJXkryV5K8leSvJXkryV5K8leSvJ+LP/ib/bdQf+v3/nCGr1slCzaq5moQIp2x3aNSncZ7dym1PNdlA9cmLsULdKdSi12Cs3seQ+Tusa/R8utaLC7RYF2u+SycLWKON/8AT0H/AOwP85MEzZTHkDtI7D4wIXq4yFMm8v6mas1D/wDsZRYE5rALcjnsTNlsi9opXCfEHBh3A+ZNMBJRLnxu4iQ7MZZcBRl6lK4srAcNVm9T2teuHu0azQNvrM1qfVcCSYlw/S9kpaELTBrSl/0LZ/8AE3xatQrNHmF303IpIhFMpIu0os7fNc0bAIGhauCrEDAqrHhZAxYVjwsickGvtOb6QHgdytBbh79P+jOwmTB3Rj/DZVfhsqvw2VX4bKr8NlV+Gyq/DZVfhsqvw2VX4bKr8NlV+Gyq/DZVfhsqvw2VX4bKr8PlV0ZQu1c487XxWpDr2rNhoYurCmKqzVBNflcadKqSy9gjUKbSlJqNINEUxgDTAC1YsCHjK48pK+yLQqnpkqnejXdqsWauNrb2UOqKBtzjrjHZMeNfFUqtydqsWlXPbhYM1EEMfOkMcGGKI4/9C2f/ABN8Xe4N4FxHL5b05iBs4pVlCoxYXwwt14yhT7K1JntgkfBiiIhmFkpO9dgQhFoQaMbNS1fs2+2f/wB865clXB2VqbXsKOQsa0JUDPUrDpmeBBH3yIPcAsywrs1+qeVCsRv5yxdeFfHAjFS/vD/ZXf7B/wCmrP8A4m/ovCLzaT/1Jf3h89S//wASayJtWRxcFbyeVPgMl3gYzAg1j+nd/sH/AKaNB5w4bSRaSLSRaSLSRaSLSRaSLSRaSLSRaSLSRaSLSRaSLSRaSLSRaSLSRTFNux3+LtQN6pOtZBiKYexCwlAVY4EAUQAgKH9O3F5amjpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJFpItJP8AcG9G/wBkT3F/01ObQbl9zrc63Otzrc63Otzrc63Otzrc63Otzrc63Otzrc63Otzrc63OpT7mdn7pLumu6a7prumu6a7prumu6a7prumu6a7prumu6a7prumou7OzvudbnW51udbnW51udbnW51udbnW51udbnW51udbnW51udbnW51udbnW51udbnW51udbnW51udbnW51udbnW51udbnW51udbnW51udbnW51udbnW51udbnW51udbnW51udbnW51udbnW51udbnW51udbnW51udbnW51udbnW51udbnW51udMVnfh/ph/7i+6y/wCPpp/7i/oW79KlMcLnxi8vRywzTx8pNGDyfE5WlmKLXMareWxlIrCuZDN43G1A2rn2SX/H00/9xf6Hdos7vF2kzO3x1XTL1bn81o6TyzZjpalfcPWp7xzTxP8ADC0FsHmbbi61PeAa3V/hP/6OJfxCzVjDdOc0cT0BhK1JmyPX+Nq4jpTE0aN3P+J1djsGspn/AAOpcViVf6qO2ZPi8H11lss3QzlD05mjg6Ta3m362tAAO/ez/WAMJlqNUvT2Ts5bGvat/XJf8fTT/wBxf6OsqWTu4zjHdL08rUCX8qs1kYYnC275ej8B1M+Ea/T6RDbxdrqLpE3QXUmIxvSUKN/pMJ7/AEB1QKt0z1Vhg9D1gP8Awn/9HEv4kYezlenGnQxX8QcBboQJb6/yVXL9KYm9R6tOLF/xHwGSu5bLU8p/E7p3wOpAYWGUu5TG5S/ezX8Gj3buaMLOfwo0YkNXpfJYOD3MxTCD+InSVT69L/j6af8AuL/Xaq17gJAtiHAQojE9Go95rrvjaD3vNerTq02m1OOMx8LcrcKlStSBopKxh8VaPvs2KNO0GArNqpWuAcNyOMoQmCcD4fF2LPkWHhGUHhKnQpUGm1FsNimteUxKdUtsVov12X/H00/9xfdZf8fTT/3F91l/x9NsPw4l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9l3su9k8mfhvps/cf3Uvo302fuP7qX0b6bP3H8nymPq24VbIyQI82H/oFZrmgSYRzgQcSD+1F9G+mz9x/PTnjPhiuWraLXyvZAl3I2w22o1O+z1FQuBwl/M29Ns3Tz2i4SrZuAf8AF463kVbvWgYCm1C/fyc4X7NYt3I418n34E2VnZfzPs5fRvps/cfyfFY6xchcOehTsAKCwXEYw1bxjTp1ZlASYsVjg3CWwiHAQojF4wNEwI+JxtpwvZepWeBIvqGxdrUsXj6E5yofZy+jfTZ+4/h3Zmd32yf+2ya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TW2a2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya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sX7jH9yT4L6N9Nn7j+LDc1iszO0m5b7fH+dkjsi+jfTZ+4/lwBf+b6ArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaArQFaAqMYwbiKL6N9Nn7j+6l9G+mz9x/N/O1MeC6Y+Xy1XE4x71kuVqgsWRWaxnPWGV6WTr3blqsFTylZgQNBTzsIWzjf/VUtwtbtf2Ivo302fuP4d+Gd0cJboLdkd3HXp0L9N87Ts5W/DQa9P8ACTvApY3K4q7jTHq7X/DUXrYkA8U9IOEpQoXMmCvVxM7OSyc7TBMTq6raHVqhankRMIVoGNqWaAcXdDWu0alGrU3znhGxtapjMO1npYGijaZvsRfRvps/cf3Uvo302fuP4nJoDlN2Y7suDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4MuDLgy4Mhyl3ShNF9G+mz9x/Fj9sX7jH9yT4L6N9Nn7j+LH7Yv3GP7knwX0b6bP3H8WP2xfuMf3JPgvo302fuP4JHvFOC2T/52TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2TWya2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Xujodjvwe7O4+gtxbcaKKKKKKKKKKKKKKKKSNtvpW/BYMcN19Ofoz8RMXxPRRRRRRRRRRRRRRRRRRRX+Vooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooor+5Xqdfj3YSsvh0svF/G6afBbj3SIf8AKXmjebF7sEb5mWlFyI28smktOTHhJjwkx4waeVk0+x0HsmXmvi3ZHi4ak4f8M8LDUj73wirYnbchfonnqJU3ZHOo2aeGK+ZlJxcSNrDJtPTkiWYInmCGubfc0ncqZp+2iJJVpoXf4+WBf7Hp/Wn8d9T7pHWSJbxQtyDtD9xpr9BB2LoX8eriv7nYwlJNpbDhJJNrhk5HVkoShhiTk6RKDg6lwjBy2RyS5easfG6IUvDtR75NSD8qH+vQ1cTpmnfJF09yFamrKCWH/wDRru3bVM8MlCXNeehpRbk9TV2W5OfPJyI35HupWN80Vprpk1JQcEorPV/Gyo0f1Ly4mulFRUZWkuxN87u8mooeXppfk0IxXiaT7klHozwulCeolNmtrLVdVjsa+moTUYi8Qo6KglaT/wC5GSX6EtkzVguVTXX42/6j1XVLCHrStNdDV1nqdMi12oxj2IazjqeYdTR1XpTU10Od3Zq6z1Z2xalR5SGsoxarLLdZ/Yb61wb24vjeWuL4/dQneT8lC+L2VlsW7KymdSCwMYxrLY+DHw+4isI+39j1fR149f4PS/o6m/8AQKdChJptLbg9OSiptYZGLldL4F6i3Ii7Edh+1i2ELIt2dj7uPVcX1Op1NojXQbwjqIjuRERF/F9Pq1dMUHJ0iUHF00eXOro01GWjNtZVD05Qy0eXKrSIxbdJHlzTprJ5U0raFGUnSPLknT3PJ1L5ayVTpiyyenLyIf6k9JQWotlg1dNQlSZqQi/D6a5u5DSlByj+CWnOCTl1+BV/EX8Rf5BDcoRv75f+CNrQbXfInelHn7nPP1JpKChq3tg1YVqq/a//AIJyhp+Iu3j8GlyeVN3WTUnHkjHejXlP1glBaeo06yasovTjFO6NbUlGMa7DlzO3wnGS0NNr8mtKKlqJvejxFSkuV2tjVhWhpp43NbE5f+34uR6vW5ue8/8ARENScNmS1Jz9zPUavcjrTjFwTwyWvqSgoN4Q9ebw2Q1JQzE5+eS5jxPjJTnzQZDUlDMR6k20T15zilLgm07RPUnOVyY/ExeZRtmpr80UoqqFO3csj8Sm7aJzjJYVGb/YDn76Hg3FkixL7S6dDeLKxY3SfxzvY8qhYNhYNnZVjzwrD/uzUXJ0h6bik+5p6M5+1DTi6Ix5nSJR5Hyv4GXDbh1r+mTi56emlu7PJnz8lZJaU4q2aGi3pynjFdjRmp6yVHlS5eesEdCckmeGg1rqLIOD5VexPTU9WubclUZtLKPAQhPVUprCPFci1HJLDJO3aXwKuD4db/pkHCOlp8/W89jS0H5rjLoJqWhPljWxpX5Gp/oeC/nqzUjHU01KHTccVCMcXZOo+Mvp/wDhoSbhnZM0Fenz/dmhRbdGnKPNGEXiy9JTnGbwzUhGMqi7Xxoh6k3hserqN815PN1H1I62pFUmR1Jxdpi1JpNJi1Zpct4PMkRnKOBzfNzXk1NSeq7k8kJckkycuaTfxzXwl0/onT4f6vikRFkjkTIoT+i+KR1oTtXwYhfxetfDkvah7D2ofuYt2JZE8kXUhLFEdyGwtyCoayxbkNuEtuCwPIsGxLKTR0Qt+L3fYfuYzoLbJBvqfYIghbj97H/4H+Nx7KhkR7NHSiWWx9DqiW6oeyPtO3DqzqjZ4OloYveyCwdPhXp9aVf5rr+wmh4VGwh9zo2T2kIj72yPssZ91C3G8N8HjHxn1N+Cxw3HnjWB5R+TYa6cH/uAavBfXi+DxfB/W/jND4RHtZtFk8pi3PvY+p9wnlm1ULMskMIXuf8AuxVufcLJ1HsdUREdckbbyRfxy88etiVNPsIQiLEv7fOnyH1fF8Vwvb43l7UPYe1D9zFuxLI/eK8WLZ2RVl/qQ7cUP2fH27/Y+eEhIjln54XmuFYX5FlJ9zql3I5ZF2P9LKwX1Lxa4r3tDxwQjqxF8L4dLLEuEXzEc5Ie2xZNLKyLuLY6M60RdoW7XYWXQ9zpYhbX9Hb8j3SFk3eBO1ZfCyWIpkVmi8Xx6EdzTyIbwuF4b4p4Hhj6Ii7tl9+Hf8cXvQsuhDwQQtuEsUxIWaI9uL4drIiyXv8A+nW7pcEqZ+DqVmy+osJCxRWULDEqH+pl4PwVijZ3w/I88FgR1YiuFHWzdUUJ8EqF+lCwq4RXKJYoWx0ovNiVIW7ffg8uz8cOlfR2H0/AsGzEqVFcdyOCsVw6lUqE6I/pfCrS4Vhrith5Z2YlSrgkd/zx62LDsQ8l0dOD6G1CxQuL4dhYFgrf++FqkmPZjw64LhQsnS+PXl+rp8Yy2SO482dGhLhdURwiOFFEFSzw+6+LzQnVGmnHcWxqZuiWbOrOj/bzn7UPbhnnZ9zFvQz8E8JvhZJ1RLBtSE8M6MW7HhHWi8WPg1UmyHsQuDxg/BeLE7Vm1oaokNiHg7knUWV9puh9BbsXCOcG+RizxumkdLFmTReWLqN7sew9/hF/wa4vhebEqVfUsDyPI+DGMfBcFwSF9VZH+wkiLtHV8Oq4vqjrQtyOVwXF4obGMvJ1FlieBnThf0WN0rKzXGWL/HDY2HwbxY9uDNTUWnGzzUjnoT5jzI3R5kboWrFqyWpFNMTv4NRFUdWPoVsdhFZPusXQiNbiFhseUh9OL3Z3/Ihb2JYQ97OjHufdfBDzZsVsXwkSzY0fc2PYupsWCKN4sr9NDwqNSPNChQ3HD9LIKokU3GmRhJytnK0im6ZFVFfG3T9iHfH0X9KVs6/QrLX0vp8U7t2P3Oh9DudGbZK2R+BlcqoREQs8pH3EM8H0FQrIpWK+Y6MjuzuPoJ/t4dUL9wH/2Q==\" alt=\"image\"></p>\n<h2 id=\"图片\"><a href=\"#图片\" class=\"headerlink\" title=\"图片\"></a>图片</h2>"}],"PostAsset":[],"PostCategory":[{"post_id":"cku6979x4000100uh1z911s1o","category_id":"cku6979xa000400uhaui1fzyi","_id":"cku6979xq000h00uh1vnv4ckk"},{"post_id":"cku6979x8000300uh7n9sa6t8","category_id":"cku6979xa000400uhaui1fzyi","_id":"cku6979xu000m00uh0t1k4ajv"},{"post_id":"cku6979xh000700uh0o04diki","category_id":"cku6979xq000g00uh8d6e8sf4","_id":"cku6979y0000t00uhcz0m86wa"},{"post_id":"cku6979xj000900uhf9u5a1zh","category_id":"cku6979xq000g00uh8d6e8sf4","_id":"cku6979y2000z00uhbdu5ctto"},{"post_id":"cku6979xy000r00uh57ofdywp","category_id":"cku6979xq000g00uh8d6e8sf4","_id":"cku6979y4001300uhehub6tyd"},{"post_id":"cku6979xk000b00uh7mk1au3m","category_id":"cku6979xq000g00uh8d6e8sf4","_id":"cku6979y5001600uhenvte3yw"},{"post_id":"cku6979xn000e00uhcmp872w5","category_id":"cku6979y2000y00uh2naw29hg","_id":"cku6979y9001d00uh2fpd4i9q"},{"post_id":"cku6979y4001500uh33l1bx48","category_id":"cku6979xq000g00uh8d6e8sf4","_id":"cku6979yb001g00uhd0gff7us"},{"post_id":"cku6979y6001900uh088vewxl","category_id":"cku6979xq000g00uh8d6e8sf4","_id":"cku6979ye001j00uh44t2hpkj"},{"post_id":"cku6979xo000f00uhdgz3hpn8","category_id":"cku6979xq000g00uh8d6e8sf4","_id":"cku6979yg001n00uhdxmm0ez2"},{"post_id":"cku6979xs000l00uh7wiz04hq","category_id":"cku6979y9001c00uh259u4by4","_id":"cku6979yi001q00uhbx9853x2"},{"post_id":"cku6979xw000q00uh5c6tciyz","category_id":"cku6979y9001c00uh259u4by4","_id":"cku6979yo001v00uh8ygzhhnt"},{"post_id":"cku6979y1000v00uhd3u11pcc","category_id":"cku6979yi001p00uh575i2c06","_id":"cku6979yu002300uh7m381m12"},{"post_id":"cku6979y1000x00uhdjf14xrc","category_id":"cku6979yq001x00uh9zx2anhe","_id":"cku6979yx002900uhhjel6wog"},{"post_id":"cku6979y3001200uh2f9jdy0q","category_id":"cku6979yu002400uhbxfl4ki3","_id":"cku6979yz002f00uh3oj1clgs"},{"post_id":"cku6979y7001b00uh4ak02fht","category_id":"cku6979yq001x00uh9zx2anhe","_id":"cku6979z0002j00uh6jwr31ap"},{"post_id":"cku6979ya001f00uh6aav9at3","category_id":"cku6979yz002e00uh5joxbebr","_id":"cku6979z4002p00uhbpc0htk4"},{"post_id":"cku6979yb001i00uh2bde7bx8","category_id":"cku6979z1002k00uhcu9a29hd","_id":"cku6979z7002x00uh582kamms"},{"post_id":"cku6979yf001l00uh8pk51ia4","category_id":"cku6979z4002r00uhakk5ez92","_id":"cku6979z9003400uhfhx27yrf"},{"post_id":"cku6979z7003100uh2h4ddxb6","category_id":"cku6979yu002400uhbxfl4ki3","_id":"cku6979zb003a00uh8xx8hx4t"},{"post_id":"cku6979yg001o00uhgm2zfyu3","category_id":"cku6979z4002r00uhakk5ez92","_id":"cku6979zc003e00uhc4352k88"},{"post_id":"cku6979yj001r00uh0zk6e2g5","category_id":"cku6979z9003300uh28dh6zac","_id":"cku6979zd003h00uhai683mcz"},{"post_id":"cku6979yl001t00uhhejp3fu8","category_id":"cku6979zb003b00uh9hkv1lam","_id":"cku6979zf003o00uhc7e34eq6"},{"post_id":"cku6979zd003j00uhdrlqd8l3","category_id":"cku6979yu002400uhbxfl4ki3","_id":"cku6979zh003u00uh2v0s00af"},{"post_id":"cku6979ze003m00uhcvl50pjz","category_id":"cku6979yu002400uhbxfl4ki3","_id":"cku6979zj003x00uh2akn1k4i"},{"post_id":"cku6979yo001w00uh8ofhcr30","category_id":"cku6979zd003i00uhfcnod9kv","_id":"cku6979zl004000uhcnzbal1m"},{"post_id":"cku6979zf003p00uh20i54w5c","category_id":"cku6979yu002400uhbxfl4ki3","_id":"cku6979zm004400uh950o4yua"},{"post_id":"cku6979ys002000uh2zry0te2","category_id":"cku6979zd003i00uhfcnod9kv","_id":"cku6979zo004800uh5t5eefaw"},{"post_id":"cku6979zi003w00uh7ai1b5nc","category_id":"cku6979yu002400uhbxfl4ki3","_id":"cku6979zp004c00uh4ejx8zvf"},{"post_id":"cku6979yv002600uh0b2g5p18","category_id":"cku6979zj003y00uhgzz3b6p4","_id":"cku6979zq004g00uh2s388ccx"},{"post_id":"cku6979zm004300uhc37n130f","category_id":"cku6979yu002400uhbxfl4ki3","_id":"cku6979zr004j00uh2poq6a2l"},{"post_id":"cku6979zn004700uh50ky5k8d","category_id":"cku6979yu002400uhbxfl4ki3","_id":"cku6979zs004m00uhgeql731h"},{"post_id":"cku6979yw002800uh61946wf7","category_id":"cku6979zn004500uhevft1twd","_id":"cku6979zt004p00uh06hvgltt"},{"post_id":"cku6979zq004f00uhgj9ob1fp","category_id":"cku6979yu002400uhbxfl4ki3","_id":"cku6979zu004s00uhg226hxcp"},{"post_id":"cku6979yx002b00uh2vv41ywg","category_id":"cku6979zn004500uhevft1twd","_id":"cku6979zv004v00uh718uhw5m"},{"post_id":"cku6979zr004i00uhenw72b8f","category_id":"cku6979yu002400uhbxfl4ki3","_id":"cku6979zx005000uhfb6uftha"},{"post_id":"cku6979yy002d00uh2vnuhewe","category_id":"cku6979zs004k00uh8isk6aj5","_id":"cku6979zy005300uh3o6u6y4k"},{"post_id":"cku6979yz002g00uhbz8z2y88","category_id":"cku6979z4002r00uhakk5ez92","_id":"cku697a00005700uh2sgvbth5"},{"post_id":"cku6979z0002i00uh06rt4mls","category_id":"cku6979zw004x00uhcd4xaunp","_id":"cku697a06005d00uhbzo651vm"},{"post_id":"cku6979zz005600uh1dn0bvbc","category_id":"cku6979yu002400uhbxfl4ki3","_id":"cku697a07005g00uhd1cuhfvt"},{"post_id":"cku697a01005900uh7eiabm7f","category_id":"cku6979yu002400uhbxfl4ki3","_id":"cku697a08005l00uh533ma6ms"},{"post_id":"cku6979z1002l00uh7rwjhzwj","category_id":"cku6979zw004x00uhcd4xaunp","_id":"cku697a09005o00uh9mmh83gj"},{"post_id":"cku697a05005b00uhh3vp9xc8","category_id":"cku6979yu002400uhbxfl4ki3","_id":"cku697a0b005r00uhevz39vi9"},{"post_id":"cku697a07005f00uh0acfgj75","category_id":"cku6979yu002400uhbxfl4ki3","_id":"cku697a0c005w00uhalcn1wmm"},{"post_id":"cku6979z2002n00uh7tgyamit","category_id":"cku6979zw004x00uhcd4xaunp","_id":"cku697a0e005y00uh1y6jawox"},{"post_id":"cku6979z4002q00uh3cfp11rs","category_id":"cku697a08005k00uh702778cg","_id":"cku697a0g006200uhfe7eb1kk"},{"post_id":"cku6979z5002u00uh4irda8l7","category_id":"cku697a08005k00uh702778cg","_id":"cku697a0i006700uhera65axr"},{"post_id":"cku697a0d005x00uh14sic0cs","category_id":"cku6979xq000g00uh8d6e8sf4","_id":"cku697a0k006a00uhbkaj5815"},{"post_id":"cku6979z6002w00uhbijr2jh0","category_id":"cku697a08005k00uh702778cg","_id":"cku697a0l006e00uhbt3aelr6"},{"post_id":"cku6979z8003200uh8enre70d","category_id":"cku697a08005k00uh702778cg","_id":"cku697a0n006l00uhcz947a95"},{"post_id":"cku6979z9003600uh8x8x4poj","category_id":"cku697a08005k00uh702778cg","_id":"cku697a0q006q00uh0tlu5z0w"},{"post_id":"cku6979za003900uhep6qevr3","category_id":"cku697a08005k00uh702778cg","_id":"cku697a0s006w00uhgpddhyaf"},{"post_id":"cku6979zb003d00uhgej2884m","category_id":"cku697a08005k00uh702778cg","_id":"cku697a0u007200uhe4bzg272"},{"post_id":"cku6979zc003g00uh2lumerfk","category_id":"cku697a0s006v00uhdjxvftkf","_id":"cku697a0w007600uh0wmje0y2"},{"post_id":"cku6979zg003t00uhhpuacb5k","category_id":"cku697a08005k00uh702778cg","_id":"cku697a0x007900uhergp8c96"},{"post_id":"cku6979zk003z00uhfrhles9m","category_id":"cku697a08005k00uh702778cg","_id":"cku697a10007e00uhbaehhwcx"},{"post_id":"cku6979zo004b00uh5jxx6uq3","category_id":"cku697a08005k00uh702778cg","_id":"cku697a10007h00uhe3vi2p3u"},{"post_id":"cku6979zs004l00uh4hamc5uq","category_id":"cku697a0z007d00uh5kambx98","_id":"cku697a11007l00uh6qey44he"},{"post_id":"cku6979zt004o00uh8mkc6jni","category_id":"cku697a0s006v00uhdjxvftkf","_id":"cku697a12007q00uhesbzhv4j"},{"post_id":"cku6979zu004r00uheqiygnzr","category_id":"cku697a08005k00uh702778cg","_id":"cku697a13007s00uhd6956dlw"},{"post_id":"cku6979zv004u00uh6tmn8ql5","category_id":"cku697a08005k00uh702778cg","_id":"cku697a13007w00uh9a5mbvfm"},{"post_id":"cku6979zw004z00uh7wdyh7na","category_id":"cku697a13007r00uh9adhc3d6","_id":"cku697a14008000uh9c9z3h09"},{"post_id":"cku6979zx005200uh2rbl8cct","category_id":"cku697a14007x00uh3cnf82d2","_id":"cku697a15008400uh60vg9qa4"},{"post_id":"cku697a08005j00uha5qvcwp7","category_id":"cku697a14008100uh0rwl17wg","_id":"cku697a16008a00uhfh2t38ec"},{"post_id":"cku697a09005n00uhf50lh9g5","category_id":"cku697a14008100uh0rwl17wg","_id":"cku697a17008d00uh1ivzhf6h"},{"post_id":"cku697a0a005q00uhepbuagka","category_id":"cku697a14008100uh0rwl17wg","_id":"cku697a17008g00uh3l39fboh"},{"post_id":"cku697a0c005v00uhcgs0h1tf","category_id":"cku697a17008c00uh2ito6zbd","_id":"cku697a18008k00uh1i18av0m"},{"post_id":"cku697a0f006100uhfxwp9x2e","category_id":"cku697a17008h00uhbw6ucrr4","_id":"cku697a19008o00uhhklwd8o3"},{"post_id":"cku697a0h006400uh8u896ugq","category_id":"cku697a18008l00uhaf2ia429","_id":"cku697a1a008s00uh1gf2fodf"},{"post_id":"cku697a0j006900uhba516i4s","category_id":"cku697a19008p00uhf5k03lyi","_id":"cku697a1b008x00uhfghwg01v"},{"post_id":"cku697a0k006c00uhgubq3laa","category_id":"cku697a19008p00uhf5k03lyi","_id":"cku697a1c009100uh9wo26md6"},{"post_id":"cku697a0m006h00uhgn9fchyz","category_id":"cku697a19008p00uhf5k03lyi","_id":"cku697a1d009500uh859n36ww"},{"post_id":"cku697a0n006j00uhfhclda8i","category_id":"cku697a19008p00uhf5k03lyi","_id":"cku697a1e009900uh5yi3a3rh"},{"post_id":"cku697a0o006m00uh5e7lbcjt","category_id":"cku697a19008p00uhf5k03lyi","_id":"cku697a1g009e00uh147lfvrp"},{"post_id":"cku697a0p006o00uh0ay053e3","category_id":"cku697a19008p00uhf5k03lyi","_id":"cku697a1k009i00uhcge69dht"},{"post_id":"cku697a0q006r00uh3mci2cf8","category_id":"cku697a19008p00uhf5k03lyi","_id":"cku697a1l009l00uh9k9phdo6"},{"post_id":"cku697a0r006t00uh5mty0681","category_id":"cku697a1j009h00uhf8coaq0l","_id":"cku697a1n009q00uh2vjyfrfq"},{"post_id":"cku697a0s006x00uhgfil5ugz","category_id":"cku697a1j009h00uhf8coaq0l","_id":"cku697a1o009s00uh6x1903fs"},{"post_id":"cku697a0u007000uh5d5sdbzy","category_id":"cku697a1j009h00uhf8coaq0l","_id":"cku697a1p009u00uh512jb2jp"},{"post_id":"cku697a2f00br00uh18ct1zh3","category_id":"cku6979yu002400uhbxfl4ki3","_id":"cku697a2g00bw00uh50nmgz3h"},{"post_id":"cku697a2c00bm00uhgraldt8s","category_id":"cku697a2e00bo00uh4h0z6i7y","_id":"cku697a2h00c000uh0gw24iox"},{"post_id":"cku697a2d00bn00uh1pdcelfl","category_id":"cku697a2e00bo00uh4h0z6i7y","_id":"cku697a2h00c200uhf07k0npw"},{"post_id":"cku697a2e00bq00uheb03fkk4","category_id":"cku697a2g00bx00uh6nxe2zop","_id":"cku697a2h00c400uhciyv64o7"},{"post_id":"cku697a2l00c500uhdiun8ktu","category_id":"cku6979zn004500uhevft1twd","_id":"cku697a2m00c800uhedyyh41y"},{"post_id":"cku697a2o00c900uhh34p91du","category_id":"cku6979yq001x00uh9zx2anhe","_id":"cku697a2p00cc00uhcuaq1xo7"}],"PostTag":[{"post_id":"cku6979x4000100uh1z911s1o","tag_id":"cku6979xg000500uheyb11jeo","_id":"cku6979xr000k00uhc60m7fge"},{"post_id":"cku6979x4000100uh1z911s1o","tag_id":"cku6979xl000d00uh2iey8zlg","_id":"cku6979xu000n00uh42651yut"},{"post_id":"cku6979x8000300uh7n9sa6t8","tag_id":"cku6979xq000i00uhbuirb8r2","_id":"cku6979y1000w00uhgqvq1m3a"},{"post_id":"cku6979x8000300uh7n9sa6t8","tag_id":"cku6979xl000d00uh2iey8zlg","_id":"cku6979y2001000uhhzwe5lhq"},{"post_id":"cku6979xh000700uh0o04diki","tag_id":"cku6979y0000u00uhe5ws1uje","_id":"cku6979y4001400uh2pcf8r2b"},{"post_id":"cku6979xj000900uhf9u5a1zh","tag_id":"cku6979y0000u00uhe5ws1uje","_id":"cku6979y7001a00uh6zqe4ncu"},{"post_id":"cku6979xk000b00uh7mk1au3m","tag_id":"cku6979y0000u00uhe5ws1uje","_id":"cku6979yb001h00uhgnji7zue"},{"post_id":"cku6979xn000e00uhcmp872w5","tag_id":"cku6979y9001e00uh5qorhulh","_id":"cku6979yo001u00uhhr6084h4"},{"post_id":"cku6979xn000e00uhcmp872w5","tag_id":"cku6979yf001m00uhbhvpcut2","_id":"cku6979yq001y00uh7hvm2qn7"},{"post_id":"cku6979xo000f00uhdgz3hpn8","tag_id":"cku6979yl001s00uh0p4adjpf","_id":"cku6979yt002100uhda71g873"},{"post_id":"cku6979xs000l00uh7wiz04hq","tag_id":"cku6979yr001z00uhddyu2v3g","_id":"cku6979yw002700uh776412wx"},{"post_id":"cku6979xw000q00uh5c6tciyz","tag_id":"cku6979yv002500uhca8q2e5n","_id":"cku6979z3002o00uh854f4qy3"},{"post_id":"cku6979xw000q00uh5c6tciyz","tag_id":"cku6979yy002c00uh6dqbcqot","_id":"cku6979z5002s00uh3bq0175d"},{"post_id":"cku6979xw000q00uh5c6tciyz","tag_id":"cku6979z0002h00uh53bi6xzg","_id":"cku6979z6002v00uh82sa1fja"},{"post_id":"cku6979xy000r00uh57ofdywp","tag_id":"cku6979z2002m00uhannt5ma0","_id":"cku6979z7002z00uh4j3ogjso"},{"post_id":"cku6979z7003100uh2h4ddxb6","tag_id":"cku6979yf001m00uhbhvpcut2","_id":"cku6979z9003500uh1wwlcnpg"},{"post_id":"cku6979y1000v00uhd3u11pcc","tag_id":"cku6979yf001m00uhbhvpcut2","_id":"cku6979za003800uhgpargjmr"},{"post_id":"cku6979y1000v00uhd3u11pcc","tag_id":"cku6979z7003000uh5fyfb3nk","_id":"cku6979zb003c00uhbvawa86a"},{"post_id":"cku6979zc003g00uh2lumerfk","tag_id":"cku6979z2002m00uhannt5ma0","_id":"cku6979ze003l00uh48p0ghhe"},{"post_id":"cku6979y1000x00uhdjf14xrc","tag_id":"cku6979za003700uh4shv514c","_id":"cku6979zf003n00uhaodd7qs7"},{"post_id":"cku6979y1000x00uhdjf14xrc","tag_id":"cku6979zc003f00uhb306hczq","_id":"cku6979zg003r00uhas06f3vk"},{"post_id":"cku6979y3001200uh2f9jdy0q","tag_id":"cku6979ze003k00uhhb3nhqtt","_id":"cku6979zi003v00uh43thax66"},{"post_id":"cku6979zi003w00uh7ai1b5nc","tag_id":"cku6979z7003000uh5fyfb3nk","_id":"cku6979zm004200uh6i862uxe"},{"post_id":"cku6979y4001500uh33l1bx48","tag_id":"cku6979zg003s00uh0up0dldn","_id":"cku6979zn004600uhdqid6drd"},{"post_id":"cku6979zk003z00uhfrhles9m","tag_id":"cku6979zc003f00uhb306hczq","_id":"cku6979zo004a00uha0lhh1g2"},{"post_id":"cku6979y6001900uh088vewxl","tag_id":"cku6979zl004100uhfpo8g3ox","_id":"cku6979zq004e00uhbgg5fny0"},{"post_id":"cku6979zt004o00uh8mkc6jni","tag_id":"cku6979zl004100uhfpo8g3ox","_id":"cku6979zv004t00uh8rac8uax"},{"post_id":"cku6979y7001b00uh4ak02fht","tag_id":"cku6979zo004900uh99id6kqh","_id":"cku6979zw004y00uhfo7meck3"},{"post_id":"cku6979y7001b00uh4ak02fht","tag_id":"cku6979zr004h00uhhyzu46fb","_id":"cku6979zx005100uhe4c6h31i"},{"post_id":"cku6979y7001b00uh4ak02fht","tag_id":"cku6979zt004n00uhcjcpdfsy","_id":"cku6979zy005500uhgf9jhhzf"},{"post_id":"cku6979ya001f00uh6aav9at3","tag_id":"cku6979zv004w00uh2mxh1cg5","_id":"cku697a06005e00uhbz5843m6"},{"post_id":"cku6979ya001f00uh6aav9at3","tag_id":"cku6979zy005400uh0y4igq1s","_id":"cku697a07005h00uh6adv25xk"},{"post_id":"cku697a01005900uh7eiabm7f","tag_id":"cku6979yf001m00uhbhvpcut2","_id":"cku697a09005m00uhbg1o43w4"},{"post_id":"cku6979yb001i00uh2bde7bx8","tag_id":"cku697a03005a00uhhvru5onw","_id":"cku697a09005p00uh4cwr8m6n"},{"post_id":"cku6979yf001l00uh8pk51ia4","tag_id":"cku697a07005i00uh7bij380z","_id":"cku697a0b005u00uh42wxhi5v"},{"post_id":"cku6979yg001o00uhgm2zfyu3","tag_id":"cku697a0b005s00uh0g3db5mz","_id":"cku697a0g006300uh1ssn8ens"},{"post_id":"cku697a0d005x00uh14sic0cs","tag_id":"cku6979y0000u00uhe5ws1uje","_id":"cku697a0i006500uhgp9vfjvj"},{"post_id":"cku6979yj001r00uh0zk6e2g5","tag_id":"cku697a0e006000uh409vetmp","_id":"cku697a0k006b00uh98hrbrdd"},{"post_id":"cku697a0h006400uh8u896ugq","tag_id":"cku6979z7003000uh5fyfb3nk","_id":"cku697a0l006f00uhcx5i3dlz"},{"post_id":"cku6979yl001t00uhhejp3fu8","tag_id":"cku697a0j006800uhdrv5026d","_id":"cku697a0n006i00uhd7pb0p6n"},{"post_id":"cku6979yo001w00uh8ofhcr30","tag_id":"cku697a0m006g00uh7shw2ml4","_id":"cku697a0s006u00uh31a8dhhi"},{"post_id":"cku6979yo001w00uh8ofhcr30","tag_id":"cku697a0o006n00uh3myl2444","_id":"cku697a0t006y00uh2yrs8rhd"},{"post_id":"cku6979ys002000uh2zry0te2","tag_id":"cku697a0m006g00uh7shw2ml4","_id":"cku697a0u007100uh3nuaeoyn"},{"post_id":"cku6979yv002600uh0b2g5p18","tag_id":"cku697a0t006z00uh8nr791l6","_id":"cku697a0x007a00uhewn99k6y"},{"post_id":"cku6979yv002600uh0b2g5p18","tag_id":"cku697a0v007400uhdpbk2fvd","_id":"cku697a0y007b00uhf1cl2t9d"},{"post_id":"cku6979yw002800uh61946wf7","tag_id":"cku697a0w007700uh16326ngx","_id":"cku697a10007f00uha33ne2cc"},{"post_id":"cku6979yx002b00uh2vv41ywg","tag_id":"cku697a0y007c00uh42mwgw4m","_id":"cku697a12007m00uh5if5176e"},{"post_id":"cku6979yx002b00uh2vv41ywg","tag_id":"cku697a10007g00uh38hh0buu","_id":"cku697a12007n00uhgflncq41"},{"post_id":"cku6979yy002d00uh2vnuhewe","tag_id":"cku6979zc003f00uhb306hczq","_id":"cku697a13007u00uhbvwff721"},{"post_id":"cku6979yy002d00uh2vnuhewe","tag_id":"cku697a12007o00uhd8athx2x","_id":"cku697a13007v00uh002r27ai"},{"post_id":"cku6979yz002g00uhbz8z2y88","tag_id":"cku697a13007t00uh95qvehfz","_id":"cku697a14007z00uhaigm7c00"},{"post_id":"cku6979z0002i00uh06rt4mls","tag_id":"cku697a14007y00uhayur31qz","_id":"cku697a15008300uh06ki5smu"},{"post_id":"cku6979z1002l00uh7rwjhzwj","tag_id":"cku697a14007y00uhayur31qz","_id":"cku697a16008700uh4ln51cxg"},{"post_id":"cku6979z2002n00uh7tgyamit","tag_id":"cku697a14007y00uhayur31qz","_id":"cku697a16008b00uh0maaa2fk"},{"post_id":"cku6979z4002q00uh3cfp11rs","tag_id":"cku697a16008800uhe06sh3jc","_id":"cku697a17008f00uh0pduhjmb"},{"post_id":"cku6979z5002u00uh4irda8l7","tag_id":"cku697a17008e00uhbs934moi","_id":"cku697a18008j00uh1fnoeu6y"},{"post_id":"cku6979z6002w00uhbijr2jh0","tag_id":"cku697a17008i00uh97mgbleo","_id":"cku697a19008n00uhbbqu2jru"},{"post_id":"cku6979z8003200uh8enre70d","tag_id":"cku697a18008m00uh17a6dva8","_id":"cku697a19008r00uh1s1m24sk"},{"post_id":"cku6979z9003600uh8x8x4poj","tag_id":"cku697a19008q00uh1xvrc9jd","_id":"cku697a1a008v00uhe8b94kgd"},{"post_id":"cku6979za003900uhep6qevr3","tag_id":"cku697a1a008u00uha3h01zfp","_id":"cku697a1c008z00uh4t01dk8h"},{"post_id":"cku6979zb003d00uhgej2884m","tag_id":"cku697a18008m00uh17a6dva8","_id":"cku697a1d009300uh7g5e5j0e"},{"post_id":"cku6979zd003j00uhdrlqd8l3","tag_id":"cku6979z2002m00uhannt5ma0","_id":"cku697a1e009700uhdqf671xz"},{"post_id":"cku6979zd003j00uhdrlqd8l3","tag_id":"cku697a1d009200uhgscmd4v3","_id":"cku697a1g009a00uhfbkma46n"},{"post_id":"cku6979ze003m00uhcvl50pjz","tag_id":"cku697a1e009600uh5tqq4m56","_id":"cku697a1g009c00uhgeesglis"},{"post_id":"cku6979zf003p00uh20i54w5c","tag_id":"cku697a1g009b00uh29yu6z7f","_id":"cku697a1j009g00uh4sp7g8eh"},{"post_id":"cku6979zg003t00uhhpuacb5k","tag_id":"cku697a1g009b00uh29yu6z7f","_id":"cku697a1l009k00uh00a814q6"},{"post_id":"cku6979zm004300uhc37n130f","tag_id":"cku697a1k009j00uh5elnc2dy","_id":"cku697a1m009o00uh1ioi5hdf"},{"post_id":"cku6979zn004700uh50ky5k8d","tag_id":"cku697a1m009n00uhftpy5zjm","_id":"cku697a1q009v00uh2mftgv3l"},{"post_id":"cku6979zn004700uh50ky5k8d","tag_id":"cku697a1n009r00uh0fdbfymz","_id":"cku697a1q009w00uhb3m6cvn3"},{"post_id":"cku6979zo004b00uh5jxx6uq3","tag_id":"cku697a1m009n00uhftpy5zjm","_id":"cku697a1r009y00uh5ji3ff8b"},{"post_id":"cku6979zq004f00uhgj9ob1fp","tag_id":"cku697a1m009n00uhftpy5zjm","_id":"cku697a1s00a000uhbe761maq"},{"post_id":"cku6979zr004i00uhenw72b8f","tag_id":"cku697a1r009z00uh9iphbbwc","_id":"cku697a1s00a200uh89vecmma"},{"post_id":"cku6979zs004l00uh4hamc5uq","tag_id":"cku697a1s00a100uh8w1n0mlo","_id":"cku697a1t00a400uh2jochdx7"},{"post_id":"cku6979zu004r00uheqiygnzr","tag_id":"cku697a1t00a300uh4cfx6tnq","_id":"cku697a1u00a600uh2von7em9"},{"post_id":"cku6979zv004u00uh6tmn8ql5","tag_id":"cku697a1t00a500uhdexk7fxp","_id":"cku697a1u00a800uhbhm45oqz"},{"post_id":"cku6979zw004z00uh7wdyh7na","tag_id":"cku697a1u00a700uhcomo5imd","_id":"cku697a1u00aa00uh3e3u6cud"},{"post_id":"cku6979zx005200uh2rbl8cct","tag_id":"cku697a1u00a900uh62lpdj6i","_id":"cku697a1v00ac00uhgsrdh228"},{"post_id":"cku6979zz005600uh1dn0bvbc","tag_id":"cku697a1v00ab00uhd35995ni","_id":"cku697a1v00ae00uh50ua1u2u"},{"post_id":"cku697a05005b00uhh3vp9xc8","tag_id":"cku697a1v00ad00uhgqpu1o8b","_id":"cku697a1w00ag00uh5chfhh9x"},{"post_id":"cku697a07005f00uh0acfgj75","tag_id":"cku697a1v00af00uh6d0o91bf","_id":"cku697a1w00ai00uhh7bnfrff"},{"post_id":"cku697a08005j00uha5qvcwp7","tag_id":"cku697a1w00ah00uhhv6wfe94","_id":"cku697a1x00ak00uh70pp2dep"},{"post_id":"cku697a09005n00uhf50lh9g5","tag_id":"cku697a1w00ah00uhhv6wfe94","_id":"cku697a1x00am00uhfp56av6q"},{"post_id":"cku697a0a005q00uhepbuagka","tag_id":"cku697a1w00ah00uhhv6wfe94","_id":"cku697a1x00ao00uh9gmrfs52"},{"post_id":"cku697a0c005v00uhcgs0h1tf","tag_id":"cku697a1g009b00uh29yu6z7f","_id":"cku697a1y00aq00uh1jyq0wa5"},{"post_id":"cku697a0f006100uhfxwp9x2e","tag_id":"cku697a1e009600uh5tqq4m56","_id":"cku697a1z00at00uhbvnbbhst"},{"post_id":"cku697a0f006100uhfxwp9x2e","tag_id":"cku697a1y00ar00uh9yku1okp","_id":"cku697a1z00au00uh204g8ir1"},{"post_id":"cku697a0j006900uhba516i4s","tag_id":"cku697a1y00as00uhb7jreaii","_id":"cku697a1z00ax00uhbtbvajx9"},{"post_id":"cku697a0j006900uhba516i4s","tag_id":"cku697a1z00av00uhhsewbsrt","_id":"cku697a1z00ay00uh415901ti"},{"post_id":"cku697a0k006c00uhgubq3laa","tag_id":"cku697a1y00as00uhb7jreaii","_id":"cku697a2100b100uh409o1uau"},{"post_id":"cku697a0k006c00uhgubq3laa","tag_id":"cku697a1z00az00uhdwhw723g","_id":"cku697a2100b200uh5ofrb8l8"},{"post_id":"cku697a0m006h00uhgn9fchyz","tag_id":"cku697a1y00as00uhb7jreaii","_id":"cku697a2200b500uhc58u64vh"},{"post_id":"cku697a0m006h00uhgn9fchyz","tag_id":"cku697a1z00az00uhdwhw723g","_id":"cku697a2200b600uhhy1w8731"},{"post_id":"cku697a0n006j00uhfhclda8i","tag_id":"cku697a1y00as00uhb7jreaii","_id":"cku697a2200b800uhcaly288s"},{"post_id":"cku697a0o006m00uh5e7lbcjt","tag_id":"cku697a1y00as00uhb7jreaii","_id":"cku697a2300ba00uh9riwch4w"},{"post_id":"cku697a0p006o00uh0ay053e3","tag_id":"cku697a2300b900uh45i4dte9","_id":"cku697a2400bc00uh6ejp6j40"},{"post_id":"cku697a0q006r00uh3mci2cf8","tag_id":"cku697a2300b900uh45i4dte9","_id":"cku697a2500bf00uh9ceue1wq"},{"post_id":"cku697a0q006r00uh3mci2cf8","tag_id":"cku697a2400bd00uh7y9rb00x","_id":"cku697a2500bg00uh8ojr9gr0"},{"post_id":"cku697a0r006t00uh5mty0681","tag_id":"cku697a2500be00uh1kk2aw2q","_id":"cku697a2600bi00uh87zd7g0m"},{"post_id":"cku697a0s006x00uhgfil5ugz","tag_id":"cku697a2500be00uh1kk2aw2q","_id":"cku697a2700bk00uhegzr8e3y"},{"post_id":"cku697a0u007000uh5d5sdbzy","tag_id":"cku697a2500be00uh1kk2aw2q","_id":"cku697a2700bl00uh6cm02rsl"},{"post_id":"cku697a2f00br00uh18ct1zh3","tag_id":"cku6979zy005400uh0y4igq1s","_id":"cku697a2g00bu00uhfpb24cr0"},{"post_id":"cku697a2f00br00uh18ct1zh3","tag_id":"cku6979zv004w00uh2mxh1cg5","_id":"cku697a2g00bv00uh5xfwbikt"},{"post_id":"cku697a2c00bm00uhgraldt8s","tag_id":"cku697a2e00bp00uh8i4o2fe8","_id":"cku697a2h00bz00uhexd0h01a"},{"post_id":"cku697a2d00bn00uh1pdcelfl","tag_id":"cku697a2g00bt00uh8fowe2yt","_id":"cku697a2h00c100uh2wd50684"},{"post_id":"cku697a2e00bq00uheb03fkk4","tag_id":"cku697a2h00by00uh4h70hdmk","_id":"cku697a2h00c300uhhzl8ej8u"},{"post_id":"cku697a2l00c500uhdiun8ktu","tag_id":"cku697a0y007c00uh42mwgw4m","_id":"cku697a2m00c600uh4jxf37k6"},{"post_id":"cku697a2l00c500uhdiun8ktu","tag_id":"cku697a10007g00uh38hh0buu","_id":"cku697a2m00c700uh6kemft09"},{"post_id":"cku697a2o00c900uhh34p91du","tag_id":"cku6979za003700uh4shv514c","_id":"cku697a2p00ca00uh0ltb2krb"},{"post_id":"cku697a2o00c900uhh34p91du","tag_id":"cku6979zc003f00uhb306hczq","_id":"cku697a2p00cb00uh5ylg9f9u"}],"Tag":[{"name":"SpringBoot","_id":"cku6979xg000500uheyb11jeo"},{"name":"java","_id":"cku6979xl000d00uh2iey8zlg"},{"name":"springMVC","_id":"cku6979xq000i00uhbuirb8r2"},{"name":"flume","_id":"cku6979y0000u00uhe5ws1uje"},{"name":"gcc","_id":"cku6979y9001e00uh5qorhulh"},{"name":"linux","_id":"cku6979yf001m00uhbhvpcut2"},{"name":"hadoop","_id":"cku6979yl001s00uh0p4adjpf"},{"name":"hexo","_id":"cku6979yr001z00uhddyu2v3g"},{"name":"hexo插件","_id":"cku6979yv002500uhca8q2e5n"},{"name":"hexo博客","_id":"cku6979yy002c00uh6dqbcqot"},{"name":"hexo教程","_id":"cku6979z0002h00uh53bi6xzg"},{"name":"kafka","_id":"cku6979z2002m00uhannt5ma0"},{"name":"nginx","_id":"cku6979z7003000uh5fyfb3nk"},{"name":"pipenv","_id":"cku6979za003700uh4shv514c"},{"name":"python","_id":"cku6979zc003f00uhb306hczq"},{"name":"proxmox","_id":"cku6979ze003k00uhhb3nhqtt"},{"name":"spark","_id":"cku6979zg003s00uh0up0dldn"},{"name":"zookeeper","_id":"cku6979zl004100uhfpo8g3ox"},{"name":"tag","_id":"cku6979zo004900uh99id6kqh"},{"name":"Kite","_id":"cku6979zr004h00uhhyzu46fb"},{"name":"tabnine","_id":"cku6979zt004n00uhcjcpdfsy"},{"name":"ssl","_id":"cku6979zv004w00uh2mxh1cg5"},{"name":"ca","_id":"cku6979zy005400uh0y4igq1s"},{"name":"golang","_id":"cku697a03005a00uhhvru5onw"},{"name":"go","_id":"cku697a07005i00uh7bij380z"},{"name":"go-mod","_id":"cku697a0b005s00uh0g3db5mz"},{"name":"ansible","_id":"cku697a0e006000uh409vetmp"},{"name":"cmdb","_id":"cku697a0j006800uhdrv5026d"},{"name":"docker","_id":"cku697a0m006g00uh7shw2ml4"},{"name":"log","_id":"cku697a0o006n00uh3myl2444"},{"name":"es","_id":"cku697a0t006z00uh8nr791l6"},{"name":"elasticsearch","_id":"cku697a0v007400uhdpbk2fvd"},{"name":"clickhouse","_id":"cku697a0w007700uh16326ngx"},{"name":"filebeat","_id":"cku697a0y007c00uh42mwgw4m"},{"name":"elk","_id":"cku697a10007g00uh38hh0buu"},{"name":"flask","_id":"cku697a12007o00uhd8athx2x"},{"name":"gorm","_id":"cku697a13007t00uh95qvehfz"},{"name":"jenkins","_id":"cku697a14007y00uhayur31qz"},{"name":"update","_id":"cku697a16008800uhe06sh3jc"},{"name":"优化","_id":"cku697a17008e00uhbs934moi"},{"name":"clamav","_id":"cku697a17008i00uh97mgbleo"},{"name":"confluence","_id":"cku697a18008m00uh17a6dva8"},{"name":"awx","_id":"cku697a19008q00uh1xvrc9jd"},{"name":"dns","_id":"cku697a1a008u00uha3h01zfp"},{"name":"kafkacenter","_id":"cku697a1d009200uhgscmd4v3"},{"name":"mongodb","_id":"cku697a1e009600uh5tqq4m56"},{"name":"mysql","_id":"cku697a1g009b00uh29yu6z7f"},{"name":"rabbitmq","_id":"cku697a1k009j00uh5elnc2dy"},{"name":"redis","_id":"cku697a1m009n00uhftpy5zjm"},{"name":"redis-cluster","_id":"cku697a1n009r00uh0fdbfymz"},{"name":"ruby","_id":"cku697a1r009z00uh9iphbbwc"},{"name":"sentry","_id":"cku697a1s00a100uh8w1n0mlo"},{"name":"yum","_id":"cku697a1t00a300uh4cfx6tnq"},{"name":"centos7","_id":"cku697a1t00a500uhdexk7fxp"},{"name":"k8s","_id":"cku697a1u00a700uhcomo5imd"},{"name":"ldap","_id":"cku697a1u00a900uh62lpdj6i"},{"name":"network","_id":"cku697a1v00ab00uhd35995ni"},{"name":"ssh","_id":"cku697a1v00ad00uhgqpu1o8b"},{"name":"whiptail","_id":"cku697a1v00af00uh6d0o91bf"},{"name":"minio","_id":"cku697a1w00ah00uhhv6wfe94"},{"name":"auth","_id":"cku697a1y00ar00uh9yku1okp"},{"name":"prome","_id":"cku697a1y00as00uhb7jreaii"},{"name":"thanos","_id":"cku697a1z00av00uhhsewbsrt"},{"name":"node_exporter","_id":"cku697a1z00az00uhdwhw723g"},{"name":"prometheus","_id":"cku697a2300b900uh45i4dte9"},{"name":"dingding","_id":"cku697a2400bd00uh7y9rb00x"},{"name":"salt","_id":"cku697a2500be00uh1kk2aw2q"},{"name":"vue","_id":"cku697a2e00bp00uh8i4o2fe8"},{"name":"vue3","_id":"cku697a2g00bt00uh8fowe2yt"},{"name":"win10","_id":"cku697a2h00by00uh4h70hdmk"}]}}